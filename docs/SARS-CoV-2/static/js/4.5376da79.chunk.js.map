{"version":3,"sources":["../../../packages/core/util/types/mst.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/util.ts","../../../packages/core/util/io/rangeFetcher.ts","../../../packages/core/util/io/index.ts","../../../packages/core/data_adapters/BaseAdapter.ts","../../../packages/core/util/rxjs.ts","../../../packages/core/ui/emptyIcon.png","../../../packages/core/ui/linearGenomeViewIcon.png","../../../packages/core/ui/svInspectorIcon.png","../../../packages/core/util/io/ElectronRemoteFile.ts","../../../plugins/hic/src/HicAdapter/HicAdapter.ts","rpc.worker.ts","../../../packages/core/pluggableElementTypes/PluggableElementBase.ts","../../../packages/core/pluggableElementTypes/renderers/RendererType.ts","../../../packages/core/pluggableElementTypes/AdapterType.ts","../../../packages/core/pluggableElementTypes/TrackType.ts","../../../packages/core/pluggableElementTypes/DisplayType.ts","../../../packages/core/pluggableElementTypes/ViewType.ts","../../../packages/core/pluggableElementTypes/WidgetType.ts","../../../packages/core/pluggableElementTypes/ConnectionType.ts","../../../packages/core/rpc/remoteAbortSignals.ts","../../../packages/core/pluggableElementTypes/RpcMethodType.ts","../../../packages/core/ui/SanitizedHTML.tsx","../../../packages/core/BaseFeatureWidget/BaseFeatureDetail.tsx","../../../packages/core/util/range.ts","../../../packages/core/util/blockTypes.ts","../../../packages/core/util/calculateDynamicBlocks.ts","../../../packages/core/util/calculateStaticBlocks.ts","../../../packages/core/util/Base1DViewModel.ts","../../../packages/core/pluggableElementTypes/models/baseConnectionConfig.ts","../../../packages/core/pluggableElementTypes/models/BaseConnectionModelFactory.js","../../../packages/core/pluggableElementTypes/models/BaseViewModel.ts","../../../packages/core/util/tracks.ts","../../../packages/core/pluggableElementTypes/models/BaseDisplayModel.tsx","../../../packages/core/pluggableElementTypes/models/BaseTrackModel.ts","../../../packages/core/pluggableElementTypes/models/baseTrackConfig.ts","../../../packages/core/util/simpleFeature.ts","../../../packages/core/pluggableElementTypes/renderers/util/serializableFilterChain.ts","../../../packages/core/ui/theme.ts","../../../packages/core/ui/Logo.tsx","../../../packages/core/ui/ResizeHandle.tsx","../../../packages/core/ui/Drawer.js","../../../packages/core/ui/DrawerWidget.js","../../../packages/core/ui/Menu.tsx","../../../packages/core/ui/DropDownMenu.tsx","../../../packages/core/ui/EditableTypography.tsx","../../../packages/core/ui/Snackbar.tsx","../../../packages/core/ui/ViewContainer.tsx","../../../packages/core/ui/App.js","../../../packages/core/ui/FileSelector.tsx","../../../packages/core/util/offscreenCanvasPonyfill.js","../../../packages/core/ui/PrerenderedCanvas.tsx","../../../packages/core/ui/NewSessionCards.js","../../../packages/core/ui/RecentSessionCard.js","../../../packages/core/ui/FactoryResetDialog.tsx","../../../packages/core/ui/StartScreen.tsx","../../../packages/core/ui/Tooltip.tsx","../../../packages/core/ui/FatalErrorDialog.tsx","../../../packages/core/pluggableElementTypes/renderers/ServerSideRendererType.ts","../../../packages/core/pluggableElementTypes/renderers/CircularChordRendererType.ts","../../../packages/core/util/layouts/GranularRectLayout.ts","../../../packages/core/util/layouts/MultiLayout.ts","../../../packages/core/util/layouts/PrecomputedLayout.ts","../../../packages/core/pluggableElementTypes/renderers/BoxRendererType.ts","../../../packages/core/Plugin.ts","../../../packages/core/util/color/cssColorsLevel4.ts","../../../packages/core/util/color/index.ts","../../../packages/core/ReExports/modules.ts","../../../packages/core/ReExports/list.ts","../../../packages/core/ReExports/index.ts","../../../packages/core/data_adapters/dataAdapterCache.ts","../../../packages/core/rpc/coreRpcMethods.ts","../../../packages/core/CorePlugin.ts","../../../packages/core/PluginManager.ts","../../../packages/core/PluginLoader.ts","../../../packages/core/util/analytics.ts","sessionSharing.ts","../../../packages/core/BaseFeatureWidget/index.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/baseLinearDisplayConfigSchema.ts","../../../packages/core/util/compositeMap.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/Block.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/LinearBlocks.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/BaseLinearDisplay.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/ServerSideRenderedContent.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/ServerSideRenderedBlockContent.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/serverSideRenderedBlock.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/BaseLinearDisplayModel.tsx","../../../plugins/linear-genome-view/src/LinearBasicDisplay/configSchema.ts","../../../plugins/linear-genome-view/src/LinearBasicDisplay/model.ts","../../../packages/core/ui/Icons.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RefNameAutocomplete.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/util.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewRubberBand.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewScaleBar.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ZoomControls.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Header.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackLabel.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RubberBand.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ScaleBar.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/VerticalGuides.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/CenterLine.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TracksContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ImportForm.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/MiniControls.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/AboutDialog.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/LinearGenomeView.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/index.ts","../../../plugins/linear-genome-view/src/index.ts","../../../plugins/wiggle/src/statsUtil.ts","../../../plugins/wiggle/src/BigWigAdapter/BigWigAdapter.ts","../../../plugins/wiggle/src/BigWigAdapter/configSchema.ts","../../../plugins/wiggle/src/util.ts","../../../plugins/wiggle/src/configSchema.ts","../../../plugins/wiggle/src/WiggleBaseRenderer.ts","../../../plugins/wiggle/src/WiggleRendering.tsx","../../../plugins/wiggle/src/DensityRenderer/index.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/components/Tooltip.tsx","../../../plugins/wiggle/src/LinearWiggleDisplay/models/model.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/components/WiggleDisplayComponent.tsx","../../../plugins/wiggle/src/XYPlotRenderer/XYPlotRenderer.ts","../../../plugins/wiggle/src/XYPlotRenderer/index.ts","../../../plugins/wiggle/src/LinePlotRenderer/LinePlotRenderer.js","../../../plugins/wiggle/src/LinePlotRenderer/index.js","../../../plugins/wiggle/src/WiggleRPC/rpcMethods.ts","../../../plugins/wiggle/src/index.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/models/configSchema.ts","../../../plugins/alignments/src/AlignmentsFeatureDetail/AlignmentsFeatureDetail.tsx","../../../plugins/alignments/src/AlignmentsFeatureDetail/index.js","../../../plugins/alignments/src/BamAdapter/configSchema.ts","../../../plugins/alignments/src/BamAdapter/MismatchParser.ts","../../../plugins/alignments/src/BamAdapter/BamSlightlyLazyFeature.ts","../../../plugins/alignments/src/BamAdapter/BamAdapter.ts","../../../plugins/alignments/src/BamAdapter/index.ts","../../../plugins/alignments/src/CramAdapter/configSchema.ts","../../../plugins/alignments/src/CramAdapter/CramSlightlyLazyFeature.ts","../../../plugins/alignments/src/CramAdapter/CramAdapter.ts","../../../plugins/alignments/src/CramAdapter/index.ts","../../../plugins/alignments/src/HtsgetBamAdapter/configSchema.ts","../../../plugins/alignments/src/HtsgetBamAdapter/HtsgetBamAdapter.ts","../../../plugins/alignments/src/HtsgetBamAdapter/index.ts","../../../plugins/alignments/src/LinearAlignmentsDisplay/models/configSchema.ts","../../../plugins/alignments/src/LinearAlignmentsDisplay/models/model.ts","../../../plugins/alignments/src/LinearAlignmentsDisplay/components/AlignmentsDisplay.tsx","../../../plugins/alignments/src/LinearPileupDisplay/configSchema.ts","../../../plugins/alignments/src/LinearPileupDisplay/components/LinearPileupDisplayBlurb.tsx","../../../plugins/alignments/src/LinearPileupDisplay/model.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/components/Tooltip.tsx","../../../plugins/alignments/src/LinearSNPCoverageDisplay/models/model.ts","../../../plugins/alignments/src/PileupRenderer/components/PileupRendering.tsx","../../../plugins/alignments/src/PileupRenderer/configSchema.ts","../../../plugins/alignments/src/PileupRenderer/sortUtil.ts","../../../plugins/alignments/src/PileupRenderer/PileupRenderer.ts","../../../plugins/alignments/src/NestedFrequencyTable.ts","../../../plugins/alignments/src/SNPCoverageAdapter/configSchema.ts","../../../plugins/alignments/src/SNPCoverageAdapter/SNPCoverageAdapter.ts","../../../plugins/alignments/src/SNPCoverageAdapter/index.ts","../../../plugins/alignments/src/SNPCoverageRenderer/configSchema.js","../../../plugins/alignments/src/SNPCoverageRenderer/SNPCoverageRenderer.ts","../../../plugins/alignments/src/SNPCoverageRenderer/index.js","../../../plugins/alignments/src/index.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/models/configSchema.ts","../../../plugins/bed/src/util.ts","../../../plugins/bed/src/BigBedAdapter/BigBedAdapter.ts","../../../plugins/bed/src/BigBedAdapter/configSchema.ts","../../../plugins/bed/src/BedTabixAdapter/BedTabixAdapter.ts","../../../plugins/bed/src/BedTabixAdapter/configSchema.ts","../../../plugins/bed/src/index.ts","../../../plugins/breakpoint-split-view/src/BreakpointAlignmentsFeatureDetail/BreakpointAlignmentsFeatureDetail.tsx","../../../plugins/breakpoint-split-view/src/BreakpointAlignmentsFeatureDetail/index.js","../../../plugins/breakpoint-split-view/src/model.ts","../../../plugins/breakpoint-split-view/src/util.ts","../../../plugins/breakpoint-split-view/src/components/AlignmentConnections.tsx","../../../plugins/breakpoint-split-view/src/components/Breakends.tsx","../../../plugins/breakpoint-split-view/src/components/Header.tsx","../../../plugins/breakpoint-split-view/src/components/Translocations.tsx","../../../plugins/breakpoint-split-view/src/components/BreakpointSplitView.tsx","../../../plugins/breakpoint-split-view/src/BreakpointSplitView.ts","../../../plugins/breakpoint-split-view/src/index.ts","../../../plugins/circular-view/src/CircularView/components/Ruler.js","../../../plugins/circular-view/src/CircularView/components/CircularView.js","../../../plugins/circular-view/src/CircularView/models/viewportVisibleRegion.ts","../../../plugins/circular-view/src/CircularView/models/slices.ts","../../../plugins/circular-view/src/CircularView/models/CircularView.ts","../../../plugins/circular-view/src/CircularView/index.ts","../../../plugins/circular-view/src/BaseChordDisplay/components/Loading.tsx","../../../plugins/circular-view/src/BaseChordDisplay/components/DisplayError.js","../../../plugins/circular-view/src/BaseChordDisplay/components/RpcRenderedSvgGroup.js","../../../plugins/circular-view/src/BaseChordDisplay/components/BaseChordDisplay.tsx","../../../plugins/circular-view/src/BaseChordDisplay/models/renderReaction.js","../../../plugins/circular-view/src/BaseChordDisplay/models/BaseChordDisplayModel.ts","../../../plugins/circular-view/src/BaseChordDisplay/models/baseChordDisplayConfig.ts","../../../plugins/circular-view/src/index.ts","../../../plugins/config/src/ConfigurationEditorWidget/components/CallbackEditor.js","../../../plugins/config/src/ConfigurationEditorWidget/components/ColorEditor.tsx","../../../plugins/config/src/ConfigurationEditorWidget/components/JsonEditor.js","../../../plugins/config/src/ConfigurationEditorWidget/components/SlotEditor.js","../../../plugins/config/src/ConfigurationEditorWidget/components/TypeSelector.js","../../../plugins/config/src/ConfigurationEditorWidget/components/ConfigurationEditor.js","../../../plugins/config/src/ConfigurationEditorWidget/model.js","../../../plugins/config/src/ConfigurationEditorWidget/index.js","../../../plugins/config/src/FromConfigAdapter/FromConfigAdapter.ts","../../../plugins/config/src/FromConfigAdapter/FromConfigSequenceAdapter.ts","../../../plugins/config/src/FromConfigAdapter/configSchema.ts","../../../plugins/config/src/RefNameAliasAdapter/RefNameAliasAdapter.ts","../../../plugins/config/src/RefNameAliasAdapter/configSchema.ts","../../../plugins/config/src/index.ts","../../../plugins/data-management/src/ucsc-trackhub/configSchema.js","../../../plugins/data-management/src/ucsc-trackhub/ucscAssemblies.js","../../../plugins/data-management/src/ucsc-trackhub/ucscTrackHub.js","../../../plugins/data-management/src/ucsc-trackhub/model.js","../../../plugins/data-management/src/AddTrackWidget/components/ConfirmTrack.js","../../../plugins/data-management/src/AddTrackWidget/components/TrackSourceSelect.js","../../../plugins/data-management/src/AddTrackWidget/components/AddTrackWidget.js","../../../plugins/data-management/src/AddTrackWidget/model.js","../../../plugins/data-management/src/AddTrackWidget/index.js","../../../plugins/data-management/src/AddConnectionWidget/components/ConfigureConnection.js","../../../plugins/data-management/src/AddConnectionWidget/components/ConnectionTypeSelect.tsx","../../../plugins/data-management/src/AddConnectionWidget/components/AddConnectionWidget.js","../../../plugins/data-management/src/AddConnectionWidget/model.js","../../../plugins/data-management/src/AddConnectionWidget/index.js","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/components/Category.js","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/components/TrackEntry.js","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/components/Contents.js","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/components/HierarchicalTrackSelector.js","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/model.js","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/index.js","../../../plugins/data-management/src/AssemblyManager/AssemblyTable.tsx","../../../plugins/data-management/src/AssemblyManager/AssemblyAddForm.tsx","../../../plugins/data-management/src/AssemblyManager/AssemblyEditor.tsx","../../../plugins/data-management/src/AssemblyManager/AssemblyManager.tsx","../../../plugins/data-management/src/SetDefaultSession/SetDefaultSession.tsx","../../../plugins/data-management/src/index.ts","../../../plugins/dotplot-view/src/ServerSideRenderedContent.tsx","../../../plugins/dotplot-view/src/ServerSideRenderedBlockContent.tsx","../../../plugins/dotplot-view/src/DotplotDisplay/components/DotplotDisplay.tsx","../../../plugins/dotplot-view/src/DotplotDisplay/index.ts","../../../plugins/dotplot-view/src/DotplotRenderer/components/DotplotRendering.tsx","../../../plugins/dotplot-view/src/DotplotRenderer/configSchema.ts","../../../packages/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType.ts","../../../plugins/dotplot-view/src/DotplotView/model.ts","../../../plugins/dotplot-view/src/DotplotRenderer/DotplotRenderer.ts","../../../packages/core/util/QuickLRU.js","../../../plugins/dotplot-view/src/PAFAdapter/PAFAdapter.ts","../../../plugins/dotplot-view/src/PAFAdapter/configSchema.ts","../../../plugins/dotplot-view/src/DotplotRenderer/ComparativeRenderRpc.ts","../../../plugins/dotplot-view/src/DotplotView/components/ImportForm.tsx","../../../plugins/dotplot-view/src/DotplotView/components/Controls.tsx","../../../plugins/dotplot-view/src/DotplotView/components/DotplotView.tsx","../../../plugins/dotplot-view/src/DotplotView/index.ts","../../../plugins/dotplot-view/src/index.ts","../../../plugins/filtering/src/LinearFilteringDisplay/model.js","../../../plugins/filtering/src/LinearFilteringDisplay/components/FilterControls.js","../../../plugins/filtering/src/LinearFilteringDisplay/components/LinearFilteringDisplay.js","../../../plugins/filtering/src/index.ts","../../../plugins/filtering/src/LinearFilteringDisplay/index.js","../../../plugins/gff3/src/Gff3TabixAdapter/Gff3TabixAdapter.ts","../../../plugins/gff3/src/Gff3TabixAdapter/configSchema.ts","../../../plugins/gff3/src/index.ts","../../../plugins/legacy-jbrowse/src/NCListAdapter/NCListFeature.ts","../../../plugins/legacy-jbrowse/src/NCListAdapter/NCListAdapter.ts","../../../plugins/legacy-jbrowse/src/NCListAdapter/configSchema.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/configSchema.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/jb1ConfigParse.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/jb1ConfigLoad.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/jb1ToJb2.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/model.js","../../../plugins/legacy-jbrowse/src/index.ts","../../../plugins/linear-comparative-view/src/ServerSideRenderedContent.js","../../../plugins/linear-comparative-view/src/ServerSideRenderedBlockContent.tsx","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/components/LinearComparativeDisplay.tsx","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/index.ts","../../../plugins/linear-comparative-view/src/LinearComparativeView/components/Header.tsx","../../../plugins/linear-comparative-view/src/LinearComparativeView/components/LinearComparativeView.tsx","../../../plugins/linear-comparative-view/src/LinearComparativeView/model.ts","../../../plugins/linear-comparative-view/src/LinearComparativeView/index.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyDisplay/index.ts","../../../plugins/linear-comparative-view/src/util.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyRenderer/components/LinearSyntenyRendering.tsx","../../../plugins/linear-comparative-view/src/LinearSyntenyRenderer/configSchema.js","../../../plugins/linear-comparative-view/src/LinearSyntenyRenderer/LinearSyntenyRenderer.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyView/components/ImportForm.tsx","../../../plugins/linear-comparative-view/src/LinearSyntenyView/components/LinearSyntenyView.tsx","../../../plugins/linear-comparative-view/src/LinearSyntenyView/model.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyView/index.ts","../../../plugins/linear-comparative-view/src/MCScanAnchorsAdapter/MCScanAnchorsAdapter.ts","../../../plugins/linear-comparative-view/src/MCScanAnchorsAdapter/configSchema.ts","../../../plugins/linear-comparative-view/src/index.ts","../../../plugins/lollipop/src/LinearLollipopDisplay/model.ts","../../../plugins/lollipop/src/LollipopRenderer/components/Lollipop.js","../../../plugins/lollipop/src/LollipopRenderer/components/Stick.js","../../../plugins/lollipop/src/LollipopRenderer/components/LollipopRendering.js","../../../plugins/lollipop/src/LollipopRenderer/configSchema.ts","../../../plugins/lollipop/src/LollipopRenderer/Layout.ts","../../../plugins/lollipop/src/LollipopRenderer/LollipopRenderer.js","../../../plugins/lollipop/src/index.ts","../../../plugins/lollipop/src/LinearLollipopDisplay/configSchema.ts","../../../plugins/menus/src/AboutWidget/components/AboutWidget.tsx","../../../plugins/menus/src/AboutWidget/index.js","../../../plugins/menus/src/HelpWidget/components/HelpWidget.tsx","../../../plugins/menus/src/HelpWidget/index.js","../../../plugins/menus/src/ImportConfigurationWidget/components/ImportConfigurationWidget.js","../../../plugins/menus/src/ImportConfigurationWidget/index.js","../../../plugins/menus/src/SessionManager/components/SessionManager.js","../../../plugins/menus/src/SessionManager/index.js","../../../plugins/menus/src/index.ts","../../../plugins/rdf/src/SPARQLAdapter/SPARQLAdapter.ts","../../../plugins/rdf/src/SPARQLAdapter/configSchema.ts","../../../plugins/rdf/src/index.ts","../../../plugins/sequence/src/IndexedFastaAdapter/IndexedFastaAdapter.ts","../../../plugins/sequence/src/BgzipFastaAdapter/BgzipFastaAdapter.ts","../../../plugins/sequence/src/BgzipFastaAdapter/configSchema.ts","../../../plugins/sequence/src/ChromSizesAdapter/ChromSizesAdapter.ts","../../../plugins/sequence/src/ChromSizesAdapter/configSchema.ts","../../../plugins/sequence/src/DivSequenceRenderer/components/DivSequenceRendering.tsx","../../../plugins/sequence/src/DivSequenceRenderer/configSchema.ts","../../../plugins/sequence/src/IndexedFastaAdapter/configSchema.ts","../../../plugins/sequence/src/LinearReferenceSequenceDisplay/configSchema.ts","../../../plugins/sequence/src/TwoBitAdapter/TwoBitAdapter.ts","../../../plugins/sequence/src/TwoBitAdapter/configSchema.ts","../../../plugins/sequence/src/index.ts","../../../plugins/sequence/src/referenceSeqTrackConfig.ts","../../../plugins/sequence/src/LinearReferenceSequenceDisplay/model.ts","../../../packages/core/util/layouts/SceneGraph.ts","../../../plugins/svg/src/SvgFeatureRenderer/components/FeatureLabel.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/FeatureGlyph.js","../../../plugins/svg/src/SvgFeatureRenderer/components/SvgOverlay.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Box.js","../../../plugins/svg/src/SvgFeatureRenderer/components/Chevron.js","../../../plugins/svg/src/SvgFeatureRenderer/components/Segments.js","../../../plugins/svg/src/SvgFeatureRenderer/components/ProcessedTranscript.js","../../../plugins/svg/src/SvgFeatureRenderer/components/Subfeatures.js","../../../plugins/svg/src/SvgFeatureRenderer/components/util.ts","../../../plugins/svg/src/SvgFeatureRenderer/components/SvgFeatureRendering.js","../../../plugins/svg/src/SvgFeatureRenderer/configSchema.ts","../../../plugins/svg/src/index.ts","../../../plugins/trackhub-registry/src/trackhub-registry/configSchema.js","../../../plugins/trackhub-registry/src/trackhub-registry/tracks.js","../../../plugins/trackhub-registry/src/trackhub-registry/model.js","../../../plugins/trackhub-registry/src/trackhub-registry/HubDetails.js","../../../plugins/trackhub-registry/src/trackhub-registry/SelectBox.js","../../../plugins/trackhub-registry/src/trackhub-registry/TrackHubRegistrySelect.js","../../../plugins/trackhub-registry/src/index.ts","../../../plugins/variants/src/ChordVariantDisplay/models/ChordVariantDisplay.js","../../../plugins/variants/src/ChordVariantDisplay/index.ts","../../../plugins/variants/src/LinearVariantDisplay/model.ts","../../../plugins/variants/src/StructuralVariantChordRenderer/ReactComponent.js","../../../plugins/variants/src/StructuralVariantChordRenderer/index.js","../../../plugins/variants/src/VariantFeatureWidget/VariantFeatureWidget.js","../../../plugins/variants/src/VariantFeatureWidget/index.js","../../../plugins/variants/src/VcfTabixAdapter/VcfFeature.ts","../../../plugins/variants/src/VcfTabixAdapter/VcfTabixAdapter.ts","../../../plugins/variants/src/VcfTabixAdapter/configSchema.ts","../../../plugins/variants/src/index.ts","../../../plugins/variants/src/LinearVariantDisplay/configSchema.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/components/ImportWizard.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/components/ColumnMenu.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/components/RowMenu.tsx","../../../plugins/spreadsheet-view/src/SpreadsheetView/components/Spreadsheet.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/components/GlobalFilterControls.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/components/ColumnFilterControls.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/components/SpreadsheetView.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/MakeSpreadsheetColumnType.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocString.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/Text.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocRef.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/Number.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocStart.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocEnd.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/index.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/Row.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/StaticRowSet.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/Spreadsheet.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/importAdapters/ImportUtils.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/importAdapters/VcfImport.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/importAdapters/BedImport.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/importAdapters/STARFusionImport.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ImportWizard.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/FilterControls.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/SpreadsheetView.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/SpreadsheetViewType.ts","../../../plugins/spreadsheet-view/src/index.ts","../../../plugins/sv-inspector/src/SvInspectorView/components/SvInspectorView.js","../../../plugins/sv-inspector/src/SvInspectorView/models/adhocFeatureUtils.js","../../../plugins/sv-inspector/src/SvInspectorView/models/breakpointSplitViewFromTableRow.js","../../../plugins/sv-inspector/src/SvInspectorView/models/SvInspectorView.js","../../../plugins/sv-inspector/src/SvInspectorView/SvInspectorViewType.js","../../../plugins/sv-inspector/src/index.ts","../../../plugins/hic/src/HicAdapter/configSchema.ts","../../../plugins/hic/src/HicAdapter/index.ts","../../../plugins/hic/src/HicRenderer/components/HicRendering.tsx","../../../plugins/hic/src/HicRenderer/configSchema.ts","../../../plugins/hic/src/HicRenderer/HicRenderer.ts","../../../plugins/hic/src/LinearHicDisplay/configSchema.ts","../../../plugins/hic/src/LinearHicDisplay/model.ts","corePlugins.ts","../../../plugins/hic/src/index.ts","ShareButton.tsx","JBrowse.js","../../../packages/core/assemblyManager/assembly.ts","../../../packages/core/assemblyManager/assemblyManager.ts","../../../packages/core/assemblyManager/assemblyConfigSchemas.ts","../../../packages/core/rpc/configSchema.ts","../../../packages/core/rpc/BaseRpcDriver.ts","../../../packages/core/rpc/WebWorkerRpcDriver.ts","../../../packages/core/rpc/MainThreadRpcDriver.ts","../../../packages/core/rpc/ElectronRpcDriver.ts","../../../packages/core/rpc/RpcManager.ts","jbrowseModel.js","sessionModelFactory.ts","rootModel.ts","factoryReset.ts","RecentSessionCard.js","StartScreen.tsx","Loader.tsx","../../../packages/core/util/mst-reflection.js","../../../packages/core/configuration/configurationSlot.ts","../../../packages/core/configuration/configurationSchema.ts","../../../packages/core/util/types/index.ts","../../../packages/core/util/functionStrings.ts","../../../packages/core/util/aborting.ts","../../../packages/core/configuration/util.ts","../../../packages/core/configuration/index.ts","../../../packages/core/util/index.ts","../../../packages/core/util/when.ts","../../../packages/core/util/io/ElectronLocalFile.ts"],"names":["ElementId","types","optional","identifier","shortid","generate","PropTypes","Region","propTypes","shape","refName","string","isRequired","start","number","end","ConfigSchema","MxPropTypes","objectOrObservableObject","Feature","get","func","id","NoAssemblyRegion","model","reversed","boolean","actions","self","setRefName","newRefName","compose","assemblyName","LocalPathLocation","localPath","UriLocationRaw","uri","baseUri","maybe","UriLocation","snapshotProcessor","postProcessor","snap","rest","FileLocation","union","isTrack","arg","label","isSource","url","deepUpdate","a","b","Object","keys","prop","objectFingerprint","obj","objectHash","fillTemplate","template","fillWith","replace","match","varName","fill","getValue","undefined","callback","v","call","clone","src","prototype","toString","nodeType","cloneNode","Date","getTime","RegExp","r","i","l","Array","isArray","length","constructor","mixin","dest","source","copyFunc","name","s","empty","evalHooks","conf","x","spec","test","evalHook","eval","e","console","error","getfetch","opts","fetch","method","credentials","options","requestDate","requestHeaders","headers","range","res","responseDate","status","Error","entries","k","arrayBuffer","buffer","Buffer","from","globalRangeCache","HttpRangeFetcher","size","chunkSize","maxFetchSize","minimumTTL","globalCacheFetch","Headers","find","rangeParse","exec","parseInt","getRange","signal","response","Response","isElectron","navigator","userAgent","openUrl","ElectronRemoteFile","RemoteFile","String","isUriLocation","location","isLocalPathLocation","openLocation","ElectronLocalFile","URL","href","LocalFile","isBlobLocation","BlobFile","blob","BaseFeatureDataAdapter","args","jest","data","isStateTreeNode","getSnapshot","this","ignoreUnknown","slice","_","region","ObservableCreate","observer","hasDataForRefName","hasData","checkAbortSignal","getFeatures","pipe","takeUntil","observeAbortSignal","subscribe","complete","regions","obs","merge","map","getRefNames","refNames","includes","isRegionsAdapter","thing","isRefNameAliasAdapter","Observable","create","ret","catch","module","exports","electron","window","ElectronRemoteFileError","ipcRenderer","_stat","baseOverrides","nodeFetchFallback","nodeFetch","input","init","invoke","serializedResponse","statusText","startsWith","path","uri2path","TypeError","localFile","read","bind","readFile","stat","fetcharg","overrides","resp","myfetch","requestOptions","redirect","mode","isAbortException","warn","getFetch","contentRange","sizeMatch","contentLength","offset","position","Infinity","getBufferFromResponse","responseData","bytesCopied","copy","Math","min","bytesRead","encoding","err","text","headFetch","allocUnsafe","GenericFilehandleWrapper","filehandle","HicAdapter","config","hic","hicLocation","readConfObject","HicStraw","file","getMetaData","metadata","chromosomes","chr","bpPerPx","resolutions","chosenResolution","getResolution","getContactRecords","forEach","record","next","Worker","PluggableElementBase","RendererType","stuff","ReactComponent","configSchema","getDefaultValue","type","props","element","React","createElement","AdapterType","AdapterClass","TrackType","stateModel","displayTypes","display","push","DisplayType","trackType","viewType","ViewType","WidgetType","heading","HeadingComponent","ConnectionType","displayName","description","configEditorComponent","abortSignalCounter","abortSignalIds","WeakMap","surrogateAbortControllers","Map","deserializeAbortSignal","abortSignalId","surrogateAbortController","AbortController","set","RpcMethodType","pluginManager","serializedArgs","_serializedArgs","originalReturn","serializedReturn","full","tag","join","SanitizedHTML","str","html","value","escapeHTML","dangerouslySetInnerHTML","__html","dompurify","sanitize","useStyles","makeStyles","theme","expansionPanelDetails","padding","spacing","expandIcon","color","paperRoot","background","palette","grey","field","fieldName","wordBreak","minWidth","maxWidth","borderBottom","backgroundColor","marginRight","fieldValue","maxHeight","overflow","fieldSubvalue","border","boxSizing","coreRenderedDetails","BaseCard","classes","children","title","Accordion","style","marginTop","defaultExpanded","AccordionSummary","className","variant","AccordionDetails","BaseCoreDetails","feature","strand","strandMap","strandStr","displayedDetails","key","toLowerCase","strValue","omit","Attributes","attributes","propOmit","formatter","isObject","JSON","stringify","descriptions","SimpleValue","placement","ArrayValue","val","filter","BaseAttributes","BaseFeatureDetails","feat","parse","featureData","Paper","Divider","intersection2","left1","right1","left2","right2","doesIntersect2","isContainedWithin","BlockSet","blocks","block","ElidedBlock","lastBlock","toRegion","thisarg","widthPx","reduce","offsetPx","ContentBlock","contentBlocks","BaseBlock","assign","otherBlock","elidedBlockCount","InterRegionPaddingBlock","calculateDynamicBlocks","elision","displayedRegions","width","minimumBlockWidth","interRegionPaddingWidth","displayedRegionLeftPx","windowLeftPx","windowRightPx","regionNumber","regionStart","regionEnd","displayedRegionRightPx","regionWidthPx","isLeftEndOfDisplayedRegion","isRightEndOfDisplayedRegion","blockOffsetPx","leftPx","rightPx","max","blockData","parentRegion","assembleLocString","calculateStaticBlocks","extra","innerWidth","windowLeftBp","windowRightBp","blockSizePx","blockSizeBp","ceil","regionBpOffset","regionBlockCount","windowRightBlockNum","floor","windowLeftBlockNum","blockNum","Base1DView","array","volatile","features","volatileWidth","setDisplayedRegions","cast","setBpPerPx","setVolatileWidth","views","totalBp","displayedRegionsTotalPx","bpToPx","coord","offsetBp","index","findIndex","idx","round","pxToBp","px","bpSoFar","bp","n","oob","len","dynamicBlocks","setFeatures","showAllRegions","moveTo","zoomTo","bpToStart","zoomOut","zoomIn","newBpPerPx","oldBpPerPx","clamp","minOffset","maxOffset","scroll","distance","oldOffsetPx","newOffsetPx","ConfigurationSchema","defaultValue","explicitlyTyped","explicitIdentifier","tracks","afterAttach","addTrackConf","setTrackConfs","clear","BaseViewModel","setDisplayName","setWidth","newWidth","getTrackAssemblyNames","track","trackConf","configuration","trackAssemblyNames","parent","getParent","getRpcSessionId","thisNode","highestRpcSessionId","node","isRoot","rpcSessionId","getParentRenderProps","currentNode","renderProps","UNKNOWN","UNSUPPORTED","guessAdapter","fileName","protocol","makeLocation","bamLocation","indexType","toUpperCase","endsWith","cramLocation","craiLocation","gffGzLocation","vcfGzLocation","bedGzLocation","bigBedLocation","bigWigLocation","fastaLocation","faiLocation","gziLocation","twoBitLocation","rootUrlTemplate","endpoint","pafLocation","guessTrackType","adapterType","BamAdapter","CramAdapter","BgzipFastaAdapter","BigWigAdapter","IndexedFastaAdapter","TwoBitAdapter","VcfTabixAdapter","PAFAdapter","generateUnsupportedTrackConf","trackName","trackUrl","categories","category","trackId","generateUnknownTrackConf","BaseDisplay","rendererTypeName","getSession","getDisplayType","getConf","parentTrack","displayModel","getRendererType","regionCannotBeRendered","setError","reload","createBaseTrackModel","baseTrackConfig","literal","ConfigurationReference","displays","pluggableMstType","showAbout","setShowAbout","show","adapterConfig","session","getAdapterType","menuItems","viewMenuActions","isSessionModelWithConfigEditing","adminMode","sessionTracks","activateConfigurationUI","view","getContainingView","editTrackConfiguration","hideTrack","showTrack","showDisplay","displayId","initialSnapshot","displayTypeConfigSchema","pluggableConfigSchemaType","resolveIdentifier","getRoot","displayType","hideDisplay","shownDisplays","d","transaction","remove","replaceDisplay","oldDisplayId","newDisplayId","displayIdx","splice","trackMenuItems","displayChoices","compatibleDisplayTypes","getViewType","compatibleDisplays","displayConf","shownId","onClick","checked","icon","InfoIcon","priority","createBaseTrackConfig","assemblyNames","adapter","preProcessSnapshot","Set","add","getTrackType","has","addDisplayConf","isFeature","isSimpleFeatureSerialized","SimpleFeature","parentHandle","uniqueId","aliases","subfeatures","p","parentId","c","child","toJSON","json","SerializableFilterChain","filters","filterChain","inputFilter","stringToFunction","apply","f","refTheme","createMuiTheme","jbrowseDefaultPalette","primary","main","secondary","tertiary","augmentColor","quaternary","stopCodon","startCodon","bases","A","green","C","blue","G","amber","T","red","createJBrowseDefaultProps","MuiButton","MuiFilledInput","margin","MuiFormControl","MuiFormHelperText","MuiIconButton","MuiInputBase","MuiList","dense","MuiListItem","MuiOutlinedInput","MuiFab","MuiTable","MuiTextField","MuiToolbar","MuiSvgIcon","fontSize","MuiToggleButtonGroup","MuiCheckbox","MuiLink","underline","createJBrowseDefaultOverrides","generatedPalette","deepmerge","colorSecondary","textSecondary","root","MuiAccordionSummary","minHeight","contrastText","content","expanded","MuiMenuItem","paddingTop","paddingBottom","MuiListItemIcon","MuiListItemText","inset","paddingLeft","jbrowseBaseTheme","typography","createJBrowseTheme","getColors","midnight","forrest","grape","mandarin","gray","Logomark","viewBox","LogoFull","Icon","colors","Text","aria-label","transform","horizontalHandle","cursor","verticalHandle","height","flexbox_verticalHandle","alignSelf","flexbox_horizontalHandle","ResizeHandle","onDrag","vertical","flexbox","originalClassName","useState","mouseDragging","setMouseDragging","prevPos","useRef","useEffect","mouseMove","event","preventDefault","current","actualDistance","mouseUp","addEventListener","removeEventListener","data-resizer","onMouseDown","pos","role","clsx","paper","overflowY","zIndex","outline","default","resizeHandle","top","Drawer","open","in","direction","elevation","square","defaultDrawer","components","drawerCloseButton","float","fade","drawerToolbar","drawerToolbarCloseButton","flexGrow","drawerLoading","visibleWidget","Boolean","disableGutters","data-testid","overflowX","left","menuItemEndDecoration","right","MenuItemEndDecoration","disabled","MenuPage","forwardRef","ref","subMenuAnchorEl","setSubMenuAnchorEl","openSubMenuIdx","setOpenSubMenuIdx","isSubMenuOpen","setIsSubMenuOpen","selectedMenuItemIdx","setSelectedMenuItemIdx","setPosition","paperRef","onMenuItemClick","onClose","anchorEl","timer","shouldSubMenuBeOpen","setTimeout","clearTimeout","rect","getBoundingClientRect","hasEndDecoration","some","menuItem","hasIcon","menuItemStyle","paddingRight","ListContents","MenuList","autoFocusItem","sort","component","ListSubheader","endDecoration","ListItemIcon","selected","onMouseMove","currentTarget","document","activeElement","focus","onKeyDown","currentIdx","findLastIndex","findPreviousValidIdx","findNextValidIdx","ListItemText","subLabel","subMenu","Grow","transformOrigin","Menu","other","Popover","BackdropProps","invisible","buttonRoot","action","hoverOpacity","menuTitle","setOpen","handleClose","anchorOrigin","horizontal","_event","inputBase","whiteSpace","visibility","inputRoot","inputFocused","borderStyle","borderRadius","borderWidth","EditableTypography","setValue","editedValue","setEditedValue","sizerNode","setSizerNode","inputNode","setInputNode","blur","setBlur","useTheme","clientWidth","InputBase","inputRef","inputProps","focused","onChange","target","onBlur","snackbarMessage","setSnackbarMessage","popSnackbarMessage","snackbarMessages","latestMessage","timeoutId","reason","message","level","Snackbar","Alert","severity","viewContainer","grow","iconRoot","listItemIconRoot","listItemInset","menuItemDense","secondaryActionRoot","light","borderColor","ViewMenu","IconButtonProps","IconProps","setAnchorEl","aria-controls","aria-haspopup","withContentRect","contentRect","measureRef","padWidth","bounds","isAlive","scrollRef","scrollIntoView","edge","arrow","menuBarAndComponents","gridColumn","gridTemplateRows","menuBar","gridRow","appBar","HeaderButtons","drawerWidth","gridTemplateColumns","menu","FileLocationEditor","localFileAllowed","fileOrUrl","fileOrUrlState","setFileOrUrlState","InputLabel","shrink","htmlFor","container","alignItems","item","ToggleButtonGroup","exclusive","newValue","ToggleButton","LocalFileChooser","FormHelperText","UrlChooser","setLocation","fullWidth","filename","opacity","files","marginLeft","weHave","OffscreenCanvas","PonyfillOffscreenContext","currentFont","PonyfillOffscreenCanvas","createCanvas","canvas","createImageBitmap","dataURL","ImageBitmapType","require","nodeCreateCanvas","Image","dataUri","img","Promise","resolve","PrerenderedCanvas","highResolutionScaling","imageData","showSoftClip","featureCanvas","context","getContext","commands","command","strokeStyle","fillStyle","font","drawImage","onload","softClipString","defaultProps","card","textAlign","media","NewSessionCard","image","hovered","setHovered","onMouseOver","onMouseOut","raised","emptySessionSnapshot","connections","NewEmptySession","emptyIcon","ProceedEmptySession","snapshot","AddLinearGenomeViewToSession","linearGenomeViewIcon","NewLinearGenomeViewSession","NewSVInspectorSession","svInspectorIcon","AddSVInspectorToSession","cardHeader","RecentSessionCard","sessionName","sessionStats","sessionScreenshot","onDelete","onRename","menuAnchorEl","setMenuAnchorEl","handleMenuClose","disableTypography","enterDelay","noWrap","subheader","dateStyle","keepMounted","onFactoryReset","handleDialogClose","Dialog","DialogTitle","DialogContent","DialogContentText","DialogActions","blankIpc","newSession","header","settings","DeleteSessionDialog","sessionToDelete","electronBetterIpc","deleteSession","setDeleteSession","autoFocus","RenameSessionDialog","sessionNames","sessionToRename","newSessionName","setNewSessionName","renameSession","setRenameSession","Input","StartScreen","bypass","sessions","setSessions","setSessionToDelete","setSessionToRename","sessionToLoad","setSessionToLoad","updateSessionsList","setUpdateSessionsList","reset","setReset","setSavedSessionNames","sortedSessions","stats","mtimeMs","load","inDevelopment","activateSession","FactoryResetDialog","update","stopPropagation","sessionData","screenshot","CircularProgress","hoverLabel","pointerEvents","Tooltip","offsetX","offsetY","timeout","shown","setShown","handle","ResetComponent","resetButtonText","dialogOpen","setDialogOpen","FatalErrorDialog","componentStack","ServerSideRenderer","blockKey","selectedFeatureId","result","deserialized","featuresMap","j","fromJSON","_args","serialized","iterMap","values","rpcManager","serializeArgsInClient","sessionId","deserializeResultsInClient","_renderArgs","renderArgs","dataAdapter","requestRegions","requestRegion","featureObservable","getExpandedRegion","getFeaturesInMultipleRegions","tap","featurePassesFilters","ignoreElements","toPromise","passes","statusCallback","deserializedArgs","deserializeArgsInWorker","render","results","renderToString","ThemeProvider","serializeResultsInWorker","CircularChordRendererType","segmentsIntersect","x1","x2","y1","y2","LayoutRow","allFilled","widthLimit","rowState","bits","maxX","getItemAt","rectWidth","initialize","oLeft","oRight","currLength","additionalLength","concat","leftTrimAmount","rightTrimAmount","trimAmount","minSizeToBotherWith","desiredLength","GranularRectLayout","pitchX","pitchY","hardRowLimit","displayMode","bitmap","rectangles","maxHeightReached","pTotalHeight","storedRec","addRectToBitmap","pLeft","pRight","pHeight","rectangle","h","originalHeight","maxTop","collides","maxY","y","row","isRangeClear","yEnd","autovivifyRow","setAllFilled","addRect","discardRange","pY","pX","t","regionRectangles","totalHeight","getTotalHeight","objectFromEntries","getRectangles","MultiLayout","SubLayoutClass","layoutArgs","subLayouts","subLayoutConstructorArgs","layoutName","subLayout","getSublayout","layout","sublayout","PrecomputedLayout","_rect","_top","_data","_left","_right","_region","LayoutSession","cachedLayout","isConfigurationModel","deepEqual","cachedLayoutIsValid","makeLayout","BoxRendererType","createSession","maxFeatureGlyphExpansion","bpExpansion","deserializeLayoutInClient","getWorkerSession","deserializeLayoutInWorker","serializeRegion","ServerSideRendererType","Plugin","_pluginManager","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","namedColorToHex","isNamedColor","contrastingTextColor","getLuminance","convertedColor","muiGetLuminance","emphasize","coefficient","muiEmphasize","makeContrasting","foreground","minContrastRatio","convertedForeground","convertedBackground","backgroundLuminance","contrastRatio","getContrastRatio","originalColor","darken","lighten","libs","mobx","mst","react","ReactDom","mxreact","MUICore","MUILab","MUIColors","MUIStyles","MUIBox","MUIButton","MUIButtonGroup","MUICard","MUICardContent","MUIContainer","MUICheckbox","MUIDialog","MUIFormGroup","MUIFormLabel","MUIFormControl","MUIFormControlLabel","MUIGrid","MUIIcon","MUIIconButton","MUIInputAdornment","MUILinearProgress","MUIListItemIcon","MUIListItemText","MUIMenu","MUIMenuItem","MUIRadioGroup","MUIRadio","MUISelect","MUISnackbar","MUISnackbarContent","MUITextField","MUITooltip","MUITypography","pluggableElementTypeModels","Configuration","mstTypes","coreUi","coreUtil","coreColor","trackUtils","coreIo","coreMstReflection","BaseFeatureDetail","BaseAdapterExports","modules","adapterCache","getAdapter","adapterConfigSnapshot","cacheKey","jsonStableStringify","adapterConfigCacheKey","dataAdapterType","getSubAdapter","sessionIds","cacheEntry","freeAdapterResources","specification","deleteCount","specKeys","delete","freeResources","CoreGetRefNames","deserializeArguments","CoreGetFileInfo","getHeader","CoreFreeResources","getRendererTypes","renderer","count","CoreRender","assemblyManager","rootModel","renameRegionsIfNeeded","rendererType","validateRendererType","renderInWorker","CorePlugin","coreRpcMethods","RpcMethod","addRpcMethod","PhasedScheduler","phaseCallbacks","phaseOrder","phase","phaseName","TypeRecord","typeName","elementType","registeredTypes","baseClass","PluginManager","initialPlugins","plugins","elementCreationSchedule","rendererTypes","adapterTypes","trackTypes","connectionTypes","viewTypes","widgetTypes","rpcMethods","configured","jbrequireCache","lib","ReExports","jbrequire","pack","addPlugin","plugin","install","getPlugin","run","configure","groupName","creationCallback","typeRecord","getElementTypeRecord","newElement","all","typeGroup","fallback","null","pluggableTypes","isType","isModelType","isBareConfigurationSchemaType","methodName","addElementType","getElementTypesInGroup","addDisplayType","newView","PluginLoader","pluginDefinitions","definitions","scriptUrl","getElementsByTagName","domLoadScript","importScripts","reject","definition","parsedUrl","loadScript","moduleName","umdName","JBrowseExports","loadPlugin","initialTimeStamp","sessionQuery","multiAssemblyTracks","jbrowse","ver","version","assemblies","localStorage","split","screen","innerHeight","loadTime","now","jb2","qs","analyticsScript","gaData","metric1","analyticsScriptNode","innerHTML","appendChild","generateUID","Uint8Array","encrypt","AES","decrypt","bytes","sess","toUrlSafeB64","password","encryptedSession","body","sessionQueryParam","frozen","setFeatureData","clearFeatureData","baseLinearDisplayConfigSchema","mouseover","functionSignature","maxDisplayedBpPerPx","Number","MAX_VALUE","Symbol","iterator","CompositeMap","submaps","submap","contentBlock","elidedBlock","backgroundImage","interRegionPaddingBlock","boundaryPaddingBlock","disabledBackground","boundary","linearBlocks","heightOverflowed","textShadow","fontWeight","RenderedBlocks","blockDefinitions","blockState","state","viewModel","mouseCoord","featureUnderMouse","BaseLinearDisplay","setMouseCoord","contextCoord","setContextCoord","TooltipComponent","DisplayMessageComponent","contextMenuItems","setContextMenuFeature","onContextMenu","clientX","clientY","onExit","anchorReference","anchorPosition","tooltip","ssrContainerNode","hydrated","domNode","isHydrated","filled","RenderingComponent","renderingComponent","unmountComponentAtNode","requestIdleCallback","serializedRegion","hydrate","doHydrate","data-html-size","loading","blockMessage","blockError","blockReactNodeMessage","dots","animation","Repeater","LoadingMessage","blockStatus","BlockMessage","messageContent","BlockError","displayHeight","errorMessage","startIcon","ServerSideRenderedBlockContent","renderInProgress","makeAbortableReaction","renderBlockData","renderBlockEffect","delay","renderDelay","fireImmediately","setLoading","setRendered","setStatus","abortController","aborted","abort","setMessage","messageText","beforeDestroy","freeResourcesInClient","cannotBeRenderedReason","matchFound","assembly","displayError","notReady","renderInClient","refinement","BlockState","featureIdUnderMouse","contextMenuFeature","additionalContextMenuItemCallbacks","scrollTop","userBpPerPxLimit","blockType","initialized","selection","stale","rbush","featureMaps","layoutMaps","blockLayoutFeatures","layoutFeatures","RBush","insert","minX","minY","getFeatureOverlapping","rtree","search","blockWatchDisposer","autorun","blocksPresent","addBlock","deleteBlock","addDisposer","setHeight","resizeHeight","oldHeight","setScrollTop","setUserBpPerPxLimit","limit","selectFeature","isSessionModelWithWidgets","featureWidget","addWidget","showWidget","isSelectionContainer","setSelection","clearFeatureSelection","clearSelection","setFeatureIdUnderMouse","temp","addAdditionalContextMenuItemCallback","maxViewBpPerPx","MenuOpenIcon","onFeatureClick","featureId","onFeatureContextMenu","onMouseLeave","composedRenderProps","postProcessSnapshot","configSchemaFactory","baseConfiguration","stateModelFactory","ContentCopy","SvgIcon","TrackSelector","renderRow","cloneElement","OuterElementContext","createContext","OuterElementType","outerProps","useContext","ListboxComponent","itemData","Children","toArray","itemCount","getChildSize","isValidElement","Provider","outerElementType","innerElementType","itemSize","overscanCount","onSelect","TextFieldProps","Autocomplete","disableListWrap","disableClearable","newRegionName","newRegion","renderInput","params","helperText","InputProps","TextFieldInputProps","endAdornment","renderOption","regionName","chooseGridPitch","scale","minMajorPitchPx","minMinorPitchPx","minMajorPitchBp","abs","majorMagnitude","toExponential","majorPitch","majorPitchPx","minorPitch","makeTicks","emitMajor","emitMinor","gridPitch","minBase","maxBase","iterPitch","ticks","base","rubberBand","rubberBandControl","rubberBandText","popover","mouseEvents","guide","OverviewRubberBand","overview","ControlComponent","startX","setStartX","currentX","setCurrentX","guideX","setGuideX","controlsRef","rubberBandRef","mouseDown","mouseOut","globalMouseMove","relativeX","globalMouseUp","zoomToDisplayedRegions","clickedAt","centerAt","globalKeyDown","leftBpOffset","rightBpOffset","disableRestoreFocus","HEADER_OVERVIEW_HEIGHT","scaleBarColor","scaleBar","scaleBarContig","borderBottomColor","scaleBarContigForward","backgroundRepeat","scaleBarContigReverse","scaleBarRegionIncompleteLeft","backgroundSize","borderTopLeftRadius","borderBottomLeftRadius","scaleBarRegionIncompleteRight","borderTopRightRadius","borderBottomRightRadius","scaleBarRefName","lineHeight","scaleBarLabel","justifyContent","scaleBarVisibleRegion","HEADER_BAR_HEIGHT","overviewSvg","Polygon","getBlocks","bottomLeft","newTopLeft","polygonColor","points","startPx","endPx","topLeft","topRight","stroke","ScaleBar","visibleRegions","seq","refNameColor","getRefNameColor","regionLength","incompleteRegion","numLabels","tickLabels","offsetLabel","toLocaleString","visibleRegionIdx","leftStyle","tickLabel","labelIdx","LinearProgress","flexDirection","slider","maxBpPerPx","minBpPerPx","scaleFactor","log2","zoom","Slider","onChangeCommitted","headerBar","spacer","headerRefName","panButton","toggleButton","buttonSpacer","Controls","activateTrackSelector","Search","coarseVisibleLocStrings","nonCoarseVisibleLocStrings","visibleLocStrings","onSubmit","locString","navToLocString","notify","navTo","onFocus","SPACING","startAdornment","PanControls","slide","coarseDynamicBlocks","setDisplayedRegion","useCallback","controls","flexWrap","RegionWidth","hideHeaderOverview","coarseTotalBp","transition","transitions","duration","shortest","dragHandle","dragHandleIcon","verticalAlign","iconButton","TrackLabel","sequence","draggable","onDragStart","parentNode","dataTransfer","setDragImage","setDraggingTrackId","onDragEnd","getTrackActionMenuItems","RESIZE_HANDLE_HEIGHT","overlay","renderingComponentContainer","trackLabel","trackLabelInline","trackLabelOverlap","trackRenderingContainer","horizontalScroll","draggingTrackId","moveTrack","trackRefs","debouncedOnDragEnter","useDebouncedCallback","DisplayBlurb","dimmed","trackLabels","onScroll","onDragEnter","onHorizontalScroll","VerticalGuide","coordX","RubberBand","setAnchorPosition","ZoomInIcon","leftOffset","rightOffset","zoomToRegion","numOfBpSelected","scaleBarContainer","scaleBarZoomContainer","majorTickLabel","tick","refLabel","RenderedRefNameLabels","lastLeftBlock","staticBlocks","RenderedScaleBarLabels","baseNumber","offsetLeft","totalWidthPx","verticalGuidesZoomContainer","verticalGuidesContainer","majorTick","hint","minorTick","divider","RenderedVerticalGuides","centerLineContainer","borderTop","centerLineText","centerLineInfo","trackHeights","startingPosition","tracksContainer","delta","scheduled","prevX","cleanup","requestAnimationFrame","curr","onWheel","origEvent","normalizeWheel","ctrlKey","pixelY","setScaleFactor","pixelX","dataset","resizer","button","onMouseUp","showCenterLine","SCALE_BAR_HEIGHT","importFormContainer","importFormEntry","ImportForm","selectedAssemblyIdx","setSelectedAssemblyIdx","selectedRegion","setSelectedRegion","done","waitForAssembly","justify","select","MiniControls","prepend","counts","accum","entry","hidden","currHidden","setCurrHidden","AboutDialog","info","setInfo","aborter","aria-labelledby","aria-describedby","LinearGenomeView","hideHeader","aboutTrack","calculateVisibleLocStrings","isSingleAssemblyName","every","MUIRegion","trackSelectorType","enumeration","afterDisplayedRegionsSetCallbacks","assembliesInitialized","assemblyList","asm","trackHeightsWithResizeHandles","headerHeight","scaleBarHeight","totalbp","wholeRefSeqs","wholeSequence","alreadyExists","displayedParentRegions","getTrack","rewriteOnClicks","holdOnClick","allActions","toggleHeader","toggleHeaderOverview","scrollTo","viewWidth","setNewView","horizontallyFlip","reverse","trackConfigSchema","supportedDisplays","shownTracks","movingTrackId","targetTrackId","oldIndex","newIndex","closeView","isViewContainer","removeView","toggleTrack","setTrackLabels","setting","toggleCenterLine","selector","isValidRefName","locStrings","locations","ls","parseLocString","navToMultiple","displayedRegion","parsedLocString","changedAssembly","newAssembly","canonicalRefName","getCanonicalRefName","newDisplayedRegion","query","firstLocation","refNameMatched","predicate","lastIndex","previousIndex","locationIndex","locationStart","locationEnd","startDisplayedRegion","endDisplayedRegion","startOffset","endOffset","afterDisplayedRegionsSet","cb","targetBpPerPx","extraBp","regionIndex","centerPx","center","centerBp","factor","cancelLastAnimation","viewWidths","springAnimate","animate","cancelAnimation","currentlyCalculatedStaticBlocks","stringifiedCurrentlyCalculatedStaticBlocks","TrackSelectorIcon","SyncAltIcon","VisibilityIcon","LabelIcon","trackTypeActions","sret","setCoarseDynamicBlocks","LinearGenomeViewPlugin","BaseLinearDisplayComponent","addTrackType","linearBasicDisplayConfigSchemaFactory","LinearBasicDisplayStateModelFactory","addViewType","linearGenomeViewStateModelFactory","LinearGenomeViewReactComponent","addWidgetType","baseFeatureWidgetConfigSchema","baseFeatureWidgetStateModel","BaseFeatureWidgetReactComponent","isAbstractMenuManager","appendToSubMenu","LineStyleIcon","addView","calcStdFromSums","sum","sumSquares","variance","population","sqrt","rectifyStats","scoreMean","scoreSum","featureCount","basesCovered","scoreStdDev","scoreSumSquares","featureDensity","scoresToStats","seed","score","scoreMax","scoreMin","MIN_VALUE","bigwig","BigWig","setup","refsByName","refId","refsByNumber","totalSummary","getRegionStats","feats","acc","getFeatureStream","basesPerSpan","mergeAll","getScale","domain","scaleType","pivotValue","inverted","scaleLinear","scaleLog","scaleQuantize","nice","rangeMin","rangeMax","getOrigin","posColor","negColor","highlightColor","clipColor","renderType","bicolorPivot","bicolorPivotValue","summaryScoreMode","ctx","draw","makeImageData","clientBp","colorCallback","colorScale","scaleOpts","pivot","featureSpanPx","w","fillRect","WiggleBaseRenderer","toP","parseFloat","toPrecision","popper","hoverVertical","TooltipContents","logb","log","pow","selectedRendering","ready","observable","statsFetchInProgress","updateStats","oldDomain","viewName","maxScore","minScore","getScaleType","getNiceDomain","autoscaleType","superReload","getStats","nd","cache","powersOfTen","YScaleBar","axisProps","axisPropsFromTickScale","format","orient","RIGHT","needsScalebar","XYPlotRenderer","originY","niceMin","niceMax","toY","rawscore","toHeight","maxr","minr","lowClipping","highClipping","Color","lastVal","WiggleGetGlobalStats","getGlobalStats","WiggleGetMultiRegionStats","getMultiRegionStats","XYPlotRendererConfigSchema","DensityRendererConfigSchema","LinePlotRendererConfigSchema","autoscale","numStdDev","defaultRendering","renderers","DensityRenderer","LinePlotRenderer","linearWiggleDisplayConfigSchemaFactory","linearWiggleDisplayModelFactory","LinearWiggleDisplayReactComponent","addAdapterType","bigWigAdapterConfigSchema","BigWigAdapterClass","addRendererType","DensityRendererReactComponent","densityRendererConfigSchema","LinePlotRendererReactComponent","linePlotRendererConfigSchema","XYPlotRendererReactComponent","xyPlotRendererConfigSchema","featureFlags","AlignmentFlags","flags","readOnly","Formatter","setShow","late","chunkSizeLimit","fetchSizeLimit","sequenceAdapter","parseCigar","cigar","cigarToMismatches","ops","currOffset","seqOffset","mismatches","op","cliplen","mdToMismatches","mdstring","cigarOps","cigarMismatches","mismatchRecords","skips","lastCigar","lastTemplateOffset","lastRefOffset","lastSkipPos","nextRecord","getTemplateCoordLocal","refCoord","templateOffset","refOffset","md","token","substring","mismatch","substr","altbase","getTemplateCoord","getMismatches","cigarString","mdString","seen","m","generateMD","queryOffset","targetOffset","lengthMD","tmp","BamSlightlyLazyFeature","isReverseComplemented","readGroupId","isPaired","getPairOrientation","_next_refid","_refID","refIdToName","_next_pos","_tags","getReadBases","properties","getOwnPropertyNames","_get_tags","seq_id","tags","fromEntries","elt","cigarAttributeName","mdAttributeName","bam","samHeader","BamFile","bamFilehandle","csiFilehandle","baiFilehandle","idToName","nameToId","sqLine","refSeqStore","seqChunks","trimmed","chunk","chunkStart","chunkEnd","trimStart","trimLength","chunkSeq","originalRefName","getRecordsForRange","records","seqFetch","CramSlightlyLazyFeature","store","_store","readName","alignmentStart","lengthOnRef","readFeatures","mappingQuality","qualityScores","q","sequenceId","_get_seq_id","mate","templateLength","templateSize","oplen","_refRegion","refStart","last_pos","sublen","code","refPos","sub","added","fromCharCode","readLength","_get_mismatches","cram","seqIdToRefName","seqIdToOriginalRefName","IndexedCramFile","cramFilehandle","CraiIndex","checkSequenceMD5","sequenceAdapterType","getSamHeader","seqId","refIdToOriginalName","indexOf","refNameToId","cramRecordToFeature","configSchemaF","AdapterF","htsgetBase","htsgetTrackId","HtsgetBamAdapter","HtsgetFile","baseUrl","configModelFactory","PileupRendererConfigSchema","SvgFeatureRendererConfigSchema","SNPCoverageRendererConfigSchema","headroom","PileupRenderer","SvgFeatureRenderer","SNPCoverageRenderer","PileupDisplay","SNPCoverageDisplay","showCoverage","showPileup","toggleCoverage","togglePileup","sortedBy","sortedByPosition","sortedByRefName","composedTrackMenuItems","snpCoverageDisplayConfig","setConfig","setSNPCoverageDisplay","pileupDisplayConfig","setPileupDisplay","displayConfig","PileupConfigFactory","showSoftClipping","currBpPerPx","setReady","flag","setCurrBpPerPx","clearSelected","copyFeatureToClipboard","copiedFeature","toggleSoftClipping","sortSelected","centerRefName","setSortedBy","ContentCopyIcon","LinearPileupDisplayBlurb","SortIcon","sortOptions","option","total","condId","strands","subadapter","highlightOverlayCanvas","mouseIsDown","setMouseIsDown","movedDuringLastMouseDown","setMovedDuringLastMouseDown","featIdUnderMouse","callMouseHandler","handlerName","featureHandler","canvasHandler","blockLayout","clearRect","leftBp","topPx","rightBp","bottomPx","bpSpanPx","rectTop","rectHeight","shadowColor","shadowBlur","lineJoin","lineWidth","strokeRect","highlightedFeature","canvasWidth","onMouseEnter","minSubfeatureWidth","maxClippingSize","sortFeature","featureArray","featuresInCenterLine","featuresOutsideCenter","innerArray","baseSortArray","baseMap","aMismatch","bMismatch","acode","bcode","charCodeAt","PileupLayoutSession","expansionBefore","expansionAfter","heightPx","configTheme","pxPerBp","minFeatWidth","sortedFeatures","featureMap","layoutRecords","layoutFeature","charSize","measureText","colorForBase","deletion","mismatchLeftPx","mismatchRightPx","mismatchWidthPx","baseColor","getContrastText","fillText","softClipLength","softClipStart","charAt","softClipLeftPx","softClipRightPx","softClipWidthPx","NestedFrequencyTable","initialData","slotName","amount","slot","getNested","MyConfigSchemaF","generateInfoList","table","infoList","overallScore","generateCoverageBins","bin","snpinfo","leftBase","rightBase","binWidth","binMax","coverageBins","snpsCounted","forEachBin","sb","eb","getStrand","overlap","increment","binNum","decrement","pm","AdapterClassF","viewScale","insRegex","infoArray","AlignmentsPlugin","linearAlignmentsDisplay","linearPileupDisplayConfigSchemaFactory","linearPileupDisplayModelFactory","linearSNPCoverageDisplayConfigSchemaFactory","linearSNPCoverageDisplayModelFactory","linearAligmentsDisplayConfigSchemaFactory","linearAlignmentsDisplayModelFactory","LinearAlignmentsDisplayReactComponent","alignmentsFeatureDetailConfigSchema","alignmentsFeatureDetailStateModel","AlignmentsFeatureDetailReactComponent","BamAdapterF","SNPCoverageAdapterF","CramAdapterF","HtsgetBamAdapterF","PileupRendererReactComponent","pileupRendererConfigSchema","SNPCoverageRendererReactComponent","ucscProcessedTranscript","thickStart","thickEnd","newChildren","prime","leftPrime","rightPrime","newData","chromStarts","chromStart","chromEnd","chrom","blockSizes","blockCount","BigBedAdapter","bigbed","parser","BigBed","then","autoSql","BED","parseLine","blockStarts","starts","sizes","blocksOffset","bmin","bmax","BedTabixAdapter","bed","TabixIndexedFile","tbiFilehandle","chunkCacheSize","getReferenceSequenceNames","getLines","lineCallback","line","fileOffset","capabilities","BedPlugin","bigBedAdapterConfigSchema","BigBedAdapterClass","bedTabixAdapterConfigSchema","BedTabixAdapterClass","feature1","feature2","jbrequiredTypes","onAction","getPath","showIntraviewLinks","linkViews","interactToggled","viewTracks","intersection","getMatchedTracks","trackConfigId","hasPairedReads","getTrackFeatures","hasTranslocations","getMatchedTranslocationFeatures","alreadySeen","getMatchedBreakendFeatures","candidates","cur","alt","MatePosition","getMatchedAlignmentFeatures","getBadlyPairedAlignments","getMatchedFeaturesInLayout","onSubviewAction","actionName","lastIndexOf","setHeaderHeight","toggleInteract","toggleIntraviewLinks","toggleLinkViews","TOP","BOTTOM","getPxFromCoordinate","yPos","heightFromSpecificLevel","useNextFrame","variable","setNextFrameState","LEFT","parentRef","totalFeatures","layoutMatches","mouseoverElt","setMouseoverElt","yOffset","c1","f1","level1","c2","f2","level2","reversed1","reversed2","Path","curveTo","strokeWidth","relevantAlt","feat1","feat2","findMatchingAlt","Join","lineTo","MateDirection","IconButton","gridArea","emphasis","InteractWithSquiggles","LinkViews","Sync","Header","withSize","monitorHeight","chr2","CHR2","end2","END","STRANDS","myDirection","mateDirection","jbrequiredMakeStyles","AlignmentConnections","AlignmentConnectionsFactory","Breakends","BreakendsFactory","Translocations","TranslocationsFactory","HeaderFactory","marginBottom","breakpointMarker","viewDivider","Overlay","viewComponent","matchedTracks","BreakpointSplitViewType","endPos","mateRefName","breakendSpecification","startPos","featureRefName","topRegion","startMod","endMod","INFO","matePosition","bottomRegion","topMarkedRegion","bottomMarkedRegion","BreakpointSplitViewComponent","BreakpointSplitViewModel","BreakpointSplitViewPlugin","BreakpointSplitViewFactory","polarToCartesian","radToDeg","rulerLabel","letterSpacing","endBase","startBase","startXY","endXY","largeArc","ElisionRulerArc","radiusPx","endRadians","startRadians","centerRadians","regionCountString","maxWidthPx","radians","strokeDasharray","RulerLabel","textXY","textAnchor","dominantBaseline","RegionRulerArc","sliceArcPath","Button","Container","Grid","MenuItem","TextField","Ruler","scroller","sliceRoot","borderRight","Slices","showingFigure","assemblyError","setAssemblyError","showImportForm","showFigure","bottom","findCircleIntersectionX","cx","cy","resultArray","solution","findCircleIntersectionY","cartesianToPolar","rho","theta","atan","PI","cartesianToTheta","twoPi","Slice","currentRadianOffset","radianWidth","offsetRadians","bpPerRadian","flipped","widthBp","freeze","totalRadians","elided","sliceIsVisible","r1start","r1length","r2start","r2length","visibleSection","visibleThetaMin","visibleThetaMax","CircularView","hideVerticalResizeHandle","hideTrackSelectorButton","lockedFitToWindow","disableImportForm","minimumRadiusPx","spacingPx","paddingPx","lockedPaddingPx","minVisibleWidth","scrollX","scrollY","slices","elidedRegions","pxPerRadian","calculateStaticSlices","staticSlices","viewSides","circleCenter","circleRadius","viewL","viewR","viewT","viewB","vertices","maxRho","reflect","rhoMin","rhoMax","thetaMin","thetaMax","vx","vy","viewportVisibleSection","centerXY","elidedBp","circumferencePx","minCircumferencePx","maxCircumferencePx","maximumRadiusPx","figureDimensions","visible","lastVisible","newHeight","setModelViewWhenAdjust","tooSmallToLock","resizeWidth","oldWidth","rotateClockwiseButton","rotateClockwise","rotateCounterClockwiseButton","rotateCounterClockwise","zoomInButton","zoomOutButton","newVal","secondCondition","previouslyEmpty","toggleFitToWindowLock","atMinBpPerPx","ReactComponentF","ModelF","strokeDashoffset","radius","patternTransform","patternUnits","strokeLinecap","errorBackground","errorText","mainThreadRendering","Loading","ChordDisplayLoadingFactory","DisplayError","ChordDisplayErrorFactory","RpcRenderedSvgGroup","RpcRenderedSvgGroupF","renderReactionData","renderReactionEffect","BaseChordDisplayModel","bezierRadiusRatio","refNameMap","onChordClick","origSlices","renamed","bezierRadius","ThisRendererType","isCompatibleWithRenderer","renderStarted","renderSuccess","renderError","setRefNameMap","renderReactionFactory","getRefNameMapForAdapter","baseChordDisplayConfig","CircularViewPlugin","CircularViewFactory","DataUsageIcon","SyntaxHighlighter","fontFamily","callbackEditor","syntaxHighlighter","setCode","setCodeError","debouncedCode","useDebounce","onValueChange","newCode","highlight","language","customStyle","cover","ColorPicker","displayColorPicker","setDisplayColorPicker","ColorSlot","displayed","setDisplayed","borderRightWidth","borderRightStyle","borderRightColor","g","serializeColor","rgb","contents","setContents","debouncedJson","StringEditor","evt","TextEditor","multiline","SvgCheckbox","StringArrayEditor","disablePadding","placeholder","useMapEditorStyles","StringArrayMapEditor","setAtIndex","removeAtIndex","NumberMapEditor","numValue","NumberEditor","setVal","num","IntegerEditor","booleanEditor","control","stringEnumEditor","slotSchema","getPropertyMembers","getSubType","choices","getUnionSubTypes","getPropertyType","createSetLocation","FileSelectorWrapper","valueComponents","fileLocation","stringArray","stringArrayMap","numberMap","integer","stringEnum","configRelationships","JsonEditor","useSlotEditorStyles","paperContent","flex","slotModeSwitch","ValueComponent","typeNameChoices","useMemberStyles","subSchemaContainer","borderLeft","Member","schema","isConfigurationSchemaType","singular","slotIndex","getTypeNamesFromExplicitlyTypedUnion","typeSelector","isConfigurationSlotType","Schema","getMembers","setTarget","getType","FromConfigAdapter","makeFeatures","fdata","makeFeature","bucket","svType","SVTYPE","currentRegion","localeCompare","FromSequenceConfigAdapter","superGetFeatures","featureClass","sequenceConfigSchema","RefNameAliasAdapter","promise","downloadResults","trim","fromConfigAdapterConfigSchema","FromConfigAdapterClass","fromConfigSequenceAdapterConfigSchema","FromConfigSequenceAdapterClass","refNameAliasAdapterConfigSchema","RefNameAliasAdapterClass","ConfigurationEditorHeadingComponent","ConfigurationEditorConfigSchema","ConfigurationEditorStateModelFactory","ConfigurationEditorReactComponent","hubTxtLocation","baseConnectionConfig","hubFileText","genomesFileText","trackDbFileText","generateTracks","trackDb","trackKeys","parentTrackKeys","parentTracks","currentTrackName","baseTrackType","bigDataLocation","trackDbFileLocation","bigDataIndexLocation","makeTrackConfig","BaseConnectionModelFactory","connect","connectionName","hubFileLocation","assemblyConf","fetchHubFile","hubFile","genomesFileLocation","fetchGenomesFile","genomesFile","fetchTrackDbFile","trackDbFile","isAbsoluteUrl","ConfirmTrack","trackData","indexTrackData","setTrackAdapter","setTrackName","setTrackType","trackAdapter","setAssembly","rel","SelectProps","SelectDisplayProps","installedAdapterType","installedTrackType","setIndexTrackData","setTrackData","stepper","actionsContainer","stepContent","steps","activeStep","setActiveStep","trackSource","setTrackSource","assemblyInstance","orientation","getStepContent","isNextDisabled","connectionType","setModelReady","ConfigEditorComponent","ConnectionTypeSelect","connectionTypeChoices","setConnectionType","assemblyNameChoices","setAssemblyName","autoComplete","assemblyNameChoice","connectionTypeChoice","configModel","setConfigModel","configModelReady","setConfigModelReady","newConnectionType","connectionId","connectionConf","handleFinish","Category","filterPredicate","connection","pathName","allTracks","filteredCount","formControlLabel","textDecoration","checkbox","configureButton","TrackEntry","titleText","unsupported","Contents","hierarchy","pathEntry","trackConfigurations","refSeqTrackConf","showRefSeqTrack","searchBox","fab","connectionsPaper","tabs","CloseConnectionDlg","modalInfo","setModalInfo","dereferenceTypeCount","safelyBreakConnection","DeleteConnectionDlg","assemblyIdx","setAssemblyIdx","trackConfig","deleting","filterError","clearFilterText","assemblyConnections","breakConnection","handleConnectionToggle","handleFabClose","widget","generateHierarchy","currLevel","collapsed","filterText","setView","toggleCategory","setFilterText","trackConfAssemblies","getRefSeqTrackConf","connectionTrackConfigurations","connectionHierarchy","allTracksInCategoryPath","currentHier","pathItem","buttonCell","AssemblyTable","setIsAssemblyBeingEdited","setAssemblyBeingEdited","rows","TableRow","TableCell","removeAssemblyConf","removeAssembly","TableContainer","Table","TableHead","TableBody","createStyles","createButton","AdapterSelector","adapterSelection","setAdapterSelection","AdapterInput","setFastaLocation","setFaiLocation","setGziLocation","setTwoBitLocation","loc","AssemblyAddForm","setFormOpen","addAssemblyConf","AssemblyEditor","titleBox","dialogContent","backButton","AssemblyManager","isFormOpen","isAssemblyBeingEdited","assemblyBeingEdited","showAssemblyTable","returnAssemblyName","resetButton","CurrentSession","selectedDefault","handleRadio","List","ListItem","SetDefaultSession","currentDefault","setSelectedDefault","sessionSnapshot","setDefaultSessionConf","savedSessions","totalTracks","pluralize","addConnectionType","ucscConfigSchema","ucscModelFactory","HierarchicalTrackSelectorConfigSchema","HierarchicalTrackSelectorStateModelFactory","HierarchicalTrackSelectorReactComponent","AddTrackConfigSchema","AddTrackStateModelFactory","AddTrackReactComponent","AddConnectionConfigSchema","AddConnectionStateModel","AddConnectionReactComponent","appendToMenu","NoteAddIcon","InputIcon","RenderErrorBoundary","hasError","errorInfo","Component","wordWrap","DotplotDisplay","vview","hview","ReactComponent2","viewHeight","borderSize","borderX","borderY","drawMode","ComparativeServerSideRenderer","approxPixelStringLen","Dotplot1DView","extend","box","DotplotHView","DotplotVView","tickSize","vtextRotation","htextRotation","viewTrackConfigs","viewAssemblyConfigs","axis","regionsSnapshot","setBorderY","setBorderX","setAssemblyNames","setViews","arr","getCoords","mousedown","mouseup","minmax","xmin","xmax","ymin","ymax","onDotplotView","d1","d2","viewSnapshot","MismatchParser","DotplotRenderer","db1","db2","mateRef","b10","b20","e10","e20","b1","b2","e1","e2","currX","currY","beginPath","prevY","dimensions","realizedViews","ComparativeServerSideRendererType","_size","oldCache","deleted","oldCacheSize","AbortablePromiseCache","QuickLRU","maxSize","pafRecords","chr1","start1","end1","start2","numMatches","blockLen","mappingQual","fields","syntenyId","ComparativeRender","FormRow","numRows","setSelected","vtext","htext","locstr","getBlockLabelKeysToHide","viewOffsetPx","blockLabelKeysToHide","sortedBlocks","alen","positions","labelBounds","HorizontalAxis","hide","data-bp","VerticalAxis","hblocks","vblocks","htop","hbottom","vtop","vbottom","ImportFormFactory","ControlsFactory","getOffset","DotplotViewInternal","mousecurrClient","setMouseCurrClient","mousedownClient","setMouseDownClient","mouseupClient","setMouseUpClient","distanceX","distanceY","lref","rref","blank","svg","rrect","lrect","mousecurr","mouserect","modelFactory","ReactComponentFactory","getLength","getLengthSansClipping","DotplotPlugin","DotplotViewFactory","dotplotDisplayConfigSchemaFactory","dotplotDisplayStateModelFactory","DotplotDisplayReactComponent","dotplotRendererConfigSchema","DotplotRendererReactComponent","PAFAdapterConfigSchema","TimelineIcon","AddIcon","clipPos","SA","readAssembly","trackAssembly","supplementaryAlignments","aln","saRef","saStart","saStrand","saCigar","saLengthOnRef","getLengthOnRef","saLength","saLengthSansClipping","saStrandNormalized","saClipPos","getClip","saRealStart","seqLength","CIGAR","totalLength","refLength","addContextMenu","hideExpressions","filterControlsHeight","dragHandleHeight","filterOut","attrName","makeFilters","setFilterControlsHeight","resizeFilterControls","toggleFilter","styles","AttributeFilter","withStyles","formControl","ReactPropTypes","FilterControls","seenAttributes","reaction","newSeenAttributes","visibleValues","gutterBottom","innerDisplay","filterControls","innerDisplayHeight","filterAttributes","linearFilteringDisplayConfigSchemaFactory","linearFilteringDisplayModelFactory","LinearFilteringDisplayReactComponent","gff","dontRedispatch","renameRefSeqs","getMetadata","getFeaturesHelper","allowRedispatch","originalQuery","lines","columnNumbers","minStart","maxEnd","featureType","gff3","lineRecord","lineHash","parseStringSync","parseFeatures","parseComments","parseDirectives","parseSequences","featureLocs","formatFeatures","featureLoc","_lineHash","defaultFields","attr","child_features","childLocs","childLoc","flat","derived_features","_linehash","gff3TabixAdapterConfigSchema","Gff3TabixAdapterClass","jb2ToJb1","jb1ToJb2","NCListFeature","ncFeature","jb2TagToJb1Tag","subfeature","jb1TagToJb2Tag","mappedTag","NCListAdapter","nclist","configRefNames","NCListStore","urlTemplate","wrapFeature","getDataRoot","dataDirLocation","parseJB1Json","parsedConf","regularizeConf","parseJB1Conf","keyPath","operation","lineNumber","section","recordVal","parsedValue","existing","textLine","meta","trackMetadata","sources","sourceDef","newSourceDef","typeMatch","sourceUrl","addBase","stores","names","refSeqs","nameUrl","trackClassName","regularizeClass","synthesizeTrackStoreConfig","histograms","mainConf","storeClass","backendVersion","guessStoreClass","storeConf","useAsRefSeqStore","refseqs","dataRoot","baseConfig","include","baseConfigRoot","dataRootReg","dataRootLocation","baseProtocol","baseConfigLocation","newConfig","fetchedConfig","fetchConfigFile","mergeConfigs","createFinalConfig","defaults","configDefaults","configWithDefaults","loadIncludes","fillTemplates","finalConfig","validateConfig","parseJb1","aTracks","bTracks","mergeTrackConfigs","bT","aT","inputConfig","loadRecur","upstreamConf","newUpstreamConf","regularizeIncludes","loads","cacheBuster","includedData","subconfig","containerID","show_tracklist","show_nav","show_menu","show_overview","show_fullviewlink","update_browser_title","updateBrowserURL","datasets","_DEFAULT_EXAMPLES","volvox","modencode","yeast","highlightSearchedRegions","highResolutionMode","convertTrackConfig","jb1TrackConfig","jb2TrackConfig","Description","trackIdentifier","jb2Features","jb2Feature","generateFromConfigTrackConfig","resolveUrlTemplate","baiUrlTemplate","csiUrlTemplate","craiUrlTemplate","tbiUrlTemplate","faiUrlTemplate","gziUrlTemplate","fetchJb1","jb2Tracks","jb1Track","jb2Track","LegacyJBrowsePlugin","ncListAdapterConfigSchema","NCListAdapterClass","jbrowse1ConfigSchema","jbrowse1ModelFactory","LinearComparativeDisplay","Overlays","MiddleComparativeView","OverlayComparativeView","LinearComparativeView","param","baseModelFactory","parentView","generateMatches","interstitialYPos","cond","l1","l2","deserializedFeatures","trackIds","useMemo","matches","offsets","ref1","ref2","v1","v2","length1","length2","x11","x12","x21","x22","currX1","currX2","rev1","rev2","prevX1","prevX2","closePath","LinearSyntenyRenderer","serializedFeatures","_level","LinearSyntenyView","baseModel","MCScanAnchorsAdapter","geneNameToRows","rowToGeneName","subadapters","mcscanAnchorsLocation","name1","name2","LinearComparativeViewFactory","LinearSyntenyViewFactory","linearComparativeDisplayConfigSchemaFactory","linearComparativeDisplayStateModelFactory","LinearComparativeDisplayReactComponent","middle","baseConfigFactory","linearSyntenyDisplayConfigSchemaFactory","linearSyntenyDisplayStateModelFactory","MCScanAnchorsConfigSchema","linearSyntenyRendererConfigSchema","LinearSyntenyRendererReactComponent","CalendarIcon","configFeatureStore","ScoreText","layoutRecord","anchorX","innerColor","scoreString","fontHeight","Lollipop","onFeatureMouseDown","handler","onFeatureMouseEnter","onFeatureMouseOut","onFeatureMouseOver","onFeatureMouseUp","onFeatureMouseLeave","onFeatureMouseMove","anchorLocation","styleOuter","styleInner","Stick","LollipopRendering","sticksRendered","lollipopsRendered","layoutFeat","strokeColor","caption","minStickLength","stickColor","stickWidth","FloatingLayout","items","layoutDirty","sorted","maxBottom","layoutEntries","currentItem","previouslyLayedOutItem","prevStart","prevTop","prevWidth","prevBottom","pairs","getLayout","PrecomputedFloatingLayout","FloatingLayoutSession","LollipopRenderer","LollipopRendererReactComponent","lollipopRendererConfigSchema","linearLollipopDisplayConfigSchemaFactory","LinearLollipopDisplayStateModelFactory","subtitle","align","styledBy","property","mapping","dropZone","true","false","uploadIcon","rejectedFiles","listItem","setErrorMessage","acceptedFilesParsed","setAcceptedFilesParsed","useDropzone","onDrop","acceptedFiles","getRootProps","getInputProps","isDragActive","newConfigs","fileHandle","configContents","getConfigs","addSessions","setActiveSession","updateConfigName","AutosaveEntry","autosavedSession","sessionIndexToDelete","setSessionIndexToDelete","sessionNameToDelete","handleDialogOpen","aboutConfigSchema","aboutStateModel","AboutReactComponent","helpConfigSchema","helpStateModel","HelpReactComponent","importConfigurationConfigSchema","importConfigurationStateModel","ImportConfigurationReactComponent","sessionManagerConfigSchema","sessionManagerStateModel","SessionManagerReactComponent","HelpIcon","insertInMenu","FolderOpenIcon","SaveIcon","saveSessionToLocalStorage","FileCopyIcon","duplicateCurrentSession","SPARQLAdapter","queryTemplate","refNamesQueryTemplate","additionalQueryParams","encodeURIComponent","querySparql","resultsToRefNames","filledTemplate","resultsToFeatures","accept","bindings","head","vars","requiredField","seenFeatures","rawData","rd","parentUniqueId","pid","sf","found","seenFeature","RdfPlugin","sparqlAdapterConfigSchema","SPARQLAdapterClass","fasta","seqCache","LRU","getSequence","fastaOpts","fai","IndexedFasta","getSequenceList","getSequenceSizes","seqSizes","getSequenceSize","chunks","gzi","BgzipIndexedFasta","chromSizesLocation","complement","complementRegex","complementTable","S","N","K","Y","V","M","W","X","B","H","D","R","seqString","defaultStarts","defaultStops","defaultCodonTable","TCA","TCC","TCG","TCT","TTC","TTT","TTA","TTG","TAC","TAT","TAA","TAG","TGC","TGT","TGA","TGG","CTA","CTC","CTG","CTT","CCA","CCC","CCG","CCT","CAC","CAT","CAA","CAG","CGA","CGC","CGG","CGT","ATA","ATC","ATT","ATG","ACA","ACC","ACG","ACT","AAC","AAT","AAA","AAG","AGC","AGT","AGA","AGG","GTA","GTC","GTG","GTT","GCA","GCC","GCG","GCT","GAC","GAT","GAA","GAG","GGA","GGC","GGG","GGT","Translation","codonTable","frame","tilt","effectiveFrame","seqSliced","translated","codon","normalizedCodon","aminoAcid","letter","drop","Fragment","DNA","showForward","showReverse","showTranslation","tempCodonTable","aa","nucs","nuc","n0","n1","n2","generateCodonTable","divSequenceRendererConfigSchema","twobit","twoBitOpts","TwoBitFile","getSequenceNames","refSizes","DivSequenceRenderer","SequencePlugin","twoBitAdapterConfigSchema","TwoBitAdapterClass","chromSizesAdapterConfigSchema","ChromSizesAdapterClass","indexedFastaAdapterConfigSchema","IndexedFastaAdapterClass","bgzipFastaAdapterConfigSchema","BgzipFastaAdapterClass","createReferenceSeqTrackConfig","linearReferenceSequenceDisplayConfigSchema","toggleShowForward","toggleShowReverse","toggleShowTranslation","DivSequenceRendererReactComponent","SceneGraph","absoluteCache","isNaN","dirty","nameOrSceneGraph","absolute","childLeft","childRight","childTop","childBottom","expand","newLeft","newRight","newTop","newBottom","diff","walkParents","walkChildren","xOffset","Label","featureWidth","allowedWidthExpansion","fontWidthScaleFactor","fontWidth","totalWidth","FeatureGlyph","rootLayout","shouldShowName","shouldShowDescription","featureLayout","GlyphComponent","glyphComponents","OverlayRect","rectProps","screenWidth","leftWithinBlock","widthWithinBlock","handlers","mouseoverFeatureId","fillOpacity","color1","emphasizedColor1","color2","Box","Chevron","isUTR","emphasizedColor","Segments","emphasizedColor2","subfeatureId","subfeatureLayout","ProcessedTranscript","layOutFeature","layOutSubfeatures","Subfeatures","topOffset","SubfeatureGlyphComponent","chooseGlyphComponent","subfeatureHeight","subSubLayout","hasSubSub","layOut","parentFeature","layoutParent","addChild","renderingStyle","RenderedFeatureGlyph","labelsAllowed","expansion","nameWidth","descriptionWidth","aboveLayout","RenderedFeatures","featuresRendered","SvgFeatureRendering","mouseEnter","mouseLeave","mouseOver","featureIdCurrentlyUnderMouse","click","contextMenu","color3","labels","nameColor","descriptionColor","SVGPlugin","SvgFeatureRendererReactComponent","svgFeatureRendererConfigSchema","trackDbId","trackPath","subTrack","getSubtracks","members","bigDataUrl","trackDbUrl","bigDataIndex","rawResponse","setHubFile","hub","hubUrl","longLabel","shortLabel","hubHandle","hubTxt","newHubFile","getHubTxt","__dangerouslySetInnerHTML","DOMPurify","selectList","selectedItem","handleSelect","helpText","QueryStatus","Wire","hubList","genomeSelector","setAssemblies","selectedSpecies","setSelectedSpecies","selectedAssembly","setSelectedAssembly","hubs","setHubs","allHubsRetrieved","setAllHubsRetrieved","selectedHub","setSelectedHub","newHubs","page","doPost","entries_per_page","urlParams","doGet","pingResponse","assembliesResponse","getAssemblies","getHubs","renderItems","speciesList","newHub","cleanShortLabel","cleanLongLabel","formControlProps","interactive","TrackHubRegistryPlugin","TrackHubRegistrySelect","ChordVariantDisplay","BaseChordDisplayComponentFactory","blockStart","blockEnd","bpOffset","Chord","blocksForRefs","startBlock","endPosition","endBlock","bpToRadians","controlXY","hoverStrokeColor","blocksForRefsMemo","chords","trackStyleId","StructuralVariantChords","ChordRendererType","strokeColorSelected","strokeColorHover","valueCell","valbox","VariantSamples","infoFields","scope","CHROM","POS","ID","REF","ALT","QUAL","FILTER","VCFFeature","_id","dataFromVariant","SAMPLES","_getSOTermAndDescription","SO_term","isTRA","isSymbolic","soTerms","_getSOAndDescFromAltDefs","soTerm","_getSOAndDescByExamination","prefixes","desc","prefix","new_descs","suffixes","_altTypeToSO","_makeDescriptionString","modAlt","samples","DEL","INS","DUP","INV","INVDUP","CNV","TRA","NON_REF","vcf","VcfParser","VcfFeature","superGetFeaturesInMultipleRegions","bytesForRegions","pct","blocksForRange","blockResults","byteRanges","minv","blockPosition","maxv","VariantsPlugin","vcfTabixAdapterConfigSchema","VcfTabixAdapterClass","StructuralVariantChordRendererFactory","linearVariantDisplayConfigSchemaFactory","linearVariantDisplayModelFactory","variantFeatureWidgetConfigSchema","variantFeatureWidgetStateModel","VariantFeatureWidgetReactComponent","FileSelector","Card","CardContent","FormControl","FormGroup","FormLabel","FormControlLabel","Checkbox","RadioGroup","Radio","Typography","Select","errorCard","buttonContainer","modelPropName","modelSetterName","showColumnNameRowControls","fileType","fileTypes","setFileType","hasColumnNameLine","toggleHasColumnNameLine","assemblyChoices","fileTypeName","labelPlacement","canCancel","import","ErrorDisplay","errorContainer","spreadsheetModel","currentColumnMenu","setColumnMenu","columnMenuClose","columnNumber","sortMenuClick","descending","dataTypeChoices","dataTypeTopLevelMenu","dataTypeRecord","categoryName","isCategory","subMenuItems","dataType","dataTypeName","dataTypeDisplayName","isSortingAscending","col","isSortingDescending","menuEntry","subTypeName","filterMenuClick","currentRowMenu","rowMenuPosition","setRowMenuPosition","rowMenuClose","rowNumber","rowSet","rowMenuItems","ColumnMenu","RowMenu","dataTable","borderCollapse","borderSpacing","textOverflow","dataTableBody","rowNumCell","userSelect","rowMenuButton","rowMenuButtonIcon","rowSelector","columnHead","sortIndicator","columnButtonContainer","columnButton","topLeftCorner","dataRowSelected","emptyMessage","captionSide","CellData","cell","spreadsheet","DataRow","rowModel","hideRowSelection","columnDisplayOrder","rowClass","labelClick","colNumber","sortSpec","DataTableBody","rowsPerPage","DataTable","columns","hasColumnNames","currentHoveredColumn","setHoveredColumn","totalRows","columnButtonIcon","columnHeaderMouseOver","columnHeaderMouseOut","letterFor","RangeError","numToColName","columnButtonClick","Spreadsheet","InputAdornment","textFilterControlEndAdornment","TextFilter","textFilter","textFilterValue","setTextFilterValue","debouncedTextFilter","columnName","columnFilter","filterIcon","filterIconBg","filterModel","columnDefinition","TablePagination","ImportWizard","GlobalFilterControls","ColumnFilterControls","contentArea","viewControls","rowCount","statusBar","verticallyCenter","textFilterControlAdornment","ViewControls","RowCountMessage","passingFiltersCount","selectedCount","selectedAndPassingFiltersCount","rowMessage","selectedAndNotPassingFiltersCount","colFilterCount","setPage","setRowsPerPage","importWizard","rowsPerPageOptions","onChangePage","newPage","onChangeRowsPerPage","DataCellReactComponent","FilterModelType","compare","getEnumerationValues","compareLocs","MakeSpreadsheetColumnType","textFilterControl","FilterReactComponent","operationChoices","OPERATIONS","OPERATION_PREDICATES","cellLocation","specifiedLocation","newViewId","when","cellA","cellB","parsed","sheet","parsedCellText","setLocString","setOperation","locationLinkClick","contains","textInCell","equals","stringToFind","ColumnTextFilter","setString","TextColumn","NumberFilterModel","numberInCell","between","firstNumber","secondNumber","setFirstNumber","setSecondNumber","NumberColumn","ColumnTypes","NumberFactory","TextFactory","LocString","LocStringFactory","LocRef","LocRefFactory","LocStart","LocStartFactory","LocEnd","LocEndFactory","allColumnTypes","AnyColumnType","AnyFilterModelType","columnType","CellModel","extendedData","cells","isSelected","toggleSelect","unSelect","setExtendedData","column","isDerived","RowModel","Row","isLoaded","sortedFilteredRows","selectedRows","selectedFilteredRows","rowSortingComparisonFunction","rowPassesFilters","unselectAll","ColumnDataTypes","StaticRowSetModel","StaticRowSetF","ColumnDefinition","derivationFunctionText","sortColumns","switchDirection","defaultDataType","rowA","rowB","cellsWithDerived","setLoaded","newPosition","setSortColumns","newSort","setColumnType","newTypeName","bufferToString","TextDecoder","fatal","decode","parseWith","csv","noheader","output","fromString","guessColumnType","parsedLoc","guessedType","dataToSpreadsheetSnapshot","columnNameLineNumber","maxCols","columnNames","colNamesRow","selectedAssemblyName","parseCsvBuffer","parseTsvBuffer","delimiter","vcfCoreColumns","vcfRecordToRow","vcfParser","vcfVariant","vcfFeature","parseVcfBuffer","splitVcfFileHeaderAndBody","VCF","oi","unshift","wholeFile","prevChar","headerEndIndex","browserBytes","trackBytes","bytesAreFoundAt","removeBedHeaders","parseBedBuffer","bedColumns","bedColumn","parseBedPEBuffer","featureField","parseSTARFusionBreakpointString","numericColumns","SpanningFragCount","FFPM","LeftBreakEntropy","RightBreakEntropy","JunctionReadCount","parseSTARFusionBuffer","fileTypeParsers","CSV","TSV","BEDPE","fileTypesRegexp","fileSource","readyToDisplay","setFileSource","newSource","setColumnNameLineNumber","newnumber","cancelButton","setDisplayMode","typeParser","requiresUnzip","unzip","displaySpreadsheet","AnyColumnFilter","RowFullTextFilter","_sheet","rowFullText","columnFilters","setRowFullTextFilter","addBlankColumnFilter","removeColumnFilter","clearAllFilters","defaultRowMenuItems","DoneIcon","_view","getEnv","SpreadsheetModel","ImportWizardModel","FilterControlsModel","hideViewControls","hideFilterControls","setRowMenuItems","newItems","setImportMode","SpreadsheetViewPlugin","SpreadsheetViewTypeFactory","ViewComfyIcon","viewsContainer","spreadsheetViewContainer","circularViewOptions","CircularViewOptions","svInspector","circularViewOptionsBarHeight","SpreadsheetViewReactComponent","CircularViewReactComponent","showCircularView","spreadsheetView","ret1","circularView","otherData","columnsAlreadyUsedInLocations","loc1","loc2","locationColumnNumbers","makeAdHocFeature","textOf","colno","locRefColumnNumbers","locStartColumnNumbers","locEndColumnNumbers","makeAdHocSvFeature","columnTypes","makeAdHocSvFeatureFromTwoLocations","makeAdHocSvFeatureFromTwoRefStartEndSets","adhocFeature","getSerializedFeatureForRow","svInspectorView","breakpointSplitViewSnapshotFromTableRow","canOpenBreakpointSplitViewFromTableRow","openBreakpointSplitViewFromTableRow","defaultOnChordClick","chordTrack","SpreadsheetViewType","CircularViewType","onlyDisplayRelevantRegionsInCircularView","spreadsheetWidth","circularViewWidth","featuresRefNamesP","assemblyRegions","featureRefNames","canonicalFeatureRefNames","generatedTrackConf","setOnlyDisplayRelevantRegionsInCircularView","SvInspectorViewPlugin","SvInspectorViewTypeFactory","TableChartIcon","Adapter","HicRenderer","bin1","minBin","maxBin","bin2","rotate","HicTrackConfigFactory","HicRendererConfigSchema","HicAdapterFactory","HicRendererReactComponent","hicRendererConfigSchema","linearHicdisplayConfigSchemaFactory","linearHicdisplayModelFactory","shareDiv","shareButton","loadingMessage","closeButton","SettingsDialog","currentSetting","setSetting","infoDialogOpen","setInfoDialogOpen","InfoDialog","ShareDialog","shortUrl","setShortUrl","settingsDialogOpen","setSettingsDialogOpen","cancelled","locationUrl","shareSessionToDynamo","URLSearchParams","longUrl","longParams","deleteBaseUris","useQueryParam","adminKey","adminServer","setSessionId","currentSessionId","onSnapshot","payload","refNameColors","loadRefNameMap","adapterConf","refNameAliases","checkRefName","canon","canonicalName","adapterName","forwardMap","reverseMap","assemblyFactory","assemblyConfigType","adapterLoads","abortSignal","safeReference","MSTRegion","adapterRegionsWithAssembly","setRegions","setRefNameAliases","isAssemblyEditing","sequenceAdapterConfig","refNameAliasesAdapterConfig","makeLoadAssemblyData","loadAssemblyReaction","getAdapterMapEntry","adapterId","getAdapterId","getReverseRefNameMapForAdapter","getRegions","adapterRegions","adapterRegion","refAliasAdapterType","refNameAliasAdapter","getRefNameAliases","alias","assemblyManagerFactory","Assembly","aliasMap","assemblyAlias","allRefNames","allPossibleRefNames","assemblyConfigs","assemblyConfig","addAssembly","replaceAssembly","BaseAssemblyConfigSchema","AssemblyConfigSchema","assemblyConfigSchemas","dispatcher","defaultDriver","isClonable","worker","pingTime","_resolve","LazyWorker","driver","makeWorker","watchWorker","maxPingTime","destroy","BaseRpcDriver","lastWorkerAssignment","workerAssignments","workerCount","workerPool","workerCheckFrequency","filterArgs","AbortSignal","callfunc","signalId","serializeAbortSignal","remoteAbort","functionName","getWorker","hardwareConcurrency","mainThread","canDetect","detectHardwareConcurrency","createWorkerPool","workers","getWorkerPool","workerNumber","workerAssignment","rpcMethod","getRpcMethodType","serializeArguments","filteredAndSerializedArgs","callP","killedP","killedCheckInterval","setInterval","finally","clearInterval","resultP","race","deserializeReturn","WebWorkerHandle","terminate","channel","listener","on","off","Rpc","Client","WebWorkerRpcDriver","workerBootConfiguration","WorkerClass","postMessage","DummyHandle","_functionName","_filteredArgs","MainThreadRpcDriver","execute","wait","ms","WindowWorkerHandle","readyForConfig","callRenderer","filteredArgs","removeListener","DriverClasses","ElectronRpcDriver","workerCreationChannel","electronRemote","remote","workerId","sendSync","BrowserWindow","fromId","RpcManager","runtimePluginDefinitions","mainConfiguration","backendConfigurations","driverObjects","backendName","backendConfiguration","DriverClassImpl","newDriver","_sessionId","getDriver","getDriverForCall","rpcConfigSchema","JBrowseWeb","JBrowseModel","rpc","shareURL","disableAnalytics","defaultSession","afterCreate","toRemove","addConnectionConf","deleteConnectionConf","conn","deleteTrackConf","newDefault","sessionConf","toJS","removeAttr","sessionModelFactory","widgets","activeWidgets","connectionInstances","sessionConnections","task","getReferring","refs","walk","isReferenceType","setName","makeConnection","connectionData","removeReferring","referring","dereferenced","callbacks","prepareToBreakConnection","callbacksToDereferenceTrack","deleteConnection","deletedConn","updateDrawerWidth","newDrawerWidth","resizeDrawer","oldDrawerWidth","initialState","typeDefinition","hideWidget","addLinearGenomeViewOfAssembly","addViewOfAssembly","addViewFromAnotherView","otherView","hasWidget","hideAllWidgets","clearConnections","addSavedSession","removeSavedSession","renameCurrentSession","setDefaultSession","loadAutosaveSession","pushSnackbarMessage","editConfiguration","editableConfigSession","editor","canEdit","SettingsIcon","DeleteIcon","trackSnapshot","CopyIcon","RootModel","Session","AssemblyConfigSchemasFactory","assemblyConfigSchemasType","assemblyManagerType","jbrowseWebFactory","configPath","isDefaultSessionEditing","savedSessionsVolatile","localStorageId","alert","sessionStorage","setSession","setAssemblyEditing","setDefaultSessionEditing","newSnapshotName","newSnapshotCopyNumber","localId","newSessionSnapshot","previousAutosave","history","menus","lastAutosave","RenderWorker","setHistory","setMenus","appendMenu","insertMenu","insertPosition","topMenu","menuPath","pathSoFar","menuName","sm","mi","insertInSubMenu","savedRootSessions","NoConfigMessage","link","SessionLoader","blankSession","configSnapshot","sessionError","configError","bc1","bc2","setSessionQuery","setConfigError","setSessionError","setPlugins","setConfigSnapshot","setSessionSnapshot","setBlankSession","fetchPlugins","pluginLoader","runtimePlugins","fetchConfig","configLocation","configText","configUri","addRelativeUris","fetchSessionStorageSession","sessionStr","sessionSnap","msg","fetchSharedSession","readConf","readSessionFromDynamo","decryptedSession","fromUrlSafeB64","decodeEncodedUrlSession","localSession","encodedSession","sharedSession","Loader","initialTimestamp","loader","initialSessionQuery","Renderer","setPassword","setPluginManager","P","JBrowseRootModel","JBrowseRootModelFactory","packagedef","defaultJBrowseSession","writeAWSAnalytics","writeGAAnalytics","factoryReset","PlatformSpecificFatalErrorDialog","FallbackComponent","isOptionalType","isArrayType","isMapType","unionType","isUnionType","propertyName","resolveLateType","maybeLate","isLateType","typeModels","fallbackDefaults","literalJSON","objectJSON","typeModelExtensions","addToKey","ar","removeAtKeyIndex","setAtKeyIndex","FunctionStringType","functionRegexp","makeConfigurationSchemaModel","modelName","schemaDefinition","modelDefinition","implicitIdentifier","volatileConstants","isJBrowseConfigurationSchema","jbrowseSchema","slotDefinition","configSlotModelName","isCallback","verifyFunctionSignature","convertToCallback","valueJSON","convertToValue","funcResult","defineProperty","ConfigSlot","completeModel","setSubschema","newSchema","newSnap","isEmptyArray","identifierDefault","inputSchemaDefinition","inputOptions","jbrowseSchemaDefinition","jbrowseSchemaOptions","preprocessConfigurationSchemaArguments","schemaType","reference","isSessionModel","isViewModel","isTrackViewModel","compilationCache","paramList","compiled","Function","thisArg","AbortError","makeAbortError","DOMException","fromEvent","exception","confObject","slotPath","appliedFunc","newPath","subConf","maybeUnionType","typeNames","shim","process","inProduction","TextEncoder","encode","deflated","deflate","encoded","fromByteArray","b64","originalB64","repeat","b64PadSuffix","toByteArray","inflated","inflate","debouncedValue","setDebouncedValue","argsRef","findParentThat","hasParent","fromValue","toValue","animationFrameId","onFinish","precision","tension","friction","mass","time","lastPosition","lastTime","velocity","lastVelocity","numSteps","isVelocity","isDisplacement","cancelAnimationFrame","findParentThatIs","startString","endString","assemblyNameString","parseLocStringOneBased","assemblyMatch","lastColonIdx","suffix","rangeMatch","singleMatch","separator","locA","locB","assemblyComp","refComp","startComp","endComp","compareLocStrings","roundToNearestPointOne","oneEightyOverPi","piOverOneEighty","degToRad","degrees","cos","sin","iterable","sizeHint","counter","merged","dataFunction","asyncReactionFunction","reactionOptions","startedFunction","successFunction","errorFunction","inProgress","handleError","reactionDisposer","mobxReactionHandle","thisInProgress","renameRegionIfNeeded","newRef","newArgs","getter","finished","whenPromise","mobxWhen","finishTimeout","cancel","whenPresent","fd","fetchLength","getFd","byteLength"],"mappings":"iiBAKaA,EAAYC,QAAMC,SAASD,QAAME,WAAYC,IAAQC,UAGrDC,EAAY,CACvBC,OAAQC,IAAUC,MAAM,CACtBC,QAASF,IAAUG,OAAOC,WAC1BC,MAAOL,IAAUM,OAAOF,WACxBG,IAAKP,IAAUM,OAAOF,aAExBI,aAAcC,YAAYC,yBAC1BC,QAASX,IAAUC,MAAM,CACvBW,IAAKZ,IAAUa,KAAKT,WACpBU,GAAId,IAAUa,KAAKT,cAIVW,EAAmBtB,QAC7BuB,MAAM,mBAAoB,CACzBd,QAAST,QAAMU,OACfE,MAAOZ,QAAMa,OACbC,IAAKd,QAAMa,OACXW,SAAUxB,QAAMC,SAASD,QAAMyB,SAAS,KAEzCC,SAAQ,SAAAC,GAAI,MAAK,CAChBC,WADgB,SACLC,GACTF,EAAKlB,QAAUoB,OAIRvB,EAASN,QAAM8B,QAC1B,SACAR,EACAtB,QAAMuB,MAAM,CACVQ,aAAc/B,QAAMU,UAIXsB,EAAoBhC,QAAMuB,MAAM,oBAAqB,CAChEU,UAAWjC,QAAMU,SAGNwB,EAAiBlC,QAAMuB,MAAM,cAAe,CACvDY,IAAKnC,QAAMU,OACX0B,QAASpC,QAAMqC,MAAMrC,QAAMU,UAGhB4B,EAActC,QAAMuC,kBAAkBL,EAAgB,CACjEM,cAAe,SAAAC,GAAQ,IACbL,EAAqBK,EAArBL,QAAYM,EADC,YACQD,EADR,aAErB,OAAKL,EAGEK,EAFEC,KAMAC,EAAe3C,QAAM4C,MAAMZ,EAAmBM,I,2EC7D3D,44BAKO,SAASO,QAAQC,GACtB,OAAOA,GAAOA,EAAIC,OAA8B,kBAAdD,EAAIC,MAIjC,SAASC,SAASF,GACvB,OAAOA,GAAOA,EAAIG,KAA0B,kBAAZH,EAAIG,IAM/B,SAASC,WAEdC,EAEAC,GAGA,cAAmBC,OAAOC,KAAKF,GAA/B,eAAmC,CAA9B,IAAMG,EAAI,KAEXA,KAAQJ,GACW,kBAAZC,EAAEG,IACU,kBAAZJ,EAAEI,GAETL,WAAWC,EAAEI,GAAOH,EAAEG,IAEH,qBAAZJ,EAAEI,IACU,qBAAZH,EAAEG,KAETJ,EAAEI,GAAQH,EAAEG,IAGhB,OAAOJ,EAOF,SAASK,kBAAkBC,GAChC,OAAOC,mDAAWD,GAYb,SAASE,aACdC,EAEAC,GACQ,WACR,OAAOD,EAASE,QACd,mBACA,SAACC,EAAOC,GACNA,EAAUA,EAAQF,QAAQ,OAAQ,IAClC,IAAMG,EAAOC,iDAASL,EAAUG,GAChC,QAAaG,IAATF,EACF,MAAoB,oBAATA,EAA4BA,EAAKD,GACrCC,EAET,GAAIJ,EAASO,SAAU,CAErB,IAAMC,EAAIR,EAASO,SAASE,KAAK,EAAMN,GACvC,QAAUG,IAANE,EAAiB,OAAOA,EAE9B,OAAON,KAYN,SAASQ,MAAMC,GACpB,IACGA,GACc,kBAARA,GACiC,sBAAxCnB,OAAOoB,UAAUC,SAASJ,KAAKE,GAG/B,OAAOA,EAET,GAAIA,EAAIG,UAAY,cAAeH,EAEjC,OAAOA,EAAII,WAAU,GAEvB,GAAIJ,aAAeK,KAEjB,OAAO,IAAIA,KAAKL,EAAIM,WAEtB,GAAIN,aAAeO,OAEjB,OAAO,IAAIA,OAAOP,GAEpB,IAAIQ,EACAC,EACAC,EACJ,GAAIC,MAAMC,QAAQZ,GAGhB,IADAQ,EAAI,GACCC,EAAI,EAAGC,EAAIV,EAAIa,OAAQJ,EAAIC,IAAKD,EAC/BA,KAAKT,IACPQ,EAAEC,GAAKV,MAAMC,EAAIS,UASrBD,EAAIR,EAAIc,YAAc,IAAId,EAAIc,YAAgB,GAEhD,OAAOC,MAAMP,EAAGR,EAAKD,OAoBvB,SAASgB,MAEPC,EAEAC,EACAC,GAGA,IAAIC,EACAC,EACEC,EAAQ,GAEd,IAAKF,KAAQF,EAKXG,EAAIH,EAAOE,GAEPA,KAAQH,IAETA,EAAKG,KAAUC,GAAQD,KAAQE,GAAUA,EAAMF,KAAUC,KAE1DJ,EAAKG,GAAQD,EAAWA,EAASE,GAAKA,GAI1C,OAAOJ,EAGF,SAASM,UAAUC,GACxB,GAAIA,EACF,cAAgB1C,OAAOC,KAAKyC,GAA5B,eAAmC,CAA9B,IAAMC,EAAC,KAEV,GAAuB,kBAAZD,EAAKC,GAGdD,EAAKC,GAAKF,UAAUC,EAAKC,SAEtB,GAAuB,kBAAZD,EAAKC,GAAiB,CAGpC,IAAMC,EAAOF,EAAKC,GACd,oBAAoBE,KAAKD,KAE3BF,EAAKC,GAAKG,SAASF,KAK3B,OAAOF,EAGT,SAASI,WAGP,GAAuB,kBAAnB,yCAA6B,OAAO,UAAP,8BACjC,IAEEC,KAAK,gBAAD,qDACJ,MAAOC,GACPC,QAAQC,MAAR,UAAiBF,EAAjB,mFAGF,iD,4OC1MF,SAASG,EAASvD,GAA6D,IAA3CwD,EAA2C,uDAAvB,GACtD,OAAOC,MAAMzD,EAAD,aACV0D,OAAQ,MACRC,YAAa,eASVH,I,4CAIP,WACExD,EACArC,EACAE,GAHF,iDAAAqC,EAAA,6DAIE0D,EAJF,+BAI6D,GAErDC,EAAc,IAAIjC,KAClBkC,EAPR,2BAO8BF,EAAQG,SAPtC,IAO+CC,MAAO,SAAF,OAAWrG,EAAX,YAAoBE,KAPxE,SAQoB0F,EAASvD,EAAD,YAAC,eACtB4D,GADqB,IAExBG,QAASD,KAVb,UAQQG,EARR,OAiBQC,EAAe,IAAItC,KACN,MAAfqC,EAAIE,QAAiC,MAAfF,EAAIE,OAlBhC,sBAmBU,IAAIC,MAAJ,eACIH,EAAIE,OADR,0BACgCnE,EADhC,kBAC6CrC,EAD7C,YACsDE,IApBhE,OA2BQkG,EAA+B,GA3BvC,cA4BuBE,EAAIF,QAAQM,WA5BnC,IA4BE,2BAA4C,yBAAhCC,EAAgC,KAA7BlD,EAA6B,KAC1C2C,EAAQO,GAAKlD,EA7BjB,iCAgCqB,MAAf6C,EAAIE,OAhCV,uBAiCU,IAAIC,MAAJ,eACIH,EAAIE,OADR,0BACgCnE,EADhC,kBAC6CrC,EAD7C,YACsDE,IAlChE,yBAuC4BoG,EAAIM,cAvChC,eAuCQA,EAvCR,yBAwCS,CACLR,UACAF,cACAK,eACAM,OAAQC,SAAOC,KAAKH,KA5CxB,6C,sBAgDA,IAAMI,EAAmB,IAAIC,mBAAiB,CAC5CnB,M,gDACAoB,KAAM,SACNC,UAAW,KAAF,IAAE,EAAK,IAChBC,aAAc,UACdC,WAAY,M,SAGCC,E,gFAAf,WACEjF,EACAwD,GAFF,qCAAAtD,EAAA,0DAKQ4D,EAAiBN,GAAQA,EAAKO,WAG9BD,aAA0BoB,QAASlB,EAAQF,EAAe5F,IAAI,SACzDgE,MAAMC,QAAQ2B,IAAlB,EACSA,EAAeqB,MAAK,kBAAmB,UAAnB,wBAA+B,MAC7DjE,OACAA,GAHC,mBACA8C,EADA,MAKAA,EAAQF,EAAeE,QAE1BA,EAhBN,sBAiBUoB,EAAa,oBAAoBC,KAAKrB,IAjBhD,sCAmB6BoB,EAnB7B,GAmBezH,EAnBf,KAmBsBE,EAnBtB,KAoBY8E,EAAI2C,SAAS3H,EAAO,IACpByF,EAAIkC,SAASzH,EAAK,IArB9B,UAsB8B8G,EAAiBY,SAASvF,EAAK2C,EAAGS,EAAIT,EAAI,EAAG,CACnE6C,OAAQhC,GAAQA,EAAKgC,SAvB7B,eAsBYC,EAtBZ,OAyBc1B,EAAY0B,EAAZ1B,QAzBd,kBA0Ba,IAAI2B,SAASD,EAASjB,OAAQ,CAAEL,OAAQ,IAAKJ,aA1B1D,iCA8BSR,EAASvD,EAAKwD,IA9BvB,6C,sBC9DA,IAAMmC,EAAa,YAAY1C,KAAK2C,UAAUC,WAEjCC,EAAU,SAACjG,GACtB,OAAO8F,EAAa,IAAII,IAAmBlG,ID+FrBG,EC/FgDH,EDgG/D,IAAImG,aAAWC,OAAOjG,GAAM,CACjCyD,MAAOwB,KAFJ,IAAiBjF,GC5FxB,SAASkG,EAAcC,GACrB,MAAO,QAASA,EAGlB,SAASC,EACPD,GAEA,MAAO,cAAeA,EAOjB,SAASE,EAAaF,GAC3B,IAAKA,EACH,MAAM,IAAI/B,MAAM,2CAElB,GAAIuB,EAAY,CACd,GAAIO,EAAcC,GAChB,OAAO,IAAIJ,IAAmBI,EAASjH,KAEzC,GAAIkH,EAAoBD,GACtB,OAAO,IAAIG,IAAkBH,EAASnH,eAEnC,CACL,GAAIkH,EAAcC,GAChB,OAAOL,EACLK,EAAShH,QACL,IAAIoH,IAAIJ,EAASjH,IAAKiH,EAAShH,SAASqH,KACxCL,EAASjH,KAGjB,GAAIkH,EAAoBD,GACtB,OAAO,IAAIM,YAAUN,EAASnH,WAGlC,GA3BF,SAAwBmH,GACtB,MAAO,SAAUA,EA0BbO,CAAeP,GACjB,OAAO,IAAIQ,WAASR,EAASS,MAE/B,MAAM,IAAIxC,MAAM,0B,yTClCIyC,EAAtB,WAGE,aAAgC,IAApBC,EAAoB,uDAAJ,GAG1B,GAH8B,yBAFzB1I,QAEyB,EAGV,qBAAT2I,KAAsB,CAC/B,IAAMC,EAAOC,0BAAgBH,GAAQI,sBAAYJ,GAAQA,EACzDK,KAAK/I,GAAKqC,IAAWuG,EAAM,CAAEI,eAAe,IAAQC,MAAM,EAAG,QAE7DF,KAAK/I,GAAK,OAVhB,+FAiEyBkJ,GAjEzB,0FAkEW,MAlEX,6KAyE2BA,GAzE3B,0FA0EW,MA1EX,4IAiF6BC,GAAwC,WAAxB/D,EAAwB,uDAAJ,GAC7D,OAAOgE,YAAgB,uCAAU,WAAMC,GAAN,eAAAvH,EAAA,sEACT,EAAKwH,kBAAkBH,EAAO/J,QAASgG,GAD9B,OACzBmE,EADyB,OAE/BC,2BAAiBpE,EAAKgC,QACjBmC,EAIH,EAAKE,YAAYN,EAAQ/D,GACtBsE,KAAKC,YAAUC,6BAAmBxE,EAAKgC,UACvCyC,UAAUR,GAJbA,EAASS,WALoB,2CAAV,yDAlF3B,mDAgHIC,GAEA,WADA3E,EACA,uDADoB,GAEd4E,EAAMC,IAAK,WAAL,cACPF,EAAQG,KAAI,SAAAf,GACb,OAAOC,YAAgB,uCAAU,WAAMC,GAAN,eAAAvH,EAAA,sEACT,EAAKwH,kBAAkBH,EAAO/J,QAASgG,GAD9B,OACzBmE,EADyB,OAE/BC,2BAAiBpE,EAAKgC,QACjBmC,EAIH,EAAKE,YAAYN,EAAQ/D,GAAMyE,UAAUR,GAFzCA,EAASS,WALoB,2CAAV,4DAa3B,OAAI1E,EAAKgC,OACA4C,EAAIN,KAAKC,YAAUC,6BAAmBxE,EAAKgC,UAE7C4C,IArIX,iFA6IiC5K,GA7IjC,4FA6IkDgG,EA7IlD,+BA6IsE,GA7ItE,SA8I2B2D,KAAKoB,YAAY/E,GA9I5C,cA8IUgF,EA9IV,yBA+IWA,EAASC,SAASjL,IA/I7B,8GAuJO,SAASkL,EACdC,GAEA,MAAO,eAAgBA,EAYlB,SAASC,EACdD,GAEA,MAAO,sBAAuBA,I,iCC1MhC,gEASO,SAASnB,EACdrJ,EACAqH,GAEA,OAAOqD,IAAWC,QAAO,SAACrB,GACxB,IACE,IAAMsB,EAAM5K,EAAKsJ,GAEbsB,GAAOA,EAAIC,OACbD,EAAIC,OAAM,SAAC1F,GAAD,OAAkBmE,EAASnE,MAAMA,MAE7C,MAAOA,GAEPmE,EAASnE,MAAMA,OAEhBwE,KAAKC,YAAUC,6BAAmBxC,O,wCCxBvCyD,EAAOC,QAAU,suC,qBCAjBD,EAAOC,QAAU,IAA0B,kD,qBCA3CD,EAAOC,QAAU,IAA0B,6C,oMCiBnCC,EAAaC,OAAbD,SAEFE,E,4MACGlF,Y,0BAD6BC,QAYjB2B,E,WAcnB,WAAmBvD,GAA8C,IAC3D8G,EAD2D,OAA9B9F,EAA8B,uDAAJ,GAG3D,GAH+D,yBAbvDxD,SAauD,OAXvDuJ,WAWuD,OATvD9F,WASuD,OANvD+F,cAAqB,GAMkC,KAJzDC,mBAAoB,EAIqC,KAFzDH,iBAEyD,OAkDzDI,UAlDyD,uCAkD7C,WAClBC,EACAC,GAFkB,yBAAA1J,EAAA,6DAId0J,IAAMA,EAAKpE,YAAStE,GAJN,SAKgB,EAAKoI,YAAYO,OACjD,QACAF,EACAC,GARgB,cAKZE,EALY,OAUVtF,EAAwCsF,EAAxCtF,OAAQT,EAAgC+F,EAAhC/F,QAASI,EAAuB2F,EAAvB3F,OAAQ4F,EAAeD,EAAfC,WAC3BtE,EAAW,IAAIC,SAASlB,EAAQ,CAAEL,SAAQ4F,aAAYhG,YAX1C,kBAYX0B,GAZW,2CAlD6C,wDAE3D0D,IAAUG,EAAcH,EAASG,cAChCA,EACH,MAAM,IAAIlF,MACR,kEAOJ,GALA+C,KAAKmC,YAAcA,EAEnBnC,KAAKnH,IAAMwC,EAGPA,EAAOwH,WAAW,WAAY,CAChC,IAAMC,EAAOC,IAAS1H,GACtB,IAAKyH,EAAM,MAAM,IAAIE,UAAU,oBAC/B,IAAMC,EAAY,IAAI9D,IAAkB2D,GAIxC,OAHA9C,KAAKkD,KAAOD,EAAUC,KAAKC,KAAKF,GAChCjD,KAAKoD,SAAWH,EAAUG,SAASD,KAAKF,QACxCjD,KAAKqD,KAAOJ,EAAUI,KAAKF,KAAKF,IAIlC,IAAMK,EAAWjH,EAAKC,OAAS2F,OAAO3F,MACtC,IAAKA,MACH,MAAM,IAAI0G,UAAJ,oEAIRhD,KAAK1D,MAAQgH,EAETjH,EAAKkH,YACPvD,KAAKqC,cAAgBhG,EAAKkH,W,2GAK5BjF,G,0EAE+B,oBAApBA,EAASjB,O,yCACXiB,EAASjB,U,UAEkB,oBAAzBiB,EAASlB,Y,gCACCkB,EAASlB,c,cAAtBoG,E,yBACClG,EAAOC,KAAKiG,I,aAEf,IAAIR,UACR,iF,0KAoBF3G,G,8FAEK2D,KAAK1D,M,sBACF,IAAIW,MACR,iE,UAEC+C,KAAKnH,I,sBACF,IAAIoE,MAAM,oB,cAEZwG,EAAUzD,KAAKsC,kBAAoBtC,KAAKuC,UAAYvC,KAAK1D,M,EACdD,EAAzCO,e,MAAU,G,EAAIyB,EAA2BhC,EAA3BgC,O,EAA2BhC,EAAnBkH,iB,MAAY,G,EACpCG,E,yBACJ9G,UACAL,OAAQ,MACRoH,SAAU,SACVC,KAAM,OACNvF,UACG2B,KAAKqC,eACLkB,G,mBAIcE,EAAQzD,KAAKnH,IAAK6K,G,QAAnCpF,E,4DAEKuF,2BAAiB,EAAD,I,qBACf7D,KAAKsC,kB,2CAGTpG,QAAQ4H,KAAK,6CAAb,MACA9D,KAAKsC,mBAAoB,E,kBAClBtC,KAAK+D,SAAS1H,I,kCAMpB2D,KAAKoC,QAEJsB,EAAe9G,SAAW8G,EAAe9G,QAAQC,OAC7CmH,EAAe1F,EAAS1B,QAAQ7F,IAAI,kBACpCkN,EAAY,WAAW/F,KAAK8F,GAAgB,MACjCC,EAAU,KACzBjE,KAAKoC,MAAQ,CAAE1E,KAAMS,SAAS8F,EAAU,GAAI,QAExCC,EAAgB5F,EAAS1B,QAAQ7F,IAAI,qBACxBiJ,KAAKoC,MAAQ,CAAE1E,KAAMS,SAAS+F,EAAe,O,kBAG7D5F,G,sRAIA0B,KAAK+D,SAAS,CAAER,UAAW,CAAEhH,OAAQ,W,0KAI5Cc,G,sGACA8G,E,+BAAS,EACTlJ,E,uBACAmJ,E,+BAAW,GACX/H,E,+BAA0B,IAErBO,QAAUP,EAAKO,SAAW,GAC3B3B,EAASoJ,IACXhI,EAAKO,QAAQC,MAAb,gBAA8BuH,EAA9B,YAA0CA,EAAWnJ,GAC5CA,IAAWoJ,KAAyB,IAAbD,IAChC/H,EAAKO,QAAQC,MAAb,gBAA8BuH,EAA9B,M,SAGqBpE,KAAK+D,SAAS1H,G,WAEd,OAFjBiC,E,QAEMtB,QAA+B,IAAboH,IACR,MAApB9F,EAAStB,O,kCAEkBgD,KAAKsE,sBAAsBhG,G,eAAhDiG,E,OACAC,EAAcD,EAAaE,KAC/BpH,EACA8G,EACA,EACAO,KAAKC,IAAI1J,EAAQsJ,EAAatJ,S,kBAGzB,CAAE2J,UAAWJ,EAAanH,W,cAI7B,IAAIJ,MAAJ,eAAkBqB,EAAStB,OAA3B,qBAA8CgD,KAAKnH,M,mRAQlC,kBAJvB4D,E,+BAAsC,KAKpCoI,EAAWpI,EACXJ,EAAO,KAEPwI,EAAWpI,EAAQoI,gBACnBxI,EAAOI,GACKoI,U,SAES7E,KAAK+D,SAAS1H,G,UACb,OADlBiC,E,QACOtB,O,sBACL8H,EAAM,IAAI5C,EAAJ,eACF5D,EAAStB,OADP,qBAC0BgD,KAAKnH,OAEvCmE,OAASsB,EAAStB,OAChB8H,E,UAES,SAAbD,E,0CACKvG,EAASyG,Q,YAEdF,E,uBACI,IAAI5H,MAAJ,gCAAmC4H,I,iCAEpC7E,KAAKsE,sBAAsBhG,I,iPAI7B0B,KAAKoC,M,gCAAapC,KAAKgF,Y,UACvBhF,KAAKoC,M,gCAAapC,KAAKkD,KAAK5F,EAAO2H,YAAY,IAAK,EAAG,GAAI,G,UAC3DjF,KAAKoC,M,sBACF,IAAInF,MAAJ,8CAAiD+C,KAAKnH,M,gCACvDmH,KAAKoC,O,8WCvMV8C,E,WAGJ,WAAYC,GAA+B,yBAFnCA,gBAEmC,EACzCnF,KAAKmF,WAAaA,E,0FAGTf,EAAkBnJ,G,2FACS+E,KAAKmF,WAAWjC,KAClD5F,EAAO2H,YAAYhK,GACnB,EACAA,EACAmJ,G,uBAJM/G,E,EAAAA,OAAQuH,E,EAAAA,U,kBAMTvH,EAAOA,OAAO6C,MAAM,EAAG0E,I,oHAObQ,E,kDAYnB,WAAmBC,GAAyC,2BAC1D,cAAMA,IAZAC,SAWoD,EAE1D,IAlBkCtG,EAkB5BuG,EAAcC,yBAAeH,EAAQ,eAFe,OAG1D,EAAKC,IAAM,IAAIG,IAAS,CACtBC,MApBgC1G,EAoBJuG,EAnBzB,IAAIL,EAAyBhG,uBAAaF,OAeW,E,0LASnCgB,KAAKsF,IAAIK,c,cAA1BC,E,yBACCA,EAASC,YAAY1E,KAAI,SAAA2E,GAAG,OAAIA,EAAIvK,S,mLAGzBwK,G,+FACK/F,KAAKsF,IAAIK,c,OAIhC,IAJMC,E,OACEI,EAAgBJ,EAAhBI,YACJC,EAAmBD,EAAYA,EAAY/K,OAAS,GAE/CJ,EAAImL,EAAY/K,OAAS,EAAGJ,GAAK,EAAGA,GAAK,GAC1CD,EAAIoL,EAAYnL,KACb,EAAIkL,IACXE,EAAmBrL,G,yBAGhBqL,G,yIAGG7F,GAAwC,WAAxB/D,EAAwB,uDAAJ,GAC9C,OAAOgE,YAAgB,uCAAgB,WAAMC,GAAN,uBAAAvH,EAAA,6DACpB+M,EAAoB1F,EAA7B/J,QAAcG,EAAe4J,EAAf5J,MAAOE,EAAQ0J,EAAR1J,IACrBqP,EAAY1J,EAAZ0J,QAF6B,SAGnB,EAAKG,cAAcH,GAAW,KAHX,cAG/BjJ,EAH+B,gBAKf,EAAKwI,IAAIa,kBAC7B,KACA,CAAE3P,QAAOsP,MAAKpP,OACd,CAAEF,QAAOsP,MAAKpP,OACd,KACAoG,GAVmC,cAY7BsJ,SAAQ,SAAAC,GACd/F,EAASgG,KAAKD,MAEhB/F,EAASS,WAf4B,4CAAhB,sDAgBpB1E,EAAKgC,U,8CAxD4BqB,4B,+CCzDxCoC,EAAOC,QAAU,WACf,OAAO,IAAIwE,OAAO,IAA0B,oC,45OCDhBC,EAK5B,cAAwC,IAA1BjL,EAA0B,EAA1BA,KAA0B,yBAFxCA,KAAO,GAGLyE,KAAKzE,KAAOA,GCAKkL,E,kDAKnB,WAAYC,GAIT,MAKD,GALC,qBACD,cAAMA,IATRC,oBAQG,IANHC,kBAMG,EAED,EAAKD,eAAiBD,EAAMC,eAC5B,EAAKC,aAAeF,EAAME,cAErB,EAAKD,eACR,MAAM,IAAI1J,MAAJ,iDAAoD,EAAK1B,OAEjE,IAAKsL,0BAAgB,EAAKD,cAAcE,KACtC,MAAM,IAAI7J,MAAJ,UACD,EAAK1B,KADJ,0BAC0B,EAAKqL,aAAarL,KAD5C,4BATP,S,4FAgBUwL,G,0FACJ,CAAEC,QAASC,IAAMC,cAAclH,KAAK2G,eAAgBI,EAAO,Q,6IAQlE,OAAO,M,GAlC+BP,GCFrBW,E,kDAKnB,WAAYT,GAIT,MAID,GAJC,qBACD,cAAMA,IATRU,kBAQG,IANHR,kBAMG,EAED,EAAKQ,aAAeV,EAAMU,aAC1B,EAAKR,aAAeF,EAAME,cACrB,EAAKQ,aACR,MAAM,IAAInK,MAAJ,mDAAsD,EAAK1B,OALlE,S,UAToCiL,GCEpBa,E,kDAOnB,WAAYX,GAIT,MAID,GAJC,qBACD,cAAMA,IAXRY,gBAUG,IARHV,kBAQG,IANHW,aAA8B,GAQ5B,EAAKD,WAAaZ,EAAMY,WACxB,EAAKV,aAAeF,EAAME,cACrB,EAAKU,WACR,MAAM,IAAIrK,MAAJ,0CAA6C,EAAK1B,OAE1D,IAAK,EAAKqL,aACR,MAAM,IAAI3J,MAAJ,6CAAgD,EAAK1B,OAE7D,IAAKsL,0BAAgB,EAAKD,cAAcE,KAAM,CAC5C,IAAMvL,EAAO,EAAKqL,aAAe,EAAKA,aAAarL,KAAO,UAC1D,MAAM,IAAI0B,MAAJ,UAAa1B,EAAb,4BAZP,S,2DAgBYiM,GACbxH,KAAKuH,aAAaE,KAAKD,O,GA5BYhB,GCAlBkB,E,kDAWnB,WAAYhB,GAOT,MAOD,GAPC,qBACD,cAAMA,IAlBRY,gBAiBG,IAfHV,kBAeG,IAbHD,oBAaG,IAXHgB,eAWG,IATHC,cASG,EAED,EAAKN,WAAaZ,EAAMY,WACxB,EAAKV,aAAeF,EAAME,aAC1B,EAAKD,eAAiBD,EAAMC,eAC5B,EAAKgB,UAAYjB,EAAMiB,UACvB,EAAKC,SAAWlB,EAAMkB,UACjB,EAAKN,WACR,MAAM,IAAIrK,MAAJ,4CAA+C,EAAK1B,OAE5D,IAAK,EAAKqL,aACR,MAAM,IAAI3J,MAAJ,+CAAkD,EAAK1B,OAE/D,IAAK,EAAKoL,eACR,MAAM,IAAI1J,MAAJ,iDAAoD,EAAK1B,OAEjE,IAAK,EAAKoM,UACR,MAAM,IAAI1K,MAAJ,4CAA+C,EAAK1B,OAE5D,IAAK,EAAKqM,SACR,MAAM,IAAI3K,MAAJ,2CAA8C,EAAK1B,OAE3D,IAAKsL,0BAAgB,EAAKD,cAAcE,KAAM,CAC5C,IAAMvL,EAAO,EAAKqL,aAAe,EAAKA,aAAarL,KAAO,UAC1D,MAAM,IAAI0B,MAAJ,UAAa1B,EAAb,4BAxBP,S,UAlBoCiL,GCKpBqB,E,kDAOnB,WAAYnB,GAIT,MAID,GAJC,qBACD,cAAMA,IAXRC,oBAUG,IARHW,gBAQG,IANHC,aAA8B,GAQ5B,EAAKZ,eAAiBD,EAAMC,eAC5B,EAAKW,WAAaZ,EAAMY,YACnB,EAAKX,eACR,MAAM,IAAI1J,MAAJ,6CAAgD,EAAK1B,OAE7D,IAAK,EAAK+L,WACR,MAAM,IAAIrK,MAAJ,yCAA4C,EAAK1B,OARxD,S,2DAYYiM,GACbxH,KAAKuH,aAAaE,KAAKD,O,GAxBWhB,GCNjBsB,E,kDAcnB,WAAYpB,GAUT,MAOD,GAPC,qBACD,cAAMA,IAxBRqB,aAuBG,IArBHnB,kBAqBG,IAnBHoB,sBAmBG,IAjBHrB,oBAiBG,IAZHW,gBAYG,EAED,EAAKS,QAAUrB,EAAMqB,QACrB,EAAKC,iBAAmBtB,EAAMsB,iBAC9B,EAAKpB,aAAeF,EAAME,aAC1B,EAAKU,WAAaZ,EAAMY,WACxB,EAAKX,eAAiBD,EAAMC,gBACvB,EAAKA,eACR,MAAM,IAAI1J,MAAJ,+CAAkD,EAAK1B,OAE/D,IAAK,EAAK+L,WACR,MAAM,IAAIrK,MAAJ,2CAA8C,EAAK1B,OAX1D,S,UAxBmCiL,GCCnByB,E,kDAanB,WAAYvB,GAQT,MAQD,GARC,qBACD,cAAMA,IArBRY,gBAoBG,IAlBHV,kBAkBG,IAhBHsB,iBAgBG,IAdHC,iBAcG,IAZHtP,SAYG,IAVHuP,2BAUG,EAED,EAAKd,WAAaZ,EAAMY,WACxB,EAAKV,aAAeF,EAAME,aAC1B,EAAKsB,YAAcxB,EAAMwB,YACzB,EAAKC,YAAczB,EAAMyB,YACzB,EAAKtP,IAAM6N,EAAM7N,IACjB,EAAKuP,sBAAwB1B,EAAM0B,uBAC9B,EAAKd,WACR,MAAM,IAAIrK,MAAJ,+CAAkD,EAAK1B,OAC/D,IAAK,EAAKqL,aACR,MAAM,IAAI3J,MAAJ,iDAAoD,EAAK1B,OAXhE,S,UArBuCiL,GCJxC6B,EAAqB,EAEnBC,EAA+C,IAAIC,QAgDzD,IAAMC,EAA0D,IAAIC,IAQ7D,SAASC,EAAT,GAE4B,IADjCC,EACiC,EADjCA,cAEIC,EAA2BJ,EAA0BzR,IAAI4R,GAK7D,OAJKC,IACHA,EAA2B,IAAIC,gBAC/BL,EAA0BM,IAAIH,EAAeC,IAExCA,EAAyBvK,O,ICzDb0K,E,kDAKnB,WAAYC,GAA8B,kCACxC,cAAM,CAAEzN,KAAM,MALhByN,mBAI0C,IAF1CzN,KAAO,UAIL,EAAKyN,cAAgBA,EAFmB,E,wGAKjBrJ,G,0FAChBA,G,sLAIPsJ,G,4EAEQ5K,EAAW4K,EAAX5K,UDcS,kBAHnBmD,ECVoCnD,IDcxB,OAAVmD,KACA,kBAAmBA,IAEY,kBAAxBA,EAAMmH,e,oEChBCM,G,IAAgB5K,OAAQqK,EAAuBrK,M,2DAEjD4K,G,IAAgB5K,YAAQtE,K,iCDMjC,IACLyH,I,qICJc0H,G,uEACN,IAAIjM,MAAM,8B,iLAGIkM,G,0FACbA,G,mLAGeC,G,0FACfA,G,uGAjCgC5C,G,ujBC+BrC6C,GAAO,IAAI1O,OAjCA,CACf,IACA,IACA,KACA,OACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,IACA,MACA,KACA,IACA,MACA,OACA,QACA,SACA,QACA,QACA,KACA,QACA,KACA,QACA,KACA,IACA,MAI+BwG,KAAI,SAAAmI,GAAG,iBAAQA,EAAR,gBAAwBC,KAAK,KAAM,KAK5D,SAASC,GAAT,GAAmD,IAJ3CC,EAIiBC,EAA0B,EAA1BA,KAChCC,GALeF,EAKAC,EAJdL,GAAKvN,KAAK2N,GAIYC,EAAOE,KAAWF,IAG/C,OAAO,yBAAKG,wBAAyB,CAAEC,OAAQC,KAAUC,SAASL,MCpC7D,IAAMM,GAAYC,cAAW,SAAAC,GAAK,MAAK,CAC5CC,sBAAuB,CACrB5C,QAAS,QACT6C,QAASF,EAAMG,QAAQ,IAEzBC,WAAY,CACVC,MAAO,WAETC,UAAW,CACTC,WAAYP,EAAMQ,QAAQC,KAAK,MAEjCC,MAAO,CACLrD,QAAS,QAEXsD,UAAW,CACTC,UAAW,YACXC,SAAU,OACVC,SAAU,QACVC,aAAc,kBACdC,gBAAiBhB,EAAMQ,QAAQC,KAAK,KACpCQ,YAAajB,EAAMG,QAAQ,GAC3BD,QAASF,EAAMG,QAAQ,KAEzBe,WAAY,CACVN,UAAW,aACXO,UAAW,IACXjB,QAASF,EAAMG,QAAQ,IACvBiB,SAAU,QAEZC,cAAe,CACbT,UAAW,aACXO,UAAW,IACXjB,QAASF,EAAMG,QAAQ,IACvBa,gBAAiBhB,EAAMQ,QAAQC,KAAK,KACpCa,OAAQ,aAAF,OAAetB,EAAMQ,QAAQC,KAAK,MACxCc,UAAW,aACXH,SAAU,YAGRI,GAAsB,CAC1B,WACA,cACA,OACA,SACA,QAOWC,GAA6C,SAAA7E,GACxD,IAAM8E,EAAU5B,KACR6B,EAAoB/E,EAApB+E,SAAUC,EAAUhF,EAAVgF,MAClB,OACE,kBAACC,GAAA,EAAD,CAAWC,MAAO,CAAEC,UAAW,OAASC,iBAAe,GACrD,kBAACC,GAAA,EAAD,CACE7B,WAAY,kBAAC,KAAD,CAAY8B,UAAWR,EAAQtB,cAE3C,kBAAC,KAAD,CAAY+B,QAAQ,UAApB,IAA+BP,IAEjC,kBAACQ,GAAA,EAAD,CAAkBF,UAAWR,EAAQzB,uBAClC0B,KAWIU,GAAkB,SAACzF,GAC9B,IAAM8E,EAAU5B,KACRwC,EAAY1F,EAAZ0F,QACApW,EAAgCoW,EAAhCpW,QAASG,EAAuBiW,EAAvBjW,MAAOE,EAAgB+V,EAAhB/V,IAAKgW,EAAWD,EAAXC,OACvBC,EAAoC,CACxC,KAAM,IACN,EAAK,GACL,EAAK,KAEDC,EAAYD,EAAUD,GAAV,WAAwBC,EAAUD,GAAlC,KAA+C,GAC3DG,EAAwC,2BACzCJ,GADsC,IAEzCxR,OAAQvE,EAAMF,EACd4N,SAAU,GAAF,OAAK/N,EAAL,YAAgBG,EAAQ,EAAxB,aAA8BE,EAA9B,YAAqCkW,KAG/C,OACE,kBAAC,GAAD,iBAAc7F,EAAd,CAAqBgF,MAAM,iBACxBJ,GAAoBxK,KAAI,SAAA2L,GACvB,IAAMnD,EAAQkD,EAAiBC,EAAIC,eAC7BC,EAAWlO,OAAO6K,GACxB,OAAiB,OAAVA,QAA4B5P,IAAV4P,EACvB,yBAAK0C,UAAWR,EAAQhB,MAAOiC,IAAKA,GAClC,yBAAKT,UAAWR,EAAQf,WAAYgC,GACpC,yBAAKT,UAAWR,EAAQR,YACtB,kBAAC7B,GAAD,CAAeE,KAAMsD,MAGvB,UAMNC,GAAO,CACX,OACA,QACA,MACA,SACA,UACA,OACA,SACA,WACA,cACA,WACA,cAUWC,GAAgD,SAAhDA,EAAgDnG,GAC3D,IAAM8E,EAAU5B,KAEdkD,EAQEpG,EARFoG,WAHkE,EAWhEpG,EAPFkG,KAAMG,OAJ4D,MAIjD,GAJiD,IAWhErG,EANFsG,iBALkE,MAKtD,SAAC1D,GAAD,OACV,kBAACH,GAAD,CACEE,KAAM4D,KAAS3D,GAAS4D,KAAKC,UAAU7D,GAAS7K,OAAO6K,MAPO,EAUlE8D,EACE1G,EADF0G,aAGIC,EAAc,SAAC,GAAkD,IAAhDnS,EAAgD,EAAhDA,KAAMoO,EAA0C,EAA1CA,MACrBxB,EAAcsF,GAAgBA,EAAalS,GACjD,OAAOoO,EACL,yBAAKsC,MAAO,CAAEzE,QAAS,SACpBW,EACC,kBAAC,KAAD,CAAS4D,MAAO5D,EAAawF,UAAU,QACrC,yBAAKtB,UAAWR,EAAQf,WAAYvP,IAGtC,yBAAK8Q,UAAWR,EAAQf,WAAYvP,GAEtC,yBAAK8Q,UAAWR,EAAQR,YAAagC,EAAU1D,KAE/C,MAEAiE,EAAa,SAAC,GAAoD,IAAlDrS,EAAkD,EAAlDA,KAAMoO,EAA4C,EAA5CA,MACpBxB,EAAcsF,GAAgBA,EAAalS,GACjD,OACE,yBAAK0Q,MAAO,CAAEzE,QAAS,SACpBW,EACC,kBAAC,KAAD,CAAS4D,MAAO5D,EAAawF,UAAU,QACrC,yBAAKtB,UAAWR,EAAQf,WAAYvP,IAGtC,yBAAK8Q,UAAWR,EAAQf,WAAYvP,GAErCoO,EAAMxI,KAAI,SAAC0M,EAAKhT,GAAN,OACT,yBAAKiS,IAAG,UAAKvR,EAAL,YAAaV,GAAKwR,UAAWR,EAAQL,eAC3C,kBAAChC,GAAD,CACEE,KAAM4D,KAASO,GAAON,KAAKC,UAAUK,GAAO/O,OAAO+O,WAQ/D,OACE,oCACG5U,OAAOiE,QAAQiQ,GACbW,QACC,mCAAE3Q,EAAF,iBACQpD,IADR,OACsBkT,GAAK3L,SAASnE,KAAOiQ,EAAS9L,SAASnE,MAE9DgE,KAAI,YAAkB,uBAAhB2L,EAAgB,KAAXnD,EAAW,KACrB,OAAI5O,MAAMC,QAAQ2O,GACQ,IAAjBA,EAAM1O,OACX,kBAACyS,EAAD,CAAaZ,IAAKA,EAAKvR,KAAMuR,EAAKnD,MAAOA,EAAM,KAE/C,kBAACiE,EAAD,CAAYd,IAAKA,EAAKvR,KAAMuR,EAAKnD,MAAOA,IAGxC2D,KAAS3D,GAET,kBAACuD,EAAD,CACEJ,IAAKA,EACLK,WAAYxD,EACZ8D,aAAcA,IAKb,kBAACC,EAAD,CAAaZ,IAAKA,EAAKvR,KAAMuR,EAAKnD,MAAOA,SAM7CoE,GAAiB,SAAChH,GAAqB,IAC1C0F,EAA0B1F,EAA1B0F,QAASgB,EAAiB1G,EAAjB0G,aACjB,OACE,kBAAC,GAAD,iBAAc1G,EAAd,CAAqBgF,MAAM,eACzB,kBAAC,GAAD,iBAAgBhF,EAAhB,CAAuBoG,WAAYV,EAASgB,aAAcA,OAYnDO,GAAqB1N,oBAAS,SAACyG,GAC1C,IAAM8E,EAAU5B,KACR9S,EAAwB4P,EAAxB5P,MAAOsW,EAAiB1G,EAAjB0G,aACTQ,EAAOV,KAAKW,MAAMX,KAAKC,UAAUrW,EAAMgX,cAC7C,OACE,kBAACC,GAAA,EAAD,CAAO/B,UAAWR,EAAQpB,WACxB,kBAAC,GAAD,eAAiBgC,QAASwB,GAAUlH,IACpC,kBAACsH,GAAA,EAAD,MACA,kBAAC,GAAD,eAAgB5B,QAASwB,GAAUlH,EAAnC,CAA0C0G,aAAcA,S,mBCjPvD,SAASa,GACdC,EACAC,EACAC,EACAC,GAGA,OAAIF,EAASC,GAASF,EAAQG,GAAUA,EAASD,GAASD,EAASD,EAC7DA,EAAQE,EACND,EAASE,EAGJ,CAACH,EAAOC,GAIV,CAACD,EAAOG,GAEbF,EAASE,EAGJ,CAACD,EAAOD,GAIV,CAACC,EAAOC,GAEV,GAaF,SAASC,GACdJ,EACAC,EACAC,EACAC,GAEA,OAAOF,EAASC,GAASF,EAAQG,EAW5B,SAASE,GACdL,EACAC,EACAC,EACAC,GAEA,OAAOD,GAASF,GAASG,GAAUF,ECpE9B,IAAMK,GAAb,WAGE,aAAsC,IAA1BC,EAA0B,uDAAJ,GAAI,yBAFtCA,OAAsB,GAGpB9O,KAAK8O,OAASA,EAJlB,iDAOOC,GACH,GAAIA,aAAiBC,IACfhP,KAAK8O,OAAO7T,OAAQ,CACtB,IAAMgU,EAAYjP,KAAK8O,OAAO9O,KAAK8O,OAAO7T,OAAS,GACnD,GAAIgU,aAAqBD,GAEvB,YADAC,EAAUxH,KAAKsH,GAMrB/O,KAAK8O,OAAOrH,KAAKsH,KAlBrB,kCAsBI,OAAO/O,KAAK8O,SAtBhB,mCA0BI,OAAO9O,KAAK8O,OAAO3N,KAAI,SAAA4N,GAAK,OAAIA,EAAMG,gBA1B1C,0BA6BmBlY,EAAemY,GAC9B,OAAOnP,KAAK8O,OAAO3N,IAAInK,EAAMmY,KA9BjC,8BAiCuBnY,EAAemY,GAClC,OAAOnP,KAAK8O,OAAO1I,QAAQpP,EAAMmY,KAlCrC,6BAsCI,OAAOnP,KAAK8O,OAAO7T,SAtCvB,mCA0CI,OAAO+E,KAAK8O,OAAO7T,OACf+E,KAAK8O,OAAO3N,KAAI,SAAA2N,GAAM,OAAIA,EAAOM,WAASC,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,KAC/D,IA5CR,+BAgDI,OAAOgH,KAAK8O,OAAO7T,OAAS+E,KAAK8O,OAAO,GAAGQ,SAAW,IAhD1D,oCAoDI,OAAOtP,KAAK8O,OAAOhB,QAAO,SAAAiB,GAAK,OAAIA,aAAiBQ,QApDxD,8BAwDI,OAAOvP,KAAKwP,cACTrO,KAAI,SAAA4N,GAAK,OAAIA,EAAMrY,IAAMqY,EAAMvY,SAC/B6Y,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,OA1D/B,KA8DayW,GAAb,WAkBE,WAAY5P,GAAW,yBAdhBxJ,aAcgB,OAZhBG,WAYgB,OAVhBE,SAUgB,OARhBiB,kBAQgB,OANhBmV,SAMgB,EACrB7T,OAAOyW,OAAO1P,KAAMH,GACpBG,KAAKrI,aAAekI,EAAKlI,aACzBqI,KAAK3J,QAAUwJ,EAAKxJ,QACpB2J,KAAKxJ,MAAQqJ,EAAKrJ,MAClBwJ,KAAKtJ,IAAMmJ,EAAKnJ,IAChBsJ,KAAK8M,IAAMjN,EAAKiN,IAxBpB,4DAkCkBzW,GACd,OAAI2J,KAAK3J,SAAWA,IAAY2J,KAAK3J,QAE5B,IAAK2J,KAAK9E,YAAV,2BAAmC8E,MAAnC,IAAyC3J,aAE3C2J,OAvCX,iCA2CI,MAAO,CACL3J,QAAS2J,KAAK3J,QACdG,MAAOwJ,KAAKxJ,MACZE,IAAKsJ,KAAKtJ,IACViB,aAAcqI,KAAKrI,aACnBP,SAAU4I,KAAK5I,cAhDrB,KAqDamY,GAAb,4HAAkCE,IAMrBT,GAAb,kDAIE,WAAYnP,GAA2B,kCACrC,cAAMA,IAJDuP,aAGgC,EAErC,EAAKA,QAAUvP,EAAKuP,QAFiB,EAJzC,iDASOO,GACH3P,KAAK4P,kBAAoB,EAErBD,IACF3P,KAAK3J,QAAU,GACf2J,KAAKxJ,MAAQ,EACbwJ,KAAKtJ,IAAM,EACXsJ,KAAKoP,SAAWO,EAAWP,aAhBjC,GAAiCK,IAyBpBI,GAAb,4HAA6CJ,ICvH9B,SAASK,GACtB3Y,GAGA,IAFAkT,IAEA,yDADA0F,IACA,yDAEET,EAMEnY,EANFmY,SACAU,EAKE7Y,EALF6Y,iBACAjK,EAIE5O,EAJF4O,QACAkK,EAGE9Y,EAHF8Y,MACAC,EAEE/Y,EAFF+Y,kBACAC,EACEhZ,EADFgZ,wBAGF,IAAKF,EACH,MAAM,IAAIhT,MAAM,wDAElB,IAAM6R,EAAS,IAAID,GACfuB,EAAwB,EACtBC,EAAef,EACfgB,EAAgBD,EAAeJ,EAuHrC,OAtHAD,EAAiB5J,SAAQ,SAAChG,EAAQmQ,GAAiB,IAE/C5Y,EAKEyI,EALFzI,aACAtB,EAIE+J,EAJF/J,QACOma,EAGLpQ,EAHF5J,MACKia,EAEHrQ,EAFF1J,IACAU,EACEgJ,EADFhJ,SAEIsZ,EACJN,GAAyBK,EAAYD,GAAezK,EAEhD4K,GAAiBF,EAAYD,GAAezK,EAElD,GACEqK,EAAwBE,GACxBI,EAAyBL,EACzB,KAQI7Z,EACAE,EACAka,EACAC,EACAC,EAZJ,EAE0BxC,GACxB+B,EACAC,EACAF,EACAM,GANF,mBAEOK,EAFP,KAEeC,EAFf,KAaI5Z,GACFZ,EAAQkO,KAAKuM,IACXT,EACAC,GAAaO,EAAUZ,GAAyBrK,GAGlD6K,GADAla,EAAM+Z,GAAaM,EAASX,GAAyBrK,KAChB0K,EACrCI,EAA8Bra,IAAUga,EACxCM,EAAgBV,GAAyBK,EAAY/Z,GAAOqP,IAO5D6K,GALApa,GAASua,EAASX,GAAyBrK,EAAUyK,KAKdA,EACvCK,GALAna,EAAMgO,KAAKC,IACT8L,GACCO,EAAUZ,GAAyBrK,EAAUyK,MAGVC,EACtCK,EAAgBV,GAAyB5Z,EAAQga,GAAezK,GAElE,IACMmL,EAAY,CAChBvZ,eACAtB,UACAG,QACAE,MACAU,WACAkY,SAAUwB,EACVK,aAAc/Q,EACdmQ,eACAnB,SAVe1Y,EAAMF,GAASuP,EAW9B6K,6BACAC,8BACA/D,IAAK,IAEPoE,EAAUpE,IAAV,UAAmBsE,6BAAkBF,GAArC,YAAmDX,GAAnD,OACEnZ,EAAW,YAAc,IAGvBiT,GAA6B,IAAlByE,EAAO7T,QAAgB2V,GACpC9B,EAAOrH,KACL,IAAIoI,GAAwB,CAC1B/C,IAAK,GAAF,OAAKoE,EAAUpE,IAAf,sBACHsC,SAAUE,EACVA,SAAU4B,EAAU5B,SAAWA,EAC/BhD,QAAS,cAKXyD,GAAWY,EAAgBT,EAC7BpB,EAAOrH,KAAK,IAAIuH,GAAYkC,IAE5BpC,EAAOrH,KAAK,IAAI8H,GAAa2B,IAG3B7G,IAGAsG,GAAiBT,GACjBgB,EAAUL,6BACVN,EAAeP,EAAiB/U,OAAS,GAEzC6T,EAAOrH,KACL,IAAIoI,GAAwB,CAC1B/C,IAAK,GAAF,OAAKoE,EAAUpE,IAAf,aACHsC,QAASe,EACTb,SAAU4B,EAAU5B,SAAW4B,EAAU9B,WAK7CmB,IAAiBP,EAAiB/U,OAAS,GAC3CiW,EAAUL,8BAEVC,EAAgBI,EAAU5B,SAAW4B,EAAU9B,QAC/CN,EAAOrH,KACL,IAAIoI,GAAwB,CAC1B/C,IAAK,GAAF,OAAKoE,EAAUpE,IAAf,oBACHsC,QAASa,EAAQa,EAAgBxB,EACjCA,SAAUwB,EACVxE,QAAS,gBAMnB8D,GAAyBD,EACzBC,IAA0BK,EAAYD,GAAezK,KAEhD+I,ECtJM,SAASuC,GACtBla,GASA,IARAkT,IAQA,yDAPA0F,IAOA,yDANAuB,EAMA,uDANQ,EAKRrB,EACA,uDADQhO,OAAOsP,YAAcpa,EAAM8Y,MAGjCX,EAKEnY,EALFmY,SACAU,EAIE7Y,EAJF6Y,iBACAjK,EAGE5O,EAHF4O,QACAmK,EAEE/Y,EAFF+Y,kBACAC,EACEhZ,EADFgZ,wBAGIqB,EAAelC,EAAWvJ,EAC1B0L,GAAiBnC,EAAWW,GAASlK,EACrC2L,EAAczB,EACd0B,EAAcjN,KAAKkN,KAAKF,EAAc3L,GAExC8L,EAAiB,EACf/C,EAAS,IAAID,GAiHnB,OAhHAmB,EAAiB5J,SAAQ,SAAChG,EAAQmQ,GAAiB,IAI/C5Y,EAKEyI,EALFzI,aACAtB,EAIE+J,EAJF/J,QACOma,EAGLpQ,EAHF5J,MACKia,EAEHrQ,EAFF1J,IACAU,EACEgJ,EADFhJ,SAEI0a,EAAmBpN,KAAKkN,MAAMnB,EAAYD,GAAemB,GAE3DI,EACFrN,KAAKsN,OAAOP,EAAgBI,GAAkBF,GAAeL,EAC3DS,GAAuBD,IACzBC,EAAsBD,EAAmB,GAE3C,IAAIG,EACFvN,KAAKsN,OAAOR,EAAeK,GAAkBF,GAAeL,EAC1DW,EAAqB,IAAGA,EAAqB,GAIjD,IAFA,IAAMtB,GAAiBF,EAAYD,GAAezK,EAG5CmM,EAAWD,EACfC,GAAYH,EACZG,GAAY,EACZ,CACA,IAAI1b,OAAa,EACbE,OAAW,EACXka,OAAmC,EACnCC,OAAoC,EACpCzZ,GACFZ,EAAQkO,KAAKuM,IAAIT,EAAaC,GAAayB,EAAW,GAAKP,GAE3Df,GADAla,EAAM+Z,EAAYyB,EAAWP,KACQlB,EACrCI,EAA8Bra,IAAUga,IAIxCI,GAFApa,EAAQga,EAAc0B,EAAWP,KAEMnB,EACvCK,GAFAna,EAAMgO,KAAKC,IAAI8L,EAAWD,GAAe0B,EAAW,GAAKP,MAEnBlB,GAExC,IACMS,EAAY,CAChBvZ,eACAtB,UACAG,QACAE,MACAU,WACAkY,UAAWuC,EAAiBK,EAAWP,GAAe5L,EACtDoL,aAAc/Q,EACdmQ,eACAnB,SAVe1Y,EAAMF,GAASuP,EAW9B6K,6BACAC,8BACA/D,IAAK,IAEPoE,EAAUpE,IAAV,UAAmBsE,6BAAkBF,GAArC,YAAmDX,GAAnD,OACEnZ,EAAW,YAAc,IAGvBiT,GAA4B,IAAjBkG,GAAmC,IAAb2B,GACnCpD,EAAOrH,KACL,IAAIoI,GAAwB,CAC1B/C,IAAK,GAAF,OAAKoE,EAAUpE,IAAf,sBACHsC,QAASa,EACTX,SAAU4B,EAAU5B,SAAWW,EAC/B3D,QAAS,cAKXyD,GAAWY,EAAgBT,EAC7BpB,EAAOrH,KAAK,IAAIuH,GAAYkC,IAE5BpC,EAAOrH,KAAK,IAAI8H,GAAa2B,IAG3B7G,IAGAsG,GAAiBT,GACjBgB,EAAUL,6BACVN,EAAeP,EAAiB/U,OAAS,GAEzC6T,EAAOrH,KACL,IAAIoI,GAAwB,CAC1B/C,IAAK,GAAF,OAAKoE,EAAUpE,IAAf,aACHsC,QAASe,EACTb,SAAU4B,EAAU5B,SAAW4B,EAAU9B,WAK7CmB,IAAiBP,EAAiB/U,OAAS,GAC3CiW,EAAUL,6BAEV/B,EAAOrH,KACL,IAAIoI,GAAwB,CAC1B/C,IAAK,GAAF,OAAKoE,EAAUpE,IAAf,oBACHsC,QAASa,EACTX,SAAU4B,EAAU5B,SAAW4B,EAAU9B,QACzC9C,QAAS,eAMnBuF,GAAkB1B,EAA0BpK,EAC5C8L,GAAkBpB,EAAYD,KAEzB1B,EC5IT,IAwPeqD,GAxPIvc,QAChBuB,MAAM,aAAc,CACnB6Y,iBAAkBpa,QAAMwc,MAAMlc,WAC9B6P,QAAS,EACTuJ,SAAU,IAEX+C,UAAS,iBAAO,CACfC,cAAUvY,EACVwY,cAAe,MAEhBjb,SAAQ,SAAAC,GAAI,MAAK,CAChBib,oBADgB,SACIxR,GAClBzJ,EAAKyY,iBAAmByC,eAAKzR,IAE/B0R,WAJgB,SAIL7E,GACTtW,EAAKwO,QAAU8H,GAEjB8E,iBAPgB,SAOC1C,GACf1Y,EAAKgb,cAAgBtC,OAGxB2C,OAAM,SAAArb,GAAI,MAAK,CACd,YACE,OAAOA,EAAKgb,eAGd,8BACE,OAAOvS,KAAK6S,QAAUtb,EAAKwO,SAG7B,gBAGE,OAAO/F,KAAK8S,wBADQ,IAItB,gBAGE,OADqB,GACb9S,KAAKiQ,OAEf,cACE,OAAO1Y,EAAKyY,iBACT7O,KAAI,SAAApI,GAAC,OAAIA,EAAErC,IAAMqC,EAAEvC,SACnB6Y,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,IAE7B,8BACE,OAAO,GAET,wBACE,OAAO,IAST+Z,OAtCc,YA8CX,IAPD1c,EAOC,EAPDA,QACA2c,EAMC,EANDA,MACAzC,EAKC,EALDA,aAMI0C,EAAW,EAETC,EAAQ3b,EAAKyY,iBAAiBmD,WAAU,SAACvY,EAAGwY,GAChD,OAAI/c,IAAYuE,EAAEvE,SAAW2c,GAASpY,EAAEpE,OAASwc,GAASpY,EAAElE,OAGtD6Z,GAAeA,IAAiB6C,IAClCH,GAAYrY,EAAExD,SAAWwD,EAAElE,IAAMsc,EAAQA,EAAQpY,EAAEpE,OAC5C,IAGXyc,GAAYrY,EAAElE,IAAMkE,EAAEpE,OACf,MAGT,GADoBe,EAAKyY,iBAAiBkD,GAExC,OAAOxO,KAAK2O,MAAMJ,EAAW1b,EAAKwO,UAMtCuN,OArEc,SAqEPC,GACL,IAAIC,EAAU,EACRC,GAAMlc,EAAK+X,SAAWiE,GAAMhc,EAAKwO,QACjC2N,EAAInc,EAAKyY,iBAAiB/U,OAChC,GAAIwY,EAAK,EAAG,CACV,IAAMrT,EAAS7I,EAAKyY,iBAAiB,GAC/B7L,EAASsP,EACf,kCACK1T,sBAAYK,IADjB,IAEEuT,KAAK,EACLX,MAAO5S,EAAOhJ,SACVsN,KAAKsN,MAAM5R,EAAO1J,IAAMyN,GAAU,EAClCO,KAAKsN,MAAM5R,EAAO5J,MAAQ2N,GAAU,EACxCA,SACA+O,MAAO,IAGX,GAAIO,GAAMzT,KAAK6S,QAAS,CACtB,IAAMzS,EAAS7I,EAAKyY,iBAAiB0D,EAAI,GACnCE,EAAMxT,EAAO1J,IAAM0J,EAAO5J,MAC1B2N,EAASsP,EAAKzT,KAAK6S,QAAUe,EACnC,kCACK7T,sBAAYK,IADjB,IAEEuT,KAAK,EACLxP,SACA6O,MAAO5S,EAAOhJ,SACVsN,KAAKsN,MAAM5R,EAAO1J,IAAMyN,GAAU,EAClCO,KAAKsN,MAAM5R,EAAO5J,MAAQ2N,GAAU,EACxC+O,MAAOQ,EAAI,IAGf,IAAK,IAAIR,EAAQ,EAAGA,EAAQ3b,EAAKyY,iBAAiB/U,OAAQiY,GAAS,EAAG,CACpE,IAAM9S,EAAS7I,EAAKyY,iBAAiBkD,GAC/BU,EAAMxT,EAAO1J,IAAM0J,EAAO5J,MAChC,GAAIod,EAAMJ,EAAUC,GAAMD,GAAWC,EAAI,CACvC,IAAMtP,EAASsP,EAAKD,EACpB,kCACKzT,sBAAYK,IADjB,IAEEuT,KAAK,EACLxP,SACA6O,MAAO5S,EAAOhJ,SACVsN,KAAKsN,MAAM5R,EAAO1J,IAAMyN,GAAU,EAClCO,KAAKsN,MAAM5R,EAAO5J,MAAQ2N,GAAU,EACxC+O,UAGJM,GAAWI,EAEb,MAAM,IAAI3W,MAAM,yCAGnB2V,OAAM,SAAArb,GAAI,MAAK,CACd,oBACE,OAAOuY,GAAuBvY,IAEhC,mBACE,OAAO8Z,GAAsB9Z,IAE/B,aACE,OAAOyI,KAAK6T,cACT1S,KAAI,SAAApI,GAAC,OAAIA,EAAErC,IAAMqC,EAAEvC,SACnB6Y,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,QAG9B1B,SAAQ,SAAAC,GAAI,MAAK,CAChBuc,YADgB,SACJxB,GACV/a,EAAK+a,SAAWA,GAKlByB,eAPgB,WAQdxc,EAAKwO,QAAUxO,EAAKsb,QAAUtb,EAAK0Y,MACnC1Y,EAAK+X,SAAW,GASlB0E,OAlBgB,SAkBTxd,EAAiBE,GAEtB,IAAI8c,EAAU,EAEd,GAAIhd,EAAM0c,QAAUxc,EAAIwc,MACtBM,GAAW9c,EAAIyN,OAAS3N,EAAM2N,WACzB,CACL,IAAM3I,EAAIjE,EAAKyY,iBAAiBxZ,EAAM0c,OAEtC,GADAM,GAAWhY,EAAE9E,IAAM8E,EAAEhF,MAAQA,EAAM2N,OAC/BzN,EAAIwc,MAAQ1c,EAAM0c,OAAS,EAC7B,IAAK,IAAIrY,EAAIrE,EAAM0c,MAAQ,EAAGrY,EAAInE,EAAIwc,MAAOrY,GAAK,EAChD2Y,GACEjc,EAAKyY,iBAAiBnV,GAAGnE,IAAMa,EAAKyY,iBAAiBnV,GAAGrE,MAG9Dgd,GAAW9c,EAAIyN,OAEjBnE,KAAKiU,OACHT,GACGjc,EAAK0Y,MACJ1Y,EAAK4Y,yBAA2BzZ,EAAIwc,MAAQ1c,EAAM0c,SAIxD,IADA,IAAIgB,EAAY,EACPrZ,EAAI,EAAGA,EAAItD,EAAKyY,iBAAiB/U,OAAQJ,GAAK,EAAG,CACxD,IAAMuF,EAAS7I,EAAKyY,iBAAiBnV,GACrC,GAAIrE,EAAM0c,QAAUrY,EAAG,CACrBqZ,GAAa1d,EAAM2N,OACnB,MAEA+P,GAAa9T,EAAO1J,IAAM0J,EAAO5J,MAGrCe,EAAK+X,SACH5K,KAAK2O,MAAMa,EAAY3c,EAAKwO,SAC5BxO,EAAK4Y,wBAA0B3Z,EAAM0c,OAGzCiB,QAxDgB,WAyDdnU,KAAKiU,OAAsB,EAAf1c,EAAKwO,UAGnBqO,OA5DgB,WA6DdpU,KAAKiU,OAAO1c,EAAKwO,QAAU,IAG7BkO,OAhEgB,SAgETI,GAA6C,IAAzBlQ,EAAyB,uDAAhB5M,EAAK0Y,MAAQ,EACzClK,EAAUsO,EAChB,GAAItO,IAAYxO,EAAKwO,QAArB,CACA,IAAMuO,EAAa/c,EAAKwO,QACxBxO,EAAKwO,QAAUA,EAGfxO,EAAK+X,SAAWiF,iBACd7P,KAAK2O,OAAQ9b,EAAK+X,SAAWnL,GAAUmQ,EAAcvO,EAAU5B,GAC/D5M,EAAKid,UACLjd,EAAKkd,aAITC,OA9EgB,SA8ETC,GACL,IAAMC,EAAcrd,EAAK+X,SAEnBuF,EAAcN,iBAClBhd,EAAK+X,SAAWqF,EAChBpd,EAAKid,UACLjd,EAAKkd,WAGP,OADAld,EAAK+X,SAAWuF,EACTA,EAAcD,OC/PZE,iCACb,qBACA,CACEvZ,KAAM,CACJuL,KAAM,SACNiO,aAAc,mBACd5M,YAAa,qCAEfxQ,aAAc,CACZwQ,YAAa,iDACbrB,KAAM,SACNiO,aAAc,iBAGlB,CAAEC,iBAAiB,EAAMC,mBAAoB,iBCdhC,YAAAjM,GACb,OAAO,2BACgB,CACnBzN,KAAM3F,QADa,WAEnBsf,OAAQtf,cAAYoT,4BAAZpT,YAHL,SAKI,SAAA2B,GAAI,MAAK,CAChB4d,YADgB,WAEd5d,UAAaA,EAAbA,gBAEF6d,aAJgB,YAKd,IAAMna,EAAS1D,cAAf,GACA,OAAOA,SAAY0D,EAAnB,IAEFoa,cARgB,YAUd,OADA9d,WACOA,EAAP,OAEF+d,MAZgB,kBCkBPC,GAtBO3f,QACnBuB,MAAM,WAAY,CACjBF,GAAItB,aACJuS,YAAatS,QAAMqC,MAAMrC,QAAMU,UAEhC+b,UAAS,kBACRpC,MAAO,QAER2C,OAAM,kBACL,gBACE,MAAO,QAGVtb,SAAQ,SAAAC,GAAI,MAAK,CAChBie,eADgB,SACDja,GACbhE,EAAK2Q,YAAc3M,GAErBka,SAJgB,SAIPC,GACPne,EAAK0Y,MAAQyF,O,qBCdZ,SAASC,GACdC,GAEA,IAAMC,EAAYD,EAAME,cAClBC,EAAqBvQ,yBAAeqQ,EAAW,iBACrD,IAAKE,EAAoB,CAGvB,IAAMC,EAASC,oBAAeL,EAAME,eACpC,GAAI,aAAcE,EAChB,MAAO,CAACxQ,yBAAewQ,EAAQ,SAGnC,OAAOD,EAKF,SAASG,GAAgBC,GAK9B,IADA,IAAIC,EACKC,EAAOF,GAAWG,iBAAOD,GAAOA,EAAOJ,oBAAUI,GACpD,iBAAkBA,IACpBD,EAAuBC,EAA8BE,cAGzD,IAAKH,EACH,MAAM,IAAInZ,MACR,4FAGJ,OAAOmZ,EASF,SAASI,GAAqBH,GACnC,IACE,IAAII,EAAcR,oBAAUI,IAC3BC,iBAAOG,GACRA,EAAcR,oBAAUQ,GAExB,GAAI,gBAAiBA,EACnB,OAAOA,EAAYC,YAIvB,MAAO,GAGF,IAAMC,GAAU,UACVC,GAAc,cAEpB,SAASC,GACdC,EACAC,EACA7D,GAEA,SAAS8D,EAAahY,GACpB,GAAiB,QAAb+X,EACF,MAAO,CAAEhf,IAAKiH,GAEhB,GAAiB,cAAb+X,EACF,MAAO,CAAElf,UAAWmH,GAEtB,MAAM,IAAI/B,MAAJ,2BAA8B8Z,IAEtC,MAAI,UAAUjb,KAAKgb,GACV,CACLhQ,KAAM,aACNmQ,YAAaD,EAAaF,GAC1B5D,MAAO,CACLlU,SAAUgY,EAAa9D,GAAS,GAAJ,OAAO4D,EAAP,SAC5BI,UAAWhE,GAASA,EAAMiE,cAAcC,SAAS,OAAS,MAAQ,QAKpE,WAAWtb,KAAKgb,GACX,CACLhQ,KAAM,cACNuQ,aAAcL,EAAaF,GAC3BQ,aAAcN,EAAa,GAAD,OAAIF,EAAJ,WAI1B,YAAYhb,KAAKgb,GACZ,CACLhQ,KAAM,eAIN,kBAAkBhL,KAAKgb,GAClB,CACLhQ,KAAM,mBACNyQ,cAAeP,EAAaF,GAC5B5D,MAAO,CACLlU,SAAUgY,EAAa9D,GAAS,GAAJ,OAAO4D,EAAP,SAC5BI,UAAWhE,GAASA,EAAMiE,cAAcC,SAAS,OAAS,MAAQ,QAKpE,WAAWtb,KAAKgb,IAMhB,UAAUhb,KAAKgb,GALV,CACLhQ,KAAM,eAUN,gBAAgBhL,KAAKgb,GAChB,CACLhQ,KAAM,kBACN0Q,cAAeR,EAAaF,GAC5B5D,MAAO,CACLlU,SAAUgY,EAAa,GAAD,OAAIF,EAAJ,SACtBI,UAAWhE,GAASA,EAAMiE,cAAcC,SAAS,OAAS,MAAQ,QAKpE,eAAetb,KAAKgb,IAMpB,UAAUhb,KAAKgb,GALV,CACLhQ,KAAM,eAUN,gBAAgBhL,KAAKgb,GAChB,CACLhQ,KAAM,kBACN2Q,cAAeT,EAAaF,GAC5B5D,MAAO,CACLlU,SAAUgY,EAAa,GAAD,OAAIF,EAAJ,SACtBI,UAAWhE,GAASA,EAAMiE,cAAcC,SAAS,OAAS,MAAQ,QAKpE,kBAAkBtb,KAAKgb,GAClB,CACLhQ,KAAM,gBACN4Q,eAAgBV,EAAaF,IAI7B,kBAAkBhb,KAAKgb,GAClB,CACLhQ,KAAM,gBACN6Q,eAAgBX,EAAaF,IAI7B,yBAAyBhb,KAAKgb,GACzB,CACLhQ,KAAM,sBACN8Q,cAAeZ,EAAaF,GAC5Be,YAAab,EAAa9D,GAAS,GAAJ,OAAO4D,EAAP,UAI/B,+BAA+Bhb,KAAKgb,GAC/B,CACLhQ,KAAM,oBACN8Q,cAAeZ,EAAaF,GAC5Be,YAAab,EAAa,GAAD,OAAIF,EAAJ,SACzBgB,YAAad,EAAa,GAAD,OAAIF,EAAJ,UAIzB,WAAWhb,KAAKgb,GACX,CACLhQ,KAAM,gBACNiR,eAAgBf,EAAaF,IAI7B,YAAYhb,KAAKgb,GACZ,CACLhQ,KAAM,eAIN,uBAAuBhL,KAAKgb,GACvB,CACLhQ,KAAM,gBACNkR,gBAAiBhB,EAAaF,IAI9B,aAAahb,KAAKgb,GACb,CACLhQ,KAAM,gBACNmR,SAAUnB,GAIV,SAAShb,KAAKgb,GACT,CACLhQ,KAAM,aACNvB,YAAayR,EAAaF,IAI1B,SAAShb,KAAKgb,GACT,CACLhQ,KAAM,aACNoR,YAAalB,EAAaF,IAIvB,CACLhQ,KAAM6P,IAIH,SAASwB,GAAeC,GAY7B,MAXqD,CACnDC,WAAY,kBACZC,YAAa,kBACbC,kBAAmB,yBACnBC,cAAe,oBACfC,oBAAqB,yBACrBC,cAAe,yBACfC,gBAAiB,eACjBvT,WAAY,WACZwT,WAAY,gBAEDR,IAAgB,eAGxB,SAASS,GACdC,EACAC,EACAC,GAEA,IAAMrd,EAAO,CACXmL,KAAM,eACNvL,KAAM,GAAF,OAAKud,EAAL,kBACJ3Q,YAAa,oCAAF,OAAsC4Q,EAAtC,KACXE,SAAUD,EACVE,QAAS,IAGX,OADAvd,EAAKud,QAAU5f,KAAWqC,GACnBA,EAGF,SAASwd,GACdL,EACAC,EACAC,GAEA,IAAMrd,EAAO,CACXmL,KAAM,eACNvL,KAAM,GAAF,OAAKud,EAAL,cACJ3Q,YAAa,uCAAF,OAAyC4Q,EAAzC,KACXE,SAAUD,EACVE,QAAS,IAGX,OADAvd,EAAKud,QAAU5f,KAAWqC,GACnBA,ECnRF,IAAMyd,GAAcxjB,QACxBuB,MAAM,cAAe,CACpBF,GAAItB,aACJmR,KAAMlR,QAAMU,SAEb+b,UAAS,iBAAO,CACfgH,iBAAkB,GAClBld,WAAOpC,MAER6Y,OAAM,SAAArb,GAAI,MAAK,CACd,yBAOE,OAF0B+hB,sBAAW/hB,GAA7ByR,cAC0BuQ,eAAehiB,EAAKuP,MACnCH,gBAOrB,mBACE,OAAO,MAGT,oBACE,OAAO6S,kBAAQxZ,KAAKyZ,YAAa,YAGnC,kBAEE,IADA,IAAI7D,EAAQK,oBAAU1e,IACbqe,EAAME,gBAAiB0D,kBAAQ5D,EAAO,YAAa,CAC1D,GAAIU,iBAAOV,GACT,MAAM,IAAI3Y,MAAJ,oCAAuC1F,EAAKuP,KAA5C,YAAoDvP,EAAKN,KAEjE2e,EAAQK,oBAAUL,GAEpB,OAAOA,GAOT,kBACE,kCACKY,GAAqBjf,IAD1B,IAEEmiB,aAAcniB,KAQlB,mBACE,IACMkP,EADU6S,sBAAW/hB,GACEyR,cAAc2Q,gBACzCpiB,EAAK8hB,kBAEP,IAAK5S,EACH,MAAM,IAAIxJ,MAAJ,oBAAuB1F,EAAK8hB,iBAA5B,gBACR,IAAK5S,EAAaE,eAChB,MAAM,IAAI1J,MAAJ,mBACQ1F,EAAK8hB,iBADb,qEAGR,OAAO5S,GAOT,gCAIA,qBACE,MAAO,IAGT,sBACE,MAAO,IASTmT,uBArFc,iBAyFftiB,SAAQ,SAAAC,GAAI,MAAK,CAChBsiB,SADgB,SACP5d,GACP1E,EAAK4E,MAAQF,GAGf6d,OALgB,iB,yCCtFb,SAASC,GACd/Q,EACArB,EACAqS,GAEA,OAAOpkB,QACJuB,MAAMwQ,EAAW,CAChB1Q,GAAItB,aACJmR,KAAMlR,QAAMqkB,QAAQtS,GACpBmO,cAAeoE,aAAuBF,GACtCG,SAAUvkB,QAAMwc,MACdpJ,EAAcoR,iBAAiB,UAAW,iBAG7C/H,UAAS,iBAAO,CACfgI,WAAW,MAEZ/iB,SAAQ,SAAAC,GAAI,MAAK,CAChB+iB,aADgB,SACHC,GACXhjB,EAAK8iB,UAAYE,OAGpB3H,OAAM,SAAArb,GAAI,MAAK,CACd,mBACE,OAAOA,EAAKN,IAGd,WACE,OAAOuiB,kBAAQjiB,EAAM,SAMvB,kBACE,IAAMijB,EAAgBhB,kBAAQjiB,EAAM,WAC9BkjB,EAAUnB,sBAAW/hB,GAC3B,IAAKijB,EACH,MAAM,IAAIvd,MAAJ,gDAAmD1F,EAAKuP,OAChE,IAAMsR,EAAcqC,EAAQzR,cAAc0R,eACxCF,EAAc1T,MAEhB,IAAKsR,EACH,MAAM,IAAInb,MAAJ,+BAAkCud,EAAc1T,OACxD,OAAOsR,GAGT,sBACE,IAAMuC,EAAwB,GAI9B,OAHApjB,EAAK4iB,SAAS/T,SAAQ,SAAAoB,GACpBmT,EAAUlT,KAAV,MAAAkT,EAAS,YAASnT,EAAQoT,qBAErBD,GAET,mBACE,IAAMF,EAAUnB,sBAAW/hB,GAC3B,OACEsjB,2CAAgCJ,KAE/BA,EAAQK,WAEPL,EAAQM,cAAc/c,MAAK,SAAA4X,GACzB,OAAOA,EAAMsD,UAAY3hB,EAAKue,cAAcoD,aAUpD,6BACE,MAAO,QAGV5hB,SAAQ,SAAAC,GAAI,MAAK,CAChByjB,wBADgB,WAEd,IAAMP,EAAUnB,sBAAW/hB,GACrB0jB,EAAOC,6BAAkB3jB,GAC/B,GAAIsjB,2CAAgCJ,GAAU,CAE5C,IAAM5E,EAAY4E,EAAQU,uBAAuB5jB,EAAKue,eAClDD,GAAaA,IAActe,EAAKue,gBAElCmF,EAAKG,UAAU7jB,EAAKue,eAEpBmF,EAAKI,UAAUxF,MAIrByF,YAfgB,SAeJC,GAAyC,IAAtBC,EAAsB,uDAAJ,GACzCC,EAA0BzS,EAAc0S,0BAC5C,WAEI5F,EAAgB6F,4BACpBF,EACAG,kBAAQrkB,GACRgkB,GAEIM,EAAc7S,EAAcuQ,eAAezD,EAAchP,MAC/D,IAAK+U,EACH,MAAM,IAAI5e,MAAJ,+BAAkC6Y,EAAchP,OAExD,IAAMU,EAAUqU,EAAYvU,WAAW3F,OAAvB,2BACX6Z,GADW,IAEd1U,KAAMgP,EAAchP,KACpBgP,mBAEFve,EAAK4iB,SAAS1S,KAAKD,IAGrBsU,YApCgB,SAoCJP,GACV,IAAME,EAA0BzS,EAAc0S,0BAC5C,WAEI5F,EAAgB6F,4BACpBF,EACAG,kBAAQrkB,GACRgkB,GAGIQ,EAAgBxkB,EAAK4iB,SAASrM,QAClC,SAAAkO,GAAC,OAAIA,EAAElG,gBAAkBA,KAG3B,OADAmG,uBAAY,kBAAMF,EAAc3V,SAAQ,SAAA4V,GAAC,OAAIzkB,EAAK4iB,SAAS+B,OAAOF,SAC3DD,EAAc9gB,QAEvBkhB,eApDgB,SAqDdC,EACAC,GAEA,IADAb,EACA,uDADkB,GAEZc,EAAa/kB,EAAK4iB,SAAShH,WAC/B,SAAA6I,GAAC,OAAIA,EAAElG,cAAcyF,YAAca,KAErC,IAAoB,IAAhBE,EACF,MAAM,IAAIrf,MAAJ,oCACyBmf,EADzB,gBAIR,IAAMX,EAA0BzS,EAAc0S,0BAC5C,WAEI5F,EAAgB6F,4BACpBF,EACAG,kBAAQrkB,GACR8kB,GAEIR,EAAc7S,EAAcuQ,eAAezD,EAAchP,MAC/D,IAAK+U,EACH,MAAM,IAAI5e,MAAJ,+BAAkC6Y,EAAchP,OAExDvP,EAAK4iB,SAASoC,OAAOD,EAAY,EAAjC,2BACKd,GADL,IAEE1U,KAAMgP,EAAchP,KACpBgP,wBAILlD,OAAM,SAAArb,GAAI,MAAK,CACd,qBACE,IAAMojB,EAAwB,GAC9BpjB,EAAK4iB,SAAS/T,SAAQ,SAAAoB,GACpBmT,EAAUlT,KAAV,MAAAkT,EAAS,YAASnT,EAAQgV,oBAE5B,IAAMC,EAA6B,GAC7BxB,EAAOC,6BAAkB3jB,GAEzBmlB,EADW1T,EAAc2T,YAAY1B,EAAKnU,MACRS,aAAapG,KACnD,SAAA0a,GAAW,OAAIA,EAAYtgB,QAEvBqhB,EAAqBrlB,EAAKue,cAAcqE,SAASrM,QACrD,SAAC+O,GAAD,OACEH,EAAuBpb,SAASub,EAAY/V,SAE1CgW,EAAUvlB,EAAK4iB,SAAS,GAAGrE,cAAcyF,UAiB/C,OAhBIqB,EAAmB3hB,OAAS,IAC9BwhB,EAAehV,KACb,CAAEX,KAAM,WACR,CAAEA,KAAM,YAAanO,MAAO,kBAE9BikB,EAAmBxW,SAAQ,SAACyW,GAC1BJ,EAAehV,KAAK,CAClBX,KAAM,QACNnO,MAAO,GAAF,OAAKkkB,EAAY/V,MACtBiW,QAAS,WACPxlB,EAAK4kB,eAAeW,EAASD,EAAYtB,YAE3CyB,QAASH,EAAYtB,YAAcuB,QAIzC,CACE,CACEnkB,MAAO,mBACPskB,KAAMC,KACNC,SAAU,GACVJ,QAAS,WACPxlB,EAAK+iB,cAAa,MANxB,OASKK,EACA8B,QC3NN,SAASW,GAAsBpU,GACpC,OAAO8L,8BACL,YACA,CACEvZ,KAAM,CACJ4M,YAAa,gCACbrB,KAAM,SACNiO,aAAc,SAEhBsI,cAAe,CACblV,YAAa,wDACbrB,KAAM,cACNiO,aAAc,CAAC,iBAEjB5M,YAAa,CACXA,YAAa,6BACbrB,KAAM,SACNiO,aAAc,IAEhBkE,SAAU,CACR9Q,YAAa,6CACbrB,KAAM,cACNiO,aAAc,IAEhBnP,SAAU,CACRkB,KAAM,SACNqB,YAAa,mCACb4M,aAAc,IAEhBuI,QAAStU,EAAc0S,0BAA0B,WACjDvB,SAAUvkB,QAAMwc,MAAMpJ,EAAc0S,0BAA0B,aAchE,CACE6B,mBAAoB,SAAA/hB,GAClB,IAAMnD,EAAOkV,KAAKW,MAAMX,KAAKC,UAAUhS,IACjC+L,EAAe,IAAIiW,IAFF,EAGGnlB,EAAlB8hB,gBAHe,MAGJ,GAHI,EAIF,kBAAjB9hB,EAAK6gB,UAIPiB,EAAS/T,SAAQ,SAAC4V,GAAD,OAAYA,GAAKzU,EAAakW,IAAIzB,EAAElV,SACnCkC,EAAc0U,aAAarlB,EAAKyO,MACxCS,aAAanB,SAAQ,SAAAyV,GACxBtU,EAAaoW,IAAI9B,EAAYtgB,OAChC4e,EAAS1S,KAAK,CACZ8T,UAAW,GAAF,OAAKljB,EAAK6gB,QAAV,YAAqB2C,EAAYtgB,MAC1CuL,KAAM+U,EAAYtgB,WAK1B,kCAAYlD,GAAZ,IAAkB8hB,cAEpBlF,mBAAoB,UACpBD,iBAAiB,EACjB1d,QAAS,SAACC,GAAD,MAAgB,CACvBqmB,eADuB,SACRf,GAAkD,IACvD/V,EAAS+V,EAAT/V,KACR,IAAKA,EAAM,MAAM,IAAI7J,MAAJ,+BAAkC6J,IACnD,IAAMU,EAAUjQ,EAAK4iB,SAASnc,MAC5B,SAACge,GAAD,OAAYA,GAAKA,EAAET,YAAcsB,EAAYtB,aAE/C,GAAI/T,EACF,OAAOA,EAET,IAAMvM,EAAS1D,EAAK4iB,SAAS1S,KAAKoV,GAClC,OAAOtlB,EAAK4iB,SAASlf,EAAS,Q,uDCzCjC,SAAS4iB,GAAUrc,GACxB,MACmB,kBAAVA,GACG,OAAVA,GACkC,oBAA1BA,EAAkBzK,KACO,oBAAzByK,EAAkBvK,GA0B9B,SAAS6mB,GACPne,GAEA,MAAO,aAAcA,GAA6B,kBAAdA,EAAKE,K,IAMtBke,G,WAcnB,WAAmBpe,GAAmD,yBAZ9DE,UAY8D,OAV9Dme,kBAU8D,OAR9DC,cAQ8D,EAChEH,GAA0Bne,GAC5BK,KAAKH,KAAOF,GAEZK,KAAKH,KAAOF,EAAKE,MAAQ,GAIzBG,KAAKge,aAAere,EAAKqW,QAK3B,IAAM/e,EAAK6mB,GAA0Bne,GAAQA,EAAKse,SAAWte,EAAK1I,GAClE,QAAW8C,IAAP9C,GAA2B,OAAPA,EACtB,MAAM,IAAIgG,MACR,qEAKJ,GAFA+C,KAAKie,SAAWnf,OAAO7H,KAEjB+I,KAAKH,KAAKqe,SAAWle,KAAKH,KAAKnJ,IAAMsJ,KAAKH,KAAKrJ,OAAS,GAC5D,MAAM,IAAIyG,MAAJ,0DAC+C+C,KAAKH,KAAKnJ,IADzD,mBACuEsJ,KAAKH,KAAKrJ,QAvBrB,IA4B5D2nB,EAAgBne,KAAKH,KAArBse,YACR,GAAIA,EACF,IAAK,IAAItjB,EAAI,EAAGA,EAAIsjB,EAAYljB,OAAQJ,GAAK,EACT,oBAAvBsjB,EAAYtjB,GAAG9D,MACxBonB,EAAYtjB,GAAG6R,OAASyR,EAAYtjB,GAAG6R,QAAU1M,KAAKH,KAAK6M,OAC3DyR,EAAYtjB,GAAK,IAAIkjB,EAAc,CACjC9mB,GAAIknB,EAAYtjB,GAAGojB,UAAf,UAA8BhnB,EAA9B,YAAoC4D,GAExCgF,KAAMse,EAAYtjB,GAClBmb,OAAQhW,Q,gDAYPzE,GACT,OAAOyE,KAAKH,KAAKtE,K,0BAORA,EAAcsS,GACvB7N,KAAKH,KAAKtE,GAAQsS,I,6BAOlB,OAAO5U,OAAOC,KAAK8G,KAAKH,Q,2BAOxB,OAAOG,KAAKie,W,+BAOZ,OAAOje,KAAKge,e,iCAOZ,OAAOhe,KAAKjJ,IAAI,iB,+BAIhB,IAAMilB,EAAI,2BAAKhc,KAAKH,MAAb,IAAmBoe,SAAUje,KAAK/I,OACnCmnB,EAAIpe,KAAKgW,SACXoI,IAAGpC,EAAEqC,SAAWD,EAAEnnB,MACtB,IAAMqnB,EAAIte,KAAK8L,WAEf,OADIwS,IAAGtC,EAAEmC,YAAcG,EAAEnd,KAAI,SAAAod,GAAK,OAAIA,EAAMC,aACrCxC,K,gCAGcyC,GACrB,OAAO,IAAIV,EAAJ,eAAuBU,Q,eCxLbC,G,WAGnB,cAAkE,QAApDC,eAAoD,MAA1C,GAA0C,2BAFlEC,iBAEkE,EAChE5e,KAAK4e,YAAcD,EAAQxd,KAAI,SAAA0d,GAC7B,GAA2B,kBAAhBA,EAET,MAAO,CAAE7nB,KADI8nB,aAAiBD,GACfvoB,OAAQuoB,GAEzB,MAAM,IAAI5hB,MAAJ,sCAAyC4hB,EAAzC,S,qDAKa,2BAAblf,EAAa,yBAAbA,EAAa,gBACrB,IAAK,IAAI9E,EAAI,EAAGA,EAAImF,KAAK4e,YAAY3jB,OAAQJ,GAAK,EAChD,IAAKmF,KAAK4e,YAAY/jB,GAAG7D,KAAK+nB,MAAM/e,KAAML,GAAO,OAAO,EAE1D,OAAO,I,+BAIP,MAAO,CAAEgf,QAAS3e,KAAK4e,YAAYzd,KAAI,SAAA6d,GAAC,OAAIA,EAAE1oB,c,gCAGhCmoB,GACd,OAAO,IAAIC,EAAwBD,O,wECjCjCQ,GAAWC,eA4CJC,GAAwB,CAEnCC,QAAS,CAAEC,KAPI,WAQfC,UAAW,CAAED,KAPD,WAQZE,SAAUN,GAAStU,QAAQ6U,aAAa,CAAEH,KAP7B,YAQbI,WAAYR,GAAStU,QAAQ6U,aAAa,CAAEH,KAP7B,YAQfK,UAAW,OACXC,WAAY,OACZC,MAAO,CACLC,EAAGZ,GAAStU,QAAQ6U,aAAaM,MACjCC,EAAGd,GAAStU,QAAQ6U,aAAaQ,MACjCC,EAAGhB,GAAStU,QAAQ6U,aAAaU,MACjCC,EAAGlB,GAAStU,QAAQ6U,aAAaY,QAI9B,SAASC,KACd,MAAO,CACLC,UAAW,CACT5iB,KAAM,SAER6iB,eAAgB,CACdC,OAAQ,SAEVC,eAAgB,CACdD,OAAQ,SAEVE,kBAAmB,CACjBF,OAAQ,SAEVG,cAAe,CACbjjB,KAAM,SAERkjB,aAAc,CACZJ,OAAQ,SAEVK,QAAS,CACPC,OAAO,GAETC,YAAa,CACXD,OAAO,GAETE,iBAAkB,CAChBR,OAAQ,SAEVS,OAAQ,CACNvjB,KAAM,SAERwjB,SAAU,CACRxjB,KAAM,SAERyjB,aAAc,CACZX,OAAQ,QACR9iB,KAAM,SAER0jB,WAAY,CACV9U,QAAS,SAEX+U,WAAY,CACVC,SAAU,SAEZC,qBAAsB,CACpB7jB,KAAM,SAER8jB,YAAa,CACX9jB,KAAM,SAER+jB,QAAS,CACPC,UAAW,WAKV,SAASC,KAA4D,IAA9BhX,EAA8B,uDAAJ,GAChEiX,EAAmBC,KAAU1C,GAAuBxU,GAC1D,MAAO,CACLgW,cAAe,CACbmB,eAAgB,CACdtX,MAAOoX,EAAiBrC,SAASF,OAGrCiB,UAAW,CACTyB,cAAe,CACbvX,MAAOoX,EAAiBrC,SAASF,OAGrC4B,OAAQ,CACN3B,UAAW,CACTnU,gBAAiByW,EAAiBnC,WAAWJ,OAGjDoC,QAAS,CACPO,KAAM,CACJxX,MAAOoX,EAAiBrC,SAASF,OAGrC4C,oBAAqB,CACnBD,KAAM,CACJtX,WAAYkX,EAAiBrC,SAASF,KACtC,aAAc,CAEZ6C,UAAW,EACX1B,OAAQ,EACRhW,MAAOoX,EAAiBrC,SAAS4C,cAEnC3B,OAAQ,EACR0B,UAAW,EACX7X,QAAS,YAEX+X,QAAS,CACP,aAAc,CACZ5B,OAAQ,WAEVA,OAAQ,UACRhW,MAAOoX,EAAiBrC,SAAS4C,cAEnCE,SAAU,IAKZC,YAAa,CACXN,KAAM,CACJO,WAAY,EACZC,cAAe,IAKnBC,gBAAiB,CACfT,KAAM,CACJhX,SAAU,KAGd0X,gBAAiB,CACfC,MAAO,CACLC,YAAa,MAMd,IAAMC,GAAiC,CAC5ClY,QAASwU,GACT2D,WAAY,CAAExB,SAAU,IACxBhX,QAAS,EACTvD,MAjIO,CACLuZ,UAAW,CACT5iB,KAAM,SAER6iB,eAAgB,CACdC,OAAQ,SAEVC,eAAgB,CACdD,OAAQ,SAEVE,kBAAmB,CACjBF,OAAQ,SAEVG,cAAe,CACbjjB,KAAM,SAERkjB,aAAc,CACZJ,OAAQ,SAEVK,QAAS,CACPC,OAAO,GAETC,YAAa,CACXD,OAAO,GAETE,iBAAkB,CAChBR,OAAQ,SAEVS,OAAQ,CACNvjB,KAAM,SAERwjB,SAAU,CACRxjB,KAAM,SAERyjB,aAAc,CACZX,OAAQ,QACR9iB,KAAM,SAER0jB,WAAY,CACV9U,QAAS,SAEX+U,WAAY,CACVC,SAAU,SAEZC,qBAAsB,CACpB7jB,KAAM,SAER8jB,YAAa,CACX9jB,KAAM,SAER+jB,QAAS,CACPC,UAAW,WA+Efne,UAAWoe,MAGN,SAASoB,GAAmB5Y,GAAsB,QACvD,OAAKA,IAGL,UAAIA,EAAMQ,eAAV,aAAI,EAAe4U,YACjBpV,EAAQ,2BACHA,GADA,IAEHQ,QAAS,2BACJR,EAAMQ,SADJ,IAEL4U,SAAUN,GAAStU,QAAQ6U,aAAarV,EAAMQ,QAAQ4U,gBAI5D,UAAIpV,EAAMQ,eAAV,aAAI,EAAe8U,cACjBtV,EAAQ,2BACHA,GADA,IAEHQ,QAAS,2BACJR,EAAMQ,SADJ,IAEL8U,WAAYR,GAAStU,QAAQ6U,aAAarV,EAAMQ,QAAQ8U,iBAI9DtV,EAAQ,2BACHA,GADA,IAEHpD,MAAO8a,KA7JF,CACLvB,UAAW,CACT5iB,KAAM,SAER6iB,eAAgB,CACdC,OAAQ,SAEVC,eAAgB,CACdD,OAAQ,SAEVE,kBAAmB,CACjBF,OAAQ,SAEVG,cAAe,CACbjjB,KAAM,SAERkjB,aAAc,CACZJ,OAAQ,SAEVK,QAAS,CACPC,OAAO,GAETC,YAAa,CACXD,OAAO,GAETE,iBAAkB,CAChBR,OAAQ,SAEVS,OAAQ,CACNvjB,KAAM,SAERwjB,SAAU,CACRxjB,KAAM,SAERyjB,aAAc,CACZX,OAAQ,QACR9iB,KAAM,SAER0jB,WAAY,CACV9U,QAAS,SAEX+U,WAAY,CACVC,SAAU,SAEZC,qBAAsB,CACpB7jB,KAAM,SAER8jB,YAAa,CACX9jB,KAAM,SAER+jB,QAAS,CACPC,UAAW,WA0GiCvX,EAAMpD,OAAS,IAC7DxD,UAAWse,KACTF,GAA8BxX,EAAMQ,SACpCR,EAAM5G,WAAa,MAGhB2b,aAAe2C,KAAUgB,GAAkB1Y,KA5BzC+U,aAAe2D,ICjM1B,SAASG,GAAU1W,GACjB,MAAgB,UAAZA,EACK,CACL2W,SAAU,UACVC,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,KAAM,WAGM,UAAZ/W,EACK,CACL2W,SAAU,UACVC,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,KAAM,WAGH,CACLJ,SAAU,UACVC,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,KAAM,WAIH,SAASC,GAAT,GAA0C,IAAtBhX,EAAsB,EAAtBA,QACzB,OACE,yBAAKiX,QAAQ,eACX,kBAAC,GAAD,CAAMjX,QAASA,KAKd,SAASkX,GAAT,GAA0C,IAAtBlX,EAAsB,EAAtBA,QACzB,OACE,yBAAKiX,QAAQ,eACX,kBAAC,GAAD,CAAMjX,QAASA,IACf,kBAAC,GAAD,CAAMA,QAASA,KAKrB,SAASmX,GAAT,GAAsC,IAC9BC,EAASV,GADqB,EAAtB1W,SAEd,OACE,oCACE,0BACEL,MAAO,CAAEpS,KAAM6pB,EAAOT,UACtBjH,EAAE,qMAEJ,0BACE/P,MAAO,CAAEpS,KAAM6pB,EAAOR,SACtBlH,EAAE,sLAEJ,0BACE/P,MAAO,CAAEpS,KAAM6pB,EAAOP,OACtBnH,EAAE,oLAEJ,0BACE/P,MAAO,CAAEpS,KAAM6pB,EAAON,UACtBpH,EAAE,6KAEJ,0BACE/P,MAAO,CAAEpS,KAAM6pB,EAAOL,MACtBrH,EAAE,2IAMV,SAAS2H,GAAT,GAAsC,IAC9BD,EAASV,GADqB,EAAtB1W,SAEd,OACE,uBACEsX,aAAW,UACXC,UAAU,6BACV5X,MAAO,CAAEpS,KAAM6pB,EAAOT,WAEtB,0BAAMjH,EAAE,6SACR,0BAAMA,EAAE,qiBACR,0BAAMA,EAAE,ofACR,0BAAMA,EAAE,uZACR,0BAAMA,EAAE,ktBACR,0BAAMA,EAAE,2hBACR,0BAAMA,EAAE,4a,uFC3FR/R,GAAYC,aAAW,CAC3B4Z,iBAAkB,CAChBC,OAAQ,aACR9T,MAAO,QAET+T,eAAgB,CACdD,OAAQ,aACRE,OAAQ,QAEVC,uBAAwB,CACtBH,OAAQ,aACRI,UAAW,WAEbC,yBAA0B,CACxBL,OAAQ,aACRI,UAAW,aA6EAE,OAjEf,YAMsB,IA8BhBhY,EAnCJiY,EAKoB,EALpBA,OAKoB,IAJpBC,gBAIoB,aAHpBC,eAGoB,SAFTC,EAES,EAFpBpY,UACGtF,EACiB,8DACsB2d,oBAAS,GAD/B,mBACbC,EADa,KACEC,EADF,KAEdC,EAAUC,iBAAO,GACjBjZ,EAAU5B,KAwChB,OAtCA8a,qBAAU,WACR,SAASC,EAAUC,GACjBA,EAAMC,iBACN,IACMvQ,EADMsQ,EAAMV,EAAW,UAAY,WAClBM,EAAQM,QAC/B,GAAIxQ,EAAU,CACZ,IAAMyQ,EAAiBd,EAAO3P,GAC9BkQ,EAAQM,SAAWC,GAIvB,SAASC,IACPT,GAAiB,GAEnB,OAAID,GACF1iB,OAAOqjB,iBAAiB,YAAaN,GAAW,GAChD/iB,OAAOqjB,iBAAiB,UAAWD,GAAS,GACrC,WACLpjB,OAAOsjB,oBAAoB,YAAaP,GAAW,GACnD/iB,OAAOsjB,oBAAoB,UAAWF,GAAS,KAG5C,eACN,CAACV,EAAeL,EAAQC,IAKvBlY,EAFAmY,EACED,EACU1Y,EAAQqY,uBAERrY,EAAQuY,yBAEbG,EACG1Y,EAAQmY,eAERnY,EAAQiY,iBAIpB,uCACE0B,eAAa,OACbC,YAAa,SAAAR,GACXA,EAAMC,iBACN,IAAMQ,EAAMT,EAAMV,EAAW,UAAY,WACzCM,EAAQM,QAAUO,EAClBd,GAAiB,IAEnBe,KAAK,eACLtZ,UAAWuZ,aAAKvZ,EAAWoY,IACvB1d,KCnFJkD,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC0b,MAAO,CACLC,UADK,OAEL7B,OAFK,OAGL8B,OAAQ5b,SAHH,OAIL6b,QAJK,OAKLtb,WAAYP,qBAAyB8b,SAEvCC,aAAc,CACZjW,MADY,EAEZ7L,SAFY,QAGZ+hB,IAHY,EAIZJ,OAAQ5b,gBAAsB,OAIlC,SAASic,GAAO,GAA6B,IAA3Bta,EAA2B,EAA3BA,SAAUua,EAAiB,EAAjBA,KAAM5L,EAAW,EAAXA,QAC1B5O,EAAU5B,KAEhB,OACE,wBAAOqc,GAAP,EAAiBC,UAAU,QACzB,wBAAOla,UAAWR,EAAlB,MAAiC2a,UAAjC,GAAgDC,QAAM,GACpD,sBACEnC,OAAQ7J,EADV,aAEEpO,UAAWR,EAFb,aAGE0Y,UAAQ,IANhB,IAoBF6B,gBAAsB,CACpBta,SAAU,MAGGxL,0BAAf,ICxCM2J,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCuc,cADqC,GAErCC,WAAY,CACVnf,QAAS,SAEXof,kBAAmB,CACjBC,MADiB,QAEjB,UAAW,CACT1b,gBAAiB2b,gBACf3c,oBADmB,aAEnBA,iBAHO,cAKT,uBAAwB,CACtBgB,gBAAiB,iBAIvB4b,cAAe,CACbnE,YAAazY,cAEf6c,yBAA0B,CACxBC,SAAU,GAEZC,cAAe,CACb1G,OAAQrW,kBA+CZ,GA5CqB7J,oBAAS,SAAAyG,GAAS,IAC7B0T,EAAY1T,EADiB,QAE7BogB,EAAiC1M,EAFJ,gBAEIA,EAFJ,cAOjCzR,cAA4Bme,EAPK,MAInCxgB,EAJmC,iBAKnCqB,EALmC,mBAMnCD,EANmC,UAQ/B8D,EAAU5B,KAEhB,OACE,sBAAQwQ,QAAR,EAA0B4L,KAAMe,QAAQ3M,gBAAD,OACrC,yBAAKpO,UAAWR,EAAQ6a,eACtB,wBAAQtiB,SAAR,SAA0BoG,MAAM,aAC9B,wBAAS6c,gBAAT,EAAwBhb,UAAWR,EAAQkb,eACzC,wBAAYza,QAAZ,KAAyB9B,MAAM,WAC5BxC,EACC,qBAAkB7Q,MAAOgwB,IAEzBpf,QALN,GAQE,yBAAKsE,UAAWR,EAAQmb,2BACxB,wBACE3a,UAAWR,EADb,kBAEEyb,cAFF,eAGE9c,MAHF,UAIEoZ,aAJF,QAKE7G,QAAS,kBAAMtC,aAAN,KAET,uBAlBR,SAsBE,qBAAgBtjB,MAAhB,EAAsCsjB,QAASA,S,8KCpDjDxQ,GAAYC,aAAW,CAC3B2b,MAAO,CACLzhB,SAAU,QACV0hB,UAAW,OACXyB,UAAW,SAEXvc,SAAU,GACVkX,UAAW,GACXjX,SAAU,oBACVK,UAAW,oBACX6a,IAAK,EACLqB,KAAM,EAENxB,QAAS,GAEXyB,sBAAuB,CACrBrjB,SAAU,WACVsjB,MAAO,GACPvB,IAAK,MACLtC,UAAW,mBACXxZ,QAAS,EACTe,aAAc,GACd5D,QAAS,iBAkBb,SAASmgB,GAAsB5gB,GAC7B,IAEIiW,EACA4K,EAIA3K,EAPEpR,EAAU5B,KACRnD,EAASC,EAATD,KAOR,GAJI,YAAaC,IACXiW,EAAsBjW,EAAtBiW,QAAS4K,EAAa7gB,EAAb6gB,UAGF,YAAT9gB,EACFmW,EAAO,kBAAC,KAAD,CAAgBzS,MAAM,gBACxB,GAAa,aAAT1D,EACT,GAAIkW,EAAS,CACX,IAAMxS,EAAQod,EAAW,UAAY,YACrC3K,EAAO,kBAAC,KAAD,CAAczS,MAAOA,SAE5ByS,EAAO,kBAAC,KAAD,CAA0BzS,MAAM,gBAEpC,GAAa,UAAT1D,EACT,GAAIkW,EAAS,CACX,IAAMxS,EAAQod,EAAW,UAAY,YACrC3K,EAAO,kBAAC,KAAD,CAAwBzS,MAAOA,SAEtCyS,EAAO,kBAAC,KAAD,CAA0BzS,MAAM,WAG3C,OAAO,yBAAK6B,UAAWR,EAAQ4b,uBAAwBxK,GA+FzD,IAAM4K,GAAW5gB,IAAM6gB,YAAW,SAAC/gB,EAAsBghB,GAAQ,MACjBrD,mBAC5C,MAF6D,mBACxDsD,EADwD,KACvCC,EADuC,OAInBvD,mBAAwB,MAJL,mBAIxDwD,EAJwD,KAIxCC,EAJwC,OAKrBzD,oBAAS,GALY,mBAKxD0D,EALwD,KAKzCC,EALyC,OAMT3D,mBACpD,MAP6D,mBAMxD4D,EANwD,KAMnCC,EANmC,OAS/B7D,mBAG7B,MAZ4D,mBASxDtgB,EATwD,KAS9CokB,EAT8C,KAazDC,EAAW3D,iBAA8B,MACzCjZ,EAAU5B,KAGd0Q,EAME5T,EANF4T,UACA+N,EAKE3hB,EALF2hB,gBACArC,EAIEtf,EAJFsf,KACAsC,EAGE5hB,EAHF4hB,QACAC,EAEE7hB,EAFF6hB,SArB6D,EAuB3D7hB,EADFof,WAtB6D,SAyB/DpB,qBAAU,WACHsB,IACH4B,EAAmB,MACnBE,EAAkB,SAEnB,CAAC9B,IAEJtB,qBAAU,WACR,IACI8D,EADEC,EAAsBzC,GAAQe,QAAQY,GAW5C,OATIc,IAAwBV,EAC1BS,EAAQE,YAAW,WACjBV,GAAiB,KAChB,MACOS,GAAuBV,IACjCS,EAAQE,YAAW,WACjBV,GAAiB,KAChB,MAEE,WACLW,aAAaH,MAEd,CAACT,EAAe/B,EAAM2B,IAEzBjD,qBAAU,WACR,GAAI6D,EAAU,CACZ,IAAMK,EAAQL,EAAyBM,wBACnC9kB,GAEA6kB,EAAK9C,MAAQ/hB,EAAS+hB,KACtB8C,EAAKzB,KAAOyB,EAAKhZ,QAAU7L,EAASojB,MAKtCgB,EAAY,CAAErC,IAAK8C,EAAK9C,IAAKqB,KAAMyB,EAAKzB,KAAOyB,EAAKhZ,aAE5C7L,GACVokB,EAAY,MAEb,CAACpkB,EAAUwkB,IAEd,IAAMO,EAAmBxO,EAAUyO,MACjC,SAAAC,GAAQ,MACN,YAAaA,GACK,aAAlBA,EAASviB,MACS,UAAlBuiB,EAASviB,QAEPwiB,EAAU3O,EAAUyO,MACxB,SAAAC,GAAQ,MAAI,SAAUA,GAAYA,EAASpM,QAEvCsM,EAAmC,GACrCJ,IACFI,EAAcC,aAAe,IAS/B,IAAMC,EACJ,oCACE,kBAACC,GAAA,EAAD,CAAUC,cAAetD,IAAS+B,GAC/BzN,EACEiP,MAAK,SAAC7wB,EAAGC,GAAJ,OAAWA,EAAEmkB,UAAY,IAAMpkB,EAAEokB,UAAY,MAClDhc,KAAI,SAACkoB,EAAUjW,GACd,GAAsB,YAAlBiW,EAASviB,KACX,OAAO,kBAACuH,GAAA,EAAD,CAASvB,IAAG,kBAAasG,GAAOyW,UAAU,OAEnD,GAAsB,cAAlBR,EAASviB,KACX,OACE,kBAACgjB,GAAA,EAAD,CAAehd,IAAG,oBAAeuc,EAAS1wB,MAAxB,YAAiCya,IAChDiW,EAAS1wB,OAIhB,IAAIskB,EAAO,KACP8M,EAAgB,KACpB,GAAIV,EAASpM,KAAM,CACjB,IAAMwG,EAAO4F,EAASpM,KACtBA,EACE,kBAAC+M,GAAA,EAAD,KACE,kBAACvG,EAAD,OAIF,YAAa4F,EACfU,EAAgB,kBAACpC,GAAD,CAAuB7gB,KAAK,YAE1B,aAAlBuiB,EAASviB,MACS,UAAlBuiB,EAASviB,OAETijB,EACE,kBAACpC,GAAD,CACE7gB,KAAMuiB,EAASviB,KACfkW,QAASqM,EAASrM,QAClB4K,SAAUyB,EAASzB,YAIzB,IA9CW5tB,EA8CL+iB,EACJ,YAAasM,GA/CJrvB,EA+C2BqvB,EAAStM,QA9ChD,SAACkI,GACNyD,EAAgBzD,EAAOjrB,UA6CyCD,EAC1D,OACE,kBAAC,KAAD,CACE+S,IAAKuc,EAAS1wB,MACdsT,MAAOsd,EACPU,SAAU7W,IAAQkV,EAClBvL,QAASA,EACTmN,YAAa,SAAAjuB,GACPA,EAAEkuB,gBAAkBC,SAASC,gBAC/BpuB,EAAEkuB,cAAcG,QAChB/B,EAAuBnV,IAErB,YAAaiW,EACXnB,IAAmB9U,IACrB6U,EAAmBhsB,EAAEkuB,eACrBhC,EAAkB/U,KAGpB6U,EAAmB,MACnBE,EAAkB,QAGtBoC,UAAW,SAAAtuB,GACT,GAAc,cAAVA,EAAE6Q,KAAiC,WAAV7Q,EAAE6Q,IAC7B6b,GAAWA,EAAQ1sB,EAAG,sBACjB,GAAc,YAAVA,EAAE6Q,IACXyb,EApKpB,SAA8B5N,EAAuB6P,GACnD,OAAOC,yBACL9P,EAAUza,MAAM,EAAGsqB,IACnB,SAAAnB,GAAQ,MACY,YAAlBA,EAASviB,MACS,cAAlBuiB,EAASviB,OACRuiB,EAASzB,YA8J2B8C,CAAqB/P,EAAWvH,SAClD,GAAc,cAAVnX,EAAE6Q,IAAqB,CAChC,IAAM/T,EArL1B,SAA0B4hB,EAAuB6P,GAC/C,IAAMpX,EAAMuH,EACTza,MAAMsqB,EAAa,GACnBrX,WACC,SAAAkW,GAAQ,MACY,YAAlBA,EAASviB,MACS,cAAlBuiB,EAASviB,OACRuiB,EAASzB,YAEhB,OAAa,IAATxU,EACKA,EAEFoX,EAAa,EAAIpX,EAyKIuX,CAAiBhQ,EAAWvH,GACtCmV,EAAuBxvB,OACd,YAAaswB,IACR,eAAVptB,EAAE6Q,KAAkC,UAAV7Q,EAAE6Q,MAC9Bmb,EAAmBhsB,EAAEkuB,eACrBhC,EAAkB/U,GAClBiV,GAAiB,MAIvBT,SAAUR,QAAQiC,EAASzB,WAE1B3K,EACD,kBAAC2N,GAAA,EAAD,CACExL,QAASiK,EAAS1wB,MAClB2mB,UAAW+J,EAASwB,SACpBlI,MAAO2G,IAAYD,EAASpM,OAE7B8M,OAKVpP,EAAUxZ,KAAI,SAACkoB,EAAUjW,GACxB,IAAI0X,EAAU,KAgBd,MAfI,YAAazB,IACfyB,EACE,kBAACjD,GAAD,CACE/a,IAAKuc,EAAS1wB,MACdiwB,SAAUZ,EACV3B,KAAM+B,GAAiBF,IAAmB9U,EAC1CuV,QAAS,WACPN,GAAiB,GACjBJ,EAAmB,OAErBS,gBAAiBA,EACjB/N,UAAW0O,EAASyB,WAInBA,MAKb,OAAI3E,EACKsD,EAIP,kBAACsB,GAAA,EAAD,CAAMzE,GAAID,EAAMpa,MAAO,CAAE+e,gBAAiB,SAAWjD,IAAKA,GACxD,kBAAC3Z,GAAA,EAAD,CACEoY,UAAW,EACXuB,IAAKU,EACLpc,UAAWR,EAAQga,MACnB5Z,MAAK,eAAO7H,IAEXqlB,OAkCMwB,OApBf,SAAclkB,GAAkB,IACtBsf,EAAwDtf,EAAxDsf,KAAMsC,EAAkD5hB,EAAlD4hB,QAAShO,EAAyC5T,EAAzC4T,UAAW+N,EAA8B3hB,EAA9B2hB,gBAAoBwC,EADxB,aACkCnkB,EADlC,kDAE9B,OACE,kBAACokB,GAAA,EAAD,eACE9E,KAAMA,EACNsC,QAASA,EACTyC,cAAe,CAAEC,WAAW,IACxBH,GAEJ,kBAACrD,GAAD,CACExB,KAAMA,EACNsC,QAASA,EACThO,UAAWA,EACX+N,gBAAiBA,EACjBvC,KAAG,MC7ZLlc,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6X,KAAM,CACJxa,QAAS,QAEX8jB,WAAY,CACV,UAAW,CACTngB,gBAAiB2b,gBACf3c,EAAMQ,QAAQyU,QAAQ+C,aACtBhY,EAAMQ,QAAQ4gB,OAAOC,cAEvB,uBAAwB,CACtBrgB,gBAAiB,qBA+DV7K,2BAzDf,YASG,IARDmrB,EAQC,EARDA,UACAhR,EAOC,EAPDA,QACAE,EAMC,EANDA,UAMC,EACuB+J,oBAAS,GADhC,mBACM2B,EADN,KACYqF,EADZ,KAEK9C,EAAW9D,iBAAO,MAClBjZ,EAAU5B,KAWhB,SAAS0hB,IACPD,GAAQ,GAGV,OACE,yBAAKrf,UAAWR,EAAQmW,MACtB,kBAAC,IAAD,CACE+F,IAAKa,EACL7L,QAjBN,WACE2O,GAASrF,IAiBL7b,MAAM,UACN8c,cAAY,qBACZzb,QAAS,CAAEmW,KAAMnW,EAAQyf,aAExBG,EACD,kBAAC,KAAD,OAEF,kBAAC,GAAD,CACE7C,SAAUA,EAASzD,QACnByG,aAAc,CAAErH,SAAU,SAAUsH,WAAY,QAChDnD,gBAxBN,SAA6BoD,EAAiB9xB,GAC5CA,EAASygB,GACTkR,KAuBItF,KAAMA,EACNsC,QAASgD,EACThR,UAAWA,Q,qBC1Db1Q,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC3H,MAAO,GACPupB,UAAW,GACXjJ,WAAY,CACVqD,IAAK,EACLqB,KAAM,EACNpjB,SAAU,WACV4nB,WAAY,SACZC,WAAY,UAEdC,UAAW,CACT7hB,QAASF,EAAMG,QAAQ,KAEzB6hB,aAAc,CACZC,YAAa,QACbC,aAAcliB,EAAM/T,MAAMi2B,aAC1BC,YAAa,OAsGFC,GA1FYtlB,IAAM6gB,YAC/B,SAAC/gB,EAAoCghB,GAAmC,IAC9Dpe,EAAuC5C,EAAvC4C,MAAO6iB,EAAgCzlB,EAAhCylB,SAAUlgB,EAAsBvF,EAAtBuF,QAAY4e,EADiC,aACvBnkB,EADuB,kCAEhC2d,qBAFgC,mBAE/D+H,EAF+D,KAElDC,EAFkD,OAG5ChI,mBAAS,GAHmC,mBAG/DzU,EAH+D,KAGxDwF,EAHwD,OAIpCiP,mBAAiC,MAJG,mBAI/DiI,EAJ+D,KAIpDC,EAJoD,OAKpClI,mBAAkC,MALE,mBAK/DmI,EAL+D,KAKpDC,EALoD,OAM9CpI,oBAAS,GANqC,mBAM/DqI,EAN+D,KAMzDC,EANyD,KAQtEjI,qBAAU,WACJgI,IACFF,GAAaA,EAAUE,OACvBC,GAAQ,MAET,CAACD,EAAMF,IAEV,IAAMhhB,EAAU5B,GAAUlD,GACpBoD,EAAQ8iB,eAERC,EAAcP,GAAaA,EAAUO,YACvCA,GAAeA,IAAgBjd,GACjCwF,EAASyX,GA+BX,OACE,yCAAShC,EAAT,CAAgBnD,IAAKA,IACnB,yBAAK9b,MAAO,CAAE7H,SAAU,aACtB,kBAAC,KAAD,CACE2jB,IAhCS,SAAC1R,GAChBuW,EAAavW,IAgCPwT,UAAU,OACVvd,QAASA,EACTD,UAAWR,EAAQiX,iBAEF/oB,IAAhB0yB,EAA4B9iB,EAAQ8iB,IAGzC,kBAACU,GAAA,EAAD,CACEC,SArCW,SAAC/W,GAChByW,EAAazW,IAqCThK,UAAWR,EAAQkgB,UACnBsB,WAAY,CACVphB,MAAO,aACLgE,SACI3D,GAAuB,YAAZA,GAAqC,WAAZA,EACpCnC,EAAM2Y,WAAWxW,GACjB,KAGRT,QAAS,CACPrJ,MAAOqJ,EAAQrJ,MACfwf,KAAMnW,EAAQqgB,UACdoB,QAASzhB,EAAQsgB,cAEnBxiB,WAAuB5P,IAAhB0yB,EAA4B9iB,EAAQ8iB,EAC3Cc,SAjCN,SAAsBtI,GACpByH,EAAezH,EAAMuI,OAAO7jB,QAiCxB4gB,UA3CN,SAAuBtF,GACH,UAAdA,EAAMnY,IACR+f,GAAaA,EAAUE,OACA,WAAd9H,EAAMnY,MACf4f,OAAe3yB,GACfizB,GAAQ,KAuCNS,OAnDN,WACMhB,GAAeA,IAAgB9iB,GACjC6iB,EAASC,GAEXC,OAAe3yB,U,WCINuG,2BAjEf,YAIG,IAHDma,EAGC,EAHDA,QAGC,EACuBiK,oBAAS,GADhC,mBACM2B,EADN,KACYqF,EADZ,OAE6ChH,qBAF7C,mBAEMgJ,EAFN,KAEuBC,EAFvB,KAMOC,EAAyCnT,EAAzCmT,mBAAoBC,EAAqBpT,EAArBoT,iBAEtBC,EAAgBD,EAAiB5yB,OACnC4yB,EAAiBA,EAAiB5yB,OAAS,GAC3C,KAEJ8pB,qBAAU,WACR,IAAIgJ,EAiBJ,OAfIL,EACGI,EAEMJ,EAAgB,KAAOI,EAAc,KAC9CpC,GAAQ,GACRqC,EAAYhF,YAAW,WACrB4E,EAAmBG,GACnBpC,GAAQ,KACP,MANHiC,OAAmB5zB,GAQZ+zB,IACTH,EAAmBG,GACnBpC,GAAQ,IAGH,WACL1C,aAAa+E,MAEd,CAACD,EAAeJ,IAEnB,IAAM/B,EAAc,SAACG,EAAiBkC,GACrB,cAAXA,IAGJJ,IACAlC,GAAQ,KAxCT,EA2CwBgC,GAAmB,GA3C3C,mBA2CMO,EA3CN,KA2CeC,EA3Cf,KA4CD,OACE,kBAACC,GAAA,EAAD,CACE9H,KAAMA,KAAU4H,EAChBtF,QAASgD,EACTJ,OACE,kBAAC,KAAD,CAAY3H,aAAW,QAAQpZ,MAAM,UAAUuS,QAAS4O,GACtD,kBAAC,KAAD,QAIJ,kBAACyC,GAAA,EAAD,CAAOzF,QAASgD,EAAa0C,SAAUH,GAAS,WAC7CD,O,iCCzDHhkB,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCmkB,cAAe,CACb/iB,SAAU,SACVb,WAAYP,EAAMQ,QAAQ2U,UAAUD,KACpCmB,OAAQrW,EAAMG,QAAQ,KAExB2S,KAAM,CACJzS,MAAOL,EAAMQ,QAAQ2U,UAAU6C,cAEjCoM,KAAM,CACJtH,SAAU,GAEZuH,SAAU,CACR,UAAW,CACTrjB,gBAAiB2b,gBACf3c,EAAMQ,QAAQ2U,UAAU6C,aACxBhY,EAAMQ,QAAQ4gB,OAAOC,cAEvB,uBAAwB,CACtBrgB,gBAAiB,iBAIvBsjB,iBAAkB,CAChBzjB,SAAU,IAEZ0jB,cAAe,CACb9L,YAAa,IAEf+L,cAAe,CACb/L,YAAazY,EAAMG,QAAQ,GAC3Bkf,aAAc,GACdjH,WAAY,EACZC,cAAe,GAEjBoM,oBAAqB,CACnBlH,MAAOvd,EAAMG,QAAQ,IAEvB9H,MAAO,CACLggB,cAAe,EACfD,WAAY,GAEdwJ,UAAW,CACTvhB,MAAOL,EAAMQ,QAAQ2U,UAAU6C,cAEjC+J,UAAW,CACT,UAAW,CACT/gB,gBAAiBhB,EAAMQ,QAAQ2U,UAAUuP,QAG7C1C,aAAc,CACZ2C,YAAa3kB,EAAMQ,QAAQyU,QAAQC,KACnClU,gBAAiBhB,EAAMQ,QAAQ2U,UAAUuP,WAIvCE,GAAWzuB,oBACf,YAQM,IAPJnJ,EAOI,EAPJA,MACA63B,EAMI,EANJA,gBACAC,EAKI,EALJA,UAKI,EAC4BvK,qBAD5B,mBACGkE,EADH,KACasG,EADb,KAGJ,OAAM/3B,EAAMwjB,WAAaxjB,EAAMwjB,UAAU1f,OAKvC,oCACE,kBAAC,KAAD,iBACM+zB,EADN,CAEEpL,aAAW,OACXuL,gBAAc,YACdC,gBAAc,OACdrS,QAAS,SAAAkI,GACPiK,EAAYjK,EAAMkF,gBAEpB7C,cAAY,mBAEZ,kBAAC,KAAa2H,IAEhB,kBAAC,GAAD,CACErG,SAAUA,EACVvC,KAAMe,QAAQwB,GACdF,gBAAiB,SAACoD,EAAQ9xB,GACxBA,IACAk1B,OAAYn1B,IAEd4uB,QAAS,WACPuG,OAAYn1B,IAEd4gB,UAAWxjB,EAAMwjB,aA3Bd,QAkCE0U,gBAAgB,SAAhBA,CACb/uB,oBACE,YAcM,IAbJ2a,EAaI,EAbJA,KACA0N,EAYI,EAZJA,QACA1c,EAWI,EAXJA,MACAH,EAUI,EAVJA,SACAwjB,EASI,EATJA,YACAC,EAQI,EARJA,WASM1jB,EAAU5B,KAEVulB,EADQvC,eACS3iB,QAAQ,GAE3B2F,EAAQ,EACRqf,EAAYG,SACVxf,EAAUqf,EAAYG,OAAtBxf,OAEN8U,qBAAU,WACJ9U,GACEyf,kBAAQzU,IACVA,EAAKxF,SAASxF,EAAmB,EAAXuf,KAGzB,CAACA,EAAUvU,EAAMhL,IAEpB,IAAM0f,EAAY7K,iBAAuB,MASzC,OALAC,qBAAU,WACJ4K,GAAaA,EAAUxK,SAAWwK,EAAUxK,QAAQyK,gBACtDD,EAAUxK,QAAQyK,eAAe,CAAE7gB,MAAO,aAC3C,IAGD,kBAACX,GAAA,EAAD,CACEoY,UAAW,GACXuB,IAAKwH,EACLljB,UAAWR,EAAQyiB,cACnBriB,MAAK,2BAAOA,GAAP,IAAc5B,QAAS,OAAF,OAASmlB,EAAT,cAAuBA,EAAvB,SAE1B,yBAAKzH,IAAK4H,EAAW1jB,MAAO,CAAEzE,QAAS,SACrC,kBAACunB,GAAD,CACE53B,MAAO8jB,EACP+T,gBAAiB,CACfnjB,QAAS,CAAEmW,KAAMnW,EAAQ2iB,UACzBqB,KAAM,SAERZ,UAAW,CAAE5iB,UAAWR,EAAQoR,QAElC,yBAAK5Q,UAAWR,EAAQ0iB,OACxB,kBAAC,KAAD,CAASxiB,MAAM,cAAc+jB,OAAK,GAChC,kBAAC,GAAD,CACEnmB,MACEsR,EAAK/S,cAEJ+S,EAAKoC,cAEFpC,EAAKoC,cAAc9T,KAAK,KACxB,iBAENijB,SAAU,SAAA3e,GACRoN,EAAKzF,eAAe3H,IAEtBvB,QAAQ,QACRT,QAAS,CACPrJ,MAAOqJ,EAAQrJ,MACfupB,UAAWlgB,EAAQkgB,UACnBG,UAAWrgB,EAAQqgB,UACnBC,aAActgB,EAAQsgB,iBAI5B,yBAAK9f,UAAWR,EAAQ0iB,OACxB,kBAAC,KAAD,CACEjH,cAAY,aACZzb,QAAS,CAAEmW,KAAMnW,EAAQ2iB,UACzBqB,KAAK,MACL9S,QAAS4L,GAET,kBAAC,KAAD,CAAWtc,UAAWR,EAAQoR,SAGlC,kBAAC7O,GAAA,EAAD,KAAQtC,QCtMZ7B,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC,UAAW,CACTT,KAAM,CACJ,cAAe,UAKjB,IAAK,CACH,kBADG,OAEH,kBAAmB,oCAGrB,uBAAwB,CACtB,qBADsB,OAEtBuG,MAAO,QAET,6BAA8B,CAC5B,mBAD4B,iBAE5B,qBAAsB,iCAG1B+R,KAAM,CACJxa,QADI,OAEJyc,OAFI,QAGJhU,MAAO,QAET8f,qBAAsB,CACpBC,WADoB,OAEpBxoB,QAFoB,OAGpByoB,iBAHoB,0CAIpBhM,OAAQ,SAEViM,QAAS,CACPC,QAAS,WAEXxJ,WAAY,CACVb,UADU,OAEVqK,QAAS,cAEXC,OAAQ,CACNnJ,SAAU,GAEZsH,KAAM,CACJtH,SAAU,GAEZ8E,UAAW,CACTvhB,MAAOL,kBAAsBgY,cAE/B+J,UAAW,CACT,UAAW,CACT/gB,gBAAiBhB,kBAAsB0kB,QAG3C1C,aAAc,CACZ2C,YAAa3kB,oBADD,KAEZgB,gBAAiBhB,kBAAsB0kB,WA+F5BvuB,2BA3Ff,SAAa,GAA4B,IAA1Bma,EAA0B,EAA1BA,QAAS4V,EAAiB,EAAjBA,cAChBxkB,EAAU5B,KACRjB,EAAkByR,EAFa,cAG/B0M,EAA+B1M,EAHA,cAGhB6V,EAAgB7V,EAHA,YAkBvC,OACE,yBACEpO,UAAWR,EADb,KAEEI,MAAO,CACLskB,oBAAqB,aAAF,OACjBpJ,EAAgB,aAAH,eADI,MAKrB,yBAAK9a,UAAWR,EAAQkkB,sBACtB,yBAAK1jB,UAAWR,EAAQqkB,SACtB,wBAAQ7jB,UAAWR,EAAnB,OAAmCzH,SAAS,UAC1C,4BACGqW,EAAA,WAAkB,SAAA+V,GAAI,OACrB,sBACE1jB,IAAK0jB,EADP,MAEE/E,UAAW+E,EAFb,MAGE7V,UAAW6V,EAHb,UAIE/V,QAASA,OAGb,yBAAKpO,UAAWR,EAAQ0iB,OACxB,wBAASxiB,MAAT,iBAAgC+jB,OAAK,GACnC,sBACEnmB,MAAO8Q,EADT,KAEE+R,SAtChB,YAEI/R,qBACAA,6BAFF,GAIEA,8GAKAA,2BA6BYnO,QAHF,QAIET,QAAS,CACPkgB,UAAWlgB,EADJ,UAEPqgB,UAAWrgB,EAFJ,UAGPsgB,aAActgB,EAAQsgB,iBAlB9B,EAuBE,yBAAK9f,UAAWR,EAAQ0iB,OACxB,yBAAKtiB,MAAO,CAAEgE,MAAF,IAAc3E,UAAW,KACnC,sBAAUgB,QAAQ,cAK1B,yBAAKD,UAAWR,EAAQ8a,YACrBlM,EAAA,WAAkB,SAAAQ,GACjB,IAAMrT,EAAWoB,cAA0BiS,EAA3C,MACA,MACE,MAAM,IAAIhe,MAAM,qBAAV,OAA+Bge,EAArC,OAHuB,IAKjBtU,EAAmBiB,EALF,eAMzB,OACE,sBACEkF,IAAG,eAAUmO,EADf,IAEEA,KAFF,EAGE0N,QAAS,kBAAMlO,aAAN,KAET,qBACEtjB,MADF,EAEEsjB,QAFF,EAGEiD,aAAc1U,EAAc0U,mBAKpC,yBAAKzR,MAAO,CAAEgY,OAAQ,SAIzBkD,EAAgB,sBAAc1M,QAASA,IAlE1C,KAmEE,sBAAUA,QAASA,Q,sBC/InBjc,GAA+B,qBAAXyD,QAA0BmlB,QAAQnlB,OAAOD,UAEnE,SAASjD,GAAcC,GACrB,MAAO,QAASA,EAalB,IC5BO,GACA,GACA,GD0BDyxB,GAAqBnwB,oBACzB,SAACyG,GAMK,IACI/H,EAA+D+H,EAA/D/H,SAAUzD,EAAqDwL,EAArDxL,KAAM4M,EAA+CpB,EAA/CoB,YADpB,EACmEpB,EAAlC2pB,wBADjC,MACoDlyB,GADpD,EAEEmyB,EACH3xB,GAAYD,GAAcC,KAAe0xB,EACtC,MACA,OALF,EAMwChM,mBAASiM,GANjD,mBAMGC,EANH,KAMmBC,EANnB,KAkBJ,OACE,oCACE,kBAACC,GAAA,EAAD,CAAYC,QAAM,EAACC,QAAQ,mBACxBz1B,GAEH,kBAAC,KAAD,CAAM01B,WAAS,EAAC3mB,QAAS,EAAGic,UAAU,MAAM2K,WAAW,UACrD,kBAAC,KAAD,CAAMC,MAAI,GACR,kBAACC,GAAA,EAAD,CACEznB,MAAOinB,EACPS,WAAS,EACT9D,SApBoB,SAC5BzB,EACAwF,GAEiB,QAAbA,EACFT,EAAkB,OACTH,GACTG,EAAkB,SAcZjN,aAAW,sBAEV8M,EACC,kBAACa,GAAA,EAAD,CAAc5nB,MAAM,OAAOia,aAAW,cAAtC,QAGE,KACJ,kBAAC2N,GAAA,EAAD,CAAc5nB,MAAM,MAAMia,aAAW,OAArC,SAKJ,kBAAC,KAAD,CAAMuN,MAAI,GACY,QAAnBP,EACC,kBAAC,GAAe7pB,GAEhB,kBAACyqB,GAAqBzqB,KAI5B,kBAAC0qB,GAAA,EAAD,KAAiBtpB,OAMnBupB,GAAa,SAAC3qB,GAGd,IACI/H,EAA0B+H,EAA1B/H,SAAU2yB,EAAgB5qB,EAAhB4qB,YAMlB,OACE,kBAAC,KAAD,CACEC,WAAS,EACT7c,aAAc/V,GAAYD,GAAcC,GAAYA,EAASjH,IAAM,GACnEw1B,SATiB,SACnBtI,GAEA0M,EAAY,CAAE55B,IAAKktB,EAAMuI,OAAO7jB,YAW9B6nB,GAAmBlxB,oBACvB,SAACyG,GAA8D,IACrD/H,EAA0B+H,EAA1B/H,SAAU2yB,EAAgB5qB,EAAhB4qB,YAaZE,EACJ7yB,IArGN,SAAwBA,GACtB,MAAO,SAAUA,EAqGXO,CAAeP,IAAcA,EAASS,KAAclE,MA5G5D,SACEyD,GAEA,MAAO,cAAeA,EA0GfC,CAAoBD,IAAaA,EAASnH,WAE/C,OACE,yBAAKoU,MAAO,CAAE7H,SAAU,aACtB,kBAAC,IAAD,CAAQkI,QAAQ,WAAWud,UAAU,SAArC,cAEE,2BACE/iB,KAAK,OACLmF,MAAO,CACL7H,SAAU,WACV+hB,IAAK,EACLqB,KAAM,EACNvX,MAAO,OACP6hB,QAAS,GAEXvE,SA9Ba,SAACtI,GAA+C,IAC3DuI,EAAWvI,EAAXuI,OACF9nB,EAAO8nB,GAAUA,EAAOuE,OAASvE,EAAOuE,MAAM,GAChDrsB,GAEAisB,EADEnzB,GACU,CAAE3G,UAAW6N,EAAK5C,MAElB,CAAErD,KAAMiG,QA0BrBmsB,EACC,kBAAC,KAAD,CACE5lB,MAAO,CAAE+lB,WAAY,UACrB1lB,QAAQ,QACRud,UAAU,QAETgI,GAED,SAMGpB,MC1JTjyB,GAA+B,qBAAXyD,QAA0BmlB,QAAQnlB,OAA5D,UAEMgwB,GAAS,oBAGJC,gBAHLD,IAKF,EAGEE,G,WACJ,aAAc,oBACZnyB,KAAA,YACAA,KAAA,0C,kDAkBW,2BAANL,EAAM,yBAANA,EAAM,gBACXK,KAAA,cAAmB,CAAE8G,KAAF,MAAenH,W,8BAGrB,2BAANA,EAAM,yBAANA,EAAM,gBACbK,KAAA,cAAmB,CAAE8G,KAAF,QAAiBnH,W,kCAGnB,2BAANA,EAAM,yBAANA,EAAM,gBACjBK,KAAA,cAAmB,CAAE8G,KAAF,YAAqBnH,W,kCAGvB,2BAANA,EAAM,yBAANA,EAAM,gBACjBK,KAAA,cAAmB,CAAE8G,KAAF,YAAqBnH,W,6BAG5B,2BAANA,EAAM,yBAANA,EAAM,gBACZK,KAAA,cAAmB,CAAE8G,KAAF,OAAgBnH,W,kCAGlB,2BAANA,EAAM,yBAANA,EAAM,gBACjBK,KAAA,cAAmB,CAAE8G,KAAF,YAAqBnH,W,6CAGZ,2BAANA,EAAM,yBAANA,EAAM,gBAC5BK,KAAA,cAAmB,CAAE8G,KAAF,uBAAgCnH,W,sCAG9B,2BAANA,EAAM,yBAANA,EAAM,gBACrBK,KAAA,cAAmB,CAAE8G,KAAF,gBAAyBnH,W,6CAGhB,2BAANA,EAAM,yBAANA,EAAM,gBAC5BK,KAAA,cAAmB,CAAE8G,KAAF,uBAAgCnH,W,0CAG1B,2BAANA,EAAM,yBAANA,EAAM,gBACzBK,KAAA,cAAmB,CAAE8G,KAAF,oBAA6BnH,W,kCAG/B,2BAANA,EAAM,yBAANA,EAAM,gBACjBK,KAAA,cAAmB,CAAE8G,KAAF,YAAqBnH,W,gCAGzB,2BAANA,EAAM,yBAANA,EAAM,gBACfK,KAAA,cAAmB,CAAE8G,KAAF,UAAmBnH,W,6BAG1B,2BAANA,EAAM,yBAANA,EAAM,gBACZK,KAAA,cAAmB,CAAE8G,KAAF,OAAgBnH,W,iCAGnB,2BAANA,EAAM,yBAANA,EAAM,gBAChBK,KAAA,cAAmB,CAAE8G,KAAF,WAAoBnH,W,iCAGvB,2BAANA,EAAM,yBAANA,EAAM,gBAChBK,KAAA,cAAmB,CAAE8G,KAAF,WAAoBnH,W,+BAGzB,2BAANA,EAAM,yBAANA,EAAM,gBACdK,KAAA,cAAmB,CAAE8G,KAAF,SAAkBnH,W,kCAG3BoF,GACV,IAAMkf,GAAUjkB,KAAKoyB,YAAYz4B,MAAM,OAAvC,GACA,MAAO,CACLsW,MAAQgU,EAAD,EAAelf,EADjB,OAELkf,Y,+BAIY,2BAANtkB,EAAM,yBAANA,EAAM,gBACdK,KAAA,cAAmB,CAAE8G,KAAF,SAAkBnH,W,yCAGb,2BAANA,EAAM,yBAANA,EAAM,gBACxBK,KAAA,cAAmB,CAAE8G,KAAF,mBAA4BnH,W,6BAGnC,2BAANA,EAAM,yBAANA,EAAM,gBACZK,KAAA,cAAmB,CAAE8G,KAAF,OAAgBnH,W,gCAGpB,2BAANA,EAAM,yBAANA,EAAM,gBACfK,KAAA,cAAmB,CAAE8G,KAAF,UAAmBnH,W,+BAGxB,2BAANA,EAAM,yBAANA,EAAM,gBACdK,KAAA,cAAmB,CAAE8G,KAAF,SAAkBnH,W,6BAGzB,2BAANA,EAAM,yBAANA,EAAM,gBACZK,KAAA,cAAmB,CAAE8G,KAAF,OAAgBnH,W,oCAGhB,2BAANA,EAAM,yBAANA,EAAM,gBACnBK,KAAA,cAAmB,CAAE8G,KAAF,cAAuBnH,W,qCAGtB,2BAANA,EAAM,yBAANA,EAAM,gBACpBK,KAAA,cAAmB,CAAE8G,KAAF,eAAwBnH,W,8BAG9B,2BAANA,EAAM,yBAANA,EAAM,gBACbK,KAAA,cAAmB,CAAE8G,KAAF,QAAiBnH,W,+BAGtB,2BAANA,EAAM,yBAANA,EAAM,gBACdK,KAAA,cAAmB,CAAE8G,KAAF,SAAkBnH,W,mCAGnB,2BAANA,EAAM,yBAANA,EAAM,gBAClBK,KAAA,cAAmB,CAAE8G,KAAF,aAAsBnH,W,mCAGvB,2BAANA,EAAM,yBAANA,EAAM,gBAClBK,KAAA,cAAmB,CAAE8G,KAAF,aAAsBnH,W,kCAGxB,2BAANA,EAAM,yBAANA,EAAM,gBACjBK,KAAA,cAAmB,CAAE8G,KAAF,YAAqBnH,W,kCAGvB,2BAANA,EAAM,yBAANA,EAAM,gBACjBK,KAAA,cAAmB,CAAE8G,KAAF,YAAqBnH,W,gCA3I1BsM,GACdjM,KAAA,cAAmB,CAAE8G,KAAF,cAAuBmF,Y,8BAG9BA,GACZjM,KAAA,cAAmB,CAAE8G,KAAF,YAAqBmF,Y,yBAGjCA,GACPjM,KAAA,cACAA,KAAA,cAAmB,CAAE8G,KAAF,OAAgBmF,c,KA4IjComB,G,WACJ,gBAA2B,oBACzBryB,KAAA,QACAA,KAAA,S,uDAGS8G,GACT,UAAIA,EAAe,MAAM,IAAI7J,MAAM,gBAAV,OAAN,IAEnB,OADA+C,KAAA,QAAe,IAAf,GACOA,KAAP,Y,KAKJ,GAAI,GACFsyB,GAAe,cACb,IAAMC,EAASnI,uBAAf,UAGA,OAFAmI,UACAA,WACA,GAEFC,GAAiB,uCAAG,uCAAAz5B,EAAA,0GAEV,IAAIkE,MAFM,kIAMX,CAAEw1B,QAASF,gBANA,2CAAH,sDAQjBG,cACK,GAAIT,GACTK,GAAe,qBAAmB,IAAIJ,gBAAgBjiB,EAAvC,IACfuiB,GAAoBvwB,0BAA4B1K,KAAhDi7B,kBACAE,GAAkBzwB,oBAAsB1K,KAAxCm7B,iBACK,GAAIT,GAAa,QAE4BU,EAF5B,MAEAC,GAFA,gBAEkBC,GAFlB,SAGtBP,MACAE,GAAiB,uCAAG,2CAAAz5B,EAAA,0GAEV,IAAIkE,MAFM,gHAMZ61B,EAAUP,EANE,YAOZQ,EAAM,IAPM,qBAQX,IAAIC,SAAQ,cACjBD,SAAa,kBAAME,EAAN,IACbF,YACAA,YAXgB,2CAAH,sDAcjBL,WAEAJ,GAAe,cACb,OAAO,IAAI,GAAJ,EAAP,IAEFE,GAAoB,SAAAD,GAClB,OAAOA,EAAP,SAEFG,GAAkB,SCxOpB,SAASQ,GAAkBnsB,GAOxB,IAECkJ,EAMElJ,EANFkJ,MACAgU,EAKEld,EALFkd,OACAkP,EAIEpsB,EAJFosB,sBACAlnB,EAGElF,EAHFkF,MACAmnB,EAEErsB,EAFFqsB,UACAC,EACEtsB,EADFssB,aAEIC,EAAgBxO,iBAA0B,MAEhDC,qBAAU,WACR,GAAKqO,EAAL,CACA,IAAMb,EAASe,EAAcnO,QAC7B,GAAKoN,EAAL,CACA,IAAMgB,EAAUhB,EAAOiB,WAAW,MAClC,GAAKD,EACL,GAAIH,EAAUK,SACZL,EAAUK,SAASrtB,SAAQ,SAACstB,GACL,gBAAjBA,EAAQ5sB,KACVysB,EAAQI,YAAcD,EAAQznB,MACJ,cAAjBynB,EAAQ5sB,KACjBysB,EAAQK,UAAYF,EAAQznB,MACF,SAAjBynB,EAAQ5sB,KACjBysB,EAAQM,KAAOH,EAAQznB,MAGvBsnB,EAAQG,EAAQ5sB,MAAhB,MAAAysB,EAAO,YAAkBG,EAAQ/zB,eAGhC,GAAIyzB,aAAqBV,GAC9Ba,EAAQO,UAAUV,EAAW,EAAG,QAC3B,GAAIA,EAAUX,QAAS,CAC5B,IAAMM,EAAM,IAAIF,MAChBE,EAAIgB,OAAS,kBAAMR,EAAQO,UAAUf,EAAK,EAAG,IAC7CA,EAAI34B,IAAMg5B,EAAUX,aAErB,CAACW,IAEJ,IAAMY,EAAiBX,EAAe,eAAiB,GACvD,OACE,4BACE/L,cAAA,4BAAkC0M,GAClCjM,IAAKuL,EACLrjB,MAAOA,EAAQkjB,EACflP,OAAQA,EAASkP,EACjBlnB,MAAK,aAAIgE,QAAOgU,UAAWhY,KAajCinB,GAAkBe,aAAe,CAC/Bb,eAAWr5B,EACXo5B,sBAAuB,EACvBlnB,MAAO,IAIMinB,U,uLClETjpB,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC+pB,KAAM,CACJjkB,MADI,IAEJgU,OAFI,IAGJF,OAAQ,WAEVxoB,KAAM,CACJ2Q,UAAW/B,EADP,UAEJgqB,UAFI,SAGJlpB,SAAU,KAEZmpB,MAAO,CACLnQ,OAAQ,SAIZ,SAASoQ,GAAe,GAA0B,IAAxB94B,EAAwB,EAAxBA,KAAMwhB,EAAkB,EAAlBA,QAASuX,EAAS,EAATA,MACjCzoB,EAAU5B,KADgC,EAElBya,oBAFkB,sBAEzC6P,EAFyC,KAEhCC,EAFgC,KAGhD,OACE,2BACE,uBACEnoB,UAAWR,EADb,KAEE4oB,YAAa,kBAAMD,GAAN,IACbE,WAAY,kBAAMF,GAAN,IACZzX,QAJF,EAKE4X,OAAQvN,QAAQmN,IAEhB,wBAAWloB,UAAWR,EAAtB,MAAqCyoB,MAAOA,KAE9C,wBAAYhoB,QAAZ,YAAgCD,UAAWR,EAAQtQ,MAXvD,IAyBF84B,gBAA8B,CAC5BtX,QAAS,aACT9Q,MAAO,IAGT,IAAM2oB,GAAuB,CAC3Br5B,KAAM,eAAF,QAAiB,IAAId,MADE,kBAE3Bo6B,YAAa,IAGR,SAASC,GAAgB,GAAU,IAAR9S,EAAQ,EAARA,KAIhC,OAAO,sBAAgBzmB,KAAhB,QAA6BwhB,QAHpC,WACEiF,uBAEoDsS,MAAOS,OAOxD,SAASC,GAAoB,GAAU,IAARhT,EAAQ,EAARA,KASpC,OAAO,sBAAgBzmB,KAAhB,QAA6BwhB,QARpC,WACE,IAAMkY,EAAW,OAAH,IAAG,CAAH,uBAEZ15B,KAAM,eAAF,QAAiB,IAAId,MAFb,kBAGZmY,MAAO,KAEToP,iBAEoDsS,MAAOS,OAMxD,SAASG,GAA6B,GAAU,IAARlT,EAAQ,EAARA,KAU7C,OACE,sBACEzmB,KADF,qBAEEwhB,QAZc,WAChB,IAAMkY,EAAW,OAAH,IAAG,CAAH,uBAEZ15B,KAAM,eAAF,QAAiB,IAAId,MAFb,kBAGZmY,MAAO,CAAC,CAAE9L,KAAM,uBAElBkb,iBAOEsS,MAAOa,OAQN,SAASC,GAA2B,GAAU,IAARpT,EAAQ,EAARA,KAU3C,OACE,sBACEzmB,KADF,qBAEEwhB,QAZqB,WACvB,IAAMkY,EAAW,OAAH,IAAG,CAAH,uBAEZ15B,KAAM,eAAF,QAAiB,IAAId,MAFb,kBAGZmY,MAAO,CAAC,CAAE9L,KAAM,uBAElBkb,sBAOEsS,MAAOa,OASN,SAASE,GAAsB,GAAU,IAARrT,EAAQ,EAARA,KAatC,OACE,sBACEzmB,KADF,+BAEEwhB,QAfoB,WACtB,IAAMkY,EAAW,OAAH,IAAG,CAAH,uBAEZ15B,KAAM,eAAF,QAAiB,IAAId,MAFb,kBAGZmY,MAAO,CACL,CACE9L,KAAM,sBAIZkb,sBAME/V,MAAO,CAAE5B,QAAS,GAClBiqB,MAAOgB,OASN,SAASC,GAAwB,GAAU,IAARvT,EAAQ,EAARA,KASxC,OACE,sBACEzmB,KADF,+BAEEwhB,QAXoB,WACtB,IAAMkY,EAAW,OAAH,IAAG,CAAH,uBAEZ15B,KAAM,eAAF,QAAiB,IAAId,MAFb,kBAGZmY,MAAO,CAAC,CAAE9L,KAAM,sBAElBkb,iBAME/V,MAAO,CAAE5B,QAAS,GAClBiqB,MAAOgB,O,+EClKPrrB,GAAYC,aAAW,CAC3BgqB,KAAM,CACJjkB,MADI,IAEJ8T,OAAQ,WAEVyR,WAAY,CACVvlB,MAAO,KAETmkB,MAAO,CACLnQ,OADK,EAEL1B,WAFK,YAMT,SAASkT,GAAkB,GAOxB,IANDC,EAMC,EANDA,YACAC,EAKC,EALDA,aACAC,EAIC,EAJDA,kBACA7Y,EAGC,EAHDA,QACA8Y,EAEC,EAFDA,SACAC,EACC,EADDA,SAEMjqB,EAAU5B,KADf,EAE6Bya,oBAF7B,sBAEM6P,EAFN,KAEeC,EAFf,OAGuC9P,mBAHvC,yBAGMqR,EAHN,KAGoBC,EAHpB,KAUD,IAAMC,EAAkB,SAAA1K,GAEtB,OADAyK,QACA,WAAIzK,EAA4BsK,EAAP,GACzB,WAAItK,EAA4BuK,EAAP,QAAzB,GAIF,OACE,oCACE,uBACEzpB,UAAWR,EADb,KAEE4oB,YAAa,kBAAMD,GAAN,IACbE,WAAY,kBAAMF,GAAN,IACZzX,QAAS,kBAAMA,EAAN,IACT4X,OAAQvN,QAAQmN,IAEhB,wBAAWloB,UAAWR,EAAtB,MAAqCyoB,MAAOsB,IAC5C,wBACErK,OACE,wBAAYxO,QAxBtB,YACEkI,oBACA+Q,EAAgB/Q,EAAhB+Q,iBAuBU,wBAAcxrB,MAAM,eAGxB0rB,mBANF,EAOEnqB,MACE,wBAASA,MAAT,EAA6BoqB,WAAY,KACvC,wBAAY7pB,QAAZ,QAA4B8pB,QAA5B,EAAmCnqB,MAAO,CAAEgE,MAAO,MATzD,IAcEomB,UACE,wBACE/pB,QADF,QAEE9B,MAFF,gBAGE4rB,QAHF,EAIEnqB,MAAO,CAAEgE,MAAO,MAJlB,oBAOG,IAAIxV,KAAKk7B,EAAT,mCAA6D,CAC5DW,UAAW,eAMrB,wBACEr/B,GADF,cAEE2xB,SAFF,EAGE2N,aAHF,EAIElQ,KAAMe,QAJR,GAKEuB,QAASsN,GAET,wBAAUlZ,QAAS,kBAAMkZ,EAAN,YACjB,4BACE,wBAAgBzrB,MAAM,eAExB,wBAAY8B,QAAQ,WAXxB,WAaE,wBAAUyQ,QAAS,kBAAMkZ,EAAN,YACjB,4BACE,wBAAYzrB,MAAM,eAEpB,wBAAY8B,QAAQ,WAxD5B,aAwEFmpB,gBAAiC,CAC/BG,kBACE,svXAGJ,UC3He,eAQT,IAPJjN,EAOI,EAPJA,QACAtC,EAMI,EANJA,KACAmQ,EAKI,EALJA,eAMA,SAASC,EAAkBlL,GACV,UAAXA,GACFiL,IAEF7N,IAGF,OACE,kBAAC+N,GAAA,EAAD,CAAQrQ,KAAMA,EAAMsC,QAAS,kBAAM8N,MACjC,kBAACE,GAAA,EAAD,CAAa1/B,GAAG,sBAAhB,SACA,kBAAC2/B,GAAA,EAAD,KACE,kBAACC,GAAA,EAAD,CAAmB5/B,GAAG,4BAAtB,iFAKF,kBAAC6/B,GAAA,EAAD,KACE,kBAAC,IAAD,CAAQ/Z,QAAS,kBAAM0Z,KAAqBjsB,MAAM,WAAlD,UAGA,kBAAC,IAAD,CACEuS,QAAS,kBAAM0Z,EAAkB,UACjCjsB,MAAM,UACN8B,QAAQ,aAHV,SCJFyqB,GAAW,CAAEr0B,OAAQ,cACrBuH,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6sB,WAAY,CACV7rB,gBAAiBhB,EAAMQ,QAAQC,KAAK,KACpCP,QAASF,EAAMG,QAAQ,GACvB4B,UAAW/B,EAAMG,QAAQ,IAE3B2sB,OAAQ,CACNzW,OAAQrW,EAAMG,QAAQ,IAExB4sB,SAAU,CACRrQ,MAAO,aAILsQ,GAAsB,SAAC,GAMvB,IALJC,EAKI,EALJA,gBACAzO,EAII,EAJJA,QAKMxmB,EAAcF,OAAOo1B,kBAAkBl1B,aAAe40B,GADxD,EAEsCrS,oBAAS,GAF/C,mBAEG4S,EAFH,KAEkBC,EAFlB,KAmBJ,OAhBAxS,qBAAU,WACP,sBAAC,sBAAAhsB,EAAA,mEAEMu+B,EAFN,uBAGIC,GAAiB,GAHrB,SAIUp1B,EAAYO,OAAO,gBAAiB00B,GAJ9C,OAKIzO,GAAQ,GALZ,uDAQE4O,GAAiB,WACf,cATJ,wDAAD,KAaA,CAACD,EAAen1B,EAAawmB,EAASyO,IAGvC,kBAACV,GAAA,EAAD,CAAQrQ,OAAQ+Q,EAAiBzO,QAAS,kBAAMA,GAAQ,KACtD,kBAACgO,GAAA,EAAD,CAAa1/B,GAAG,sBAAhB,0BACsBmgC,EADtB,OAGA,kBAACR,GAAA,EAAD,KACE,kBAACC,GAAA,EAAD,CAAmB5/B,GAAG,4BAAtB,iCAIF,kBAAC6/B,GAAA,EAAD,KACE,kBAAC,IAAD,CAAQ/Z,QAAS,kBAAM4L,GAAQ,IAAQne,MAAM,WAA7C,UAGA,kBAAC,IAAD,CACEuS,QAAS,WACPwa,GAAiB,IAEnB/sB,MAAM,UACN8B,QAAQ,YACRkrB,WAAS,GANX,aAeFC,GAAsB,SAAC,GAQvB,IAPJC,EAOI,EAPJA,aACAC,EAMI,EANJA,gBACAhP,EAKI,EALJA,QAMMxmB,EAAcF,OAAOo1B,kBAAkBl1B,aAAe40B,GADxD,EAEwCrS,mBAAS,IAFjD,mBAEGkT,EAFH,KAEmBC,EAFnB,OAGsCnT,oBAAS,GAH/C,mBAGGoT,EAHH,KAGkBC,EAHlB,KAwBJ,OApBAhT,qBAAU,WACP,sBAAC,sBAAAhsB,EAAA,mEAEM++B,EAFN,uBAGIC,GAAiB,GAHrB,SAIU51B,EAAYO,OAChB,gBACAi1B,EACAC,GAPN,OASIjP,GAAQ,GATZ,uDAYEoP,GAAiB,WACf,cAbJ,wDAAD,KAiBA,CAAC51B,EAAay1B,EAAgBjP,EAASmP,EAAeH,IAGvD,kBAACjB,GAAA,EAAD,CAAQrQ,OAAQsR,EAAiBhP,QAAS,kBAAMA,GAAQ,KACtD,kBAACgO,GAAA,EAAD,CAAa1/B,GAAG,sBAAhB,UACA,kBAAC2/B,GAAA,EAAD,KACE,kBAACC,GAAA,EAAD,CAAmB5/B,GAAG,4BAAtB,4CAGCygC,EAAap2B,SAASs2B,GACrB,kBAACf,GAAA,EAAD,CAAmBrsB,MAAM,SAAzB,qCAC0CotB,EAD1C,KAGE,KACJ,kBAACI,GAAA,EAAD,CACER,WAAS,EACTziB,aAAc4iB,EACdpK,SAAU,SAAAtI,GACR4S,EAAkB5S,EAAMuI,OAAO7jB,WAIrC,kBAACmtB,GAAA,EAAD,KACE,kBAAC,IAAD,CAAQ/Z,QAAS,kBAAM4L,GAAQ,IAAQne,MAAM,WAA7C,UAGA,kBAAC,IAAD,CACEuS,QAAS,WACPgb,GAAiB,IAEnBvtB,MAAM,UACN8B,QAAQ,YACRsb,UAAWgQ,GAAkBF,EAAap2B,SAASs2B,IANrD,SAeO,SAASK,GAAT,GAQZ,IAPDjW,EAOC,EAPDA,KACAkW,EAMC,EANDA,OACA1B,EAKC,EALDA,eAMMr0B,EAAcF,OAAOo1B,kBAAkBl1B,aAAe40B,GAD3D,EAE+BrS,qBAF/B,mBAEMyT,EAFN,KAEgBC,EAFhB,OAG6C1T,qBAH7C,mBAGM0S,EAHN,KAGuBiB,EAHvB,OAI6C3T,qBAJ7C,mBAIMiT,EAJN,KAIuBW,EAJvB,OAKyC5T,qBALzC,mBAKM6T,EALN,KAKqBC,EALrB,OAMmD9T,oBAAS,GAN5D,mBAMM+T,EANN,KAM0BC,EAN1B,OAOuChU,mBAA6B,MAPpE,mBAOMqR,EAPN,KAOoBC,EAPpB,OAQyBtR,oBAAS,GARlC,mBAQMiU,EARN,KAQaC,EARb,KASK/sB,EAAU5B,KAEVytB,OAA4B39B,IAAbo+B,EAAyBl/B,OAAOC,KAAKi/B,GAAY,GACtEnW,EAAK6W,qBAAqBnB,GAE1B,IAAMoB,EAAiBX,EACnBl/B,OAAOiE,QAAQi7B,GACZrqB,QAAO,uCAAiDirB,SACxDnP,MAAK,SAAC7wB,EAAQC,GAAT,OAAoBA,EAAE,GAAG+/B,MAAMC,QAAUjgC,EAAE,GAAGggC,MAAMC,WAC5D,GAqCJ,OAnCAjU,qBAAU,WACP,sBAAC,4BAAAhsB,EAAA,oEAEQkgC,EACJf,GAAUgB,kBAAiBJ,EAAe79B,OACtC69B,EAAe,GAAG,GAClBP,GALR,6BAOIvW,EAPJ,KAQMzU,KARN,SAQuBpL,EAAYO,OAAO,cAAeu2B,GARzD,6BAQW/qB,MARX,qBAOSirB,gBAPT,0EAYEf,GAAY,WACV,cAbJ,yDAAD,KAiBA,CAACF,EAAQ/1B,EAAa6f,EAAMuW,EAAeO,IAE9C/T,qBAAU,WACP,sBAAC,sBAAAhsB,EAAA,mEAEM0/B,EAFN,uBAGIC,GAAsB,GAH1B,KAIIN,EAJJ,SAIsBj2B,EAAYO,OAAO,gBAJzC,2FAOE01B,GAAY,WACV,cARJ,yDAAD,KAYA,CAACj2B,EAAas2B,IAEZN,EAeH,oCACE,kBAACiB,GAAD,CACE/S,KAAMsS,EACNnC,eAAgBA,EAChB7N,QAAS,WACPiQ,GAAS,MAGb,kBAAC,GAAD,CACEjB,gBAAiBA,EACjBD,aAAcA,EACd/O,QAAS,SAAC0Q,GACRf,OAAmBv+B,GACnB2+B,EAAsBW,MAG1B,kBAAC,GAAD,CACEjC,gBAAiBA,EACjBzO,QAAS,SAAA0Q,GACPhB,OAAmBt+B,GACnB2+B,EAAsBW,MAG1B,kBAAC,KAAD,CACEhtB,UAAWR,EAAQqrB,SACnBna,QAAS,SAAAkI,GACPA,EAAMqU,kBACNtD,EAAgB/Q,EAAMkF,iBAGxB,kBAAC,KAAD,OAEF,kBAAC,IAAD,CAAWlf,SAAS,MAClB,kBAACuY,GAAD,MACA,yBAAKnX,UAAWR,EAAQmrB,YACtB,kBAAC,KAAD,CAAY1qB,QAAQ,KAAKD,UAAWR,EAAQorB,QAA5C,uBAGA,kBAAC,KAAD,CAAMhG,WAAS,EAAC3mB,QAAS,GACvB,kBAAC,KAAD,CAAM6mB,MAAI,GACR,kBAAC2D,GAAD,CAAiB9S,KAAMA,KAEzB,kBAAC,KAAD,CAAMmP,MAAI,GACR,kBAACiE,GAAD,CAA4BpT,KAAMA,KAEpC,kBAAC,KAAD,CAAMmP,MAAI,GACR,kBAACkE,GAAD,CAAuBrT,KAAMA,OAInC,kBAAC,KAAD,CAAY1V,QAAQ,KAAKD,UAAWR,EAAQorB,QAA5C,mBAGA,kBAAC,KAAD,CAAMhG,WAAS,EAAC3mB,QAAS,GACtBwuB,EACGA,EAAe33B,KACb,mCAAEu0B,EAAF,KAAe6D,EAAf,YACE,kBAAC,KAAD,CAAMpI,MAAI,EAACrkB,IAAK4oB,GACd,kBAAC,GAAD,CACEA,YAAaA,EACbC,aAAc4D,EAAYR,MAC1BnD,kBAAmB2D,EAAYC,WAC/Bzc,QAAS,WACPyb,EAAiB9C,IAEnBG,SAAU,WACRwC,EAAmB3C,IAErBI,SAAU,WACRwC,EAAmB5C,UAM7B,OAIR,kBAAC,KAAD,CACEz+B,GAAG,cACH2xB,SAAUmN,EACVQ,aAAW,EACXlQ,KAAMe,QAAQ2O,GACdpN,QAAS,WACPqN,EAAgB,QAGlB,kBAAClM,GAAA,EAAD,0BACA,kBAAC,KAAD,CACE/M,QAAS,WACP6b,GAAS,GACT5C,EAAgB,QAGlB,kBAAChM,GAAA,EAAD,KACE,kBAAC,KAAD,OAEF,kBAAC,KAAD,CAAY1d,QAAQ,WAApB,oBA/GJ,kBAACmtB,GAAA,EAAD,CACExtB,MAAO,CACL7H,SAAU,QACV+hB,IAAK,MACLqB,KAAM,MACNtb,WAAY,GACZ8lB,YAAa,IAEft0B,KAAM,KC7Od,IAAMuM,GAAYC,aAAW,CAC3BwvB,WAAY,CACVjuB,OAAQ,kBACRrH,SAAU,WACVsG,WAAY,QACZivB,cAAe,OACf5T,OAAQ,OAIN6T,GAAU,SAAC,GAYX,IAXJC,EAWI,EAXJA,QACAC,EAUI,EAVJA,QACAhkB,EASI,EATJA,cACArJ,EAQI,EARJA,QAQI,IAPJstB,eAOI,MAPM,IAON,EACEluB,EAAU5B,KADZ,EAGsBya,oBAAS,GAH/B,mBAGGsV,EAHH,KAGUC,EAHV,KAQJ,GAJAlV,qBAAU,WACR,IAAMmV,EAASnR,YAAW,kBAAMkR,GAAS,KAAOF,GAChD,OAAO,kBAAM/Q,aAAakR,OAExBztB,GAAWutB,EAAO,CACpB,IAAMj1B,EAAOS,yBAAesQ,EAAe,YAAa,CAACrJ,IACzD,OACE,yBACEJ,UAAWR,EAAQ6tB,WACnBztB,MAAO,CAAEub,KAAMqS,EAAS1T,IAAK2T,IAE5B/0B,GAIP,OAAO,MAWT60B,GAAQ3F,aAAe,CACrBxnB,aAAS1S,GAGIuG,0BAASs5B,ICxDlBO,GAAiB,SAAC,GAMlB,IALJ3D,EAKI,EALJA,eACA4D,EAII,EAJJA,gBAII,EACgC1V,oBAAS,GADzC,mBACG2V,EADH,KACeC,EADf,KAGJ,OACE,oCACE,kBAAC,IAAD,CACEhT,cAAY,cACZ9c,MAAM,UACN8B,QAAQ,YACRyQ,QAAS,kBAAMud,GAAc,KAE5BF,GAEH,kBAAChB,GAAD,CACEzQ,QAAS,kBAAM2R,GAAc,IAC7BjU,KAAMgU,EACN7D,eAAgBA,MAUlB+D,GAAmB,SAAC,GAUpB,IATJC,EASI,EATJA,eACAr+B,EAQI,EARJA,MACAq6B,EAOI,EAPJA,eACA4D,EAMI,EANJA,gBAOA,OACE,kBAAC1D,GAAA,EAAD,CAAQrQ,MAAI,GACV,kBAACsQ,GAAA,EAAD,CAAa1qB,MAAO,CAAEd,gBAAiB,SAAvC,eACA,kBAACyrB,GAAA,EAAD,KACE,6BACGz6B,EAAM7B,WACNkgC,IAGL,kBAAC1D,GAAA,EAAD,KACE,kBAAC,IAAD,CACEtsB,MAAM,YACN8B,QAAQ,YACRyQ,QAAS,kBAAM9a,OAAOjD,SAAS8a,WAHjC,WAOA,kBAAC,GAAD,CACE0c,eAAgBA,EAChB4D,gBAAiBA,OAc3BG,GAAiBtG,aAAe,CAC9B93B,MAAO,CAAE8xB,QAAS,6BAClBuM,eAAgB,GAChBJ,gBAAiB,iBAGJG,UCrBME,G,oLAcG96B,GAAwC,IACpD+Z,EAAiB/Z,EAAK+W,YAAtBgD,aAWR,OAVIA,IACF/Z,EAAK+W,YAAL,2BACK/W,EAAK+W,aADV,IAEEgkB,SAAU/6B,EAAK+6B,SACfhhB,aAAc,CACZziB,GAAIyiB,EAAaziB,GACjB0jC,kBAAmBjhB,EAAaihB,sBAItC,2BACKh7B,GADL,IAEE0F,OAAQvF,0BAAgBH,EAAK0F,QACzBtF,sBAAYJ,EAAK0F,QACjB1F,EAAK0F,OACTrE,QAASuM,KAAKW,MAAMX,KAAKC,UAAU7N,EAAKqB,UACxC2d,QAAShf,EAAKgf,QAAUhf,EAAKgf,QAAQH,SAASG,QAAU,O,iDAK1Dic,EACAj7B,GAGA,IAAMk7B,EAAe,eAAMD,GACrBE,EAAc,IAAIryB,IAOxB,OANAmyB,EAAOtoB,SAASlM,SAAQ,SAAA20B,GACtB,IAAM/b,EAAIjB,GAAcid,SAASD,GACjCD,EAAYhyB,IAAIhK,OAAOkgB,EAAE/nB,MAAO+nB,MAElC6b,EAAavoB,SAAWwoB,EACxBD,EAAaH,SAAW/6B,EAAK+6B,SACtBG,I,8CAQel7B,GACtB,IAAMk7B,EAAe,eAAMl7B,GACrB0F,EAASrF,KAAK4G,aAAajF,OAAOhC,EAAK0F,QAAU,IAMvD,OALAw1B,EAAax1B,OAASA,EACtBw1B,EAAalc,QAAU,IAAID,GAAwB,CACjDC,QAAShf,EAAKgf,UAGTkc,I,+CAWPD,EACAtoB,EACA2oB,GAEA,IAAMC,EAAa,eAAMN,GAEzB,OADAM,EAAW5oB,SAAW6oB,mBAAQ7oB,EAAS8oB,UAAU,SAAApc,GAAC,OAAIA,EAAER,YACjD0c,I,8EAOYG,EAAwB17B,G,kFACrCsJ,EAAiBjJ,KAAKs7B,sBAAsB37B,G,SAC7B07B,EAAWnhC,KAC9ByF,EAAK47B,UACL,aACAtyB,G,cAHI2xB,E,OAQAC,EAAe76B,KAAKw7B,2BAA2BZ,EAAQj7B,G,kBACtDk7B,G,iJAISz6B,EAAgBq7B,GAChC,OAAOr7B,I,2EASSs7B,G,6FACRC,EAAiCD,EAAjCC,YAAat9B,EAAoBq9B,EAApBr9B,OAAQ2C,EAAY06B,EAAZ16B,QACvBsR,EAAW,IAAI7J,IAEhBzH,GAA8B,IAAnBA,EAAQ/F,O,yCACfqX,G,cAGHspB,EAAiB56B,EAAQG,KAAI,SAACvG,GAGlC,IAAMihC,EAAgB,eAAKjhC,GAO3B,OANIihC,EAAcrlC,QAChBqlC,EAAcrlC,MAAQkO,KAAKsN,MAAM6pB,EAAcrlC,QAE7CqlC,EAAcnlC,MAChBmlC,EAAcnlC,IAAMgO,KAAKkN,KAAKiqB,EAAcnlC,MAEvCmlC,KAGHz7B,EAASw7B,EAAe,GAExBE,EACsB,IAA1BF,EAAe3gC,OACX0gC,EAAYj7B,YACVV,KAAK+7B,kBAAkB37B,EAAQs7B,GAE/BA,GAGFC,EAAYK,6BAA6BJ,EAAgBF,G,SAEzDI,EACHn7B,KACCs7B,cAAI,kBAAMx7B,4BAAiBpC,MAC3ByP,cAAO,SAAArB,GAAO,OAAI,EAAKyvB,qBAAqBR,EAAYjvB,MACxDwvB,cAAI,SAAAxvB,GACF,IAAMxV,EAAKwV,EAAQxV,KACnB,IAAKA,EAAI,MAAM,IAAIgG,MAAJ,8BAAiChG,EAAjC,MACfqb,EAASxJ,IAAI7R,EAAIwV,MAEnB0vB,gBAEDC,Y,gCAEI9pB,G,mJAQYopB,EAAoCjvB,GACvD,OAAKivB,EAAW/c,SACT+c,EAAW/c,QAAQ0d,OAAO5vB,EAASivB,K,8EAIvB/7B,G,4FACXtB,EAAsCsB,EAAtCtB,O,EAAsCsB,EAA9B28B,sB,MAAiB,a,EACjC77B,4BAAiBpC,GACXk+B,EAAmBv8B,KAAKw8B,wBAAwB78B,G,SAE/BK,KAAKU,YAAY67B,G,cAAlCjqB,E,OACN7R,4BAAiBpC,GACjBi+B,EAAe,kB,UACOt8B,KAAKy8B,OAAL,2BAAiBF,GAAjB,IAAmCjqB,c,eAAnDoqB,E,OACNj8B,4BAAiBpC,GACXqL,EAAOizB,0BACX11B,IAAMC,cACJ01B,KAEA,CAAEzyB,MAAO4Y,GAAmBpjB,EAAKwK,QACjCuyB,EAAQ11B,iBAGL01B,EAAQ11B,QAKfs1B,EAAe,uBACTpB,EAAal7B,KAAK68B,yBAAL,2BACZH,GADY,IACHhzB,SACd4I,EACAiqB,GAEFD,EAAe,I,kBACRpB,G,oJAGaG,EAAwB17B,GAC5C,IAAMsJ,EAAiBjJ,KAAKs7B,sBAAsB37B,GAElD,OAAO07B,EAAWnhC,KAAKyF,EAAK47B,UAAW,oBAAqBtyB,K,sCAI5D,OAAO,M,GAtNqCxC,GCpE3Bq2B,G,4HAAkCrC,I,oDCkBvD,SAASsC,GACPC,EACAC,EACAC,EACAC,GAEA,OAAOF,GAAMC,GAAMC,GAAMH,E,IAUrBI,G,WASJ,aAAc,yBARN/yB,aAQM,OANNgzB,eAMM,OAJNC,gBAIM,OAFNC,cAEM,EACZv9B,KAAKqK,QAAU,EACfrK,KAAKs9B,WAAa,I,yDAePz9B,GACXG,KAAKq9B,UAAYx9B,I,gCAGTjE,GACR,GAAIoE,KAAKq9B,UAAW,OAAOr9B,KAAKq9B,UAChC,GAAKr9B,KAAKu9B,eAEgBxjC,IAAtBiG,KAAKu9B,SAAS54B,OACd/I,EAAIoE,KAAKu9B,SAAS54B,QAClB/I,GAAKoE,KAAKu9B,SAAStsB,KAAvB,CACA,IAAM9M,EAASvI,EAAIoE,KAAKu9B,SAASp5B,OAKjC,OAAOnE,KAAKu9B,SAASC,KAAKr5B,M,mCAGfqjB,EAAcE,GACzB,GAAI1nB,KAAKq9B,UAAW,OAAO,EAE3B,IAAKr9B,KAAKu9B,SAAU,OAAO,EAHsB,MAK5Bv9B,KAAKu9B,SAAlB54B,EALyC,EAKzCA,IAAKsM,EALoC,EAKpCA,IAEb,GAAIyW,GAAS/iB,GAAO6iB,GAAQvW,EAAK,OAAO,EAKxC,IAFA,IAAMwsB,EAAO/4B,KAAKC,IAAIsM,EAAKyW,GACvB9rB,EAAI8I,KAAKuM,IAAItM,EAAK6iB,GACf5rB,EAAI8rB,GAAS9rB,EAAI6hC,EAAM7hC,GAAK,EACjC,GAAIoE,KAAK09B,UAAU9hC,GACjB,OAAO,EAIX,OAAO,I,iCAGE4rB,EAAcE,GAEvB,IAAMiW,EAAYjW,EAAQF,EAC1B,MAAO,CACLrjB,OAAQqjB,EAAOmW,EACfh5B,IAAK6iB,EACLvW,IAAKyW,EACL8V,KAAM,IAAIziC,MAAM,EAAI4iC,M,8BAKhB1U,EAAoBppB,GAC1B,IAAM2nB,EAAOyB,EAAKnuB,EACZ4sB,EAAQuB,EAAKruB,EAAIoF,KAAKqK,QACvBrK,KAAKu9B,WACRv9B,KAAKu9B,SAAWv9B,KAAK49B,WAAWpW,EAAME,IAKxC,IAAImW,EAAQrW,EAAOxnB,KAAKu9B,SAASp5B,OAC7B25B,EAASpW,EAAQ1nB,KAAKu9B,SAASp5B,OAC7B45B,EAAa/9B,KAAKu9B,SAASC,KAAKviC,OAItC,GAAI6iC,GAAU99B,KAAKu9B,SAASC,KAAKviC,OAAQ,CACvC,IAAM+iC,EAAmBF,EAAS,EAC9B99B,KAAKu9B,SAASC,KAAKviC,OAAS+iC,EAAmBh+B,KAAKs9B,YACtDphC,QAAQ4H,KACN,8GAEF9D,KAAKu9B,SAAWv9B,KAAK49B,WAAWpW,EAAME,IAC7BsW,EAAmB,IAC5Bh+B,KAAKu9B,SAASC,KAAOx9B,KAAKu9B,SAASC,KAAKS,OACtC,IAAIljC,MAAMijC,KAMhB,GAAIxW,EAAOxnB,KAAKu9B,SAASp5B,OAAQ,CAE/B,IAAM65B,EAAmBt5B,KAAKC,IAC5Bo5B,EAAaF,EACb79B,KAAKu9B,SAASp5B,QAEZnE,KAAKu9B,SAASC,KAAKviC,OAAS+iC,EAAmBh+B,KAAKs9B,YACtDphC,QAAQ4H,KACN,8GAGF9D,KAAKu9B,SAAWv9B,KAAK49B,WAAWpW,EAAME,KAEtC1nB,KAAKu9B,SAASC,KAAO,IAAIziC,MAAMijC,GAAkBC,OAC/Cj+B,KAAKu9B,SAASC,MAEhBx9B,KAAKu9B,SAASp5B,QAAU65B,IAG5BF,EAASpW,EAAQ1nB,KAAKu9B,SAASp5B,SAC/B05B,EAAQrW,EAAOxnB,KAAKu9B,SAASp5B,QAlJJ,KA0JvBjI,QAAQ4H,KAAR,oDAEIg6B,EAASD,EAFb,0BAIE5U,EACAppB,GAIJ,IAAK,IAAIjE,EAAIiiC,EAAOjiC,EAAIkiC,EAAQliC,GAAK,EAEnCoE,KAAKu9B,SAASC,KAAK5hC,GAAKiE,EAGtB2nB,EAAOxnB,KAAKu9B,SAAS54B,MAAK3E,KAAKu9B,SAAS54B,IAAM6iB,GAC9CE,EAAQ1nB,KAAKu9B,SAAStsB,MAAKjR,KAAKu9B,SAAStsB,IAAMyW,K,mCAOxCF,EAAcE,GACzB,IAAI1nB,KAAKq9B,WAGJr9B,KAAKu9B,YAGN7V,GAAS1nB,KAAKu9B,SAAS54B,KAAO6iB,GAAQxnB,KAAKu9B,SAAStsB,KAGxD,GAAIuW,GAAQxnB,KAAKu9B,SAAS54B,KAAO+iB,GAAS1nB,KAAKu9B,SAAStsB,IACtDjR,KAAKu9B,cAAWxjC,MADlB,CAgBA,GAVI2tB,EAAQ1nB,KAAKu9B,SAAS54B,KAAO6iB,GAAQxnB,KAAKu9B,SAAS54B,MACrD3E,KAAKu9B,SAAS54B,IAAM+iB,GAIlBF,EAAOxnB,KAAKu9B,SAAStsB,KAAOyW,GAAS1nB,KAAKu9B,SAAStsB,MACrDjR,KAAKu9B,SAAStsB,IAAMuW,GAKpBxnB,KAAKu9B,SAASp5B,OAASnE,KAAKu9B,SAAS54B,IA5Mf,KA6MtB3E,KAAKu9B,SAASC,KAAKviC,OACjB+E,KAAKu9B,SAAStsB,IA9MM,IA8MsBjR,KAAKu9B,SAASp5B,OAC1D,CAEA,IAAM+5B,EAAiBl+B,KAAKu9B,SAAS54B,IAAM3E,KAAKu9B,SAASp5B,OACnDg6B,EACJn+B,KAAKu9B,SAASC,KAAKviC,OACnB,GACC+E,KAAKu9B,SAAStsB,IAAMjR,KAAKu9B,SAASp5B,QAIrCnE,KAAKu9B,SAASC,KAAOx9B,KAAKu9B,SAASC,KAAKt9B,MACtCg+B,EACAl+B,KAAKu9B,SAASC,KAAKviC,OAASkjC,GAE9Bn+B,KAAKu9B,SAASp5B,QAAU+5B,OAGnB,GAAIl+B,KAAKu9B,SAASp5B,OAASnE,KAAKu9B,SAAS54B,IAhOxB,IAgOmD,CAEzE,IAEMy5B,EADJp+B,KAAKu9B,SAAS54B,IAAMD,KAAKsN,MAAMqsB,KACEr+B,KAAKu9B,SAASp5B,OAEjDnE,KAAKu9B,SAASC,KAAKjhB,OAAO,EAAG6hB,GAC7Bp+B,KAAKu9B,SAASp5B,QAAUi6B,OAGnB,GACLp+B,KAAKu9B,SAASC,KAAKviC,OACnB+E,KAAKu9B,SAAStsB,IAAMjR,KAAKu9B,SAASp5B,OA5OZ,IA6OtB,CAEA,IAAMm6B,EACJt+B,KAAKu9B,SAAStsB,IACdjR,KAAKu9B,SAASp5B,OACd,EACAO,KAAKsN,MAAMqsB,KAGbr+B,KAAKu9B,SAASC,KAAKviC,OAASqjC,EAgB9B,IAPA,IAAMT,EAAQn5B,KAAKuM,IAAIjR,KAAKu9B,SAAS54B,IAAK6iB,GAAQxnB,KAAKu9B,SAASp5B,OAM1D25B,EAASp5B,KAAKC,IAAI+iB,EAAO1nB,KAAKu9B,SAAStsB,KAAOjR,KAAKu9B,SAASp5B,OACzDvI,EAAIiiC,EAAOjiC,GAAK,GAAKA,EAAIkiC,EAAQliC,GAAK,EAC7CoE,KAAKu9B,SAASC,KAAK5hC,QAAK7B,O,KAKTwkC,G,WAmBnB,aAeQ,6DAAJ,GAAI,IAdNC,cAcM,MAdG,GAcH,MAbNC,cAaM,MAbG,GAaH,MAZNnzB,iBAYM,MAZM,IAYN,MAXNozB,oBAWM,MAXS,IAWT,MAVNC,mBAUM,MAVQ,SAUR,2BAjCAH,YAiCA,OA/BAC,YA+BA,OA7BAC,kBA6BA,OA3BAE,YA2BA,OAzBAC,gBAyBA,OAvBDC,sBAuBC,OArBAxzB,eAqBA,OAnBAqzB,iBAmBA,OAjBAI,kBAiBA,EACN/+B,KAAKw+B,OAASA,EACdx+B,KAAKy+B,OAASA,EACdz+B,KAAK0+B,aAAeA,EACpB1+B,KAAK8+B,kBAAmB,EACxB9+B,KAAK2+B,YAAcA,EAGM,YAArB3+B,KAAK2+B,cACP3+B,KAAKy+B,OAAS/5B,KAAK2O,MAAMrT,KAAKy+B,OAAS,IAAM,EAC7Cz+B,KAAKw+B,OAAS95B,KAAK2O,MAAMrT,KAAKw+B,OAAS,IAAM,GAG/Cx+B,KAAK4+B,OAAS,GACd5+B,KAAK6+B,WAAa,IAAIp2B,IACtBzI,KAAKsL,UAAY5G,KAAKkN,KAAKtG,EAAYtL,KAAKy+B,QAC5Cz+B,KAAK++B,aAAe,E,oDAQpB9nC,EACAuwB,EACAE,EACAzD,EACApkB,GAIA,IAAMm/B,EAAYh/B,KAAK6+B,WAAW9nC,IAAIE,GACtC,GAAI+nC,EACF,OAAsB,OAAlBA,EAAU7Y,IAAqB,MAGnCnmB,KAAKi/B,gBAAgBD,GACdA,EAAU7Y,IAAMnmB,KAAKy+B,QAG9B,IAAMS,EAAQx6B,KAAKsN,MAAMwV,EAAOxnB,KAAKw+B,QAC/BW,EAASz6B,KAAKsN,MAAM0V,EAAQ1nB,KAAKw+B,QACjCY,EAAU16B,KAAKkN,KAAKqS,EAASjkB,KAAKy+B,QAGlCY,EAA0B,CAC9BpoC,KACA6D,EAAGokC,EACHtkC,EAAGukC,EACHhZ,IAAK,KAELmZ,EAAGF,EACHG,eAAgBtb,EAChBpkB,QAGI2/B,EAASx/B,KAAKsL,UAAY8zB,EAC5BjZ,EAAM,EACV,GAAyB,aAArBnmB,KAAK2+B,YAA4B,CACnC,KAAOxY,GAAOqZ,GACPx/B,KAAKy/B,SAASJ,EAAWlZ,GADVA,GAAO,GAI7B,GAAIA,EAAMqZ,EAIR,OAHAH,EAAUlZ,IAAM,KAChBnmB,KAAK6+B,WAAW/1B,IAAI7R,EAAIooC,GACxBr/B,KAAK8+B,kBAAmB,EACjB,KAQX,OALAO,EAAUlZ,IAAMA,EAChBnmB,KAAKi/B,gBAAgBI,GACrBr/B,KAAK6+B,WAAW/1B,IAAI7R,EAAIooC,GACxBr/B,KAAK++B,aAAer6B,KAAKuM,IAAIjR,KAAK++B,cAAgB,EAAG5Y,EAAMiZ,GAEpDjZ,EAAMnmB,KAAKy+B,S,+BAGXxV,EAAoB9C,GAM3B,IANiD,IACzCyY,EAAW5+B,KAAX4+B,OAIFc,EAAOvZ,EAAM8C,EAAKqW,EACfK,EAAIxZ,EAAKwZ,EAAID,EAAMC,GAAK,EAAG,CAClC,IAAMC,EAAMhB,EAAOe,GACnB,GAAIC,IAAQA,EAAIC,aAAa5W,EAAKnuB,EAAGmuB,EAAKruB,GACxC,OAAO,EAIX,OAAO,I,oCAMagkC,EAAwBe,GAC5C,IAAIC,EAAMhB,EAAOe,GACjB,IAAKC,EAAK,CACR,GAAID,EAAI3/B,KAAK0+B,aACX,MAAM,IAAIzhC,MAAJ,6BAEF+C,KAAK0+B,aAAe1+B,KAAKy+B,OAFvB,kCAMRmB,EAAM,IAAIxC,GACVwB,EAAOe,GAAKC,EAEd,OAAOA,I,sCAGO3W,GACd,GAAiB,OAAbA,EAAK9C,IAAT,CAEA,IAAMtmB,EAAOopB,EAAKppB,OAAQ,EAClB++B,EAAW5+B,KAAX4+B,OACFkB,EAAO7W,EAAK9C,IAAM8C,EAAKqW,EAC7B,GAAIrW,EAAKruB,EAAIquB,EAAKnuB,EAraO,IA4avB,IAAK,IAAI6kC,EAAI1W,EAAK9C,IAAKwZ,EAAIG,EAAMH,GAAK,EACpC3/B,KAAK+/B,cAAcnB,EAAQe,GAAGK,aAAangC,QAG7C,IAAK,IAAI8/B,EAAI1W,EAAK9C,IAAKwZ,EAAIG,EAAMH,GAAK,EACpC3/B,KAAK+/B,cAAcnB,EAAQe,GAAGM,QAAQhX,EAAMppB,M,mCASrC2nB,EAAcE,GAKzB,IAHA,IAAMwX,EAAQx6B,KAAKsN,MAAMwV,EAAOxnB,KAAKw+B,QAC/BW,EAASz6B,KAAKsN,MAAM0V,EAAQ1nB,KAAKw+B,QAC/BI,EAAW5+B,KAAX4+B,OACCe,EAAI,EAAGA,EAAIf,EAAO3jC,OAAQ0kC,GAAK,EAAG,CACzC,IAAMC,EAAMhB,EAAOe,GACfC,GAAKA,EAAIM,aAAahB,EAAOC,M,8BAI7BloC,GACN,OAAO+I,KAAK6+B,WAAWlhB,IAAI1mB,K,iCAGlB2E,EAAW+jC,GACpB,IAAMQ,EAAKz7B,KAAKsN,MAAM2tB,EAAI3/B,KAAKy+B,QACzBmB,EAAM5/B,KAAK4+B,OAAOuB,GACxB,GAAKP,EAAL,CACA,IAAMQ,EAAK17B,KAAKsN,MAAMpW,EAAIoE,KAAKw+B,QAC/B,OAAOoB,EAAIlC,UAAU0C,M,8BAGfnpC,GACN,IAAM2D,EAAIoF,KAAK6+B,WAAW9nC,IAAIE,GAC9B,GAAI2D,EACF,OAAOA,EAAEiF,OAAQ,I,0EAQnB,OAAOG,KAAK++B,aAAe/+B,KAAKy+B,S,sCAGM,WACtC,OAAO,IAAIh2B,IACT1N,MAAMwC,KAAKyC,KAAK6+B,WAAW3hC,WAAWiE,KAAI,YAAgB,uBAAdlK,EAAc,KAAVgyB,EAAU,KAChDnuB,EAA8BmuB,EAA9BnuB,EAAGF,EAA2BquB,EAA3BruB,EAAG2kC,EAAwBtW,EAAxBsW,eACRc,GADgCpX,EAAR9C,KACZ,GAAK,EAAKsY,OACtBzlC,EAAIqnC,EAAId,EACd,MAAO,CAACtoC,EAAI,CAAC6D,EAAI,EAAK0jC,OAAQ6B,EAAGzlC,EAAI,EAAK4jC,OAAQxlC,U,sCAKxCoH,GACd,IADwE,EAClEkgC,EAAiD,GACnDxB,GAAmB,EAFiD,eAG/C9+B,KAAK6+B,WAAW3hC,WAH+B,IAGxE,2BAAoD,8BAAxCjG,EAAwC,KAApCgyB,EAAoC,KAC1CnuB,EAA8BmuB,EAA9BnuB,EAAGF,EAA2BquB,EAA3BruB,EAAG2kC,EAAwBtW,EAAxBsW,eAAgBpZ,EAAQ8C,EAAR9C,IAC9B,GAAiB,OAAb8C,EAAK9C,IACP2Y,GAAmB,MACd,CACL,IAAMuB,GAAKla,GAAO,GAAKnmB,KAAKy+B,OACtBzlC,EAAIqnC,EAAId,EACRrC,EAAKpiC,EAAIkF,KAAKw+B,OACdrB,EAAKviC,EAAIoF,KAAKw+B,OAIhBzB,GAHO38B,EAAO5J,MACP4J,EAAO1J,IAEYwmC,EAAKl9B,KAAKw+B,OAAQrB,EAAKn9B,KAAKw+B,UACxD8B,EAAiBrpC,GAAM,CAACimC,EAAImD,EAAGlD,EAAInkC,MAhB+B,8BAoBxE,MAAO,CACL6lC,WAAYyB,EACZC,YAAavgC,KAAKwgC,iBAClB1B,sB,+BAMF,MAAO,CACLD,WAFiB4B,6BAAkBzgC,KAAK0gC,iBAGxCH,YAAavgC,KAAKwgC,iBAClB1B,iBAAkB9+B,KAAK8+B,sB,KCzhBR6B,G,WAYnB,WACEC,GAEA,IADAC,EACA,uDADkC,GAClC,yBAdFC,WAA4C,IAAIr4B,IAc9C,KAZFm4B,oBAYE,OAVFG,yBAAgD,GAW9C/gC,KAAK8gC,WAAa,IAAIr4B,IACtBzI,KAAK4gC,eAAiBA,EACtB5gC,KAAK+gC,yBAA2BF,E,yDAGrBG,GACX,IAAIC,EAAYjhC,KAAK8gC,WAAW/pC,IAAIiqC,GACpC,YAAkBjnC,IAAdknC,GACFA,EAAY,IAAIjhC,KAAK4gC,eAAe5gC,KAAK+gC,0BACzC/gC,KAAK8gC,WAAWh4B,IAAIk4B,EAAYC,GACzBA,GAGFA,I,8BAIPD,EACA/pC,EACAuwB,EACAE,EACAzD,GAEA,IADApkB,EACA,uDAD0B,GAE1B,OAAOG,KAAKkhC,aAAaF,GAAYf,QAAQhpC,EAAIuwB,EAAME,EAAOzD,EAAQpkB,K,mCAG3DmhC,EAAoBxZ,EAAcE,GAC7C,IAAMyZ,EAASnhC,KAAK8gC,WAAW/pC,IAAIiqC,GACnC,OAAOG,GAAUA,EAAOjB,aAAa1Y,EAAME,K,+BAI3C,IADO,EACD7nB,EAAyC,GADxC,eAE+BG,KAAK8gC,WAAW5jC,WAF/C,IAEP,2BAAiE,8BAArD8jC,EAAqD,KAAzCI,EAAyC,KAC/DvhC,EAAKmhC,GAAcI,EAAU5iB,UAHxB,8BAKP,OAAO3e,M,KChDUwhC,G,WAOnB,cAA6E,IAA/DxC,EAA+D,EAA/DA,WAAY0B,EAAmD,EAAnDA,YAAazB,EAAsC,EAAtCA,iBAAsC,yBANrED,gBAMqE,OAJrE0B,iBAIqE,OAFtEzB,sBAEsE,EAC3E9+B,KAAK6+B,WAAa,IAAIp2B,IAAIxP,OAAOiE,QAAQ2hC,IAEzC7+B,KAAKugC,YAAcA,EACnBvgC,KAAK8+B,iBAAmBA,E,oDAGlB7nC,GACN,IAAMgyB,EAAOjpB,KAAK6+B,WAAW9nC,IAAIE,GACjC,IAAKgyB,EACH,MAAM,IAAIhsB,MAAJ,aAAgBhG,EAAhB,6CAGR,OAAOgyB,EAAK,K,sCAOZ,OAAOjpB,KAAK6+B,a,uCAIZ,OAAO7+B,KAAKugC,c,+BAGLe,EAAqBC,GAC5B,MAAM,IAAItkC,MAAM,6B,sCAGFqkC,EAAqBE,GACnC,MAAM,IAAIvkC,MAAM,6B,mCAGLwkC,EAAeC,GAC1B,MAAM,IAAIzkC,MAAM,6B,sCAGF0kC,GACd,MAAM,IAAI1kC,MAAM,6B,+BAIhB,MAAO,CACL4hC,WAAY4B,6BAAkBzgC,KAAK6+B,YACnC0B,YAAavgC,KAAKugC,YAClBzB,kBAAkB,O,KC9BX8C,GAAb,WAOE,WAAYjiC,GAEV,GAFoC,yBANtC0F,YAMsC,OAJtCU,aAIsC,OAFtC4Y,aAEsC,OAoCtCkjB,kBApCsC,EACpC7hC,KAAKqF,OAAS1F,EAAK0F,QACdy8B,+BAAqB9hC,KAAKqF,QAC7B,MAAM,IAAIpI,MAAM,0BAElB+C,KAAK+F,QAAUpG,EAAKoG,QACpB/F,KAAK2e,QAAUhf,EAAKgf,QACpB3e,KAAKq5B,OAAO15B,GAdhB,mDAiBSoH,GACL9N,OAAOyW,OAAO1P,KAAM+G,KAlBxB,mCAsBI,OAAO,IAAI45B,GAAYpC,GAAoB,CACzCjzB,UAAW9F,yBAAexF,KAAKqF,OAAQ,aACvCs5B,YAAan5B,yBAAexF,KAAKqF,OAAQ,eACzCm5B,OAAQx+B,KAAK+F,QACb04B,OAAQ,MA1Bd,0CAkCsBoD,GAClB,OACEA,GACAA,EAAaV,OAAOJ,yBAAyBvC,SAAWx+B,KAAK+F,SAC7Dg8B,KAAUv8B,yBAAexF,KAAKqF,QAASw8B,EAAax8B,SACpD08B,KAAU/hC,KAAK2e,QAASkjB,EAAaljB,WAvC3C,6BAqDI,OAPK3e,KAAK6hC,cAAiB7hC,KAAKgiC,oBAAoBhiC,KAAK6hC,gBACvD7hC,KAAK6hC,aAAe,CAClBV,OAAQnhC,KAAKiiC,aACb58B,OAAQG,yBAAexF,KAAKqF,QAC5BsZ,QAAS3e,KAAK2e,UAGX3e,KAAK6hC,aAAaV,WArD7B,KA0EqBe,G,4MACnB/J,SAAmD,G,+DAElCpxB,GAAmD,IAC1Dw0B,EAAcx0B,EAAdw0B,UACHv7B,KAAKm4B,SAASoD,KACjBv7B,KAAKm4B,SAASoD,GAAav7B,KAAKmiC,cAAcp7B,IAChD,IAAM0T,EAAUza,KAAKm4B,SAASoD,GAE9B,OADA9gB,EAAQ4e,OAAOtyB,GACR0T,I,wCAISra,EAAgBs7B,GAChC,IAAKt7B,EAAQ,OAAOA,EADgD,IAE5D2F,EAAoB21B,EAApB31B,QAASV,EAAWq2B,EAAXr2B,OACX+8B,OACOroC,IAAXsL,EACI,EACAG,yBAAeH,EAAQ,4BAC7B,IAAK+8B,EAA0B,OAAOhiC,EACtC,IAAMiiC,EAAc39B,KAAK2O,MAAM+uB,EAA2Br8B,GAC1D,kCACK3F,GADL,IAEE5J,MAAOkO,KAAKsN,MAAMtN,KAAKuM,IAAI7Q,EAAO5J,MAAQ6rC,EAAa,IACvD3rC,IAAKgO,KAAKkN,KAAKxR,EAAO1J,IAAM2rC,O,oCAIlBt7B,GACZ,OAAO,IAAI66B,GAAc76B,K,4CAGLpH,GAGnB,IACO47B,EAAuB57B,EAAvB47B,UAAWv6B,EAAYrB,EAAZqB,QACbyZ,EAAUza,KAAKm4B,SAASoD,GAC9B,OAAKv6B,GAAWyZ,UACPza,KAAKm4B,SAASoD,GACd,IAEL9gB,GAAWzZ,GACbyZ,EAAQ0mB,OAAOjB,aACbl/B,EAAQ,GAAG3K,QACX2K,EAAQ,GAAGxK,MACXwK,EAAQ,GAAGtK,KAGR,K,gDAGiB+nB,GACxB,OAAO,IAAI4iB,GAAkB5iB,K,iDAI7Bmc,EACAj7B,GAEA,IAAMk7B,EAAe,oFACnBD,EACAj7B,GAiBF,OAfAk7B,EAAasG,OAASnhC,KAAKsiC,0BAA0B1H,EAAOuG,QAerDtG,I,gDAGiBl7B,GAAmD,IACnEqB,EAAYrB,EAAZqB,QAGR,OAFgBhB,KAAKuiC,iBAAiB5iC,GACZwhC,OAAOD,aAAalgC,EAAQ,GAAG3K,W,8CAKzDsJ,GAEA,IAAMk7B,EAAe,iFACnBl7B,GAGF,OADAk7B,EAAasG,OAASnhC,KAAKwiC,0BAA0B3H,GAC9CA,I,+CAIP6B,EACApqB,EACA3S,GAEA,IAAMu7B,EAAa,kFACjBwB,EACApqB,EACA3S,GAGKS,EAPY,YAOFT,EAAKqB,QAPH,MAkBnB,OAVAk6B,EAAWiG,OAASxhC,EAAKwhC,OAAOsB,gBAC9BziC,KAAK+7B,kBAAkB37B,EAAQT,IAE7Bu7B,EAAWiG,OAAOtC,aACpB3D,EAAW5oB,SAAW4oB,EAAW5oB,SAASxE,QAAO,SAAAkR,GAC/C,OAAOoI,QAAQ8T,EAAWiG,OAAOtC,WAAW7f,EAAEf,eAIlDid,EAAW4D,iBAAmB5D,EAAWiG,OAAOrC,iBACzC5D,M,GA1HkCwH,ICrGfC,G,iDACnBpnC,U,sDAEDqnC,M,gCAEEA,Q,KCRNlf,GAAiC,CACrCmf,UAAW,UACXC,aAAc,UACdC,KAAM,UACNC,WAAY,UACZC,MAAO,UACPC,MAAO,UACPC,OAAQ,UACRC,MAAO,UACPC,eAAgB,UAChBrjB,KAAM,UACNsjB,WAAY,UACZC,MAAO,UACPC,UAAW,UACXC,UAAW,UACXC,WAAY,UACZC,UAAW,UACXC,MAAO,UACPC,eAAgB,UAChBC,SAAU,UACVC,QAAS,UACTC,KAAM,UACNC,SAAU,UACVC,SAAU,UACVC,cAAe,UACfC,SAAU,UACVC,UAAW,UACXC,SAAU,UACVC,UAAW,UACXC,YAAa,UACbC,eAAgB,UAChBC,WAAY,UACZC,WAAY,UACZC,QAAS,UACTC,WAAY,UACZC,aAAc,UACdC,cAAe,UACfC,cAAe,UACfC,cAAe,UACfC,cAAe,UACfC,WAAY,UACZC,SAAU,UACVC,YAAa,UACbC,QAAS,UACTC,QAAS,UACTC,WAAY,UACZC,UAAW,UACXC,YAAa,UACbC,YAAa,UACbC,QAAS,UACTC,UAAW,UACXC,WAAY,UACZC,KAAM,UACNC,UAAW,UACX3iB,KAAM,UACNvD,MAAO,UACPmmB,YAAa,UACbr7B,KAAM,UACNs7B,SAAU,UACVC,QAAS,UACTC,UAAW,UACXC,OAAQ,UACRC,MAAO,UACPC,MAAO,UACPC,SAAU,UACVC,cAAe,UACfC,UAAW,UACXC,aAAc,UACdC,UAAW,UACXC,WAAY,UACZC,UAAW,UACXC,qBAAsB,UACtBC,UAAW,UACXC,WAAY,UACZC,UAAW,UACXC,UAAW,UACXC,YAAa,UACbC,cAAe,UACfC,aAAc,UACdC,eAAgB,UAChBC,eAAgB,UAChBC,eAAgB,UAChBC,YAAa,UACbC,KAAM,UACNC,UAAW,UACXC,MAAO,UACPC,QAAS,UACTC,OAAQ,UACRC,iBAAkB,UAClBC,WAAY,UACZC,aAAc,UACdC,aAAc,UACdC,eAAgB,UAChBC,gBAAiB,UACjBC,kBAAmB,UACnBC,gBAAiB,UACjBC,gBAAiB,UACjBC,aAAc,UACdC,UAAW,UACXC,UAAW,UACXC,SAAU,UACVC,YAAa,UACbC,KAAM,UACNC,QAAS,UACTC,MAAO,UACPC,UAAW,UACXC,OAAQ,UACRC,UAAW,UACXC,OAAQ,UACRC,cAAe,UACfC,UAAW,UACXC,cAAe,UACfC,cAAe,UACfC,WAAY,UACZC,UAAW,UACXC,KAAM,UACNC,KAAM,UACNC,KAAM,UACNC,WAAY,UACZC,OAAQ,UACRC,cAAe,UACf5pB,IAAK,UACL6pB,UAAW,UACXC,UAAW,UACXC,YAAa,UACbC,OAAQ,UACRC,WAAY,UACZC,SAAU,UACVC,SAAU,UACVC,OAAQ,UACRC,OAAQ,UACRC,QAAS,UACTC,UAAW,UACXC,UAAW,UACXC,UAAW,UACXC,KAAM,UACNC,YAAa,UACbC,UAAW,UACXC,IAAK,UACLC,KAAM,UACNC,QAAS,UACTC,OAAQ,UACRC,UAAW,UACXC,OAAQ,UACRC,MAAO,UACPC,MAAO,UACPC,WAAY,UACZC,OAAQ,UACRC,YAAa,WAGR,SAASC,GAAgBrwC,GAC9B,OAAOmoB,GAAOnoB,GAGT,SAASswC,GAAatwC,GAC3B,QAASmoB,GAAOnoB,GC1IX,SAASuwC,GAAqBthC,GAEnC,OADkBuhC,GAAavhC,GACZ,GAAM,QAAU,QAcrC,SAASuhC,GAAavhC,GACpB,IAAMwhC,EAAiBJ,GAAgBphC,GACvC,OAAOyhC,wBAAgBD,GAAkBxhC,GAapC,SAAS0hC,GAAU1hC,GAA2C,IAA5B2hC,EAA4B,uDAAd,IAC/CH,EAAiBJ,GAAgBphC,GACvC,OAAO4hC,qBAAaJ,GAAkBxhC,EAAO2hC,GAGxC,SAASE,GACdC,GAUA,IAPA,IAFA5hC,EAEA,uDAFa,QACb6hC,EACA,uDADmB,EAEfC,EAAsBZ,GAAgBU,IAAeA,EACnDG,EAAsBb,GAAgBlhC,IAAeA,EACrDgiC,EAAsBX,GAAaU,GACrCE,EAAgBC,4BAAiBJ,EAAqBC,GACpDI,EAAgBL,EAClBL,EAAc,IACXQ,EAAgBJ,GACrBC,EACEE,EAAsB,GAClBI,kBAAOD,EAAeV,GACtBY,mBAAQF,EAAeV,GAC7BA,GAAe,IACfQ,EAAgBC,4BAAiBJ,EAAqBC,GAExD,OAAOD,E,6ZCCHQ,GAAO,CACXC,OACA,kBAAmBC,EACnBC,MAAOlmC,IACP,YAAammC,EACb,aAAcC,EACd,aAAcp3C,IAGd,oBAAqBq3C,EACrB,mBAAoBC,EAGpB,2BAA4BC,EAC5B,2BAA4BC,EAC5B,wBAAyBC,IACzB,2BAA4BC,IAC5B,gCAAiCC,IACjC,yBAA0BC,IAC1B,gCAAiCC,IACjC,8BAA+BC,IAC/B,6BAA8BC,IAC9B,2BAA4BC,KAC5B,8BAA+BC,KAC/B,8BAA+BC,KAC/B,gCAAiCC,KACjC,qCAAsCC,KACtC,yBAA0BC,KAC1B,yBAA0BC,KAC1B,+BAAgCC,KAChC,mCAAoCC,KACpC,mCAAoCC,KACpC,iCAAkCC,KAClC,iCAAkCC,KAClC,yBAA0BC,KAC1B,6BAA8BC,KAC9B,+BAAgCC,KAChC,0BAA2BC,KAC3B,2BAA4BC,KAC5B,6BAA8BC,KAC9B,oCAAqCC,KACrC,8BAA+BC,KAC/B,4BAA6BC,KAC7B,+BAAgCC,KAGhC,gCAAiC/d,KACjC,qCAAsCH,KAEtC,uBAAwBuR,GACxB,+CAAgD96B,EAChD,kDAAmDV,EACnD,kDAAmDO,EACnD,gDAAiDL,EACjD,iDAAkDS,EAElD,6CAA8CynC,EAC9C,uEAAwE7M,GACxE,0EAA2E5F,GAC3E,gEAAiEoF,GACjE,8BAA+BsN,EAC/B,+BAAgCC,GAChC,mBAAoBC,EACpB,qBAAsBC,GACtB,2BAA4BC,EAC5B,4BAA6BC,EAC7B,qCAAsC19B,GACtC,wBAAyB29B,GACzB,oCAAqCC,EACrC,oDAAqDC,EAErD,0CAA2CC,ICnJ9B,CACb,OACA,kBACA,QACA,YACA,aACA,aAEA,oBACA,mBAEA,uBACA,+CACA,kDACA,kDACA,gDACA,iDAEA,6CACA,uEACA,0EACA,gEACA,8BACA,+BACA,mBACA,qBACA,2BACA,4BACA,qCACA,wBACA,oCACA,oDAEA,2CDuHY7pC,SAAQ,SAAA7K,GACpB,KAAMA,KAAQyxC,IACZ,MAAM,IAAI/vC,MAAJ,uCAA0C1B,OAIrCyxC,IE5JAkD,GF4JAlD,G,qBG5If,IAAImD,GAAkD,GAW/C,SAASC,GACdpnC,EACAuyB,EACA8U,GAGA,IAAMC,EA5BR,SACE91B,GAEA,gBAAU+1B,KAAoB/1B,IAyBbg2B,CAAsBH,GACvC,IAAKF,GAAaG,GAAW,CAC3B,IAAMl4B,GAAei4B,GAAyB,IAAIvpC,KAClD,IAAKsR,EACH,MAAM,IAAInb,MACR,iEAEJ,IAAMwzC,EAAkBznC,EAAc0R,eAAetC,GACrD,IAAKq4B,EACH,MAAM,IAAIxzC,MAAJ,oCAAuCmb,IAK/C,IAAMoC,EAAgBi2B,EAAgB7pC,aAAajF,OACjD0uC,GAGIK,EAAmCN,GAAWjtC,KAClD,KACA6F,EACAuyB,GAKII,EAAc,IAAI8U,EAAgBrpC,aACtCoT,EACAk2B,GAIFP,GAAaG,GAAY,CACvB3U,cACAgV,WAAY,IAAInzB,IAAI,CAAC+d,KAIzB,IAAMqV,EAAaT,GAAaG,GAGhC,OAFAM,EAAWD,WAAWlzB,IAAI8d,GAEnBqV,EAaF,SAASC,GAAqBC,GACnC,IAAIC,EAAc,EAEZC,EAAW/3C,OAAOC,KAAK43C,GAI7B,GAAwB,IAApBE,EAAS/1C,QAAgC,cAAhB+1C,EAAS,GAAoB,KAChDzV,EAAcuV,EAAdvV,UACRtiC,OAAOiE,QAAQizC,IAAc/pC,SAAQ,YAA4B,uBAA1BkqC,EAA0B,KAAhBM,EAAgB,KAC/DA,EAAWD,WAAWM,OAAO1V,GACM,IAA/BqV,EAAWD,WAAWjzC,OACxBqzC,GAAe,SACRZ,GAAaG,YAKxBr3C,OAAOmiC,OAAO+U,IAAc/pC,SAAQ,SAAAwqC,GAC7BA,EAAWjV,YAAYuV,eAIxBJ,EAAc9vC,UACb8vC,EAAc1wC,OAAS,CAAC0wC,EAAc1wC,QAAU,KAC3CgG,SAAQ,SAAChG,QACQrG,IAAnBqG,EAAO/J,SACTu6C,EAAWjV,YAAYuV,cAAc9wC,MAPzClE,QAAQ4H,KAAK8sC,EAAWjV,YAAa,uCAa3C,OAAOoV,EC1GF,IAAMI,GAAb,4MACE51C,KAAO,kBADT,+FAGgBoE,GAHhB,+FAQmCK,KAAKoxC,qBAAqBzxC,GAR7D,UAQU48B,EARV,OASYhB,EAA6BgB,EAA7BhB,UAAW/gB,EAAkB+hB,EAAlB/hB,cATvB,EAU4B41B,GACtBpwC,KAAKgJ,cACLuyB,EACA/gB,MAHMmhB,EAVZ,EAUYA,uBAKmBj8B,2BAf/B,yCAgBai8B,EAAYv6B,YAAYm7B,IAhBrC,gCAkBW,IAlBX,4GAAqCxzB,GAsBxBsoC,GAAb,4MACE91C,KAAO,cADT,+FAGgBoE,GAHhB,+FAQmCK,KAAKoxC,qBAAqBzxC,GAR7D,cAQU48B,EARV,OASYhB,EAA6BgB,EAA7BhB,UAAW/gB,EAAkB+hB,EAAlB/hB,cATvB,EAU4B41B,GACtBpwC,KAAKgJ,cACLuyB,EACA/gB,GAHMmhB,EAVZ,EAUYA,YAVZ,kBAeYl6B,iCAAsBk6B,GAE1B,KADAA,EAAY2V,UAAU/U,IAhB9B,4GAAqCxzB,GA2BxBwoC,GAAb,4MACEh2C,KAAO,oBADT,+FAGgBu1C,GAHhB,8EAIQC,EAAc,EAElBA,GAAeF,GAAqBC,GAGpC9wC,KAAKgJ,cAAcwoC,mBAAmBprC,SAAQ,SAAAqrC,GAC5C,IAAMC,EAAQD,EAASP,gBACnBQ,IAAOX,GAAeW,MAXhC,kBAcWX,GAdX,4GAAuChoC,GA8B1B4oC,GAAb,4MACEp2C,KAAO,aADT,0GAIIoE,GAJJ,8EAMUiyC,EANV,UAM4B5xC,KAAKgJ,cAAc6oC,iBAN/C,iBAM4B,EAA8Bp3B,eAN1D,aAM4B,EACpBm3B,gBAPR,yCASajyC,GATb,gCAYWmyC,iCAAsBF,EAAiBjyC,IAZlD,8KAegBA,GAfhB,yGAgBmCK,KAAKoxC,qBAAqBzxC,GAhB7D,UAgBU48B,EAhBV,OAkBMhB,EAKEgB,EALFhB,UACA/gB,EAIE+hB,EAJF/hB,cACAu3B,EAGExV,EAHFwV,aACAr7B,EAEE6lB,EAFF7lB,YACArY,EACEk+B,EADFl+B,OAEGk9B,EAxBT,sBAyBY,IAAIt+B,MAAM,iCAzBtB,UA4BIwD,4BAAiBpC,GA5BrB,EA8B4B+xC,GACtBpwC,KAAKgJ,cACLuyB,EACA/gB,IAHMmhB,EA9BZ,EA8BYA,uBAKqBj8B,0BAnCjC,uBAoCY,IAAIzC,MAAJ,6DACkD0+B,IArC9D,eAwCUl1B,EAAeurC,GACnBD,EACA/xC,KAAKgJ,cAAc2Q,gBAAgBo4B,IA1CzC,UA6CyBtrC,EAAawrC,eAAb,uCAChB1V,GACA7lB,GAFgB,IAGnBilB,iBAhDN,eA6CUf,EA7CV,OAmDIn6B,4BAAiBpC,GAnDrB,kBAoDWu8B,GApDX,6GAAgC7xB,GAwDhC,SAASipC,GAAwBD,EAAsBtrC,GACrD,IAAKA,EACH,MAAM,IAAIxJ,MAAJ,oBAAuB80C,EAAvB,gBAGR,IAAKtrC,EAAaE,eAChB,MAAM,IAAI1J,MAAJ,mBACQ80C,EADR,qEAKR,KAAMtrC,aAAwBi8B,IAC5B,MAAM,IAAIzlC,MACR,+EAGJ,OAAOwJ,E,IClKYyrC,G,4MACnB32C,KAAO,a,sDAECyN,GAEN/P,OAAOmiC,OAAO+W,GAAgB/rC,SAAQ,SAAAgsC,GACpCppC,EAAcqpC,cAAa,kBAAM,IAAID,EAAUppC,a,GANb25B,IC+BlC2P,G,WAKJ,aAAwC,yBAJxCC,eAAiB,IAAI9pC,IAImB,KAFxC+pC,WAA0B,GAEc,2BAAzBA,EAAyB,yBAAzBA,EAAyB,gBACtCxyC,KAAKwyC,WAAaA,E,gDAGhBC,EAAkBz4C,GACpB,IAAKgG,KAAKwyC,WAAWlxC,SAASmxC,GAC5B,MAAM,IAAIx1C,MAAJ,wBAA2Bw1C,IAEnC,IAAIF,EAAiBvyC,KAAKuyC,eAAex7C,IAAI07C,GACxCF,IACHA,EAAiB,GACjBvyC,KAAKuyC,eAAezpC,IAAI2pC,EAAOF,IAEjCA,EAAe9qC,KAAKzN,K,4BAGhB,WACJgG,KAAKwyC,WAAWpsC,SAAQ,SAAAssC,GACtB,IAAMH,EAAiB,EAAKA,eAAex7C,IAAI27C,GAC3CH,GACFA,EAAensC,SAAQ,SAAApM,GAAQ,OAAIA,c,KAiBrC24C,G,WAQJ,WACEC,EAEAC,GACA,yBAXFC,gBAAoD,GAWlD,KARFC,eAQE,OANFH,cAME,EACA5yC,KAAK4yC,SAAWA,EAChB5yC,KAAK+yC,UAAYF,E,gDAGft3C,EAAc8kC,GAChBrgC,KAAK8yC,gBAAgBv3C,GAAQ8kC,I,0BAG3B9kC,GACF,OAAOA,KAAQyE,KAAK8yC,kB,0BAGlBv3C,GACF,IAAKyE,KAAK2d,IAAIpiB,GACZ,MAAM,IAAI0B,MAAJ,UACD+C,KAAK4yC,SADJ,aACiBr3C,EADjB,kFAGR,OAAOyE,KAAK8yC,gBAAgBv3C,K,4BAI5B,OAAOtC,OAAOmiC,OAAOp7B,KAAK8yC,qB,KAOTE,G,WAkCnB,aAA2C,WAA/BC,EAA+B,uDAAJ,GAAI,yBAjC3CC,QAAoB,GAiCuB,KA/B3CC,wBAA0B,IAAIb,GAC5B,WACA,UACA,UACA,QACA,aACA,OACA,SACA,cAuByC,KApB3Cc,cAAgB,IAAIT,GAAW,eAAgBlsC,GAoBJ,KAlB3C4sC,aAAe,IAAIV,GAAW,cAAexrC,GAkBF,KAhB3CmsC,WAAa,IAAIX,GAAW,YAAatrC,GAgBE,KAd3CE,aAAe,IAAIorC,GAAW,cAAejrC,GAcF,KAZ3C6rC,gBAAkB,IAAIZ,GAAW,iBAAkB1qC,GAYR,KAV3CurC,UAAY,IAAIb,GAAW,WAAY9qC,GAUI,KAR3C4rC,YAAc,IAAId,GAAW,aAAc7qC,GAQA,KAN3C4rC,WAAa,IAAIf,GAAW,gBAAiB5pC,GAMF,KAJ3C4qC,YAAa,EAI8B,KAF3C9B,eAE2C,OAiK3C+B,eAAiB,IAAInrC,IAjKsB,KAmK3CorC,IAAMC,GAnKqC,KAqK3C7a,KAAO,SAA4B4a,GAEjC,OADK,EAAKD,eAAej2B,IAAIk2B,IAAM,EAAKD,eAAe9qC,IAAI+qC,EAAKA,EAAI,IAC7D,EAAKD,eAAe78C,IAAI88C,IAvKU,KAgL3CE,UAAY,SACVF,GAGA,GAAmB,kBAARA,EAAkB,CAC3B,IAAMG,EAAO,EAAKH,IAAIA,GACtB,IAAKG,EACH,MAAM,IAAIhxC,UAAJ,sDAC2C6wC,EAD3C,0IAIR,OAAOG,EAGT,GAAmB,oBAARH,EACT,OAAO,EAAK5a,KAAK4a,GAGnB,GAAIA,EAAI5tB,QAAS,OAAO,EAAK8tB,UAAUF,EAAI5tB,SAE3C,MAAM,IAAIjjB,UACR,kEAnMFhD,KAAKi0C,UAAU,IAAI/B,IAGnBe,EAAe7sC,SAAQ,SAAA8tC,GACrB,EAAKD,UAAUC,M,sDAITA,GACR,GAAIl0C,KAAK2zC,WACP,MAAM,IAAI12C,MAAM,kDAElB,GAAI+C,KAAKkzC,QAAQ5xC,SAAS4yC,GACxB,MAAM,IAAIj3C,MAAM,4BAIlB,OAFAi3C,EAAOC,QAAQn0C,MACfA,KAAKkzC,QAAQzrC,KAAKysC,GACXl0C,O,gCAGCzE,GACR,OAAOyE,KAAKkzC,QAAQl1C,MAAK,SAAAogB,GAAC,OAAIA,EAAE7iB,OAASA,O,gCAGjCA,GACR,YAAgCxB,IAAzBiG,KAAKo0C,UAAU74C,K,gDAQtB,OAFAyE,KAAKmzC,wBAAwBkB,aACtBr0C,KAAKmzC,wBACLnzC,O,mCAGI6xC,GACX7xC,KAAK6xC,UAAYA,I,kCAGP,WACV,GAAI7xC,KAAK2zC,WAAY,MAAM,IAAI12C,MAAM,sBAQrC,OANA+C,KAAKkzC,QAAQ9sC,SAAQ,SAAA8tC,GAAM,OAAIA,EAAOI,UAAU,MAEhDt0C,KAAK2zC,YAAa,EAIX3zC,O,2CAIPu0C,GAEA,OAAQA,GACN,IAAK,UACH,OAAOv0C,KAAKqzC,aACd,IAAK,aACH,OAAOrzC,KAAKuzC,gBACd,IAAK,SACH,OAAOvzC,KAAKyzC,YACd,IAAK,WACH,OAAOzzC,KAAKozC,cACd,IAAK,UACH,OAAOpzC,KAAKuH,aACd,IAAK,QACH,OAAOvH,KAAKszC,WACd,IAAK,OACH,OAAOtzC,KAAKwzC,UACd,IAAK,aACH,OAAOxzC,KAAK0zC,WACd,QACE,MAAM,IAAIz2C,MAAJ,gCAAmCs3C,EAAnC,S,qCAKVA,EACAC,GACA,WACA,GAAgC,oBAArBA,EACT,MAAM,IAAIv3C,MACR,qEAGJ,IAAMw3C,EAAaz0C,KAAK00C,qBAAqBH,GAgB7C,OAdAv0C,KAAKmzC,wBAAwB11B,IAAI82B,GAAW,WAC1C,IAAMI,EAAaH,EAAiB,GACpC,IAAKG,EAAWp5C,KACd,MAAM,IAAI0B,MAAJ,uBAA0Bs3C,EAA1B,kBAER,GAAIE,EAAW92B,IAAIg3B,EAAWp5C,MAC5B,MAAM,IAAI0B,MAAJ,UACDs3C,EADC,YACYI,EAAWp5C,KADvB,kDAKRk5C,EAAWh3B,IAAIk3B,EAAWp5C,KAAMo5C,MAG3B30C,O,qCAGMu0C,EAAsC3B,GAEnD,OADmB5yC,KAAK00C,qBAAqBH,GAC3Bx9C,IAAI67C,K,6CAGD2B,GAErB,OADmBv0C,KAAK00C,qBAAqBH,GAC3BK,Q,uCAKlBC,EACA/pC,GAEA,IADAgqC,EACA,uDADqBl/C,QAAMqC,MAAMrC,QAAMm/C,MAEjCC,EAAkC,GAUxC,OATAh1C,KAAK00C,qBAAqBG,GACvBD,MACAxuC,SAAQ,SAAAi6B,GACP,IAAM7+B,EAAQ6+B,EAAEv1B,GACZmqC,iBAAOzzC,IAAU0zC,sBAAY1zC,IAC/BwzC,EAAevtC,KAAKjG,MAII,IAA1BwzC,EAAe/5C,QACjBiB,QAAQ4H,KAAR,sDACiD+wC,EADjD,cACgE/pC,EADhE,OAGOgqC,GAEFl/C,QAAM4C,MAAN,MAAA5C,QAAeo/C,K,gDAKtBH,GAEA,IADA/pC,EACA,uDADoC,eAE9BkqC,EAA+C,GAWrD,OAVAh1C,KAAK00C,qBAAqBG,GACvBD,MACAxuC,SAAQ,SAAAi6B,GACP,IAAM7+B,EAAQ6+B,EAAEv1B,GACZqqC,wCAA8B3zC,IAChCwzC,EAAevtC,KAAKjG,MAGI,IAA1BwzC,EAAe/5C,QACjB+5C,EAAevtC,KAAKqN,8BAAoB,OAAQ,KAC3Clf,QAAM4C,MAAN,MAAA5C,QAAeo/C,K,sCA2CRpC,GACd,OAAO5yC,KAAKozC,cAAcr8C,IAAI67C,K,yCAI9B,OAAO5yC,KAAKozC,cAAcwB,Q,qCAGbhC,GACb,OAAO5yC,KAAKqzC,aAAat8C,IAAI67C,K,mCAGlBA,GACX,OAAO5yC,KAAKszC,WAAWv8C,IAAI67C,K,qCAGdA,GACb,OAAO5yC,KAAKuH,aAAaxQ,IAAI67C,K,kCAGnBA,GACV,OAAO5yC,KAAKwzC,UAAUz8C,IAAI67C,K,oCAGdA,GACZ,OAAO5yC,KAAKyzC,YAAY18C,IAAI67C,K,wCAGZA,GAChB,OAAO5yC,KAAKuzC,gBAAgBx8C,IAAI67C,K,uCAGjBwC,GACf,OAAOp1C,KAAK0zC,WAAW38C,IAAIq+C,K,sCAI3BZ,GAEA,OAAOx0C,KAAKq1C,eAAe,WAAYb,K,qCAIvCA,GAEA,OAAOx0C,KAAKq1C,eAAe,UAAWb,K,mCAItCA,GACM,WAkBN,OAAOx0C,KAAKq1C,eAAe,SAfV,WACf,IAAMz/B,EAAQ4+B,EAAiB,GAY/B,OAXE,EAAKc,uBAAuB,WAA6BlvC,SACzD,SAAAoB,GAEIA,EAAQG,YAAciO,EAAMra,MAE3Bqa,EAAMrO,aAAajG,SAASkG,IAE7BoO,EAAM2/B,eAAe/tC,MAIpBoO,O,qCAMT4+B,GAEA,OAAOx0C,KAAKq1C,eAAe,UAAWb,K,kCAItCA,GACM,WAgBN,OAAOx0C,KAAKq1C,eAAe,QAfV,WACf,IAAMG,EAAUhB,EAAiB,GAYjC,OAXE,EAAKc,uBAAuB,WAA6BlvC,SACzD,SAAAoB,GAEIA,EAAQI,WAAa4tC,EAAQj6C,MAE5Bi6C,EAAQjuC,aAAajG,SAASkG,IAE/BguC,EAAQD,eAAe/tC,MAItBguC,O,oCAMThB,GAEA,OAAOx0C,KAAKq1C,eAAe,SAAUb,K,wCAIrCA,GAEA,OAAOx0C,KAAKq1C,eAAe,aAAcb,K,mCAIzCA,GAEA,OAAOx0C,KAAKq1C,eAAe,aAAcb,O,gDCvbxBiB,IAnB0B3gC,8BAC7C,eACA,CACEvZ,KAAM,CACJuL,KAAM,SACNiO,aAAc,IAEhBlc,IAAK,CACHiO,KAAM,SACNiO,aAAc,M,WAalB,aAAwD,IAA5C2gC,EAA4C,uDAAJ,GAAI,yBAFxDC,YAAkC,GAGhC31C,KAAK21C,YAAcpoC,KAAKW,MAAMX,KAAKC,UAAUkoC,I,uDAGpCE,GACT,GAAIxrB,UAAYA,SAASyrB,qBACvB,OAAOC,KAAcF,GAGvB,GAAIr+C,MAAQA,KAAKw+C,cACf,OAAO,IAAI/iB,SAAQ,SAACC,EAAS+iB,GAC3B,IAEEz+C,KAAKw+C,cAAcH,GACnB,MAAOz5C,GAEP,YADA65C,EAAO75C,GAAS,IAAIc,MAAJ,yBAA4B24C,KAG9C3iB,OAGJ,MAAM,IAAIh2B,MACR,2E,0EAIag5C,G,iFACTC,EAAYr9C,KAAIqV,MAAM+nC,EAAWp9C,MAE1Bke,UACY,UAAvBm/B,EAAUn/B,UACa,WAAvBm/B,EAAUn/B,S,iCAEJ/W,KAAKm2C,WAAWF,EAAWp9C,K,UAC3Bu9C,EAAaH,EAAW16C,KACxB86C,E,uBAA0BD,GAE1BlC,EAAUjyC,OAAeo0C,G,sBAEvB,IAAIp5C,MAAJ,iBACMm5C,EADN,mCAC2CC,EAD3C,kB,gCAIDnC,EAAOjuB,S,cAEV,IAAIhpB,MAAJ,8CACmCi5C,EAAUn/B,SAD7C,M,qJAKeyW,GAErBA,EAAO8oB,eAAiB,GACxBr9C,OAAOiE,QAAQ42C,IAAW1tC,SAAQ,YAA0B,uBAAxBgwC,EAAwB,KAAZt0C,EAAY,KAE1D0rB,EAAO8oB,eAAeF,GAAct0C,O,2KAK/BkxB,QAAQ4hB,IACb50C,KAAK21C,YAAYx0C,KAAI,SAAA80C,GAAU,OAAI,EAAKM,WAAWN,Q,+OChFlD,WACLpE,EACA2E,EACAC,GAHK,yBAAA19C,EAAA,4DAMH,mFAEI29C,EAAsB7E,EAAU8E,QAAQzhC,OAAOpH,QACnD,SAAC8H,GAAD,OAAiBpQ,yBAAeoQ,EAAO,kBAAoB,IAAI3a,OAAS,KACxEA,OAGI89B,EAAsB,CAC1B6d,IAAK/E,EAAUgF,QACf,mBAAoBhF,EAAU8E,QAAQG,WAAW77C,OACjD,eAAgB42C,EAAU8E,QAAQzhC,OAAOja,OACzC,8BAAwB42C,QAAxB,IAAwBA,GAAxB,UAAwBA,EAAWp3B,eAAnC,aAAwB,EAAoBM,cAAc9f,OAC1Di4C,QAASrB,EAAU8E,QAAQzD,QACvBnzC,sBAAY8xC,EAAU8E,QAAQzD,SAC9B,GACJ,cAAuB,OAATrB,QAAS,IAATA,GAAA,UAAAA,EAAWp3B,eAAX,eAAoB7H,MAAM3X,cAAUlB,EAClD,uBAAwB28C,EACxB,uBAAwBz9C,OAAOC,KAAK69C,cAAcjpC,QAAO,SAAAvS,GAAI,OAC3DA,EAAK+F,SAAS,kBACdrG,OAGF,qCAA+Bw7C,QAA/B,IAA+BA,OAA/B,EAA+BA,EAAcO,MAAM,KAAK,GAGxD,QAAS/0C,OAAOg1C,OAAOhzB,OACvB,QAAShiB,OAAOg1C,OAAOhnC,MAGvB,QAAShO,OAAOi1C,YAChB,QAASj1C,OAAOsP,WAEhBvP,SAA4B,qBAAXC,QAA0BmlB,QAAQnlB,OAAOD,UAC1Dm1C,UAAW18C,KAAK28C,MAAQZ,GAAoB,IAC5Ca,KAAK,GAIPxF,EAAU8E,QAAQzhC,OAAO9O,SAAQ,SAACwP,GAChCmjB,EAAM,eAAD,OAAgBnjB,EAAM9O,OACzBiyB,EAAM,eAAD,OAAgBnjB,EAAM9O,OAAU,GAAK,KAIrC,OAAT+qC,QAAS,IAATA,GAAA,UAAAA,EAAWp3B,eAAX,SAAoBM,cAAc3U,SAAQ,SAACwP,GACzCmjB,EAAM,sBAAD,OAAuBnjB,EAAM9O,OAChCiyB,EAAM,sBAAD,OAAuBnjB,EAAM9O,OAAU,GAAK,KAI/CwwC,EAAKr+C,OAAOC,KAAK6/B,GACpB53B,KAAI,SAAA2L,GAAG,gBAAOA,EAAP,YAAcisB,EAAMjsB,OAC3BvD,KAAK,KA1DH,SA4DCjN,MAAM,GAAD,OAtDT,mFAsDS,YAAWg7C,GAAM,CAC1B/6C,OAAQ,MACRqH,KAAM,SA9DH,4C,oEAkEA,WACLiuC,EACA2E,GAFK,qBAAAz9C,EAAA,sDAIe,eACdggC,EAAsB,CAC1B,eAAgB8Y,EAAU8E,QAAQzhC,OAAOja,OACzC27C,IAAK/E,EAAUgF,QACf70C,SAA4B,qBAAXC,QAA0BmlB,QAAQnlB,OAAOD,UAC1Dm1C,SAAU18C,KAAK28C,MAAQZ,EACvBtD,QAASrB,EAAU8E,QAAQzD,QACvBnzC,sBAAY8xC,EAAU8E,QAAQzD,cAC9Bn5C,GAIFw9C,EACF,+EACFA,GACE,iFACFA,GACE,kFACFA,GACE,qFACFA,GAAmB,iBAAJ,OApBK,eAoBL,iCAETC,EAAuB,GACJ,0FAERR,MAAM,OAAO5wC,SAAQ,SAAC0G,EAAKoG,GAC1CskC,EAAO,YAAD,OAAatkC,EAAQ,IAAO6lB,EAAMjsB,MAG1C0qC,EAAOC,QAAU/yC,KAAK2O,MAAM0lB,EAAMoe,UAElCI,GAAmB,wCAAJ,OAA4ChqC,KAAKC,UAC9DgqC,GADa,OAITE,EAAsBttB,SAASljB,cAAc,WAC/BywC,UAAYJ,EAEhCntB,SAASyrB,qBAAqB,QAAQ,GAAG+B,YAAYF,GA1ChD,6C,sECxEP,SAASG,GAAY58C,GACnB,OAAOgH,YAEHlH,MAAA,KAAWkH,8BAA8B,IAAI61C,WAA7C,EAAwD78C,KAAxD,KACO,SAAAjC,GAAC,OAAI8F,oBAAJ,MADR,KAFGmD,qCAAP,GAUF,IAAM81C,GAAU,SAAChzC,EAAD,GACd,OAAOizC,kBAAP,YAGIC,GAAU,SAAClzC,EAAD,GAEd,OADcizC,eAAd,GACOE,SAAP,OAGF,mD,8CAAO,2CAAAn/C,EAAA,6DAKCo/C,EALD,UAKWC,wBAAa7qC,eALxB,KAMC8qC,EAAWR,GANZ,GAOCS,EAAmBP,GAAQI,EAP5B,IASCt4C,EAAO,IATR,UAULA,oBACAA,gCAA6BpF,KAA7BoF,QACAA,sBAZK,SAckBvD,MAAM,GAAD,kBAAgB,CAC1CC,OAD0C,OAE1CqH,KAF0C,OAG1C20C,KAAM14C,IAjBH,WAcCvB,EAdD,kCAqBG,0CAAmCA,EArBtC,sCAuBcA,EAvBd,sBAuBCmgB,EAvBD,yBAwBE,CACLA,KADK,EAEL65B,iBAFK,EAGLD,aA3BG,6C,sBA+BP,qD,8CAAO,2CAAAt/C,EAAA,6DAMCwiC,EAAYid,kBANb,GAOC3/C,EAPD,8CASkByD,MAAMzD,EAAK,CAChCwF,WAVG,WASCC,EATD,iCAcHpC,cAAc,CAAEoC,SAAF,EAAYzF,QACpB,2DACqCyF,EAhBxC,qCAqBcA,EArBd,kBAqBCyG,EArBD,8BAuBG,4CAvBH,mBAyBC0Z,EAAOlR,WAzBR,qBA0BE0qC,GAAQx5B,EAAD,QA1BT,iD,sCCrDD7X,GAAekO,8BAAoB,oBAAqB,IAExDxN,GAAa1R,QAChBuB,MAAM,oBAAqB,CAC1BF,GAAItB,aACJmR,KAAMlR,QAAMqkB,QAAQ,qBACpB9L,YAAavY,QAAM6iD,OAAO,MAE3BnhD,SAAQ,SAAAC,GAAI,MAAK,CAChBmhD,eADgB,SACD74C,GACbtI,EAAK4W,YAActO,GAErB84C,iBAJgB,WAKdphD,EAAK4W,YAAc,Q,sBCfZyqC,GAAgC9jC,8BAC3C,oBACA,CACE+jC,UAAW,CACT/xC,KAAM,SACNqB,YAAa,uCACb4M,aAAc,uDAGd+jC,kBAAmB,CAAC,YAEtBC,oBAAqB,CACnBjyC,KAAM,SACNqB,YAAa,gDACb4M,aAAcikC,OAAOC,YAGzB,CAAEhkC,mBAAoB,c,GCkCpBikC,OAAOC,S,IAnDUC,G,WAGnB,WAAYC,GAAsB,yBAF1BA,aAE0B,EAChCr5C,KAAKq5C,QAAUA,E,gDAGbpiD,GAAO,qBACY+I,KAAKq5C,QAAQje,UADzB,IACT,2BAA4C,CAC1C,GAD0C,QAC/Bzd,IAAI1mB,GAAK,OAAO,GAFpB,8BAIT,OAAO,I,0BAGLA,GAAO,qBACY+I,KAAKq5C,QAAQje,UADzB,IACT,2BAA4C,KAAjCke,EAAiC,QAC1C,GAAIA,EAAO37B,IAAI1mB,GAAK,OAAOqiD,EAAOviD,IAAIE,IAF/B,iC,qIAQS+I,KAAK9G,Q,wDACrB,OADS4T,E,iBACH9M,KAAKjJ,IAAI+V,G,qUAKX5T,EAAO,IAAIskB,I,eACIxd,KAAKq5C,QAAQje,U,IAAlC,2BAA4C,CAAjCke,EAAiC,uBACxBA,EAAOpgD,QADiB,IAC1C,2BAAW4T,EAAsB,QAC/B5T,EAAKukB,IAAI3Q,GAF+B,gC,6CAK1B5T,G,yDAChB,OADS4T,E,kBACHA,E,kOAIFkS,GAAmB,qBACJhf,KAAKq5C,QAAQje,UADT,IACzB,2BAA4C,OAAjCke,EAAiC,uBACtBA,EAAOle,UADe,IAC1C,2BAAqC,KAA1BzxB,EAA0B,QAEnC,GADcqV,EAAErV,GAEd,OAAOA,GAJ+B,gCADnB,iC,+HAaP3J,KAAK9G,Q,wDACrB,OADS4T,E,iBACH,CAACA,EAAK9M,KAAKjJ,IAAI+V,I,2UAKP9M,KAAK9G,Q,wDACnB,OADSiE,E,iBACH,CAACA,EAAG6C,KAAKjJ,IAAIoG,I,uPCxDnB8M,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCovC,aAAc,CACZn1C,SAAU,WACV8d,UAAW,OACXxW,UAAW,aACXsgB,WAAY,SACZzgB,SAAU,UAEZiuC,YAAa,CACXt3B,UAAW,OACXxW,UAAW,aACXP,gBAAiB,OACjBsuC,gBACE,sHAEJC,wBAAyB,CACvBx3B,UAAW,OACX/W,gBAAiBhB,EAAMQ,QAAQ5F,KAAKqa,SAEtCu6B,qBAAsB,CACpBz3B,UAAW,OACX/W,gBAAiBhB,EAAMQ,QAAQ4gB,OAAOquB,wBAmBpCrqC,GAAejP,oBAAS,YAA4C,IAAzCyO,EAAyC,EAAzCA,MAAOjD,EAAkC,EAAlCA,SAChCD,EAAU5B,KAChB,OACE,yBACEgC,MAAO,CACLgE,MAAO,GAAF,OAAKlB,EAAMK,QAAX,OAEP/C,UAAWR,EAAQ0tC,cAElBztC,MAKP,SAASkD,GAAT,GAAkD,IAA3BiB,EAA2B,EAA3BA,MACfpE,EAAU5B,KAChB,OAAO,yBAAKoC,UAAWR,EAAQ2tC,YAAavtC,MAAO,CAAEgE,MAAO,GAAF,OAAKA,EAAL,SAG5D,SAASJ,GAAT,GAIiC,IAH/BgqC,EAG+B,EAH/BA,SACA5pC,EAE+B,EAF/BA,MAE+B,IAD/BhE,aAC+B,MADvB,GACuB,EACzBJ,EAAU5B,KAChB,OACE,yBACEgC,MAAK,2BACAA,GADA,IAEHgE,MAAO,GAAF,OAAKA,EAAL,QAEP5D,UACEwtC,EACIhuC,EAAQ8tC,qBACR9tC,EAAQ6tC,0BC9DpB,IAAMzvC,GAAYC,aAAW,CAC3B4vC,aAAc,CACZ9tB,WAAY,SACZmI,UAAW,OACX/vB,SAAU,WACVoD,QAAS,OACT0a,UAAW,QAEb63B,iBAAkB,CAChB31C,SAAU,WACVoG,MAAO,gBACPU,aAAc,0BACd8uC,WAAY,oBACZhuB,WAAY,SACZ/b,MAAO,OACPgqC,WAAY,OACZ9lB,UAAW,SACXpO,OAAQ,IACRra,UAAW,gBAGTwuC,GAAiB55C,oBAAS,SAACyG,GAA6C,IACpE5P,EAAU4P,EAAV5P,MACF0U,EAAU5B,KACRkwC,EAAiChjD,EAAjCgjD,iBAAkBC,EAAejjD,EAAfijD,WAC1B,OACE,oCACGD,EAAiBh5C,KAAI,SAAA4N,GACpB,GAAIA,aAAiBQ,GAAc,CACjC,IAAM8qC,EAAQD,EAAWrjD,IAAIgY,EAAMjC,KACnC,OACE,kBAAC,GAAD,CACEiC,MAAOA,EACPjC,IAAG,UAAK3V,EAAMF,GAAX,YAAiB8X,EAAMjC,MAEzButC,GAASA,EAAM1zC,eACd,kBAAC0zC,EAAM1zC,eAAP,CAAsBxP,MAAOkjD,IAC3B,KACHA,GAASA,EAAMvb,iBACd,yBACEzyB,UAAWR,EAAQkuC,iBACnB9tC,MAAO,CACLka,IAAKk0B,EAAMx6C,KAAKshC,OAAOZ,YAAc,GACrC5G,cAAe,OACf1V,OAAQ,KALZ,sBAUE,MAIV,GAAIlV,aAAiBC,GACnB,OACE,kBAAC,GAAD,CACElC,IAAG,UAAK3V,EAAMF,GAAX,YAAiB8X,EAAMjC,KAC1BmD,MAAOlB,EAAMK,UAInB,GAAIL,aAAiBc,GACnB,OACE,kBAAC,GAAD,CACE/C,IAAKiC,EAAMjC,IACXmD,MAAOlB,EAAMK,QACbnD,MAAO,CAAEvB,WAAY,QACrBmvC,SAA4B,aAAlB9qC,EAAMzC,UAItB,MAAM,IAAIrP,MAAJ,oCAAuC8R,WA4BtCzO,2BAvBf,YAAoE,IAA5CnJ,EAA4C,EAA5CA,MAChB0U,EAAU5B,KACRkwC,EAAqBhjD,EAArBgjD,iBAEFG,EAAYp/B,6BAAkB/jB,GACpC,OACE,yBACEmwB,cAAY,WACZjb,UAAWR,EAAQiuC,aACnB7tC,MAAO,CACLub,KAAM2yB,EAAiB7qC,SAAWgrC,EAAUhrC,WAG9C,kBAAC4qC,GAAD,CAAgB/iD,MAAOA,QCjGvB8S,GAAYC,aAAW,CAC3B1C,QAAS,CACPpD,SAAU,WACV4nB,WAAY,SACZmI,UAAW,OACXlkB,MAAO,OACPiS,UAAW,UAGT0X,GAAUt5B,oBACd,SAACyG,GAA2E,IAClE5P,EAAsB4P,EAAtB5P,MAAOojD,EAAexzC,EAAfwzC,WACPC,EAAsBrjD,EAAtBqjD,kBACF3B,EAAY2B,EACdhhC,kBAAQriB,EAAO,YAAa,CAACqjD,SAC7BzgD,EACJ,OAAO8+C,EACL,kBAAC,KAAD,CAAY9sC,MAAO8sC,EAAWxyB,MAAI,EAAC1Y,UAAU,SAC3C,yBACE1B,MAAO,CACL7H,SAAU,WACVojB,KAAM+yB,EAAW,GACjBp0B,IAAKo0B,EAAW,KAGjB,MAGH,QAwFOE,GAhFWn6C,oBACxB,SAACyG,GACC,IAAM8E,EAAU5B,KACVE,EAAQ8iB,eAFyD,EAInCvI,mBAAgB,CAAC,EAAG,IAJe,mBAIhE61B,EAJgE,KAIpDG,EAJoD,OAK/Bh2B,qBAL+B,mBAKhEi2B,EALgE,KAKlDC,EALkD,KAMjE7yB,EAAMjD,iBAAuB,MAC3B3tB,EAAoB4P,EAApB5P,MAAO2U,EAAa/E,EAAb+E,SAEb+uC,EAKE1jD,EALF0jD,iBACAC,EAIE3jD,EAJF2jD,wBACAC,EAGE5jD,EAHF4jD,iBACA92B,EAEE9sB,EAFF8sB,OACA+2B,EACE7jD,EADF6jD,sBAGF,OACE,yBACEjzB,IAAKA,EACLT,cAAA,kBAAwB9N,kBAAQriB,EAAO,cACvCkV,UAAWR,EAAQrE,QACnByzC,cAAe,SAAAh2B,GACbA,EAAMC,iBACFy1B,EAEFC,OAAgB7gD,GACPguB,EAAI5C,SACby1B,EAAgB,CAAC31B,EAAMi2B,QAASj2B,EAAMk2B,WAG1CjxB,YAAa,SAAAjF,GACX,GAAI8C,EAAI5C,QAAS,CACf,IAAM8D,EAAOlB,EAAI5C,QAAQ+D,wBACzBwxB,EAAc,CAACz1B,EAAMi2B,QAAUjyB,EAAKzB,KAAMvC,EAAMk2B,QAAUlyB,EAAK9C,QAGnER,KAAK,gBAEJm1B,EACC,kBAACA,EAAD,CAAyB3jD,MAAOA,IAEhC,kBAAC,GAAiB4P,GAEnB+E,EACD,kBAAC+uC,EAAD,CACE1jD,MAAOA,EACP8sB,OAAQA,EACRs2B,WAAYA,IAGd,kBAAC,GAAD,CACEl0B,KAAMe,QAAQuzB,IAAiBvzB,QAAQ2zB,EAAiB9/C,QACxDytB,gBAAiB,SAACvoB,EAAGnG,GACnBA,IACA4gD,OAAgB7gD,IAElB4uB,QAAS,WACPiyB,OAAgB7gD,GAChBihD,OAAsBjhD,IAExBqhD,OAAQ,WACNR,OAAgB7gD,GAChBihD,OAAsBjhD,IAExBshD,gBAAgB,iBAChBC,eACEX,EACI,CAAEx0B,IAAKw0B,EAAa,GAAInzB,KAAMmzB,EAAa,SAC3C5gD,EAENkS,MAAO,CAAE8Z,OAAQ5b,EAAM4b,OAAOw1B,SAC9B5gC,UAAWogC,EACXzzB,cAAY,yC,sBCvBPhnB,2BArFf,SAAmCyG,GACjC,IAAMy0C,EAAmB12B,iBAAuB,MAC1C22B,EAAW32B,kBAAO,GAEhB3tB,EAAU4P,EAAV5P,MACFsjB,EAAUnB,sBAAWniB,GACrBgT,EAAQ4Y,GAAmBvJ,kBAAQiB,EAAS,UAkElD,OAhEAsK,qBAAU,WACR,IAAM22B,EAAUF,EAAiBr2B,QAC3Bw2B,EAAaF,EAASt2B,QAuD5B,OAtDA,WAAqB,IAEjBtlB,EAKE1I,EALF0I,KACA6J,EAIEvS,EAJFuS,KACAkyC,EAGEzkD,EAHFykD,OACAllC,EAEEvf,EAFFuf,YACoBmlC,EAClB1kD,EADF2kD,mBAEEJ,GAAWE,IACTD,GAAcD,GAChBK,iCAAuBL,GAEzBA,EAAQ/D,UAAYjuC,EASpBsyC,qBACE,WACE,GAAKtsB,kBAAQv4B,GAAb,CADI,IAKIiJ,EAAWjJ,EAAXiJ,OACR,GAAKsvB,kBAAQtvB,GAAb,CAIA,IAAM67C,EAAmBn8C,0BAAgBM,GACrCL,sBAAYK,GACZA,EACJ87C,kBACE,kBAACtf,GAAA,EAAD,CAAezyB,MAAOA,GACpB,kBAAC0xC,EAAD,iBACMh8C,EADN,CAEEmB,QAAS,CAACi7C,IACNvlC,KAGRglC,GAEFD,EAASt2B,SAAU,MAErB,CAAE4U,QAAS,OAKjBoiB,GAEO,WACDT,GAAWC,GACbI,iCAAuBL,MAG1B,CAACvkD,EAAOgT,IAGT,yBACE4d,IAAKyzB,EACLY,iBAAgBjlD,EAAMuS,KAAKzO,OAC3BoR,UAAU,qBC3EVpC,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCkyC,QAAS,CACPz5B,YAAa,QACbzX,gBAAiBhB,EAAMQ,QAAQ4gB,OAAOquB,mBACtCH,gBACE,sHACFx1B,OAAQ,OACRhU,MAAO,OACP0pB,cAAe,QAEjB2iB,aAAc,CACZrsC,MAAO,OACPvF,WAAYP,EAAMQ,QAAQ4gB,OAAOquB,mBACjCvvC,QAASF,EAAMG,QAAQ,GACvBqvB,cAAe,OACfxF,UAAW,UAEbooB,WAAY,CACVlyC,QAASF,EAAMG,QAAQ,GACvB2F,MAAO,OACP+b,WAAY,SACZxhB,MAAOL,EAAMQ,QAAQxO,MAAMkjB,KAC3ByG,UAAW,QAEb02B,sBAAuB,CACrBvsC,MAAO,OACPvF,WAAYP,EAAMQ,QAAQ4gB,OAAOquB,mBACjCvvC,QAASF,EAAMG,QAAQ,GACvB6pB,UAAW,UAEbsoB,KAAM,CACJ,WAAY,CACVj1C,QAAS,eACTk1C,UAAW,0BACXt6B,QAAS,MACTnS,MAAO,MACPkkB,UAAW,SAGf,sBAAuB,CACrB,KAAM,CACJ/R,QAAS,OAEX,MAAO,CACLA,QAAS,QAEX,MAAO,CACLA,QAAS,cAKf,SAASu6B,GAAT,GAA+D,IAA3C7wC,EAA2C,EAA3CA,SAClB,OACE,yBAAKG,MAAO,CAAEzE,QAAS,SACpBsE,EACAA,GAMP,IAAM8wC,GAAiBt8C,oBAAS,YAA+B,IAA5BnJ,EAA4B,EAA5BA,MAA4B,EAEnCutB,oBAAS,GAF0B,mBAEtDsV,EAFsD,KAE/CC,EAF+C,KAGvDpuB,EAAU5B,KAChB8a,qBAAU,WACR,IAAMgV,EAAUhR,YAAW,kBAAMkR,GAAS,KAAO,KACjD,OAAO,kBAAMjR,aAAa+Q,MACzB,IAP0D,IAS7C8iB,EAAgB1lD,EAAxB6F,OAEFA,EAD6BiZ,oBAAU9e,EAAO,GAA5C82B,SACwB4uB,EAChC,OAAO7iB,EACL,yBAAK3tB,UAAWR,EAAQwwC,SACtB,yBAAKhwC,UAAWR,EAAQ4wC,MAAOz/C,EAAS,GAAH,OAAMA,GAAW,YAEtD,QAGN,SAAS8/C,GAAT,GAIG,IAHDC,EAGC,EAHDA,eAIMlxC,EAAU5B,KAEhB,MAAiC,kBAAnB8yC,EACZ,kBAAC,KAAD,CAAYzwC,QAAQ,QAAQD,UAAWR,EAAQywC,cAC5CS,GAGH,yBAAK1wC,UAAWR,EAAQ2wC,uBAAwBO,GAQpD,SAASC,GAAT,GAQG,IAPD7gD,EAOC,EAPDA,MACA2d,EAMC,EANDA,OACAmjC,EAKC,EALDA,cAMMpxC,EAAU5B,KACVizC,EAAgC,kBAAV/gD,EAAqBA,EAAQA,EAAM8xB,QAC/D,OACE,yBAAK5hB,UAAWR,EAAQ0wC,WAAYtwC,MAAO,CAAEgY,OAAQg5B,IAClDnjC,EACC,oCACE,kBAAC,IAAD,CACEwN,cAAY,gBACZvK,QAASjD,EACTqjC,UAAW,kBAAC,KAAD,OAHb,UAOCD,GAGH,kBAAC,KAAD,CAAY1yC,MAAM,QAAQ8B,QAAQ,SAC/B4wC,IAUXF,GAAW/oB,aAAe,CACxBna,YAAQ/f,GAGV,IAqCeqjD,GArCwB98C,oBACrC,YAKM,IAJJnJ,EAII,EAJJA,MAKA,OAAIA,EAAMgF,MAEN,kBAACwgD,GAAD,KACE,kBAACK,GAAD,CACE7gD,MAAOhF,EAAMgF,MACb2d,OAAQ3iB,EAAM2iB,OACdmjC,cAAezmC,GAAqBrf,GAAOuiB,aAAauK,UAK5D9sB,EAAM82B,QAEN,kBAAC0uB,GAAD,KACE,kBAACG,GAAD,CAAcC,eAAgB5lD,EAAM82B,WAIrC92B,EAAMykD,OAQJ,kBAAC,GAAD,CAA2BzkD,MAAOA,IANrC,kBAACwlD,GAAD,KACE,kBAACC,GAAD,CAAgBzlD,MAAOA,QCPlBijD,GA1JIxkD,QAChBuB,MAAM,aAAc,CACnB2V,IAAKlX,QAAMU,OACX8J,OAAQlK,UACR0a,4BAA4B,EAC5BC,6BAA6B,IAG9BwB,UAAS,iBAAO,CACfgrC,sBAAkBtjD,EAClB6hD,QAAQ,EACR/7C,UAAM9F,EACN2P,KAAM,GACN1M,OAAQ,GACRb,WAAOpC,EACPk0B,aAASl0B,EACT+kC,kBAAkB,EAClBn4B,eAAgBy2C,GAChBtB,wBAAoB/hD,EACpB2c,iBAAa3c,MAEdzC,SAAQ,SAAAC,GACP,IAAI8lD,EACJ,MAAO,CACLloC,YADK,WAEH,IAAM3N,EAAUyO,oBAAe1e,EAAM,GACrC+lD,iCACE/lD,EACAgmD,GACAC,GACA,CACEjiD,KAAM,GAAF,OAAKiM,EAAQvQ,GAAb,YAAmBma,6BAAkB7Z,EAAK6I,QAA1C,cACJq9C,MAAOj2C,EAAQk2C,YACfC,iBAAiB,GAEnB39C,KAAK49C,WACL59C,KAAK69C,YACL79C,KAAK6Z,WAGTikC,UAjBK,SAiBK7vB,GACR12B,EAAKyF,OAASixB,GAEhB2vB,WApBK,SAoBMG,QACgBhkD,IAArBsjD,IACGA,EAAiBh/C,OAAO2/C,SAC3BX,EAAiBY,SAGrB1mD,EAAKqkD,QAAS,EACdrkD,EAAK02B,aAAUl0B,EACfxC,EAAKmS,KAAO,GACZnS,EAAKsI,UAAO9F,EACZxC,EAAK4E,WAAQpC,EACbxC,EAAKunC,kBAAmB,EACxBvnC,EAAKukD,wBAAqB/hD,EAC1BxC,EAAKmf,iBAAc3c,EACnBsjD,EAAmBU,GAErBG,WApCK,SAoCMC,GACLd,IAAqBA,EAAiBh/C,OAAO2/C,SAC/CX,EAAiBY,QAEnB1mD,EAAKqkD,QAAS,EACdrkD,EAAK02B,QAAUkwB,EACf5mD,EAAKmS,KAAO,GACZnS,EAAKsI,UAAO9F,EACZxC,EAAK4E,WAAQpC,EACbxC,EAAKunC,kBAAmB,EACxBvnC,EAAKukD,wBAAqB/hD,EAC1BxC,EAAKmf,iBAAc3c,EACnBsjD,OAAmBtjD,GAErB8jD,YAlDK,SAmDH92C,GAUA,GAAKA,EAAL,CADA,IAKElH,EAKEkH,EALFlH,KACA6J,EAIE3C,EAJF2C,KACAo1B,EAGE/3B,EAHF+3B,iBACAgd,EAEE/0C,EAFF+0C,mBACAplC,EACE3P,EADF2P,YAEFnf,EAAKqkD,QAAS,EACdrkD,EAAK02B,aAAUl0B,EACfxC,EAAKmS,KAAOA,EACZnS,EAAKsI,KAAOA,EACZtI,EAAK4E,WAAQpC,EACbxC,EAAKunC,iBAAmBA,EACxBvnC,EAAKukD,mBAAqBA,EAC1BvkD,EAAKmf,YAAcA,EACnB2mC,OAAmBtjD,IAErB8f,SAjFK,SAiFI1d,GACPD,QAAQC,MAAMA,GACVkhD,IAAqBA,EAAiBh/C,OAAO2/C,SAC/CX,EAAiBY,QAGnB1mD,EAAKqkD,QAAS,EACdrkD,EAAK02B,aAAUl0B,EACfxC,EAAKmS,KAAO,GACZnS,EAAKsI,UAAO9F,EACZxC,EAAKunC,kBAAmB,EACxBvnC,EAAK4E,MAAQA,EACb5E,EAAKukD,wBAAqB/hD,EAC1BxC,EAAKmf,iBAAc3c,EACnBsjD,OAAmBtjD,GAErB+f,OAjGK,WAkGHviB,EAAK8lD,sBAAmBtjD,EACxBxC,EAAKqkD,QAAS,EACdrkD,EAAKsI,UAAO9F,EACZxC,EAAKmS,KAAO,GACZnS,EAAK4E,WAAQpC,EACbxC,EAAK02B,aAAUl0B,EACfxC,EAAKunC,kBAAmB,EACxBvnC,EAAKoP,eAAiBy2C,GACtB7lD,EAAKukD,wBAAqB/hD,EAC1BxC,EAAKmf,iBAAc3c,EACnBkc,oBAAU1e,EAAM,GAAGuiB,UAErBskC,cA9GK,WA+GCf,IAAqBA,EAAiBh/C,OAAO2/C,SAC/CX,EAAiBY,QAEnB,IAAMz2C,EAAUyO,oBAAU1e,EAAM,GACxB8jC,EAAe/hB,sBAAW/hB,GAA1B8jC,WACA0W,EAAiBvqC,EAAjBuqC,aACArW,EAAe6hB,GAAgB9qC,eAAKlb,IAApCmkC,WACRqW,EACGsM,sBACChjB,EACA9tB,KAAKW,MAAMX,KAAKC,UAAUkuB,KAE3B75B,OAAM,SAAC5F,GAENC,QAAQ4H,KAAK,+BAAgC7H,WAYzD,SAASshD,GAAgBhmD,GACvB,IAGE,IAHE,MACsC+hB,sBAAW/hB,GAA3Cq6C,EADN,EACMA,gBAAiBvW,EADvB,EACuBA,WACrB7zB,EAAUyO,oBAAU1e,IACfiQ,EAAQsO,gBAAiB0D,kBAAQhS,EAAS,cACjDA,EAAUyO,oBAAUzO,GAEtB,IACI82C,EADEjhC,EAAgB1H,GAAsBnO,EAAQiS,aAEpD,IAAK4D,EAAc/b,SAAS/J,EAAK6I,OAAOzI,cAAe,CACrD,IAAI4mD,GAAa,EACjBlhC,EAAcjX,SAAQ,SAACzO,GACrB,IAAM6mD,EAAW5M,EAAgB76C,IAAIY,GACjC6mD,GAAYA,EAAStgC,QAAQ5c,SAAS/J,EAAK6I,OAAOzI,gBACpD4mD,GAAa,MAEZA,IACHD,EAAyB,oBAAH,OAAuB/mD,EAAK6I,OAAOzI,aAAnC,8CAAqF0lB,EAArF,MAGrBihC,IACHA,EAAyB92C,EAAQoS,uBAAuBriB,EAAK6I,SApB7D,IAsBMsW,EAAgBlP,EAAhBkP,YACAq7B,EAAiBvqC,EAAjBuqC,aACA1sC,EAAWqR,EAAXrR,OAGRG,yBAAeH,GA3Bb,IA6BMmV,EAAkBhT,EAAlBgT,cAEF+gB,EAAYrlB,GAAgB1O,GAElC,MAAO,CACLuqC,eACA1W,aACA3kB,cACA4nC,yBACAG,aAAcj3C,EAAQrL,MACtBu/B,WAAY,CACVY,eAAgB,SAACrO,GACXyB,kBAAQn4B,IACVA,EAAKumD,UAAU7vB,IAGnBt2B,aAAcJ,EAAK6I,OAAOzI,aAC1BqJ,QAAS,CAACzJ,EAAK6I,QACfoa,gBACAu3B,aAAcA,EAAax2C,KAC3Bmb,cACA6kB,YACAb,SAAUnjC,EAAKuV,IACfitB,QAAS,MAGb,MAAO59B,GACP,MAAO,CACLsiD,aAActiD,I,SAkBLqhD,G,qFAAf,WACEz2C,EACA5G,EACA5I,GAHF,mCAAAwB,EAAA,yDAMIg5C,GANJ,EAYMhrC,GANFgrC,aACAr7B,EAPJ,EAOIA,YACA2kB,EARJ,EAQIA,WACAK,EATJ,EASIA,WACA4iB,EAVJ,EAUIA,uBACAG,EAXJ,EAWIA,aAEG/uB,kBAAQn4B,GAbf,8CAcWwC,GAdX,WAiBM0kD,EAjBN,uBAkBIlnD,EAAKsiB,SAAS4kC,GAlBlB,uBAmBW1kD,GAnBX,WAqBMukD,EArBN,uBAsBI/mD,EAAK2mD,WAAWI,GAtBpB,uBAuBWvkD,GAvBX,WA0BM2c,EAAYgoC,SA1BlB,+CA2BW3kD,GA3BX,yBA8BoDg4C,EAAa4M,eAC7DtjB,EACAK,GAhCJ,wBA8BUhyB,EA9BV,EA8BUA,KAAMo1B,EA9BhB,EA8BgBA,iBAAqBj/B,EA9BrC,8DAkCS,CACLA,OACA6J,OACAo1B,mBACAgd,mBAAoB/J,EAAaprC,eACjC+P,gBAvCJ,6C,sBC7NA,IAEa+jC,GAAoB7kD,QAC9B8B,QACC,oBACA0hB,GACAxjB,QAAMuB,MAAM,CACV8sB,OAAQruB,QAAMC,SACZD,QAAMgpD,WACJ,gBACAhpD,QAAMa,QACN,SAAAid,GAAC,OAAIA,GAXU,MACI,KAcvB0mC,WAAYxkD,QAAMuL,IAAI09C,OAGzBxsC,UAAS,iBAAO,CACf4b,QAAS,GACT6wB,yBAAqB/kD,EACrBglD,wBAAoBhlD,EACpBilD,mCAAoC,GAEpCC,UAAW,EACXC,sBAAkBnlD,MAEnB6Y,OAAM,SAAArb,GAAI,MAAK,CAId,qBACE,OAAOA,EAAK2nD,kBAAoB1lC,kBAAQjiB,EAAM,wBAEhD,gBACE,MAAO,gBAOT,kBACE,OAAO,IAGT,uBACE,OAAQqiC,IAGV,uBAAuB,IACbulB,EAAcn/C,KAAdm/C,UACFlkC,EAAOC,6BAAkB3jB,GAC/B,IAAK0jB,EAAKmkC,YACR,MAAM,IAAIniD,MAAM,4BAElB,OAAOge,EAAKkkC,IAOd,wBACE,GAAIzvB,kBAAQn4B,GAAO,CACjB,IACQ8nD,EADQ/lC,sBAAW/hB,GACnB8nD,UAER,GAAIxhC,GAAUwhC,GACZ,OAAOA,EAAUpoD,OASvB,oCAID2b,OAAM,SAAArb,GACL,IAAI+nD,GAAQ,EACRC,EAAuC,GAC3C,MAAO,CAKL,eACE,IADa,EACPC,EAAc,GADP,eAEOjoD,EAAK6iD,WAAWhf,UAFvB,IAEb,2BAA8C,KAAnCrsB,EAAmC,QACxCA,EAAMlP,MAAQkP,EAAMlP,KAAKyS,UAC3BktC,EAAY/3C,KAAKsH,EAAMlP,KAAKyS,WAJnB,8BAOb,OADAgtC,GAAQ,EACD,IAAIlG,GAA8BoG,IAG3C,wBACE,OAAOjoD,EAAKunD,oBACR9+C,KAAKsS,SAASvb,IAAIQ,EAAKunD,0BACvB/kD,GAUN,0BACE,IADwB,EAClB0lD,EAAa,IAAIh3C,IADC,eAEJlR,EAAK6iD,WAAWhf,UAFZ,IAExB,2BAA8C,KAAnCrsB,EAAmC,QACxCA,EAAMlP,MAAQkP,EAAMlP,KAAKshC,QAAUpyB,EAAMlP,KAAKshC,OAAOtC,YACvD4gB,EAAW32C,IAAIiG,EAAMjC,IAAKiC,EAAMlP,KAAKshC,OAAOtC,aAJxB,8BAQxB,OADAygB,GAAQ,EACDG,GAWT,qBACE,IADmB,EACbA,EAAa,GADA,eAECloD,EAAK6iD,WAAWhf,UAFjB,IAEnB,2BAA8C,KAAnCrsB,EAAmC,QACxCA,EAAMlP,MAAQkP,EAAMlP,KAAKshC,QAAUpyB,EAAMlP,KAAKshC,OAAOtC,YACvD4gB,EAAWh4C,KAAKsH,EAAMlP,KAAKshC,OAAOtC,aAJnB,8BAQnB,OADAygB,GAAQ,EACD,IAAIlG,GAAmCqG,IAGhD,YACE,GAAIH,EAAO,CACTC,EAAQ,GADC,qBAEgCv/C,KAAK0/C,qBAFrC,IAET,2BAAmE,8BAAvDhlB,EAAuD,KAA7CilB,EAA6C,KACjEJ,EAAM7kB,GAAY,IAAIklB,KACtB,IAFiE,EAE3DhlD,EAAI2kD,EAAM7kB,GAFiD,eAGrCilB,GAHqC,IAGjE,2BAA4C,8BAAhC7yC,EAAgC,KAA3Bq0B,EAA2B,KAC1CvmC,EAAEilD,OAAO,CACPC,KAAM3e,EAAO,GACb4e,KAAM5e,EAAO,GACb1D,KAAM0D,EAAO,GACbzB,KAAMyB,EAAO,GACb5lC,KAAMuR,KATuD,gCAF1D,8BAeTwyC,GAAQ,EAEV,OAAOC,GAETS,sBA9EK,SA8EiBtlB,EAAkB9+B,EAAW+jC,GACjD,IAAM1W,EAAO,CAAE62B,KAAMlkD,EAAGmkD,KAAMpgB,EAAGlC,KAAM7hC,EAAI,EAAG8jC,KAAMC,EAAI,GAClDsgB,EAAQjgD,KAAKigD,MAAMvlB,GACzB,OAAOulB,GAASA,EAAMxgB,SAASxW,GAAQg3B,EAAMC,OAAOj3B,GAAQ,QAIjE3xB,SAAQ,SAAAC,GAAI,MAAK,CAChB4d,YADgB,WACF,WAENgrC,EAAqBC,mBAAQ,WAEjC,IAAMC,EAA4C,GACrCnlC,6BAAkB3jB,GACtB6nD,cACP7nD,EAAK4iD,iBAAiB3qC,cAAcpJ,SAAQ,SAAA2I,GAC1CsxC,EAActxC,EAAMjC,MAAO,EACtBvV,EAAK6iD,WAAWz8B,IAAI5O,EAAMjC,MAC7B,EAAKwzC,SAASvxC,EAAMjC,IAAKiC,MAI7BxX,EAAK6iD,WAAWh0C,SAAQ,SAACjG,EAAG2M,GACrBuzC,EAAcvzC,IAAM,EAAKyzC,YAAYzzC,UAKhD0zC,sBAAYjpD,EAAM4oD,IAEpBM,UAvBgB,SAuBNxD,GAGR,OAFsC1lD,EAAK0sB,OAAvCg5B,EAlMe,GAkMiCA,EAlMjC,GAoMZ1lD,EAAK0sB,QAEdy8B,aA5BgB,SA4BH/rC,GACX,IAAMgsC,EAAYppD,EAAK0sB,OAEvB,OADkBjkB,KAAKygD,UAAUlpD,EAAK0sB,OAAStP,GAC5BgsC,GAErBC,aAjCgB,SAiCH3B,GACX1nD,EAAK0nD,UAAYA,GAGnB4B,oBArCgB,SAqCIC,GAClBvpD,EAAK2nD,iBAAmB4B,GAG1B5C,WAzCgB,SAyCLjwB,GACT12B,EAAK02B,QAAUA,GAEjBqyB,SA5CgB,SA4CPxzC,EAAaiC,GACpBxX,EAAK6iD,WAAWtxC,IACdgE,EACA+xC,GAAWl9C,OAAO,CAChBmL,MACA1M,OAAQ2O,EAAMG,eAIpBqxC,YArDgB,SAqDJzzC,GACVvV,EAAK6iD,WAAWnJ,OAAOnkC,IAEzBi0C,cAxDgB,SAwDFt0C,GACZ,IAAMgO,EAAUnB,sBAAW/hB,GAC3B,GAAIypD,qCAA0BvmC,GAAU,CACtC,IAAMwmC,EAAgBxmC,EAAQymC,UAC5B,oBACA,cACA,CAAE/yC,YAAa1B,EAAQ+R,WAEzB/D,EAAQ0mC,WAAWF,GAEjBG,gCAAqB3mC,IACvBA,EAAQ4mC,aAAa50C,IAGzB60C,sBAtEgB,WAuEEhoC,sBAAW/hB,GACnBgqD,kBAEVC,uBA1EgB,SA0EO/0C,GACrBlV,EAAKunD,oBAAsBryC,GAE7BqN,OA7EgB,WA8Ed,IAAM2nC,EAAOl0C,KAAKW,MAAMX,KAAKC,UAAUjW,EAAK6iD,aAC5CnhD,OAAOC,KAAKuoD,GAAMr7C,SAAQ,SAAAg0C,GACxBqH,EAAKrH,GAAYttC,KAAO,aAE1BvV,EAAK6iD,WAAaqH,GAEpBC,qCApFgB,SAoFqB1nD,GACnCzC,EAAKynD,mCAAmCv3C,KAAKzN,IAE/CghD,sBAvFgB,SAuFMvuC,GACpBlV,EAAKwnD,mBAAqBtyC,OAG7BmG,OAAM,SAAArb,GAAI,MAAK,CAQdqiB,uBARc,WASZ,IAAMqB,EAAOC,6BAAkB3jB,GAC/B,GAAI0jB,GAAQA,EAAKlV,QAAUxO,EAAKoqD,eAC9B,OACE,oCACE,kBAAC,KAAD,CAAY93B,UAAU,OAAOvd,QAAQ,SAArC,6BAC6B,KAE7B,kBAAC,IAAD,CACEgb,cAAY,gBACZvK,QAAS,WACPxlB,EAAKspD,oBAAoB5lC,EAAKlV,SAC9BxO,EAAKuiB,UAEPxN,QAAQ,YANV,cAUA,kBAAC,KAAD,CAAYud,UAAU,OAAOvd,QAAQ,SAArC,8BASR,qBACE,MAAO,IAQT,6BACE,MAAO,IAET,uBAAuB,IACbtD,EAAkBsQ,sBAAW/hB,GAA7ByR,cACF+xC,EAAmBxjD,EAAKwnD,mBAC1B,CACE,CACEpmD,MAAO,uBACPskB,KAAM2kC,KACN7kC,QAAS,WACHxlB,EAAKwnD,oBACPxnD,EAAKwpD,cAAcxpD,EAAKwnD,uBAKhC,GAMJ,OAJAxnD,EAAKynD,mCAAmC54C,SAAQ,SAAApM,GAC9C,IAAM2gB,EAAY3gB,EAASzC,EAAKwnD,mBAAoBxnD,EAAMyR,GAC1D+xC,EAAiBtzC,KAAjB,MAAAszC,EAAgB,YAASpgC,OAEpBogC,GAET,0BACE,kCACKvkC,GAAqBjf,IAD1B,IAEEmiB,aAAcniB,EACdsqD,eAHF,SAGiB1hD,EAAY2hD,GACzB,IAAM9iC,EAAI8iC,GAAavqD,EAAKunD,oBAC5B,GAAK9/B,EAEE,CACL,IAAMvS,EAAUlV,EAAK+a,SAASvb,IAAIioB,GAClCznB,EAAKwpD,cAAct0C,QAHnBlV,EAAK+pD,yBAMTvkC,QAZF,WAaIxlB,EAAK+pD,yBAGPS,qBAhBF,SAgBuB5hD,EAAY2hD,GAC/B,IAAM9iC,EAAI8iC,GAAavqD,EAAKunD,oBACvB9/B,EAIHznB,EAAKyjD,sBAAsBzjD,EAAK+a,SAASvb,IAAIioB,IAH7CznB,EAAK+pD,yBAOTp3B,YA1BF,SA0Bc/pB,EAAY2hD,GACtBvqD,EAAKiqD,uBAAuBM,IAG9BE,aA9BF,SA8Be7hD,GACX5I,EAAKiqD,4BAAuBznD,IAG9BkhD,cAlCF,WAmCI1jD,EAAKyjD,2BAAsBjhD,GAC3BxC,EAAK+pD,4BAIX,kBACE,OAAOthD,KAAKiiD,yBAGfC,qBAAoB,SAAA3qD,GACaA,EAAxB6iD,WACR,OAF2B,aACK7iD,EADL,mBCrZxB,SAAS4qD,GAAoBn5C,GAClC,OAAO8L,8BACL,qBACA,CAAE28B,SAAUzoC,EAAc0S,0BAA0B,aACpD,CACE0mC,kBAAmBxJ,GACnB5jC,iBAAiB,ICFhB,SAASqtC,GAAkBz7C,GAChC,OAAOhR,QACJ8B,QACC,qBACA+iD,GACA7kD,QAAMuB,MAAM,CACV2P,KAAMlR,QAAMqkB,QAAQ,sBACpBnE,cAAeoE,aAAuBtT,MAIzCgM,OAAM,SAAArb,GAAI,MAAK,CACd,kBACE,8CACKA,EAAK0qD,qBACLzrC,GAAqBjf,IAF1B,IAGE8N,OAAQ9N,EAAKue,cAAc27B,YAI/B,uBACE,OAAOl6C,EAAKue,cAAc27B,SAAS3qC,U,cCzBpC,SAASw7C,GAAYv7C,GAC1B,OACE,kBAACw7C,GAAA,EAAYx7C,EACX,0BAAMiV,EAAE,gIAsBP,SAASwmC,GAAcz7C,GAC5B,OACE,kBAACw7C,GAAA,EAAYx7C,EACX,0BAAMiV,EAAE,sR,mLChBd,SAASymC,GAAU17C,GAAgC,IACzClH,EAAuBkH,EAAvBlH,KAAMqT,EAAiBnM,EAAjBmM,MAAOjH,EAAUlF,EAAVkF,MACrB,OAAOhF,IAAMy7C,aAAa7iD,EAAKqT,GAAQ,CACrCjH,MAAO,eACFA,KAKT,IAAM02C,GAAsB17C,IAAM27C,cAAc,IAE1CC,GAAmB57C,IAAM6gB,YAA2B,SAAC/gB,EAAOghB,GAChE,IAAM+6B,EAAa77C,IAAM87C,WAAWJ,IACpC,OAAO,uCAAK56B,IAAKA,GAAShhB,EAAW+7C,OAIjCE,GAAmB/7C,IAAM6gB,YAC7B,SAA0B/gB,EAAOghB,GAAK,IAE5Bjc,EAAuB/E,EAAvB+E,SAAaof,EAFe,aAELnkB,EAFK,cAG9Bk8C,EAAWh8C,IAAMi8C,SAASC,QAAQr3C,GAClCs3C,EAAYH,EAAShoD,OAGrBooD,EAAe,SAAC9kC,GACpB,OAAItX,IAAMq8C,eAAe/kC,IAAUA,EAAMzX,OAASgjB,KACzC,GAJM,IAiBjB,OACE,yBAAK/B,IAAKA,GACR,kBAAC46B,GAAoBY,SAArB,CAA8B55C,MAAOuhB,GACnC,kBAAC,KAAD,CACE+3B,SAAUA,EACVh/B,OAXFm/B,EAAY,EACP,IAEFH,EAAS9hD,IAAIkiD,GAAch0C,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,GASpDiX,MAAM,OACNnD,IAAKs2C,EACLI,iBAAkBX,GAClBY,iBAAiB,KACjBC,SAAU,SAACxwC,GAAD,OAAmBmwC,EAAaJ,EAAS/vC,KACnDywC,cAAe,EACfP,UAAWA,GAEVX,SAiFEniD,2BAzEf,YAcG,IAbDnJ,EAaC,EAbDA,MACAysD,EAYC,EAZDA,SACAjsD,EAWC,EAXDA,aACAgS,EAUC,EAVDA,MACAsC,EASC,EATDA,MASC,IARD43C,sBAQC,MARgB,GAQhB,EACOjS,EAAoBt4B,sBAAWniB,GAA/By6C,gBACF4M,EAAW7mD,GAAgBi6C,EAAgB76C,IAAIY,GAC/CqJ,EAAqBw9C,GAAYA,EAASx9C,SAAY,GACtDq7C,GAAWr7C,EAAQ/F,OACnBkqB,EAAUxb,IAAU3I,EAAQ/F,OAAS+F,EAAQ,GAAG3K,aAAU0D,GAYhE,OACE,kBAAC+pD,GAAA,EAAD,CACE7sD,GAAE,8BAAyBE,EAAMF,IACjC8sD,iBAAe,EACfC,kBAAgB,EAChBhB,iBACEA,GAIFvmD,QAASuE,EAAQG,KAAI,SAAAf,GAAM,OAAIA,EAAO/J,WACtCgmD,QAASA,EACT1yC,MAAOwb,GAAW,GAClByC,UAAWjwB,GAAgB0kD,EAC3BpwC,MAAOA,EACPshB,SAzBJ,SAAkBptB,EAAY8jD,GAC5B,GAAIA,EAAe,CACjB,IAAMC,EAAYljD,EAAQhD,MAAK,SAAAoC,GAAM,OAAIA,EAAO/J,UAAY4tD,KACxDC,GAEFN,EAAS7jD,sBAAYmkD,MAqBvBC,YAAa,SAAAC,GAAU,IACbC,EAAgCR,EAAhCQ,WADa,EACmBR,EAApBS,kBADC,MACY,GADZ,EAEfC,EAAsB,uCACvBH,EAAOE,YACPA,GAFoB,IAGvBE,aACE,oCACGnI,EAAU,kBAAC5iB,GAAA,EAAD,CAAkBjvB,MAAM,UAAU9M,KAAM,KAAS,KAC3D0mD,EAAOE,WAAWE,gBAIzB,OACE,kBAAC,KAAD,iBACMJ,EACAP,EAFN,CAGEQ,WAAYA,EACZC,WAAYC,MAIlBE,aAAc,SAAAC,GAAU,OAAI,kBAAC,KAAD,CAAYtuB,QAAM,GAAEsuB,SC7I/C,SAASC,GACdC,EACAC,EACAC,GAUA,IAPA,IAAMC,EAAkBF,GADxBD,EAAQlgD,KAAKsgD,IAAIJ,IAEXK,EAAiB9mD,SACrB66C,OAAO+L,GAAiBG,gBAAgBlO,MAAM,MAAM,GACpD,IAGEmO,EAAa,KAAH,IAAG,GAAMF,GAChBE,EAAaJ,MAClBI,GAAc,IACIJ,IAClBI,GAAc,IAKhB,IAAMC,GAFND,EAAazgD,KAAKuM,IAAIk0C,EAAY,IAEAP,EAE9BS,EAAa,EASjB,QARMF,EAAa,KAAOC,EAAe,IAAMN,EAC7CO,EAAaF,EAAa,KACfA,EAAa,IAAMC,EAAe,GAAKN,EAClDO,EAAaF,EAAa,IACfA,EAAa,IAAMC,EAAe,GAAKN,IAClDO,EAAaF,EAAa,GAGrB,CAAEA,aAAYE,cAGhB,SAASC,GACd9uD,EACAE,EACAqP,GAGA,IAFAw/C,IAEA,yDADAC,IACA,yDACMC,EAAYd,GAAgB5+C,EAAS,GAAI,IAE3C2/C,EAAUlvD,EACVmvD,EAAUjvD,EACd,GAAgB,OAAZgvD,GAAgC,OAAZC,EAAkB,MAAO,GAEjD,GAAI5/C,EAAU,EAAG,OACO,CAAC4/C,EAASD,GAA9BA,EADa,KACJC,EADI,KAMjBD,GAAWhhD,KAAKsgD,IAAI,GAAKj/C,GAAW,EACpC4/C,GAAWjhD,KAAKsgD,IAAI,GAAKj/C,GAAW,EAKpC,IAHA,IAAM6/C,EAAYH,EAAUJ,YAAcI,EAAUN,WAChDjyC,EAAQ,EACN2yC,EAAQ,GAERC,EAAOphD,KAAKkN,KAAK8zC,EAAUE,GAAaA,EAC5CE,EAAOH,EACPG,GAAQF,EAEJJ,GAAaM,EAAOL,EAAUN,YAChCU,EAAMp+C,KAAK,CAAEX,KAAM,QAASg/C,KAAMA,EAAO,EAAG5yC,UAC5CA,GAAS,IACAqyC,GAAeO,GAA+B,EAAvBL,EAAUN,YAGjCI,IACTM,EAAMp+C,KAAK,CAAEX,KAAM,QAASg/C,KAAMA,EAAO,EAAG5yC,UAC5CA,GAAS,IAJT2yC,EAAMp+C,KAAK,CAAEX,KAAM,eAAgBg/C,KAAMA,EAAO,EAAG5yC,UACnDA,GAAS,GAMb,OAAO2yC,EClET,IAAM57C,GAAYC,cAAW,SAAAC,GAI3B,MAAO,CACL47C,WAAY,CACV9hC,OAAQ,OACRvZ,WANeP,EAAMQ,QAAQ4U,SAC7BuH,gBAAK3c,EAAMQ,QAAQ4U,SAASF,KAAM,IAClCyH,gBAAK3c,EAAMQ,QAAQyU,QAAQC,KAAM,IAKjCjb,SAAU,WACV2hB,OAAQ,GACRoO,UAAW,SACX5oB,SAAU,UAEZy6C,kBAAmB,CACjBjiC,OAAQ,YACR9T,MAAO,OACPiS,UAAW,GAEb+jC,eAAgB,CACdz7C,MAAOL,EAAMQ,QAAQ4U,SACjBpV,EAAMQ,QAAQ4U,SAAS4C,aACvBhY,EAAMQ,QAAQyU,QAAQ+C,cAE5B+jC,QAAS,CACPC,YAAa,OACbpiC,OAAQ,aAEV8B,MAAO,CACLjD,YAAazY,EAAMG,QAAQ,GAC3Bkf,aAAcrf,EAAMG,QAAQ,IAE9B87C,MAAO,CACLzsB,cAAe,OACf1V,OAAQ,OACRhU,MAAO,EACP7L,SAAU,WACV2hB,OAAQ,QAKd,SAASsgC,GAAT,GAQG,IAPDlvD,EAOC,EAPDA,MACAmvD,EAMC,EANDA,SAMC,IALDC,wBAKC,MALkB,8BAKlB,IAC2B7hC,qBAD3B,mBACM8hC,EADN,KACcC,EADd,OAE+B/hC,qBAF/B,mBAEMgiC,EAFN,KAEgBC,EAFhB,OAG2BjiC,qBAH3B,mBAGMkiC,EAHN,KAGcC,EAHd,KAIKC,EAAchiC,iBAAuB,MACrCiiC,EAAgBjiC,iBAAO,MACvBjZ,EAAU5B,KACV0a,OAA2B5qB,IAAXysD,EAiEtB,SAASQ,EAAU/hC,GACjBA,EAAMC,iBACND,EAAMqU,kBACFwtB,EAAY3hC,SACdshC,EACExhC,EAAMi2B,QAAU4L,EAAY3hC,QAAQ+D,wBAAwB1B,MAKlE,SAASxC,EAAUC,GACb6hC,EAAY3hC,SACd0hC,EACE5hC,EAAMi2B,QAAU4L,EAAY3hC,QAAQ+D,wBAAwB1B,MAKlE,SAASy/B,IACPJ,OAAU9sD,GAGZ,GArFAgrB,qBAAU,WACR,SAASmiC,EAAgBjiC,GACvB,GAAI6hC,EAAY3hC,SAAWR,EAAe,CACxC,IAAMwiC,EACJliC,EAAMi2B,QAAU4L,EAAY3hC,QAAQ+D,wBAAwB1B,KAC9Dm/B,EAAYQ,IAIhB,SAASC,IAcP,GAZEN,EAAY3hC,cACDprB,IAAXysD,QACazsD,IAAb2sD,GAEIhiD,KAAKsgD,IAAI0B,EAAWF,GAAU,GAChCrvD,EAAMkwD,uBACJf,EAAShzC,OAAOkzC,GAChBF,EAAShzC,OAAOozC,IAMpBI,EAAY3hC,cACDprB,IAAXysD,QACazsD,IAAb2sD,EACA,CACA,IAAMY,EAAYhB,EAAShzC,OAAOkzC,GAClCrvD,EAAMowD,SACJ7iD,KAAK2O,MAAMi0C,EAAUt0C,OACrBs0C,EAAUjxD,QACVixD,EAAUp0C,OAGduzC,OAAU1sD,GACV4sD,OAAY5sD,QAEGA,IAAXysD,GACFK,OAAU9sD,GAId,SAASytD,EAAcviC,GACH,WAAdA,EAAMnY,MACR25C,OAAU1sD,GACV4sD,OAAY5sD,IAIhB,OAAI4qB,GACF1iB,OAAOqjB,iBAAiB,YAAa4hC,GAAiB,GACtDjlD,OAAOqjB,iBAAiB,UAAW8hC,GAAe,GAClDnlD,OAAOqjB,iBAAiB,UAAWkiC,GAAe,GAC3C,WACLvlD,OAAOsjB,oBAAoB,YAAa2hC,GAAiB,GACzDjlD,OAAOsjB,oBAAoB,UAAW6hC,GAAe,GACrDnlD,OAAOsjB,oBAAoB,UAAWiiC,GAAe,KAGlD,eACN,CAAC7iC,EAAe+hC,EAAUF,EAAQrvD,EAAOmvD,SAwB7BvsD,IAAXysD,EACF,OACE,yBAAKv6C,MAAO,CAAE7H,SAAU,kBACVrK,IAAX6sD,EACC,kBAAC,KAAD,CACEvgC,MAAO1B,EACPhX,UAAU,MACV5B,MAAOyB,qBAAU84C,EAAShzC,OAAOszC,IACjC92B,OAAK,GAEL,yBACEzjB,UAAWR,EAAQu6C,MACnBn6C,MAAO,CACLub,KAAMo/B,MAIV,KACJ,yBACEv6C,UAAWR,EAAQm6C,kBACnBrgC,KAAK,eACLoC,IAAK++B,EACLrhC,YAAauhC,EACbtyB,WAAYuyB,EACZ/8B,YAAalF,GAEZuhC,IAMT,IAOIkB,EACAC,EARAlgC,EAAOg/B,GAAU,EACjBv2C,EAAQ,EAQZ,QAPelW,IAAXysD,QAAqCzsD,IAAb2sD,IAC1Bl/B,EAAOk/B,EAAWF,EAASE,EAAWF,EACtCv2C,EAAQy2C,EAAWF,GAKjBA,IACFiB,EAAenB,EAAShzC,OAAOkzC,GAC/BkB,EAAgBpB,EAAShzC,OAAOkzC,EAASv2C,GACrCy2C,GAAYA,EAAWF,GAAQ,OACA,CAACkB,EAAeD,GAA/CA,EAD+B,KACjBC,EADiB,KAKrC,OACE,yBAAKz7C,MAAO,CAAE7H,SAAU,aACrB2iD,EAAc5hC,QACb,oCACE,kBAACgG,GAAA,EAAD,CACE9e,UAAWR,EAAQq6C,QACnBr6C,QAAS,CACPga,MAAOha,EAAQga,OAEjBQ,MAAI,EACJuC,SAAUm+B,EAAc5hC,QACxByG,aAAc,CACZrH,SAAU,MACVsH,WAAY,QAEdb,gBAAiB,CACfzG,SAAU,SACVsH,WAAY,SAEd0K,aAAW,EACXoxB,qBAAmB,GAEnB,kBAAC,KAAD,KACGF,EAAej6C,qBAAUi6C,GAAgB,KAG9C,kBAACt8B,GAAA,EAAD,CACE9e,UAAWR,EAAQq6C,QACnBr6C,QAAS,CACPga,MAAOha,EAAQga,OAEjBQ,MAAI,EACJuC,SAAUm+B,EAAc5hC,QACxByG,aAAc,CACZrH,SAAU,MACVsH,WAAY,SAEdb,gBAAiB,CACfzG,SAAU,SACVsH,WAAY,QAEd0K,aAAW,EACXoxB,qBAAmB,GAEnB,kBAAC,KAAD,KACGD,EAAgBl6C,qBAAUk6C,GAAiB,MAIhD,KACJ,yBACE3/B,IAAKg/B,EACL16C,UAAWR,EAAQk6C,WACnB95C,MAAO,CACLub,OACAvX,MAAOvL,KAAKsgD,IAAI/0C,GAChBgU,OAAQ2jC,MAGZ,yBACEtgC,cAAY,sBACZjb,UAAWR,EAAQm6C,kBACnBrgC,KAAK,eACLoC,IAAK++B,EACLrhC,YAAauhC,EACbtyB,WAAYuyB,EACZ/8B,YAAalF,GAEZuhC,IAYTF,GAAmBpyB,aAAe,CAChCsyB,iBAAkB,+BAGLjmD,0BAAS+lD,IC9QlBp8C,GAAYC,cAAW,SAAAC,GAC3B,IAAM09C,EAAgB19C,EAAMQ,QAAQ4U,SAChCpV,EAAMQ,QAAQ4U,SAASsP,MACvB1kB,EAAMQ,QAAQyU,QAAQyP,MAC1B,MAAO,CACLi5B,SAAU,CACRtgD,QAAS,OACTyI,MAAO,OACPgU,OAAQ2jC,GACRr8C,SAAU,UAEZw8C,eAAgB,CACd58C,gBAAiBhB,EAAMQ,QAAQD,WAAWub,QAC1C7hB,SAAU,WACV0qB,YAAa3kB,EAAMQ,QAAQ5F,KAAKqa,QAChC4oC,kBAAmB,SAErBC,sBAAuB,CACrBxO,gBAAiB,sKACjByO,iBAAkB,UAEpBC,sBAAuB,CACrB1O,gBAAiB,kKACjByO,iBAAkB,UAEpBE,6BAA8B,CAC5Bn4C,MAAO,GACPgU,OAAQ,KACRvZ,WAAY,iHAEZw9C,iBAAkB,WAClBG,eAAgB,WAChBC,oBAAqB,MACrBC,uBAAwB,MACxB1hC,MAAO,QAET2hC,8BAA+B,CAC7Bv4C,MAAO,GACPgU,OAAQ,KACRvZ,WAAY,kHAEZw9C,iBAAkB,WAClBG,eAAgB,WAChBI,qBAAsB,MACtBC,wBAAyB,MACzB7hC,MAAO,SAET8hC,gBAAiB,CACfvkD,SAAU,WACV61C,WAAY,OACZ2O,WAAY,SACZjvB,cAAe,OACfnS,KAAM,GAERqhC,cAAe,CACb5kC,OAAQ2jC,GACR33C,MAAO,EACP7L,SAAU,WACVoD,QAAS,OACTshD,eAAgB,SAChBnvB,cAAe,QAEjBovB,sBAAuB,CACrB9kC,OAAQ,OACRvZ,WAAYoc,gBAAK+gC,EAAe,IAChCzjD,SAAU,WACV+hB,KAAM,EACNmG,YAAa,EACbF,YAAa,QACb0C,YAAahI,gBAAK+gC,EAAe,IACjCn8C,UAAW,eAEb46C,SAAU,CACRriC,OAAQ+kC,GACR5kD,SAAU,YAEZ6kD,YAAa,CAAEzhD,QAAS,QAASpD,SAAU,gBAKzC8kD,GAAU5oD,oBACd,YAMM,IALJnJ,EAKI,EALJA,MACAmvD,EAII,EAJJA,SAKMn8C,EAAQ8iB,eACRphB,EAAU5B,KACRqF,EAA4DnY,EAA5DmY,SAAUW,EAAkD9Y,EAAlD8Y,MAAOlK,EAA2C5O,EAA3C4O,QAEnB+I,EAF8D3X,EAAlC0c,cAG/Bs1C,YACAr7C,QAAO,SAAAiB,GAAK,YAAsBhV,IAAlBgV,EAAM1Y,WACzBiwD,EAAS3zC,iBAAiB1C,GAC1Bq2C,EAASvyC,iBACT,IAIIq1C,EACAC,EALEC,EAAen/C,EAAMQ,QAAQ4U,SAC/BpV,EAAMQ,QAAQ4U,SAASsP,MACvB1kB,EAAMQ,QAAQyU,QAAQyP,MAItB06B,EAAmC,GAwCvC,OArCAz6C,EAAO1I,SAAQ,SAAChG,EAAQ8S,GACtB,IAAMs2C,EAAUppD,EAAOkP,SAAWA,EAC5Bm6C,EAAQD,GAAWppD,EAAO1J,IAAM0J,EAAO5J,OAASuP,EAClD2jD,EAAUpD,EAASvzC,OAAO,CAC5B1c,QAAS+J,EAAO/J,QAChB2c,MAAO5S,EAAO5J,MACd+Z,aAAcnQ,EAAOmQ,eAEnBo5C,EAAWrD,EAASvzC,OAAO,CAC7B1c,QAAS+J,EAAO/J,QAChB2c,MAAO5S,EAAO1J,IACd6Z,aAAcnQ,EAAOmQ,eAGvB,GAAInQ,EAAOhJ,SAAU,OACI,CAACuyD,EAAUD,GAAhCA,EADiB,KACRC,EADQ,KAGP,IAAVz2C,IAEFk2C,EAAaI,EACbH,EAAaK,GAEfH,EAAS,CACP,CAACC,EAASR,IACV,CAACS,EAAOT,IACR,CAACW,EAAU,GACX,CAACD,EAAS,IAERx2C,IAAUpE,EAAO7T,OAAS,IAC5BsuD,EAAS,CACP,CAACH,EAAYJ,IACb,CAACS,EAAOT,IACR,CAACW,EAAU,GACX,CAACN,EAAY,QAKjB,yBACEplC,OAAQ+kC,GACR/4C,MAAM,OACN5D,UAAWR,EAAQo9C,aAElBM,GACC,6BACEA,OAAQA,EAAOjvD,WACfT,KAAMitB,gBAAKwiC,EAAc,IACzBM,OAAQ9iC,gBAAKwiC,EAAc,UAUjCO,GAAWvpD,oBAAS,YAAqD,IAAlDnJ,EAAkD,EAAlDA,MAAOytD,EAA2C,EAA3CA,MAC5B/4C,EAAU5B,KACR+F,EAAoD7Y,EAApD6Y,iBAAiC85C,EAAmB3yD,EAAlC0c,cAClB+9B,EAAoBt4B,sBAAWniB,GAA/By6C,gBACF6T,EAAYd,GAAgBC,EAAO,IAAK,IAE9C,OACE,yBAAKv4C,UAAWR,EAAQi8C,UAErB93C,EAAiB7O,KAAI,SAAC4oD,EAAK32C,GAC1B,IACI42C,EADExL,EAAW5M,EAAgB76C,IAAIgzD,EAAIpyD,cAErC6mD,IACFwL,EAAexL,EAASyL,gBAAgBF,EAAI1zD,UAY9C,IAVA,IAAM6zD,EAAeH,EAAIrzD,IAAMqzD,EAAIvzD,MAE7Bwf,EAAS7e,EAAMga,aAAa44C,EAAIpyD,aAAcoyD,EAAI1zD,SAClD8zD,IAAmBn0C,GACrBA,EAAOtf,IAAMsf,EAAOxf,MAAQuzD,EAAIrzD,IAAMqzD,EAAIvzD,MAGxC4zD,EAAY1lD,KAAKsN,MAAMk4C,EAAezE,EAAUN,YAEhDkF,EAAa,GACVn3C,EAAQ,EAAGA,EAAQk3C,EAAWl3C,IAAS,CAC9C,IAAMo3C,GAAep3C,EAAQ,GAAKuyC,EAAUN,WAC5CkF,EAAW5iD,KACTsiD,EAAI3yD,SAAW2yD,EAAIrzD,IAAM4zD,EAAcP,EAAIvzD,MAAQ8zD,GAGvD,OACE,kBAACl8C,GAAA,EAAD,CACEtB,IAAG,UAAKS,KAAKC,UAAUu8C,GAApB,YAA4B32C,EAAIm3C,eAAe,UAClDj+C,QAAQ,WACRD,UAAWuZ,aACT/Z,EAAQk8C,eACRgC,EAAI3yD,SACAyU,EAAQs8C,sBACRt8C,EAAQo8C,uBAEdh8C,MAAO,CACLjB,SAAUk/C,EAAetF,EACzBx5C,YACEgI,IAAQpD,EAAiB/U,OAAS,OAC9BlB,EAjIG,EAmIT+0B,YAAak7B,IAGdG,GACC,yBACE99C,UAAWR,EAAQu8C,6BACnBn8C,MAAO,CACLwtC,gBAAiB,4BAAF,OAA8BuQ,EAA9B,2EACQA,EADR,0BAEf3B,eAAgB,WAChBH,iBAAkB,cAKxB,kBAAC,KAAD,CACEj8C,MAAO,CAAEzB,MAAOw/C,GAChB39C,UAAWR,EAAQ88C,iBAElBoB,EAAI1zD,SAINyzD,EAAe3oD,KAAI,SAACvG,EAAG4vD,GACtB,GACET,EAAIpyD,eAAiBiD,EAAEjD,cACvBoyD,EAAI1zD,UAAYuE,EAAEvE,SAClBuE,EAAE2V,eAAiB6C,EACnB,CACA,IAAMq3C,EAAY7vD,EAAExD,UACf2yD,EAAIrzD,IAAMkE,EAAElE,KAAOkuD,EAAQ,GAC3BhqD,EAAEpE,MAAQuzD,EAAIvzD,OAASouD,EAAQ,EACpC,OACE,yBACE93C,IAAG,UAAKlS,EAAEkS,IAAP,YAAc09C,GACjBn+C,UAAWR,EAAQk9C,sBACnB98C,MAAO,CACLgE,MAAOvL,KAAKuM,KAAKrW,EAAElE,IAAMkE,EAAEpE,OAASouD,EAAO,GAC3Cp9B,KAAMijC,EACN9wB,cAAe,UAKvB,OAAO,QAGR0wB,EAAWlpD,KAAI,SAACupD,EAAWC,GAAZ,OACd,yBACE79C,IAAG,UAAKS,KAAKC,UAAUu8C,GAApB,YAA4BW,EAA5B,YAAyCC,GAC5Ct+C,UAAWR,EAAQg9C,cACnB58C,MAAO,CACLub,MAAQmjC,EAAW,GAAKlF,EAAUN,WAAcP,EAChDjrB,cAAe,OACfnvB,MAAOw/C,IAGRU,EAAUH,eAAe,aAG7BJ,GACC,yBACE99C,UAAWR,EAAQ28C,8BACnBv8C,MAAO,CACLwtC,gBAAiB,2BAAF,OAA6BuQ,EAA7B,0EACOA,EADP,0BAEf3B,eAAgB,WAChBH,iBAAkB,sBAyDrB5nD,2BA9Cf,YAMG,IALDnJ,EAKC,EALDA,MACA2U,EAIC,EAJDA,SAKMD,EAAU5B,KACRgG,EAA4B9Y,EAA5B8Y,MAAOD,EAAqB7Y,EAArB6Y,iBAETs2C,EAAWn0C,GAAWxQ,OAAO,CACjCqO,iBAAkBzC,KAAKW,MAAMX,KAAKC,UAAUwC,MAGxC40C,EACJztD,EAAM0b,SAAW5C,EAhOE,GAgOOD,EAAiB/U,OAAS,IAEtD,OAAK+U,EAAiB/U,OAepB,6BACE,kBAAC,GAAD,CACE9D,MAAOA,EACPmvD,SAAUA,EACVC,iBAAkB,kBAACsD,GAAD,CAAU1yD,MAAOA,EAAOytD,MAAOA,MAEnD,yBAAKv4C,UAAWR,EAAQy6C,UACtB,kBAAC4C,GAAD,CAAS/xD,MAAOA,EAAOmvD,SAAUA,IAChCx6C,IArBH,oCACE,yBAAKO,UAAWR,EAAQi8C,UACtB,kBAAC8C,GAAA,EAAD,CACEt+C,QAAQ,gBACRL,MAAO,CAAEC,UAAW,EAAG+D,MAAO,WAGlC,6BAAMnE,O,qDCvUR7B,GAAYC,aAAW,CAC3B+mB,UAAW,CACTzpB,QAAS,OACTqjD,cAAe,MACf35B,WAAY,UAEd45B,OAAQ,CACN76C,MAAO,MA+CI3P,2BA3Cf,YAAmE,IAA3CnJ,EAA2C,EAA3CA,MAChB0U,EAAU5B,KACR8gD,EAAiD5zD,EAAjD4zD,WAAYC,EAAqC7zD,EAArC6zD,WAAYjlD,EAAyB5O,EAAzB4O,QAASklD,EAAgB9zD,EAAhB8zD,YAFwB,EAGvCvmC,mBAA+B,KAArBhgB,KAAKwmD,KAAKnlD,IAHmB,mBAG1D4D,EAH0D,KAGnD6iB,EAHmD,KAOjE,OAHAzH,qBAAU,WACRyH,EAA+B,KAArB9nB,KAAKwmD,KAAKnlD,MACnB,CAACymB,EAAUzmB,IAEZ,yBAAKsG,UAAWR,EAAQolB,WACtB,kBAAC,KAAD,CACE3J,cAAY,WACZvK,QAAS,WACP5lB,EAAMg0D,KAAe,EAAVplD,IAEb6hB,SAAU7hB,GAAWglD,EAAa,MAA0B,IAAhBE,EAC5CzgD,MAAM,aAEN,kBAAC,KAAD,OAGF,kBAAC4gD,GAAA,EAAD,CACE/+C,UAAWR,EAAQi/C,OACnBnhD,MAAOA,EACPhF,IAA8B,KAAxBD,KAAKwmD,KAAKH,GAChB95C,IAA8B,KAAxBvM,KAAKwmD,KAAKF,GAChBz9B,SAAU,SAACptB,EAAG0N,GAAJ,OAAY2e,EAAS3e,IAC/Bw9C,kBAAmB,kBAAMl0D,EAAM8c,OAAN,SAAa,GAAOtK,EAAQ,OACrDie,SAA0B,IAAhBqjC,IAEZ,kBAAC,KAAD,CACE3jC,cAAY,UACZvK,QAAS,WACP5lB,EAAMg0D,KAAKh0D,EAAM4O,QAAU,IAE7B6hB,SAAU7hB,GAAWilD,EAAa,MAA0B,IAAhBC,EAC5CzgD,MAAM,aAEN,kBAAC,KAAD,WChCFP,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCmhD,UAAW,CACTrnC,OAAQ+kC,GACRxhD,QAAS,QAEX+jD,OAAQ,CACNtkC,SAAU,GAEZzkB,MAAO,GACPgpD,cAAe,CACbxgD,SAAU,KAEZygD,UAAW,CACT/gD,WAAYoc,gBAAK3c,EAAMQ,QAAQD,WAAWmb,MAAO,IACjD5B,OAjBkB,GAkBlBzD,OAjBY,GAmBd/M,GAAI,CACFjM,QAAS,OACT0pB,WAAY,SACZc,WAAY,GAEd05B,aAAc,CACZznC,OAAQ,GACRxY,OAAQ,OACR+U,OAAQrW,EAAMG,QAAQ,KAExBqhD,aAAc,CACZvgD,YAAajB,EAAMG,QAAQ,QAIzBshD,GAAWtrD,oBAAS,YAA+B,IAA5BnJ,EAA4B,EAA5BA,MACrB0U,EAAU5B,KAChB,OACE,kBAAC,IAAD,CACE8S,QAAS5lB,EAAM00D,sBACfx/C,UAAWR,EAAQ6/C,aACnB3/C,MAAM,sBACNpC,MAAM,eACNa,MAAM,aAEN,kBAACg4C,GAAD,CAAmBn2C,UAAWR,EAAQ8/C,mBAKtCG,GAASxrD,oBAAS,YAA+B,IAA5BnJ,EAA4B,EAA5BA,MAA4B,EAC3ButB,qBAD2B,mBAC9C/a,EAD8C,KACvC6iB,EADuC,KAE/CY,EAAWtI,iBAAyB,MACpC3a,EAAQ8iB,eAEZ8+B,EAEE50D,EAFF40D,wBACmBC,EACjB70D,EADF80D,kBAIIA,EACJF,GAA2BC,EAEvBvxC,EAAUnB,sBAAWniB,GAW3B,OACE,0BACEmwB,cAAY,cACZ4kC,SAAU,SAAAjnC,GACRA,EAAMC,iBACNkI,GAAYA,EAASjI,SAAWiI,EAASjI,QAAQ4H,OACjDpjB,GAfN,SAAewiD,GACb,IACEh1D,EAAMi1D,eAAeD,GACrB,MAAOlwD,GACPC,QAAQ4H,KAAK7H,GACbwe,EAAQ4xC,OAAR,UAAkBpwD,GAAK,YAUZqwD,CAAM3iD,GAIf6iB,OAASzyB,KAGX,kBAAC,KAAD,CACEqzB,SAAUA,EACVm/B,QAAS,kBAAM//B,EAASy/B,IACxBx+B,OAAQ,kBAAMjB,OAASzyB,IACvBwzB,SAAU,SAAAtI,GAAK,OAAIuH,EAASvH,EAAMuI,OAAO7jB,QACzC2C,QAAQ,WACR3C,WAAiB5P,IAAV4P,EAAsBsiD,EAAoBtiD,EACjDsC,MAAO,CAAEuU,OA7FD,EA6FkBwR,WAAYw6B,IACtCn/B,WAAY,CACV,cAAe,gBAGjBi3B,WAAY,CACVmI,eAAgB,kBAAC,KAAD,MAChBxgD,MAAO,CACLvB,WAAYoc,gBAAK3c,EAAMQ,QAAQD,WAAWmb,MAAO,IACjD5B,OAvGU,WA+GtB,SAASyoC,GAAT,GAAgD,IAAzBv1D,EAAyB,EAAzBA,MACf0U,EAAU5B,KAChB,OACE,oCACE,kBAAC,IAAD,CACEqC,QAAQ,WACRD,UAAWR,EAAQ4/C,UACnB1uC,QAAS,kBAAM5lB,EAAMw1D,OAAO,MAE5B,kBAAC,KAAD,OAEF,kBAAC,IAAD,CACErgD,QAAQ,WACRD,UAAWR,EAAQ4/C,UACnB1uC,QAAS,kBAAM5lB,EAAMw1D,MAAM,MAE3B,kBAAC,KAAD,QAMOrsD,2BAAS,YAA+B,IAA5BnJ,EAA4B,EAA5BA,MACnB0U,EAAU5B,KACVE,EAAQ8iB,eACezd,EAAoCrY,EAAzDy1D,oBAAoC58C,EAAqB7Y,EAArB6Y,iBAEtC68C,EAAqBC,uBACzB,SAAC1sD,GACKA,IACFjJ,EAAMqb,oBAAoB,CAACpS,IAC3BjJ,EAAM4c,oBAGV,CAAC5c,IAZkD,EAenBqY,EAAc,IAAM,CAAEnZ,QAAS,IAAzDsB,EAf6C,EAe7CA,aAActB,EAf+B,EAe/BA,QAEhB02D,EACJ,yBAAK1gD,UAAWR,EAAQy/C,WACtB,kBAAC,GAAD,CAAUn0D,MAAOA,IACjB,yBAAKkV,UAAWR,EAAQ0/C,SACxB,kBAAC,KAAD,CAAW3rB,KAAG,EAAC3zB,MAAO,CAAE+gD,SAAU,WAChC,kBAACN,GAAD,CAAav1D,MAAOA,IACpB,kBAAC,GAAD,CACEysD,SAAUiJ,EACVl1D,aAAcA,EACdgS,MAAOqG,EAAiB/U,OAAS,EAAI,GAAK5E,EAC1Cc,MAAOA,EACP0sD,eAAgB,CACdv3C,QAAS,WACTD,UAAWR,EAAQ2/C,cACnBv/C,MAAO,CAAEuU,OAnKL,GAoKJ8jC,WAAY,CACVr4C,MAAO,CACL5B,QAAS,EACT4Z,OAxKM,GAyKNvZ,WAAYoc,gBAAK3c,EAAMQ,QAAQD,WAAWmb,MAAO,SAKzD,kBAAC,GAAD,CAAQ1uB,MAAOA,KAEjB,kBAAC81D,GAAD,CAAa91D,MAAOA,IACpB,kBAAC,GAAD,CAAcA,MAAOA,IACrB,yBAAKkV,UAAWR,EAAQ0/C,UAI5B,OAAIp0D,EAAM+1D,mBACDH,EAGF,kBAAC,GAAD,CAAkB51D,MAAOA,GAAQ41D,MAGpCE,GAAc3sD,oBAAS,YAA+B,IAA5BnJ,EAA4B,EAA5BA,MACxB0U,EAAU5B,KACRkjD,EAAkBh2D,EAAlBg2D,cACR,OACE,kBAAC,KAAD,CAAY7gD,QAAQ,QAAQ9B,MAAM,gBAAgB6B,UAAWR,EAAQ4H,IAArE,UACM/O,KAAK2O,MAAM85C,GAAe5C,eAAe,SAD/C,W,sBCpMEtgD,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6X,KAAM,CACJtX,WAAYoc,gBAAK3c,EAAMQ,QAAQD,WAAWmb,MAAO,IACjD,UAAW,CACTnb,WAAYP,EAAMQ,QAAQD,WAAWmb,OAEvCunC,WAAYjjD,EAAMkjD,YAAY1rD,OAAO,CAAC,cAAe,CACnD2rD,SAAUnjD,EAAMkjD,YAAYC,SAASC,YAGzCz0C,UAAW,CACT0H,OAAQ,SACRvQ,MAAO,MACPqR,SAAU,SACVqY,cAAe,QAEjB6zB,WAAY,CACVzpC,OAAQ,OACRvZ,MAAO,WAETijD,eAAgB,CACdjmD,QAAS,eACTkmD,cAAe,SACf/zB,cAAe,QAEjBg0B,WAAY,CACVtjD,QAASF,EAAMG,QAAQ,QAMrBsjD,GAAa3mD,IAAM6gB,YACvB,SAAC/gB,EAAsDghB,GACrD,IAAMlc,EAAU5B,KAD6C,EAE7BhD,IAAMyd,SAA6B,MAFN,mBAEtDkE,EAFsD,KAE5CsG,EAF4C,KAGrDtZ,EAAqB7O,EAArB6O,MAAOvJ,EAActF,EAAdsF,UACT4O,EAAOC,6BAAkBtF,GACzB6E,EAAUnB,sBAAW1D,GACrBC,EAAYD,EAAME,cAClBoD,EAAUM,kBAAQ5D,EAAO,WAMzB+V,EAAc,WAClBuD,EAAY,OAmBVpW,EAAYU,kBAAQ5D,EAAO,QAe/B,MAd+B,2BAA3B4D,kBAAQ5D,EAAO,UACjBkD,EAAY,qBACZ2B,EAAQq8B,WAAW1wC,SAAQ,SAAAo4C,GACrBA,EAASqP,WAAah4C,IACxBiD,EAAY,uBAAH,OAA0BtT,yBAAeg5C,EAAU,QAAnD,UAWb,oCACE,kBAACpwC,GAAA,EAAD,CAAO2Z,IAAKA,EAAK1b,UAAWuZ,aAAKvZ,EAAWR,EAAQmW,OAClD,0BACE8rC,WAAS,EACTzhD,UAAWR,EAAQ2hD,WACnBO,YArCY,SAAC9oC,GACnB,IAAMuI,EAASvI,EAAMuI,OACjBA,EAAOwgC,aACT/oC,EAAMgpC,aAAaC,aACjB1gC,EAAOwgC,WACP,GACA,IAEF/yC,EAAKkzC,mBAAmBv4C,EAAM3e,MA8B1Bm3D,UA1BU,WAChBnzC,EAAKkzC,wBAAmBp0D,IA0BlButB,cAAA,qBAA2BrM,EAAKhkB,GAAhC,YAAsCiiB,IAEtC,kBAAC,KAAD,CAAU7M,UAAWR,EAAQ4hD,kBAE/B,kBAAC,KAAD,CACE1wC,QAAS,kBAAM9B,EAAKG,UAAUlC,IAC9B7M,UAAWR,EAAQ8hD,WACnB5hD,MAAM,mBACNvB,MAAM,aAEN,kBAAC,KAAD,OAEF,kBAAC,KAAD,CACE8B,QAAQ,QACRud,UAAU,OACVxd,UAAWR,EAAQiN,WAElBA,GAEH,kBAAC,KAAD,CACEqW,gBAAc,cACdC,gBAAc,OACdrS,QArEY,SAACkI,GACnBiK,EAAYjK,EAAMkF,gBAqEZ9d,UAAWR,EAAQ8hD,WACnBnjD,MAAM,YACN8c,cAAY,kBACZM,UAAWhS,EAAM4G,eAAevhB,QAEhC,kBAAC,KAAD,QAGJ,kBAAC,GAAD,CACE2tB,SAAUA,EACVF,gBA9CN,SAA6BvoB,EAAYnG,GACvCA,IACA2xB,KA6CItF,KAAMe,QAAQwB,GACdD,QAASgD,EACThR,UAAW,sBACLF,EAAQ4zC,wBACR5zC,EAAQ4zC,wBAAwBx4C,GAChC,IAHK,YAIND,EAAM4G,iBACToN,MAAK,SAAC7wB,EAAGC,GAAJ,OAAWA,EAAEmkB,UAAY,IAAMpkB,EAAEokB,UAAY,YAO/C7c,sBAASstD,IC9IlB3jD,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6X,KAAM,GACNkE,aAAc,CACZjC,OAAQqqC,GACR5iD,UAAW,aACXtH,SAAU,WACV2hB,OAAQ,GAEVwoC,QAAS,CACP50B,cAAe,OACfv1B,SAAU,WACV+hB,IAAK,EACLqB,KAAM,EACNvX,MAAO,OACP8V,OAAQ,EACRsG,aAAcliB,EAAM/T,MAAMi2B,cAE5BmiC,4BAA6B,CAC3BpqD,SAAU,WAEVojB,MAAO,EACPvD,OAAQ,OACRhU,MAAO,QAETw+C,WAAY,CACV1oC,OAAQ,EACRvF,OAAQrW,EAAMG,QAAQ,IAExBokD,iBAAkB,CAChBtqD,SAAU,WACVoD,QAAS,gBAEXmnD,kBAAmB,CACjBvqD,SAAU,YAEZwqD,wBAAyB,CACvB9oC,UAAW,OACXyB,UAAW,SACXyE,WAAY,SACZ5nB,SAAU,WACVsG,WAAY,OACZqb,OAAQ,EACRra,UAAW,mBA2GApL,2BArGf,SAAwByG,GAItB,IAAM8E,EAAU5B,KACR9S,EAAiB4P,EAAjB5P,MAAOye,EAAU7O,EAAV6O,MACTpO,EAAUoO,EAAMuE,SAAS,GACvB00C,EAAiD13D,EAAjD03D,iBAAkBC,EAA+B33D,EAA/B23D,gBAAiBC,EAAc53D,EAAd43D,UACnC9qC,EAAWzc,EAAXyc,OACFhJ,EAAOC,6BAAkB1T,GACzB0R,EAAUM,kBAAQ5D,EAAO,WACzBmS,EAAMjD,iBAAO,MAEnBC,qBAAU,WAIR,OAHIgD,EAAI5C,UACNhuB,EAAM63D,UAAU91C,GAAW6O,EAAI5C,SAE1B,kBACEhuB,EAAM63D,UAAU91C,MAExB,CAAC/hB,EAAM63D,UAAW91C,IAUrB,IAAM+1C,EAAuBC,iCAT7B,gBAEwBn1D,IAApB+0D,GACAp/B,kBAAQloB,IACRsnD,IAAoBtnD,EAAQvQ,IAE5B83D,EAAUD,EAAiBl5C,EAAM3e,MAG0B,KACvD4kD,EAAqCr0C,EAArCq0C,mBAAoBsT,EAAiB3nD,EAAjB2nD,aACtBC,OAA6Br1D,IAApB+0D,GAAiCA,IAAoBtnD,EAAQvQ,GAE5E,OACE,yBAAKoV,UAAWR,EAAQmW,MACA,WAArB/G,EAAKo0C,YACJ,kBAAC,GAAD,CACEz5C,MAAOA,EACPvJ,UAAWuZ,aACT/Z,EAAQ4iD,WACa,gBAArBxzC,EAAKo0C,YACDxjD,EAAQ8iD,kBACR9iD,EAAQ6iD,oBAGd,KAEJ,kBAACtgD,GAAA,EAAD,CACE9B,QAAQ,WACRD,UAAWR,EAAQ+iD,wBACnB3iD,MAAO,CAAEgY,UACTqrC,SAAU,SAAArqC,GACR,IAAMuI,EAASvI,EAAMuI,OACrBhmB,EAAQo5C,aAAapzB,EAAOyxB,YAE9BsQ,YAAaN,EACb3nC,cAAA,kCAAwCrM,EAAKhkB,GAA7C,YAAmDiiB,GACnDyM,KAAK,gBAEL,yBACEoC,IAAKA,EACL1b,UAAWR,EAAQ2iD,4BACnBviD,MAAO,CAAE4X,UAAW,UAAF,OAAY1sB,EAAM8zD,YAAlB,OAElB,kBAACpP,EAAD,CACE1kD,MAAOqQ,EACP4yC,WAAY,GACZoV,mBAAoBX,KAIvBM,EACC,yBACEljD,MAAO,CACL7H,SAAU,WACVojB,KAAM,EACNrB,IAAK3e,EAAQyc,OAAS,KAGvB,IACD,kBAACkrC,EAAD,CAAch4D,MAAOqQ,KAErB,MAEN,yBACE6E,UAAWR,EAAQ0iD,QACnBtiD,MAAO,CACLgY,OAAQzc,EAAQyc,OAChBvZ,WAAY0kD,EAAS,0BAAuBr1D,GAE9Cw1D,YAAaN,IAEf,kBAAC,GAAD,CACE3qC,OAAQ9c,EAAQk5C,aAChBr0C,UAAWR,EAAQqa,mB,qBC7IrBjc,GAAYC,cAAW,SAAAC,GAI3B,MAAO,CACL47C,WAAY,CACV9hC,OAAQ,OACRvZ,WANeP,EAAMQ,QAAQ4U,SAC7BuH,gBAAK3c,EAAMQ,QAAQ4U,SAASF,KAAM,IAClCyH,gBAAK3c,EAAMQ,QAAQyU,QAAQC,KAAM,IAKjCjb,SAAU,WACV2hB,OAAQ,GACRoO,UAAW,SACX5oB,SAAU,UAEZy6C,kBAAmB,CACjBjiC,OAAQ,YACR9T,MAAO,OACPiS,UAAW,GAEb+jC,eAAgB,CACdz7C,MAAOL,EAAMQ,QAAQ4U,SACjBpV,EAAMQ,QAAQ4U,SAAS4C,aACvBhY,EAAMQ,QAAQyU,QAAQ+C,cAE5B+jC,QAAS,CACPC,YAAa,OACbpiC,OAAQ,aAEV8B,MAAO,CACLjD,YAAazY,EAAMG,QAAQ,GAC3Bkf,aAAcrf,EAAMG,QAAQ,IAE9B87C,MAAO,CACLzsB,cAAe,OACf1V,OAAQ,OACRhU,MAAO,EACP7L,SAAU,WACV2hB,OAAQ,QAKR0pC,GAAgBnvD,oBACpB,YAAuD,IAApDnJ,EAAoD,EAApDA,MAAOu4D,EAA6C,EAA7CA,OACF7jD,EAAU5B,KAChB,OACE,kBAAC,KAAD,CACEoc,MAAI,EACJ1Y,UAAU,MACV5B,MAAOyB,qBAAUrW,EAAMmc,OAAOo8C,IAC9B5/B,OAAK,GAEL,yBACEzjB,UAAWR,EAAQu6C,MACnBn6C,MAAO,CACLub,KAAMkoC,EACNhlD,WAAY,aAaxB,SAASilD,GAAT,GAMG,IALDx4D,EAKC,EALDA,MAKC,IAJDovD,wBAIC,MAJkB,8BAIlB,IAC2B7hC,qBAD3B,mBACM8hC,EADN,KACcC,EADd,OAE+B/hC,qBAF/B,mBAEMgiC,EAFN,KAEgBC,EAFhB,OAG2CjiC,qBAH3C,mBAGM42B,EAHN,KAGsBsU,EAHtB,OAI2BlrC,qBAJ3B,mBAIMkiC,EAJN,KAIcC,EAJd,KAKKC,EAAchiC,iBAAuB,MACrCiiC,EAAgBjiC,iBAAO,MACvBjZ,EAAU5B,KACV0a,OAA2B5qB,IAAXysD,QAA2CzsD,IAAnBuhD,EAuC9C,SAAS0L,EAAU/hC,GACjBA,EAAMC,iBACND,EAAMqU,kBACN,IAAM6tB,EACJliC,EAAMi2B,QACLj2B,EAAMuI,OAA0BtE,wBAAwB1B,KAC3Di/B,EAAUU,GACVR,EAAYQ,GAGd,SAASniC,EAAUC,GACjB,IAAMuI,EAASvI,EAAMuI,OACrBq5B,EAAU5hC,EAAMi2B,QAAU1tB,EAAOtE,wBAAwB1B,MAG3D,SAASy/B,IACPJ,OAAU9sD,GAiBZ,SAAS4xB,IACPikC,OAAkB71D,GAClB0sD,OAAU1sD,GACV4sD,OAAY5sD,GAzEdgrB,qBAAU,WACR,SAASmiC,EAAgBjiC,GACvB,GAAI6hC,EAAY3hC,SAAWR,EAAe,CACxC,IAAMwiC,EACJliC,EAAMi2B,QAAU4L,EAAY3hC,QAAQ+D,wBAAwB1B,KAC9Dm/B,EAAYQ,IAIhB,SAASC,EAAcniC,QACNlrB,IAAXysD,IACFoJ,EAAkB,CAAEpoC,KAAMvC,EAAMi2B,QAAS/0B,IAAKlB,EAAMk2B,UACpD0L,OAAU9sD,IAGd,OAAI4qB,GACF1iB,OAAOqjB,iBAAiB,YAAa4hC,GACrCjlD,OAAOqjB,iBAAiB,UAAW8hC,GAC5B,WACLnlD,OAAOsjB,oBAAoB,YAAa2hC,GACxCjlD,OAAOsjB,oBAAoB,UAAW6hC,KAGnC,eACN,CAACZ,EAAQ7hC,EAAe22B,IAE3Bv2B,qBAAU,YAELJ,QACY5qB,IAAb2sD,QACW3sD,IAAXysD,GACA9hD,KAAKsgD,IAAI0B,EAAWF,IAAW,GAE/B76B,OA2CJ,IAAMtF,EAAOe,QAAQk0B,GAOrB,IAAM3gC,EAAY,CAChB,CACEhiB,MAAO,iBACPskB,KAAM4yC,KACN9yC,QAAS,YA/Bb,WACE,QAAehjB,IAAXysD,QAA2CzsD,IAAnBuhD,EAA5B,CAGA,IAAIvqC,EAASy1C,EACTx1C,EAAUsqC,EAAe9zB,KAC7B,GAAIxW,EAAUD,EAAQ,OACC,CAACC,EAASD,GAA7BA,EADkB,KACVC,EADU,KAGtB,IAAM8+C,EAAa34D,EAAMmc,OAAOvC,GAC1Bg/C,EAAc54D,EAAMmc,OAAOtC,GACjC7Z,EAAM6c,OAAO87C,EAAYC,IAqBrBC,GACArkC,OAKN,QAAe5xB,IAAXysD,EACF,OACE,yCACczsD,IAAX6sD,EACC,kBAAC6I,GAAD,CAAet4D,MAAOA,EAAOu4D,OAAQ9I,IACnC,KACJ,yBACEt/B,cAAY,sBACZjb,UAAWR,EAAQm6C,kBACnBrgC,KAAK,eACLoC,IAAK++B,EACLrhC,YAAauhC,EACbtyB,WAAYuyB,EACZ/8B,YAAalF,GAEZuhC,IAOT,IAAM7+B,EAAQ4zB,EAAiBA,EAAe9zB,KAAOk/B,GAAY,EAC3Dl/B,EAAOE,EAAQ8+B,EAAS9+B,EAAQ8+B,EAChCv2C,EAAQvL,KAAKsgD,IAAIt9B,EAAQ8+B,GACzBiB,EAAetwD,EAAMmc,OAAOkU,GAC5BkgC,EAAgBvwD,EAAMmc,OAAOkU,EAAOvX,GACpCggD,EAAkBvrD,KAAK2O,MAAMpD,EAAQ9Y,EAAM4O,SAEjD,OACE,oCACGghD,EAAc5hC,QACb,oCACE,kBAACgG,GAAA,EAAD,CACE9e,UAAWR,EAAQq6C,QACnBr6C,QAAS,CACPga,MAAOha,EAAQga,OAEjBQ,MAAI,EACJuC,SAAUm+B,EAAc5hC,QACxByG,aAAc,CACZrH,SAAU,MACVsH,WAAY,QAEdb,gBAAiB,CACfzG,SAAU,SACVsH,WAAY,SAEd0K,aAAW,EACXoxB,qBAAmB,GAEnB,kBAAC,KAAD,KAAan6C,qBAAUi6C,KAEzB,kBAACt8B,GAAA,EAAD,CACE9e,UAAWR,EAAQq6C,QACnBr6C,QAAS,CACPga,MAAOha,EAAQga,OAEjBQ,MAAI,EACJuC,SAAUm+B,EAAc5hC,QACxByG,aAAc,CACZrH,SAAU,MACVsH,WAAY,SAEdb,gBAAiB,CACfzG,SAAU,SACVsH,WAAY,QAEd0K,aAAW,EACXoxB,qBAAmB,GAEnB,kBAAC,KAAD,KAAan6C,qBAAUk6C,MAGzB,KACJ,yBACE3/B,IAAKg/B,EACL16C,UAAWR,EAAQk6C,WACnB95C,MAAO,CAAEub,OAAMvX,UAEf,kBAAC,KAAD,CAAY3D,QAAQ,KAAKD,UAAWR,EAAQo6C,gBACzCgK,EAAgB1F,eAAe,SADlC,QAIF,yBACEjjC,cAAY,sBACZjb,UAAWR,EAAQm6C,kBACnBrgC,KAAK,eACLoC,IAAK++B,EACLrhC,YAAauhC,EACbtyB,WAAYuyB,EACZ/8B,YAAalF,GAEZuhC,GAEFjL,EACC,kBAAC,GAAD,CACED,gBAAgB,iBAChBC,eAAgBA,EAChB5yB,gBAnHR,SAA6BvoB,EAAYnG,GACvCA,IACA2xB,KAkHMtF,KAAMA,EACNsC,QAASgD,EACThR,UAAWA,IAEX,MAUVg1C,GAAW17B,aAAe,CACxBsyB,iBAAkB,+BAGLjmD,0BAASqvD,IClSlB1lD,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC+lD,kBAAmB,CACjB3kD,SAAU,SACVnH,SAAU,YAEZ+rD,sBAAuB,CACrB/rD,SAAU,WACV2hB,OAAQ,GAEV+hC,SAAU,CACR1jD,SAAU,WACVoD,QAAS,OACTmyB,cAAe,QAEjBy2B,eAAgB,CACd9uC,SAAU,OACVyE,OAAQ,EACRrb,WAAYP,EAAMQ,QAAQD,WAAWmb,MACrC+iC,WAAY,SACZjvB,cAAe,QAEjB02B,KAAM,CACJjsD,SAAU,WACV6L,MAAO,EACPzI,QAAS,OACTshD,eAAgB,SAChBnvB,cAAe,QAEjB22B,SAAU,CACRhvC,SAAU,OACVld,SAAU,WACVojB,KAAM,MACNrB,IAAK,OACL8zB,WAAY,OACZ2O,WAAY,SACZ7iC,OAAQ,EACR4T,cAAe,OACfjvB,WAAYP,EAAMQ,QAAQD,WAAWmb,WAInC0qC,GAAwBjwD,oBAAS,YAA+B,IAA5BnJ,EAA4B,EAA5BA,MAClC0U,EAAU5B,KAGZumD,EAAgB,EAMpB,OALAr5D,EAAMs5D,aAAarqD,SAAQ,SAAC2I,EAAOlU,GAC7BkU,EAAMO,SAAWnY,EAAMmY,SAAW,IACpCkhD,EAAgB31D,MAIlB,oCACG1D,EAAMs5D,aAAatvD,KAAI,SAAC4N,EAAOmE,GAC9B,OAAOnE,aAAiBQ,KACrBR,EAAM6B,4BAA8BsC,IAAUs9C,GAC/C,kBAAC,KAAD,CACE1jD,IAAG,mBAAciC,EAAMjC,IAApB,YAA2BoG,GAC9BjH,MAAO,CACLub,KACEtU,IAAUs9C,EACN9rD,KAAKuM,IAAI,GAAI9Z,EAAMmY,UACnBP,EAAMO,SAAWnY,EAAMmY,SAAW,EACxCsT,YAAa1P,IAAUs9C,EAAgB,EAAI,GAE7CnkD,UAAWR,EAAQykD,SACnBhpC,cAAA,mBAAyBvY,EAAM1Y,UAE9B0Y,EAAM1Y,SAEP,YAMNq6D,GAAyBpwD,oBAAS,YAA+B,IAA5BnJ,EAA4B,EAA5BA,MACnC0U,EAAU5B,KAEhB,OACE,oCACG9S,EAAMs5D,aAAatvD,KAAI,SAAC4N,EAAOmE,GAC9B,GAAInE,aAAiBQ,GAAc,CACjC,IAAMs2C,EAAQP,GACZv2C,EAAMvY,MACNuY,EAAMrY,IACNS,EAAM4O,SACN,GACA,GAGF,OACE,kBAAC,GAAD,CAAuB+G,IAAG,UAAKiC,EAAMjC,IAAX,YAAkBoG,GAASnE,MAAOA,GACzD82C,EAAM1kD,KAAI,SAAAkvD,GACT,GAAkB,iBAAdA,EAAKvpD,KAAyB,CAChC,IAAMlL,GACHmT,EAAM3X,SACH2X,EAAMrY,IAAM25D,EAAKvK,KACjBuK,EAAKvK,KAAO/2C,EAAMvY,OAASW,EAAM4O,QACjC4qD,GAAcN,EAAKvK,KAAO,GAAGyE,eAAe,SAClD,OACE,yBACEz9C,IAAKujD,EAAKvK,KACVz5C,UAAWR,EAAQwkD,KACnBpkD,MAAO,CAAEub,KAAM5rB,IAEd+0D,EACC,kBAAC,KAAD,CAAYtkD,UAAWR,EAAQukD,gBAC5BO,GAED,MAIV,OAAO,SAKf,OAAI5hD,aAAiBC,GACZ,kBAAC,GAAD,CAAsBlC,IAAKiC,EAAMjC,IAAKmD,MAAOlB,EAAMK,UAExDL,aAAiBc,GAEjB,kBAAC,GAAD,CACE/C,IAAKiC,EAAMjC,IACXmD,MAAOlB,EAAMK,QACbnD,MAAO,CAAEvB,WAAY,QACrBmvC,SAA4B,aAAlB9qC,EAAMzC,UAIf,YAMTu9C,GAAW5iD,IAAM6gB,YACrB,WAOEC,GACG,IAND5wB,EAMC,EANDA,MACA8U,EAKC,EALDA,MACAI,EAIC,EAJDA,UACG6e,EAGF,8CACGrf,EAAU5B,KAEV2mD,EAAaz5D,EAAMs5D,aAAanhD,SAAWnY,EAAMmY,SACvD,OACE,kBAAClB,GAAA,EAAD,eACEoX,eAAa,OACbnZ,UAAWuZ,aAAK/Z,EAAQqkD,kBAAmB7jD,GAC3CC,QAAQ,WACRyb,IAAKA,EACL9b,MAAOA,GACHif,GAEJ,yBACE7e,UAAWR,EAAQskD,sBACnBlkD,MAAO,CACL4X,UACwB,IAAtB1sB,EAAM8zD,YAAN,iBACc9zD,EAAM8zD,YADpB,UAEIlxD,IAGR,yBACEsS,UAAWR,EAAQi8C,SACnB77C,MAAK,aACHub,KAAMopC,EAAa,EACnB3gD,MAAO9Y,EAAMs5D,aAAaI,cACvB5kD,IAGL,kBAACykD,GAAD,CAAwBv5D,MAAOA,MAGnC,kBAACo5D,GAAD,CAAuBp5D,MAAOA,QAMvBmJ,sBAASupD,IC3LlB5/C,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC2mD,4BAA6B,CAC3B1sD,SAAU,WACV6f,OAAQ,OACRhU,MAAO,OACP8V,OAAQ,EACR4T,cAAe,QAEjBo3B,wBAAyB,CACvB3sD,SAAU,WACV6f,OAAQ,OACR8B,OAAQ,EACR4T,cAAe,OACfnyB,QAAS,QAEX6oD,KAAM,CACJjsD,SAAU,WACV6f,OAAQ,OACRhU,MAAO,GAET+gD,UAAW,CACTtmD,WAAYP,EAAMQ,QAAQ5F,KAAKksD,MAEjCC,UAAW,CACTxmD,WAAYP,EAAMQ,QAAQwmD,aAGxBC,GAAyB9wD,oBAAS,YAA+B,IAA5BnJ,EAA4B,EAA5BA,MACnC0U,EAAU5B,KAChB,OACE,oCACG9S,EAAMs5D,aAAatvD,KAAI,SAAC4N,EAAOmE,GAC9B,GAAInE,aAAiBQ,GAAc,CACjC,IAAMs2C,EAAQP,GAAUv2C,EAAMvY,MAAOuY,EAAMrY,IAAKS,EAAM4O,SACtD,OACE,kBAAC,GAAD,CAAuB+G,IAAG,UAAKiC,EAAMjC,IAAX,YAAkBoG,GAASnE,MAAOA,GACzD82C,EAAM1kD,KAAI,SAAAkvD,GACT,IAAMz0D,GACHmT,EAAM3X,SACH2X,EAAMrY,IAAM25D,EAAKvK,KACjBuK,EAAKvK,KAAO/2C,EAAMvY,OAASW,EAAM4O,QACvC,OACE,yBACE+G,IAAKujD,EAAKvK,KACVz5C,UAAWuZ,aACT/Z,EAAQwkD,KACM,UAAdA,EAAKvpD,MAAkC,iBAAdupD,EAAKvpD,KAC1B+E,EAAQmlD,UACRnlD,EAAQqlD,WAEdjlD,MAAO,CAAEub,KAAM5rB,SAO3B,OAAImT,aAAiBC,GACZ,kBAAC,GAAD,CAAsBlC,IAAKiC,EAAMjC,IAAKmD,MAAOlB,EAAMK,UAExDL,aAAiBc,GAEjB,kBAAC,GAAD,CACE/C,IAAKiC,EAAMjC,IACXmD,MAAOlB,EAAMK,QACbyqC,SAA4B,aAAlB9qC,EAAMzC,UAIf,YA8BAhM,2BAzBf,YAAmD,IAAzBnJ,EAAyB,EAAzBA,MAClB0U,EAAU5B,KAEV2mD,EAAaz5D,EAAMs5D,aAAanhD,SAAWnY,EAAMmY,SACvD,OACE,yBACEjD,UAAWR,EAAQilD,4BACnB7kD,MAAO,CACL4X,UACwB,IAAtB1sB,EAAM8zD,YAAN,iBAAoC9zD,EAAM8zD,YAA1C,UAA2DlxD,IAG/D,yBACEsS,UAAWR,EAAQklD,wBACnB9kD,MAAO,CACLub,KAAMopC,EACN3gD,MAAO9Y,EAAMs5D,aAAaI,eAG5B,kBAACO,GAAD,CAAwBj6D,MAAOA,SC1GjC8S,GAAYC,cAAW,iBAAO,CAClCmnD,oBAAqB,CACnB3mD,WAAY,cACZuZ,OAAQ,OACR8B,OAAQ,EACR3hB,SAAU,WACVqH,OAAQ,mBACR6lD,UAAW,OACXpmD,aAAc,OACdyuB,cAAe,QAEjB43B,eAAgB,CACdntD,SAAU,WACVu1B,cAAe,OACf3N,WAAY,SACZiuB,WAAY,YA8CD35C,2BA1Cf,YAA+C,IAAzBnJ,EAAyB,EAAzBA,MACZ4O,EAAyD5O,EAAzD4O,QAASyrD,EAAgDr6D,EAAhDq6D,eAAgBC,EAAgCt6D,EAAhCs6D,aAAcv8C,EAAkB/d,EAAlB+d,OAAQjF,EAAU9Y,EAAV8Y,MACjD8X,EAAMjD,iBAAuB,MAC7BjZ,EAAU5B,KACVynD,EAAmBzhD,EAAQ,EAEjC,OAAOiF,EAAOja,OACZ,yBACEqsB,cAAY,uBACZjb,UAAWR,EAAQwlD,oBACnB1rC,KAAK,eACLoC,IAAKA,EACL9b,MAAO,CACLub,KAAM,GAAF,OAAKkqC,EAAL,MACJzhD,MAAOvL,KAAKuM,IAAI,EAAIlL,EAAS,KAG9ByrD,GACC,yBAGElqC,cAAY,kBACZjb,UAAWR,EAAQ0lD,eACnB5rC,KAAK,eACL1Z,MAAO,CACLub,KAAM9iB,KAAKuM,IAAI,EAAIlL,EAAS,GAAK,EACjCogB,IAAKsrC,IAIND,EAAen7D,QAZlB,IAY4B,IACzBqO,KAAKuM,IAAIvM,KAAK2O,MAAMm+C,EAAertD,QAAU,EAAG,KAIrD,QC9CA8F,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCwnD,gBAAiB,CACfvtD,SAAU,WACVioB,aAAcliB,EAAM/T,MAAMi2B,aAC1B9gB,SAAU,UAEZggD,OAAQ,CACNnnD,SAAU,WACV6f,OAAQqqC,QA0KGhuD,2BAnKf,YAMG,IALDwL,EAKC,EALDA,SACA3U,EAIC,EAJDA,MAKM0U,EAAU5B,KAGV2nD,EAAQ9sC,iBAAO,GACf+sC,EAAY/sC,kBAAO,GACnBiV,EAAUjV,mBACViD,EAAMjD,iBAAuB,MAC7BgtC,EAAQhtC,iBAAe,GAR5B,EAUyCJ,oBAAS,GAVlD,mBAUMC,EAVN,KAUqBC,EAVrB,KAkID,OAtHAG,qBAAU,WACR,IAAIgtC,EAAU,aAEd,SAAS7K,EAAgBjiC,GACvBA,EAAMC,iBACN,IACMvQ,EADQsQ,EAAMi2B,QACK4W,EAAM3sC,QAC3BxQ,IAGGk9C,EAAU1sC,UACb0sC,EAAU1sC,SAAU,EACpBljB,OAAO+vD,uBAAsB,WAC3B76D,EAAM03D,kBAAkBl6C,GACxBk9C,EAAU1sC,SAAU,EACpB2sC,EAAM3sC,QAAUF,EAAMi2B,aAM9B,SAASkM,IACP0K,EAAM3sC,QAAU,EACZR,GACFC,GAAiB,GAYrB,OARID,IACF1iB,OAAOqjB,iBAAiB,YAAa4hC,GAAiB,GACtDjlD,OAAOqjB,iBAAiB,UAAW8hC,GAAe,GAClD2K,EAAU,WACR9vD,OAAOsjB,oBAAoB,YAAa2hC,GAAiB,GACzDjlD,OAAOsjB,oBAAoB,UAAW6hC,GAAe,KAGlD2K,IACN,CAAC56D,EAAOwtB,EAAemtC,IA4B1B/sC,qBAAU,WACR,IAAMktC,EAAOlqC,EAAI5C,QAGjB,SAAS+sC,EAAQC,GACf,IAAMltC,EAAQmtC,KAAeD,IACH,IAAtBA,EAAUE,SACZF,EAAUjtC,iBACV0sC,EAAMzsC,SAAWF,EAAMqtC,OAAS,IAChCn7D,EAAMo7D,eACJX,EAAMzsC,QAAU,EAAI,EAAIysC,EAAMzsC,QAAU,GAAK,EAAIysC,EAAMzsC,UAErD4U,EAAQ5U,SACV6D,aAAa+Q,EAAQ5U,SAEvB4U,EAAQ5U,QAAU4D,YAAW,WAC3B5xB,EAAMo7D,eAAe,GACrBp7D,EAAM8c,OACJ29C,EAAMzsC,QAAU,EACZhuB,EAAM4O,SAAW,EAAI6rD,EAAMzsC,SAC3BhuB,EAAM4O,SAAW,EAAI6rD,EAAMzsC,UAEjCysC,EAAMzsC,QAAU,IACf,OAKCzgB,KAAKsgD,IAAI//B,EAAMutC,QAAU9tD,KAAKsgD,IAAI,EAAI//B,EAAMqtC,SAC9CH,EAAUjtC,iBAEZ0sC,EAAMzsC,SAAWF,EAAMutC,OAClBX,EAAU1sC,UAGb0sC,EAAU1sC,SAAU,EACpBljB,OAAO+vD,uBAAsB,WAC3B76D,EAAM03D,iBAAiB+C,EAAMzsC,SAC7BysC,EAAMzsC,QAAU,EAChB0sC,EAAU1sC,SAAU,OAK5B,OAAI8sC,GACFA,EAAK3sC,iBAAiB,QAAS4sC,GACxB,WACLD,EAAK1sC,oBAAoB,QAAS2sC,KAG/B,eACN,CAAC/6D,IAGF,yBACE4wB,IAAKA,EACLpC,KAAK,eACLtZ,UAAWR,EAAQ8lD,gBACnBlsC,YApFJ,SAAmBR,GAEjB,IAAMuI,EAASvI,EAAMuI,OACjBA,EAAOsgC,WAAatgC,EAAOilC,QAAQC,SAKlB,IAAjBztC,EAAM0tC,SACR1tC,EAAMC,iBACN4sC,EAAM3sC,QAAUF,EAAMi2B,QACtBt2B,GAAiB,KA0EjBguC,UApEJ,SAAiB3tC,GACfA,EAAMC,iBACNN,GAAiB,IAmEfo9B,aAhEJ,SAAoB/8B,GAClBA,EAAMC,mBAiEJ,kBAAC,GAAD,CAAgB/tB,MAAOA,IACtBA,EAAM07D,eAAiB,kBAAC,GAAD,CAAY17D,MAAOA,IAAY,KAEvD,kBAAC,GAAD,CACEA,MAAOA,EACPovD,iBACE,kBAAC,GAAD,CACEpvD,MAAOA,EACP8U,MAAO,CAAEgY,OAAQ6uC,GAAkBpnD,UAAW,kBAIpD,yBAAKW,UAAWR,EAAQ0/C,SACvBz/C,MC/KD7B,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC4oD,oBAAqB,CACnB1oD,QAASF,EAAMG,QAAQ,IAEzB0oD,gBAAiB,CACfhoD,SAAU,SA6FCioD,GAzFI3yD,oBAAS,YAAiD,IAA9CnJ,EAA8C,EAA9CA,MACvB0U,EAAU5B,KAD2D,EAErBya,mBAAS,GAFY,mBAEpEwuC,EAFoE,KAE/CC,EAF+C,OAG/BzuC,qBAH+B,mBAGpE0uC,EAHoE,KAGpDC,EAHoD,OAIhC/5C,sBAAWniB,GAA9CkmB,EAJmE,EAInEA,cAAeu0B,EAJoD,EAIpDA,gBACjBz1C,EAASkhB,EAAcpiB,OAAsC,GAA7B,2BAChCtD,EAAe0lB,EAAc61C,GAC7BhrD,EAAcvQ,IAAiBwE,EAAQ+2D,EAAsB,GA2BnE,OA1BAnuC,qBAAU,WACR,IAAIuuC,GAAO,EAQX,OAPC,sBAAC,4BAAAv6D,EAAA,sEACuB64C,EAAgB2hB,gBAAgB57D,GADvD,OACM6mD,EADN,QAGK8U,GAAQ9U,GAAYA,EAASx9C,SAChCqyD,EAAkBtzD,sBAAYy+C,EAASx9C,QAAQ,KAJjD,0CAAD,GAOM,WACLsyD,GAAO,KAER,CAAC1hB,EAAiBj6C,IAenB,kBAAC,IAAD,CAAW0U,UAAWR,EAAQknD,qBAC5B,kBAAC,KAAD,CAAM9hC,WAAS,EAAC3mB,QAAS,EAAGkpD,QAAQ,SAAStiC,WAAW,UACtD,kBAAC,KAAD,CAAMC,MAAI,GACR,kBAAC,KAAD,CACEsiC,QAAM,EACNnnD,QAAQ,WACR3C,MAAOzB,EACPqlB,SApBV,SACEtI,GAEAkuC,EAAuBna,OAAO/zB,EAAMuI,OAAO7jB,SAkBnChR,MAAM,WACN0rD,WAAYloD,GAAS,0BACrBA,QAASA,EACTyrB,WAAYzrB,EACZqkB,OAAO,SACPnU,UAAWR,EAAQmnD,iBAElB31C,EAAclc,KAAI,SAAC5F,EAAM6X,GAAP,OACjB,kBAAC,KAAD,CAAUtG,IAAKvR,EAAMoO,MAAOyJ,GACzB7X,QAKT,kBAAC,KAAD,CAAM41B,MAAI,GACR,kBAAC,GAAD,CACEh6B,MAAOA,EACPQ,aACEwE,OAAQpC,EAAYsjB,EAAc61C,GAEpCtP,SAAUyP,EACV1pD,MAAOypD,GAAkBA,EAAe/8D,QACxCwtD,eAAgB,CACdrjC,OAAQ,SACRlU,QAAS,WACT3T,MAAO,WACP0T,UAAWR,EAAQmnD,gBACnB3O,WAAY,8BAIlB,kBAAC,KAAD,CAAMlzB,MAAI,GACR,kBAAC,IAAD,CACEvJ,UAAWwrC,EACXr2C,QAjDV,WACMq2C,GACFj8D,EAAMqb,oBAAoB,CAAC4gD,KAgDrB9mD,QAAQ,YACR9B,MAAM,WAJR,c,qBClCKkpD,GAtDMpzD,oBAAS,SAACyG,GAA4C,IACjE5P,EAAU4P,EAAV5P,MACA4O,EAAiD5O,EAAjD4O,QAASglD,EAAwC5zD,EAAxC4zD,WAAYC,EAA4B7zD,EAA5B6zD,WAAYC,EAAgB9zD,EAAhB8zD,YAFgC,EAGzCvmC,qBAHyC,mBAGlEkE,EAHkE,KAGxDsG,EAHwD,KAKzE,OACE,oCACE,kBAAC9gB,GAAA,EAAD,CAAOnC,MAAO,CAAEvB,WAAY,UAC1B,kBAAC,KAAD,CACEF,MAAM,YACNuS,QAAS,SAAAkI,GACPiK,EAAYjK,EAAMkF,iBAGpB,kBAAC,KAAD,OAGF,kBAAC,KAAD,CACE7C,cAAY,WACZvK,QAAS,WACP5lB,EAAMg0D,KAAe,EAAVplD,IAEb6hB,SAAU7hB,GAAWglD,EAAa,MAA0B,IAAhBE,EAC5CzgD,MAAM,aAEN,kBAAC,KAAD,OAEF,kBAAC,KAAD,CACE8c,cAAY,UACZvK,QAAS,WACP5lB,EAAMg0D,KAAKh0D,EAAM4O,QAAU,IAE7B6hB,SAAU7hB,GAAWilD,EAAa,MAA0B,IAAhBC,EAC5CzgD,MAAM,aAEN,kBAAC,KAAD,QAGJ,kBAAC,GAAD,CACEoe,SAAUA,EACVvC,KAAMe,QAAQwB,GACdF,gBAAiB,SAACvoB,EAAGnG,GACnBA,IACAk1B,OAAYn1B,IAEd4uB,QAAS,WACPuG,OAAYn1B,IAEd4gB,UAAWxjB,EAAMwjB,gBCtCZ1Q,GAAYC,cAAW,SAAAC,GAAK,MAAK,CAC5CC,sBAAuB,CACrB5C,QAAS,QACT6C,QAASF,EAAMG,QAAQ,IAEzBC,WAAY,CACVC,MAAO,WAETK,MAAO,CACLrD,QAAS,QAEXsD,UAAW,CACTC,UAAW,YACXC,SAAU,IACVC,SAAU,IACVC,aAAc,kBACdC,gBAAiBhB,EAAMQ,QAAQC,KAAK,KACpCQ,YAAajB,EAAMG,QAAQ,GAC3BD,QAASF,EAAMG,QAAQ,KAEzBe,WAAY,CACVN,UAAW,aACXO,UAAW,IACXjB,QAASF,EAAMG,QAAQ,IACvBiB,SAAU,QAEZC,cAAe,CACbT,UAAW,aACXO,UAAW,IACXjB,QAASF,EAAMG,QAAQ,IACvBa,gBAAiBhB,EAAMQ,QAAQC,KAAK,KACpCa,OAAQ,aAAF,OAAetB,EAAMQ,QAAQC,KAAK,MACxCc,UAAW,aACXH,SAAU,YAQDK,GAAmD,SAAA7E,GAC9D,IAAM8E,EAAU5B,KACR6B,EAAoB/E,EAApB+E,SAAUC,EAAUhF,EAAVgF,MAClB,OACE,kBAACC,GAAA,EAAD,CAAWC,MAAO,CAAEC,UAAW,OAASC,iBAAe,GACrD,kBAACC,GAAA,EAAD,CACE7B,WAAY,kBAAC,KAAD,CAAY8B,UAAWR,EAAQtB,cAE3C,kBAAC,KAAD,CAAY+B,QAAQ,UAApB,IAA+BP,IAEjC,kBAACQ,GAAA,EAAD,CAAkBF,UAAWR,EAAQzB,uBAClC0B,KAMHmB,GAAO,CAAC,WAAY,YASbC,GAAsD,SAAtDA,EAAsDnG,GACjE,IAAM8E,EAAU5B,KAEdkD,EASEpG,EATFoG,WAHwE,EAYtEpG,EARF4sD,eAJwE,MAI9D,GAJ8D,IAYtE5sD,EAPFkG,KAAMG,OALkE,MAKvD,GALuD,IAYtErG,EANFsG,iBANwE,MAM5D,SAAC1D,GAAD,OACV,kBAACH,GAAD,CACEE,KAAM4D,KAAS3D,GAAS4D,KAAKC,UAAU7D,GAAS7K,OAAO6K,MARa,EAWxE8D,EACE1G,EADF0G,aAUImmD,EAPiB36D,OAAOmiC,OAAOjuB,GAClCW,QAAO,SAAAD,GAAG,YAAY9T,IAAR8T,KACd1M,KAAI,SAAA0M,GACH,OAAOA,EAAIvE,OAEZwE,QAAO,SAAAD,GAAG,QAAMA,KAECwB,QAAO,SAACwkD,EAAOC,GAGjC,OAFKD,EAAMC,GACND,EAAMC,KADQD,EAAMC,GAAS,EAE3BD,IACN,IACGE,EAAS96D,OAAOiE,QAAQ02D,GAC3B9lD,QAAO,YAAgB,4BACtB,OADsB,KACP,MAEhB3M,KAAI,SAAA2yD,GAAK,OAAIA,EAAM,MA9BoD,EA+BtCpvC,mBAASqvC,GA/B6B,mBA+BnEC,EA/BmE,KA+BvDC,EA/BuD,KAiCpEvmD,EAAc,SAAC,GAAkD,IAAhDnS,EAAgD,EAAhDA,KAAMoO,EAA0C,EAA1CA,MACrBxB,EAAcsF,GAAgBA,EAAalS,GACjD,OACE,yBAAK0Q,MAAO,CAAEzE,QAAS,SACpBW,EACC,kBAAC,KAAD,CAAS4D,MAAO5D,EAAawF,UAAU,QACrC,yBAAKtB,UAAWR,EAAQf,WAAYvP,IAGtC,yBAAK8Q,UAAWR,EAAQf,WAAYvP,GAEtC,yBAAK8Q,UAAWR,EAAQR,YAAagC,EAAU1D,MAI/CiE,EAAa,SAAC,GAAoD,IAAlDrS,EAAkD,EAAlDA,KAAMoO,EAA4C,EAA5CA,MACpBxB,EAAcsF,GAAgBA,EAAalS,GAEjD,OACE,yBAAK0Q,MAAO,CAAEzE,QAAS,SACpBW,EACC,kBAAC,KAAD,CAAS4D,MAAO5D,EAAawF,UAAU,QACrC,yBAAKtB,UAAWR,EAAQf,WAAYvP,IAGtC,yBAAK8Q,UAAWR,EAAQf,WAAYvP,GAErCoO,EAAMxI,KAAI,SAAC0M,EAAKhT,GAAN,OACT,yBAAKiS,IAAG,UAAKvR,EAAL,YAAaV,GAAKwR,UAAWR,EAAQL,eAC1C6B,EAAUQ,SAOrB,OACE,oCACG5U,OAAOiE,QAAQiQ,GACbW,QACC,mCAAE3Q,EAAF,iBACQpD,IADR,OACsBkT,GAAK3L,SAASnE,KAAOiQ,EAAS9L,SAASnE,MAG9DgE,KAAI,WAAe+R,GAAU,uBAAvBpG,EAAuB,KAAlBnD,EAAkB,KAC5B,OAAIA,EAAML,KAAOK,EAAM9J,KACdm0D,EAAW1yD,SAASqI,EAAML,KAAO,KACtC,kBAACoE,EAAD,CACEZ,IAAG,UAAKnD,EAAML,IAAX,YAAkB4J,GACrB3X,KAAMoO,EAAML,IACZK,MAAOA,EAAM9J,OAIf9E,MAAMC,QAAQ2O,GACQ,IAAjBA,EAAM1O,OACX,kBAACyS,EAAD,CACEZ,IAAKA,EACLvR,KAAI,UAAKo4D,EAAU,GAAH,OAAMA,EAAN,KAAmB,IAA/B,OAAoC7mD,GACxCnD,MAAOA,EAAM,KAGf,kBAACiE,EAAD,CACEd,IAAKA,EACLvR,KAAI,UAAKo4D,EAAU,GAAH,OAAMA,EAAN,KAAmB,IAA/B,OAAoC7mD,GACxCnD,MAAOA,IAIT2D,KAAS3D,GAET,kBAACuD,EAAD,CACEJ,IAAKA,EACLK,WAAYxD,EACZ8D,aAAcA,EACdkmD,QAAO,UAAKA,EAAU,GAAH,OAAMA,EAAN,KAAmB,IAA/B,OAAoC7mD,KAM/C,kBAACY,EAAD,CACEZ,IAAKA,EACLvR,KAAI,UAAKo4D,EAAU,GAAH,OAAMA,EAAN,KAAmB,IAA/B,OAAoC7mD,GACxCnD,MAAOA,OAIdoqD,EAAO94D,OACN,oCACG+4D,EAAW/4D,OACV,oCACE,kBAAC,KAAD,CAAYuP,MAAM,iBAAlB,0CACsCwpD,EADtC,oCAGA,kBAAC,IAAD,CACE1nD,QAAQ,YACR9B,MAAM,UACNuS,QAAS,kBAAMk3C,EAAc,MAH/B,eAKWD,KAIb,kBAAC,IAAD,CACExpD,MAAM,UACN8B,QAAQ,YACRyQ,QAAS,kBAAMk3C,EAAcF,KAH/B,eAIUA,KAGZ,OAOK,SAASG,GAAT,GAMZ,IALD/8D,EAKC,EALDA,MACAw0B,EAIC,EAJDA,YAIC,EACuBjH,qBADvB,mBACMyvC,EADN,KACYC,EADZ,OAEyB1vC,qBAFzB,mBAEMvoB,EAFN,KAEa0d,EAFb,KAGKle,EAAO6d,kBAAQriB,GACfsjB,EAAUnB,sBAAWniB,GACnBkkC,EAAe5gB,EAAf4gB,WACFE,EAAYrlB,GAAgB/e,GAElC4tB,qBAAU,WACR,IAAMsvC,EAAU,IAAIxrD,gBACZxK,EAAWg2D,EAAXh2D,OAcR,OAbC,sBAAC,8BAAAtF,EAAA,sEAEQyhB,EAAgBhB,kBAAQriB,EAAO,WAFvC,SAGuBkkC,EAAWnhC,KAAKqhC,EAAW,cAAe,CAC7D/gB,gBACAnc,WALJ,OAGQu8B,EAHR,OAOEw5B,EAAQx5B,GAPV,gDASE/gB,EAAS,EAAD,IATV,wDAAD,GAaM,WACLw6C,EAAQpW,WAET,CAAC9mD,EAAOkkC,EAAYE,IAEvB,IAAIziB,EAAYU,kBAAQriB,EAAO,QAS/B,MAR+B,2BAA3BqiB,kBAAQriB,EAAO,UACjB2hB,EAAY,qBACZ2B,EAAQq8B,WAAW1wC,SAAQ,SAAAo4C,GACrBA,EAASqP,WAAa12D,EAAM2e,gBAC9BgD,EAAY,uBAAH,OAA0BtT,yBAAeg5C,EAAU,QAAnD,UAKb,kBAAC9nB,GAAA,EAAD,CACErQ,MAAI,EACJsC,QAASgD,EACT2oC,kBAAgB,qBAChBC,mBAAiB,4BAEjB,kBAAC59B,GAAA,EAAD,CAAa1/B,GAAG,sBAAsB6hB,GACtC,kBAAC8d,GAAA,EAAD,KACE,kBAAC,GAAD,CAAU7qB,MAAM,iBACd,kBAAC,GAAD,CAAYoB,WAAYxR,KAEhB,OAATw4D,EACC,kBAAC,GAAD,CAAUpoD,MAAM,aACb5P,EACC,kBAAC,KAAD,CAAYqO,MAAM,SAAlB,UAA8BrO,SACnBpC,IAATo6D,EACF,uBAEA,kBAAC,GAAD,CAAYhnD,WAAYgnD,KAG1B,OCzRZ,IAAMlqD,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC+yC,aAAc,CACZ/oB,UAAW,SACX5R,WAAYpY,EAAMG,QAAQ,GAC1BkY,cAAerY,EAAMG,QAAQ,IAE/BihD,OAAQ,CACNngD,YAAajB,EAAMG,QAAQ,QAmEhBkqD,GA/DUl0D,oBAAS,SAACyG,GAA0B,IACnD5P,EAAU4P,EAAV5P,MACA+d,EAA2C/d,EAA3C+d,OAAQ/Y,EAAmChF,EAAnCgF,MAAOs4D,EAA4Bt9D,EAA5Bs9D,WAAYrV,EAAgBjoD,EAAhBioD,YAC7BvzC,EAAU5B,KAKVyqD,EAAav9D,EAAM+d,OAAOlX,MAAK,SAAAqiC,GAAC,OAAIA,EAAEhmB,aAI5C,OAAQ+kC,EAGN,yBAAKnzC,MAAO,CAAE7H,SAAU,aACrBswD,EACC,kBAACR,GAAD,CAAa/8D,MAAOu9D,EAAY/oC,YARlB,WAClB+oC,EAAWp6C,cAAa,MAQlB,KACFm6C,EAGA,yBACExoD,MAAO,CACL7H,SAAU,WACVsjB,MAAO,EACP3B,OAAQ,OAGV,kBAAC,GAAD,CAAc5uB,MAAOA,KATvB,kBAAC,GAAD,CAAQA,MAAOA,IAYhBgF,EACC,kBAACiS,GAAA,EAAD,CAAO9B,QAAQ,WAAWD,UAAWR,EAAQqxC,cAC3C,kBAAC,KAAD,CAAY1yC,MAAM,SAASrO,EAAM8xB,UAGnC,oCACE,kBAAC,GAAD,CAAiB92B,MAAOA,GACpB+d,EAAOja,OAaPia,EAAO/T,KAAI,SAAAyU,GAAK,OACd,kBAAC,GAAD,CAAgB9I,IAAK8I,EAAM3e,GAAIE,MAAOA,EAAOye,MAAOA,OAbtD,kBAACxH,GAAA,EAAD,CAAO9B,QAAQ,WAAWD,UAAWR,EAAQqxC,cAC3C,kBAAC,KAAD,0BACA,kBAAC,IAAD,CACE5wC,QAAQ,YACR9B,MAAM,UACNuS,QAAS5lB,EAAM00D,uBAEf,kBAACrJ,GAAD,CAAmBn2C,UAAWR,EAAQ0/C,SALxC,2BA7BZ,kBAAC,GAAD,CAAYp0D,MAAOA,OCIvB,SAASw9D,GAA2BnlD,GAClC,IAAKA,EAAcvU,OACjB,MAAO,GAET,IAAM25D,EAAuBplD,EAAcqlD,OACzC,SAAA9lD,GAAK,OAAIA,EAAMpX,eAAiB6X,EAAc,GAAG7X,gBAUnD,OARa6X,EAAcrO,KAAI,SAAA4N,GAAK,OAClCqC,6BAAkB,2BACbrC,GADY,IAEfvY,MAAOkO,KAAK2O,MAAMtE,EAAMvY,OACxBE,IAAKgO,KAAK2O,MAAMtE,EAAMrY,KACtBiB,aAAci9D,OAAuB76D,EAAYgV,EAAMpX,mBAG/C4R,KAAK,KAUZ,IAAMy/C,GAAoB,GACpBpB,GAAyB,GACzBkL,GAAmB,GACnBxE,GAAuB,EAG7B,SAASjM,GAAkBr5C,GAChC,IAAM7R,EAAQvB,QACXuB,MAAM,mBAAoB,CACzBF,GAAItB,aACJmR,KAAMlR,QAAMqkB,QAAQ,oBACpB3K,SAAU,EACVvJ,QAAS,EACTiK,iBAAkBpa,QAAMwc,MAAM0iD,WAG9B5/C,OAAQtf,QAAMwc,MACZpJ,EAAcoR,iBAAiB,QAAS,eAE1Cq6C,YAAY,EACZvH,oBAAoB,EACpB6H,kBAAmBn/D,QAAMC,SACvBD,QAAMo/D,YAAY,CAAC,iBACnB,gBAEF3F,YAAa,cACbwD,gBAAgB,IAEjBxgD,UAAS,iBAAO,CACfE,mBAAexY,EACfmW,kBAAmB,GACnB4+C,qBAAiB/0D,EACjBoC,WAAOpC,EAIPk7D,kCAAmC,GACnChK,YAAa,EAEb+D,UAAW,GACXpC,oBAAqB,GACrBO,cAAe,MAEhBv6C,OAAM,SAAArb,GAAI,MAAK,CACd,YACE,QAA2BwC,IAAvBxC,EAAKgb,cACP,MAAM,IAAItV,MACR,6DAGJ,OAAO1F,EAAKgb,mBAGfK,OAAM,SAAArb,GAAI,MAAK,CACd,kBAAkB,IACRq6C,EAAoBt4B,sBAAW/hB,GAA/Bq6C,gBAMFsjB,EAAwBl1D,KAAKqd,cAAcw3C,OAAM,SAAAl9D,GACrD,OACEi6C,EAAgBujB,aACbh0D,KAAI,SAACi0D,GAAD,OAA2BA,EAAI75D,QACnC+F,SAAS3J,KAEJi6C,EAAgB76C,IAAIY,IAAiB,IAAIynD,eAKrD,YACyBrlD,IAAvBxC,EAAKgb,eACLhb,EAAKyY,iBAAiB/U,OAAS,GAC/Bi6D,GAGJ,qBACE,OAAOpC,GAAmBxE,IAE5B,mBACE,OAAI/2D,EAAKk9D,WACA,EAELl9D,EAAK21D,mBACAlE,GAEFA,GAAoBpB,IAE7B,mBACE,OAAOrwD,EAAK2d,OACT/T,KAAI,SAAAk/B,GAAC,OAAIA,EAAElmB,SAAS,GAAG8J,UACvB5U,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,IAE7B,oCACE,OAAOgH,KAAKyxD,aAAel6D,EAAK2d,OAAOja,OAASqzD,IAElD,aACE,OACEtuD,KAAKq1D,8BACLr1D,KAAKs1D,aACLt1D,KAAKu1D,gBAGT,8BACE,OAtGkC,GAwGpC,cACE,IAAIC,EAAU,EAId,OAHAj+D,EAAKyY,iBAAiB5J,SAAQ,SAAAhG,GAC5Bo1D,GAAWp1D,EAAO1J,IAAM0J,EAAO5J,SAE1Bg/D,GAGT,iBACE,OAAOx1D,KAAK6S,QAAU,KAGxB,iBACE,MAAO,KAGT,gBAGE,OAAO7S,KAAK8S,wBADQ,IAItB,6BACE,IAAM2iD,EAAe,GACb7jB,EAAoBt4B,sBAAW/hB,GAA/Bq6C,gBAgBR,OAfAr6C,EAAKyY,iBAAiB5J,SAAQ,YAA+B,IAA5B/P,EAA4B,EAA5BA,QAASsB,EAAmB,EAAnBA,aAClC6mD,EAAW5M,EAAgB76C,IAAIY,GAC/BiD,EAAI4jD,GAAaA,EAASx9C,QAChC,GAAIpG,EAAG,CACL,IAAM86D,EAAgB96D,EAAEoD,MACtB,SAAA6vD,GAAQ,OAAIA,EAASx3D,UAAYA,KAE7Bs/D,EAAgBF,EAAaz3D,MACjC,SAAA6vD,GAAQ,OAAIA,EAASx3D,UAAYA,KAE/Bq/D,IAAkBC,GACpBF,EAAahuD,KAAKiuD,OAIjBD,GAGT,mCACE,OAAOz1D,KAAK41D,uBACTz0D,KAAI,SAAApI,GAAC,OAAIA,EAAErC,IAAMqC,EAAEvC,SACnB6Y,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,IAE7B,gBAGE,OADqB,GACbzB,EAAK0Y,OAGf,8BACE,OAAOjQ,KAAK6S,QAAUtb,EAAKwO,SAG7B,kBACE,kCACKyQ,GAAqBjf,IAD1B,IAEEwO,QAASxO,EAAKwO,QACdotB,sBAAuB3Z,kBACrBF,sBAAW/hB,GACX,4BAIN,oBACE,mBACK,IAAIimB,IAAIjmB,EAAKyY,iBAAiB7O,KAAI,SAAAf,GAAM,OAAIA,EAAOzI,mBAG1DwZ,aAhIc,SAgIDxZ,EAAsBtB,GACjC,OAAO2J,KAAK41D,uBAAuB53D,MACjC,SAAAmT,GAAY,OACVA,EAAaxZ,eAAiBA,GAC9BwZ,EAAa9a,UAAYA,MAU/B0c,OA9Ic,YAsJX,IAPD1c,EAOC,EAPDA,QACA2c,EAMC,EANDA,MACAzC,EAKC,EALDA,aAMI0C,EAAW,EAETC,EAAQ3b,EAAKyY,iBAAiBmD,WAAU,SAACvY,EAAGwY,GAChD,OAAI/c,IAAYuE,EAAEvE,SAAW2c,GAASpY,EAAEpE,OAASwc,GAASpY,EAAElE,OACtD6Z,GAAeA,IAAiB6C,IAClCH,GAAYrY,EAAExD,SAAWwD,EAAElE,IAAMsc,EAAQA,EAAQpY,EAAEpE,OAC5C,IAGXyc,GAAYrY,EAAElE,IAAMkE,EAAEpE,OACf,MAGT,GADoBe,EAAKyY,iBAAiBkD,GAExC,MAAO,CACLA,QACA5D,SAAU5K,KAAK2O,MAAMJ,EAAW1b,EAAKwO,WAW3CuN,OAlLc,SAkLPC,GACL,IAAIC,EAAU,EACRC,GAAMlc,EAAK+X,SAAWiE,GAAMhc,EAAKwO,QACjC2N,EAAInc,EAAKyY,iBAAiB/U,OAChC,GAAIwY,EAAK,EAAG,CACV,IAAMrT,EAAS7I,EAAKyY,iBAAiB,GAC/B7L,EAASsP,EACf,kCACK1T,sBAAYK,IADjB,IAEEuT,KAAK,EACLX,MAAO5S,EAAOhJ,SACVsN,KAAKsN,MAAM5R,EAAO1J,IAAMyN,GAAU,EAClCO,KAAKsN,MAAM5R,EAAO5J,MAAQ2N,GAAU,EACxCA,SACA+O,MAAO,IAGX,GAAIO,GAAMzT,KAAK6S,QAAS,CACtB,IAAMzS,EAAS7I,EAAKyY,iBAAiB0D,EAAI,GACnCE,EAAMxT,EAAO1J,IAAM0J,EAAO5J,MAC1B2N,EAASsP,EAAKzT,KAAK6S,QAAUe,EACnC,kCACK7T,sBAAYK,IADjB,IAEEuT,KAAK,EACLxP,SACA6O,MAAO5S,EAAOhJ,SACVsN,KAAKsN,MAAM5R,EAAO1J,IAAMyN,GAAU,EAClCO,KAAKsN,MAAM5R,EAAO5J,MAAQ2N,GAAU,EACxC+O,MAAOQ,EAAI,IAGf,IAAK,IAAIR,EAAQ,EAAGA,EAAQ3b,EAAKyY,iBAAiB/U,OAAQiY,GAAS,EAAG,CACpE,IAAM9S,EAAS7I,EAAKyY,iBAAiBkD,GAC/BU,EAAMxT,EAAO1J,IAAM0J,EAAO5J,MAChC,GAAIod,EAAMJ,EAAUC,GAAMD,GAAWC,EAAI,CACvC,IAAMtP,EAASsP,EAAKD,EACpB,kCACKzT,sBAAYK,IADjB,IAEEuT,KAAK,EACLxP,SACA6O,MAAO5S,EAAOhJ,SACVsN,KAAKsN,MAAM5R,EAAO1J,IAAMyN,GAAU,EAClCO,KAAKsN,MAAM5R,EAAO5J,MAAQ2N,GAAU,EACxC+O,UAGJM,GAAWI,EAEb,MAAM,IAAI3W,MAAM,qCAElB44D,SApOc,SAoOL5+D,GACP,OAAOM,EAAK2d,OAAOlX,MAAK,SAAAqiC,GAAC,OAAIA,EAAEvqB,cAAcoD,UAAYjiB,MAI3D6+D,gBAzOc,SAyOEnuD,EAAmBiT,GAA6B,WAC9DA,EAAgBxU,SAAQ,SAACmlB,GAKvB,GAHI,YAAaA,GACf,EAAKuqC,gBAAgBnuD,EAAW4jB,EAAOT,SAErC,YAAaS,EAAQ,CACvB,IAAMwqC,EAAcxqC,EAAOxO,QAC3BwO,EAAOxO,QAAU,WAAwB,2BAApBpd,EAAoB,yBAApBA,EAAoB,gBACvCpI,EAAK2d,OAAO9O,SAAQ,SAAAwP,GACdA,EAAM9O,OAASa,GACjBouD,EAAYh3C,MAAMnJ,EAAlB,CAA0BA,GAA1B,OAAoCjW,aAQhD,uBAAuB,WACfq2D,EAAsC,IAAIvtD,IAUhD,OATAlR,EAAK2d,OAAO9O,SAAQ,SAAAwP,GAElB,IADmBogD,EAAWj/D,IAAI6e,EAAM9O,MACvB,CACf,IAAM8T,EAAkBzgB,KAAMyb,EAAMgF,iBACpC,EAAKk7C,gBAAgBlgD,EAAM9O,KAAM8T,GACjCo7C,EAAWltD,IAAI8M,EAAM9O,KAAM8T,OAIxBo7C,GAGT,qBAIE,OAHuBz+D,EAAKyY,iBAAiB/U,OACzC+E,KAAKsT,OAAO/b,EAAK0Y,MAAQ,QACzBlW,OAIPzC,SAAQ,SAAAC,GAAI,MAAK,CAChBke,SADgB,SACPC,GACPne,EAAKgb,cAAgBmD,GAGvBmE,SALgB,SAKP1d,GACP5E,EAAK4E,MAAQA,GAGf85D,aATgB,WAUd1+D,EAAKk9D,YAAcl9D,EAAKk9D,YAG1ByB,qBAbgB,WAcd3+D,EAAK21D,oBAAsB31D,EAAK21D,oBAGlCiJ,SAjBgB,SAiBP7mD,GACP,IAAMuF,EAAcN,iBAAMjF,EAAU/X,EAAKid,UAAWjd,EAAKkd,WAEzD,OADAld,EAAK+X,SAAWuF,EACTA,GAGTZ,OAvBgB,SAuBTlO,GACL,IAAMsO,EAAaE,iBAAMxO,EAASxO,EAAKyzD,WAAYzzD,EAAKwzD,YACxD,GAAI12C,IAAe9c,EAAKwO,QACtB,OAAOsO,EAET,IAAMC,EAAa/c,EAAKwO,QAGxB,GAFAxO,EAAKwO,QAAUsO,EAEX3P,KAAKsgD,IAAI1wC,EAAaD,GAAc,KAEtC,OADAnY,QAAQ4H,KAAK,iCACNwQ,EAIT,IAAM8hD,EAAY7+D,EAAK0Y,MAOvB,OANAjQ,KAAKm2D,SACHzxD,KAAK2O,OACD9b,EAAK+X,SAAW8mD,EAAY,GAAK9hD,EAAcD,EAC/C+hD,EAAY,IAGX/hD,GAGTgiD,WA/CgB,SA+CLtwD,EAAiBuJ,GAC1BtP,KAAKiU,OAAOlO,GACZ/F,KAAKm2D,SAAS7mD,IAGhBgnD,iBApDgB,WAqDd/+D,EAAKyY,iBAAmByC,eACtBlb,EAAKyY,iBACF9P,QACAq2D,UACAp1D,KAAI,SAAAf,GAAM,kCAAUA,GAAV,IAAkBhJ,UAAWgJ,EAAOhJ,eAEnD4I,KAAKm2D,SAAS5+D,EAAKsb,QAAUtb,EAAKwO,QAAUxO,EAAK+X,SAAW/X,EAAK0Y,QAGnEoL,UA9DgB,SA8DNnC,GAAuC,IAAtBsC,EAAsB,uDAAJ,GACrCg7C,EAAoBxtD,EAAc0S,0BACtC,SAEI5F,EAAgB6F,4BACpB66C,EACA56C,kBAAQrkB,GACR2hB,GAEIvR,EAAYqB,EAAc0U,aAAa5H,EAAchP,MAC3D,IAAKa,EACH,MAAM,IAAI1K,MAAJ,6BAAgC6Y,EAAchP,OAEtD,IAAMc,EAAWoB,EAAc2T,YAAYplB,EAAKuP,MAC1C2vD,EAAoB7uD,EAASL,aAAapG,KAC9C,SAAA0a,GAAW,OAAIA,EAAYtgB,QAEvBshB,EAAc/G,EAAcqE,SAASnc,MACzC,SAACge,GAAD,OAA8By6C,EAAkBn1D,SAAS0a,EAAElV,SAE7D,IAAK+V,EACH,MAAM,IAAI5f,MAAJ,4DACiD1F,EAAKuP,OAG9D,IAAM8O,EAAQjO,EAAUL,WAAW3F,OAArB,2BACT6Z,GADS,IAEZ1U,KAAMgP,EAAchP,KACpBgP,gBACAqE,SAAU,CAAC,CAAErT,KAAM+V,EAAY/V,KAAMgP,cAAe+G,OAEtDtlB,EAAK2d,OAAOzN,KAAKmO,IAGnBwF,UAhGgB,SAgGNlC,GACR,IAAMs9C,EAAoBxtD,EAAc0S,0BACtC,SAEI5F,EAAgB6F,4BACpB66C,EACA56C,kBAAQrkB,GACR2hB,GAGIw9C,EAAcn/D,EAAK2d,OAAOpH,QAC9B,SAAAuyB,GAAC,OAAIA,EAAEvqB,gBAAkBA,KAG3B,OADAmG,uBAAY,kBAAMy6C,EAAYtwD,SAAQ,SAAAi6B,GAAC,OAAI9oC,EAAK2d,OAAOgH,OAAOmkB,SACvDq2B,EAAYz7D,YAGtB3D,SAAQ,SAAAC,GAAI,MAAK,CAChBw3D,UADgB,SACN4H,EAAuBC,GAC/B,IAAMC,EAAWt/D,EAAK2d,OAAO/B,WAC3B,SAAAyC,GAAK,OAAIA,EAAM3e,KAAO0/D,KAExB,IAAkB,IAAdE,EACF,MAAM,IAAI55D,MAAJ,mBAAsB05D,EAAtB,eACR,IAAMG,EAAWv/D,EAAK2d,OAAO/B,WAC3B,SAAAyC,GAAK,OAAIA,EAAM3e,KAAO2/D,KAExB,IAAkB,IAAdE,EACF,MAAM,IAAI75D,MAAJ,mBAAsB25D,EAAtB,eACR,IAAMhhD,EAAQ7V,sBAAYxI,EAAK2d,OAAO2hD,IACtCt/D,EAAK2d,OAAOqH,OAAOs6C,EAAU,GAC7Bt/D,EAAK2d,OAAOqH,OAAOu6C,EAAU,EAAGlhD,IAGlCmhD,UAjBgB,WAkBd,IAAM/gD,EAASkF,6BAAkB3jB,GAC7Bye,EAEEghD,2BAAgBhhD,IAASA,EAAOihD,WAAW1/D,GAG/C+hB,sBAAW/hB,GAAM0/D,WAAW1/D,IAIhC2/D,YA5BgB,SA4BJh+C,GAEU3hB,EAAK6jB,UAAUlC,IAGjC3hB,EAAK8jB,UAAUnC,IAInBi+C,eArCgB,SAqCDC,GACb7/D,EAAK83D,YAAc+H,GAGrBC,iBAzCgB,WA0Cd9/D,EAAKs7D,gBAAkBt7D,EAAKs7D,gBAG9BrgD,oBA7CgB,SA6CIxR,GAClBzJ,EAAKyY,iBAAmByC,eAAKzR,GAC7BzJ,EAAK0c,OAAO1c,EAAKwO,UAGnB8lD,sBAlDgB,WAmDd,GAA+B,iBAA3Bt0D,EAAKw9D,kBAAsC,CAC7C,IAAMt6C,EAAUnB,sBAAW/hB,GAC3B,GAAIypD,qCAA0BvmC,GAAU,CACtC,IAAM68C,EAAW78C,EAAQymC,UACvB,kCACA,4BACA,CAAEjmC,KAAM1jB,IAGV,OADAkjB,EAAQ0mC,WAAWmW,GACZA,GAGX,MAAM,IAAIr6D,MAAJ,sCAAyC1F,EAAKw9D,qBAGtD3I,eAlEgB,SAkEDD,GAAmB,IACxBva,EAAoBt4B,sBAAW/hB,GAA/Bq6C,gBACA2lB,EAAmB3lB,EAAnB2lB,eACFC,EAAarL,EAAUnV,MAAM,KACnC,GAAIz/C,EAAKyY,iBAAiB/U,OAAS,EAAnC,CACE,IAAMw8D,EAAYD,EAAWr2D,KAAI,SAAAu2D,GAAE,OACjCC,0BAAeD,EAAIH,MAErBv3D,KAAK43D,cAAcH,OAJrB,CAOA,IAAMI,EAAkBtgE,EAAKyY,iBAAiB,GACtCrY,EAAiBkgE,EAAjBlgE,aACJ6mD,EAAW5M,EAAgB76C,IAAIY,GACnC,IAAK6mD,EACH,MAAM,IAAIvhD,MAAJ,kCACuB46D,EAAgBlgE,eAhBf,IAmBxBqJ,EAAYw9C,EAAZx9C,QACR,IAAKA,EACH,MAAM,IAAI/D,MAAJ,+BACoB46D,EAAgBlgE,aADpC,oBAUR,GANsBqJ,EAAQhD,MAC5B,SAAAoC,GAAM,OACJA,EAAO/J,UAAYwhE,EAAgBxhE,SACnC+J,EAAO5J,QAAUqhE,EAAgBrhE,OACjC4J,EAAO1J,MAAQmhE,EAAgBnhE,OAEhB,CACjB,GAAI8gE,EAAWv8D,OAAS,EACtB,MAAM,IAAIgC,MACR,mFAGJ,IAAM66D,EAAkBH,0BAAeH,EAAW,IAAI,SAAAnhE,GAAO,OAC3DkhE,EAAelhE,EAASsB,MAEtBogE,GAAkB,EACtB,GACED,EAAgBngE,cAChBmgE,EAAgBngE,eAAiBkgE,EAAgBlgE,aACjD,CACA,IAAMqgE,EAAcpmB,EAAgB76C,IAClC+gE,EAAgBngE,cAElB,IAAKqgE,EACH,MAAM,IAAI/6D,MAAJ,kCACuB66D,EAAgBngE,eAG/C6mD,EAAWwZ,EACXD,GAAkB,EAEpB,IAAME,EAAmBzZ,EAAS0Z,oBAChCJ,EAAgBzhE,SAElB,IAAK4hE,EACH,MAAM,IAAIh7D,MAAJ,iCACsB66D,EAAgBzhE,QADtC,eACoDmoD,EAASjjD,OAGrE,GAAIw8D,GAAmBE,IAAqBJ,EAAgBxhE,QAAS,CACnE,IAAM8hE,EAAqBn3D,EAAQhD,MACjC,SAAAoC,GAAM,OAAIA,EAAO/J,UAAY4hE,KAE/B,IAAIE,EAGF,MAAM,IAAIl7D,MAAJ,iCACsB66D,EAAgBzhE,QADtC,eACoDmoD,EAASjjD,OAHnEyE,KAAKwS,oBAAoB,CAACzS,sBAAYo4D,KAO1Cn4D,KAAKssD,MAAMwL,MAefxL,MA7JgB,SA6JV8L,GACJp4D,KAAK43D,cAAc,CAACQ,KAGtBR,cAjKgB,SAiKFH,GACZ,IAAMY,EAAgBZ,EAAU,GAC1BphE,EAAYgiE,EAAZhiE,QAEJG,EAGE6hE,EAHF7hE,MACAE,EAEE2hE,EAFF3hE,IALoC,EAOlC2hE,EADF1gE,oBANoC,MAMrBJ,EAAK8lB,cAAc,GANE,EAStC,QAActjB,IAAVvD,QAA+BuD,IAARrD,GAAqBF,EAAQE,EACtD,MAAM,IAAIuG,MAAJ,iBAAoBzG,EAAQ,EAA5B,kCAAuDE,EAAvD,MAER,IAEM8nD,EAFUllC,sBAAW/hB,GACnBq6C,gBACyB76C,IAAIY,GACrC,GAAI6mD,EAAU,CACZ,IAAMyZ,EAAmBzZ,EAAS0Z,oBAAoB7hE,GAClD4hE,IACF5hE,EAAU4hE,GA2Bd,IAxBA,IAuBI/kD,EAvBA1X,EAAIhF,EACJyF,EAAIvF,EACJ4hE,GAAiB,EAEfC,EAAY,SAAC39D,GACjB,GAAIvE,IAAYuE,EAAEvE,QAAS,CAQzB,GAPAiiE,GAAiB,OACPv+D,IAANyB,IACFA,EAAIZ,EAAEpE,YAEEuD,IAANkC,IACFA,EAAIrB,EAAElE,KAEJ8E,GAAKZ,EAAEpE,OAASgF,GAAKZ,EAAElE,KAAOuF,GAAKrB,EAAElE,KAAOuF,GAAKrB,EAAEpE,MACrD,OAAO,EAETgF,EAAIhF,EACJyF,EAAIvF,EAEN,OAAO,GAGH8hE,EAAY/tC,yBAAclzB,EAAKyY,iBAAkBuoD,GAEhDrlD,IAAUslD,GACf,IACE,IAAMC,EAAoCvlD,EAO1C,GANAA,EAAQ3b,EAAKyY,iBACV9P,WAAwBnG,IAAlB0+D,EAA8B,EAAIA,EAAgB,GACxDtlD,UAAUolD,QACSx+D,IAAlB0+D,IACFvlD,GAASulD,EAAgB,IAEtBH,EACH,MAAM,IAAIr7D,MAAJ,gDACqC5G,EADrC,MAIR,QAAU0D,IAANyB,EACF,MAAM,IAAIyB,MAAJ,gDACqC5G,EADrC,4CACgF4F,IAGxF,QAAUlC,IAANkC,EACF,MAAM,IAAIgB,MAAJ,gDACqC5G,EADrC,6CAEFmF,EAAI,IAIV,IAAe,IAAX0X,EACF,MAAM,IAAIjW,MAAJ,6DACkDmU,6BACpDinD,GAFE,MAMR,GAAyB,IAArBZ,EAAUx8D,OAAc,CAC1B,IAAM+jB,EAAIznB,EAAKyY,iBAAiBkD,GAKhC,YAJAlT,KAAKgU,OACH,CAAEd,QAAO/O,OAAQ6a,EAAE5nB,SAAW4nB,EAAEtoB,IAAMuF,EAAIT,EAAIwjB,EAAExoB,OAChD,CAAE0c,QAAO/O,OAAQ6a,EAAE5nB,SAAW4nB,EAAEtoB,IAAM8E,EAAIS,EAAI+iB,EAAExoB,QAOpD,IAHA,IAAIkiE,EAAgB,EAChBC,EAAgB,EAChBC,EAAc,EAGhBF,EAAgBjB,EAAUx8D,OAC1By9D,IACA,CACA,IAAM15D,EAAWy4D,EAAUiB,GACrBt4D,EAAS7I,EAAKyY,iBAAiBkD,EAAQwlD,GAG7C,GAFAC,EAAgB35D,EAASxI,OAAS4J,EAAO5J,MACzCoiE,EAAc55D,EAAStI,KAAO0J,EAAO1J,IACjCsI,EAAS3I,UAAY+J,EAAO/J,QAC9B,MAAM,IAAI4G,MAAJ,2BACgBmU,6BAClBpS,GAFE,2CAMR,GAAI05D,EAAgB,EAKlB,KAHoBt4D,EAAOhJ,SACvBwhE,IAAgBx4D,EAAO1J,IACvBiiE,IAAkBv4D,EAAO5J,OAE3B,MAAM,IAAIyG,MAAJ,UAEFmD,EAAOhJ,SAAW,MAAQ,QAFxB,sBAGUga,6BACZpS,GAJE,uBAKYoB,EAAOhJ,SACnBgJ,EAAO1J,IACP0J,EAAO5J,MAAQ,GACjB+zD,eAAe,SARb,oBAaV,KADemO,IAAkBjB,EAAUx8D,OAAS,GAMlD,KAHqBmF,EAAOhJ,SACxBuhE,IAAkBv4D,EAAO5J,MACzBoiE,IAAgBx4D,EAAO1J,KAEzB,MAAM,IAAIuG,MAAJ,UAEFmD,EAAOhJ,SAAW,QAAU,MAF1B,sBAGUga,6BACZpS,GAJE,uBAKYoB,EAAOhJ,SACnBgJ,EAAO5J,MAAQ,EACf4J,EAAO1J,KACT6zD,eAAe,SARb,oBAaZmO,GAAiB,EACjB,IAAMG,EAAuBthE,EAAKyY,iBAAiBkD,GAC7C4lD,EACJvhE,EAAKyY,iBAAiBkD,EAAQwlD,GAehC,YAdA14D,KAAKgU,OACH,CACEd,QACA/O,OAAQ00D,EAAqBzhE,SACzByhE,EAAqBniE,IAAMuF,EAC3BT,EAAIq9D,EAAqBriE,OAE/B,CACE0c,MAAOA,EAAQwlD,EACfv0D,OAAQ20D,EAAmB1hE,SACvB0hE,EAAmBpiE,IAAMiiE,EACzBC,EAAcE,EAAmBtiE,QAIzC,MAAO2F,GACP,GAAI+W,IAAUslD,EACZ,MAAMr8D,IAedkrD,uBApVgB,SAoVOt2C,EAAkBC,GACvC,QAAejX,IAAXgX,QAAoChX,IAAZiX,EAA5B,CAKA,GAFED,EAAO1a,UAAY2a,EAAQ3a,SAAW0a,EAAOmC,QAAUlC,EAAQkC,OAG9ClC,EAAQ7M,OAAS4M,EAAO5M,QACzC4M,EAAOmC,MAAQlC,EAAQkC,MACvB,OACqB,CAAClC,EAASD,GAA7BA,EADF,KACUC,EADV,KAGF,IAAM+nD,EAAc,CAClBviE,MAAOua,EAAOva,MACdE,IAAKqa,EAAOra,IACZwc,MAAOnC,EAAOmC,MACd/O,OAAQ4M,EAAO5M,QAEX60D,EAAY,CAChBxiE,MAAOwa,EAAQxa,MACfE,IAAKsa,EAAQta,IACbwc,MAAOlC,EAAQkC,MACf/O,OAAQ6M,EAAQ7M,QAElB,GAAI40D,GAAeC,EACjBh5D,KAAKgU,OAAO+kD,EAAaC,QAET1/C,sBAAW/hB,GACnB80D,OAAO,kCAAmC,aAKtD4M,yBArXgB,SAqXSC,GACvB3hE,EAAK09D,kCAAkCxtD,KAAKyxD,IAU9CllD,OAhYgB,SAgYTxd,EAAiBE,GAEtB,IAAI8c,EAAU,EAEd,GAAIhd,EAAM0c,QAAUxc,EAAIwc,MACtBM,GAAW9c,EAAIyN,OAAS3N,EAAM2N,WACzB,CACL,IAAM3I,EAAIjE,EAAKyY,iBAAiBxZ,EAAM0c,OAEtC,GADAM,GAAWhY,EAAE9E,IAAM8E,EAAEhF,MAAQA,EAAM2N,OAC/BzN,EAAIwc,MAAQ1c,EAAM0c,OAAS,EAC7B,IAAK,IAAIrY,EAAIrE,EAAM0c,MAAQ,EAAGrY,EAAInE,EAAIwc,MAAOrY,GAAK,EAChD2Y,GACEjc,EAAKyY,iBAAiBnV,GAAGnE,IAAMa,EAAKyY,iBAAiBnV,GAAGrE,MAG9Dgd,GAAW9c,EAAIyN,OAEjB,IAAMg1D,EACJ3lD,GACCjc,EAAK0Y,MACJ1Y,EAAK4Y,yBAA2BzZ,EAAIwc,MAAQ1c,EAAM0c,QAChDmB,EAAa9c,EAAK0c,OAAOklD,GAG3BC,EAAU,EACVD,EAAgB9kD,IAClB+kD,GAAY/kD,EAAa8kD,GAAiB5hE,EAAK0Y,MAAS,GAI1D,IADA,IAAIiE,GAAaklD,EACRv+D,EAAI,EAAGA,EAAItD,EAAKyY,iBAAiB/U,OAAQJ,GAAK,EAAG,CACxD,IAAMuF,EAAS7I,EAAKyY,iBAAiBnV,GACrC,GAAIrE,EAAM0c,QAAUrY,EAAG,CACrBqZ,GAAa1d,EAAM2N,OACnB,MAEA+P,GAAa9T,EAAO1J,IAAM0J,EAAO5J,MAGrCe,EAAK4+D,SACHzxD,KAAK2O,MAAMa,EAAY3c,EAAKwO,SAC1BxO,EAAK4Y,wBAA0B3Z,EAAM0c,QAI3C27C,iBA7agB,SA6aCl6C,GACf,IAAMC,EAAcrd,EAAK+X,SAGzB,OADoB/X,EAAK4+D,SAAS5+D,EAAK+X,SAAWqF,GAC7BC,GAUvB2yC,SA3bgB,SA2bP9zC,EAAYpd,EAAiBgjE,GACpC,IAAMC,EAAW/hE,EAAKwb,OAAO,CAC3B1c,UACA2c,MAAOS,EACPlD,aAAc8oD,IAEZC,GACF/hE,EAAK4+D,SAASzxD,KAAK2O,MAAMimD,EAAShqD,SAAW/X,EAAK0Y,MAAQ,KAI9DspD,OAtcgB,WAucd,IAAMC,EAAWjiE,EAAKsb,QAAU,EAChCtb,EAAK4+D,SAASzxD,KAAK2O,MAAMmmD,EAAWjiE,EAAKwO,QAAUxO,EAAK0Y,MAAQ,KAGlE8D,eA3cgB,WA4cdxc,EAAK0c,OAAO1c,EAAKwzD,YACjB/qD,KAAKu5D,UAGPpL,mBAhdgB,SAgdG/6C,GACjB7b,EAAKu3D,gBAAkB17C,GAGzBm/C,eApdgB,SAodDkH,GACbliE,EAAK0zD,YAAcwO,OAGtBniE,SAAQ,SAAAC,GACP,IAAImiE,EAAsB,aAa1B,MAAO,CAAE/M,MAXT,SAAegN,GAAoB,MACEC,yBACjCriE,EAAK+X,SACL/X,EAAK+X,SAAW/X,EAAK0Y,MAAQ0pD,EAC7BpiE,EAAK4+D,UAJ0B,mBAC1B0D,EAD0B,KACjBC,EADiB,KAMjCJ,IACAA,EAAsBI,EACtBD,SAKHviE,SAAQ,SAAAC,GACP,IAAImiE,EAAsB,aA2B1B,MAAO,CAAEvO,KAzBT,SAAcgO,GAEZ,GADA5hE,EAAK0c,OAAO1c,EAAKwO,WAGdozD,EAAgB5hE,EAAKwO,SAAWxO,EAAKwO,UAAYxO,EAAKyzD,YAEtDmO,EAAgB5hE,EAAKwO,SAAWxO,EAAKwO,UAAYxO,EAAKwzD,YAJzD,CAQA,IAAM0O,EAASliE,EAAKwO,QAAUozD,EAVK,EAWAS,yBACjC,EACAH,EACAliE,EAAKg7D,gBACL,WACEh7D,EAAK0c,OAAOklD,GACZ5hE,EAAKg7D,eAAe,MAjBW,mBAW5BsH,EAX4B,KAWnBC,EAXmB,KAoBnCJ,IACAA,EAAsBI,EACtBD,UAKHjnD,OAAM,SAAArb,GACL,IAAIwiE,EACAC,EAA6C,GACjD,MAAO,CACL,gBACE,IAD0B,EACpBr/C,EAAwB,CAC5B,CACEhiB,MAAO,sBACPokB,QAASxlB,EAAKs0D,sBACd5uC,KAAMg9C,IAER,CACEthE,MAAO,oBACPskB,KAAMi9C,KACNn9C,QAASxlB,EAAK++D,kBAEhB,CACE39D,MAAO,mBACPskB,KAAMk9C,KACNp9C,QAASxlB,EAAKwc,gBAEhB,CACEpb,MAAO,mBACPskB,KAAMk9C,KACNrzD,KAAM,WACNkW,QAASzlB,EAAKs7D,eACd91C,QAASxlB,EAAK8/D,kBAEhB,CAAEvwD,KAAM,WACR,CACEnO,MAAO,cACPskB,KAAMk9C,KACNrzD,KAAM,WACNkW,SAAUzlB,EAAKk9D,WACf13C,QAASxlB,EAAK0+D,cAEhB,CACEt9D,MAAO,uBACPskB,KAAMk9C,KACNrzD,KAAM,WACNkW,SAAUzlB,EAAK21D,mBACfnwC,QAASxlB,EAAK2+D,qBACdtuC,SAAUrwB,EAAKk9D,YAEjB,CACE97D,MAAO,eACPskB,KAAMm9C,KACNtvC,QAAS,CACP,CACEnyB,MAAO,cACPskB,KAAMk9C,KACNrzD,KAAM,QACNkW,QAA8B,gBAArBzlB,EAAK83D,YACdtyC,QAAS,kBAAMxlB,EAAK4/D,eAAe,iBAErC,CACEx+D,MAAO,SACPskB,KAAMk9C,KACNrzD,KAAM,QACNkW,QAA8B,WAArBzlB,EAAK83D,YACdtyC,QAAS,kBAAMxlB,EAAK4/D,eAAe,YAErC,CACEx+D,MAAO,SACPskB,KAAMk9C,KACNrzD,KAAM,QACNkW,QAA8B,WAArBzlB,EAAK83D,YACdtyC,QAAS,kBAAMxlB,EAAK4/D,eAAe,eA/DjB,eAsEC5/D,EAAK8iE,iBAAiBn9D,WAtEvB,IAsE1B,2BAA4D,8BAAhD4P,EAAgD,KAA3CnD,EAA2C,KACtDA,EAAM1O,SACR0f,EAAUlT,KACR,CAAEX,KAAM,WACR,CAAEA,KAAM,YAAanO,MAAOmU,IAE9BnD,EAAMvD,SAAQ,SAAAmlB,GACZ5Q,EAAUlT,KAAK8jB,QA7EK,8BAkF1B,OAAO5Q,GAGT,mBACE,IAAM/Y,EAAMyP,GAAsB9Z,GAC5B+iE,EAAO/sD,KAAKC,UAAU5L,GAK5B,OAJIo4D,IAA+CM,IACjDP,EAAkCn4D,EAClCo4D,EAA6CM,GAExCP,GAGT,oBACE,OAAOjqD,GAAuBvY,IAEhC,wBACE,OAAOo9D,GAA2B30D,KAAK6T,cAAcrE,gBAEvD,8BACE,OAAOmlD,GAA2Bp9D,EAAKq1D,0BAI5Ct1D,SAAQ,SAAAC,GAAI,MAAK,CAChBgjE,uBADgB,SACOzrD,GACrBvX,EAAKq1D,oBAAsB99C,EAAOU,cAClCjY,EAAK41D,cAAgBr+C,EAAO+D,SAE9BsC,YALgB,WAKF,WACZqrC,sBACEjpD,EACA6oD,mBACE,WACM7oD,EAAK6nD,aACP,EAAKmb,uBAAuBhjE,EAAKsc,iBAGrC,CAAE4pC,MAAO,YAMnB,OAAO7nD,QAAM8B,QAAQ6d,GAAepe,G,ICxmCjBqjE,G,4MACnBj/D,KAAO,yB,EAEPwG,QAAU,CACR04D,8BACAhgB,qBACA7B,kC,sDAGM5vC,GACNA,EAAc0xD,cAAa,WACzB,IAAM9zD,EAAekO,8BACnB,eACA,GACA,CACEstC,kBAAmBhlC,GAAsBpU,GACzCiM,mBAAoB,YAGxB,OAAO,IAAI5N,EAAU,CACnB9L,KAAM,eACNqL,eACAU,WAAYyS,GACV/Q,EACA,eACApC,QAKNoC,EAAcusC,gBAAe,WAC3B,IAAM3uC,EAAe+zD,GAAsC3xD,GAC3D,OAAO,IAAItB,EAAY,CACrBnM,KAAM,qBACNqL,eACAU,WAAYszD,GAAoCh0D,GAChDe,UAAW,eACXC,SAAU,mBACVjB,eAAgB8zD,QAIpBzxD,EAAc6xD,aACZ,kBACE,IAAIhzD,EAAS,CACXtM,KAAM,mBACN+L,WAAYwzD,GAAkC9xD,GAC9CrC,eAAgBo0D,QAGtB/xD,EAAcgyD,eACZ,kBACE,IAAIlzD,EAAW,CACbvM,KAAM,oBACNwM,QAAS,kBACTnB,aAAcq0D,GACd3zD,WAAY4zD,GACZv0D,eAAgBw0D,U,gCAKdnyD,GACJoyD,iCAAsBpyD,EAAc6oC,YACtC7oC,EAAc6oC,UAAUwpB,gBAAgB,CAAC,OAAQ,OAAQ,CACvD1iE,MAAO,qBACPskB,KAAMq+C,KACNv+C,QAAS,SAACtC,GACRA,EAAQ8gD,QAAQ,mBAAoB,W,GApEM54B,I,kDCJ7C,SAAS64B,GACdC,EACAC,EACAhoD,GAEQ,IAEJioD,EAHJC,EACQ,wDACR,OAAU,IAANloD,EAAgB,GAEhBkoD,EACFD,EAAWD,EAAahoD,EAAK+nD,EAAMA,GAAQ/nD,EAAIA,IAG/CioD,EAAWD,EAAcD,EAAMA,EAAO/nD,EAClCA,EAAI,IACNioD,GAAYjoD,EAAI,IAIbioD,EAAW,EAAI,EAAIj3D,KAAKm3D,KAAKF,IAO/B,SAASG,GAAatgE,GAC3B,kCACKA,GADL,IAEEugE,WAAYvgE,EAAEwgE,UAAY,IAAMxgE,EAAEygE,cAAgBzgE,EAAE0gE,cAAgB,GACpEC,YAAaX,GACXhgE,EAAEwgE,SACFxgE,EAAE4gE,gBACF5gE,EAAEygE,cAAgBzgE,EAAE0gE,cAEtBG,gBAAiB7gE,EAAEygE,cAAgB,GAAKzgE,EAAE0gE,eA6CvC,SAAeI,GAAtB,qC,8CAAO,WACLl8D,EACAkS,GAFK,6BAAAvZ,EAAA,6DAIGvC,EAAe4J,EAAf5J,MAAOE,EAAQ0J,EAAR1J,IAJV,SAYK4b,EACP3R,KACC0O,cACE,SACEktD,EAOAv9C,GAEA,IAAMw9C,EAAQx9C,EAAEjoB,IAAI,SAapB,OAZAwlE,EAAKE,SAAW/3D,KAAKuM,IACnBsrD,EAAKE,SACLz9C,EAAEjoB,IAAI,WAAaioB,EAAEjoB,IAAI,YAAcylE,GAEzCD,EAAKG,SAAWh4D,KAAKC,IACnB43D,EAAKG,SACL19C,EAAEjoB,IAAI,WAAaioB,EAAEjoB,IAAI,YAAcylE,GAEzCD,EAAKP,UAAYQ,EACjBD,EAAKH,iBAAmBI,EAAQA,EAChCD,EAAKN,cAAgB,EAEdM,IAET,CACEG,SAAU1jB,OAAOC,UACjBwjB,SAAUzjB,OAAO2jB,UACjBX,SAAU,EACVI,gBAAiB,EACjBH,aAAc,KAInB7/B,YAjDE,uBAOHsgC,EAPG,EAOHA,SACAD,EARG,EAQHA,SACAT,EATG,EASHA,SACAI,EAVG,EAUHA,gBACAH,EAXG,EAWHA,aAXG,kBAmDEH,GAAa,CAClBW,WACAC,WACAV,WACAI,kBACAH,eACAC,aAAcxlE,EAAMF,EAAQ,KAzDzB,6C,0BCxFcgiB,G,kDAKnB,WAAmBnT,GAAuC,kCACxD,cAAMA,IAHAu3D,YAEkD,EAExD,EAAKA,OAAS,IAAIC,UAAO,CACvB13D,WAAYjG,wBAAasG,yBAAeH,EAAQ,qBAHM,E,kDAO5ChJ,GAAoB,OACMA,GAAQ,IAAtCigC,sBADwB,MACP,aADO,EAEhCA,EAAe,6BACf,IAAM1B,EAAS56B,KAAK48D,OAAOtrB,UAAUj1C,GAErC,OADAigC,EAAe,IACR1B,I,2EAGgBv+B,G,uFACF2D,KAAK88D,MAAMzgE,G,cAA1B46B,E,yBACCh+B,OAAOC,KAAK+9B,EAAO8lC,a,kLAGHC,G,uFACPh9D,KAAK88D,Q,cAAfx9B,E,0BACEA,EAAE29B,aAAaD,IAAU,CAAEzhE,UAAMxB,IAAawB,M,qLAG5Bc,G,uFACL2D,KAAK88D,MAAMzgE,G,cAA1B46B,E,yBACC6kC,GAAa7kC,EAAOimC,e,4IAIP98D,EAA0B/D,GAE9C,OAAOigE,GAAcl8D,EADPJ,KAAKU,YAAYN,EAAQ/D,M,kMAMvC2E,E,+BAA8B,GAC9B3E,E,uBAEK2E,EAAQ/F,O,yCDwGR,CACLyhE,SAAU,EACVD,SAAU,EACVV,UAAW,EACXI,YAAa,EACbH,SAAU,EACVI,gBAAiB,EACjBH,aAAc,EACdI,eAAgB,EAChBH,aAAc,I,uBC9GMlpC,QAAQ4hB,IAC1B5zC,EAAQG,KAAI,SAAAf,GAAM,OAAI,EAAK+8D,eAAe/8D,EAAQ/D,O,cAD9C+gE,E,OAIAX,EAAWW,EACdj8D,KAAI,SAAA3F,GAAC,OAAIA,EAAEihE,YACXptD,QAAO,SAACguD,EAAKpL,GAAN,OAAevtD,KAAKuM,IAAIosD,EAAKpL,MACjCyK,EAAWU,EACdj8D,KAAI,SAAA3F,GAAC,OAAIA,EAAEkhE,YACXrtD,QAAO,SAACguD,EAAKpL,GAAN,OAAevtD,KAAKC,IAAI04D,EAAKpL,MACjC+J,EAAWoB,EAAMj8D,KAAI,SAAA3F,GAAC,OAAIA,EAAEwgE,YAAU3sD,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,GAC9DojE,EAAkBgB,EACrBj8D,KAAI,SAAA3F,GAAC,OAAIA,EAAE4gE,mBACX/sD,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,GACrBijE,EAAemB,EAClBj8D,KAAI,SAAA3F,GAAC,OAAIA,EAAEygE,gBACX5sD,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,GACrBkjE,EAAekB,EAClBj8D,KAAI,SAAA3F,GAAC,OAAIA,EAAE0gE,gBACX7sD,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,G,kBAEpB8iE,GAAa,CAClBY,WACAD,WACAR,eACAC,eACAE,kBACAJ,c,oIAIe57D,EAA0B/D,GAAoB,WACvDhG,EAAwB+J,EAAxB/J,QAASG,EAAe4J,EAAf5J,MAAOE,EAAQ0J,EAAR1J,IADuC,EAER2F,GAAQ,GAAvD0J,EAFuD,EAEvDA,QAAS1H,EAF8C,EAE9CA,OAF8C,IAEtCi+B,sBAFsC,MAErB,aAFqB,EAG/D,OAAOj8B,aAAgB,uCAAU,WAAMC,GAAN,SAAAvH,EAAA,6DAC/BujC,EAAe,2BADgB,SAEd,EAAKsgC,OAAOU,iBAAiBjnE,EAASG,EAAOE,EAA7C,2BACZ2F,GADY,IAEfkhE,aAAcx3D,KAJe,cAM5BpF,KACD68D,eACAr8D,cAAI,SAACkF,GACH,OAAO,IAAI0X,GAAc,CACvB9mB,GAAI6H,OAAOuH,EAAO7P,MAAQ,GAC1BqJ,KAAMwG,QAGVvF,UAAUR,GAdmB,2CAAV,sDAepBjC,K,8CAjGGqB,2BCrBKoV,iCACb,gBACA,CACE6C,eAAgB,CACd7Q,KAAM,eACNiO,aAAc,CAAEhd,IAAK,oBAGzB,CAAEid,iBAAiB,I,iCCUd,SAASyoD,GAAT,GAMO,IACR7Y,EADQ,IALZ8Y,cAKY,MALH,GAKG,MAJZ7gE,aAIY,MAJJ,GAII,EAHZ8gE,EAGY,EAHZA,UACAC,EAEY,EAFZA,WACAC,EACY,EADZA,SACY,cAEOH,EAFP,GAEL/4D,EAFK,KAEAsM,EAFA,KAGZ,QAAYlX,IAAR4K,QAA6B5K,IAARkX,EAAmB,MAAM,IAAIhU,MAAM,kBAC5D,GAAkB,WAAd0gE,EACF/Y,EAAQkZ,oBACH,GAAkB,QAAdH,EACT/Y,EAAQmZ,mBACH,IAAkB,aAAdJ,EAGT,MAAM,IAAI1gE,MAAM,uBAFhB2nD,EAAQoZ,eAIVpZ,EAAM8Y,YAAsB3jE,IAAf6jE,EAA2B,CAACj5D,EAAKi5D,EAAY3sD,GAAO,CAACtM,EAAKsM,IACvE2zC,EAAMqZ,OAdM,kBAgBiBphE,EAhBjB,GAgBLqhE,EAhBK,KAgBKC,EAhBL,KAiBZ,QAAiBpkE,IAAbmkE,QAAuCnkE,IAAbokE,EAC5B,MAAM,IAAIlhE,MAAM,iBAGlB,OADA2nD,EAAM/nD,MAAMghE,EAAWhhE,EAAMqD,QAAQq2D,UAAY15D,GAC1C+nD,EAOF,SAASwZ,GAAUT,GAaxB,MAAkB,QAAdA,EACK,EAEF,ECnEM7oD,qCACb,iBACA,CACEtK,MAAO,CACL1D,KAAM,QACNqB,YAAa,sDACb4M,aAAc,QAEhBspD,SAAU,CACRv3D,KAAM,QACNqB,YAAa,8CACb4M,aAAc,QAEhBupD,SAAU,CACRx3D,KAAM,QACNqB,YAAa,8CACb4M,aAAc,OAEhBwpD,eAAgB,CACdz3D,KAAM,QACNqB,YAAa,gDACb4M,aAAc,uBAEhBypD,UAAW,CACT13D,KAAM,QACNqB,YAAa,mCACb4M,aAAc,OAEhB0pD,WAAY,CACV33D,KAAM,aACN3P,MAAOvB,QAAMo/D,YAAY,iBAAkB,CAAC,SAAU,UAAW,SACjE7sD,YAAa,+CACb4M,aAAc,UAEhB6mC,OAAQ,CACN90C,KAAM,UACNqB,YAAa,oBACb4M,cAAc,GAEhB2pD,aAAc,CACZ53D,KAAM,aACN3P,MAAOvB,QAAMo/D,YAAY,aAAc,CACrC,UACA,OACA,UACA,SAEF7sD,YAAa,wBACb4M,aAAc,WAEhB4pD,kBAAmB,CACjB73D,KAAM,SACNiO,aAAc,EACd5M,YAAa,kCAEfy2D,iBAAkB,CAChB93D,KAAM,aACN3P,MAAOvB,QAAMo/D,YAAY,aAAc,CAAC,MAAO,MAAO,MAAO,aAC7D7sD,YACE,qGACF4M,aAAc,aAGlB,CAAEC,iBAAiB,I,wNCpCCjO,G,8FACVkd,EAAwDld,EAAxDkd,OAAQjjB,EAAgD+F,EAAhD/F,QAAS+E,EAAuCgB,EAAvChB,Q,EAAuCgB,EAA9BosB,6B,MAAwB,E,gBACzCnyB,E,GAAVZ,E,MACD6P,GAAS7P,EAAO1J,IAAM0J,EAAO5J,OAASuP,GAC9B,GAAQke,EAAS,E,yCACtB,CAAEA,OAAQ,EAAGhU,MAAO,I,cAEvBsiB,EAASD,GACb5tB,KAAKkN,KAAK3B,EAAQkjB,GAClBlP,EAASkP,IAEL0rC,EAAMtsC,EAAOiB,WAAW,OAC1BoxB,MAAMzxB,EAAuBA,GACjCnzB,KAAK8+D,KAAKD,EAAK93D,G,UAESyrB,GAAkBD,G,eAApCa,E,yBACC,CAAEA,YAAWnP,SAAQhU,U,8KASjByG,G,+FACgC1W,KAAK++D,cAAcroD,G,uBAAtDuN,E,EAAAA,OAAQhU,E,EAAAA,MAAOmjB,E,EAAAA,UACjBpsB,EAAUC,IAAMC,cACpBlH,KAAK2G,eADS,2BAET+P,GAFS,IAEIuN,SAAQhU,QAAOmjB,cACjC,M,kBAEK,CAAEpsB,UAASosB,YAAWnP,SAAQhU,U,4GAjCHyyB,ICwCvBpiC,2BA9Df,SAAyByG,GAQtB,IAEC/F,EAOE+F,EAPF/F,QACAsR,EAMEvL,EANFuL,SACAvM,EAKEgB,EALFhB,QACAkK,EAIElJ,EAJFkJ,MACAgU,EAGEld,EAHFkd,OAND,EASGld,EAFFi7C,oBAPD,MAOgB,aAPhB,IASGj7C,EADFmjB,mBARD,MAQe,aARf,EAUM9pB,EAVN,YAUgBY,EAVhB,MAWK+mB,EAAMjD,iBAAuB,MAEnC,OACE,yBACEiD,IAAKA,EACLmC,YAAa,SAAAjF,GACX,IAAI9gB,EAAS,EACT4jB,EAAI5C,UACNhhB,EAAS4jB,EAAI5C,QAAQ+D,wBAAwB1B,MAE/C,IAGIgzB,EARgB,EAKd3gB,EAAU5U,EAAMi2B,QAAU/2C,EAC1BoP,EAAKnT,EAAOhJ,SAAW6Y,EAAQ4pB,EAAUA,EACzCmlC,EAAW5+D,EAAO5J,MAAQuP,EAAUwN,EAPtB,eASEjB,EAAS8oB,UATX,IASpB,2BAAyC,KAA9B3uB,EAA8B,QACvC,GACEuyD,GAAYvyD,EAAQ1V,IAAI,QACxBioE,GAAYvyD,EAAQ1V,IAAI,SACxB,CACAyjD,EAAoB/tC,EACpB,QAfgB,8BAmBpByd,EACEjF,EACAu1B,EAAoBA,EAAkBvjD,UAAO8C,IAGjDioD,aAAc,SAAA/8B,GAAK,OAAI+8B,EAAa/8B,IACpCU,KAAK,eACLtZ,UAAU,kBACVJ,MAAO,CACLV,SAAU,UACVnH,SAAU,WACV6f,WAGF,kBAAC,GAAsBld,O,sKChDtB83D,EAA+B93D,GAAgC,IAO9Dk4D,EACAC,EAPI5sD,EAA0DvL,EAA1DuL,SAAUtR,EAAgD+F,EAAhD/F,QAAS+E,EAAuCgB,EAAvChB,QAASo5D,EAA8Bp4D,EAA9Bo4D,UAAWl7C,EAAmBld,EAAnBkd,OAAQ5e,EAAW0B,EAAX1B,OAChDjF,EAF2D,YAEjDY,EAFiD,MAG5Do+D,EAAQ55D,yBAAeH,EAAQ,gBAC/Bu4D,EAAap4D,yBAAeH,EAAQ,qBACpCi5D,EAAW94D,yBAAeH,EAAQ,YAClCg5D,EAAW74D,yBAAeH,EAAQ,YAGA,SAApCG,yBAAeH,EAAQ,UAEzB65D,EAEMzB,GADM,SAAV2B,EACa,2BACJD,GADG,IAENvB,aACA/gE,MAAO,CAACyhE,EAAU,QAASD,KAEpB,2BAAKc,GAAN,IAAiBtiE,MAAO,CAAC,QAASwhE,MAChDY,EAAgB,SAACxyD,GAAD,OAAsByyD,EAAWzyD,EAAQ1V,IAAI,YAE7DkoE,EAAgB,SAACxyD,GAAD,OACdjH,yBAAeH,EAAQ,QAAS,CAACoH,KAtB6B,qBAyB5C6F,EAAS8oB,UAzBmC,IAyBlE,2BAAyC,KAA9B3uB,EAA8B,UACb4yD,yBAAc5yD,EAASrM,EAAQ2F,GADlB,mBAChCgL,EADgC,KAEjCuuD,EAFiC,KAEnBvuD,EAAS,GAC7B8tD,EAAIjrC,UAAYqrC,EAAcxyD,GAC9BoyD,EAAIU,SAASxuD,EAAQ,EAAGuuD,EAAGr7C,IA7BqC,mC,GADzCu7C,IAkChB54D,GAAekO,8BAC1B,kBACA,GACA,CAAEstC,kBAAmBzrD,GAAcqe,iBAAiB,IC7CtD,IAAMyqD,GAAM,SAACjkE,GAAD,OAAekkE,WAAWlkE,EAAEmkE,YAAY,KAE9C11D,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCy1D,OAAQ,CACNt+C,SAAU,QACVyE,OAAQ5b,EAAM4b,OAAOw1B,QACrB5hB,cAAe,QAGjBkmC,cAAe,CACbn1D,WAAY,OACZe,OAAQ,OACRwE,MAAO,EACPgU,OAAQ,OACRkC,IAAK,EACLpC,OAAQ,UACR3f,SAAU,WACVu1B,cAAe,YAInB,SAASmmC,GAAgB/4D,GAA6B,IAC5C0F,EAAY1F,EAAZ0F,QACR,YAAkC1S,IAA3B0S,EAAQ1V,IAAI,WACjB,uCAEE,6BAFF,QAGQ0oE,GAAIhzD,EAAQ1V,IAAI,aACtB,6BAJF,QAKQ0oE,GAAIhzD,EAAQ1V,IAAI,UACtB,6BANF,QAOQ0oE,GAAIhzD,EAAQ1V,IAAI,cAGxB,6BAAM0oE,GAAIhzD,EAAQ1V,IAAI,WAK1B,IAwCe6iC,GAxCCt5B,oBACd,YAQM,IAPJnJ,EAOI,EAPJA,MACA8sB,EAMI,EANJA,OACAs2B,EAKI,EALJA,WAMQC,EAAsBrjD,EAAtBqjD,kBACF3uC,EAAU5B,KAEhB,OAAOuwC,EACL,oCACE,kBAAC,KAAD,CACE7sC,UAAU,cACVtB,UAAWR,EAAQ+zD,OACnBv5C,MAAI,EACJta,MAAO,kBAAC+zD,GAAD,CAAiBrzD,QAAS+tC,KAEjC,yBACEvuC,MAAO,CACL7H,SAAU,WACVojB,KAAM+yB,EAAW,GACjBp0B,IAAK,IAGN,MAGL,yBACE9Z,UAAWR,EAAQg0D,cACnB5zD,MAAO,CAAEub,KAAM+yB,EAAW,GAAIt2B,aAGhC,QCxDFmvB,GAAgB,IAAI3qC,IAAI,CAC5B,CAAC,SAAU,kBACX,CAAC,UAAW,mBACZ,CAAC,OAAQ,sBAGX,SAASs3D,GAAKnkE,EAAW+jC,GACvB,OAAOj7B,KAAKs7D,IAAIrgC,GAAKj7B,KAAKs7D,IAAIpkE,GAEhC,SAASyX,GAAMpZ,GAAoB,IAATjB,EAAS,uDAAL,IAC5B,OAAQiB,GAAK,EAAI,GAAK,GAAKyK,KAAKu7D,IAAIjnE,EAAG,EAAI0L,KAAKsN,MAAM+tD,GAAK/mE,EAAG0L,KAAKsgD,IAAI/qD,MC3BzE,IDgCA,IAyPeooD,GAzPW,SAACz7C,GAAD,OACxBhR,QACG8B,QACC,sBACA+iD,GACA7kD,QAAMuB,MAAM,CACV2P,KAAMlR,QAAMqkB,QAAQ,uBACpBnE,cAAeoE,iCAAuBtT,GACtCs5D,kBAAmBtqE,QAAMC,SAASD,QAAMU,OAAQ,OAGnD+b,UAAS,iBAAO,CACf8tD,OAAO,EACPlyC,aAASl0B,EACTg/B,MAAOqnC,qBAAW,CAAE1D,SAAU,EAAGD,SAAU,KAC3C4D,0BAAsBtmE,MAEvBzC,SAAQ,SAAAC,GAAI,MAAK,CAChB+oE,YADgB,SACJvnC,GACVxhC,EAAKwhC,MAAM2jC,SAAW3jC,EAAM2jC,SAC5BnlE,EAAKwhC,MAAM0jC,SAAW1jC,EAAM0jC,SAC5BllE,EAAK4oE,OAAQ,GAGfviB,WAPgB,SAOLyW,QAEuBt6D,IAA9BxC,EAAK8oE,sBACJ9oE,EAAK8oE,qBAAqBhiE,OAAO2/C,SAElCzmD,EAAK8oE,qBAAqBpiB,QAE5B1mD,EAAK8oE,qBAAuBhM,OAG/BzhD,OAAM,SAAArb,GACL,IAAIgpE,EAA8B,CAAC,EAAG,GACtC,MAAO,CACL,uBACE,OAAQ3mC,IAGV,uBACE,IAAM4mC,EAAWhnD,kBAAQjiB,EAAM,oBACzBw6C,EAAeqB,GAAcr8C,IAAIypE,GACvC,IAAKzuB,EACH,MAAM,IAAI90C,MAAJ,uCAA0CujE,IAClD,OAAOzuB,GAGT,aACE,IAAM0uB,EAAWjnD,kBAAQjiB,EAAM,YACzBmpE,EAAWlnD,kBAAQjiB,EAAM,YACzBqK,ENTT,YAQJ,IAPD+7D,EAOC,EAPDA,UACAD,EAMC,EANDA,OACAjuC,EAKC,EALDA,OAKC,cAC4BA,EAD5B,GACMixC,EADN,KACgBD,EADhB,mBAEgB/C,EAFhB,GAEI/4D,EAFJ,KAESsM,EAFT,KAiBD,GAbkB,WAAd0sD,IACE1sD,EAAM,IAAGA,EAAM,GACftM,EAAM,IAAGA,EAAM,IAEH,QAAdg5D,IAKU,IAARh5D,GAAaA,EAAM,KACrBA,EAAM,QAGE5K,IAAR4K,QAA6B5K,IAARkX,EACvB,MAAM,IAAIhU,MAAM,uBAEDlD,IAAb2mE,GAA0BA,IAAa1nB,OAAO2jB,YAChDh4D,EAAM+7D,QAES3mE,IAAb0mE,GAA0BA,IAAaznB,OAAOC,YAChDhoC,EAAMwvD,GAER,IAYM7b,EAZe,SAAC99C,GACpB,GAAa,WAATA,EACF,OAAOg3D,eAET,GAAa,QAATh3D,EACF,OAAOi3D,eAET,GAAa,aAATj3D,EACF,OAAOk3D,eAET,MAAM,IAAI/gE,MAAJ,8BAAiC6J,IAE3B65D,CAAahD,GAI3B,OAFA/Y,EAAM8Y,OAAO,CAAC/4D,EAAKsM,IACnB2zC,EAAMqZ,OACCrZ,EAAM8Y,SMzCOkD,CAAc,CACxBlD,OAAQ,CAACnmE,EAAKwhC,MAAM2jC,SAAUnlE,EAAKwhC,MAAM0jC,UACzCkB,UAAWnkD,kBAAQjiB,EAAM,aACzBk4B,OAAQ,CAACixC,EAAUD,KAarB,OATIA,IAAaznB,OAAO2jB,WAAa/6D,EAAI,GAAK,IAC5CA,EAAI,GAAKyR,GAAMzR,EAAI,KAEjB8+D,IAAa1nB,OAAOC,WAAar3C,EAAI,IAAM,IAC7CA,EAAI,GAAKyR,GAAMzR,EAAI,KAEjB2L,KAAKC,UAAU+yD,KAAehzD,KAAKC,UAAU5L,KAC/C2+D,EAAY3+D,GAEP2+D,GAGT,oBACE,MAC4B,mBAA1BhpE,EAAK8hB,kBACqB,qBAA1B9hB,EAAK8hB,kBAIT,kBACE,IAAMhU,EAAS9N,EAAKw6C,aAAanrC,aAAajF,OAC5C6X,kBAAQjiB,EAAM,CAAC,YAAayI,KAAKqZ,oBAAsB,IAGzD,8CACK9hB,EAAK0qD,qBACLzrC,GAAqBjf,IAF1B,IAGEmnD,UAAWnnD,EAAK4oE,MAChBzmD,aAAcniB,EACd8N,SACA85D,UAAW,CACTzB,OAAQ19D,KAAK09D,OACb3kC,MAAOxhC,EAAKwhC,MACZ8nC,cAAernD,kBAAQjiB,EAAM,aAC7BomE,UAAWnkD,kBAAQjiB,EAAM,aACzBsmE,SAAUrkD,kBAAQjiB,EAAM,aAE1B0sB,OAAQ1sB,EAAK0sB,cAKpB3sB,SAAQ,SAAAC,GACP,IAAMupE,EAAcvpE,EAAKuiB,OADV,SAGAinD,EAHA,8EAGf,WAAwB1kE,GAAxB,+CAAAtD,EAAA,2DAIyBugB,sBAAW/hB,GAA1B8jC,EAJV,EAIUA,WACF2lC,EAAKxnD,kBAAQjiB,EAAM,aACnBspE,EAAgBrnD,kBAAQjiB,EAAM,YAAa,IACzCijB,EAAkBjjB,EAAlBijB,cACc,WAAlBqmD,GAAgD,aAAlBA,EARpC,iCAS2BxlC,EAAWnhC,KAChCgc,GAAgB3e,GAChB,uBAFqB,aAInBijB,gBACA8hB,eAAgB,SAACrO,GACXyB,kBAAQn4B,IACVA,EAAK2mD,WAAWjwB,KAGjB5xB,IAnBX,cASUqgC,EATV,OAsBYggC,EAAqChgC,EAArCggC,SAAUX,EAA2Br/B,EAA3Bq/B,UAAWI,EAAgBz/B,EAAhBy/B,YAtBjC,kBA0B6B,aAAlB0E,EAAA,2BAEEnkC,GAFF,IAGDggC,SAAUA,GAAY,EAAI,EAAIX,EAAYiF,EAAK7E,EAC/CM,SAAUV,EAAYiF,EAAK7E,IAE7Bz/B,GAhCR,WAkCwB,UAAlBmkC,GAA+C,YAAlBA,EAlCnC,0BAmCuC3lD,6BAAkB3jB,GAA7Csc,EAnCZ,EAmCYA,cAAe9N,EAnC3B,EAmC2BA,QACjBw1B,EAAYrlB,GAAgB3e,GApCtC,UAqC2B8jC,EAAWnhC,KAChCqhC,EACA,4BAFqB,aAInB/gB,gBACA7iB,aAAcge,GAAsBpe,EAAKkiB,aAAa,GACtDzY,QAASuM,KAAKW,MACZX,KAAKC,UACHqG,EAAcrE,cAAcrO,KAAI,SAAAf,GAAU,IAChC5J,EAAe4J,EAAf5J,MAAOE,EAAQ0J,EAAR1J,IACf,kCACK0J,GADL,IAEE5J,MAAOkO,KAAKsN,MAAMxb,GAClBE,IAAKgO,KAAKkN,KAAKlb,UAKvB6kC,YACAe,eAAgB,SAACrO,GACXyB,kBAAQn4B,IACVA,EAAK2mD,WAAWjwB,IAGpBloB,WACG1J,IA9DX,eAqCUqgC,EArCV,OAiEYggC,EAAqChgC,EAArCggC,SAAUX,EAA2Br/B,EAA3Bq/B,UAAWI,EAAgBz/B,EAAhBy/B,YAjEjC,kBAqE6B,YAAlB0E,EAAA,2BAEEnkC,GAFF,IAGDggC,SAAUA,GAAY,EAAI,EAAIX,EAAYiF,EAAK7E,EAC/CM,SAAUV,EAAYiF,EAAK7E,IAE7Bz/B,GA3ER,WA6EwB,WAAlBmkC,EA7EN,0CA8EWxlC,EAAWnhC,KAChBgc,GAAgB3e,GAChB,uBAFK,aAIHijB,gBACA8hB,eAAgB,SAACrO,GACXyB,kBAAQn4B,IACVA,EAAK2mD,WAAWjwB,KAGjB5xB,KAxFX,cA4FQ,IAAIY,MAAJ,iCAAoC4jE,EAApC,MA5FR,6CAHe,sBAiGf,MAAO,CAEC/mD,OAFD,WAEU,0HACbviB,EAAKsiB,SAAS,IACRw6C,EAAU,IAAIxrD,gBAFP,SAGOk4D,EAAS,CAC3B1iE,OAAQg2D,EAAQh2D,OAChBzB,QAAS,CAAEqkE,MAAO,uBALP,OAGPloC,EAHO,OAOTrJ,kBAAQn4B,KACVA,EAAK+oE,YAAYvnC,GACjB+nC,KATW,8CAYf3rD,YAdK,WAeHqrC,sBACEjpD,EACA6oD,kBAAO,sBACL,gCAAArnD,EAAA,kEAEUs7D,EAAU,IAAIxrD,gBACpBtR,EAAKqmD,WAAWyW,OACVp5C,EAAOC,6BAAkB3jB,IAEtB6nD,cAAgB7nD,EAAK4oE,OAC5BllD,EAAKlV,QAAUxO,EAAKoqD,gBAP1B,iEAYwBof,EAAS,CAAE1iE,OAAQg2D,EAAQh2D,SAZnD,OAYU06B,EAZV,OAcQrJ,kBAAQn4B,IACVA,EAAK+oE,YAAYvnC,GAfvB,mDAkBSl1B,4BAAiB,EAAD,KAAO6rB,kBAAQn4B,IAClCA,EAAKsiB,SAAL,MAnBN,0DAuBA,CAAE4jC,MAAO,a,WChRjByjB,GAAwB,GACrBrmE,IAAK,GAAIA,GAAI,GAAIA,IAAK,EAC7BqmE,GAAYz5D,KAAZ,KAAAw4D,IAAiB,GAAMplE,KAGlB,IAAMsmE,GAAY7gE,oBACvB,YAA8C,IAA3CnJ,EAA2C,EAA3CA,MACOumE,EAAmBvmE,EAAnBumE,OAAQz5C,EAAW9sB,EAAX8sB,OACV05C,EAAYnkD,kBAAQriB,EAAO,aAC3BytD,EAAQ6Y,GAAS,CACrBE,YACAD,SACA7gE,MAAO,CAAConB,EAAQ,GAChB45C,SAAUrkD,kBAAQriB,EAAO,cAErB0uD,EAAQ5hC,EAAS,GAAK,EAAI,EAC1Bm9C,EAAYC,kCAAuBzc,EAAOiB,GAC1CzqB,EACU,QAAduiC,EACIyD,EAAUhmC,OAAOttB,QAAO,SAACtS,GAAD,OAAe0lE,GAAY5/D,SAAS9F,MAC5D4lE,EAAUhmC,OAEhB,OACE,yBACEnvB,MAAO,CACL7H,SAAU,WACV+hB,IAAK,EACLqB,KAAM,IACNmS,cAAe,OACf1V,SACAhU,MAAO,KAGT,kBAAC,QAAD,iBACMmxD,EADN,CAEEhmC,OAAQA,EACRkmC,OAAQ,SAAC5tD,GAAD,OAAeA,GACvBzH,MAAO,CAAEs1D,OAAQC,iBAqBZlhE,2BAdf,SAAgCyG,GAAsC,IAC5D5P,EAAU4P,EAAV5P,MACAgpE,EAAgChpE,EAAhCgpE,MAAOpnC,EAAyB5hC,EAAzB4hC,MAAO0oC,EAAkBtqE,EAAlBsqE,cACtB,OACE,kBAAC,GAA+B16D,EAC7Bo5D,GAASpnC,GAAS0oC,EAAgB,kBAACN,GAAD,CAAWhqE,MAAOA,IAAY,S,sBChDlDuqE,G,mKACd7C,EAA+B93D,GAAgC,IAgB9Dk4D,EAfI3sD,EAA0DvL,EAA1DuL,SAAUvM,EAAgDgB,EAAhDhB,QAAS/E,EAAuC+F,EAAvC/F,QAASm+D,EAA8Bp4D,EAA9Bo4D,UAAWl7C,EAAmBld,EAAnBkd,OAAQ5e,EAAW0B,EAAX1B,OAChDjF,EAF2D,YAEjDY,EAFiD,MAI5D48D,EAAap4D,yBAAeH,EAAQ,qBACpCi5D,EAAW94D,yBAAeH,EAAQ,YAClCg5D,EAAW74D,yBAAeH,EAAQ,YAClCu2C,EAASp2C,yBAAeH,EAAQ,UAChCm5D,EAAYh5D,yBAAeH,EAAQ,aACnCk5D,EAAiB/4D,yBAAeH,EAAQ,kBACxCu5D,EAAmBp5D,yBAAeH,EAAQ,oBAC1Cu/C,EAAQ6Y,GAAS,2BAAK0B,GAAN,IAAiBtiE,MAAO,CAAC,EAAGonB,MAC5C09C,EAAUvD,GAAUe,EAAUxB,WAZ8B,EAavC/Y,EAAM8Y,SAbiC,mBAa3DkE,EAb2D,KAalDC,EAbkD,KAc5DC,EAAM,SAACC,GAAD,OAAsB99C,EAAS2gC,EAAMmd,IAC3CC,EAAW,SAACD,GAAD,OAAsBD,EAAIH,GAAWG,EAAIC,IAGxD9C,EADsC,SAApCz5D,yBAAeH,EAAQ,SACT,SAACoH,GAAD,OACdA,EAAQ1V,IAAI,SAAW6mE,EAAaU,EAAWD,GAEjC,SAAC5xD,GAAD,OACdjH,yBAAeH,EAAQ,QAAS,CAACoH,KAtB6B,qBAyB5C6F,EAAS8oB,UAzBmC,IAyBlE,2BAAyC,KAA9B3uB,EAA8B,UACb4yD,yBAAc5yD,EAASrM,EAAQ2F,GADlB,mBAChCgL,EADgC,KACxBC,EADwB,KAEnCwrD,EAAQ/vD,EAAQ1V,IAAI,SAClBkrE,EAAOx1D,EAAQ1V,IAAI,YACnBmrE,EAAOz1D,EAAQ1V,IAAI,YAEnBorE,EAAc3F,EAAQoF,EACtBQ,EAAe5F,EAAQqF,EACvBvC,EAAItuD,EAAUD,EAAS,GAEvBuN,EAAI2gD,EAAcxyD,GACC,QAArBmyD,GACFpC,OAAiBziE,IAATkoE,EAAqBzF,EAAQyF,EACrCpD,EAAIjrC,UAAYtV,EAChBugD,EAAIU,SAASxuD,EAAQ+wD,EAAItF,GAAQ8C,EAAG1jB,EAASomB,EAASxF,GAAS,IACjC,QAArBoC,GACTpC,OAAiBziE,IAATmoE,EAAqB1F,EAAQ0F,EACrCrD,EAAIjrC,UAAYtV,EAChBugD,EAAIU,SAASxuD,EAAQ+wD,EAAItF,GAAQ8C,EAAG1jB,EAASomB,EAASxF,GAAS,IACjC,aAArBoC,QAEI7kE,IAATkoE,IACFpD,EAAIjrC,UAAYyuC,KAAM/jD,GAAGyuB,QAAQ,IAAKzyC,WACtCukE,EAAIU,SAASxuD,EAAQ+wD,EAAIG,GAAO3C,EAAG1jB,EAASomB,EAASC,GAAQ,IAI/DpD,EAAIjrC,UAAYtV,EAChBugD,EAAIU,SAASxuD,EAAQ+wD,EAAItF,GAAQ8C,EAAG1jB,EAASomB,EAASxF,GAAS,QAElDziE,IAATmoE,IACFrD,EAAIjrC,UAAYyuC,KAAM/jD,GAAGwuB,OAAO,IAAKxyC,WACrCukE,EAAIU,SAASxuD,EAAQ+wD,EAAII,GAAO5C,EAAG1jB,EAASomB,EAASE,GAAQ,MAG/DrD,EAAIjrC,UAAYtV,EAChBugD,EAAIU,SAASxuD,EAAQ+wD,EAAItF,GAAQ8C,EAAG1jB,EAASomB,EAASxF,GAAS,IAG7D4F,GACFvD,EAAIjrC,UAAY4qC,EAChBK,EAAIU,SAASxuD,EAAQ,EAAGuuD,EAAG,IAClB6C,GAAuC,QAAxBhD,EAAUxB,YAClCkB,EAAIjrC,UAAY4qC,EAChBK,EAAIU,SAASxuD,EAAQkT,EAAS,EAAGq7C,EAAGr7C,IAElCxX,EAAQ1V,IAAI,iBACd8nE,EAAIjrC,UAAY2qC,EAChBM,EAAIU,SAASxuD,EAAQ,EAAGuuD,EAAGr7C,KAzEmC,mC,GAD1Bu7C,ICH/B54D,GAAekO,8BAC1B,iBACA,GACA,CAAEstC,kBAAmBzrD,GAAcqe,iBAAiB,I,sKCH/C6pD,EAAK93D,GAAO,IAWf,EAOA,EAjBQuL,EAA0DvL,EADnD,SACG/F,EAAgD+F,EADnD,QACYhB,EAAuCgB,EADnD,QACqBo4D,EAA8Bp4D,EADnD,UACgCkd,EAAmBld,EADnD,OACwC1B,EAAW0B,EADnD,OAER3G,EAFQ,oBAGTw9D,EAAap4D,yBAAeH,EAAlC,qBACMi5D,EAAW94D,yBAAeH,EAAhC,YACMg5D,EAAW74D,yBAAeH,EAAhC,YACMm5D,EAAYh5D,yBAAeH,EAAjC,aACMk5D,EAAiB/4D,yBAAeH,EAAtC,kBACMu/C,EAAQ6Y,GAAS,OAAD,IAAC,CAAD,sBAAiB5gE,MAAO,CAAC,EAAGonB,MARnC,EASY2gC,EATZ,4BASRgd,EATQ,KASCC,EATD,KAUTC,EAAM,SAAAC,GAAQ,OAAI99C,EAAS2gC,EAAb,IAGlBqa,EADF,SAAIz5D,yBAAeH,EAAfG,SACc,SAAAiH,GAAO,OACrBA,mBADqB,GAGP,SAAAA,GAAO,OAAIjH,yBAAeH,EAAQ,QAAS,CAApC,KAhBV,qBAoBOiN,EApBP,cAoBf,2BAAyC,KAA9B7F,EAA8B,UACb4yD,yBAAc5yD,EAASrM,EADV,sBAChC2Q,EADgC,KACxBC,EADwB,KAEjCwrD,EAAQ/vD,MAAd,SACM01D,EAAc3F,EAApB,EACM4F,EAAe5F,EAArB,EACM8C,EAAItuD,IAL6B,GAOjCsN,EAAI2gD,EAAV,GAEAJ,gBACAA,cACKz+D,EAAL,UAQEy+D,WAEEiD,EAAuB,qBAAZQ,EAA0BA,EAFvCzD,IAIAA,WAAoBiD,EAApBjD,IACAA,WAAmBiD,EAAnBjD,MAZAA,WAEEiD,EAAuB,qBAAZQ,EAA0BA,EAFvCzD,IAIAA,WAAmBiD,EAAnBjD,IACAA,WAAoBiD,EAApBjD,KASFA,WACAyD,IAEA,GACEzD,cACAA,qBACSsD,GAAJ,QAAmBhD,cACxBN,cACAA,aAAqB56C,EAArB46C,QAEEpyD,MAAJ,iBACEoyD,cACAA,sBA1DW,mC,GADUW,ICChB54D,GAAekO,8BAAoB,mBAAD,GAG7C,CAAEstC,kBAAF,GAAmCptC,iBAAiB,ICKzCutD,GAAb,4MACEhnE,KAAO,uBADT,+FAGgBoE,GAHhB,+FASmCK,KAAKoxC,qBAAqBzxC,GAT7D,UASU48B,EATV,OAUY/hB,EAA6B+hB,EAA7B/hB,cAAe+gB,EAAcgB,EAAdhB,UAV3B,EAW4B6U,GACtBpwC,KAAKgJ,cACLuyB,EACA/gB,MAHMmhB,EAXZ,EAWYA,uBAMiBj8B,4BfkK3B4d,EejKmCqe,EfmK5B,mBAAoBre,IerL7B,yCAoBaqe,EAAY6mC,eAAejmC,IApBxC,gCf8JS,CACLmgC,SAAU,EACVD,SAAU,EACVV,UAAW,EACXI,YAAa,EACbH,SAAU,EACVI,gBAAiB,EACjBH,aAAc,EACdI,eAAgB,EAChBH,aAAc,IevKlB,iCfkLO,IACL5+C,IenLF,wEAA0CvU,GA0B7B05D,GAAb,4MACElnE,KAAO,4BADT,0GAIIoE,GAJJ,8EAMUiyC,EANV,UAM4B5xC,KAAKgJ,cAAc6oC,iBAN/C,iBAM4B,EAA8Bp3B,eAN1D,aAM4B,EACpBm3B,gBAPR,yCASajyC,GATb,gCAYWmyC,iCAAsBF,EAAiBjyC,IAZlD,8KAegBA,GAfhB,iGAuBmCK,KAAKoxC,qBAAqBzxC,GAvB7D,UAuBU48B,EAvBV,OAwBYv7B,EAAsCu7B,EAAtCv7B,QAASwZ,EAA6B+hB,EAA7B/hB,cAAe+gB,EAAcgB,EAAdhB,UAxBpC,EAyB4B6U,GACtBpwC,KAAKgJ,cACLuyB,EACA/gB,MAHMmhB,EAzBZ,EAyBYA,uBAOiBj8B,4Bf2I3B4d,Ee1IwCqe,Ef4IjC,wBAAyBre,Ie7KlC,yCAmCaqe,EAAY+mC,oBAAoB1hE,EAASu7B,IAnCtD,gCfoIS,CACLmgC,SAAU,EACVD,SAAU,EACVV,UAAW,EACXI,YAAa,EACbH,SAAU,EACVI,gBAAiB,EACjBH,aAAc,EACdI,eAAgB,EAChBH,aAAc,Ie7IlB,iCf0KO,IACL5+C,Ie3KF,wEAA+CvU,G,+MCH7CxN,KAAO,e,sDAECyN,GACNA,EAAc0xD,cAAa,WACzB,IAAM9zD,EAAekO,8BACnB,oBACA,GACA,CAAEstC,kBAAmBhlC,GAAsBpU,KAE7C,OAAO,IAAI3B,EAAU,CACnB9L,KAAM,oBACNqL,eACAU,WAAYyS,GACV/Q,EACA,oBACApC,QAKNoC,EAAcusC,gBAAe,WAC3B,IAAM3uC,ECrDG,SAA6BoC,GAC1C,IAAM25D,EAA6B35D,EAAc2Q,gBAC/C,kBACA/S,aACIg8D,EAA8B55D,EAAc2Q,gBAChD,mBACA/S,aACIi8D,EAA+B75D,EAAc2Q,gBACjD,oBACA/S,aAEF,OAAOkO,8BACL,sBACA,CACEguD,UAAW,CACTh8D,KAAM,aACNiO,aAAc,QACd5d,MAAOvB,QAAMo/D,YAAY,iBAAkB,CACzC,SACA,QACA,WACA,UACA,WAEF7sD,YACE,wFAEJu4D,SAAU,CACR55D,KAAM,SACNiO,aAAcikC,OAAO2jB,UACrBx0D,YAAa,iCAEfs4D,SAAU,CACR35D,KAAM,SACNqB,YAAa,gCACb4M,aAAcikC,OAAOC,WAEvB8pB,UAAW,CACTj8D,KAAM,SACNqB,YACE,+EACF4M,aAAc,GAEhB4oD,UAAW,CACT72D,KAAM,aACN3P,MAAOvB,QAAMo/D,YAAY,aAAc,CAAC,SAAU,QAClD7sD,YAAa,2BACb4M,aAAc,UAEhB8oD,SAAU,CACR/2D,KAAM,UACNqB,YAAa,mBACb4M,cAAc,GAGhBiuD,iBAAkB,CAChBl8D,KAAM,aACN3P,MAAOvB,QAAMo/D,YAAY,YAAa,CAAC,UAAW,SAAU,SAC5DjgD,aAAc,UAGhBkuD,UAAWnuD,8BAAoB,yBAA0B,CACvDouD,gBAAiBN,EACjBlB,eAAgBiB,EAChBQ,iBAAkBN,KAGtB,CAAEzgB,kBAAmBxJ,GAA+B5jC,iBAAiB,IDd9CouD,CAAuCp6D,GAC5D,OAAO,IAAItB,EAAY,CACrBnM,KAAM,sBACNqL,eACAU,WAAY+7D,GAAgCz8D,GAC5Ce,UAAW,oBACXC,SAAU,mBACVjB,eAAgB28D,QAIpBt6D,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,gBACNqL,aAAc48D,GACdp8D,aAAcq8D,QAIpBz6D,EAAc06D,iBACZ,kBACE,IAAIR,GAAgB,CAClB3nE,KAAM,kBACNoL,eAAgBg9D,GAChB/8D,aAAcg9D,QAIpB56D,EAAc06D,iBACZ,kBACE,IAAIP,GAAiB,CACnB5nE,KAAM,mBACNoL,eAAgBk9D,GAChBj9D,aAAck9D,QAIpB96D,EAAc06D,iBACZ,kBACE,IAAIhC,GAAe,CACjBnmE,KAAM,iBACNoL,eAAgBo9D,GAChBn9D,aAAco9D,QAIpBh7D,EAAcqpC,cAAa,kBAAM,IAAIkwB,GAAqBv5D,MAC1DA,EAAcqpC,cACZ,kBAAM,IAAIowB,GAA0Bz5D,U,GAvEb25B,I,qBEjBvBshC,GAAe,CACnB,WACA,YACA,YACA,sBACA,2BAGIh3D,GAAO,CAAC,gBAAiB,UAAW,mBAEpCi3D,GAA8C,SAAAn9D,GAClD,IAAM8E,EAAU5B,KAgBRk6D,EAfYp9D,EAAZ0F,QAeA03D,MACR,OACE,kBAAC,GAAD,iBAAcp9D,EAAd,CAAqBgF,MAAM,UACzB,yBAAKE,MAAO,CAAEzE,QAAS,SACrB,yBAAK6E,UAAWR,EAAQf,WAAxB,QACA,yBAAKuB,UAAWR,EAAQR,YAAa84D,IAnBzB,CAChB,cACA,6BACA,gBACA,gBACA,sBACA,sBACA,gBACA,iBACA,wBACA,4CACA,mCACA,2BASahjE,KAAI,SAAC5F,EAAM2X,GAEpB,IAAMrF,EAAMs2D,EAAS,GAAKjxD,EACpBpG,EAAM,GAAH,OAAMvR,EAAN,YAAcsS,GACvB,OACE,yBAAKf,IAAKA,GACR,2BAAOhG,KAAK,WAAWkW,QAASoK,QAAQvZ,GAAM5W,GAAI6V,EAAKs3D,UAAQ,IAC/D,2BAAOpzC,QAASlkB,GAAMvR,SAelC,SAAS8oE,GAAT,GAAkD,IAA7B16D,EAA6B,EAA7BA,MAA6B,EACxB+a,oBAAS,GADe,mBACzCnK,EADyC,KACnC+pD,EADmC,KAE1C98D,EAAU1I,OAAO6K,GACvB,OAAInC,EAAQvM,OAAS,IAEjB,oCACE,4BAAQ6L,KAAK,SAASiW,QAAS,kBAAMtY,KAAK+C,KAA1C,QAGA,4BAAQV,KAAK,SAASiW,QAAS,kBAAMunD,GAAQ,SAAAz2D,GAAG,OAAKA,OAClD0M,EAAO,YAAc,aAExB,6BAAMA,EAAO/S,EAAH,UAAgBA,EAAQtH,MAAM,EAAG,KAAjC,SAIT,6BAAMsH,GAGf,IAkBelH,uBAlBmD,SAAAyG,GAAS,IACjE5P,EAAU4P,EAAV5P,MACF8W,EAAOV,KAAKW,MAAMX,KAAKC,UAAUrW,EAAMgX,cAC7C,OACE,kBAACC,GAAA,EAAD,CAAOkZ,cAAY,yBACjB,kBAACtZ,GAAD,iBACMjH,EADN,CAEEkG,KAAMg3D,GAAahmC,OAAOhxB,IAC1BI,UAAW,SAAC1D,GAAD,OAAoB,kBAAC06D,GAAD,CAAW16D,MAAOA,QAEnD,kBAAC,GAAD,eAAgB8C,QAASwB,GAAUlH,QCpGnCH,GAAekO,8BAAoB,0BAAzC,IAEMxN,GAAa,wCACiB,CAChCrQ,GADgC,aAEhC6P,KAAMlR,gBAF0B,2BAGhCuY,YAAavY,qBAJE,SAMR,SAAA2B,GAAI,MAAK,CAChBmhD,eADgB,YAEdnhD,iBAEFohD,iBAJgB,WAKdphD,sBCdS3B,WAAM2uE,MAAK,kBACxBzvD,8BACE,aACA,CACEmC,YAAa,CACXnQ,KAAM,eACNiO,aAAc,CAAEhd,IAAK,oBAEvBmb,MAAO4B,8BAAoB,WAAY,CACrCoC,UAAW,CACT/f,MAAOvB,QAAMo/D,YAAY,YAAa,CAAC,MAAO,QAC9CluD,KAAM,aACNiO,aAAc,OAEhB/V,SAAU,CACR8H,KAAM,eACNiO,aAAc,CAAEhd,IAAK,0BAGzBysE,eAAgB,CACd19D,KAAM,SACNiO,aAAc,KAEhB0vD,eAAgB,CACd39D,KAAM,SACNiO,aAAc,KAEhB2vD,gBAAiB,CACf59D,KAAM,SACNiO,aAAc,OAGlB,CAAEC,iBAAiB,O,sBCzBhB,SAAS2vD,GAAWC,GACzB,OAAQA,GAAS,IAAI5tB,MAAM,iBAEtB,SAAS6tB,GAAkBC,EAAe/a,GAI/C,IAHA,IAAIgb,EAAa,EACbC,EAAY,EACVC,EAAyB,GACtBpqE,EAAI,EAAGA,EAAIiqE,EAAI7pE,OAAS,EAAGJ,GAAK,EAAG,CAC1C,IAAM+Y,GAAOkxD,EAAIjqE,GACXqqE,EAAKJ,EAAIjqE,EAAI,GAInB,GAHW,MAAPqqE,GAAqB,MAAPA,GAAqB,MAAPA,IAC9BF,GAAapxD,GAEJ,MAAPsxD,EACFD,EAAWx9D,KAAK,CACdjR,MAAOuuE,EACPj+D,KAAM,YACNg/C,KAAM,GAAF,OAAKlyC,GACT3Y,OAAQ,IAEV+pE,GAAapxD,OACR,GAAW,MAAPsxD,EACTD,EAAWx9D,KAAK,CACdjR,MAAOuuE,EACPj+D,KAAM,WACNg/C,KAAM,IACN7qD,OAAQ2Y,SAEL,GAAW,MAAPsxD,EACTD,EAAWx9D,KAAK,CACdjR,MAAOuuE,EACPj+D,KAAM,OACNg/C,KAAM,IACN7qD,OAAQ2Y,SAEL,GAAW,MAAPsxD,EAAY,CAErB,IADA,IAAMtqE,EAAImvD,EAAI7pD,MAAM8kE,EAAWA,EAAYpxD,GAClCmnB,EAAI,EAAGA,EAAInnB,EAAKmnB,IACvBkqC,EAAWx9D,KAAK,CACdjR,MAAOuuE,EAAahqC,EACpBj0B,KAAM,WACNg/C,KAAMlrD,EAAEmgC,GACR9/B,OAAQ,IAGZ+pE,GAAapxD,MACG,MAAPsxD,EACTD,EAAWx9D,KAAK,CACdjR,MAAOuuE,EACPj+D,KAAM,WACNg/C,KAAM,IAAF,OAAMlyC,GACVuxD,QAASvxD,EACT3Y,OAAQ,IAEM,MAAPiqE,IACTD,EAAWx9D,KAAK,CACdjR,MAAOuuE,EACPj+D,KAAM,WACNg/C,KAAM,IAAF,OAAMlyC,GACVuxD,QAASvxD,EACT3Y,OAAQ,IAEV+pE,GAAapxD,GAGJ,MAAPsxD,GAAqB,MAAPA,GAAqB,MAAPA,IAC9BH,GAAcnxD,GAGlB,OAAOqxD,EAOF,SAASG,GACdC,EACAC,EACAC,EACAxb,GAEA,IAAMyb,EAA8B,GAChCvT,EAAiB,CAAEz7D,MAAO,EAAGsvD,KAAM,GAAI7qD,OAAQ,EAAG6L,KAAM,YACtD2+D,EAAQF,EAAgBz3D,QAAO,SAAA82D,GAAK,MAAmB,SAAfA,EAAM99D,QAChD4+D,EAAY,EACZC,EAAqB,EACrBC,EAAgB,EAChBC,EAAc,EAMlB,SAASC,IACPN,EAAgB/9D,KAAKwqD,GAGrBA,EAAO,CACLz7D,MAAOy7D,EAAKz7D,MAAQy7D,EAAKh3D,OACzBA,OAAQ,EACR6qD,KAAM,GACNh/C,KAAM,YAIV,SAASi/D,EAAsBC,GAG7B,IAFA,IAAIC,EAAiBN,EACjBO,EAAYN,EAEV/qE,EAAI6qE,EACR7qE,EAAIyqE,EAASrqE,QAAUirE,GAAaF,EAC5BN,EAAR7qE,GAAK,EACL,CACA,IAAM+Y,GAAO0xD,EAASzqE,GAChBqqE,EAAKI,EAASzqE,EAAI,GACb,MAAPqqE,GAAqB,MAAPA,EAChBe,GAAkBryD,EACF,MAAPsxD,GAAqB,MAAPA,GAAqB,MAAPA,EACrCgB,GAAatyD,EACG,MAAPsxD,IACTe,GAAkBryD,EAClBsyD,GAAatyD,GAMjB,OAHA+xD,EAAqBM,EACrBL,EAAgBM,EAETD,GAAkBC,EAAYF,GAKvC,IADA,IAAMG,EAAKd,EAAS1rE,MAAM,2BAA6B,GAC9CkB,EAAI,EAAGA,EAAIsrE,EAAGlrE,OAAQJ,IAAK,CAClC,IAAMurE,EAAQD,EAAGtrE,GACjB,GAAIurE,EAAMzsE,MAAM,OACds4D,EAAKz7D,OAAS2H,SAASioE,EAAO,SACzB,GAAIA,EAAMzsE,MAAM,OACrBs4D,EAAKh3D,OAASmrE,EAAMnrE,OAAS,EAC7Bg3D,EAAKnM,KAAO,IACZmM,EAAKnrD,KAAO,WACZmrD,EAAKlI,IAAMqc,EAAMC,UAAU,GAC3BP,SACK,GAAIM,EAAMzsE,MAAM,WAErB,IAAK,IAAIohC,EAAI,EAAGA,EAAIqrC,EAAMnrE,OAAQ8/B,GAAK,EAAG,CAGxC,IAFAk3B,EAAKh3D,OAAS,EAEP4qE,EAAcJ,EAAMxqE,QAAQ,CACjC,IAAMqrE,EAAWb,EAAMI,GACvB,KAAI5T,EAAKz7D,OAAS8vE,EAAS9vE,OAIzB,MAHAy7D,EAAKz7D,OAAS8vE,EAASrrE,OACvB4qE,IAKJ5T,EAAKnM,KAAOiE,EACRA,EAAIwc,OACFjB,EAAWS,EAAsB9T,EAAKz7D,OAASy7D,EAAKz7D,MACpD,GAEF,IACJy7D,EAAKuU,QAAUJ,EACfN,KAIN,OAAON,EAGF,SAASiB,GAAiBT,EAAkBV,GAGjD,IAFA,IAAIW,EAAiB,EACjBC,EAAY,EACPrrE,EAAI,EAAGA,EAAIyqE,EAASrqE,QAAUirE,GAAaF,EAAUnrE,GAAK,EAAG,CACpE,IAAM+Y,GAAO0xD,EAASzqE,GAChBqqE,EAAKI,EAASzqE,EAAI,GACb,MAAPqqE,GAAqB,MAAPA,EAChBe,GAAkBryD,EACF,MAAPsxD,GAAqB,MAAPA,EACvBgB,GAAatyD,EACG,MAAPsxD,IACTe,GAAkBryD,EAClBsyD,GAAatyD,GAGjB,OAAOqyD,GAAkBC,EAAYF,GAGhC,SAASU,GACdC,EACAC,EACA7c,GAEA,IAAIkb,EAAyB,GACzBK,EAAqB,GAGrBqB,IACFrB,EAAWX,GAAWgC,GACtB1B,EAAaA,EAAWhnC,OAAO4mC,GAAkBS,EAAUvb,KAIzD6c,IACF3B,EAAaA,EAAWhnC,OACtBmnC,GAAewB,EAAUtB,EAAUL,EAAYlb,KAKnD,IAAM8c,EAAqC,GAC3C,OAAO5B,EAAWn3D,QAAO,SAAAg5D,GACvB,IAAMh6D,EAAM,GAAH,OAAMg6D,EAAEhgE,KAAR,YAAgBggE,EAAEtwE,MAAlB,YAA2BswE,EAAE7rE,QAChCO,EAAIqrE,EAAK/5D,GAEf,OADA+5D,EAAK/5D,IAAO,GACJtR,KAKL,SAASurE,GAAWv5C,EAAgB4qC,EAAewM,GACxD,IAAIoC,EAAc,EACdC,EAAe,EACfC,EAAW,EACf,IAAK15C,EAEH,OADAtxB,QAAQ4H,KAAK,iCACN,GAIT,IAFA,IAAMwhE,EAAWX,GAAWC,GACxBn7D,EAAM,GACD5O,EAAI,EAAGA,EAAIyqE,EAASrqE,OAAQJ,GAAK,EAAG,CAC3C,IAAM+Y,GAAO0xD,EAASzqE,GAChBqqE,EAAKI,EAASzqE,EAAI,GACxB,GAAW,MAAPqqE,GAAqB,MAAPA,GAAqB,MAAPA,EAAY,CAC1C,IAAK,IAAInqC,EAAI,EAAGA,EAAInnB,EAAKmnB,IAErBq9B,EAAM4O,EAAcjsC,GAAGhuB,gBACvBygB,EAAOy5C,EAAelsC,GAAGhuB,eAEzBtD,GAAO,GAAJ,OAAOy9D,GAAP,OAAkB15C,EAAOy5C,EAAelsC,GAAG5jB,eAC9C+vD,EAAW,GAEXA,IAGJF,GAAepzD,EACfqzD,GAAgBrzD,OACX,GAAW,MAAPsxD,EACT8B,GAAepzD,OACV,GAAW,MAAPsxD,EAAY,CAErB,IADA,IAAIiC,EAAM,GACDpsC,EAAI,EAAGA,EAAInnB,EAAKmnB,IACvBosC,GAAO35C,EAAOy5C,EAAelsC,GAAG5jB,cAElC1N,GAAO,GAAJ,OAAOy9D,EAAP,YAAmBC,GACtBD,EAAW,EACXD,GAAgBrzD,MACA,MAAPsxD,EACT+B,GAAgBrzD,EACA,MAAPsxD,IACT8B,GAAepzD,GAMnB,OAHIszD,EAAW,IACbz9D,GAAOy9D,GAEFz9D,E,ICrQY29D,G,WAOnB,WAAY/gE,EAAmBiX,EAAqByK,GAAc,yBAN1D1hB,YAM0D,OAJ1DiX,aAI0D,OAF1DyK,SAE0D,EAChE/nB,KAAKqG,OAASA,EACdrG,KAAKsd,QAAUA,EACftd,KAAK+nB,IAAMA,E,wDAIX,OAAO/nB,KAAKqG,OAAOtP,IAAI,U,kCAIvB,MAAO,U,mCAIP,OAAOiJ,KAAKqG,OAAOtP,IAAI,Q,mCAKvB,OAAOiJ,KAAKqG,OAAO89D,Q,oCAInB,OAAOnkE,KAAKqG,OAAOghE,yBAA2B,EAAI,I,2CAKlD,OAAOrnE,KAAKqG,OAAOihE,c,8CAInB,OAAOtnE,KAAKqG,OAAOkhE,WAAavnE,KAAKqG,OAAOmhE,0BAAuBztE,I,yCAInE,OAAOiG,KAAKqG,OAAOohE,gB,oCAKnB,OAAOznE,KAAKqG,OAAOqhE,S,0CAInB,OAAO1nE,KAAKsd,QAAQqqD,YAAY3nE,KAAKqG,OAAOohE,iB,mDAI5C,OAAOznE,KAAKqG,OAAOkhE,WAAZ,UACAvnE,KAAKsd,QAAQqqD,YAAY3nE,KAAKqG,OAAOohE,eADrC,YAEDznE,KAAKqG,OAAOuhE,YAAc,QAE5B7tE,I,kCAIJ,OAAOiG,KAAKqG,OAAOwhE,U,iCAInB,OAAO7nE,KAAKqG,OAAOyhE,iB,gCAInB,IAAM3B,EAAKnmE,KAAKqG,OAAOtP,IAAI,MACrBgzD,EAAM/pD,KAAKjJ,IAAI,OACrB,OAAKovE,GAAMpc,GAAO/pD,KAAK+nB,IACdg/C,GAAW/mE,KAAK+nB,IAAK/nB,KAAKqG,OAAOyhE,eAAgB9nE,KAAKjJ,IAAI,UAE5DovE,I,4DAMP,IAAM4B,EAAa9uE,OAAO+uE,oBACxBZ,EAAuB/sE,WAGzB,mBACK,IAAImjB,IACLuqD,EACGj6D,QACC,SAAA3U,GAAI,OACFA,EAAK0J,WAAW,UACP,oBAAT1J,GACS,wBAATA,GACS,4BAATA,GACS,cAATA,GACS,qBAATA,GACS,gBAATA,KAEHgI,KAAI,SAAAi0C,GAAU,OAAIA,EAAW17C,QAAQ,QAAS,OAC9CukC,OAAOj+B,KAAKioE,iB,2BAMnB,gBAAUjoE,KAAKsd,QAAQrmB,GAAvB,YAA6B+I,KAAKqG,OAAOpP,Q,0BAIvC4T,GACF,IAAMuqC,EAAa,QAAH,OAAWvqC,GAE3B,OAAI7K,KAAKo1C,GAEAp1C,KAAKo1C,KAEPp1C,KAAKqG,OAAOtP,IAAI8T,K,qCAIvB,OAAO7K,KAAKsd,QAAQqqD,YAAY3nE,KAAKqG,OAAO6hE,Y,4GAY5C,OAAO,I,+BAGyB,WAC1BC,EAAOlvE,OAAOmvE,YAClBpoE,KAAKmoE,OACFhnE,KAAI,SAAAk/B,GACH,MAAO,CAACA,EAAG,EAAKtpC,IAAIspC,OAErBvyB,QAAO,SAAAu6D,GAAG,YAAetuE,IAAXsuE,EAAI,OAGvB,kCACKF,GADL,IAEElqD,SAAUje,KAAK/I,S,4CAUL,IALZoF,EAKY,uDAHR,CACFisE,mBAAoB,SAGdA,EAAuBjsE,EAAvBisE,mBACJrD,EAAyB,GACzBK,EAAqB,GAGnBqB,EAAc3mE,KAAKjJ,IAAIuxE,GAO7B,OANI3B,IACFrB,EAAWX,GAAWgC,GACtB1B,EAAaA,EAAWhnC,OACtB4mC,GAAkBS,EAAUtlE,KAAKjJ,IAAI,UAGlCkuE,I,wCASW,6DAAhB,GAAgB,IALlBqD,0BAKkB,MALG,QAKH,MAJlBC,uBAIkB,MAJA,KAIA,EACdtD,EAAyB,GACzBK,EAAqB,GAGnBqB,EAAc3mE,KAAKjJ,IAAIuxE,GACzB3B,IACFrB,EAAWX,GAAWgC,GACtB1B,EAAaA,EAAWhnC,OACtB4mC,GAAkBS,EAAUtlE,KAAKjJ,IAAI,UAKzC,IAAM6vE,EAAW5mE,KAAKjJ,IAAIwxE,GACtB3B,IACF3B,EAAaA,EAAWhnC,OACtBmnC,GAAewB,EAAUtB,EAAUL,EAAYjlE,KAAKjJ,IAAI,UAK5D,IAAM8vE,EAAqC,GAC3C,OAAO5B,EAAWn3D,QAAO,SAAAg5D,GACvB,IAAMh6D,EAAM,GAAH,OAAMg6D,EAAEhgE,KAAR,YAAgBggE,EAAEtwE,MAAlB,YAA2BswE,EAAE7rE,QAChCO,EAAIqrE,EAAK/5D,GAEf,OADA+5D,EAAK/5D,IAAO,GACJtR,O,qCAKV,IAAMopE,EAAQ5kE,KAAKjJ,IAAI,UAAY,GACnC,OAA+B,IAAxBiJ,KAAKjJ,IAAI,YACV6tE,EAAMjrE,MAAM,eAAiB,IAAI,IAAM,IACvCirE,EAAMjrE,MAAM,iBAAmB,IAAI,IAAM,M,KC9M9B0e,G,kDAQnB,WACEhT,EACAqrC,GACA,kCACA,cAAMrrC,IAVEmjE,SASR,IAPQ9D,qBAOR,IALM+D,UAAoB,GAU1B,EAAKn0B,UAAUjvC,EAAQqrC,GALvB,E,sDAWArrC,EACAqrC,GAEA,IAAMz5B,EAAczR,yBAAeH,EAAQ,eACrCrG,EAAWwG,yBAAeH,EAAQ,CAAC,QAAS,aAC5C6R,EAAY1R,yBAAeH,EAAQ,CAAC,QAAS,cAC7Cm/D,EAAiBh/D,yBAAeH,EAAQ,kBACxCo/D,EAAiBj/D,yBAAeH,EAAQ,kBAC9CrF,KAAKwoE,IAAM,IAAIE,WAAQ,CACrBC,cAAezpE,wBAAa+X,GAC5B2xD,cAA6B,QAAd1xD,EAAsBhY,wBAAaF,QAAYjF,EAC9D8uE,cAA6B,QAAd3xD,EAAsBhY,wBAAaF,QAAYjF,EAC9DyqE,iBACAC,mBAGF,IAAMjqD,EAAgBhV,yBAAeH,EAAQ,mBAC7C,GAAImV,GAAiBk2B,EAAe,KAC1B/U,EAAgB+U,EAAcl2B,GAA9BmhB,YACR37B,KAAK0kE,gBAAkB/oC,K,yEAIXt/B,G,0FACP2D,KAAKwoE,IAAIl3B,UAAUj1C,I,4KAGRA,G,qFACoBA,GAAQ,IAAtCigC,sB,MAAiB,a,EACkB,IAAvCrjC,OAAOC,KAAK8G,KAAKyoE,WAAWxtE,O,wBAC9BqhC,EAAe,qB,SACSt8B,KAAKwoE,IAAIl3B,UAAUj1C,G,OAArCosE,E,OAIAK,EAAqB,GACrBC,EAAmC,GACzBN,EAAU36D,QAAO,SAAChT,GAAD,MAAkC,OAAVA,EAAEwO,OACnDlD,SAAQ,SAAC4iE,EAAgChM,GAC/CgM,EAAOnpE,KAAKuG,SAAQ,SAAC+qB,GACnB,GAAiB,OAAbA,EAAK7nB,IAAc,CAErB,IAAMjT,EAAU86B,EAAKxnB,MACrBo/D,EAAS1yE,GAAW2mE,EACpB8L,EAAS9L,GAAS3mE,SAIpByyE,EAAS7tE,SACX+E,KAAKyoE,UAAY,CAAEK,WAAUC,aAE/BzsC,EAAe,I,mLAIDjgC,G,iFACV2D,KAAK88D,MAAMzgE,G,WACb2D,KAAKyoE,UAAUK,S,yCACV9oE,KAAKyoE,UAAUK,U,aAElB,IAAI7rE,MAAM,0B,+KAGK5G,EAAiBG,EAAeE,G,kFAC/CuyE,EAAcjpE,KAAK0kE,gB,8CACA3qE,G,UACpB1D,E,8CAAgB0D,G,cAEfuY,EAAW22D,EAAYvoE,YAAY,CACvCrK,UACAG,QACAE,MACAiB,aAAc,K,SAGQ2a,EAAS3R,KAAKwiD,gBAAW/mB,Y,UAA3C8sC,E,OAEAC,EAAoB,GAC1BD,EACGt/C,MAAK,SAAC7wB,EAAYC,GAAb,OAA4BD,EAAEhC,IAAI,SAAWiC,EAAEjC,IAAI,YACxDqP,SAAQ,SAACgjE,GACR,IAAMC,EAAaD,EAAMryE,IAAI,SACvBuyE,EAAWF,EAAMryE,IAAI,OACrBwyE,EAAY7kE,KAAKuM,IAAIza,EAAQ6yE,EAAY,GAEzCG,EADU9kE,KAAKC,IAAIjO,EAAM2yE,EAAYC,EAAWD,GACzBE,EACvBE,EAAWL,EAAMryE,IAAI,QAAUqyE,EAAMryE,IAAI,YAC/CoyE,EAAQ1hE,KAAKgiE,EAASlD,OAAOgD,EAAWC,QAGtC3b,EAAWsb,EAAQ5/D,KAAK,KACjBtO,SAAWvE,EAAMF,E,uBACtB,IAAIyG,MAAJ,0CAC+B5G,EAD/B,aAEFG,EAAQ,GACR+zD,iBAHE,YAGkB7zD,EAAI6zD,iBAHtB,qBAGmDsD,EAAS5yD,OAAOsvD,iBAHnE,6CAIF7zD,EAAMF,GACN+zD,mB,iCAGCsD,G,8IAIPztD,EACA/D,GACA,WACQhG,EAAyC+J,EAAzC/J,QAASG,EAAgC4J,EAAhC5J,MAAOE,EAAyB0J,EAAzB1J,IAAKgzE,EAAoBtpE,EAApBspE,gBAD7B,EAE8CrtE,GAAQ,GAA9CgC,EAFR,EAEQA,OAFR,IAEgBi+B,sBAFhB,MAEiC,aAFjC,EAGA,OAAOj8B,aAAgB,uCAAU,WAAMC,GAAN,uBAAAvH,EAAA,sEACzB,EAAK+jE,MAAMzgE,GADc,cAE/BigC,EAAe,0BAFgB,SAGT,EAAKksC,IAAImB,mBAC7BtzE,EACAG,EACAE,EACA2F,GAP6B,OAGzButE,EAHyB,OAS/BnpE,4BAAiBpC,GATc,eAWVurE,GAXU,6DAWpBvjE,EAXoB,QAYzB0hB,OAZyB,EAaxB1hB,EAAOtP,IAAI,MAba,kCAef,EAAK8yE,SACfH,GAAmBrzE,EACnBgQ,EAAOtP,IAAI,SACXsP,EAAOtP,IAAI,QAlBc,QAe3BgxB,EAf2B,eAqB7BznB,EAASgG,KAAK,IAAI8gE,GAAuB/gE,EAAQ,EAAM0hB,IArB1B,gJAuB/BuU,EAAe,IACfh8B,EAASS,WAxBsB,gEAAV,sDAyBpB1C,K,2EAMO2+D,GACV,GAAIh9D,KAAKyoE,UAAUK,SACjB,OAAO9oE,KAAKyoE,UAAUK,SAAS9L,O,GApKGt9D,2BCtBzB,cACb,MAAO,CACLkH,gBACAQ,kBCJW,YAAC4B,GAEd,OADkBA,EAAc6qC,IAAI,mBAA5Bj+C,MACK2uE,MAAK,kBAChBzvD,8BACE,cACA,CACEuC,aAAc,CACZvQ,KAAM,eACNiO,aAAc,CAAEhd,IAAK,qBAEvBuf,aAAc,CACZxQ,KAAM,eACNiO,aAAc,CAAEhd,IAAK,0BAEvB2sE,gBAAiB17D,EAAc0S,0BAA0B,YAE3D,CAAE1G,iBAAiB,Q,qBCEJ80D,G,WAOnB,WAAYzjE,EAAa0jE,GAAoB,yBALrC1jE,YAKqC,OAHrC2jE,YAGqC,EAC3ChqE,KAAKqG,OAASA,EACdrG,KAAKgqE,OAASD,E,sDAId,OAAO/pE,KAAK/I,O,kCAIZ,OAAO+I,KAAKqG,OAAO4jE,W,mCAInB,OAAOjqE,KAAKqG,OAAO6jE,eAAiB,I,iCAIpC,OAAOlqE,KAAKqG,OAAO6jE,eAAiBlqE,KAAKqG,OAAO8jE,YAAc,I,gDAI9D,OAAOnqE,KAAKqG,OAAO+jE,e,kCAInB,MAAO,U,mCAIP,OAAOpqE,KAAKqG,OAAOgkE,iB,mCAInB,OAAOrqE,KAAKqG,OAAO89D,Q,oCAInB,OAAOnkE,KAAKqG,OAAOghE,yBAA2B,EAAI,I,2CAIlD,OAAOrnE,KAAKqG,OAAOihE,c,kCAInB,OAAQtnE,KAAKqG,OAAOikE,eAAiB,IAClCnpE,KAAI,SAACopE,GAAD,OAAeA,EAAI,MACvBhhE,KAAK,O,oCAIR,OAAOvJ,KAAKgqE,OAAOrC,YAAY3nE,KAAKqG,OAAOmkE,c,qCAI3C,OAAOxqE,KAAKyqE,gB,uCAIZ,QAASzqE,KAAKqG,OAAOqkE,O,6CAIrB,OAAO1qE,KAAKqG,OAAOskE,gBAAkB3qE,KAAKqG,OAAOukE,e,yCAIjD,OAAO5qE,KAAKqG,OAAOqkE,KACf1qE,KAAKgqE,OAAOrC,YAAY3nE,KAAKqG,OAAOqkE,KAAKF,iBACzCzwE,I,sCAIJ,OAAOiG,KAAKqG,OAAOqkE,KAAO1qE,KAAKqG,OAAOqkE,KAAKR,oBAAiBnwE,I,mDAI5D,OAAOiG,KAAKqG,OAAOqkE,KAAZ,UACA1qE,KAAKgqE,OAAOrC,YAAY3nE,KAAKqG,OAAOqkE,KAAKF,YADzC,YAEDxqE,KAAKqG,OAAOqkE,KAAKR,qBAEnBnwE,I,kCAIJ,OAAOiG,KAAKqG,OAAO8hE,O,iCAInB,OAAOnoE,KAAKqG,OAAOyhE,iB,mCAKnB,IAAI/d,EAAM,GACN6a,EAAQ,GACRM,EAAK,IACL2F,EAAQ,EAGN9iD,EAAM/nB,KAAKqG,OAAOykE,WAAW/gB,IAC7BghB,EAAW/qE,KAAKqG,OAAOykE,WAAWt0E,MACpCw0E,EAAWhrE,KAAKqG,OAAO6jE,eACvBe,EAAS,EAgFb,MA/EwC,qBAA7BjrE,KAAKqG,OAAO+jE,aAErBpqE,KAAKqG,OAAO+jE,aAAahkE,SAAQ,YAAiC,IAA9B8kE,EAA8B,EAA9BA,KAAMC,EAAwB,EAAxBA,OAAQC,EAAgB,EAAhBA,IAAKvrE,EAAW,EAAXA,KAcrD,GAbAorE,EAASE,EAASH,EAClBjhB,GAAOhiC,EAAIs+C,UAAU2E,EAAWD,EAAUI,EAASJ,GACnDC,EAAWG,EAEPN,GAAgB,MAAP3F,IACXN,GAASiG,EAAQ3F,EACjB2F,EAAQ,GAENI,IACF/F,EAAK,IACL2F,GAASI,GAGE,MAATC,EAAc,CAEhB,IAAMtpE,EAAM/B,EAAKm3C,MAAM,KACjBq0B,EAAQvsE,OAAOwsE,aAAP,MAAAxsE,OAAM,YAAiB8C,IACrCmoD,GAAOshB,EACPL,GAAYK,EAAMpwE,OAClB4vE,GAASQ,EAAMpwE,WACG,MAATiwE,GAKS,MAATA,GAHTnhB,GAAOqhB,EACPJ,IACAH,KAMkB,MAATK,GAAyB,MAATA,GAEzBF,GAAYnrE,EACRgrE,IAAOjG,GAASiG,EAAQ3F,GAC5BN,GAAS/kE,EAAOqrE,EAChBL,EAAQ,GACU,MAATK,GAAyB,MAATA,GAEzBnhB,GAAOlqD,EACHgrE,IAAOjG,GAASiG,EAAQ3F,GAC5BN,GAAS/kE,EAAK5E,OAASiwE,EACvBL,EAAQ,GACU,MAATK,GAETnhB,GAAOlqD,EACHgrE,IAAOjG,GAASiG,EAAQ3F,GAC5BN,GAAS,GAAJ,OAAO,EAAP,KACLiG,EAAQ,GACU,MAATK,GAELL,IAAOjG,GAASiG,EAAQ3F,GAC5BN,GAAS,GAAJ,OAAO/kE,EAAP,MACa,MAATqrE,IAELL,IAAOjG,GAASiG,EAAQ3F,GAC5BN,GAAS,GAAJ,OAAO/kE,EAAP,KACLgrE,EAAQ,MAIZI,EAASjrE,KAAKqG,OAAOklE,WAAaxhB,EAAI9uD,OAEpC8uD,EAAI9uD,SAAW+E,KAAKqG,OAAOklE,aAC7BN,EAASjrE,KAAKqG,OAAOklE,WAAaxhB,EAAI9uD,OACtC8uD,GAAOhiC,EAAIs+C,UAAU2E,EAAWD,EAAUC,EAAWD,EAAWE,GAE5DJ,GAAgB,MAAP3F,IACXN,GAASiG,EAAQ3F,EACjB2F,EAAQ,GAEV3F,EAAK,IACL2F,GAASI,GAEPJ,IACFjG,GAASiG,EAAQ3F,GAEZN,I,6BAOP,OAHmB3rE,OAAO+uE,oBACxB8B,EAAwBzvE,WAGvByT,QACC,SAAA3U,GAAI,OACFA,EAAK0J,WAAW,UACP,oBAAT1J,GACS,wBAATA,GACS,4BAATA,KAEHgI,KAAI,SAAAi0C,GAAU,OAAIA,EAAW17C,QAAQ,QAAS,S,2BAIjD,OAAOsG,KAAKqG,OAAO4X,SAAW,I,0BAG5BpT,GACF,IAAMuqC,EAAa,QAAH,OAAWvqC,GAE3B,GAAI7K,KAAKo1C,GAAa,OAAOp1C,KAAKo1C,O,2IAelC,OAAO,I,qCAIP,IAAM6vB,EAAajlE,KAAKjJ,IAAI,cAC5B,GAAIkuE,EAAWhqE,OAAQ,CACrB,IAAMoL,GACoB,IAAxBrG,KAAKjJ,IAAI,UACLkuE,EAAWA,EAAWhqE,OAAS,GAC/BgqE,EAAW,GACTn+D,EAAkBT,EAAlBS,KAAMq+D,EAAY9+D,EAAZ8+D,QACd,GAAa,aAATr+D,GAAgC,aAATA,EACzB,OAAOq+D,EAGX,OAAO,I,+BAGyB,WAE1BgD,EAA4B,GAKlC,OAJAnoE,KAAKmoE,OAAO/hE,SAAQ,SAACi6B,GACnB8nC,EAAK9nC,GAAK,EAAKtpC,IAAIspC,MAGrB,2BACK8nC,GADL,IAEE5sE,KAAMyE,KAAKjJ,IAAI,QACf+P,KAAM9G,KAAKjJ,IAAI,QACfknB,SAAUje,KAAK/I,S,wCAKjB,IAAMmzE,EAAepqE,KAAKjJ,IAAI,sBAC9B,IAAKqzE,EAAc,MAAO,GAC1B,IAAM5zE,EAAQwJ,KAAKjJ,IAAI,SACjBkuE,EAAyB,GA4F/B,OA3FAmF,EAAahkE,SACX,YAaM,IAZJ8kE,EAYI,EAZJA,KACAC,EAWI,EAXJA,OACAtrE,EAUI,EAVJA,KACAurE,EASI,EATJA,IACArjD,EAQI,EARJA,IAUA,GADAojD,EAASA,EAAS,EAAI30E,EACT,MAAT00E,EAEFjG,EAAWx9D,KAAK,CACdjR,MAAO20E,EACPlwE,OAAQ,EACR6qD,KAAMslB,EACN5E,QAASz+C,EACTjhB,KAAM,kBAEH,GAAa,MAATokE,EAETjG,EAAWx9D,KAAK,CACdjR,MAAO20E,EACPrkE,KAAM,YACNg/C,KAAM,GAAF,OAAKjmD,EAAK5E,QACdA,OAAQ,SAEL,GAAa,MAATiwE,EAETjG,EAAWx9D,KAAK,CACdX,KAAM,OACN7L,OAAQ4E,EACRrJ,MAAO20E,EACPrlB,KAAM,WAEH,GAAa,MAATolB,EAAc,CAEvB,IAAMt3D,EAAM/T,EAAK5E,OACjBgqE,EAAWx9D,KAAK,CACdjR,MAAO20E,EACPrkE,KAAM,WACNg/C,KAAM,IAAF,OAAMlyC,GACVuxD,QAASvxD,EACT3Y,OAAQ,SAEL,GAAa,MAATiwE,QAEJ,GAAa,MAATA,EAAc,CAEvB,IAAMt3D,EAAM/T,EACZolE,EAAWx9D,KAAK,CACdjR,MAAO20E,EACPrkE,KAAM,WACNg/C,KAAM,IAAF,OAAMlyC,GACVuxD,QAASvxD,EACT3Y,OAAQ,QAEQ,MAATiwE,EAETjG,EAAWx9D,KAAK,CACdX,KAAM,WACN7L,OAAQ4E,EACRrJ,MAAO20E,EACPrlB,KAAM,MAEU,MAATolB,GAES,MAATA,GAES,MAATA,GAES,MAATA,GAGTjG,EAAWx9D,KAAK,CACdjR,MAAO20E,EACPrkE,KAAM,YACNg/C,KAAMjmD,EACN5E,OAAQ,OAOTgqE,I,4CAIP,OAAOjlE,KAAKwrE,sB,KCvWHlzD,GAAb,kDAcE,WACEjT,EACAqrC,GACA,2BACA,cAAMrrC,IAhBAomE,UAeN,IAbM/G,qBAaN,IAXM+D,UAAoB,GAW1B,EARMiD,oBAQN,IALMC,uBAAmC,GAQzC,IAAMt0D,EAAe7R,yBAAeH,EAAQ,gBACtCiS,EAAe9R,yBAAeH,EAAQ,gBAC5C,IAAKgS,EACH,MAAM,IAAIpa,MAAM,iCAElB,IAAKqa,EACH,MAAM,IAAIra,MAAM,iCAElB,EAAKwuE,KAAO,IAAIG,mBAAgB,CAC9BC,eAAgB3sE,wBAAamY,GAC7BnE,MAAO,IAAI44D,aAAU,CAAE3mE,WAAYjG,wBAAaoY,KAChDuyD,SAAU,EAAKA,SAAS1mE,KAAd,iBACV4oE,kBAAkB,EAClBtH,eAAgBp/D,EAAOo/D,gBAAkB,MAG3C,IAAMuH,EAAsBxmE,yBAAeH,EAAQ,CACjD,kBACA,SAGIs2B,EAAW,OAAG+U,QAAH,IAAGA,OAAH,EAAGA,EAClBlrC,yBAAeH,EAAQ,oBACvBs2B,YAEF,KAAIA,aAAuBj8B,2BAGzB,MAAM,IAAIzC,MAAJ,sEAC2D+uE,EAD3D,MA/BR,OA6BE,EAAKtH,gBAAkB/oC,EA7BzB,EAjBJ,+FAsDkBt/B,GAtDlB,0FAuDW2D,KAAKyrE,KAAKA,KAAKQ,aAAa5vE,IAvDvC,+KA0DyB6vE,EAAe11E,EAAeE,GA1DvD,oFA2DIF,GAAS,EAEHyyE,EAAcjpE,KAAK0kE,gBA7D7B,8CA8D6B3qE,GA9D7B,UA+DU1D,EAAU2J,KAAKmsE,oBAAoBD,IAAUlsE,KAAK2nE,YAAYuE,GA/DxE,8CAiEyBnyE,GAjEzB,cAmEUuY,EAAW22D,EAAYvoE,YAC3B,CACErK,UACAG,QACAE,MACAiB,aAAc,IAEhB,IA1EN,UA6E4B2a,EAAS3R,KAAKwiD,gBAAW/mB,YA7ErD,WA6EU8sC,EA7EV,OA+EUC,EAAoB,GAC1BD,EACGt/C,MAAK,SAAC7wB,EAAYC,GAAb,OAA4BD,EAAEhC,IAAI,SAAWiC,EAAEjC,IAAI,YACxDqP,SAAQ,SAACgjE,GACR,IAAMC,EAAaD,EAAMryE,IAAI,SACvBuyE,EAAWF,EAAMryE,IAAI,OACrBwyE,EAAY7kE,KAAKuM,IAAIza,EAAQ6yE,EAAY,GAEzCG,EADU9kE,KAAKC,IAAIjO,EAAM2yE,EAAYC,EAAWD,GACzBE,EACvBE,EAAWL,EAAMryE,IAAI,QAAUqyE,EAAMryE,IAAI,YAC/CoyE,EAAQ1hE,KAAKgiE,EAASlD,OAAOgD,EAAWC,QAGtC3b,EAAWsb,EAAQ5/D,KAAK,KACjBtO,SAAWvE,EAAMF,EA7FlC,uBA8FY,IAAIyG,MAAJ,0CAC+B5G,EAD/B,aAEFG,EAAQ,GACR+zD,iBAHE,YAGkB7zD,EAAI6zD,iBAHtB,qBAGmDsD,EAAS5yD,OAAOsvD,iBAHnE,6CAIF7zD,EAAMF,GACN+zD,mBAnGV,iCAsGWsD,GAtGX,iLAyGsBxxD,GAzGtB,qFA0G0CA,GAAQ,IAAtCigC,sBA1GZ,MA0G6B,aA1G7B,EA2G+C,IAAvCrjC,OAAOC,KAAK8G,KAAKyoE,WAAWxtE,OA3GpC,wBA4GMqhC,EAAe,qBA5GrB,SA6G8Bt8B,KAAKyrE,KAAKA,KAAKQ,aAAf,OAA4B5vE,QAA5B,IAA4BA,OAA5B,EAA4BA,EAAMgC,QA7GhE,OA6GYoqE,EA7GZ,OAiHYK,EAAqB,GACrBC,EAAmC,GACzBN,EAAU36D,QAAO,SAAChT,GAAD,MAAkC,OAAVA,EAAEwO,OACnDlD,SAAQ,SAAC4iE,EAAgChM,GAC/CgM,EAAOnpE,KAAKuG,SAAQ,SAAC+qB,GACnB,GAAiB,OAAbA,EAAK7nB,IAAc,CAErB,IAAMjT,EAAU86B,EAAKxnB,MACrBo/D,EAAS1yE,GAAW2mE,EACpB8L,EAAS9L,GAAS3mE,SAIpByyE,EAAS7tE,SACX+E,KAAKyoE,UAAY,CAAEK,WAAUC,aAE/BzsC,EAAe,IAjIrB,mLAqIoBjgC,GArIpB,iFAsIU2D,KAAK88D,MAAMzgE,GAtIrB,WAuIQ2D,KAAKyoE,UAAUK,SAvIvB,yCAwIa9oE,KAAKyoE,UAAUK,UAxI5B,WA0IQ9oE,KAAK0kE,gBA1Ib,yCA2Ia1kE,KAAK0kE,gBAAgBtjE,eA3IlC,aA6IU,IAAInE,MAAM,0BA7IpB,yIAkJc5G,GACV,OAAI2J,KAAKyoE,UAAUM,SACV/oE,KAAKyoE,UAAUM,SAAS1yE,GAE7B2J,KAAK0rE,eACA1rE,KAAK0rE,eAAeU,QAAQ/1E,QADrC,IAtJJ,kCA8Jc2mE,GACV,OAAIh9D,KAAKyoE,UAAUK,SACV9oE,KAAKyoE,UAAUK,SAAS9L,GAE7Bh9D,KAAK0rE,eACA1rE,KAAK0rE,eAAe1O,QAD7B,IAlKJ,0CAwKsBA,GAClB,OAAOh9D,KAAK2rE,uBAAuB3O,KAzKvC,kCA6KI58D,EACA/D,GACA,aAC8CA,GAAQ,GAA9CgC,EADR,EACQA,OADR,IACgBi+B,sBADhB,MACiC,aADjC,EAEQjmC,EAAyC+J,EAAzC/J,QAASG,EAAgC4J,EAAhC5J,MAAOE,EAAyB0J,EAAzB1J,IAAKgzE,EAAoBtpE,EAApBspE,gBAE7B,OAAOrpE,aAAgB,uCAAU,WAAMC,GAAN,iBAAAvH,EAAA,sEACzB,EAAK+jE,MAAMzgE,GADc,WAE3B,EAAKqoE,iBAAoB,EAAKgH,eAFH,gCAGD,EAAKhH,gBAAgBtjE,YAAY/E,GAHhC,OAG7B,EAAKqvE,eAHwB,sBAMjB3xE,KADRijE,EAAQ,EAAKqP,YAAYh2E,IALA,wBAOzBqzE,IACF,EAAKiC,uBAAuB3O,GAAS0M,GAEvCptC,EAAe,0BAVc,UAWP,EAAKmvC,KAAK9B,mBAC9B3M,EACAxmE,EACAE,EACA2F,GAf2B,QAWvButE,EAXuB,OAiB7BnpE,4BAAiBpC,GAEjBurE,EAAQxjE,SAAQ,SAACC,GACf/F,EAASgG,KAAK,EAAKgmE,oBAAoBjmE,OApBZ,QAuB/Bi2B,EAAe,IACfh8B,EAASS,WAxBsB,4CAAV,sDAyBpB1C,KA5MP,mFAkNsBgI,GAClB,OAAO,IAAIyjE,GAAwBzjE,EAAQrG,UAnN/C,GAAiCN,2BAuNlB,cACb,OAAO4Y,IC9OM,YAACtP,GACd,MAAO,CACLpC,aAAcoC,EAAciwB,KAAKszC,IACjCnlE,aAAc4B,EAAciwB,KAAKuzC,MCJtB52E,WAAM2uE,MAAK,kBACxBzvD,8BACE,mBACA,CACE23D,WAAY,CACV3lE,KAAM,SACNiO,aAAc,IAEhB23D,cAAe,CACb5lE,KAAM,SACNiO,aAAc,IAEhB2vD,gBAAiB,CACf59D,KAAM,SACNiO,aAAc,OAGlB,CAAEC,iBAAiB,OCbF23D,G,wKACTtnE,EAA+BqrC,GACvC,IAAM+7B,EAAajnE,yBAAeH,EAAQ,cACpCqnE,EAAgBlnE,yBAAeH,EAAQ,iBAC7CrF,KAAKwoE,IAAM,IAAIoE,cAAW,CACxBC,QAASJ,EACTvzD,QAASwzD,IAGX,IAAMlyD,EAAgBhV,yBAAeH,EAAQ,mBAC7C,GAAImV,GAAiBk2B,EAAe,KAC1B/U,EAAgB+U,EAAcl2B,GAA9BmhB,YACR37B,KAAK0kE,gBAAkB/oC,O,GAZiBtjB,ICH/B,cACb,MAAO,CACLzR,gBACAQ,kBCwDW0lE,GA1DY,SAAC9jE,GAC1B,IAAM+jE,EAA6B/jE,EAAc2Q,gBAC/C,kBACA/S,aACIomE,EAAiChkE,EAAc2Q,gBACnD,sBACA/S,aACIqmE,EAAkCjkE,EAAc2Q,gBACpD,uBACA/S,aAEF,OAAOkO,8BACL,0BACA,CACEguD,UAAW,CACTh8D,KAAM,aACNiO,aAAc,QACd5d,MAAOvB,QAAMo/D,YAAY,iBAAkB,CAAC,UAC5C7sD,YAAa,2CAEfu4D,SAAU,CACR55D,KAAM,SACNiO,aAAcikC,OAAO2jB,UACrBx0D,YAAa,8CAEfs4D,SAAU,CACR35D,KAAM,SACNqB,YAAa,6CACb4M,aAAcikC,OAAOC,WAEvB0kB,UAAW,CACT72D,KAAM,aACN3P,MAAOvB,QAAMo/D,YAAY,aAAc,CAAC,SAAU,QAClD7sD,YAAa,4CACb4M,aAAc,UAEhBm4D,SAAU,CACRpmE,KAAM,SACNqB,YACE,0EACF4M,aAAc,IAEhBiuD,iBAAkB,CAChBl8D,KAAM,aACN3P,MAAOvB,QAAMo/D,YAAY,YAAa,CAAC,SAAU,QACjDjgD,aAAc,UAEhBkuD,UAAWnuD,8BAAoB,yBAA0B,CACvDq4D,eAAgBJ,EAChBK,mBAAoBJ,EACpBK,oBAAqBJ,KAGzB,CAAE7qB,kBAAmBxJ,GAA+B5jC,iBAAiB,K,sBCkH1DqtC,GA3JW,SACxBr5C,EACApC,GAEA,OAAOhR,QACJ8B,QACC,0BACA0hB,GACAxjB,QAAMuB,MAAM,CACVm2E,cAAe13E,QAAMqC,MACnB+Q,EAAcuQ,eAAe,uBAAuBjS,YAEtDimE,mBAAoB33E,QAAMqC,MACxB+Q,EAAcuQ,eAAe,4BAA4BjS,YAE3DR,KAAMlR,QAAMqkB,QAAQ,2BACpBnE,cAAeoE,iCAAuBtT,GACtCqd,OAAQ,IACRupD,cAAc,EACdC,YAAY,KAGfp7D,UAAS,iBAAO,CACf4sC,UAAW,MAEZ3nD,SAAQ,SAAAC,GAAI,MAAK,CAChBm2E,eADgB,WAEdn2E,EAAKi2E,cAAgBj2E,EAAKi2E,cAE5BG,aAJgB,WAKdp2E,EAAKk2E,YAAcl2E,EAAKk2E,YAE1B7sB,aAPgB,SAOH3B,GACX1nD,EAAK0nD,UAAYA,OAGpBrsC,OAAM,SAAArb,GAAQ,IACLilB,EAAmBjlB,EAAnBilB,eACR,MAAO,CACL,0BACE,IAAM7gB,EAAO6d,kBAAQjiB,GADG,EAEiBoE,EAAKsnE,UAAd3qE,GAFR,EAEhB+0E,oBAFgB,yCAGxB,kCACK1xE,GADL,IAEEsnE,UAAW,eACN3qE,GAELwO,KAAM,sBACNvL,KAAM,GAAF,OAAKie,kBAAQvD,oBAAU1e,EAAM,GAAI,QAAjC,WACJgkB,UAAW,GAAF,OAAKhkB,EAAKue,cAAcyF,UAAxB,kBAIb,qBACE,OAAOhkB,EAAK+1E,cAAc3tB,gBAG5B,eACE,OAAOpoD,EAAK+1E,cAAch7D,UAG5B,mBAAmB,MACjB,iBAAO/a,EAAK+1E,qBAAZ,aAAO,EAAoBne,cAG7B,eACE,OAAO53D,EAAK+1E,cAAcM,UAE5B,uBACE,OAAOr2E,EAAK+1E,cAAcO,kBAE5B,sBACE,OAAOt2E,EAAK+1E,cAAcQ,iBAG5B,+BACE,IAAMnyE,EAAO6d,kBAAQjiB,GACb81E,EAAwB1xE,EAAKsnE,UAA7BoK,oBACR,kCACK1xE,GADL,IAEEsnE,UAAW,CACToK,uBAEFvmE,KAAM,2BACNvL,KAAM,GAAF,OAAKie,kBAAQvD,oBAAU1e,EAAM,GAAI,QAAjC,WACJgkB,UAAW,GAAF,OAAKhkB,EAAKue,cAAcyF,UAAxB,uBAIb,qBACE,4BACKiB,GADL,YAEKjlB,EAAK+1E,cAAcS,wBAFxB,YAGKx2E,EAAKg2E,mBAAmBQ,8BAKlCz2E,SAAQ,SAAAC,GAAI,MAAK,CAChB4d,YADgB,WAEdqrC,sBACEjpD,EACA6oD,mBAAQ,WACD7oD,EAAKg2E,mBAIPxrC,KACCxqC,EAAKy2E,yBACLjuE,sBAAYxI,EAAKg2E,mBAAmBz3D,iBAGtCve,EAAKg2E,mBAAmBU,UAAU12E,EAAKy2E,0BAPvCz2E,EAAK22E,sBAAsB32E,EAAKy2E,0BAU7Bz2E,EAAK+1E,cAIPvrC,KACCxqC,EAAK42E,oBACLpuE,sBAAYxI,EAAK+1E,cAAcx3D,iBAGjCve,EAAK+1E,cAAcW,UAAU12E,EAAK42E,qBAPlC52E,EAAK62E,iBAAiB72E,EAAK42E,0BAYnCD,sBA/BgB,SA+BMG,GACpB92E,EAAKg2E,mBAAqB,CACxBzmE,KAAM,2BACNgP,cAAeu4D,EACfpqD,OAAQ,KAGZmqD,iBAtCgB,SAsCCC,GACf92E,EAAK+1E,cAAgB,CACnBxmE,KAAM,sBACNgP,cAAeu4D,IAGnB5tB,UA5CgB,SA4CNxD,GAGR,OAFsC1lD,EAAK0sB,OAAvCg5B,EAhJa,GAgJmCA,EAhJnC,GAkJV1lD,EAAK0sB,QAEdy8B,aAjDgB,SAiDH/rC,GACX,IAAMgsC,EAAYppD,EAAK0sB,OAEvB,OADkBjkB,KAAKygD,UAAUlpD,EAAK0sB,OAAStP,GAC5BgsC,QC5GZrgD,2BArDf,YAIG,IAHDnJ,EAGC,EAHDA,MAIQm2E,EAAgEn2E,EAAhEm2E,cAAeC,EAAiDp2E,EAAjDo2E,mBAAoBE,EAA6Bt2E,EAA7Bs2E,WAAYD,EAAiBr2E,EAAjBq2E,aAOvD,OAJAzoD,qBAAU,WACRwoD,EAAmB9sB,UAAWgtB,EAA4B,GAAft2E,EAAM8sB,UAChD,CAACspD,EAAoBp2E,EAAOs2E,IAG7B,yBACEnmD,cAAA,kBAAwB9N,kBAAQriB,EAAO,cACvC8U,MAAO,CAAE7H,SAAU,aAEnB,yBAAKkjB,cAAY,wBACdkmD,EACC,kBAACD,EAAmB1xB,mBAApB,CAAuC1kD,MAAOo2E,IAC5C,MAEN,kBAAC,GAAD,CACEjpD,OAAQ,SAAAstC,GACN,OAAI2b,GACFA,EAAmB9sB,UAAU8sB,EAAmBtpD,OAAS2tC,GAClDA,GAEF,GAET3lD,MAAO,CACL7H,SAAU,WACV+hB,IAAKqnD,EAAeD,EAAmBtpD,OAAS,EAAI,EACpDA,OAAQ,KAIZ,yBACEqD,cAAY,kBACZrb,MAAO,CACL7H,SAAU,WACV+hB,IAAKqnD,EAAeD,EAAmBtpD,OAAS,EAAI,EACpDA,OAAQ,IAGTwpD,EACC,kBAACH,EAAczxB,mBAAf,CAAkC1kD,MAAOm2E,IACvC,UCbGgB,OAnCf,SAA6BtlE,GAC3B,IAAM+jE,EAA6B/jE,EAAc2Q,gBAC/C,kBACA/S,aACIomE,EAAiChkE,EAAc2Q,gBACnD,sBACA/S,aAGF,OAAOkO,8BACL,sBACA,CACEkuD,iBAAkB,CAChBl8D,KAAM,aACN3P,MAAOvB,QAAMo/D,YAAY,YAAa,CAAC,SAAU,QACjDjgD,aAAc,UAEhBkuD,UAAWnuD,8BAAoB,yBAA0B,CACvDq4D,eAAgBJ,EAChBK,mBAAoBJ,IAEtBj0B,oBAAqB,CACnBjyC,KAAM,SACNqB,YAAa,gDACb4M,aAAc,MAGlB,CAAEqtC,kBAAmBxJ,GAA+B5jC,iBAAiB,K,sBCA1D1U,2BAlBf,SAAkCyG,GAAsC,IAC9D5P,EAAU4P,EAAV5P,MACAy2E,EAAaz2E,EAAby2E,SACR,OAAOA,EACL,yBACEtmD,cAAA,gBAAsBnwB,EAAMy2E,UAC5B3hE,MAAO,CAAEd,gBAAiB,UAE1B,kBAAC,KAAD,CAAYX,MAAM,YAAY8B,QAAQ,WACnCnV,EAAMy2E,SAAN,oBACgBA,EAAS9mE,KAAKiG,cAD9B,eACkD6gE,EAASv3E,QAD3D,YAEKu3E,EAASloD,KAEX,OAGN,QCDA0tB,GAAgB,IAAI3qC,IAAI,CAC5B,CAAC,SAAU,kBACX,CAAC,MAAO,wBAgRK45C,GA3QW,SACxBr5C,EACApC,GAFwB,OAIxBhR,QACG8B,QACC,sBACA+iD,GACA7kD,QAAMuB,MAAM,CACV2P,KAAMlR,QAAMqkB,QAAQ,uBACpBnE,cAAeoE,iCAAuBtT,GACtC2nE,kBAAkB,EAClBX,SAAUh4E,QAAMqC,MACdrC,QAAMuB,MAAM,CACV2P,KAAMlR,QAAMU,OACZovB,IAAK9vB,QAAMa,OACXJ,QAAST,QAAMU,OACfqB,aAAc/B,QAAMU,aAK3B+b,UAAS,iBAAO,CACf8tD,OAAO,EACPqO,YAAa,MAGdl3E,SAAQ,SAAAC,GAAI,MAAK,CAChBk3E,SADgB,SACPC,GACPn3E,EAAK4oE,MAAQuO,GAEfC,eAJgB,SAIDj7D,GACbnc,EAAKi3E,YAAc96D,OAGtBpc,SAAQ,SAAAC,GAAI,MAAK,CAChB4d,YADgB,WAEdqrC,sBACEjpD,EACA6oD,kBAAO,sBACL,4CAAArnD,EAAA,oEAE2BugB,sBAAW/hB,GAA1B8jC,EAFZ,EAEYA,WACAuyC,EAA0Br2E,EAA1Bq2E,SAAUl3D,EAAgBnf,EAAhBmf,YACZuE,EAAOC,6BAAkB3jB,IAC3Bq2E,EALR,wBAMcloD,EAA+BkoD,EAA/BloD,IAAKrvB,EAA0Bu3E,EAA1Bv3E,QAASsB,EAAiBi2E,EAAjBj2E,aAChByI,EAAS,CACb5J,MAAOkvB,EACPhvB,IAAKgvB,EAAM,EACXrvB,UACAsB,gBAXR,SAgBaJ,EAAKw6C,aAAqB4M,eAAetjB,EAAY,CAC1D1jC,eACAqJ,QAAS,CAACZ,GACVoa,cAAejjB,EAAKijB,cACpBu3B,aAAcx6C,EAAKw6C,aAAax2C,KAChCmb,cACA6kB,UAAWrlB,GAAgB3e,GAC3BwiC,QAAS,MAvBjB,OAyBMxiC,EAAKk3E,UAAS,GACdl3E,EAAKo3E,eAAe1zD,EAAKlV,SA1B/B,wBA4BMxO,EAAKk3E,UAAS,GA5BpB,0DA+BIl3E,EAAKsiB,SAAS,KAAMoU,SA/BxB,0DAkCA,CAAEwvB,MAAO,QAIfsD,cA3CgB,SA2CFt0C,GACZ,IAAMgO,EAAUnB,sBAAW/hB,GAC3B,GAAIypD,qCAA0BvmC,GAAU,CACtC,IAAMwmC,EAAgBxmC,EAAQymC,UAC5B,0BACA,mBACA,CAAE/yC,YAAa1B,EAAQ+R,WAEzB/D,EAAQ0mC,WAAWF,GAErBxmC,EAAQ4mC,aAAa50C,IAGvBmiE,cAxDgB,WAyDdr3E,EAAKq2E,cAAW7zE,GAIlB80E,uBA7DgB,SA6DOpiE,GACrB,IAAMqiE,EAAgBriE,EAAQ+R,gBACvBswD,EAAc7wD,SACrB,IAAMxD,EAAUnB,sBAAW/hB,GAC3BkN,KAAK8I,KAAKC,UAAUshE,EAAe,KAAM,IACzCr0D,EAAQ4xC,OAAO,sBAAuB,YAGxC0iB,mBArEgB,WAsEdx3E,EAAKg3E,kBAAoBh3E,EAAKg3E,kBAGhCN,UAzEgB,SAyENn4D,GACRve,EAAKue,cAAgBA,GAGvBk5D,aA7EgB,SA6EHloE,GAAc,IACjB0qD,EAAmBt2C,6BAAkB3jB,GAArCi6D,eACR,GAAKA,EAAL,CAFyB,IAKjBn7D,EAAkCm7D,EAAlCn7D,QAASsB,EAAyB65D,EAAzB75D,aAAcwM,EAAWqtD,EAAXrtD,OACzBq1D,EAAW90D,KAAK2O,MAAMlP,GAAU,EAChC8qE,EAAgB54E,EAElBmjE,EAAW,GAIfx5D,KAAKkvE,YAAY,CACfpoE,OACA4e,IAAK8zC,EACLnjE,QAAS44E,EACTt3E,mBAGJu3E,YAjGgB,SAiGJtlD,GAMVryB,EAAKq2E,SAAWhkD,EAChBryB,EAAK4oE,OAAQ,OAGhB7oE,SAAQ,SAAAC,GAEP,IAAMupE,EAAcvpE,EAAKuiB,OACzB,MAAO,CACLA,OADK,WAEHviB,EAAKq3E,gBACL9N,SAILluD,OAAM,SAAArb,GAAQ,IACLilB,EAAmBjlB,EAAnBilB,eACR,MAAO,CACL,uBACE,IAAMgkD,EAAWhnD,kBAAQjiB,EAAM,oBACzBw6C,EAAeqB,GAAcr8C,IAAIypE,GACvC,IAAKzuB,EACH,MAAM,IAAI90C,MAAJ,uCAA0CujE,IAElD,OAAOzuB,GAGT,uBACE,IAAM9jC,EAAO1W,EAAKwnD,mBACZhE,EAAmB9sC,EACrB,CACE,CACEtV,MAAO,uBACPskB,KAAM2kC,KACN7kC,QAAS,WACPxlB,EAAK+pD,wBACDrzC,GACF1W,EAAKwpD,cAAc9yC,KAIzB,CACEtV,MAAO,yBACPskB,KAAMkyD,GACNpyD,QAAS,WACH9O,GACF1W,EAAKs3E,uBAAuB5gE,MAKpC,GAOJ,OANA1W,EAAKynD,mCAAmC54C,SACtC,SAACpM,GACC,IAAM2gB,EAAY3gB,EAASiU,EAAM1W,EAAMyR,GACvC+xC,EAAiBtzC,KAAjB,MAAAszC,EAAgB,YAASpgC,OAGtBogC,GAGT,kBACE,MAAO,CAAC,iBAAkB,cAAe,YAAa,eAGxD,mBACE,OAAOq0B,IAGT,kBACE,IAAMn0D,EAAOC,6BAAkB3jB,GACzB8N,EAAS9N,EAAKw6C,aAAanrC,aAAajF,OAC5C6X,kBAAQjiB,EAAM,CAAC,YAAaA,EAAK8hB,oBAAsB,IAEzD,8CACK9hB,EAAK0qD,qBACLzrC,GAAqBjf,IAF1B,IAGEmnD,UACGnnD,EAAK4oE,OACL5oE,EAAKq2E,UAAYr2E,EAAKi3E,cAAgBvzD,EAAKlV,QAC9C2T,aAAcniB,EACdq2E,SAAUr2E,EAAKq2E,SACfv6C,aAAc97B,EAAKg3E,iBACnBlpE,YAIJ,6BACE,MAAO,CACL,CACE1M,MAAO,qBACPskB,KAAMk9C,KACNrzD,KAAM,WACNkW,QAASzlB,EAAKg3E,iBACdxxD,QAAS,WACPxlB,EAAKw3E,qBAGDx3E,EAAKg3E,kBACPh3E,EAAKq3E,kBAIX,CACEj2E,MAAO,UACPskB,KAAMoyD,KACNznD,SAAUrwB,EAAKg3E,iBACfzjD,QAAS9qB,KAAKsvE,YAAYnuE,KAAI,SAACouE,GAC7B,MAAO,CACL52E,MAAO42E,EACPxyD,QAFK,WAGQ,eAAXwyD,EACIh4E,EAAKq3E,gBACLr3E,EAAKy3E,aAAaO,WAQlC,qBACE,4BAAW/yD,GAAX,YAA8Bxc,KAAK+tE,+BChS7C,IAAM9jE,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCy1D,OAAQ,CACNt+C,SAAU,QACVyE,OAAQ5b,EAAM4b,OAAOw1B,QACrB5hB,cAAe,QAGjBkmC,cAAe,CACbn1D,WAAY,OACZe,OAAQ,OACRwE,MAAO,EACPgU,OAAQ,OACRkC,IAAK,EACLpC,OAAQ,UACR3f,SAAU,WACVu1B,cAAe,YAInB,SAASmmC,GAAT,GAA4D,IACpD3L,EADoD,EAAjC1nD,QACJ1V,IAAI,WACnBy4E,EAAQrb,EACVA,EAAKA,EAAKhzD,KAAI,SAAClF,GAAD,OAAYA,EAAE6pD,QAAMsmB,QAAQ,UAAU5P,MACpD,EACEiT,EAAStb,GAAQA,EAAKl5D,QAAU,EAAI,YAAc,OACxD,OACE,+BACE,+BACE,4BACE,wBAAIhE,GAAIw4E,GAAR,QACA,wBAAIx4E,GAAIw4E,GAAR,SACA,wBAAIx4E,GAAIw4E,GAAR,cACA,wBAAIx4E,GAAIw4E,GAAR,aAGJ,gCACItb,GAAQ,IAAIhzD,KAAI,SAACmlE,GAAkB,IAC3BxgB,EAAyBwgB,EAAzBxgB,KAAM0W,EAAmB8J,EAAnB9J,MAAOkT,EAAYpJ,EAAZoJ,QACrB,OACE,wBAAI5iE,IAAKg5C,GACP,wBAAI7uD,GAAIw4E,GAAS3pB,EAAK3uC,eACtB,wBAAIlgB,GAAIw4E,GAASjT,GACjB,wBAAIvlE,GAAIw4E,GACI,UAAT3pB,EACG,MADH,UAEMphD,KAAKsN,MAAOwqD,EAAQgT,EAAS,KAFnC,MAIH,wBAAIv4E,GAAIw4E,GACI,UAAT3pB,EACG,OACC4pB,EAAQ,KAAR,YACQA,EAAQ,KADhB,YACwBA,EAAQ,KAAR,WADxB,UAEUA,EAAQ,KAAR,YAAoBA,EAAQ,MAA5B,WAW/B,IAwCe91C,GAxCCt5B,oBACd,YAQM,IAPJnJ,EAOI,EAPJA,MACA8sB,EAMI,EANJA,OACAs2B,EAKI,EALJA,WAMQC,EAAsBrjD,EAAtBqjD,kBACF3uC,EAAU5B,KAEhB,OAAOuwC,EACL,oCACE,kBAAC,KAAD,CACE7sC,UAAU,cACVtB,UAAWR,EAAQ+zD,OACnBv5C,MAAI,EACJta,MAAO,kBAAC,GAAD,CAAiBU,QAAS+tC,KAEjC,yBACEvuC,MAAO,CACL7H,SAAU,WACVojB,KAAM+yB,EAAW,GACjBp0B,IAAK,IAGN,MAGL,yBACE9Z,UAAWR,EAAQg0D,cACnB5zD,MAAO,CAAEub,KAAM+yB,EAAW,GAAIt2B,aAGhC,QCnGFmvB,GAAgB,IAAI3qC,IAAI,CAAC,CAAC,cAAe,yBA2ChC45C,GAxCW,SAACz7C,GAAD,OACxBhR,QACG8B,QACC,2BACA2rE,GAAgCz8D,GAChChR,QAAMuB,MAAM,CAAE2P,KAAMlR,QAAMqkB,QAAQ,+BAEnC3iB,SAAQ,SAAAC,GAAI,MAAK,CAChB02E,UADgB,SACNn4D,GACRve,EAAKue,cAAgBA,OAGxBlD,OAAM,SAAArb,GAAI,MAAK,CACd,uBACE,OAAOqiC,IAGT,oBAEE,MAAO,CACL9yB,KAAM,qBACN6oE,WAHiBn2D,kBAAQjiB,EAAKkiB,YAAa,aAO/C,uBACE,OAAO25B,GAAcr8C,IAAI,gBAG3B,oBACE,OAAO,GAGT,uBACE,MAAO,SCkKAuJ,2BAvMf,SAAyByG,GAStB,IAECmjB,EAQEnjB,EARFmjB,YACAwQ,EAOE3zB,EAPF2zB,SACAhhB,EAME3S,EANF2S,aACAzJ,EAKElJ,EALFkJ,MACAgU,EAIEld,EAJFkd,OACAjjB,EAGE+F,EAHF/F,QACA+E,EAEEgB,EAFFhB,QACA6nE,EACE7mE,EADF6mE,SATD,EAgBGl0D,GAAgB,GAJlBihB,EAZD,EAYCA,kBACAmkB,EAbD,EAaCA,oBACAC,EAdD,EAcCA,mBACAW,EAfD,EAeCA,oBAEKt/C,EAjBN,YAiBgBY,EAjBhB,MAkBK4uE,EAAyB9qD,iBAA0B,MAlBxD,EAmBqCJ,oBAAS,GAnB9C,mBAmBMmrD,EAnBN,KAmBmBC,EAnBnB,OAoB+DprD,oBAC9D,GArBD,mBAoBMqrD,EApBN,KAoBgCC,EApBhC,KAoHD,SAAShrD,EAAUC,GACb4qD,GACFG,GAA4B,GAE9B,IAAIn2C,EAAU,EACVC,EAAU,EACV81C,EAAuBzqD,UACzB0U,EAAU+1C,EAAuBzqD,QAAQ+D,wBAAwB1B,KACjEsS,EAAU81C,EAAuBzqD,QAAQ+D,wBAAwB/C,KAEnE0T,EAAU5U,EAAMi2B,QAAUrhB,EAC1BC,EAAU7U,EAAMk2B,QAAUrhB,EAC1B,IAAMvmB,EAAKnT,EAAOhJ,SAAW6Y,EAAQ4pB,EAAUA,EACzCmlC,EAAW5+D,EAAO5J,MAAQuP,EAAUwN,EAEpC6pD,EAAQ1jD,EAAasmC,sBACzBtlB,EACAskC,EACAllC,GAEIm2C,EAAmB7S,EAAMniE,OAASmiE,EAAM,GAAG7hE,UAAOxB,EAEpDmwB,GACFA,EAAYjF,EAAOgrD,GAIvB,SAASC,EAAiBC,EAAqBlrD,GAE7C,IAAMmrD,EAAiBrpE,EAAM,YAAD,OAAaopE,IAEnCE,EAAgBtpE,EAAM,KAAD,OAAMopE,IAC7BC,GAAkBtxB,EACpBsxB,EAAenrD,EAAO65B,GACbuxB,GACTA,EAAcprD,EAAO65B,GAhIzB/5B,qBAAU,WACR,IAAMwN,EAASq9C,EAAuBzqD,QACtC,GAAKoN,EAAL,CACA,IAAMssC,EAAMtsC,EAAOiB,WAAW,MAC9B,GAAKqrC,EAAL,CAEA,IAAI51C,EACAqnD,EAEJ,GAJAzR,EAAI0R,UAAU,EAAG,EAAGh+C,EAAOtiB,MAAOsiB,EAAOtO,QAKvC0W,IACC21C,EAAc5wB,EAAoB3oD,IAAI2jC,MACtCzR,EAAOqnD,EAAYv5E,IAAI4jC,IACxB,OAC2C1R,EAD3C,mBACOunD,EADP,KACeC,EADf,KACsBC,EADtB,KAC+BC,EAD/B,OAE0BC,oBAASJ,EAAQE,EAAStwE,EAAQ2F,GAF5D,mBAEOgL,EAFP,KAEeC,EAFf,KAGM6/D,EAAUnsE,KAAK2O,MAAMo9D,GACrBK,EAAapsE,KAAK2O,MAAMs9D,EAAWF,GACzC5R,EAAIkS,YAAc,UAClBlS,EAAImS,WAAa,GACjBnS,EAAIoS,SAAW,QACfpS,EAAIqS,UAAY,EAChBrS,EAAIlrC,YAAc,UAClBkrC,EAAIsS,WACFpgE,EAAS,EACT8/D,EAAU,EACV7/D,EAAUD,EAAS,EACnB+/D,EAAa,GAEfjS,EAAI0R,UAAUx/D,EAAQ8/D,EAAS7/D,EAAUD,EAAQ+/D,GAEnD,IAAMM,EAAqBtyB,IAAmB,OAAIC,QAAJ,IAAIA,OAAJ,EAAIA,EAAoB9nD,MACtE,GACEm6E,IACCd,EAAc5wB,EAAoB3oD,IAAI2jC,MACtCzR,EAAOqnD,EAAYv5E,IAAIq6E,IACxB,OAC2CnoD,EAD3C,mBACOunD,EADP,KACeC,EADf,KACsBC,EADtB,KAC+BC,EAD/B,OAE0BC,oBAASJ,EAAQE,EAAStwE,EAAQ2F,GAF5D,mBAEOgL,EAFP,KAEeC,EAFf,KAGM6/D,EAAUnsE,KAAK2O,MAAMo9D,GACrBK,EAAapsE,KAAK2O,MAAMs9D,EAAWF,GACzC5R,EAAIjrC,UAAY,QAChBirC,EAAIU,SAASxuD,EAAQ8/D,EAAS7/D,EAAUD,EAAQ+/D,QAEjD,CACD/qE,EACA3F,EACAu6B,EACAmkB,EACAC,EACArkB,EACAglB,IAiFF,IAAM2xB,EAAc3sE,KAAKkN,KAAK3B,GAE9B,OACE,yBACE5D,UAAU,kBACVib,cAAA,iBAAuBsmD,EAAWA,EAAS9mE,KAAO,UAClDmF,MAAO,CAAE7H,SAAU,WAAY6L,MAAOohE,EAAaptD,WAEnD,kBAAC,GAAD,iBACMld,EADN,CAEEkF,MAAO,CAAE7H,SAAU,WAAYojB,KAAM,EAAGrB,IAAK,MAE/C,4BACEmB,cAAY,wBACZrX,MAAOohE,EACPptD,OAAQA,EACRhY,MAAO,CAAE7H,SAAU,WAAYojB,KAAM,EAAGrB,IAAK,GAC7C9Z,UAAU,yBACV0b,IAAK6nD,EACLnqD,YAAa,SAAAR,GAAK,OAjGxB,SAAqBA,GACnB6qD,GAAe,GACfE,GAA4B,GAC5BE,EAAiB,YAAajrD,GA8FJQ,CAAYR,IAClCqsD,aAAc,SAAArsD,GAAK,OA5FzB,SAAsBA,GACpBirD,EAAiB,aAAcjrD,GA2FJqsD,CAAarsD,IACpCyP,WAAY,SAAAzP,GAAK,OAzFvB,SAAoBA,GAClBirD,EAAiB,WAAYjrD,GAC7BirD,EAAiB,aAAcjrD,GAuFNyP,CAAWzP,IAChCwP,YAAa,SAAAxP,GAAK,OArFxB,SAAqBA,GACnBirD,EAAiB,YAAajrD,GAoFJwP,CAAYxP,IAClC2tC,UAAW,SAAA3tC,GAAK,OAlFtB,SAAmBA,GACjB6qD,GAAe,GACfI,EAAiB,UAAWjrD,GAgFJ2tC,CAAU3tC,IAC9B+8B,aAAc,SAAA/8B,GAAK,OAxEzB,SAAsBA,GACpBirD,EAAiB,WAAYjrD,GAC7BirD,EAAiB,aAAcjrD,GAsEJ+8B,CAAa/8B,IACpCiF,YAAa,SAAAjF,GAAK,OAAID,EAAUC,IAChClI,QAAS,SAAAkI,GAAK,OAhFpB,SAAiBA,GACV8qD,GACHG,EAAiB,QAASjrD,GA8ENlI,CAAQkI,IAC1Bg2B,cAAe,SAAAh2B,GAAK,OAtE1B,SAAuBA,GACrBirD,EAAiB,cAAejrD,GAqEJg2B,CAAch2B,IACtCsnC,QAAS,aACT9+B,OAAQ,mBCrMD3Y,iCACb,iBACA,CACEtK,MAAO,CACL1D,KAAM,QACNqB,YAAa,kDACb4M,aAAc,qGAId+jC,kBAAmB,CAAC,YAEtBna,YAAa,CACX73B,KAAM,aACN3P,MAAOvB,QAAMo/D,YAAY,cAAe,CACtC,SACA,UACA,aAEF7sD,YAAa,4BACb4M,aAAc,UAEhBw8D,mBAAoB,CAClBzqE,KAAM,SACNqB,YACE,wIACF4M,aAAc,GAEhBzJ,UAAW,CACTxE,KAAM,UACNqB,YAAa,sDACb4M,aAAc,KAEhBy8D,gBAAiB,CACf1qE,KAAM,UACNqB,YAAa,qDACb4M,aAAc,KAEhBkP,OAAQ,CACNnd,KAAM,UACNqB,YAAa,mDACb4M,aAAc,EACd+jC,kBAAmB,CAAC,aAGxB,CAAE9jC,iBAAiB,ICxCRy8D,GAAc,SACzBn/D,EACAs7D,GAEA,IAAM8D,EAAe32E,MAAMwC,KAAK+U,EAAS8oB,UACnCu2C,EAAkC,GAClCC,EAAmC,GACjClsD,EAAckoD,EAAdloD,IAAK5e,EAAS8mE,EAAT9mE,KAcb,OAXA4qE,EAAatrE,SAAQ,SAAAyrE,GACnB,IAAMplE,EAAUolE,EACVr7E,EAAQiW,EAAQ1V,IAAI,SACpBL,EAAM+V,EAAQ1V,IAAI,OACpB4X,GAAe+W,EAAM,EAAGA,EAAKlvB,EAAOE,GACtCi7E,EAAqBlqE,KAAKoqE,GAE1BD,EAAsBnqE,KAAKoqE,MAIvB/qE,GACN,IAAK,iBACH6qE,EAAqB/nD,MAAK,SAAC7wB,EAAGC,GAAJ,OAAUD,EAAEhC,IAAI,SAAWiC,EAAEjC,IAAI,YAC3D,MAIF,IAAK,YACH,IAAM+6E,EAAsC,GAC5CH,EAAqBvrE,SAAQ,SAAAqG,GACIA,EAAQ1V,IAAI,cAChCqP,SAAQ,SAAAkgE,GACjB,IACMniE,EADQsI,EAAQ1V,IAAI,SACHuvE,EAAS9vE,MAAQ,EAGlCod,EADc,cAAlB0yD,EAASx/D,MAA0C,aAAlBw/D,EAASx/D,KACpB,EAAIw/D,EAASrrE,OACjCyqB,GAAOvhB,GAAUuhB,EAAMvhB,EAASyP,GAClCk+D,EAAcrqE,KAAK,CAACgF,EAAQxV,KAAMqvE,UAKxC,IAAMyL,EAAU,IAAItpE,IAAIqpE,GACxBH,EAAqB/nD,MAAK,SAAC7wB,EAAGC,GAC5B,IAAMg5E,EAAYD,EAAQh7E,IAAIgC,EAAE9B,MAC1Bg7E,EAAYF,EAAQh7E,IAAIiC,EAAE/B,MAC1Bi7E,EAAQD,GAAaA,EAAUnsB,KAAK3uC,cACpCg7D,EAAQH,GAAaA,EAAUlsB,KAAK3uC,cAC1C,OAAI+6D,IAAUC,GAAmB,MAAVD,EAEdF,EAAU/2E,OAASg3E,EAAUh3E,QAGnCi3E,EAAQA,EAAME,WAAW,GAAK,IAAMD,EAAQA,EAAMC,WAAW,GAAK,MAIvE,MAIF,IAAK,cACHT,EAAqB/nD,MAAK,SAAC7wB,EAAGC,GAAJ,OACxBD,EAAEhC,IAAI,WAAaiC,EAAEjC,IAAI,UAAY,GAAK,KAYhD,OANkB,IAAI0R,IACpBkpE,EACG1zC,OAAO2zC,GACPzwE,KAAI,SAAAsL,GAAO,MAAI,CAACA,EAAQxV,KAAMwV,QCR/B4lE,G,kDAKJ,WAAY1yE,GAAgC,kCAC1C,cAAMA,IALRiuE,cAI4C,IAF5Cv6C,kBAE4C,IAa5CwO,kBAb4C,EAE1C,EAAKx8B,OAAS1F,EAAK0F,OAFuB,E,gEAKxBw8B,GAClB,OACE,6EAA0BA,IAC1BE,KAAU/hC,KAAK4tE,SAAU/rC,EAAa+rC,WACtC7rC,KAAU/hC,KAAKqzB,aAAcwO,EAAaxO,gB,6BAgB5C,OATKrzB,KAAK6hC,cAAiB7hC,KAAKgiC,oBAAoBhiC,KAAK6hC,gBACvD7hC,KAAK6hC,aAAe,CAClBV,OAAQnhC,KAAKiiC,aACb58B,OAAQG,yBAAexF,KAAKqF,QAC5BsZ,QAAS3e,KAAK2e,QACdivD,SAAU5tE,KAAK4tE,SACfv6C,aAAcrzB,KAAKqzB,eAGhBrzB,KAAK6hC,aAAaV,W,GA9BKS,IAiCburC,G,4KAEjB1gE,EACA00B,EACA97B,EACAU,EACA3F,EACAizB,GAEA,IAAIi/C,EAAkB,EAClBC,EAAiB,EACftN,EAAyBx4D,EAAQ1V,IAAI,cAG3C,GAAIs8B,GAAgB5mB,EAAQ1V,IAAI,OAC9B,IAAK,IAAI8D,EAAI,EAAGA,EAAIoqE,EAAWhqE,OAAQJ,GAAK,EAAG,CAC7C,IAAMyrE,EAAWrB,EAAWpqE,GACN,aAAlByrE,EAASx/D,OACQ,IAAnBw/D,EAAS9vE,MACJ87E,EAAkBhM,EAASnB,SAAW,EACtCoN,EAAiBjM,EAASnB,SAAW,GAZ3B,MAiBKyL,oBACxBnkE,EAAQ1V,IAAI,SAAWu7E,EACvB7lE,EAAQ1V,IAAI,OAASw7E,EACrBnyE,EACA2F,GArBmB,mBAiBdgL,EAjBc,KAiBNC,EAjBM,KAwBjBwhE,EAAWhtE,yBAAeH,EAAQ,SAAU,CAACoH,IAC3CkyB,EAAcn5B,yBAAeH,EAAQ,cAAe,CAACoH,IAE3D,GADoB,YAAhBkyB,IAA2B6zC,GAAY,GACvC/lE,EAAQ1V,IAAI,aAAeqJ,EAAO/J,QACpC,MAAM,IAAI4G,MAAJ,kBACOwP,EAAQxV,KADf,8DAEFmJ,EAAO/J,UAIb,IAAMo6E,EAAQtvC,EAAOlB,QACnBxzB,EAAQxV,KACRwV,EAAQ1V,IAAI,SAAWu7E,EACvB7lE,EAAQ1V,IAAI,OAASw7E,EACrBC,GAEF,OAAc,OAAV/B,EACK,KAGF,CACLhkE,UACAsE,SACAC,UACAy/D,MAAuB,aAAhB9xC,EAA6B,EAAI8xC,EACxC+B,c,wCAOcpyE,EAAgBs7B,GAChC,IAAKt7B,EAAQ,OAAOA,EAD4C,IAExDiF,EAAyBq2B,EAAzBr2B,OAAQguB,EAAiBqI,EAAjBrI,aACVm+C,OACOz3E,IAAXsL,EAAuB,EAAIG,yBAAeH,EAAQ,mBACpD,IAAKmsE,IAAoBn+C,EAAc,OAAOjzB,EAC9C,IAAMiiC,EAAc39B,KAAK2O,MAAMm+D,GAC/B,kCACKpxE,GADL,IAEE5J,MAAOkO,KAAKsN,MAAMtN,KAAKuM,IAAI7Q,EAAO5J,MAAQ6rC,EAAa,IACvD3rC,IAAKgO,KAAKkN,KAAKxR,EAAO1J,IAAM2rC,O,6EAIZt7B,G,iIAEhBuL,EASEvL,EATFuL,SACA6uB,EAQEp6B,EARFo6B,OACA97B,EAOE0B,EAPF1B,OACArE,EAME+F,EANF/F,QACA+E,EAKEgB,EALFhB,QACA6nE,EAIE7mE,EAJF6mE,S,EAIE7mE,EAHFosB,6B,MAAwB,E,EACxBE,EAEEtsB,EAFFssB,aACOo/C,EACL1rE,EADFoD,MAEIA,EAAQ4Y,GAAmB0vD,G,cAChBzxE,E,GAAVZ,E,KACF+gC,E,sBACG,IAAIlkC,MAAJ,mB,UAEHkkC,EAAOlB,Q,sBACJ,IAAIhjC,MAAM,yB,cAEZy1E,EAAUhuE,KAAKC,IAAI,EAAIoB,EAAS,GAChC4sE,EAAentE,yBAAeH,EAAQ,sBACtCi6D,EAAI56D,KAAKuM,IAAI0hE,EAAcD,GAE3BE,EACJhF,GAAYA,EAAS9mE,MAAQ1G,EAAO5J,QAAUo3E,EAASloD,IACnD+rD,GAAYn/D,EAAUs7D,GACtB,KAEAiF,EAAaD,GAAkBtgE,EAC/BwgE,EAAgB33C,mBACpB03C,EAAWz3C,UACX,SAAA3uB,GAAO,OACL,EAAKsmE,cACHtmE,EACA00B,EACA97B,EACAU,EACA3F,EACAizB,KAEJw/C,EAAWn1E,MAGPuS,GAAS7P,EAAO1J,IAAM0J,EAAO5J,OAASuP,EACtCke,EAASvf,KAAKuM,IAAIkwB,EAAOX,iBAAkB,GAE3CjO,EAASD,GACb5tB,KAAKkN,KAAK3B,EAAQkjB,GAClBlP,EAASkP,IAEL0rC,EAAMtsC,EAAOiB,WAAW,OAC1BoxB,MAAMzxB,EAAuBA,GACjC0rC,EAAIhrC,KAAO,mCACLm/C,EAAWnU,EAAIoU,YAAY,MACxBhvD,OAAS,EAElB6uD,EAAc1sE,SAAQ,SAAA6H,GACpB,GAAa,OAATA,EAAJ,CAD4B,IAKpBxB,EAA8CwB,EAA9CxB,QAASsE,EAAqC9C,EAArC8C,OAAQC,EAA6B/C,EAA7B+C,QAASy/D,EAAoBxiE,EAApBwiE,MAAO+B,EAAavkE,EAAbukE,SACzC3T,EAAIjrC,UAAYpuB,yBAAeH,EAAQ,QAAS,CAACoH,IACjDoyD,EAAIU,SAASxuD,EAAQ0/D,EAAO/rE,KAAKuM,IAAID,EAAUD,EAAQ,KAAMyhE,GAC7D,IAAMvN,EAAyBx4D,EAAQ1V,IAAI,cAE3C,GAAIkuE,EAAY,CAQd,IAPA,IAAMiO,EAA0C,CAC9CrzD,EAAG1V,EAAMQ,QAAQiV,MAAMC,EAAER,KACzBU,EAAG5V,EAAMQ,QAAQiV,MAAMG,EAAEV,KACzBY,EAAG9V,EAAMQ,QAAQiV,MAAMK,EAAEZ,KACzBc,EAAGhW,EAAMQ,QAAQiV,MAAMO,EAAEd,KACzB8zD,SAAU,WAEHt4E,EAAI,EAAGA,EAAIoqE,EAAWhqE,OAAQJ,GAAK,EAAG,CAC7C,IAAMyrE,EAAWrB,EAAWpqE,GADiB,EAEH+1E,oBACxCnkE,EAAQ1V,IAAI,SAAWuvE,EAAS9vE,MAChCiW,EAAQ1V,IAAI,SAAWuvE,EAAS9vE,MAAQ8vE,EAASrrE,OACjDmF,EACA2F,GAN2C,mBAEtCqtE,EAFsC,KAEtBC,EAFsB,KASvCC,EAAkB5uE,KAAKuM,IAC3B0hE,EACAjuE,KAAKsgD,IAAIouB,EAAiBC,IAG5B,GAAsB,aAAlB/M,EAASx/D,MAAyC,aAAlBw/D,EAASx/D,KAAqB,CAChE,IAAMysE,EACJL,EACoB,aAAlB5M,EAASx/D,KAAsB,WAAaw/D,EAASxgB,OAClD,OACP+Y,EAAIjrC,UAAY2/C,EAChB1U,EAAIU,SAAS6T,EAAgB3C,EAAO6C,EAAiBd,GAGnDc,GAAmBN,EAAS/iE,OAC5BuiE,GAAYQ,EAAS/uD,OAAS,IAE9B46C,EAAIjrC,UAAYzpB,EAAMQ,QAAQ6oE,gBAAgBD,GAC9C1U,EAAI4U,SACFnN,EAASxgB,KACTstB,GAAkBE,EAAkBN,EAAS/iE,OAAS,EAAI,EAC1DwgE,EAAQ+B,SAGP,GAAsB,cAAlBlM,EAASx/D,KAAsB,CACxC+3D,EAAIjrC,UAAY,SAChB,IAAMlO,EAAM0tD,EAAiB,EAC7BvU,EAAIU,SAAS75C,EAAK+qD,EAAQ,EAAGnR,EAAGkT,EAAW,GAC3C3T,EAAIU,SAAS75C,EAAM45C,EAAGmR,EAAW,EAAJnR,EAAO,GACpCT,EAAIU,SAAS75C,EAAM45C,EAAGmR,EAAQ+B,EAAW,EAAO,EAAJlT,EAAO,GAEjD,EAAIv5D,GAAWitE,EAAS/iE,OACxBuiE,GAAYQ,EAAS/uD,OAAS,GAE9B46C,EAAI4U,SAAJ,WACMnN,EAASxgB,KADf,KAEEstB,EAAiB,EACjB3C,EAAQ+B,QAGP,GACa,aAAlBlM,EAASx/D,OACPusB,GAAkC,aAAlBizC,EAASx/D,KAC3B,CACA+3D,EAAIjrC,UAA8B,aAAlB0yC,EAASx/D,KAAsB,MAAQ,OACvD,IAAM4e,EAAM0tD,EAAiB,EAC7BvU,EAAIU,SAAS75C,EAAK+qD,EAAQ,EAAGnR,EAAGkT,EAAW,GAC3C3T,EAAIU,SAAS75C,EAAM45C,EAAGmR,EAAW,EAAJnR,EAAO,GACpCT,EAAIU,SAAS75C,EAAM45C,EAAGmR,EAAQ+B,EAAW,EAAO,EAAJlT,EAAO,GAEjDgU,GAAmBN,EAAS/iE,OAC5BuiE,GAAYQ,EAAS/uD,OAAS,GAE9B46C,EAAI4U,SAAJ,WACMnN,EAASxgB,KADf,KAEEstB,EAAiB,EACjB3C,EAAQ+B,OAGe,SAAlBlM,EAASx/D,OAIdssE,EAAiBE,EAAkB,GACrCzU,EAAI0R,UAAU6C,EAAgB3C,EAAO6C,EAAiBd,GAExD3T,EAAIjrC,UAAY,OAChBirC,EAAIU,SACF6T,EACA3C,EAAQ+B,EAAW,EACnBc,EACA,IAKN,GAAIjgD,EAAc,CAChB,IAAM02B,EAAMt9C,EAAQ1V,IAAI,OACxB,IAAKgzD,EAAK,OACV,IAAK,IAAIhvB,EAAI,EAAGA,EAAIkqC,EAAWhqE,OAAQ8/B,GAAK,EAAG,CAC7C,IAAMurC,EAAWrB,EAAWlqC,GAC5B,GAAsB,aAAlBurC,EAASx/D,KAMX,IALA,IAAM4sE,EAAiBpN,EAASnB,SAAW,EACrCwO,EACe,IAAnBrN,EAAS9vE,MACLiW,EAAQ1V,IAAI,SAAW28E,EACvBjnE,EAAQ1V,IAAI,SAAWuvE,EAAS9vE,MAC7B2G,EAAI,EAAGA,EAAIu2E,EAAgBv2E,GAAK,EAAG,CAC1C,IAAM2oD,EAAOiE,EAAI6pB,OAAOz2E,EAAImpE,EAAS9vE,OAErC,IAAKsvD,EAAM,OAH+B,MAKA8qB,oBACxC+C,EAAgBx2E,EAChBw2E,EAAgBx2E,EAAI,EACpBiD,EACA2F,GATwC,mBAKnC8tE,EALmC,KAKnBC,EALmB,KAWpCC,EAAkBrvE,KAAKuM,IAC3B0hE,EACAjuE,KAAKsgD,IAAI6uB,EAAiBC,IAI5BjV,EAAIjrC,UAAYmZ,mBAAQmmC,EAAaptB,IAAS,UAAW,IACzD+Y,EAAIU,SAASsU,EAAgBpD,EAAOsD,EAAiBvB,GAGnDuB,GAAmBf,EAAS/iE,OAC5BuiE,GAAYQ,EAAS/uD,OAAS,IAE9B46C,EAAIjrC,UAAY,QAChBirC,EAAI4U,SACF3tB,EACA+tB,GAAkBE,EAAkBf,EAAS/iE,OAAS,EAAI,EAC1DwgE,EAAQ+B,Y,UAUAhgD,GAAkBD,G,eAApCa,E,yBACC,CACLA,YACAnP,SACAhU,QACA6uB,iBAAkBqC,EAAOrC,mB,yKAIhBpoB,G,iGAMD1W,KAAK++D,cAAcroD,G,uBAJ3BuN,E,EAAAA,OACAhU,E,EAAAA,MACAmjB,E,EAAAA,UACA0L,E,EAAAA,iBAEI93B,EAAUC,IAAMC,cACpBlH,KAAK2G,eADS,2BAGT+P,GAHS,IAIZtW,OAAQsW,EAAY1V,QAAQ,GAC5BijB,SACAhU,QACAmjB,cAEF,M,kBAGK,CACLpsB,UACAosB,YACAnP,SACAhU,QACA6uB,mBACAqC,OAAQzqB,EAAYyqB,S,2IAIVxhC,GACZ,OAAO,IAAI0yE,GAAoB1yE,O,GAtUSuiC,ICxGvB8xC,G,WAGnB,aAA8B,IAAlBC,EAAkB,uDAAJ,GAAI,yBAFvBj7D,gBAEuB,EAC5BhZ,KAAKgZ,WAAL,eAAuBi7D,G,oDAMvB,IAAI5zC,EAAI,EAER,IAAK,IAAMljC,KAAK6C,KAAKgZ,WAAY,CAC/B,IAAM/e,EAAI+F,KAAKgZ,WAAW7b,GAC1BkjC,GAAKpmC,EAAEu1E,MAAQv1E,EAAEu1E,QAAUv1E,EAG7B,OAAOomC,I,gCAIC6zC,EAAkBC,GAW1B,OAVKA,IACHA,EAAS,GAMTD,EAHGA,EAGQA,EAAS55E,WAFT,UAKT0F,KAAKgZ,WAAWk7D,IAClBl0E,KAAKgZ,WAAWk7D,GAAYxvE,KAAKuM,IAC/B,EACAjR,KAAKgZ,WAAWk7D,GAAYC,GAEvBn0E,KAAKgZ,WAAWk7D,IAElB,I,gCAICA,EAAkBC,GAY1B,OAXKA,IACHA,EAAS,GAMTD,EAHGA,EAGQA,EAAS55E,WAFT,UAKb0F,KAAKgZ,WAAWk7D,IAAal0E,KAAKgZ,WAAWk7D,IAAa,GAAKC,EACxDn0E,KAAKgZ,WAAWk7D,K,0BAKrBA,GACF,OAAOl0E,KAAKgZ,WAAWk7D,IAAa,I,gCAI5BpxE,GAKR,GAJoB,kBAATA,IACTA,EAAOA,EAAKk0C,MAAM,OAGfl0C,EAAK7H,OACR,OAAO+E,KAGT,IAAMk0E,EAAWpxE,EAAK,GAAGxI,WACrB85E,EAAOp0E,KAAKgZ,WAAWk7D,GAQ3B,OAPKE,GAASA,EAAKp7D,aACjBhZ,KAAKgZ,WAAWk7D,GAAY,IAAIF,EAC9BI,EAAO,CAAEnuD,QAASmuD,EAAO,GAAM,KAGnCA,EAAOp0E,KAAKgZ,WAAWk7D,GAEnBpxE,EAAK7H,OAAS,EACTm5E,EAAKC,UAAUvxE,EAAK5C,MAAM,IAE5Bk0E,I,iCAIP,OAAOp0E,KAAKwvE,QACT7P,YAAY,GACZrlE,WACAZ,QAAQ,SAAU,M,gCAIrB,OAAOsG,KAAKwvE,U,8BASNx4E,EAAgB6nE,GACtB,GAAIA,EACF,IAAK,IAAMqV,KAAYl0E,KAAKgZ,WAC1BhiB,EAAKkD,KAAK2kE,EAAK7+D,KAAKgZ,WAAWk7D,GAAWA,QAG5C,IAAK,IAAMA,KAAYl0E,KAAKgZ,WAC1BhiB,EAAKgJ,KAAKgZ,WAAWk7D,GAAWA,O,KChHzB,YAAClrE,GAAD,OACbpT,QAAM2uE,MAAK,kBACTzvD,8BACE,qBACA,CACE66D,WAAY3mE,EAAc0S,0BAA0B,YAEtD,CAAE1G,iBAAiB,QCsBV,YAAChM,GACSsrE,GAAgBtrE,GAEvC,SAASurE,EAAiBC,GACxB,IAAMC,EAAW,GACXC,EAAeF,EAAMhF,QAI3B,IAAK,IAAM1pB,KAAQ0uB,EAAMx7D,WAAY,CACnC,IAAM02D,EAAU8E,EAAMx7D,WAAW8sC,GAAM9sC,WAGjCwjD,EAAQvjE,OAAOmiC,OAAOs0C,GAASrgE,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,GAC7Dy7E,EAAShtE,KAAK,CACZq+C,OACA0W,QACAkT,YAcJ,OATA+E,EAAS7qD,MAAK,SAAC7wB,EAAGC,GAAJ,OACZD,EAAEyjE,MAAQxjE,EAAEwjE,OAAoB,cAAXxjE,EAAE8sD,KAAuB,GAAK,KAIrD2uB,EAAShtE,KAAK,CACZq+C,KAAM,QACN0W,MAAOkY,IAEFD,EAGT,yDAGE,WACEpvE,EACAqrC,GACA,2BACA,cAAMrrC,IANAsqE,gBAKN,EAGA,IAAMh0C,EAAW,OAAG+U,QAAH,IAAGA,OAAH,EAAGA,EAAgB3wC,sBAAYsF,EAAOsqE,aACpDh0C,YAEH,KAAIA,aAAuBj8B,2BAGzB,MAAM,IAAIzC,MAAJ,mCAAsCoI,EAAOsqE,WAAW7oE,KAAxD,MATR,OAOE,EAAK6oE,WAAah0C,EAPpB,EANJ,2DAmBwBv7B,GAAwC,IAAxB/D,EAAwB,uDAAJ,GAClD+gE,EAAQp9D,KAAKU,YAAYN,EAAQ/D,GACvC,OAAOigE,GAAcl8D,EAAQg9D,KArBjC,kMAyBIp8D,EAzBJ,+BAyBwB,GACpB3E,EA1BJ,+BA0BwB,GAEf2E,EAAQ/F,OA5BjB,yC9CyGO,CACLyhE,SAAU,EACVD,SAAU,EACVV,UAAW,EACXI,YAAa,EACbH,SAAU,EACVI,gBAAiB,EACjBH,aAAc,EACdI,eAAgB,EAChBH,aAAc,I8ClHhB,uBAgCwBlpC,QAAQ4hB,IAC1B5zC,EAAQG,KAAI,SAAAf,GAAM,OAAI,EAAK+8D,eAAe/8D,EAAQ/D,OAjCxD,cAgCU+gE,EAhCV,OAoCUX,EAAWW,EACdj8D,KAAI,SAAA3F,GAAC,OAAIA,EAAEihE,YACXptD,QAAO,SAACguD,EAAKpL,GAAN,OAAevtD,KAAKuM,IAAIosD,EAAKpL,MACjCyK,EAAWU,EACdj8D,KAAI,SAAA3F,GAAC,OAAIA,EAAEkhE,YACXrtD,QAAO,SAACguD,EAAKpL,GAAN,OAAevtD,KAAKC,IAAI04D,EAAKpL,MACjC+J,EAAWoB,EAAMj8D,KAAI,SAAA3F,GAAC,OAAIA,EAAEwgE,YAAU3sD,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,GAC9DojE,EAAkBgB,EACrBj8D,KAAI,SAAA3F,GAAC,OAAIA,EAAE4gE,mBACX/sD,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,GACrBijE,EAAemB,EAClBj8D,KAAI,SAAA3F,GAAC,OAAIA,EAAEygE,gBACX5sD,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,GACrBkjE,EAAekB,EAClBj8D,KAAI,SAAA3F,GAAC,OAAIA,EAAE0gE,gBACX7sD,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,GAnD/B,kBAqDW8iE,GAAa,CAClBY,WACAD,WACAR,eACAC,eACAE,kBACAJ,cA3DN,oIA+Dc57D,GAAwC,WAAxB/D,EAAwB,uDAAJ,GAC9C,OAAOgE,aAAgB,uCAAU,WAAMC,GAAN,eAAAvH,EAAA,sEACR,EAAK42E,WACzBjvE,YAAYN,EAAQ/D,GACpBsE,KAAKwiD,gBACL/mB,YAJ4B,OACzB9pB,EADyB,OAMV,EAAKqiE,qBACxBriE,EACAlS,EACA/D,EAAK0J,SAAW,GAELK,SAAQ,SAACwuE,EAAK1hE,GACrB0hE,EAAIpF,SACNlvE,EAASgG,KACP,IAAIyX,GAAc,CAChB9mB,GAAI,OAAF,OAASmJ,EAAO5J,OAAhB,OAAwB0c,GAC1BrT,KAAM,CACJ28D,MAAOoY,EAAIpF,QACXqF,QAASN,EAAiBK,GAC1Bp+E,MAAO4J,EAAO5J,MAAQ0c,EACtBxc,IAAK0J,EAAO5J,MAAQ0c,EAAQ,EAC5B7c,QAAS+J,EAAO/J,eAO1BiK,EAASS,WA5BsB,2CAAV,sDA6BpB1E,EAAKgC,UA7FZ,uKAgGoBhC,EAhGpB,+BAgGwC,GAhGxC,kBAiGW2D,KAAK2vE,WAAWvuE,YAAY/E,IAjGvC,0LA+GIiW,EACAlS,EACA2F,GAUA,IARA,IAAM+uE,EAAW10E,EAAO5J,MAClBu+E,EAAY30E,EAAO1J,IACnBkuD,EAAQ,EAAI7+C,EACZivE,EAAWjvE,GAAW,GAAK,EAAIrB,KAAKkN,KAAKgzC,GACzCqwB,EAASvwE,KAAKkN,MAAMmjE,EAAYD,GAAYE,GAE5CE,EAAe,IAAIn6E,MAAMk6E,GAAQp7E,KAAK,GAEnCgB,EAAI,EAAGA,EAAIo6E,EAAQp6E,IAC1Bq6E,EAAar6E,GAAK,IAAIm5E,GACL,IAAbgB,IACFE,EAAar6E,GAAGs6E,aAAc,GAIlC,IAAMC,EAAa,SACjB5+E,EACAE,EACAsD,GAEA,IAAIwB,GAAKhF,EAAQs+E,GAAYE,EACzB/4E,GAAKvF,EAAM,EAAIo+E,GAAYE,EAC3BK,EAAK3wE,KAAKsN,MAAMxW,GAChB85E,EAAK5wE,KAAKsN,MAAM/V,GAEpB,KAAIo5E,GAAMJ,GAAUK,EAAK,GAYzB,GATID,EAAK,IACP75E,EAAI,EACJ65E,EAAK,GAEHC,GAAML,IACRK,EAAKL,EAAS,EACdh5E,EAAIg5E,GAGFI,IAAOC,EAETt7E,EAASq7E,EAAIp5E,EAAIT,OACZ,CAELxB,EAASq7E,EAAIA,EAAK,EAAI75E,GACtB,IAAK,IAAIX,EAAIw6E,EAAK,EAAGx6E,EAAIy6E,EAAIz6E,IAC3Bb,EAASa,EAAG,GAEdb,EAASs7E,EAAIr5E,EAAIq5E,KA/CG,qBAoEFhjE,EAAS8oB,UApEP,yBAoEb3uB,EApEa,QAqEhBC,EAlBR,SAAmBD,GACjB,IACIC,EAAS,GACb,OAFeD,EAAQ1V,IAAI,WAGzB,KAAM,EACJ2V,EAAS,IACT,MACF,KAAK,EACHA,EAAS,IACT,MACF,QACEA,EAAS,aAGb,OAAOA,EAIQ6oE,CAAU9oE,GACnBjW,EAAQiW,EAAQ1V,IAAI,SACpBL,EAAM+V,EAAQ1V,IAAI,OAOxB,GALAq+E,EAAW5+E,EAAOE,GAAK,SAACk+E,EAAKY,GAC3BN,EAAaN,GAAKP,UAAU,aAAaoB,UAAU/oE,EAAQ8oE,MAI5C,IAAbR,EAAgB,CAClB,IAAM/P,EAAyBx4D,EAAQ1V,IAAI,cAI3C,GAAIkuE,EACF,IADc,eACLpqE,GACP,IAAMyrE,EAAWrB,EAAWpqE,GACN,cAAlByrE,EAASx/D,MACXsuE,EACE5+E,EAAQ8vE,EAAS9vE,MACjBA,EAAQ8vE,EAAS9vE,MAAQ8vE,EAASrrE,QAClC,SAACy6E,EAAQF,GAEP,IAAMZ,EAAMM,EAAaQ,GACzBd,EAAIP,UAAU,aAAasB,UAAUjpE,EAAQ8oE,GAH1B,IAIb1vB,EAASwgB,EAATxgB,KAEgB,cAAlBwgB,EAASx/D,KACXg/C,EAAO,OAAH,OAAUA,GACa,SAAlBwgB,EAASx/D,OAClBg/C,EAAO,QAGI,SAATA,GACF8uB,EAAIP,UAAUvuB,GAAM6vB,UAAU,YAAaH,GAGzC1vB,GAAiB,MAATA,GAAyB,SAATA,GAC1B8uB,EAAIP,UAAUvuB,GAAM2vB,UAAU/oE,EAAQ8oE,OAvBvC36E,EAAI,EAAGA,EAAIoqE,EAAWhqE,OAAQJ,IAAK,EAAnCA,KAhBf,2BAAyC,IApEjB,8BAoHxB,OAAOq6E,MAtOX,GAAwCx1E,4BC/D3B,YAACk2E,GACd,MAAO,CACLxuE,aAAcyuE,GAAcD,GAC5BhvE,aAAc2lE,GAAcqJ,KCLjB9gE,iCAAoB,sBAEjC,CACE0pD,UAAW,CACT13D,KADS,QAETqB,YAFS,mCAGT4M,aAAc,QAGlB,CAAEC,iBAAiB,IC8BAq4D,G,mKACdxO,EAA+B93D,GAAiC,MAEjEuL,EAMEvL,EANFuL,SACAtR,EAKE+F,EALF/F,QACA+E,EAIEgB,EAJFhB,QACAo5D,EAGEp4D,EAHFo4D,UACAl7C,EAEEld,EAFFkd,OAGI9Z,EAAQ4Y,GADVhc,EADFoD,OAIK/J,EAX4D,YAWlDY,EAXkD,MAY7D80E,EAAYrY,GAAS,2BAAK0B,GAAN,IAAiBtiE,MAAO,CAAC,EAAGonB,MAChD09C,EAAUvD,GAAUe,EAAUxB,WAC9BmE,EAAM,SAACC,GAAD,IAAmB9P,EAAnB,uDAA0B,EAA1B,OACVhuC,EAAS6xD,EAAU/T,GAAY9P,GAC3B+P,EAAW,SAACD,GAAD,IAAmB9P,EAAnB,uDAA0B,EAA1B,OACf6P,EAAIH,GAAWG,EAAIC,EAAU9P,IAEzB8jB,EAAW,mBACX7C,EAA0C,CAC9CrzD,EAAG1V,EAAMQ,QAAQiV,MAAMC,EAAER,KACzBU,EAAG5V,EAAMQ,QAAQiV,MAAMG,EAAEV,KACzBY,EAAG9V,EAAMQ,QAAQiV,MAAMK,EAAEZ,KACzBc,EAAGhW,EAAMQ,QAAQiV,MAAMO,EAAEd,KACzBmwD,MAAO,aAzB0D,eAgC7Cl9D,EAAS8oB,UAhCoC,IAgCnE,2BAAyC,KAA9B3uB,EAA8B,UACb4yD,yBAAc5yD,EAASrM,EAAQ2F,GADlB,mBAChCgL,EADgC,KACxBC,EADwB,KAEjCwrD,EAAQ/vD,EAAQ1V,IAAI,SAI1B8nE,EAAIjrC,UAAYs/C,EAAa1D,MAC7B,IAAMlQ,EAAItuD,EAAUD,EAAS,GAC7B8tD,EAAIU,SAASxuD,EAAQ+wD,EAAItF,GAAQ8C,EAAG0C,EAASxF,KAxCoB,mDA0C7ClqD,EAAS8oB,UA1CoC,yBA0CxD3uB,EA1CwD,UA2CvC4yD,yBAAc5yD,EAASrM,EAAQ2F,GA3CQ,mBA2C1DgL,EA3C0D,KA2ClDC,EA3CkD,KA4C3DsuD,EAAI56D,KAAKuM,IAAID,EAAUD,EAAS,GAAK,GAErCilE,EAAYvpE,EAAQ1V,IAAI,YAAc,GACxCk7D,EAAO,EACX+jB,EAAU5vE,SAAQ,SAAiB+tD,GAC5BA,GAAsB,cAAdA,EAAKrO,MAAsC,UAAdqO,EAAKrO,OAG/C+Y,EAAIjrC,UAAYugC,EAAKrO,KAAKnsD,MAAMo8E,GAC5B,WACA7C,EAAa/e,EAAKrO,MACtB+Y,EAAIU,SAASxuD,EAAQ+wD,EAAI3N,EAAKqI,MAAQvK,GAAOqN,EAAG0C,EAAS7N,EAAKqI,QAC9DvK,GAAQkC,EAAKqI,WAdjB,2BAAyC,IA1C0B,mC,GADtBgD,ICnCpC54D,GAAekO,8BAAoB,sBAAD,GAG7C,CAAEstC,kBAAF,GAAmCptC,iBAAiB,ICsCjCihE,G,4MACnB16E,KAAO,mB,sDAECyN,GACNA,EAAc0xD,cAAa,WACzB,IAAM9zD,EAAekO,8BACnB,kBACA,GACA,CAAEstC,kBAAmBhlC,GAAsBpU,KAEvC4M,EAAQ,IAAIvO,EAAU,CAC1B9L,KAAM,kBACNqL,eACAU,WAAYyS,GACV/Q,EACA,kBACApC,KAGEsvE,EAA0BltE,EAAcuQ,eAC5C,2BAMF,OADA3D,EAAM2/B,eAAe2gC,GACdtgE,KAET5M,EAAcusC,gBAAe,WAC3B,IAAM3uC,EAAeuvE,GAAuCntE,GAC5D,OAAO,IAAItB,EAAY,CACrBnM,KAAM,sBACNqL,eACAU,WAAY8uE,GACVptE,EACApC,GAEFe,UAAW,kBACXC,SAAU,mBACVjB,eAAgB8zD,QAGpBzxD,EAAcusC,gBAAe,WAC3B,IAAM3uC,ECrFG,SAAkCoC,GAC/C,IAAMikE,EAAkCjkE,EAAc2Q,gBACpD,uBACA/S,aAEF,OAAOkO,8BACL,2BACA,CACEguD,UAAW,CACTh8D,KAAM,aACNiO,aAAc,QACd5d,MAAOvB,QAAMo/D,YAAY,iBAAkB,CAAC,UAC5C7sD,YACE,4EAEJu4D,SAAU,CACR55D,KAAM,SACNiO,aAAcikC,OAAO2jB,UACrBx0D,YAAa,iCAEfs4D,SAAU,CACR35D,KAAM,SACNqB,YAAa,gCACb4M,aAAcikC,OAAOC,WAEvB0kB,UAAW,CACT72D,KAAM,aACN3P,MAAOvB,QAAMo/D,YAAY,aAAc,CAAC,SAAU,QAClD7sD,YAAa,2BACb4M,aAAc,UAEhB8oD,SAAU,CACR/2D,KAAM,UACNqB,YAAa,mBACb4M,cAAc,GAEhBgkC,oBAAqB,CACnBjyC,KAAM,SACNqB,YAAa,gDACb4M,aAAc,KAEhBm4D,SAAU,CACRpmE,KAAM,SACNqB,YACE,6DACF4M,aAAc,IAGhBkuD,UAAWnuD,8BAAoB,yBAA0B,CACvDu4D,oBAAqBJ,KAGzB,CAAE7qB,kBAAmBxJ,GAA+B5jC,iBAAiB,IDiC9CqhE,CACnBrtE,GAEF,OAAO,IAAItB,EAAY,CACrBnM,KAAM,2BACNqL,eACAU,WAAYgvE,GAAqC1vE,GACjDe,UAAW,kBACXC,SAAU,mBACVjB,eAAgB28D,QAGpBt6D,EAAcusC,gBAAe,WAC3B,IAAM3uC,EAAe2vE,GACnBvtE,GAEF,OAAO,IAAItB,EAAY,CACrBnM,KAAM,0BACNqL,eACAU,WAAYkvE,GACVxtE,EACApC,GAEFe,UAAW,kBACXC,SAAU,mBACVjB,eAAgB8vE,QAGpBztE,EAAcgyD,eACZ,kBACE,IAAIlzD,EAAW,CACbvM,KAAM,0BACNwM,QAAS,kBACTnB,aAAc8vE,GACdpvE,WAAYqvE,GACZhwE,eAAgBiwE,QAGtB5tE,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAJ,aACE5L,KAAM,cACHyN,EAAciwB,KAAK49C,SAG5B7tE,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAJ,aACE5L,KAAM,sBACHyN,EAAciwB,KAAK69C,SAG5B9tE,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAJ,aACE5L,KAAM,eACHyN,EAAciwB,KAAK89C,SAG5B/tE,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAJ,aACE5L,KAAM,oBACHyN,EAAciwB,KAAK+9C,SAG5BhuE,EAAc06D,iBACZ,kBACE,IACIyJ,GAAe,CACjB5xE,KAAM,iBACNoL,eAAgBswE,GAChBrwE,aAAcswE,QAGpBluE,EAAc06D,iBACZ,kBACE,IAAI2J,GAAoB,CACtB9xE,KAAM,sBACNoL,eAAgBwwE,GAChBvwE,aAAcqmE,Y,GA3HsBtqC,I,sBE7CvC,SAASy0C,GAAwB3qE,GACtC,IAAMX,EAAWW,EAAQX,WAEnBurE,EAAa5qE,EAAQ1V,IAAI,cACzBugF,EAAW7qE,EAAQ1V,IAAI,YAE7B,IAAKsgF,IAAeC,EAClB,OAAO7qE,EAGT,IAAMqC,EAAoBhD,EACtBA,EACGgC,QAAO,SAAAyQ,GAAK,MAA0B,UAAtBA,EAAMxnB,IAAI,WAC1B6yB,MAAK,SAAC7wB,EAAGC,GAAJ,OAAUD,EAAEhC,IAAI,SAAWiC,EAAEjC,IAAI,YACzC,GAGEwgF,EAAmC,GACzCzoE,EAAO1I,SAAQ,SAAA2I,GACb,IAAMvY,EAAQuY,EAAMhY,IAAI,SAClBL,EAAMqY,EAAMhY,IAAI,OACtB,GAAIsgF,GAAc3gF,EAAK,CAErB,IAAM8gF,EAAQ/qE,EAAQ1V,IAAI,UAAY,EAAI,OAAS,QACnDwgF,EAAY9vE,KAAK,CACfX,KAAM,GAAF,OAAK0wE,EAAL,cACJhhF,QACAE,aAEG,GAAI2gF,EAAa7gF,GAAS6gF,EAAa3gF,GAAO4gF,GAAY5gF,EAAK,CAEpE,IAAM8gF,EAAQ/qE,EAAQ1V,IAAI,UAAY,EAAI,OAAS,QACnDwgF,EAAY9vE,KACV,CACEX,KAAM,GAAF,OAAK0wE,EAAL,cACJhhF,QACAE,IAAK2gF,GAEP,CACEvwE,KAAM,MACNtQ,MAAO6gF,EACP3gF,aAGC,GAAI2gF,GAAc7gF,GAAS8gF,GAAY5gF,EAE5C6gF,EAAY9vE,KAAK,CACfX,KAAM,MACNtQ,QACAE,aAEG,GAAI2gF,EAAa7gF,GAAS6gF,EAAa3gF,GAAO4gF,EAAW5gF,EAAK,CAEnE,IAAM+gF,EAAYhrE,EAAQ1V,IAAI,UAAY,EAAI,OAAS,QACjD2gF,EAAajrE,EAAQ1V,IAAI,UAAY,EAAI,QAAU,OACzDwgF,EAAY9vE,KACV,CACEX,KAAM,GAAF,OAAK2wE,EAAL,cACJjhF,QACAE,IAAK2gF,GAEP,CACEvwE,KAAM,MACNtQ,MAAO6gF,EACP3gF,IAAK4gF,GAEP,CACExwE,KAAM,GAAF,OAAK4wE,EAAL,cACJlhF,MAAO8gF,EACP5gF,aAGC,GAAI2gF,GAAc7gF,GAAS8gF,EAAW9gF,GAAS8gF,EAAW5gF,EAAK,CAEpE,IAAM8gF,EAAQ/qE,EAAQ1V,IAAI,UAAY,EAAI,QAAU,OACpDwgF,EAAY9vE,KACV,CACEX,KAAM,MACNtQ,QACAE,IAAK4gF,GAEP,CACExwE,KAAM,GAAF,OAAK0wE,EAAL,cACJhhF,MAAO8gF,EACP5gF,aAGC,GAAI4gF,GAAY9gF,EAAO,CAE5B,IAAMghF,EAAQ/qE,EAAQ1V,IAAI,UAAY,EAAI,QAAU,OACpDwgF,EAAY9vE,KAAK,CACfX,KAAM,GAAF,OAAK0wE,EAAL,cACJhhF,QACAE,YAKN,IAAMihF,EAA+B,GAmBrC,OAlBAlrE,EAAQ07D,OAAO/hE,SAAQ,SAAAkD,GACrBquE,EAAQruE,GAAOmD,EAAQ1V,IAAIuS,MAE7BquE,EAAQx5D,YAAco5D,EACtBI,EAAQ7wE,KAAO,OACf6wE,EAAQ15D,SAAWxR,EAAQxV,YACpB0gF,EAAQC,mBACRD,EAAQE,kBACRF,EAAQG,gBACRH,EAAQI,aACRJ,EAAQK,kBACRL,EAAQM,kBACRN,EAAQN,kBACRM,EAAQL,SACI,IAAIv5D,GAAc,CACnCle,KAAM83E,EACN1gF,GAAIwV,EAAQxV,O,ICzFKihF,G,kDAKnB,WAAmB7yE,GAAuC,2BACxD,cAAMA,IALA8yE,YAIkD,IAFlDC,YAEkD,EAExD,IAAM1gE,EAAiBlS,yBACrBH,EACA,kBAJsD,OAMxD,EAAK8yE,OAAS,IAAIE,UAAO,CACvBlzE,WAAYjG,wBAAawY,KAG3B,EAAK0gE,OAAS,EAAKD,OAChB7mC,YACAgnC,MAAK,gBAAGC,EAAH,EAAGA,QAAH,OAAsC,IAAIC,KAAI,CAAED,eAZA,E,gLAgBjDt/E,O,SAAmB+G,KAAKm4E,OAAO7mC,Y,0BAAayrB,W,uBAArC7jE,K,kMAGS8jE,G,iFACRh9D,KAAKm4E,OAAO7mC,Y,eAA0B0rB,E,YAAbC,a,gCAAuB,G,qCAAI1hE,M,yIAGlD6E,GAAwC,WAAxB/D,EAAwB,uDAAJ,GAC7ChG,EAAwB+J,EAAxB/J,QAASG,EAAe4J,EAAf5J,MAAOE,EAAQ0J,EAAR1J,IAChB2H,EAAWhC,EAAXgC,OACR,OAAOgC,aAAgB,uCAAU,WAAMC,GAAN,eAAAvH,EAAA,+EAER,EAAKq/E,OAFG,cAEvBA,EAFuB,gBAGZ,EAAKD,OAAO7a,iBAAiBjnE,EAASG,EAAOE,EAAK,CACjE2H,SACAk/D,aAAc7mE,EAAMF,IALO,cAO1BmK,KACD68D,eACAr8D,cACE,SAACvG,GAMC,IAAMiF,EAAOu4E,EAAOK,UAAP,UACRpiF,EADQ,aACIuE,EAAEpE,MADN,aACgBoE,EAAElE,IADlB,aAC0BkE,EAAEtC,MACvC,CACE2lB,SAAUrjB,EAAEqjB,WAIRg6D,EAAqDp4E,EAArDo4E,WAAYD,EAAyCn4E,EAAzCm4E,WAAYU,EAA6B74E,EAA7B64E,YAAad,EAAgB/3E,EAAhB+3E,YAC7C,GAAIK,EAAY,CACd,IAAMU,EAASf,GAAec,GAAe,GACvCE,EAAQZ,EACRa,EAAej+E,EAAEpE,MACvBqJ,EAAKse,YAAc,GAEnB,IAAK,IAAInlB,EAAI,EAAGA,EAAIi/E,EAAYj/E,GAAK,EAAG,CACtC,IAAM8/E,GAAQH,EAAO3/E,IAAM,GAAK6/E,EAC1BE,EAAOD,GAAQF,EAAM5/E,IAAM,GACjC6G,EAAKse,YAAY1W,KAAK,CACpBwW,SAAU,GAAF,OAAKrjB,EAAEqjB,SAAP,YAAmBjlB,GAC3BxC,MAAOsiF,EACPpiF,IAAKqiF,EACLjyE,KAAM,WAIZ,QAAmB/M,IAAfa,EAAEqjB,SACJ,MAAM,IAAIhhB,MAAM,uBAGlB,IAAM+hB,EAAI,IAAIjB,GAAc,CAC1B9mB,GAAI,GAAF,OAAK,EAAKA,GAAV,YAAgB2D,EAAEqjB,UACpBpe,KAAM,2BACDA,GADD,IAEFrJ,MAAOoE,EAAEpE,MACTE,IAAKkE,EAAElE,IACPL,cAGJ,OAAO2oB,EAAEjoB,IAAI,eAAiBioB,EAAEjoB,IAAI,cAChCqgF,GAAwBp4D,GACxBA,MAGRle,UAAUR,GA3DiB,kDA6D7BA,EAASnE,MAAT,MA7D6B,0DAAV,sDA+DpBE,EAAKgC,U,8CA9F+BqB,2BC1B5BoV,iCACb,gBACA,CACE4C,eAAgB,CACd5Q,KAAM,eACNiO,aAAc,CAAEhd,IAAK,oBAGzB,CAAEid,iBAAiB,I,UCMAgkE,G,kDAOnB,WAAmB3zE,GAAyC,2BAC1D,cAAMA,IAPA+yE,YAMoD,IAJlDa,SAIkD,EAE1D,IAAMxhE,EAAgBjS,yBACpBH,EACA,iBAEI6N,EAAQ1N,yBAAeH,EAAQ,SAI/BkzE,EAAU/yE,yBAAeH,EAAQ,WAC/BrG,EAAwBkU,EAAxBlU,SAAUkY,EAAchE,EAAdgE,UAXwC,OAa1D,EAAK+hE,IAAM,IAAIC,oBAAiB,CAC9B/zE,WAAYjG,wBAAauY,GACzBmxD,cAA6B,QAAd1xD,EAAsBhY,wBAAaF,QAAYjF,EAC9Do/E,cAA6B,QAAdjiE,EAAsBhY,wBAAaF,QAAYjF,EAC9Dq/E,eAAgB,GAAK,KAAL,IAAK,EAAK,MAG5B,EAAKhB,OAAS,IAAII,KAAI,CAAED,YApBkC,E,6LAuBnCl8E,E,+BAAoB,G,kBACpC2D,KAAKi5E,IAAII,0BAA0Bh9E,I,wIAGzB+7D,GAAuC,WAAxB/7D,EAAwB,uDAAJ,GACpD,OAAOgE,aAAgB,uCAAU,WAAMC,GAAN,SAAAvH,EAAA,sEACzB,EAAKkgF,IAAIK,SAASlhB,EAAM/hE,QAAS+hE,EAAM5hE,MAAO4hE,EAAM1hE,IAAK,CAC7D6iF,aAAc,SAACC,EAAcC,GAC3B,IAAM3+E,EAAI0+E,EAAKxiC,MAAM,MACf3gD,EAAUyE,EAAE,GACZtE,GAASsE,EAAE,GACXpE,GAAOoE,EAAE,GACTmjB,EAAW,OAAH,OAAUw7D,GAClB55E,EAAO,EAAKu4E,OAAOK,UAAUe,EAAM,CACvCv7D,aAGMg6D,EAAqDp4E,EAArDo4E,WAAYD,EAAyCn4E,EAAzCm4E,WAAYU,EAA6B74E,EAA7B64E,YAAad,EAAgB/3E,EAAhB+3E,YAE7C,GAAIK,EAAY,CACd,IAAMU,EAASf,GAAec,GAAe,GACvCE,EAAQZ,EACRa,EAAeriF,EACrBqJ,EAAKse,YAAc,GAEnB,IAAK,IAAInlB,EAAI,EAAGA,EAAIi/E,EAAYj/E,GAAK,EAAG,CACtC,IAAM8/E,GAAQH,EAAO3/E,IAAM,GAAK6/E,EAC1BE,EAAOD,GAAQF,EAAM5/E,IAAM,GACjC6G,EAAKse,YAAY1W,KAAK,CACpBwW,SAAU,GAAF,OAAKA,EAAL,YAAiBjlB,GACzBxC,MAAOsiF,EACPpiF,IAAKqiF,EACLjyE,KAAM,kBAILjH,EAAKk4E,aACLl4E,EAAKg4E,kBACLh4E,EAAKi4E,SACZ,IAAM94D,EAAI,IAAIjB,GAAJ,2BACLle,GADK,IAERrJ,QACAE,MACAL,aAEIuE,EAAIokB,EAAEjoB,IAAI,cAAgBqgF,GAAwBp4D,GAAKA,EAC7D1e,EAASgG,KAAK1L,IAEhByD,OAAQhC,EAAKgC,SA3CgB,OA6C/BiC,EAASS,WA7CsB,2CAAV,sDA8CpB1E,EAAKgC,U,8CAjFiCqB,2BAAxBs5E,GAKLU,aAAe,CAAC,cAAe,eClBhC5kE,qCACb,kBACA,CACE2C,cAAe,CACb3Q,KAAM,eACNiO,aAAc,CAAEhd,IAAK,uBAGvBmb,MAAO4B,8BAAoB,aAAc,CACvCoC,UAAW,CACT/f,MAAOvB,QAAMo/D,YAAY,YAAa,CAAC,MAAO,QAC9CluD,KAAM,aACNiO,aAAc,OAEhB/V,SAAU,CACR8H,KAAM,eACNiO,aAAc,CAAEhd,IAAK,6BAIzBwgF,QAAS,CACPzxE,KAAM,SACNqB,YAAa,yDACb4M,aAAc,KAGlB,CAAEC,iBAAiB,ICjBA2kE,G,4MACnBp+E,KAAO,Y,sDAECyN,GACNA,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,gBACNqL,aAAcgzE,GACdxyE,aAAcyyE,QAGpB7wE,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,kBACNqL,aAAckzE,GACd1yE,aAAc2yE,Y,GAjBep3C,ICoBxBriC,uBAhBmD,SAAAyG,GAAS,IACjE5P,EAAU4P,EAAV5P,MADiE,EAE1CoW,KAAKW,MAAMX,KAAKC,UAAUrW,EAAMgX,cAAvD6rE,EAFiE,EAEjEA,SAAUC,EAFuD,EAEvDA,SAClB,OACE,kBAAC7rE,GAAA,EAAD,CAAOkZ,cAAY,yBACjB,kBAAC,GAAD,CAAiBvb,MAAM,YAAYU,QAASutE,IAC5C,kBAAC,GAAD,CAAiBjuE,MAAM,YAAYU,QAASwtE,IAC5C,kBAAC,GAAD,CAAgBluE,MAAM,uBAAuBU,QAASutE,IACtD,kBAAC,GAAD,CAAgBjuE,MAAM,uBAAuBU,QAASwtE,QCpBtDrzE,GAAekO,8BAAoB,6BAAzC,IAEMxN,GAAa,2CACoB,CACnCrQ,GADmC,aAEnC6P,KAAMlR,gBAF6B,8BAGnCuY,YAAavY,qBAJE,SAMR,SAAA2B,GAAI,MAAK,CAChBmhD,eADgB,YAEdnhD,iBAEFohD,iBAJgB,WAKdphD,sB,sBCGS,SAAS8qD,GAAkBr5C,GAAoB,IACpD+qC,EAAc/qC,EAAd+qC,UADoD,EAQxDA,EAAU,mBALLmmC,EAHmD,EAG1DtkF,MACAqgB,EAJ0D,EAI1DA,UACAkkE,EAL0D,EAK1DA,SACA35B,EAN0D,EAM1DA,YACA45B,EAP0D,EAO1DA,QAEM7kE,EAAkBw+B,EACxB,8CADMx+B,cAMFpe,EAAS+iF,EACZ/iF,MAAM,sBAAuB,CAC5B2P,KAAMlR,QAAMqkB,QAAQ,uBACpBq7C,aAAc,EACdrxC,OAAQruB,QAAMC,SACZD,QAAMgpD,WACJ,aACAhpD,QAAMa,QACN,SAACid,GAAD,OAAeA,GAVL,MACI,KAalBqhD,kBAAmB,eACnBslB,oBAAoB,EACpBC,WAAW,EACXC,iBAAiB,EACjB3nE,MAAOhd,QAAMwc,MACXpJ,EAAc2T,YAAY,oBACvBrV,cAGN+K,UAAS,iBAAO,CACfpC,MAAO,QAER2C,OAAM,SAAArb,GAAI,MAAK,CAEd,oBACE,IAAMijF,EAAajjF,EAAKqb,MAAMzR,KAAI,SAAA8Z,GAAI,OACpCA,EAAK/F,OAAO/T,KAAI,SAAAk/B,GAAC,OAAIA,EAAEvqB,cAAcoD,cAEvC,OAAOuhE,KAAY,WAAZ,cAAgBD,KAGzB,gBACE,IAAM7/D,EAAwB,GAS9B,OARApjB,EAAKqb,MAAMxM,SAAQ,SAAC6U,EAAM7H,GACpB6H,EAAKN,WACPA,EAAUlT,KAAK,CACb9O,MAAO,QAAF,OAAUya,EAAM,EAAhB,SACL0X,QAAS7P,EAAKN,eAIbA,GAGT,wBACE,OAzE2B,GA6E7B+/D,iBA3Bc,SA2BGC,GACf,OAAOpjF,EAAKqb,MACTzR,KAAI,SAAA8Z,GAAI,OAAIA,EAAK46C,SAAS8kB,MAC1B7sE,QAAO,SAAAkR,GAAC,QAAMA,MAInB47D,eAlCc,SAkCCD,GACb,OAAO36E,KAAK66E,iBAAiBF,GAAe38E,MAAK,SAAAghB,GAAC,OAChDA,EAAEjoB,IAAI,2BAMV+jF,kBA1Cc,SA0CIH,GAChB,OAAO36E,KAAK66E,iBAAiBF,GAAe38E,MAC1C,SAAAghB,GAAC,MAAsB,kBAAlBA,EAAEjoB,IAAI,YAMf8jF,iBAlDc,SAkDGF,GACf,IAAMzlE,EAASlV,KAAK06E,iBAAiBC,GACrC,OAAO,IAAIvhC,IACRlkC,GAAU,IAAI/T,KAAI,SAAAk/B,GAAC,OAAIA,EAAElmB,SAAS,GAAG7H,cAK1CyoE,gCA1Dc,SA0DkB7hE,GAC9B,IAD+C,EACzC5G,EAAWtS,KAAK66E,iBAAiB3hE,GACjCkkD,EAAqB,GACrB4d,EAAc,IAAIx9D,IAHuB,eAK/BlL,EAAS8oB,UALsB,IAK/C,2BAAmC,KAAxBpc,EAAwB,QAC5Bg8D,EAAYr9D,IAAIqB,EAAE/nB,OACG,UAApB+nB,EAAEjoB,IAAI,OAAO,IACfqmE,EAAM31D,KAAK,CAACuX,IAGhBg8D,EAAYv9D,IAAIuB,EAAE/nB,OAX2B,8BAc/C,OAAOmmE,GAKT6d,2BA7Ec,SA6Ea/hE,GACzB,IAD0C,EACpC5G,EAAWtS,KAAK66E,iBAAiB3hE,GACjCgiE,EAAwC,GACxCF,EAAc,IAAIx9D,IAHkB,eAK1BlL,EAAS8oB,UALiB,yBAK/Bpc,EAL+B,QAMnCg8D,EAAYr9D,IAAIqB,EAAE/nB,OACC,aAAlB+nB,EAAEjoB,IAAI,SACRioB,EAAEjoB,IAAI,OAAOqP,SAAQ,SAACrN,GACpB,IAAMoiF,EAAM,GAAH,OAAMn8D,EAAEjoB,IAAI,WAAZ,YAA0BioB,EAAEjoB,IAAI,SAAW,GACpD,GAAIuW,KAASvU,GAAI,CACf,IAAMqiF,EAAMriF,EACPmiF,EAAWC,GAGdD,EAAWC,GAAK1zE,KAAKuX,GAFrBk8D,EAAWE,EAAIC,cAAgB,CAACr8D,OAQ1Cg8D,EAAYv9D,IAAIuB,EAAE/nB,OAhBpB,2BAAmC,IALO,8BAwB1C,OAAOgC,OAAOmiC,OAAO8/C,GAAYptE,QAAO,SAAA7T,GAAC,OAAIA,EAAEgB,OAAS,MAK1DqgF,4BA1Gc,SA0GcpiE,GAC1B,IAD2C,EACrC5G,EAAWtS,KAAK66E,iBAAiB3hE,GACjCgiE,EAAwC,GACxCF,EAAc,IAAIx9D,IAHmB,eAMrBlL,EAAS8oB,UANY,IAM3C,2BAAyC,KAA9B3uB,EAA8B,QACvC,IAAKuuE,EAAYr9D,IAAIlR,EAAQxV,QAAUwV,EAAQ1V,IAAI,YAAa,CAC9D,IAAM2c,EAAIjH,EAAQ1V,IAAI,QACjBmkF,EAAWxnE,KACdwnE,EAAWxnE,GAAK,IAElBwnE,EAAWxnE,GAAGjM,KAAKgF,GAErBuuE,EAAYv9D,IAAIhR,EAAQxV,OAdiB,8BAiB3C,OAAOgC,OAAOmiC,OAAO8/C,GAAYptE,QAAO,SAAA7T,GAAC,OAAIA,EAAEgB,OAAS,MAK1DsgF,yBAhIc,SAgIWriE,GACvB,IADwC,EAClC5G,EAAWtS,KAAK66E,iBAAiB3hE,GACjCgiE,EAAwC,GACxCF,EAAc,IAAIx9D,IAHgB,eAMlBlL,EAAS8oB,UANS,IAMxC,2BAAyC,KAA9B3uB,EAA8B,QACvC,IACGuuE,EAAYr9D,IAAIlR,EAAQxV,QACxBwV,EAAQ1V,IAAI,yCACZ0V,EAAQ1V,IAAI,YACb,CACA,IAAM2c,EAAIjH,EAAQ1V,IAAI,QACjBmkF,EAAWxnE,KACdwnE,EAAWxnE,GAAK,IAElBwnE,EAAWxnE,GAAGjM,KAAKgF,GAErBuuE,EAAYv9D,IAAIhR,EAAQxV,OAlBc,8BAqBxC,OAAOgC,OAAOmiC,OAAO8/C,GAAYptE,QAAO,SAAA7T,GAAC,OAAIA,EAAEgB,OAAS,MAG1DugF,2BAxJc,SAwJab,EAAuBroE,GAChD,IAAM4C,EAASlV,KAAK06E,iBAAiBC,GACrC,OAAOroE,EAASnR,KAAI,SAAAmd,GAAC,OACnBA,EAAEnd,KAAI,SAACsL,GACL,IAAI00B,EACEjT,EAAQhZ,EAAO/B,WAAU,SAAAyC,GAE7B,OADAurB,EAASvrB,EAAMuE,SAAS,GAAGwlC,eAAe5oD,IAAI0V,EAAQxV,SAGxD,MAAO,CACLwV,UACA00B,SACAjT,oBAMT52B,SAAQ,SAAAC,GAAI,MAAK,CAChB4d,YADgB,WACF,WACZqrC,EACEjpD,EACA4iF,EACE5iF,GACA,YAQM,IAPJgE,EAOI,EAPJA,KACAuH,EAMI,EANJA,KACAnD,EAKI,EALJA,KAMA,GAAIpI,EAAK+iF,UAAW,CACF,CACd,mBACA,SACA,iBACA,YACA,cACA,YACA,iBACA,oBAEUh5E,SAAS/F,IAASuH,GAC5B,EAAK24E,gBAAgBlgF,EAAMuH,EAAMnD,SAQ7C87E,gBAnCgB,SAmCAC,EAAoB54E,EAAcnD,GAChDpI,EAAKqb,MAAMxM,SAAQ,SAAA6U,GACjB,IAAMrZ,EAAMw4E,EAAQn/D,GAChBrZ,EAAI+5E,YAAY74E,KAAUlB,EAAI3G,OAAS6H,EAAK7H,QAE9CggB,EAAKygE,GAAY/7E,EAAK,QAK5B8V,SA7CgB,SA6CPC,GACPne,EAAK0Y,MAAQyF,EACbne,EAAKqb,MAAMxM,SAAQ,SAAAnM,GAAC,OAAIA,EAAEwb,SAASC,OAGrCuhD,WAlDgB,SAkDLh8C,GACT1jB,EAAKqb,MAAMsJ,OAAOjB,IAGpB87C,UAtDgB,WAuDd9gD,EAAU1e,EAAM,GAAG0/D,WAAW1/D,IAGhCqkF,gBA1DgB,SA0DA33D,GACd1sB,EAAK+9D,aAAerxC,GAGtB43D,eA9DgB,WA+DdtkF,EAAKgjF,iBAAmBhjF,EAAKgjF,iBAE/BuB,qBAjEgB,WAkEdvkF,EAAK8iF,oBAAsB9iF,EAAK8iF,oBAElC0B,gBApEgB,WAqEdxkF,EAAK+iF,WAAa/iF,EAAK+iF,eAS7B,MAAO,CAAEhzE,WALW4yE,EAAiCxiF,QACnD6d,EACApe,I,4BC1SsB,CAAC,EAAG,EAAG,EAAG,GAA3B6kF,G,MAAOC,G,MAaT,SAASC,GACdjhE,EACA5kB,EACA2c,GAEA,QAASiI,EAAKlI,OAAO,CAAE1c,UAAS2c,WAAY,IAAI1D,UAAY,GAAK2L,EAAK3L,SAIjE,SAAS6sE,GACdxB,EACAzsD,EACAtb,EACAsC,EAUAoJ,GAEA,IApCe8qD,EAoCT5hE,EAAU0N,EAAOgZ,GAAO/T,SAAS,GAEjClJ,EAAMzJ,EAAQyc,OAChB9f,EAAS,EACLqpE,EAAqChmE,EAArCgmE,aAAcD,EAAuB/lE,EAAvB+lE,mBAItB,OAHIA,GAAsBC,IACxBrpE,EAASopE,EAAmBtpD,OAAS,GAGrC1P,iBAAM+J,EAAE09D,IAAOx0E,EAAQy3C,YA7CVmqB,EA6C8B9qD,GA5ChC29D,IAAU7S,EAAM4S,KA4CqB,EAAI73E,EAR1C,EAQuD8M,GA1CrE,SACE2B,EACA+nE,EACAzsD,GAEA,OAAOtb,EAAMsb,GAAO8gC,UAAU2rB,GAAezxD,wBAAwB/C,IAsCnEi2D,CAAwBxpE,EAAO+nE,EAAezsD,GAC9C1mB,EAAQy3C,UAQL,IAAMo9B,GAAe,SAACC,GAAsB,MACnB53D,qBAArB63D,EADwC,oBAEjDx3D,qBAAU,WACRw3D,EAAkBD,KACjB,CAACA,K,GC/DkB,CAAC,EAAG,EAAG,EAAG,GAA3BE,G,MAAQhb,G,MAGA,YAACx4D,GAAuB,IAC7B+qC,EAAc/qC,EAAd+qC,UACAz6B,EAAey6B,EAAU,sBAAzBz6B,WACAhZ,EAAayzC,EAAU,cAAvBzzC,SACF2G,EAAQ8sC,EAAU,SAChBrvB,EAAaqvB,EAAU,SAAvBrvB,SACA3kB,EAAgBg0C,EAAU,mBAA1Bh0C,YAER,OAAOO,GACL,YASM,IARJnJ,EAQI,EARJA,MACAwjF,EAOI,EAPJA,cACW5yD,EAMP,EANJ00D,UAOQ7pE,EAA8Bzb,EAA9Byb,MAAOynE,EAAuBljF,EAAvBkjF,mBACT5/D,EAAUnB,EAAWniB,GACrBkB,EAAO0H,EAAY5I,GACzBklF,GAAahkF,GAEb,IAAMqkF,EAAgBvlF,EAAM0jF,iBAAiBF,GACvCroE,EAAWnb,EAAMyjF,eAAeD,GAClCxjF,EAAMokF,yBAAyBZ,GAC/BxjF,EAAMmkF,4BAA4BX,GAChCgC,EAAgBxlF,EAAMqkF,2BAC1Bb,EACAroE,GAEFqqE,EAAcv2E,SAAQ,SAAA0gE,GACpBA,EAAEl9C,MAAK,SAAC7wB,EAAGC,GAAJ,OAAUD,EAAE0T,QAAQ1V,IAAI,WAAaiC,EAAEyT,QAAQ1V,IAAI,iBAfxD,MAiBoC2tB,IAjBpC,mBAiBGk4D,EAjBH,KAiBiBC,EAjBjB,KAmBAC,EAAU,EACd,GAAI/0D,EAAI5C,QAAS,CACf,IAAM8D,EAAOlB,EAAI5C,QAAQ+D,wBACzB4zD,EAAU7zD,EAAK9C,IAEjB,OACE,qBACEyjC,OAAO,OACP/vD,KAAK,OACLytB,cACEq1D,EAAc1hF,OAAd,UAA0B0/E,EAA1B,WAAmDA,GAGpDgC,EAAcx7E,KAAI,SAAAioE,GAIjB,IAHA,IAAMxnE,EAAM,GADc,WAIjB/G,GAJiB,MAK2BuuE,EAAMvuE,GAAzCkiF,EALQ,EAKhB57C,OAAqB67C,EALL,EAKJvwE,QAAoBwwE,EALhB,EAKS/uD,MALT,EAM2Bk7C,EAAMvuE,EAAI,GAA7CqiF,EANQ,EAMhB/7C,OAAqBg8C,EANL,EAMJ1wE,QAAoB2wE,EANhB,EAMSlvD,MAEjC,IAAK6uD,IAAOG,EAEV,OADAhhF,QAAQ4H,KAAK,8CACb,GAAO,MAIT,IAAKu2E,GAAsB4C,IAAWG,EACpC,SAAO,MAGT,IAAMpgD,EAAKk/C,GACTtpE,EAAMqqE,GACND,EAAGjmF,IAAI,WACPgmF,GAAyB,IAAtBC,EAAGjmF,IAAI,UAAmBylF,GAAOhb,KAEhCvkC,EAAKi/C,GACTtpE,EAAMwqE,GACND,EAAGpmF,IAAI,WACPmmF,GAAyB,IAAtBC,EAAGpmF,IAAI,UAAmByqE,GAAQgb,KAEjCa,EAAYzqE,EAAMqqE,GAAQ3pE,OAAO0pB,GAAI5lC,SACrCkmF,EAAY1qE,EAAMwqE,GAAQ9pE,OAAO2pB,GAAI7lC,SAErC8d,EAAStC,EAAMzR,KAAI,SAAAlH,GAAC,OAAIA,EAAE47D,SAAS8kB,MAEnCz9C,EACJi/C,GAAKxB,EAAesC,EAAQrqE,EAAOsC,EAAQ6nE,GAAMD,EAC7C3/C,EACJg/C,GAAKxB,EAAeyC,EAAQxqE,EAAOsC,EAAQgoE,GAAMJ,EAG7Ch6E,EAAOy6E,OACVvpE,OAAOgpB,EAAIE,GACXsgD,QACCxgD,EAAK,IAAMggD,EAAGjmF,IAAI,WAAasmF,GAAa,EAAI,GAChDngD,EACAD,EAAK,IAAMkgD,EAAGpmF,IAAI,WAAaumF,GAAa,EAAI,GAChDngD,EACAF,EACAE,GAEDzmC,MACGO,EAAK,GAAH,OAAM+lF,EAAG/lF,KAAT,YAAiBkmF,EAAGlmF,MAC5B2K,EAAI6F,KACF,wBACEuU,EAAGlZ,EACHgK,IAAK7V,EACLqwB,cAAY,KACZm2D,YAAab,IAAiB3lF,EAAK,EAAI,EACvC8lB,QAAS,WACP,IAAMkkC,EAAgBxmC,EAAQymC,UAC5B,6BACA,uBACA,CACE/yC,YAAa,CACX6rE,UACE0C,EAAc3lF,IAAIimF,EAAG/lF,OAAS,CAAEunB,OAAQ,eACxCA,SACFy7D,UACEyC,EAAc3lF,IAAIomF,EAAGlmF,OAAS,CAAEunB,OAAQ,eACxCA,YAIR/D,EAAQ0mC,WAAWF,IAErBxsB,YAAa,kBAAMooD,EAAgB5lF,IACnCy9B,WAAY,kBAAMmoD,OAAgB9iF,QAvE/Bc,EAAI,EAAGA,EAAIuuE,EAAMnuE,OAAS,EAAGJ,GAAK,EAAG,SAArCA,GAAqC,kCA2E9C,OAAO+G,UCzHJ,gBAACoH,GAAuB,IAC7B+qC,EAAc/qC,EAAd+qC,UACAzzC,EAAayzC,EAAU,cAAvBzzC,SACF2G,EAAQ8sC,EAAU,SAChBrvB,EAAaqvB,EAAU,SAAvBrvB,SACA3kB,EAAgBg0C,EAAU,mBAA1Bh0C,YAER,OAAOO,GACL,YASM,IARJnJ,EAQI,EARJA,MACAwjF,EAOI,EAPJA,cACW5yD,EAMP,EANJ00D,UAOQ7pE,EAAUzb,EAAVyb,MACFN,EAAWnb,EAAM8jF,2BAA2BN,GAC5CgC,EAAgBxlF,EAAMqkF,2BAC1Bb,EACAroE,GALE,EAOoCoS,IAPpC,mBAOGk4D,EAPH,KAOiBC,EAPjB,KAQExkF,EAAO0H,EAAY5I,GACzBklF,GAAahkF,GAEb,IAAIykF,EAAU,EACd,GAAI/0D,EAAI5C,QAAS,CACf,IAAM8D,EAAOlB,EAAI5C,QAAQ+D,wBACzB4zD,EAAU7zD,EAAK9C,IAEjB,OACE,qBACEyjC,OAAO,QACP6zB,YAAa,EACb5jF,KAAK,OACLytB,cACEq1D,EAAc1hF,OAAd,UAA0B0/E,EAA1B,WAAmDA,GAGpDgC,EAAcx7E,KAAI,SAAAioE,GAIjB,IAHA,IAAMxnE,EAAM,GADc,WAIjB/G,GAJiB,MAK2BuuE,EAAMvuE,GAAzCkiF,EALQ,EAKhB57C,OAAqB67C,EALL,EAKJvwE,QAAoBwwE,EALhB,EAKS/uD,MALT,EAM2Bk7C,EAAMvuE,EAAI,GAA7CqiF,EANQ,EAMhB/7C,OAAqBg8C,EANL,EAMJ1wE,QAAoB2wE,EANhB,EAMSlvD,MAC3Bj3B,EAAK,GAAH,OAAM+lF,EAAG/lF,KAAT,YAAiBkmF,EAAGlmF,MACtBymF,EA1DpB,SAAyBC,EAAgBC,GACvC,IAAM1C,EAAuC,GAI7C,OAHAyC,EAAM5mF,IAAI,OAAOqP,SAAQ,SAACg1E,GACxBF,EAAWE,EAAIC,cAAgBD,KAE1BF,EAAW,GAAD,OAAI0C,EAAM7mF,IAAI,WAAd,YAA4B6mF,EAAM7mF,IAAI,SAAW,IAqDlC8mF,CAAgBb,EAAIG,GACxC,IAAKJ,IAAOG,EAAI,MAAO,CAAP,EAAO,MACvB,IAAMlgD,EAAKk/C,GACTtpE,EAAMqqE,GACND,EAAGjmF,IAAI,WACPgmF,EAjEA,IAmEI9/C,EAAKi/C,GACTtpE,EAAMwqE,GACND,EAAGpmF,IAAI,WACPmmF,EAtEA,IAwEIG,EAAYzqE,EAAMqqE,GAAQ3pE,OAAO0pB,GAAI5lC,SACrCkmF,EAAY1qE,EAAMwqE,GAAQ9pE,OAAO2pB,GAAI7lC,SAErC8d,EAAStC,EAAMzR,KAAI,SAAAlH,GAAC,OAAIA,EAAE47D,SAAS8kB,MACnCz9C,EACJi/C,GAAKxB,EAAesC,EAAQrqE,EAAOsC,EAAQ6nE,GAAMD,EAC7C3/C,EACJg/C,GAAKxB,EAAeyC,EAAQxqE,EAAOsC,EAAQgoE,GAAMJ,EACnD,GAAKY,EAIE,CACL,IAAM56E,EAAOy6E,OACVvpE,OACCgpB,EACE,IACwB,SAArB0gD,EAAYI,MAAmB,EAAI,IACnCT,GAAa,EAAI,GACtBngD,GAED6gD,OAAO/gD,EAAIE,GACX6gD,OAAO9gD,EAAIE,GACX4gD,OACC9gD,EACE,IACiC,SAA9BygD,EAAYM,cAA2B,GAAK,IAC5CV,GAAa,EAAI,GACtBngD,GAEDzmC,MACHkL,EAAI6F,KACF,wBACEuU,EAAGlZ,EACHgK,IAAKS,KAAKC,UAAU1K,GACpB26E,YAAaxmF,IAAO2lF,EAAe,GAAK,EACxCnoD,YAAa,kBAAMooD,EAAgB5lF,IACnCy9B,WAAY,kBAAMmoD,OAAgB9iF,YA5BtCmC,QAAQ4H,KACN,yDA1BGjJ,EAAI,EAAGA,EAAIuuE,EAAMnuE,OAAS,EAAGJ,GAAK,EAAG,SAArCA,GAAqC,kCA0D9C,OAAO+G,U,+IC7GJ,eAAuC,IAApCmyC,EAAoC,EAApCA,UAAoC,EACpBA,EAAU,cAAlCzzC,EAD4C,EAC5CA,SACF2G,GAF8C,EAClChR,UACJ89C,EAAU,UAClBkqC,EAAalqC,EAAU,gCAIvB9pC,GAAYC,EAHK6pC,EAAU,4BAAzB7pC,aAGqB,SAACC,GAAD,MAAiB,CAC5CmhD,UAAW,CACT4yB,SAAU,kBACV12E,QAAS,QAEX+jD,OAAQ,CACNtkC,SAAU,GAEZk3D,SAAU,CACRzzE,WAAYP,EAAMQ,QAAQ2U,UAAUD,KACpChV,QAASF,EAAMG,QAAQ,IAEzBiqB,QAAS,CACP7pB,WAAYP,EAAMQ,QAAQ2U,UAAUuP,OAEtC3mB,YAAa,CACXwC,WAAYP,EAAMQ,QAAQ2U,UAAUD,KACpCkD,WAAY,EACZK,YAAazY,EAAMG,QAAQ,GAC3Bkf,aAAcrf,EAAMG,QAAQ,IAE9ByhB,UAAW,CACTvhB,MAAOL,EAAMQ,QAAQ2U,UAAU6C,cAEjC+J,UAAW,CACT,UAAW,CACT/gB,gBAAiBhB,EAAMQ,QAAQ2U,UAAUuP,QAG7C1C,aAAc,CACZ2C,YAAa3kB,EAAMQ,QAAQyU,QAAQC,KACnClU,gBAAiBhB,EAAMQ,QAAQ2U,UAAUuP,WAIvCuvD,EAAwB99E,GAC5B,YAA+C,IAA5CnJ,EAA4C,EAA5CA,MACK0U,EAAU5B,IAChB,OACE,gBAACg0E,EAAD,CACElhE,QAAS,kBAAM5lB,EAAM0kF,kBACrBxvE,UAAWR,EAAQ8hD,WACnB5hD,MAAM,uCAEL5U,EAAMojF,gBAAkB,gBAAC,KAAD,MAAwB,gBAAC,KAAD,UAQnD8D,EAAY/9E,GAAS,YAA+C,IAA5CnJ,EAA4C,EAA5CA,MACtB0U,EAAU5B,IAChB,OACE,gBAACg0E,EAAD,CACElhE,QAAS,kBAAM5lB,EAAM4kF,mBACrB1vE,UAAWR,EAAQ8hD,WACnB5hD,MAAM,mDAEL5U,EAAMmjF,UACL,gBAAC,KAAD,CAAU9vE,MAAM,cAEhB,gBAAC,KAAD,CAAaA,MAAM,kBAQrB8zE,EAAOh+E,GAAS,YAA+C,IAA5CnJ,EAA4C,EAA5CA,MACjB0U,EAAU5B,IAChB,OACE,gBAACg0E,EAAD,CACElhE,QAAS5lB,EAAM2kF,qBACfzvE,UAAWR,EAAQ8hD,WACnB5hD,MAAM,oCAEL5U,EAAMkjF,mBACL,gBAAC,KAAD,CAAS7vE,MAAM,cAEf,gBAAC,KAAD,CAAYA,MAAM,kBAQpB+zE,EAASj+E,GACb,YAMM,IALJnJ,EAKI,EALJA,MACAuG,EAII,EAJJA,KAKMmO,EAAU5B,IAGhB,OADA9S,EAAMykF,gBAAgBl+E,EAAKumB,QAEzB,uBAAK5X,UAAWR,EAAQy/C,WACtB,gBAAC+yB,EAAD,CAAWlnF,MAAOA,IAClB,gBAACinF,EAAD,CAAuBjnF,MAAOA,IAC9B,gBAACmnF,EAAD,CAAMnnF,MAAOA,IAEb,uBAAKkV,UAAWR,EAAQ0/C,aAUhC,OAAOizB,oBAAS,CAAEC,eAAe,GAA1BD,CAAkCD,ICjI5B,YAACv1E,GAAuB,IAC7B+qC,EAAc/qC,EAAd+qC,UACAz6B,EAAey6B,EAAU,sBAAzBz6B,WACAhZ,EAAayzC,EAAU,cAAvBzzC,SACF2G,EAAQ8sC,EAAU,SAChBrvB,EAAaqvB,EAAU,SAAvBrvB,SACA3kB,EAAgBg0C,EAAU,mBAA1Bh0C,YAIR,OAAOO,GACL,YASM,IARJnJ,EAQI,EARJA,MACAwjF,EAOI,EAPJA,cACW5yD,EAMP,EANJ00D,UAOQ7pE,EAAUzb,EAAVyb,MACF6H,EAAUnB,EAAWniB,GACrBmb,EAAWnb,EAAM4jF,gCAAgCJ,GACjD+B,EAAgBvlF,EAAM0jF,iBAAiBF,GACvCgC,EAAgBxlF,EAAMqkF,2BAC1Bb,EACAroE,GAPE,EASoCoS,IATpC,mBASGk4D,EATH,KASiBC,EATjB,KAUExkF,EAAO0H,EAAY5I,GACzBklF,GAAahkF,GAEb,IAAIykF,EAAU,EACd,GAAI/0D,EAAI5C,QAAS,CACf,IAAM8D,EAAOlB,EAAI5C,QAAQ+D,wBACzB4zD,EAAU7zD,EAAK9C,IAQjB,OAAIvT,EAAM3X,OAAS,EACV,KAGP,qBACEpB,KAAK,OACL+vD,OAAO,QACP6zB,YAAa,EACbn2D,cACEq1D,EAAc1hF,OAAd,UAA0B0/E,EAA1B,WAAmDA,GAGpDgC,EAAcx7E,KAAI,SAAAioE,GAIjB,IADA,IAAMxnE,EAAM,GAHc,WAIjB/G,GAJiB,MAK2BuuE,EAAMvuE,GAAzCkiF,EALQ,EAKhB57C,OAAqB67C,EALL,EAKJvwE,QAAoBwwE,EALhB,EAKS/uD,MAC3BkvD,EAAoB,IAAXH,EAAe,EAAI,EAC5BhmF,EAAK+lF,EAAG/lF,KACd,IAAK8lF,EAAI,MAAO,CAAP,EAAO,MAEhB,IAAM5oB,EAAO6oB,EAAGjmF,IAAI,QACd2nF,EAAOvqB,EAAKwqB,KAAK,GACjBC,EAAOzqB,EAAK0qB,IAAI,GAZE,EAaa1qB,EAAK2qB,QAAQ,GAAG9nC,MAAM,IAbnC,mBAajB+nC,EAbiB,KAaJC,EAbI,KAelBpkF,EAAIshF,GAAoBtpE,EAAMwqE,GAASsB,EAAME,GACnD,GAAIhkF,EAAG,CACL,IAAMsiF,EAAmB,CAACtiF,EAAG,EAAGA,EAAI,EAAG,GAEjCoiC,EAAKk/C,GACTtpE,EAAMqqE,GACND,EAAGjmF,IAAI,WACPgmF,EAtEA,IAwEI9/C,EAAKriC,EACLyiF,EAAYzqE,EAAMqqE,GAAQ3pE,OAAO0pB,GAAI5lC,SACrCkmF,EAAY1qE,EAAMwqE,GAAQ9pE,OAAO2pB,GAAI7lC,SAErC8d,EAAStC,EAAMzR,KAAI,SAAAlH,GAAC,OAAIA,EAAE47D,SAAS8kB,MACnCz9C,EACJi/C,GAAKxB,EAAesC,EAAQrqE,EAAOsC,EAAQ6nE,GAAMD,EAC7C3/C,EACJg/C,GAAKxB,EAAeyC,EAAQxqE,EAAOsC,EAAQgoE,GAAMJ,EAE7Ch6E,EAAOy6E,OACVvpE,OACCgpB,EACE,IACmB,MAAhB+hD,EAAsB,GAAK,IAC3B1B,GAAa,EAAI,GACtBngD,GAED6gD,OAAO/gD,EAAIE,GACX6gD,OAAO9gD,EAAIE,GACX4gD,OACC9gD,EACE,IACqB,MAAlB+hD,EAAwB,GAAK,IAC7B1B,GAAa,EAAI,GACtBngD,GAEDzmC,MACHkL,EAAI6F,KACF,wBACEuU,EAAGlZ,EACHgK,IAAKS,KAAKC,UAAU1K,GACpB26E,YAAaxmF,IAAO2lF,EAAe,GAAK,EACxC7/D,QAAS,WACP,IAAMkkC,EAAgBxmC,EAAQymC,UAC5B,uBACA,iBACA,CACE/yC,aACEuuE,EAAc3lF,IAAIE,IAAO,CAAEunB,OAAQ,eACnCA,WAGN/D,EAAQ0mC,WAAWF,IAErBxsB,YAAa,kBAAMooD,EAAgB5lF,IACnCy9B,WAAY,kBAAMmoD,OAAgB9iF,SAlEjCc,EAAI,EAAGA,EAAIuuE,EAAMnuE,OAAQJ,GAAK,EAAG,SAAjCA,GAAiC,kCAuE1C,OAAO+G,UCjIJ,YAACoH,GAAuB,IAC7B+qC,EAAc/qC,EAAd+qC,UAD6B,EAELA,EAAU,cAAlCzzC,EAF6B,EAE7BA,SACF2G,GAH+B,EAEnBhR,UACJ89C,EAAU,UAChBjvB,EAAW7d,EAAX6d,OACYm6D,EAAyBlrC,EAC3C,4BADM7pC,WAIFg1E,EAAuBnrC,EAAUorC,IACjCC,EAAYrrC,EAAUsrC,IACtBC,EAAiBvrC,EAAUwrC,IAE3BhB,EAASxqC,EAAUyrC,IAEnBv1E,EAAag1E,GAA2C,SAAA90E,GAC5D,MAAO,CACL6X,KAAM,CACJ5d,SAAU,WACVq7E,aAAct1E,EAAMG,QAAQ,GAC5BiB,SAAU,UAEZm0E,iBAAkB,CAChBt7E,SAAU,WACV+hB,IAAK,EACLlC,OAAQ,OACRhU,MAAO,MACPvF,WAAY,WAEdi1E,YAAa,CACXj1E,WAAYP,EAAMQ,QAAQ2U,UAAUD,KACpC4E,ON7B2B,GM+B7BgN,UAAW,CACTzpB,QAAS,QAEX+mD,QAAS,CACP/mD,QAAS,OACTyI,MAAO,OACPiuE,SAAU,MACV,SAAU,CACRn6D,OAAQ,YACRlqB,KAAM,SAGVuoB,QAAS,CACP87D,SAAU,WAKV0B,EAAUt/E,GACd,SAACyG,GAAiE,IACxD5P,EAAyB4P,EAAzB5P,MAAOwjF,EAAkB5zE,EAAlB4zE,cACTzlE,EAAS/d,EAAMujF,iBAAiBC,GACtC,MACqB,gBAAnBzlE,EAAO,GAAGpO,MACS,oBAAnBoO,EAAO,GAAGpO,KAEH,gBAACo4E,EAAyBn4E,GAEZ,iBAAnBmO,EAAO,GAAGpO,KACL3P,EAAM2jF,kBAAkBH,GAC7B,gBAAC2E,EAAmBv4E,GAEpB,gBAACq4E,EAAcr4E,GAGZ,QAuEX,OAnE4BzG,GAC1B,YAA+C,IAA5CnJ,EAA4C,EAA5CA,MACK0U,EAAU5B,IACR2I,EAAUzb,EAAVyb,MACFmV,EAAMjD,EAAO,MAEnB,OACE,2BACE,gBAACy5D,EAAD,CAAQpnF,MAAOA,IACf,uBAAKkV,UAAWR,EAAQolB,WACtB,uBAAK5kB,UAAWR,EAAQuW,SACtB,uBAAKnW,MAAO,CAAE7H,SAAU,aACrBwO,EAAMzR,KAAI,SAAC8Z,EAAM7H,GAAQ,IAChBzM,EAAmBqC,EAAc2T,YACvC1B,EAAKnU,MADCH,eAGFk5E,EACJ,gBAACl5E,EAAD,CAAgBmG,IAAKmO,EAAKhkB,GAAIE,MAAO8jB,IAEvC,OAAI7H,IAAQR,EAAM3X,OAAS,EAClB4kF,EAEF,CACLA,EACA,uBACE/yE,IAAG,UAAKmO,EAAKhkB,GAAV,YACHoV,UAAWR,EAAQ8zE,oBAM7B,uBAAKtzE,UAAWR,EAAQ0iD,SACtB,uBACExmC,IAAKA,EACL9b,MAAO,CACLgE,MAAO,OACP8V,OAAQ,GACR4T,cAAexiC,EAAMojF,qBAAkBxgF,EAAY,SAGpD5C,EAAM2oF,cAAc3+E,KAAI,SAAAlK,GAOvB,OACE,gBAAC2oF,EAAD,CACEnD,UAAW10D,EACXjb,IAAK7V,EACLE,MAAOA,EACPwjF,cAAe1jF,eC3H/B8oF,G,0LACwBtzE,EAAkBwO,GAC5C,IAEI+kE,EAaAC,EAfEC,GAAyBzzE,EAAQ1V,IAAI,QAAU,IAAI,GACnDopF,EAAW1zE,EAAQ1V,IAAI,SAKrBY,EAAiBsjB,EAAKjL,iBAAiB,GAAvCrY,aAEAugE,EADS5+C,sBAAW2B,GAAM22B,gBAAgB76C,IAAIY,GAC9CugE,oBACFkoB,EAAiBloB,EAAoBzrD,EAAQ1V,IAAI,YAEjDspF,EAAYplE,EAAKjL,iBAAiBhS,MACtC,SAAAghB,GAAC,OAAIA,EAAE3oB,UAAYyI,OAAOshF,MAIxBE,EAAW,EACXC,EAAS,EAEb,GAAIL,EAEF,GAA8B,UAA1BA,EAAmC,CACrC,IAAMM,EAAO/zE,EAAQ1V,IAAI,SAAW,GACpCipF,EAASQ,EAAK3B,IAAI,GAAK,EACvBoB,EAAc/nB,EAAoBsoB,EAAK7B,KAAK,QACvC,CACL,IAAM8B,EAAeP,EAAsB7E,aAAarkC,MAAM,KAC9DgpC,EAAS7hF,SAASsiF,EAAa,GAAI,IAAM,EACzCR,EAAc/nB,EAAoBuoB,EAAa,IACZ,SAA/BP,EAAsBpC,OAAiBwC,GAAY,GACX,SAAxCJ,EAAsBlC,gBAA0BuC,GAAU,QAQ3D,GAAI9zE,EAAQ1V,IAAI,QAAS,CAE9B,IAAM2zE,EAAOj+D,EAAQ1V,IAAI,QACzBkpF,EAAc/nB,EAAoBwS,EAAKr0E,SACvC2pF,EAAStV,EAAKl0E,MAGhB,IAAKypF,EAIH,OAHA/jF,QAAQ4H,KAAR,yCACoCm8E,EADpC,yBAGO,GAGT,IAAMS,EAAezlE,EAAKjL,iBAAiBhS,MACzC,SAAAghB,GAAC,OAAIA,EAAE3oB,UAAYyI,OAAOmhF,MAG5B,IAAKI,IAAcK,EAIjB,OAHAxkF,QAAQ4H,KAAR,2EAGO,GAGT,IAAM68E,EAAkB,CAAC,eAAKN,GAAN,eAAwBA,IAC1CO,EAAqB,CAAC,eAAKF,GAAN,eAA2BA,IA2BtD,OA1BAC,EAAgB,GAAGjqF,IAAMypF,EAAWG,EACpCK,EAAgB,GAAGnqF,MAAQ2pF,EAAWG,EACtCM,EAAmB,GAAGlqF,IAAMspF,EAASO,EACrCK,EAAmB,GAAGpqF,MAAQwpF,EAASO,EACtB,CACfz5E,KAAM,sBACN8L,MAAO,CACL,CACE9L,KAAM,mBACNkJ,iBAAkB2wE,EAClBlsB,YAAY,EACZ1uD,QAzEU,GA0EVuJ,UAAW+wE,EAAU7pF,MAAQiW,EAAQ1V,IAAI,UA1E/B,IA4EZ,CACE+P,KAAM,mBACNkJ,iBAAkB4wE,EAClBnsB,YAAY,EACZ1uD,QAhFU,GAiFVuJ,UAAWoxE,EAAalqF,MAAQwpF,GAjFtB,KAoFd93E,YAAa,GAAF,OACTuE,EAAQ1V,IAAI,SAAW0V,EAAQ1V,IAAI,OAAS,WADnC,sB,GAzFqB8Q,GAiGvB,YAACmB,GAAiC,IACvCiwB,EAASjwB,EAATiwB,KAEFtyB,EAAiBsyB,EAAK4nD,IACpBv5E,EAAe2xB,EAAK6nD,IAApBx5E,WAER,OAAO,IAAIy4E,GAAwB,CACjCxkF,KAAM,sBACN+L,aACAX,oBCzGiBo6E,G,4MACnBxlF,KAAO,4B,sDAECyN,GACNA,EAAc6xD,aAAY,kBACxB7xD,EAAc+qC,UAAUitC,OAE1Bh4E,EAAcgyD,eACZ,kBACE,IAAIlzD,EAAW,CACbvM,KAAM,6BACNwM,QAAS,6BACTnB,aAAc8vE,GACdpvE,WAAYqvE,GACZhwE,eAAgBiwE,U,0CAd6Bj0C,I,8GCVxC,YAAA35B,GAAiB,IACtB+qC,EAAc/qC,EADQ,UAEtB1I,EAAayzC,EAFS,uBAGxB9sC,EAAQ8sC,EAAd,SACQz6B,EAAey6B,EAJO,iCAKtB1H,EAAoB0H,EALE,8CAMGA,EANH,4BAMtB7pC,EANsB,aAMV+iB,EANU,aAO4B8mB,EAP5B,sBAOtBktC,EAPsB,mBAOJC,EAPI,WAOM9vE,EAPN,oBAWxBnH,EAAYC,EAAW,CAC3Bi3E,WAAY,CACV7/D,SADU,SAEV24B,WAFU,IAGV2O,WAHU,IAIVw4B,cAAe,cAInB,oBAEE,GAAIlhF,EAAJ,eAA0C,CAACmhF,EAA3C,GAAoBC,EAApB,KAA+BD,EAA/B,KACA,IAAME,EAAUrhF,WAAhB,GACMshF,EAAQthF,WAAd,GACMuhF,EACJ/8E,SAAS28E,EAAT38E,GAAgCxE,EAAhCwE,YAAoDA,KAApDA,OADF,IAGA,MAAO,CAAC,KAAD,qCADP,KACO,qBAAP,KAaF,IAAMg9E,EAAkBphF,GAAS,YAAsB,IAAnBnJ,EAAmB,EAAnBA,MAAO+I,EAAY,EAAZA,MACnCiK,EAAQ8iB,IAER00D,EAD8BxqF,EAFiB,SAGrD,EACQyqF,EAAqC1hF,EAJQ,WAIjC2hF,EAAyB3hF,EAJQ,aAInBE,EAAWF,EAJQ,OAK/CqhF,EAAUN,EAAiBU,EAAjC,GACMH,EAAQP,EAAiBU,EAA/B,GACMvyE,GAAWwyE,EAAD,GAAhB,EACMH,EAAWG,IAA4Bl9E,KAA5Bk9E,OARoC,IAU/CE,GAAiBF,EAAD,GAAtB,EACMG,EAAoB,IAAH,OAAO/oC,OAC5B54C,UAD4B44C,QAAP,iBAAvB,KAGA,OACE,gCACE,mBACEj0C,KADF,EAEEkW,KAFF,EAGE+mE,WAHF,EAIEC,QAJF,EAKEN,SALF,EAME51E,MAAK,UAAKitC,OACR54C,UADQ44C,QAAL,iBANP,iBASExuC,MAAOL,eAAmBiV,UAE5B,wBACEpD,EAAG,CAAC,KAAD,+DADL,KAYE4tC,OAAQz/C,eAZV,UAaEszE,YAbF,EAcEyE,gBAdF,MAeEroF,KAAK,aAMPsoF,EAAa7hF,GACjB,YAAiE,IAA9D2a,EAA8D,EAA9DA,KAAMlW,EAAwD,EAAxDA,KAAMi9E,EAAkD,EAAlDA,WAAYC,EAAsC,EAAtCA,QAASN,EAA6B,EAA7BA,SAAU51E,EAAmB,EAAnBA,MAAOvB,EAAY,EAAZA,MAC7CqB,EAAU5B,IACVm4E,EAASnB,EAAiBU,EAAD,EAA/B,GACA,SAEI58E,aAAJ,EAGI,wBACEnJ,EADF,EAEE+jC,EAFF,EAGEtzB,UAAWR,EAHb,WAIEw2E,WAJF,SAKEC,iBALF,WAMEz+D,UAAS,0CAAiCq9D,KAAjC,GANX,KAOEj1E,MAAO,CAAEpS,KAAM2Q,IAPjB,EAUE,6BAAQuB,GAXZ,IAeEi2E,EAAJ,EAE0Bd,EACtBe,EAAUhnE,EAAVgnE,cAA+Bv9E,QADjC,IAGA,IAEI,wBACE9I,EADF,EAEE+jC,EAFF,EAGEtzB,UAAWR,EAHb,WAIEw2E,WAJF,QAKEC,iBALF,SAMEz+D,UAAS,0CAAiCq9D,EAAjC,GANX,KAOEj1E,MAAO,CAAEpS,KAAM2Q,IAPjB,EAUE,6BAAQuB,GAXZ,IAgBA,wBACEnQ,EADF,EAEE+jC,EAFF,EAGEtzB,UAAWR,EAHb,WAIEw2E,WAJF,MAKEC,iBALF,SAMEz+D,UAAS,0CACPq9D,KADO,IANX,KASEj1E,MAAO,CAAEpS,KAAM2Q,IATjB,EAYE,6BAAQuB,GAbZ,IAmBF,KA3DkB,QA+DhBw2E,EAAiBjiF,GAAS,YAAsB,IAOpD,EAPiCnJ,EAAmB,EAAnBA,MAAO+I,EAAY,EAAZA,MAClCiK,EAAQ8iB,IACN00D,EAAaxqF,EAF+B,SAG5CiJ,EAAqCF,EAHO,OAGpC0hF,EAA6B1hF,EAHO,WAGxB2hF,EAAiB3hF,EAHO,aAI9C4hF,GAAiBF,EAAD,GAAtB,EACMxyE,GAAWwyE,EAAD,GAAhB,EAGMpjC,EAFUllC,EAAhB,GAEiBmB,oBAA4Bva,SAA7C,cAIA,GAHA,IACEsK,EAAQg0C,kBAAyBp+C,EAAjCoK,UAEF,EACE,IACEA,EAAQ6hC,EAAgB7hC,EAAOL,qBAA/BK,OACA,MAAOrO,GACPqO,EAAQL,eAARK,aAGFA,EAAQL,eAARK,QAIF,OACE,gCACE,mBACEzF,KAAM3E,EADR,QAEE6a,KAFF,EAGE+mE,WAHF,EAIEC,QAJF,EAKEN,SALF,EAMEn3E,MAAOA,IAET,wBACEwR,EAAGwmE,EAAatiF,EAAOyhF,EAAR,EAAsBvhF,EAAtB,MAAoCA,EADrD,KAEEwpD,OAFF,EAGE6zB,YAHF,EAIE5jF,KAAK,QAEL,6BAAQuG,EAhBd,cAyCF,OAnBcE,GAAS,SAAe,GAAkB,IAAhBnJ,EAAgB,EAAhBA,MAAO+I,EAAS,EAATA,MAC7C,OAAIA,SAAJ,OAEI,mBACE4M,IAAKsE,EAAkBlR,iBADzB,IAEE/I,MAFF,EAGE+I,MAAOA,IAKX,mBACE4M,IAAKsE,EAAkBlR,EADzB,QAEE/I,MAFF,EAGE+I,MAAOA,QC5MA,YAAA8I,GAAiB,IACtB+qC,EAAc/qC,EADQ,YAEE+qC,EAFF,cAEtBzzC,EAFsB,WAGtBP,GAHsB,YAGNg0C,EAHM,gCAIxB9sC,EAAQ8sC,EAAd,SACQrvB,EAAaqvB,EALS,kBAQxB0uC,EAAS1uC,EAAf,4BACM2uC,EAAY3uC,EAAlB,+BACM4uC,EAAO5uC,EAAb,0BACMkqC,EAAalqC,EAAnB,gCACM6uC,EAAW7uC,EAAjB,8BACM8uC,EAAY9uC,EAAlB,+BACQ7pC,EAAe6pC,EAdO,uCAetBnpC,EAASmpC,EAfa,iCAiBtB1vB,EAAiB0vB,EAjBK,mCAkBYA,EAlBZ,sBAkBtB3iC,EAlBsB,oBAkBHkI,EAlBG,aAmBxBwpE,EAAQ/uC,EAAd,IAEM9pC,EAAYC,GAAW,SAAAC,GAC3B,MAAO,CACL6X,KAAM,CACJ5d,SADI,WAEJq7E,aAAct1E,UAFV,GAGJoB,SAHI,SAIJb,WAAY,SAEdq4E,SAAU,CACRx3E,SAAU,QAEZy3E,UAAW,CACTt4E,WADS,OAGTgB,UAHS,cAITlE,QAAS,SAEXmmD,WAAY,CACVtjD,QADU,MAEVmW,OAAQ,eAEVusC,SAAU,CACRxhD,SADQ,SAERygB,WAFQ,SAGR5nB,SAHQ,WAIRsG,WAAYE,EAJJ,KAKRc,UALQ,aAMRu3E,YANQ,oBAOR/3E,aAPQ,oBAQRsc,KARQ,EASRrB,IAAK,GAEP4sC,oBAAqB,CACnB0sB,aAAct1E,kBAKd+4E,EAAS5iF,GAAS,YAAe,IAAZnJ,EAAY,EAAZA,MACzB,OACE,gCACE,gCACGA,EAAA,kBAAuB,SAAA+I,GACtB,OACE,mBACE4M,IAAKsE,EACHlR,gBAAsBA,iBAAtBA,GAAgDA,EAFpD,QAIE/I,MAJF,EAKE+I,MAAOA,QAKf,gCACG/I,EAAA,YAAiB,SAAAye,GAChB,IAAMpO,EAAUoO,WAAhB,GACA,OACE,gBAACpO,EAAD,oBACEsF,IAAKtF,EADP,GAEEA,QAFF,EAGEyT,KAAM9jB,YASdy0D,EAAWtrD,GAAS,YAA8B,IAA3BnJ,EAA2B,EAA3BA,MAAOgsF,EAAoB,EAApBA,cAC5Bt3E,EAAU5B,IAChB,OACE,uBAAKoC,UAAWR,EAAQkhD,UACtB,mBACEhwC,QAAS5lB,EADX,cAEEkV,UAAWR,EAFb,WAGEE,MAAO5U,yCAHT,WAIEywB,UACGu7D,GAAiBhsF,EAAlB,cAAwCA,EAL5C,kBAOEqT,MAAM,aAEN,qBAVJ,OAaE,mBACEuS,QAAS5lB,EADX,aAEEkV,UAAWR,EAFb,WAGEE,MAHF,UAIE6b,UAAWu7D,GAAiBhsF,EAJ9B,aAKEqT,MAAM,aAEN,qBApBJ,OAuBE,mBACEuS,QAAS5lB,EADX,6BAEEkV,UAAWR,EAFb,WAGEE,MAHF,2BAIE6b,UAJF,EAKEpd,MAAM,aAEN,qBA9BJ,OAiCE,mBACEuS,QAAS5lB,EADX,sBAEEkV,UAAWR,EAFb,WAGEE,MAHF,mBAIE6b,UAJF,EAKEpd,MAAM,aAEN,qBAxCJ,OA2CE,mBACEuS,QAAS5lB,EADX,sBAEEkV,UAAWR,EAFb,WAGEE,MACE5U,kDAJJ,iCAQEywB,SAAUzwB,EARZ,eASEqT,MAAM,aAELrT,oBAA0B,qBAA1BA,MAA4C,qBAtDjD,OAyDGA,+BACC,mBACE4lB,QAAS5lB,EADX,sBAEE4U,MAFF,sBAGEub,cAHF,wBAIE9c,MAAM,aAEN,mBAjER,WAwEIyoD,EAAa3yD,GAAS,YAAe,IAAZnJ,EAAY,EAAZA,MACvB0U,EAAU5B,IADyB,EAEaya,EAFb,sBAElCwuC,EAFkC,KAEbC,EAFa,OAGE75C,EAHF,GAGjC+D,EAHiC,gBAGlBu0B,EAHkB,oBAICltB,EAJD,uBAIlC0+D,EAJkC,KAInBC,EAJmB,KAKpChmE,EAAL,QACEgmE,8BAEF,IAAM7kC,EAAW5M,MAAoBv0B,EAArC,IACMrc,EACJw9C,GAAYA,EAAZA,QAA+Bz+C,EAAYy+C,EAA3CA,SADF,GAWA,OACE,gCACE,mBAAWnyC,UAAWR,EAAQknD,qBAC5B,mBAAM9hC,WAAN,EAAgB3mB,QAAhB,EAA4BkpD,QAA5B,SAA6CtiC,WAAW,UACtD,mBAAMC,MAAI,GACR,mBACEsiC,QADF,EAEE9pD,MACE0T,WAHJ,GAOEkQ,SApBZ,YACE4lC,EAAuBna,OAAO/zB,SAA9BkuC,SAoBU9O,WAAY++B,GARd,0BASEjnF,QATF,EAUEyrB,WAVF,EAWEpH,OAAO,UAENnD,EAAA,KAAkB,qBACjB,mBAAUvQ,IAAV,EAAqBnD,MAAOyJ,GADX,QAOvB,mBAAM+d,MAAI,GACR,mBACEvJ,WAAY5mB,GAAWA,EADzB,QAEE+b,QAhCZ,WACE5lB,0BAgCUmV,QAHF,YAIE9B,MAAM,WAELxJ,gBAhCb,wBA8HF,OAAOV,GArFP,YAAiC,IAATnJ,EAAS,EAATA,MAChB0U,EAAU5B,IACVm1C,IACFjoD,mBAAF,QAAmCA,EAAnC,aAAwDA,EAD1D,aAGMmsF,GAAkBlkC,IAAgBjoD,EAAxC,kBACMosF,EAAankC,IAAnB,EAEA,OACE,uBACE/yC,UAAWR,EADb,KAEEI,MAAO,CACLgE,MAAO9Y,EADF,MAEL8sB,OAAQ9sB,EAAM8sB,QAEhBqD,cAAanwB,EAAMF,IAElBE,QACC,qBAAG8U,MAAO,CAAEzB,MAAO,QAAUrT,QAD9BA,SAGC,gCACGmsF,EAAiB,mBAAYnsF,MAAOA,IADvC,KAEE,gCACIosF,EACA,uBACEl3E,UAAWR,EADb,SAEEI,MAAO,CACLgE,MAAO9Y,EADF,MAEL8sB,OAAQ9sB,EAAM8sB,SAGhB,uBACE5X,UAAWR,EADb,QAEEI,MAAO,CACL4X,UAAW,CAAC,UAAD,OAAW1sB,EAAX,4BADN,KAILi2D,WAJK,iBAKLpiC,gBAAiB7zB,EAAA,cACV,SAAAyE,GAAC,2BADS,YAKnB,uBACEqQ,MAAO,CACL7H,SADK,WAELojB,KAFK,EAGLrB,IAAK,GAEP9Z,UAAWR,EANb,UAOEoE,MAAK,UAAK9Y,EAAL,YAPP,MAQE8sB,OAAM,UAAK9sB,EAAL,aARR,MASE0/C,QAAQ,OAER,qBAAGhzB,UAAS,oBAAe1sB,EAAf,eACV,mBAAQA,MAAOA,QAhCV,KAsCf,mBAAUA,MAAV,EAAwBgsF,cAAeI,IACtCpsF,gCACC,mBACEmtB,OAAQntB,EADV,aAEE8U,MAAO,CACLgY,OAtSpB,EAuSoB7f,SAFK,WAGLo/E,OAHK,EAILh8D,KAJK,EAKL9c,WALK,OAMLgB,UANK,aAOL4lD,UAAW,8BCrT/B,SAASmyB,GACP9jD,EACA+jD,EACAC,EACA/oF,EACAgpF,GAEA,IAAM5nE,EAAItX,KAAKsgD,IAAIrlB,EAAIgkD,GACvB,KAAI3nE,EAAIphB,GAAR,CACIohB,IAAMphB,GACRgpF,EAAYn8E,KAAK,CAACi8E,EAAI/jD,IAExB,IAAMkkD,EAAWn/E,KAAKm3D,KAAKjhE,EAAIA,EAAIohB,EAAIA,GACvC4nE,EAAYn8E,KAAK,CAACi8E,EAAKG,EAAUlkD,IACjCikD,EAAYn8E,KAAK,CAACi8E,EAAKG,EAAUlkD,KAGnC,SAASmkD,GACPloF,EACA8nF,EACAC,EACA/oF,EACAgpF,GAEA,IAAM5nE,EAAItX,KAAKsgD,IAAIppD,EAAI8nF,GACvB,KAAI1nE,EAAIphB,GAAR,CACIohB,IAAMphB,GACRgpF,EAAYn8E,KAAK,CAAC7L,EAAG+nF,IAEvB,IAAME,EAAWn/E,KAAKm3D,KAAKjhE,EAAIA,EAAIohB,EAAIA,GACvC4nE,EAAYn8E,KAAK,CAAC7L,EAAG+nF,EAAKE,IAC1BD,EAAYn8E,KAAK,CAAC7L,EAAG+nF,EAAKE,KAYrB,SAASE,GAAiBnoF,EAAW+jC,GAC1C,IAAMqkD,EAAMt/E,KAAKm3D,KAAKjgE,EAAIA,EAAI+jC,EAAIA,GAClC,OAAY,IAARqkD,EAAkB,CAAC,EAAG,GAEnB,CAACA,EAbV,SAA0BpoF,EAAW+jC,GACnC,IAAIskD,GAASv/E,KAAKw/E,KAAKvkD,EAAI/jC,GAAK,EAAI8I,KAAKy/E,KAAO,EAAIz/E,KAAKy/E,IAKzD,OAJIvoF,EAAI,IACF+jC,GAAK,EAAGskD,GAASv/E,KAAKy/E,GACrBF,GAASv/E,KAAKy/E,IAEdF,EAMOG,CAAiBxoF,EAAG+jC,IAIpC,IAAM0kD,GAAQ,EAAI3/E,KAAKy/E,GC1ChB,IAAMG,GAAb,WAiBE,WACErpE,EACA7a,EACAmkF,EACAC,GACA,yBArBF13E,SAqBE,OAnBF1M,YAmBE,OAjBFqkF,mBAiBE,OAfF5C,kBAeE,OAbFD,gBAaE,OAXF8C,iBAWE,OATFF,iBASE,OAPFG,aAOE,MACQD,EAAgBzpE,EAAhBypE,YACR1kF,KAAK8M,IAAMsE,6BAAkBhR,GAC7BJ,KAAKI,OAASA,EACdJ,KAAKykF,cAAgBF,EACrBvkF,KAAK0kF,YAAcA,EACnB1kF,KAAKwkF,YAAcA,EACnBxkF,KAAK2kF,SAAU,EAEf3kF,KAAK6hF,aAAe7hF,KAAKykF,cACzBzkF,KAAK4hF,WAAaxhF,EAAOwkF,QAAU5kF,KAAK0kF,YAAc1kF,KAAKykF,cAC3DxrF,OAAO4rF,OAAO7kF,MAjClB,mDAoCSyT,EAAYkuE,GACjB,IAQMmD,GAPF9kF,KAAKI,OAAO2kF,OACH/kF,KAAKI,OAAOwkF,QAAU,EACxB5kF,KAAK2kF,QACH3kF,KAAKI,OAAO1J,IAAM+c,EAElBA,EAAKzT,KAAKI,OAAO5J,OAEEwJ,KAAK0kF,YAAc1kF,KAAKykF,cACxD,OAAOxD,4BAAiBU,EAAUmD,KA9CtC,+BAkDI,OAAOrkD,6BAAkBxnC,OAAOiE,QAAQ8C,WAlD5C,KAoEA,SAASglF,GAAeztF,EAAW2I,GAAc,IDxB/C+kF,EACAC,EACAC,EACAC,ECqB+C,cAI3C7tF,EAAK8tF,eADPpB,MAH6C,GAGrCqB,EAHqC,KAGpBC,EAHoB,KAM/C,OD9BAN,EC+BE/kF,EAAMukF,cAAgBltF,EAAKktF,cD9B7BS,EC+BEhlF,EAAMskF,YD9BRW,EC+BEG,ED9BFF,EC+BEG,EAAkBD,ID7BhBJ,GAAY,GAAKE,GAAY,KAC7BF,EAAW,MAAUb,IAASe,EAAW,MAAUf,KAGvDY,GAAaA,EAAUZ,GAASA,IAASA,GAASA,KAClDc,GAAaA,EAAUd,GAASA,IAASA,GAASA,IAE1Be,GAAYH,EAAUC,EAAWC,GAIrDF,GADJE,GAAWd,IACae,GAAYH,EAAUC,EAAWC,GAIlDF,GADPE,GAAWd,GAAQA,IACQe,GAAYH,EAAUC,EAAWC,GEjE/C,SAASK,GAAax8E,GAA8B,IACzD6qC,EAAQ7qC,EAAR6qC,IACA53B,EAAgB43B,EAAI5G,KAApBhxB,YAFyD,EAGF43B,EAC7D,mBADMj+C,EAHyD,EAGzDA,MAAOqgB,EAHkD,EAGlDA,UAAW0F,EAHuC,EAGvCA,kBAAmBC,EAHoB,EAGpBA,QAASnJ,EAHW,EAGXA,KAG9Cvc,EAAW29C,EAAI,gCAAf39C,OACAsP,EAAmBquC,EAAI,+BAAvBruC,eAPyD,EAQRquC,EACvD,sBADMt/B,EARyD,EAQzDA,MAAO+E,EARkD,EAQlDA,WAAY0nC,EARsC,EAQtCA,0BAGnBzrC,EAAkBs+B,EAAI,8CAAtBt+B,cAKFpe,EAAQvB,EACXuB,MAAM,eAAgB,CACrB2P,KAAMlR,EAAMqkB,QAAQ,gBACpBwqE,eAAgB//E,KAAKy/E,GAAK,EAC1Bp+E,QAAS,IACTmP,OAAQtf,EAAMwc,MACZpJ,EAAcoR,iBAAiB,QAAS,eAG1CqrE,0BAA0B,EAC1BC,yBAAyB,EACzBC,mBAAmB,EACnBC,mBAAmB,EAEnB3hE,OAAQruB,EAAMC,SACZD,EAAMgpD,WAAW,cAAehpD,EAAMa,QAAQ,SAAAid,GAAC,OAAIA,GAlBvC,MAEI,KAmBlBmyE,gBAAiB,GACjBC,UAAW,GACXC,UAAW,GACXC,gBAAiB,IACjBC,gBAAiB,EACjB/1E,kBAAmB,GACnBF,iBAAkBpa,EAAMwc,MAAMlc,GAC9BgwF,QAAS,EACTC,QAAS,EACTpxB,kBAAmB,iBAEpB1iD,UAAS,iBAAO,CACfpC,MAAO,QAER2C,OAAM,SAAArb,GAAI,MAAK,CACd,mBACE,ODMR,SAA+BA,GAC7B,IADwC,EAClC6uF,EAAS,GACX7B,EAAsB,EAFc,eAGnBhtF,EAAK8uF,eAHc,IAGxC,2BAAyC,KAA9BjmF,EAA8B,QACjCokF,EACJpkF,EAAOwkF,QAAUrtF,EAAKmtF,YAAcntF,EAAKuuF,UAAYvuF,EAAK+uF,YAC5DF,EAAO3+E,KAAK,IAAI68E,GAAM/sF,EAAM6I,EAAQmkF,EAAqBC,IACzDD,GAAuBC,GAPe,8BASxC,OAAO4B,ECfMG,CAAsBhvF,IAE/B,0BACE,OAAOyI,KAAKwmF,aAAa14E,OAAOk3E,GAAe7hF,KAAKnD,KAAMzI,KAE5D,qBACE,OFaD,SACLkvF,EACAC,EACAC,GACA,kBACmCF,EADnC,GACKG,EADL,KACYC,EADZ,KACmBC,EADnB,KAC0BC,EAD1B,mBAEiBL,EAFjB,GAEOhD,EAFP,KAEWC,EAFX,KAaA,GAPAkD,GAASnD,EACToD,GAASnD,EACToD,GAASpD,GAHTiD,GAASlD,GAMC,GAAKmD,EAAQ,GAAKC,EAAQ,GAAKC,EAAQ,EAErB,CAQ1B,IAPA,IAAMC,EAAW,CACf,CAACJ,EAAOE,GACR,CAACD,EAAOC,GACR,CAACF,EAAOG,GACR,CAACF,EAAOE,IAENE,GAAU5iF,IACLxJ,EAAI,EAAGA,EAAImsF,EAAS/rF,OAAQJ,GAAK,EAAG,mBAC5BmsF,EAASnsF,GADmB,GACpCe,EADoC,KACjC+jC,EADiC,KAErCqkD,EAAMt/E,KAAKm3D,KAAKjgE,EAAIA,EAAI+jC,EAAIA,GAC9BqkD,EAAMiD,IAAQA,EAASjD,GAE7B,MAAO,CACLA,IAAK,CAAC,EAAGt/E,KAAKC,IAAIgiF,EAAcM,IAChChD,MAAO,CAAC,EAAG,EAAIv/E,KAAKy/E,KAsExB,IAAM6C,EAA+B,CACnC,CAACJ,EAAOE,GACR,CAACD,EAAOC,GACR,CAACF,EAAOG,GACR,CAACF,EAAOE,IAEVjD,GAAwB8C,EAAO,EAAG,EAAGD,EAAcK,GACnDlD,GAAwB+C,EAAO,EAAG,EAAGF,EAAcK,GACnDvD,GAAwBqD,EAAO,EAAG,EAAGH,EAAcK,GACnDvD,GAAwBsD,EAAO,EAAG,EAAGJ,EAAcK,IAG9CJ,EAAQD,GACXK,EAASv/E,KAAK,CAACm/E,EAAO,IAEpBC,EAAQF,GACVK,EAASv/E,KAAK,CAACo/E,EAAO,KAEnBC,EAAQH,GACXK,EAASv/E,KAAK,CAAC,EAAGq/E,IAEhBC,EAAQJ,GACVK,EAASv/E,KAAK,CAAC,EAAGs/E,IAgBpB,IARA,IAAMG,EAAUN,GAAS,GAAK,EAAI,EAI9BO,EAAS9iF,IACT+iF,GAAU/iF,IACVgjF,EAAWhjF,IACXijF,GAAYjjF,IACPxJ,EAAI,EAAGA,EAAImsF,EAAS/rF,OAAQJ,GAAK,EAAG,mBAE1BmsF,EAASnsF,GAFiB,GAEpC0sF,EAFoC,KAEhCC,EAFgC,KAG3C,GAAID,GAAMX,GAASW,GAAMV,GAASW,GAAMV,GAASU,GAAMT,EAAO,OACvChD,GAAiBwD,EAAKL,EAASM,EAAKN,GADG,mBACrDlD,EADqD,KAChDC,EADgD,KAGxDD,GAAO2C,EAAe,OAEpB1C,EAAQoD,GAAYrD,EAAM,OAAQqD,EAAWpD,GAC7CA,EAAQqD,GAAYtD,EAAM,OAAQsD,EAAWrD,GAC7CD,EAAMmD,IAAQA,EAASnD,GACvBA,EAAMoD,IAAQA,EAASpD,KAejC,OAViB,IAAbkD,IACFG,GAAY3iF,KAAKy/E,GACjBmD,GAAY5iF,KAAKy/E,IAGfkD,EAAW,EAAI3iF,KAAKy/E,IAAMmD,EAAW,EAAI5iF,KAAKy/E,KAChDkD,GAAY,EAAI3iF,KAAKy/E,GACrBmD,GAAY,EAAI5iF,KAAKy/E,IAGhB,CACLH,IAAK,CAACmD,EAAQziF,KAAKC,IAAIgiF,EAAcS,IACrCnD,MAAO,CAACoD,EAAUC,IErLPG,CACL,CACElwF,EAAK2uF,QACL3uF,EAAK2uF,QAAU3uF,EAAK0Y,MACpB1Y,EAAK4uF,QACL5uF,EAAK4uF,QAAU5uF,EAAK0sB,QAEtBjkB,KAAK0nF,SACL1nF,KAAK2hF,WAGT,sBACE,IADoB,EAChBgG,EAAW,EADK,eAEJ3nF,KAAKqmF,eAFD,IAEpB,2BAAoC,CAClCsB,GADkC,QACpB/C,SAHI,8BAKpB,OACE+C,EAAWpwF,EAAKwO,QAAUxO,EAAKuuF,UAAY9lF,KAAKqmF,cAAcprF,QAGlE,eACE,OAAO+E,KAAK4nF,iBAAmB,EAAIljF,KAAKy/E,KAE1C,kBACE,OAAO5sF,EAAKwO,QAAU/F,KAAK2hF,UAE7B,kBACE,OAAO3hF,KAAK2hF,UAEd,eACE,MAAO,CAAC3hF,KAAK2hF,SAAWpqF,EAAKwuF,UAAW/lF,KAAK2hF,SAAWpqF,EAAKwuF,YAE/D,cACE,IADY,EACRvW,EAAQ,EADA,eAESj4E,EAAKyY,kBAFd,IAEZ,2BAA4C,KAAjC5P,EAAiC,QAC1CovE,GAASpvE,EAAO1J,IAAM0J,EAAO5J,OAHnB,8BAKZ,OAAOg5E,GAET,sBACE,OAAOj4E,EAAKouF,kBACRjhF,KAAKC,IAAIpN,EAAK0Y,MAAO1Y,EAAK0sB,QAAU,EAAI1sB,EAAKyuF,gBAC7C,KAEN,iBACE,IAAM6B,EAAqB,EAAInjF,KAAKy/E,GAAK5sF,EAAKsuF,gBAC9C,OAAO7lF,KAAK6S,QAAUg1E,GAExB,iBAEE,IAAMC,EAAqB,EAAIpjF,KAAKy/E,GAAKnkF,KAAK+nF,gBAC9C,OAAOxzE,EACLvU,KAAK6S,QAAUi1E,EACf,MACA9nF,KAAK+qD,aAGT,mBACE,OAAOxzD,EAAKwO,SAAW/F,KAAK+qD,YAE9B,mBACE,OAAOxzD,EAAKwO,SAAW/F,KAAKgrD,YAE9B,qBACE,OAAOhrD,KAAKgrD,YAAc,OAE5B,uBACE,MAAO,CACW,EAAhBhrD,KAAK2hF,SAAe,EAAIpqF,EAAKwuF,UACb,EAAhB/lF,KAAK2hF,SAAe,EAAIpqF,EAAKwuF,YAGjC,kBACE,OAAO/lF,KAAKgoF,iBAAiB,IAE/B,mBACE,OAAOhoF,KAAKgoF,iBAAiB,IAI/B,oBAEE,IAAMC,EAAiB,GACvB1wF,EAAKyY,iBAAiB5J,SAAQ,SAAAhG,GAC5B,IAAMwkF,EAAUxkF,EAAO1J,IAAM0J,EAAO5J,MAEpC,GADgBouF,EAAUrtF,EAAKwO,QACjBxO,EAAK0uF,gBAAiB,CAElC,IAAMiC,EAAcD,EAAQA,EAAQhtF,OAAS,GACzCitF,GAAeA,EAAYnD,QAC7BmD,EAAYlnF,QAAQyG,KAApB,eAA8BrH,IAC9B8nF,EAAYtD,SAAWA,GAEvBqD,EAAQxgF,KAAK,CACXs9E,QAAQ,EACRH,UACA5jF,QAAS,CAAC,eAAKZ,WAKnB6nF,EAAQxgF,KAAR,2BAAkBrH,GAAlB,IAA0BwkF,gBAK9B,IAAK,IAAI/pF,EAAI,EAAGA,EAAIotF,EAAQhtF,OAAQJ,GAAK,EAAG,CAC1C,IAAMZ,EAAIguF,EAAQptF,GACdZ,EAAE8qF,QAA+B,IAArB9qF,EAAE+G,QAAQ/F,gBACjBhB,EAAE8qF,OACTkD,EAAQptF,GAAR,2BAAkBZ,GAAMA,EAAE+G,QAAQ,KAGtC,OAAOinF,GAGT,oBACE,IAAM5qE,EAA0B,GAKhC,OAJA9lB,EAAKyY,iBAAiB5J,SAAQ,SAAAyxD,GACvBx6C,EAAc/b,SAASu2D,EAAgBlgE,eAC1C0lB,EAAc5V,KAAKowD,EAAgBlgE,iBAEhC0lB,OAGVhL,UAAS,iBAAO,CACflW,WAAOpC,MAERzC,SAAQ,SAAAC,GAAI,MAAK,CAEhBke,SAFgB,SAEPC,GAEP,OADAne,EAAK0Y,MAAQvL,KAAKuM,IAAIyE,EA7KX,KA8KJne,EAAK0Y,OAEdwwC,UANgB,SAMN0nC,GAER,OADA5wF,EAAK0sB,OAASvf,KAAKuM,IAAIk3E,EAlLX,IAmLL5wF,EAAK0sB,QAEdy8B,aAVgB,SAUH/rC,GACX,IAAMgsC,EAAYppD,EAAK0sB,OACjBkkE,EAAYnoF,KAAKygD,UAAUlpD,EAAK0sB,OAAStP,GAE/C,OADA3U,KAAKooF,wBAAwB7wF,EAAK8wF,gBAC3BF,EAAYxnC,GAErB2nC,YAhBgB,SAgBJ3zE,GACV,IAAM4zE,EAAWhxF,EAAK0Y,MAChByF,EAAW1V,KAAKyV,SAASle,EAAK0Y,MAAQ0E,GAE5C,OADA3U,KAAKooF,wBAAwB7wF,EAAK8wF,gBAC3B3yE,EAAW6yE,GAEpBC,sBAtBgB,WAuBdxoF,KAAKyoF,gBAAgB/jF,KAAKy/E,GAAK,IAGjCuE,6BA1BgB,WA2Bd1oF,KAAK2oF,uBAAuBjkF,KAAKy/E,GAAK,IAGxCsE,gBA9BgB,WA8BiB,IAAjB9zE,EAAiB,uDAAN,IACzBpd,EAAKktF,eAAiB9vE,GAGxBg0E,uBAlCgB,WAkCwB,IAAjBh0E,EAAiB,uDAAN,IAChCpd,EAAKktF,eAAiB9vE,GAGxBi0E,aAtCgB,WAuCd5oF,KAAK0S,WAAWnb,EAAKwO,QAAU,MAGjC8iF,cA1CgB,WA2Cd7oF,KAAK0S,WAA0B,IAAfnb,EAAKwO,UAGvB2M,WA9CgB,SA8CLo2E,GACTvxF,EAAKwO,QAAUwO,EAAMu0E,EAAQvxF,EAAKyzD,WAAYzzD,EAAKwzD,aAGrDq9B,uBAlDgB,SAkDOW,GACjBxxF,EAAKouF,mBAAqBoD,GAC5B/oF,KAAK0S,WAAWnb,EAAKyzD,aAIzB+L,UAxDgB,WAyDd9gD,EAAU1e,EAAM,GAAG0/D,WAAW1/D,IAGhCib,oBA5DgB,SA4DIxR,GAClB,IAAMgoF,EAAmD,IAAjCzxF,EAAKyY,iBAAiB/U,OAC9C1D,EAAKyY,iBAAmByC,EAAKzR,GAEzBgoF,EAAiBhpF,KAAK0S,WAAWnb,EAAKyzD,YACrChrD,KAAK0S,WAAWnb,EAAKwO,UAG5B8lD,sBApEgB,WAqEd,GAA+B,iBAA3Bt0D,EAAKw9D,kBAAsC,CAC7C,IAAMt6C,EAAUnB,EAAW/hB,GAC3B,GAAIypD,EAA0BvmC,GAAU,CACtC,IAAM68C,EAAW78C,EAAQymC,UACvB,kCACA,4BACA,CAAEjmC,KAAM1jB,IAGV,OADAkjB,EAAQ0mC,WAAWmW,GACZA,GAGX,MAAM,IAAIr6D,MAAJ,sCAAyC1F,EAAKw9D,qBAGtDmC,YApFgB,SAoFJh+C,GAEUlZ,KAAKob,UAAUlC,IAGjClZ,KAAKqb,UAAUnC,IAInBW,SA7FgB,SA6FP1d,GACP5E,EAAK4E,MAAQA,GAGfkf,UAjGgB,SAiGNnC,GAAuC,IAAtBsC,EAAsB,uDAAJ,GACrCg7C,EAAoBxtD,EAAc0S,0BACtC,SAEI5F,EAAgB6F,EACpB66C,EACA56C,EAAQrkB,GACR2hB,GAEIvR,EAAYqB,EAAc0U,aAAa5H,EAAchP,MAC3D,IAAKa,EACH,MAAM,IAAI1K,MAAJ,6BAAgC6Y,EAAchP,OAEtD,IAAMc,EAAWoB,EAAc2T,YAAYplB,EAAKuP,MAC1C2vD,EAAoB7uD,EAASL,aAAapG,KAC9C,SAAA0a,GAAW,OAAIA,EAAYtgB,QAEvBshB,EAAc/G,EAAcqE,SAASnc,MACzC,SAACge,GAAD,OAA8By6C,EAAkBn1D,SAAS0a,EAAElV,SAEvD8O,EAAQjO,EAAUL,WAAW3F,OAArB,2BACT6Z,GADS,IAEZ1U,KAAMgP,EAAchP,KACpBgP,gBACAqE,SAAU,CAAC,CAAErT,KAAM+V,EAAY/V,KAAMgP,cAAe+G,OAEtDtlB,EAAK2d,OAAOzN,KAAKmO,IAGnBR,aA9HgB,SA8HHU,GAA4D,IAAtB0F,EAAsB,uDAAJ,GAC3D1U,EAASgP,EAAThP,KACFvL,EAAOiK,EAAesQ,EAAe,QACrCnO,EAAYqB,EAAc0U,aAAa5W,GAC7C,IAAKa,EACH,MAAM,IAAI1K,MAAJ,6BAAgC6Y,EAAchP,OAEtD,IAAMc,EAAWoB,EAAc2T,YAAYplB,EAAKuP,MAC1C2vD,EAAoB7uD,EAASL,aAAapG,KAC9C,SAAA0a,GAAW,OAAIA,EAAYtgB,QAEvBshB,EAAc/G,EAAcqE,SAASnc,MACzC,SAACge,GAAD,OAA8By6C,EAAkBn1D,SAAS0a,EAAElV,SAEvD8O,EAAQjO,EAAUL,WAAW3F,OAArB,2BACT6Z,GADS,IAEZjgB,OACAuL,OACAgP,gBACAqE,SAAU,CAAC,CAAErT,KAAM+V,EAAY/V,KAAMgP,cAAe+G,OAEtDtlB,EAAK2d,OAAOzN,KAAKmO,IAGnBwF,UAtJgB,SAsJNlC,GACR,IAAMs9C,EAAoBxtD,EAAc0S,0BACtC,SAEI5F,EAAgB6F,EACpB66C,EACA56C,EAAQrkB,GACR2hB,GAGIw9C,EAAcn/D,EAAK2d,OAAOpH,QAC9B,SAAAuyB,GAAC,OAAIA,EAAEvqB,gBAAkBA,KAG3B,OADAmG,GAAY,kBAAMy6C,EAAYtwD,SAAQ,SAAAi6B,GAAC,OAAI9oC,EAAK2d,OAAOgH,OAAOmkB,SACvDq2B,EAAYz7D,QAGrBguF,sBAvKgB,WA2Kd,OAHA1xF,EAAKouF,mBAAqBpuF,EAAKouF,kBAE/B3lF,KAAKooF,uBAAuB7wF,EAAK2xF,cAC1B3xF,EAAKouF,uBAMlB,MAAO,CAAEr+E,WAFU1R,EAAM8B,QAAQ6d,EAAepe,IC1WnC,mBAAkC,IAA/B08C,EAA+B,EAA/BA,IAAK5a,EAA0B,EAA1BA,KACfpxB,EAAWgsC,EAAI,gDAEfltC,EAAiBsyB,EAAKkwD,IAG5B,OAAO,IAAIthF,EAAS,CAAEtM,KAAM,eAAgB+L,WAFrB2xB,EAAKmwD,IAApB9hF,WAEgDX,oBCR3C,YAACqC,GAAiC,IACvC6qC,EAAQ7qC,EAAR6qC,IACF5sC,EAAQ4sC,EAAI1G,MACVzoB,EAAwBzd,EAAxByd,SAAUK,EAAc9d,EAAd8d,UACV7a,EAAe2pC,EAAI,4BAAnB3pC,WACA5J,EAAauzC,EAAI,cAAjBvzC,SAEF2J,EAAYC,GAAW,SAAAC,GAG3B,MAAO,CACLrH,KAAM,CACJo/E,gBAAiB,IACjBmH,iBAAkB,GAClB3sC,UAAW,SAAF,OALI,IAKJ,2CACP4Q,IADO,2BAIX,oBAAqB,CACnB,KAAM,CACJ1D,OAAQz/C,EAAMQ,QAAQyU,QAAQyP,OAEhC,MAAO,CACL+6B,OAAQz/C,EAAMQ,QAAQ2U,UAAUuP,OAElC,MAAO,CACL+6B,OAAQz/C,EAAMQ,QAAQ4U,SAASsP,OAEjC,MAAO,CACL+6B,OAAQz/C,EAAMQ,QAAQ8U,WAAWoP,OAEnC,OAAQ,CACN+6B,OAAQz/C,EAAMQ,QAAQyU,QAAQyP,QAGlC,kBAAmB,CACjB,KAAM,CACJw6D,iBA7BS,GA+BX,MAAO,CACLA,iBAAkBllF,GAClB0f,UAAW,kBAEb,OAAQ,CACNwlE,iBApCS,EAqCTxlE,UAAW,uBAoEnB,OA7DgBvjB,GACd,YAMM,IAJagpF,EAIb,EALJnyF,MACEuf,YAAe4yE,OAKXz9E,EAAU5B,IADZ,EAIsBya,GAAS,GAJ/B,mBAIGsV,EAJH,KAIUC,EAJV,KAUJ,OALAlV,GAAU,WACR,IAAMgV,EAAUhR,YAAW,kBAAMkR,GAAS,KAAO,KACjD,OAAO,kBAAMjR,aAAa+Q,OAGpBC,EACN,yBACE,4BACE,2BACE/iC,GAAG,gBACHgZ,MAAM,KACNgU,OAAO,KACPslE,iBAAiB,iBACjBC,aAAa,kBAEb,wBACExsD,GAAG,IACHE,GAAG,IACHD,GAAG,IACHE,GAAG,KACHlxB,MAAO,CAAE29C,OAAQ,wBAAyB6zB,YAAa,QAI7D,0BAAQiG,GAAG,IAAIC,GAAG,IAAI/oF,EAAG0uF,EAAQzvF,KAAK,YACtC,0BAAQ6pF,GAAG,IAAIC,GAAG,IAAI/oF,EAAG0uF,EAAQzvF,KAAK,wBACtC,wBACE+B,EAAE,IACF+jC,EAAE,IACF9b,UAAU,iBACVy+D,iBAAiB,SACjBD,WAAW,UALb,iBASA,0BACEh2E,UAAWR,EAAQ/I,KACnBjJ,KAAK,OACL4jF,YAAY,IACZgM,cAAc,QACd/F,GAAG,IACHC,GAAG,IACH/oF,EAAE,QArCQ,SCvEP,eAAmB,IAAhBm5C,EAAgB,EAAhBA,UACV9sC,EAAQ8sC,EAAd,SACQ7pC,EAAe6pC,EAFS,uCAGxBzzC,EAAayzC,EAHW,uBAK1B9pC,EAAYC,EAAW,CAC3BgzC,aAD2B,GAE3BwsC,gBAF2B,GAG3BC,UAAW,KA4Db,OAxDqBrpF,GACnB,YAKM,QAJJnJ,MACiBmyF,EAGb,EAHF5yE,YAAe4yE,OACfntF,EAEE,EAFFA,MAGI0P,EAAU5B,IAChB,OACE,qBAAGoC,UAAWR,EAAQqxC,cACpB,4BACE,2BACEjmD,GADF,gBAEEgZ,MAFF,KAGEgU,OAHF,KAIEslE,iBAJF,iBAKEC,aAAa,kBAEb,wBACExsD,GADF,IAEEE,GAFF,IAGED,GAHF,IAIEE,GAJF,KAKElxB,MAAO,CAAE29C,OAAF,oBAA+B6zB,YAAa,QAIzD,0BACEpxE,UAAWR,EADb,gBAEE63E,GAFF,IAGEC,GAHF,IAIE/oF,EAJF,EAKEf,KAAK,YAEP,0BACEwS,UAAWR,EADb,aAEE63E,GAFF,IAGEC,GAHF,IAIE/oF,EAJF,EAKEf,KAAK,wBAEP,wBACEwS,UAAWR,EADb,UAEEjQ,EAFF,IAGE+jC,EAHF,IAIE9b,UAJF,iBAKEy+D,iBALF,SAMED,WAAW,UAEVvjF,OAzCP,SCpBS,eAAmB,IAAhBi1C,EAAgB,EAAhBA,UACV9sC,EAAQ8sC,EAAd,SACQrkB,EAAYqkB,EAFY,2BAGxBhvB,EAAsB9d,EAHE,UAGb6d,EAAW7d,EAHE,SAIe8sC,EAJf,cAIxBzzC,EAJwB,0BAKYyzC,EALZ,cAKxBgI,EALwB,yBAKAG,EALA,UAmDhC,OAAO57C,GA5CP,YAAwC,IAATnJ,EAAS,EAATA,MACrB0I,EAAwD1I,EAD1B,KACxBuS,EAAkDvS,EAD1B,KAClBykD,EAA4CzkD,EAD1B,OACVuf,EAAoCvf,EAD1B,YACG2kD,EAAuB3kD,EAD1B,mBAGhCqkD,EAAmB12B,EAAzB,MACM22B,EAAW32B,GAAjB,GAiCA,OA/BAC,GAAU,WACR,IAAM22B,EAAUF,EAAhB,QACMG,EAAaF,EAAnB,QAEMC,GAAJ,IACMA,GAAWA,EAAXA,WAAJ,IACEA,uBACAM,qBAAoB,kBAAMD,EAAN,OAEtBL,yBACAA,YANqB,EAUrBM,qBAAoB,WAClB,GAAKtsB,EAAL,IACA,IAAMk6D,EAAsB3iF,mDAA5B,MAKA+0C,qBAAoB,WACbtsB,EAAL,IACAwsB,EAAQ0tC,EAAR1tC,cAQH,qBAAGn0B,IAAKyzB,QCvCJ,eAAkC,IAA/B3H,EAA+B,EAA/BA,IAAK5a,EAA0B,EAA1BA,KACfhyB,EAAQ4sC,EAAI1G,MAD6B,EAEA0G,EAAI,cAA3CvzC,EAFuC,EAEvCA,SAEFupF,GAJyC,EAE7B5zF,UAEFgjC,EAAK6wD,KACfC,EAAe9wD,EAAK+wD,IACpBC,EAAsBhxD,EAAKixD,IAWjC,OAAO5pF,GARP,YAA4C,IAAhBkH,EAAgB,EAAhBA,QAC1B,OAAIA,EAAQrL,MAAc,gBAAC4tF,EAAD,CAAc5yF,MAAOqQ,IAC1CA,EAAQo0C,OACN,gBAACquC,EAAD,CAAqB9yF,MAAOqQ,IADP,gBAACqiF,EAAD,CAAS1yF,MAAOqQ,QChBjC,eAAmB,IAAhBusC,EAAgB,EAAhBA,UACR79B,EAAoB69B,EADI,6CAExB74B,EAAsB64B,EAFE,wCAGxBz6B,EAAey6B,EAHS,6EA8BhC,6CAAAh7C,EAAA,iFAEU,IAAIkE,MAFd,yCAMI80C,EAIEhrC,EAVN,aAOIs0B,EAGEt0B,EAVN,WAQIu3C,EAEEv3C,EAVN,uBASI20B,EACE30B,EAVN,uDAaW,CAAEknB,QAASqwB,IAbtB,UAkBKv3C,cAAD,QACCA,aADD,SAECA,qBApBL,gDAsBW,CAAEknB,QAAS,oBAtBtB,UA0BO12B,2BA1BP,yBA2BU,IAAI0F,MAAM,YAAV,OACQ80C,EADR,KA3BV,sEA+BkCA,EAAA,mDAE9B1zC,YAjCJ,wBA+BUqL,EA/BV,OA+BmB7J,EA/BnB,2CAoCS,CAAE6J,KAAF,EAAQ7J,KAAR,EAAci8C,mBAAoB/J,EAAaprC,iBApCxD,6CA9BgC,sBAqEhC,MAAO,CAAEwjF,mBAhET,YAAkC,MAC1B3iF,EAAN,EACMyT,EAAOC,EAAb,GACQ62B,EAA8BvqC,EAHN,aAGVkP,EAAgBlP,EAHN,YAsBhC,MAhBU,CACRuqC,aADQ,EAER1W,WAJqB/hB,EAJS,cAS9B5C,YAHQ,EAIRglB,WAAY,CAEV/jC,aAAY,UAAEsjB,mBAAF,uBAAEA,EAFJ,aAGVT,cAAejN,WAAWA,eAAe/F,EAH/B,gBAIVuqC,aAAcA,EAJJ,KAKVr7B,YALU,EAMV1V,QAASuM,WAAWA,eAAe0N,EANzB,mBAOVk/B,iBAAkBl/B,EAPR,iBAQVsgB,UAAWrlB,EARD,GASV6jB,QATU,OAsDaqwD,qBArEG,kDCqBrBC,GAAwBz0F,QAClC8B,QACC,mBACA0hB,GACAxjB,QAAMuB,MAAM,CACVmzF,kBAAmB,GACnB3yF,aAAc/B,QAAMqC,MAAMrC,QAAMU,WAGnC+b,UAAS,WACR,MAAO,CAGLupC,QAAQ,EACRlyC,KAAM,GACN7J,UAAM9F,EACNk0B,QAAS,GACT9xB,WAAOpC,EACP+hD,wBAAoB/hD,EACpBwwF,gBAAYxwF,MAGfzC,SAAQ,SAAAC,GAAQ,IACPyR,EAAkBsQ,sBAAW/hB,GAA7ByR,cACR,MAAO,CACLwhF,aADK,SACQ/9E,GACX+M,kBAAQjiB,EAAM,eAAgB,CAACkV,EAASlV,EAAMyR,SAInD4J,OAAM,SAAArb,GAAI,MAAK,CACd,uBACE,IAAMkzF,EAAcvvE,6BAAkB3jB,GACnCivF,aACH,IAAKjvF,EAAKgzF,WAAY,OAAOE,EAE7B,IAAMrE,EAAS74E,KAAKW,MAAMX,KAAKC,UAAUi9E,IAczC,OAXArE,EAAOhgF,SAAQ,SAAClG,IACEA,EAAME,OAAO2kF,OACzB7kF,EAAME,OAAOY,QACb,CAACd,EAAME,SACHgG,SAAQ,SAAChG,GAAmB,MAC5BsqF,EAAO,UAAGnzF,EAAKgzF,kBAAR,aAAG,EAAkBnqF,EAAO/J,SACrCq0F,GAAWtqF,EAAO/J,UAAYq0F,IAChCtqF,EAAO/J,QAAUq0F,SAIhBtE,GAGT,kBACE,IAAMnrE,EAAOC,6BAAkB3jB,GAC/B,kCACKif,GAAqBjf,IAD1B,IAEEmiB,aAAcniB,EACdozF,aAAc1vE,EAAK0mE,SAAWpqF,EAAK+yF,kBACnChB,OAAQruE,EAAK0mE,SACbxnC,iBAAkBn6C,KAAKm6C,iBACvBqwC,aAAcjzF,EAAKizF,gBAQvB,mBACE,IAAMhjF,EAAUjQ,EAEVqzF,EADoBtxE,sBAAW/hB,GAA7ByR,cAC+B2Q,gBACrCpiB,EAAK8hB,kBAEP,IAAKuxE,EACH,MAAM,IAAI3tF,MAAJ,oBAAuBuK,EAAQ6R,iBAA/B,gBACR,IAAKuxE,EAAiBjkF,eACpB,MAAM,IAAI1J,MAAJ,mBACQuK,EAAQ6R,iBADhB,qEAGR,OAAOuxE,GAGTC,yBAtDc,SAsDWp5C,GACvB,SAAUA,aAAoB3U,KAOhC,wBACE,GAAKpN,kBAAQn4B,GAAb,CACA,IAAMkjB,EAAUnB,sBAAW/hB,GAC3B,GAAKkjB,EAAL,CAHsB,IAId4kC,EAAc5kC,EAAd4kC,UAER,OAAIxhC,GAAUwhC,GACLA,EAAUpoD,UADnB,SAMHK,SAAQ,SAAAC,GAAI,MAAK,CAChBuzF,cADgB,WAEdvzF,EAAKqkD,QAAS,EACdrkD,EAAK02B,QAAU,GACf12B,EAAKmS,KAAO,GACZnS,EAAKsI,UAAO9F,EACZxC,EAAK4E,WAAQpC,EACbxC,EAAKukD,wBAAqB/hD,GAE5BgxF,cATgB,YAoBb,IAVD98D,EAUC,EAVDA,QACApuB,EASC,EATDA,KACA6J,EAQC,EARDA,KACAoyC,EAOC,EAPDA,mBAQI7tB,GACF12B,EAAKqkD,QAAS,EACdrkD,EAAK02B,QAAUA,EACf12B,EAAKmS,KAAO,GACZnS,EAAKsI,UAAO9F,EACZxC,EAAK4E,WAAQpC,EACbxC,EAAKukD,wBAAqB/hD,IAE1BxC,EAAKqkD,QAAS,EACdrkD,EAAK02B,QAAU,GACf12B,EAAKmS,KAAOA,EACZnS,EAAKsI,KAAOA,EACZtI,EAAK4E,WAAQpC,EACbxC,EAAKukD,mBAAqBA,IAG9BkvC,YArCgB,SAqCJ7uF,GACVD,QAAQC,MAAMA,GAEd5E,EAAKqkD,QAAS,EACdrkD,EAAK02B,QAAU,GACf12B,EAAKmS,KAAO,GACZnS,EAAKsI,UAAO9F,EACZxC,EAAK4E,MAAQA,EACb5E,EAAKukD,wBAAqB/hD,GAG5BkxF,cAhDgB,SAgDFV,GACZhzF,EAAKgzF,WAAaA,GAEpB1wE,SAnDgB,SAmDP1d,GACP5E,EAAK4E,MAAQA,OAGhB7E,SAAQ,SAAAC,GAAQ,MACW+hB,sBAAW/hB,GAA7ByR,cAIU+qC,UAAUm3C,IAF1Bf,EAHa,EAGbA,mBACAC,EAJa,EAIbA,qBAEF,MAAO,CACLj1E,YADK,WAEHmoC,iCACE/lD,EACA4yF,EACAC,EACA,CACE7uF,KAAM,GAAF,OAAKhE,EAAKuP,KAAV,YAAkBvP,EAAKN,GAAvB,cAEJ0mD,iBAAiB,GAEnBpmD,EAAKuzF,cACLvzF,EAAKwzF,cACLxzF,EAAKyzF,aAEP1tC,iCACE/lD,GACA,iBAAO,CACL8lB,cAAe1H,GAAsBpe,EAAKkiB,aAC1C6D,QAAS9D,kBAAQvD,oBAAU1e,EAAM,GAAI,WACrCq6C,gBAAiBt4B,sBAAW/hB,GAAMq6C,mBALjB,uCAQnB,aAAyDvzC,GAAzD,mBAAAtF,EAAA,6DAASskB,EAAT,EAASA,cAAeC,EAAxB,EAAwBA,QAASs0B,EAAjC,EAAiCA,gBAAjC,kBACSA,EAAgBu5C,wBACrB7tE,EACAD,EAAc,GACd,CAAEhf,SAAQk9B,UAAWrlB,GAAgB3e,MAJzC,2CARmB,wDAenB,CACEgE,KAAM,GAAF,OAAKhE,EAAKuP,KAAV,YAAkBvP,EAAKN,GAAvB,qBACJ0mD,iBAAiB,IAEnB,eACA,SAAA4sC,GACEhzF,EAAK0zF,cAAcV,MAErB,SAAApuF,GACED,QAAQC,MAAMA,GACd5E,EAAKsiB,SAAS1d,WChOpBivF,GAAyBt2E,8BAC7B,mBACA,CACE01E,aAAc,CACZ1jF,KAAM,UACNqB,YACE,mEACF4M,cAAc,EACd+jC,kBAAmB,CAAC,UAAW,QAAS,mBAG5C,CAAE7jC,mBAAoB,cCPHo2E,G,4MACnB9vF,KAAO,qB,sDAECyN,GACNA,EAAc6xD,aAAY,kBACxB7xD,EAAc+qC,UAAUu3C,S,gCAIlBtiF,GACJoyD,iCAAsBpyD,EAAc6oC,YACtC7oC,EAAc6oC,UAAUwpB,gBAAgB,CAAC,OAAQ,OAAQ,CACvD1iE,MAAO,gBACPskB,KAAMsuE,KACNxuE,QAAS,SAACtC,GACRA,EAAQ8gD,QAAQ,eAAgB,W,GAfM54B,I,yJCQhD6oD,yCAGA,IAEMC,GAAN,uNAGMxhF,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCuhF,eAAgB,CACdx/E,UADc,OAEdhB,aAAc,aAAF,OAAef,UAFb,SAGdshF,WAHc,GAIdnqE,SAVJ,QAYEqqE,kBAAmB,CACjBnrE,OADiB,EAEjBirE,WAFiB,GAGjBnqE,SAfJ,YAsEehhB,2BAnDf,SAAwB,GAAU,IAAR8zE,EAAQ,EAARA,KAClBvoE,EAAU5B,KACVE,EAAQ8iB,eAFkB,EAIRvI,mBAAS0vD,EAJD,0BAIzBlJ,EAJyB,KAInB0gB,EAJmB,OAKFlnE,qBALE,mBAKzBvoB,EALyB,KAKlB0vF,EALkB,KAM1BC,EAAgBC,uBAAY7gB,EAAlC,KAYA,OAVAnmD,qBAAU,WACR,IACEjG,gBACAs1D,SACAyX,QACA,MAAO5vF,GACP4vF,QAED,CAACC,EARJ/mE,IAWE,4BACE,wBAAYgM,QAAZ,EAAmBC,QAAQ,mBACxBojD,EAFL,MAIE,wBACE/nE,UAAWR,EADb,eAEElC,MAFF,EAGEqiF,cAAe,SAAAC,GACbL,MAEFM,UAAW,SAAAD,GAAO,OAChB,wBACEE,SADF,aAEElgF,MAAO9B,6BAFT,KAGEkC,UAAWR,EAHb,kBAMEugF,YAAa,CAAE1hF,WAAF,OAAsBL,QAAS,IAP9B,IAYlBA,QAlBF,GAmBE4B,MAAO,CAAEvB,WAAYvO,EAAQ,YAASpC,KAExC,4BAAiBq6E,EA1BrB,iB,WCtCF,IAAMnqE,GAAYC,aAAW,CAC3Bg8C,QAAS,CACP9hD,SAAU,WACV2hB,OAAQ,GAEVsmE,MAAO,CACLjoF,SAAU,QACV+hB,IAAK,EACLuB,MAAO,EACP87D,OAAQ,EACRh8D,KAAM,KAIH,SAAS8kE,GAAYvlF,GAGzB,IACOyD,EAAoBzD,EAApByD,MAAO+iB,EAAaxmB,EAAbwmB,SACT1hB,EAAU5B,KAFf,EAGmDya,oBAAS,GAH5D,mBAGM6nE,EAHN,KAG0BC,EAH1B,KAQD,OACE,6BACGD,EACC,yBAAKlgF,UAAWR,EAAQq6C,SACtB,yBACEvgC,KAAK,eACLtZ,UAAWR,EAAQwgF,MACnBtvE,QAVU,WAClByvE,GAAsB,MAWhB,kBAAC,KAAD,CAAchiF,MAAOA,EAAO+iB,SAAUA,KAEtC,MAUH,IAAMk/D,GAAY,SAAC1lF,GAQpB,IACI4C,EAA2C5C,EAA3C4C,MAAOhR,EAAoCoO,EAApCpO,MAAOkrD,EAA6B98C,EAA7B88C,eAAgBt2B,EAAaxmB,EAAbwmB,SADlC,EAE8B7I,oBAAS,GAFvC,mBAEGgoE,EAFH,KAEcC,EAFd,KAIJ,OACE,oCACE,kBAAC,KAAD,eACEhjF,MAAOA,EACPhR,MAAOA,EACP2rD,WAAY,CACVr4C,MAAO,CACLzB,MAAOb,EACPijF,iBAAkB,OAClBC,iBAAkB,QAClBC,iBAAkBnjF,IAGtBoT,QAAS,kBAAM4vE,GAAcD,IAC7Bn/D,SAAU,SAAAtI,GACRsI,EAAStI,EAAMuI,OAAO7jB,SAEpBk6C,IAEL6oC,EACC,kBAACJ,GAAD,CACE9hF,MAAOb,EACP4jB,SAAU,SAACtI,GACTsI,EAxFZ,SAAwB/iB,GACtB,GAAIA,aAAiBvR,OAAQ,OACJuR,EAAf5P,EADmB,EACnBA,EAAGmyF,EADgB,EAChBA,EAAG/zF,EADa,EACbA,EAAGD,EADU,EACVA,EACjB,oBAAc6B,EAAd,YAAmBmyF,EAAnB,YAAwB/zF,EAAxB,YAA6BD,EAA7B,KAEF,OAAOyR,EAmFYwiF,CAAe/nE,EAAMgoE,SAGhC,OAUVR,GAAUx4D,aAAe,CACvBt7B,MAAO,GACPgR,MAAO,OACPk6C,eAAgB,IAkCHvjD,2BA/Bf,SAAyByG,GAOtB,IACOqtE,EAASrtE,EAATqtE,KACR,OACE,kBAAC,GAAD,CACEz7E,MAAOy7E,EAAK74E,KACZoO,MAAOyqE,EAAKzqE,MACZ4jB,SAAU,SAAC/iB,GACT4pE,EAAKtrE,IAAI0B,IAEXq5C,eAAgB,CACdQ,WAAY+vB,EAAKjsE,YACjBypB,WAAW,Q,sBCzHnB45D,mCAGA,IAEMC,GAAN,uNAGMxhF,GAAYC,aAAW,CAC3BwhF,eAAgB,CACdD,WADc,GAEdnqE,SARJ,OASIiG,UAHc,OAIdrb,UAJc,OAKdhB,aAAc,8BAEhBygF,kBAAmB,CACjBnrE,OADiB,EAEjBirE,WAFiB,GAGjBnqE,SAhBJ,QAkBEnlB,MAAO,CACLqO,MADK,MAEL8W,SAAU,WA2DChhB,2BAvDf,SAAoB,GAAU,IAAR8zE,EAAQ,EAARA,KACdvoE,EAAU5B,KACVE,EAAQ8iB,eAFc,EAGIvI,mBAC9BnX,eAAe6mE,EAAf7mE,WAJ0B,0BAGrB2/E,EAHqB,KAGXC,EAHW,OAMFzoE,qBANE,mBAMrBvoB,EANqB,KAMd0d,EANc,KAOtBuzE,EAAgBrB,uBAAYmB,EAAlC,KAYA,OAVAnoE,qBAAU,WACR,IACEqvD,MAAS7mE,WAAT6mE,IACAv6D,UACA,MAAO5d,GACP4d,EAAS5d,EAAT4d,YAGD,CARHkL,IAWE,oCACG5oB,EAAQ,uBAAGkQ,UAAWR,EAAQ1P,OAAzB,GADR,KAEE,wBAAaA,MAAOA,GAClB,wBAAY40B,QAAZ,EAAmBC,QAAQ,mBACxBojD,EAFL,MAIE,wBACE/nE,UAAWR,EADb,eAEElC,MAFF,EAGEqiF,cAHF,EAIEE,UAAW,SAAAD,GAAO,OAChB,wBACEE,SADF,OAEElgF,MAAO9B,6BAFT,KAGEkC,UAAWR,EAHb,kBAMEugF,YAAa,CAAE1hF,WAAF,OAAsBL,QAAS,IAP9B,IAYlBA,QAhBF,GAiBE4B,MAAO,KAET,4BAAiBmoE,EA1BvB,kBC1BIiZ,GAAe/sF,oBAAS,gBAAG8zE,EAAH,cAC5B,wBACEz7E,MAAOy7E,EADT,KAGE/vB,WAAY+vB,EAHd,YAIExiD,WAJF,EAKEjoB,MAAOyqE,EALT,MAME7mD,SAAU,SAAA+/D,GAAG,OAAIlZ,MAASkZ,SAAb,aAIXC,GAAajtF,oBAAS,gBAAG8zE,EAAH,cAC1B,wBACEz7E,MAAOy7E,EADT,KAEE/vB,WAAY+vB,EAFd,YAGExiD,WAHF,EAIE47D,WAJF,EAKE7jF,MAAOyqE,EALT,MAME7mD,SAAU,SAAA+/D,GAAG,OAAIlZ,MAASkZ,SAAb,aAKXG,GAAc,kBAClB,4BACE,0BAAMzxE,EAAE,0YAIN0xE,GAAoBptF,oBAAS,YAAc,IAAX8zE,EAAW,EAAXA,KAAW,EACrB1vD,mBADqB,uBACxC/a,EADwC,KACjC6iB,EADiC,KAE/C,OACE,oCACG4nD,OAAY,4BAAaA,EAAzBA,MADH,KAEE,wBAAMuZ,gBAAc,GACjBvZ,EAAA,WAAe,qBACd,wBAAUtnE,IAAV,EAAoBua,gBAAc,GAChC,wBACE1d,MADF,EAEE4jB,SAAU,SAAA+/D,GAAG,OAAIlZ,eAAqBkZ,SAAzB,QACbhpC,WAAY,CACVE,aACE,4BACE,wBACEh6C,MADF,YAEEuS,QAAS,kBAAMq3D,gBAAN,KAET,uBALJ,eAaV,wBAAU/sD,gBAAc,GACtB,wBACE1d,MADF,EAEEikF,YAFF,UAGErgE,SAAU,SAAAtI,GAAK,OAAIuH,EAASvH,SAAb,QACfq/B,WAAY,CACVE,aACE,4BACE,wBACEznC,QAAS,WACPq3D,SACA5nD,OAEF5E,SALF,KAKYje,EACVa,MAAM,aAEN,uBATJ,aAiBV,4BAAiB4pE,EAhDrB,iBAqDIyZ,GAAqB3jF,cAAW,SAAAC,GAAK,MAAK,CAC9C+pB,KAAM,CACJhoB,UAAW/B,kBAIT2jF,GAAuBxtF,oBAAS,YAAc,IAAX8zE,EAAW,EAAXA,KACjCvoE,EAAUgiF,KADkC,EAExBnpE,mBAFwB,uBAE3C/a,EAF2C,KAEpC6iB,EAFoC,KAGlD,OACE,oCACE,4BAAa4nD,EADf,MAEGr5E,MAAA,KAAWq5E,EAAX,OAAuB,mCAAEtnE,EAAF,KAAOe,EAAP,YACtB,uBAAM8mB,QAAN,EAAa7nB,IAAb,EAAuBT,UAAWR,EAAQqoB,MACxC,wBACEnoB,MADF,EAEEwf,OACE,wBAAY/gB,MAAZ,YAA8BuS,QAAS,kBAAMq3D,SAAN,KACrC,uBADF,SAKJ,2BACE,sBACEA,KAAM,CACJzqE,MADI,EAEJxB,YAAa,gCAAF,OAFP,GAGJ4lF,WAAY,cACV3Z,wBAEF4Z,cAAe,SAAA56E,GACbghE,yBAEF32D,IAAK,SAAAzQ,GACHonE,yBAOZ,uBAAMz/C,QAAN,EAAatoB,UAAWR,EAAQqoB,MAC9B,wBACEgC,mBADF,EAEEnqB,MACE,wBACE6lB,WADF,EAEEjoB,MAFF,EAGEikF,YAHF,UAIErgE,SAAU,SAAAtI,GAAK,OAAIuH,EAASvH,SAAb,QACfq/B,WAAY,CACVE,aACE,4BACE,wBACE58B,SADF,KACYje,EACVoT,QAAS,WACPq3D,YACA5nD,OAEFhiB,MAAM,aAEN,uBATJ,cAkBZ,4BAAiB4pE,EA7DrB,iBAkEI6Z,GAAkB3tF,oBAAS,YAAc,IAAX8zE,EAAW,EAAXA,KAC5BvoE,EAAUgiF,KAD6B,EAEnBnpE,mBAFmB,uBAEtC/a,EAFsC,KAE/B6iB,EAF+B,KAG7C,OACE,oCACE,4BAAa4nD,EADf,MAEGr5E,MAAA,KAAWq5E,EAAX,OAAuB,mCAAEtnE,EAAF,KAAOe,EAAP,YACtB,uBAAM8mB,QAAN,EAAa7nB,IAAb,EAAuBT,UAAWR,EAAQqoB,MACxC,wBACEnoB,MADF,EAEEwf,OACE,wBAAY/gB,MAAZ,YAA8BuS,QAAS,kBAAMq3D,SAAN,KACrC,uBADF,SAKJ,2BACE,sBACEA,KAAM,CACJzqE,MADI,EAEJb,IAAK,SAAAolF,GAAQ,OAAI9Z,QAAJ,YAMvB,uBAAMz/C,QAAN,EAAatoB,UAAWR,EAAQqoB,MAC9B,wBACEgC,mBADF,EAEEnqB,MACE,wBACE6lB,WADF,EAEEjoB,MAFF,EAGEikF,YAHF,UAIErgE,SAAU,SAAAtI,GAAK,OAAIuH,EAASvH,SAAb,QACfq/B,WAAY,CACVE,aACE,4BACE,wBACE58B,SADF,KACYje,EACVoT,QAAS,WACPq3D,WACA5nD,OAEFhiB,MAAM,aAEN,uBATJ,cAkBZ,4BAAiB4pE,EApDrB,iBAyDI+Z,GAAe7tF,oBAAS,YAAc,IAAX8zE,EAAW,EAAXA,KAAW,EACpB1vD,mBAAS0vD,EADW,0BACnCvmE,EADmC,KAC9BugF,EAD8B,KAU1C,OARArpE,qBAAU,WACR,IAAMspE,EAAM3uB,WAAW7xD,EAAvB,IACKmrC,aAAL,GAGEo7B,UAFAA,WAID,CAACA,EAPJrvD,IASE,wBACEpsB,MAAOy7E,EADT,KAEE/vB,WAAY+vB,EAFd,YAGEzqE,MAHF,EAIE7C,KAJF,SAKEymB,SAAU,SAAA+/D,GAAG,OAAIc,EAAOd,SAAX,aAKbgB,GAAgBhuF,oBAAS,YAAc,IAAX8zE,EAAW,EAAXA,KAAW,EACrB1vD,mBAAS0vD,EADY,0BACpCvmE,EADoC,KAC/BugF,EAD+B,KAQ3C,OANArpE,qBAAU,WACR,IAAMspE,EAAMlwF,SAAS0P,EAArB,IACKmrC,aAAL,IACEo7B,WAED,CAACA,EALJrvD,IAOE,wBACEpsB,MAAOy7E,EADT,KAEE/vB,WAAY+vB,EAFd,YAGEzqE,MAHF,EAIE7C,KAJF,SAKEymB,SAAU,SAAA+/D,GAAG,OAAIc,EAAOd,SAAX,aAKbiB,GAAgBjuF,oBAAS,gBAAG8zE,EAAH,cAC7B,4BACE,wBACEz7E,MAAOy7E,EADT,KAEEoa,QACE,uBACExxE,QAASo3D,EADX,MAEE7mD,SAAU,SAAA+/D,GAAG,OAAIlZ,MAASkZ,SAAb,cAInB,4BAAiBlZ,EAXU,iBAezBqa,GAAmBnuF,oBAAS,YAA0B,IAAvB8zE,EAAuB,EAAvBA,KAAMsa,EAAiB,EAAjBA,WACnCtwE,EAAIuwE,6BAAmBC,qBAA7B,IACMC,EAAU,2BACdC,2BAAiBF,qBAAWG,0BAAgB3wE,EAA5C0wE,WADc,SAEV,SAAAzuD,GAAC,OAAIA,EAAJ,SAEP,OACE,wBACE12B,MAAOyqE,EADT,MAEEz7E,MAAOy7E,EAFT,KAGE3gB,QAHF,EAKEpP,WAAY+vB,EALd,YAMExiD,WANF,EAOErE,SAAU,SAAA+/D,GAAG,OAAIlZ,MAASkZ,SAAb,SAEZuB,EAAA,KAAY,SAAAplF,GAAG,OACd,wBAAUqD,IAAV,EAAoBnD,MAAOF,GADb,UAStB,SAASulF,GAAkB5a,GACzB,OAAO,SAAAp1E,GACLo1E,iCAAcA,EAAdA,YAIJ,IAAM6a,GAAsB3uF,oBAAS,YAAc,IAAX8zE,EAAW,EAAXA,KACtC,OACE,sBACEp1E,SAAUo1E,EADZ,MAEEziD,YAAaq9D,GAFf,GAGEzzF,KAAM64E,EAHR,KAIEjsE,YAAaisE,EAAKjsE,iBAKlB+mF,GAAkB,CACtB54F,OADsB,GAEtByO,KAFsB,GAGtBoqF,aAHsB,GAItBC,YAJsB,GAKtBC,eALsB,GAMtBC,UANsB,GAOtB74F,OAPsB,GAQtB84F,QARsB,GAStB/kF,MATsB,GAUtBglF,WAVsB,GAWtBn4F,QAXsB,GAYtBohD,OAZsB,GAatBg3C,oBAAqBC,IAGVC,GAAsBzlF,cAAW,SAAAC,GAAK,MAAK,CACtD0b,MAAO,CACLre,QADK,OAELi4E,aAAct1E,UAFT,GAGL/F,SAHK,WAILmH,SAAU,WAEZqkF,aAAc,CACZC,KADY,OAEZxlF,QAASF,UAFG,GAGZoB,SAAU,QAEZukF,eAAgB,CACd7/E,MADc,GAEdvF,WAAYP,oBAFE,MAGd3C,QAHc,OAIdshD,eAJc,SAKd53B,WAAY,cAuChB,GAnCmB5wB,oBAAS,YAA0B,IAAvB8zE,EAAuB,EAAvBA,KAAMsa,EAAiB,EAAjBA,WAC7B7iF,EAAU8jF,KACR7oF,EAASstE,EAFmC,KAGhD2b,EAAiB3b,gBAAmC8a,GAAxD,GAOA,OANA,IACEhzF,4EACA6zF,MAEIjpF,KAAN,IACE5K,yDAEA,wBAAOmQ,UAAWR,EAAQga,OACxB,yBAAKxZ,UAAWR,EAAQ+jF,cACtB,qBAAgBxb,KAAhB,EAA4Bsa,WAAYA,KAE1C,yBAAKriF,UAAWR,EAAQikF,gBACrB1b,2BACC,wBACE/nE,UAAWR,EADb,aAEEkR,QAAS,kBACPq3D,aAAkBA,EAAlBA,iBAA0CA,EADnC,qBAGTroE,MAAK,qBACHqoE,6BANJ,YAQE5pE,MAAM,aAEJ4pE,EAAD,WAAkD,qBAXtDA,MAWuB,uBAAnB,OAjBX,UC1WF,GA3BqB9zE,oBACnB,YAAmD,IAAhD0vF,EAAgD,EAAhDA,gBAAiB5b,EAA+B,EAA/BA,KAAMF,EAAyB,EAAzBA,SAAU3mD,EAAe,EAAfA,SAC5B1hB,EAAU8jF,KAChB,OACE,wBAAOtjF,UAAWR,EAAQga,OACxB,yBAAKxZ,UAAWR,EAAQ+jF,cACtB,wBACEjmF,MAAOyqE,EADT,KAEEz7E,MAFF,OAGE86D,QAHF,EAKEpP,WAAU,oBALZ,WAMEzyB,WANF,EAOErE,SAAUA,GAETyiE,EAAA,KAAoB,SAAAvmF,GAAG,OACtB,wBAAUqD,IAAV,EAAoBnD,MAAOF,GADL,YCJ9BwmF,GAAkB/lF,cAAW,SAAAC,GAAK,MAAK,CAC3C+lF,mBAAoB,CAClBl+D,WAAY7nB,UADM,GAElBgmF,WAAY,aAAF,OAAehmF,oBAFP,MAGlByY,YAAazY,UAHK,GAIlBs1E,aAAct1E,kBAIZimF,GAAS9vF,oBAAS,SAAAyG,GACtB,IAEA,EAFM8E,EAAUokF,KACR/b,EAA0DntE,EAFnC,SAEb2nF,EAAgD3nF,EAFnC,WAEDspF,EAAoCtpF,EAFnC,SAEmCA,EAFnC,KAEOqtE,OAFP,MAEcic,EAFd,KAI/B,GAAIC,oCAAJ,GAA2C,CACzC,GAAIlc,EAAJ,OACE,OACE,oCACGA,EAAA,KAAS,cACR,IAAMtnE,EAAM,GAAH,OAAMyjF,oBAAN,eAA4BC,EAArC,GACA,OAAO,yCAAmB1jF,IAAnB,EAA6BsnE,KAA7B,EAA4CF,SAAUpnE,SAOrE,IAAMkjF,EAAkBS,+CAAxB,GAcA,OAbIT,EAAJ,SACEU,EACE,sBACEV,gBADF,EAEE9b,SAFF,EAGEE,KAHF,EAIE7mD,SAAU,SAAA+/D,GACJA,iBAAqBlZ,EAAzB,MACEic,EAAA,eAA8B,CAAEvpF,KAAMwmF,SAAW3jF,YAMzD,oCACE,4BADF,GAEE,yBAAK0C,UAAWR,EAAQqkF,oBAAxB,EAEE,4BACE,sBAAQG,OAAQjc,OAO1B,OAAIuc,kCAAJ,GAES,sBAAY7jF,IAAZ,EAA2BsnE,KAA3B,EAAuCsa,WAAYA,IAG5D,QAGIkC,GAAStwF,oBAAS,YAAgB,IAAb+vF,EAAa,EAAbA,OACzB,OAAOl1D,mBACLliC,eAAe43F,wBADH,aAEZ,mCAAE3c,EAAF,KAAYwa,EAAZ,YACE,oCAAQ5hF,IAAKonE,GAAc,CAAEA,SAAF,EAAYwa,WAAZ,EAAwB2B,kBAKnDpmF,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6X,KAAM,CACJ3X,QAASF,gBADL,GAEJO,WAAYP,qBAFR,QAGJod,UAAW,cAoBAjnB,2BAhBf,SAA6B,GAAW,IAATnJ,EAAS,EAATA,MACvB0U,EAAU5B,KAIV6C,EAAM3V,UAAgBqO,yBAAerO,EAAD,OAA1C,WACA,OACE,yBAAKkV,UAAWR,EAAhB,KAA8BiB,IAA9B,EAAwCwa,cAAY,gBAChDnwB,EAAD,OAAkC,sBAAQk5F,OAAQl5F,EAAMq2B,SAAxD,oBCrGQ,YAAAxkB,GAAa,OAC1B,0CACsC,CAClC/R,GADkC,aAElC6P,KAAMlR,gBAF4B,6BAKlC43B,OAAQ53B,sBACNoT,4BADMpT,YANZ,SAaW,SAAA2B,GAAI,MAAK,CAChBu5F,UADgB,YAEdv5F,iBCbKqP,GAAekO,8BAAoB,4BAAzC,IACM9M,GAAmB1H,oBAAS,YAAe,IAAZnJ,EAAY,EAAZA,MAC1C,GAAIA,GAASA,EAAb,OAA2B,CACzB,GAAIA,SAAJ,KACE,gBAAUA,SAAV,kBAEF,GAAI2I,0BAAgB3I,EAApB,QAAmC,CACjC,IAAM2P,EAAOiqF,kBAAQ55F,EAArB,QACA,GAAI2P,GAAQA,EAAZ,KACE,gBAAUA,qCAAV,kBAIN,oBCCmBkqF,G,kDAKnB,WACE3rF,GACA,2BACA,cAAMA,IALAiN,cAIN,EAEA,IAAMA,EAAW9M,yBACfH,EACA,YAJF,OAMA,EAAKiN,SAAW,EAAK2+E,aAAa3+E,GAAY,IAN9C,E,yDASmB4+E,GAEnB,IADA,IAAM5+E,EAAW,IAAI7J,IACZ5N,EAAI,EAAGA,EAAIq2F,EAAMj2F,OAAQJ,GAAK,EACrC,GAAIq2F,EAAMr2F,GAAI,CACZ,IAAMmkB,EAAIhf,KAAKmxF,YAAYD,EAAMr2F,IAC3BxE,EAAU2oB,EAAEjoB,IAAI,WAClBq6F,EAAS9+E,EAASvb,IAAIV,GACrB+6F,IACHA,EAAS,GACT9+E,EAASxJ,IAAIzS,EAAS+6F,IAGxBA,EAAO3pF,KAAKuX,GAZqC,qBAiB3B1M,EAAS8oB,UAjBkB,IAiBrD,2BAA6C,SAC/BxR,MAAK,SAAC7wB,EAAGC,GAAJ,OAAUD,EAAEhC,IAAI,SAAWiC,EAAEjC,IAAI,aAlBC,8BAqBrD,OAAOub,I,kCAGWzS,GAClB,OAAO,IAAIke,GAAcle,K,8JAInBwB,EAAwB,IAAImc,I,eACAxd,KAAKsS,U,IAAvC,2BAAiD,yBAArCjc,EAAqC,KAA5Bic,EAA4B,KAE/CjR,EAASoc,IAAIpnB,GAIbic,EAASlM,SAAQ,SAAAqG,GAEf,IAAMi+D,EAAOj+D,EAAQ1V,IAAI,QACrB2zE,GAAQA,EAAKr0E,SACfgL,EAASoc,IAAIitD,EAAKr0E,SAGpB,IAAMg7F,IAAW5kF,EAAQ1V,IAAI,SAAW,IAAIu6F,QAAU,IAAI,GAC1D,GAAe,QAAXD,EAAkB,CACpB,IACM5Q,GADyBh0E,EAAQ1V,IAAI,QAAU,IAAI,GACdskF,aAAarkC,MAAM,KAC9D31C,EAASoc,IAAIgjE,EAAa,SACrB,GAAe,QAAX4Q,EAAkB,CAC3B,IAAM3S,IAASjyE,EAAQ1V,IAAI,SAAW,IAAI4nF,MAAQ,IAAI,GACtDt9E,EAASoc,IAAIihE,O,uDAIZ3jF,MAAMwC,KAAK8D,I,2QAOZL,EAAU,G,eAGkBhB,KAAKsS,U,IAAvC,2BAAiD,0BAArCjc,EAAqC,KAA5Bic,EAA4B,KAC3Ci/E,OAD2C,iBAEzBj/E,GAFyB,IAE/C,2BAAW7F,EAAqB,QAE5B8kF,GACAA,EAAc76F,KAAO+V,EAAQ1V,IAAI,UACjCw6F,EAAc/6F,OAASiW,EAAQ1V,IAAI,OAEnCw6F,EAAc76F,IAAM+V,EAAQ1V,IAAI,QAE5Bw6F,GAAevwF,EAAQyG,KAAK8pF,GAChCA,EAAgB,CACdl7F,UACAG,MAAOiW,EAAQ1V,IAAI,SACnBL,IAAK+V,EAAQ1V,IAAI,SAdwB,8BAkB3Cw6F,GAAevwF,EAAQyG,KAAK8pF,I,qCAIlCvwF,EAAQ4oB,MAAK,SAAC7wB,EAAGC,GAAJ,OAAUD,EAAE1C,QAAQm7F,cAAcx4F,EAAE3C,Y,kBAE1C2K,G,mRAIAjG,MAAMwC,KAAKyC,KAAKsS,SAAS8oB,UAAUj6B,KAAI,SAAAuwE,GAAY,MAAK,CAC7Dr7E,QAASq7E,EAAa,GAAG36E,IAAI,WAC7BmnB,QAASwzD,EAAa,GAAG36E,IAAI,gB,wIAIrBqJ,GAA0B,WAC5B/J,EAAwB+J,EAAxB/J,QAASG,EAAe4J,EAAf5J,MAAOE,EAAQ0J,EAAR1J,IAExB,OAAO2J,aAAgB,uCAAU,WAAMC,GAAN,mBAAAvH,EAAA,sDAE/B,IADMuZ,EAAW,EAAKA,SAASvb,IAAIV,IAAY,GACtCwE,EAAI,EAAGA,EAAIyX,EAASrX,OAAQJ,GAAK,GAClCmkB,EAAI1M,EAASzX,IACb9D,IAAI,OAASP,GAASwoB,EAAEjoB,IAAI,SAAWL,GAC3C4J,EAASgG,KAAK0Y,GAGlB1e,EAASS,WARsB,2CAAV,yD,8CApHjBrB,2BCfW+xF,G,0KAMPrxF,GAA0B,WAC5B5J,EAAe4J,EAAf5J,MAAOE,EAAQ0J,EAAR1J,IAGTg7F,EAAmB,2DACzB,OAAOrxF,aAAgB,uCAAU,WAAMC,GAAN,iBAAAvH,EAAA,sEACX24F,EACjBx3F,KAAK,EAAMkG,GACXO,KAAKwiD,gBACL/mB,YAJ4B,OACzBghC,EADyB,OAOzBnvD,EAAOmvD,EAAM,GACnB98D,EAASgG,KACP,IAAIyX,GAAJ,2BACK9P,EAAKuQ,UADV,IAEEurC,IAAK97C,EAAKlX,IAAI,OAAOmJ,MAAM1J,EAAOE,GAClCA,MACAF,YAGJ8J,EAASS,WAhBsB,2CAAV,yD,8CAX4BiwF,ICJ1CpqF,GAAekO,8BAC1B,oBACA,CACExC,SAAU,CACRxL,KAAM,SACNiO,aAAc,IAEhB48E,aAAc,CACZ7qF,KAAM,SACNiO,aAAc,kBAGlB,CAAEC,iBAAiB,IAGR48E,GAAuB98E,8BAClC,4BACA,CACExC,SAAU,CACRxL,KAAM,SACNiO,aAAc,IAEhB48E,aAAc,CACZ7qF,KAAM,SACNiO,aAAc,kBAGlB,CAAEC,iBAAiB,I,UClBA68E,G,WAKnB,WAAYxsF,GAA0D,yBAJ9DrG,cAI8D,OAF9D8yF,aAE8D,EACpE9xF,KAAKhB,SAAWE,wBAAasG,yBAAeH,EAAQ,aACpDrF,KAAK8xF,QAAU9xF,KAAK+xF,kB,8LAIG/xF,KAAKhB,SAASoE,SAAS,Q,cAAxCs5B,E,yBACCA,EACJs1D,OACAh7C,MAAM,MACN71C,KAAI,SAACy+B,GAAgB,MACUA,EAAIoX,MAAM,MADpB,kBAEpB,MAAO,CAAE3gD,QAFW,KAEF6nB,QAFE,gB,gJAOxB,OAAOle,KAAK8xF,U,iPC/BDh9E,iCACb,sBACA,CACE9V,SAAU,CACR8H,KAAM,eACNiO,aAAc,CAAEhd,IAAK,6BAGzB,CAAEid,iBAAiB,I,+MCYnBzZ,KAAO,sB,sDAECyN,GACNA,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,oBACNqL,aAAcqrF,GACd7qF,aAAc8qF,QAGpBlpF,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,4BACNqL,aAAcurF,GACd/qF,aAAcgrF,QAGpBppF,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,sBACNqL,aAAcyrF,GACdjrF,aAAckrF,QAIpBtpF,EAAcgyD,eAAc,WAC1B,OAAO,IAAIlzD,EAAW,CACpBvM,KAAM,4BACNyM,iBAAkBuqF,GAClB3rF,aAAc4rF,GACdlrF,WAAYmrF,GAAqCzpF,GACjDrC,eAAgB+rF,Y,GAnCK/vD,I,4CClBd7tB,iCAAoB,yBAEjC,CACE69E,eAAgB,CACd7rF,KADc,eAEdiO,aAAc,CAAEhd,IAAK,qCACrBoQ,YAAa,sDAGjB,CAAEi6C,kBAAmBwwC,K,WCRR,4oDAAf,S,8CCOO,6BAAA75F,EAAA,+EAEuBmG,oCAFvB,sBAEG2zF,EAFH,yBAGI,IAAI,GAAJ,QAHJ,0CAKG,IAAI51F,MAAM,yCAAV,YALH,gE,sBASP,+C,8CAAO,6BAAAlE,EAAA,sEACyBmG,oCADzB,sBACC4zF,EADD,yBAIE,IAAI,GAAJ,YAJF,gD,sBAOP,+C,8CAAO,6BAAA/5F,EAAA,sEACyBmG,oCADzB,sBACC6zF,EADD,yBAIE,IAAI,GAAJ,YAJF,gD,sBAOA,SAASC,GAAe,EAAxB,OAML,IAAM99E,EAAN,GAoCA,OAlCA+9E,WAAgB,cACd,IAAMC,EAAYn4F,WAAW6a,EAA7B,QACMu9E,EAAkB,CAAC,aAAD,6BAAxB,QAMA,IAAID,EAAA,MAAe,SAAApmF,GAAG,OAAIqmF,WAAJ,MAAtB,CACA,IAAMC,EAAN,GACIC,EAAJ,EACA,GAEE,GADAA,EAAmBJ,aAAnBI,UACsB,OACEA,QADF,KAClBA,EADkB,oBAEpBD,OAAkBH,MAAlBG,WAJJ,GAOAA,YACA,IAGMt2F,EAeV,SAAyB,EAAzB,SAOE,IAAI6K,EAAYiO,MAAhB,QACA,IAAgBjO,EAAYsrF,MAAYr9E,MAAZq9E,eAAZtrF,SAChB,IAMA,EAMA,EAZI2rF,EAAgB3rF,aAApB,GAEE2rF,WACA19E,2CAFF,UAIE09E,UAGAC,EADEC,EAAJ,IACoB,CAChBz7F,IAAK,IAAIqH,IAAIwW,MAAR,cAAiC49E,EAAjC,KAA0Dn0F,MAE5C,CAAExH,UAAW+d,qBAGpC,UACE,UAiBE,OAfE69E,EADED,EAAJ,IACyB59E,EAAA,oBACnB,CACE7d,IAAK,IAAIqH,IAAIwW,MAAR,gBAAmC49E,EAAnC,KACFn0F,MAEL,CACEtH,IAAK,IAAIqH,IAAI,GAAR,OACAwW,MADA,sBAEH49E,EAFG,KAGHn0F,MAGeuW,EAAA,oBACnB,CAAE/d,UAAW+d,uBACb,CAAE/d,UAAW,GAAF,OAAK+d,MAAL,uBACV,CACL9O,KADK,kBAELvL,KAAMqa,MAFD,cAGLzN,YAAayN,MAHR,aAILqD,SAJK,EAKLqE,QAAS,CACPxW,KADO,aAEPmQ,YAFO,EAGP/D,MAAO,CACLlU,SAAUy0F,KAIlB,UAMA,qBAMA,eAMA,qBACE,OAAO56E,GACLjD,MADiC,gBAAnC,GAKF,kBACE,MAAO,CACL9O,KADK,eAELvL,KAAMqa,MAFD,cAGLzN,YAAayN,MAHR,aAILqD,SAJK,EAKLqE,QAAS,CACPxW,KADO,gBAEP4Q,eAAgB67E,GAElB9hD,SAAU,CACR3qC,KAAM,uBAGZ,aAWA,kBACE,MAAO,CACLA,KADK,eAELvL,KAAMqa,MAFD,cAGLzN,YAAayN,MAHR,aAILqD,SAJK,EAKLqE,QAAS,CACPxW,KADO,gBAEP4Q,eAAgB67E,IAGtB,eAcA,kBAcA,aAcA,aACE,MAAO,CACLzsF,KADK,eAELvL,KAAMqa,MAFD,cAGLzN,YAAayN,MAHR,aAILqD,SAJK,EAKLqE,QAAS,CACPxW,KADO,gBAEP4Q,eAAgB67E,GAElB9hD,SAAU,CACR3qC,KAAM,uBAGZ,aACE,MAAO,CACLA,KADK,oBAELvL,KAAMqa,MAFD,cAGLzN,YAAayN,MAHR,aAILqD,SAJK,EAKLqE,QAAS,CACPxW,KADO,gBAEP6Q,eAAgB47E,IAGtB,gBAMA,kBACE,OAAO16E,GACLjD,MADiC,gBAAnC,GAKF,WAiBE,OAfE69E,EADED,EAAJ,IACyB59E,EAAA,oBACnB,CACE7d,IAAK,IAAIqH,IAAIwW,MAAR,gBAAmC49E,EAAnC,KACFn0F,MAEL,CACEtH,IAAK,IAAIqH,IAAI,GAAR,OACAwW,MADA,uBAEH49E,EAFG,KAGHn0F,MAGeuW,EAAA,oBACnB,CAAE/d,UAAW+d,uBACb,CAAE/d,UAAW,GAAF,OAAK+d,MAAL,wBACV,CACL9O,KADK,kBAELvL,KAAMqa,MAFD,cAGLzN,YAAayN,MAHR,aAILqD,SAJK,EAKLqE,QAAS,CACPxW,KADO,cAEPuQ,aAFO,EAGPC,aAHO,EAIPotD,oBAGN,UAMA,UAMA,iBACE,OAAO7rD,GACLjD,MADiC,gBAAnC,GAKF,oBACE,MAAO,CACL9O,KADK,eAELvL,KAAMqa,MAFD,cAGLzN,YAAayN,MAHR,aAILqD,SAJK,EAKLqE,QAAS,CACPxW,KADO,gBAEP4Q,eAAgB67E,IAGtB,qBACE,OAAO16E,GACLjD,MADiC,gBAAnC,GAKF,eAiBE,OAfE69E,EADED,EAAJ,IACyB59E,EAAA,oBACnB,CACE7d,IAAK,IAAIqH,IAAIwW,MAAR,gBAAmC49E,EAAnC,KACFn0F,MAEL,CACEtH,IAAK,IAAIqH,IAAI,GAAR,OACAwW,MADA,sBAEH49E,EAFG,KAGHn0F,MAGeuW,EAAA,oBACnB,CAAE/d,UAAW+d,uBACb,CAAE/d,UAAW,GAAF,OAAK+d,MAAL,uBACV,CACL9O,KADK,eAELvL,KAAMqa,MAFD,cAGLzN,YAAayN,MAHR,aAILqD,SAJK,EAKLqE,QAAS,CACPxW,KADO,kBAEP0Q,cAFO,EAGPtE,MAAO,CACLlU,SAAUy0F,KAIlB,UAMA,aACE,OAAO56E,GACLjD,MADiC,gBAAnC,GAKF,UACE,MAAO,CACL9O,KADK,WAELvL,KAAMqa,MAFD,cAGLzN,YAAayN,MAHR,aAILqD,SAJK,EAKLqE,QAAS,CACPxW,KADO,aAEPvB,YAAaguF,IAGnB,eACE,OAAO16E,GACLjD,MADiC,gBAAnC,GAMF,QACE,OAAOuD,GACLvD,MAD6B,gBAA/B,IA7UU89E,CAAgB,EAHTN,EAAA,KAAiB,SAAA35E,GAAW,OAC7CA,MAD6C,iBAGpB,IAA3B,GAOA3c,kCAA+BxD,KAA/BwD,IACAA,gBAAoB,CAApBA,GACAoY,cAGF,EC7Da,mBACb,OAAO,yCAELy+E,GAFK,GAGL,cACS,CACL79E,cAAeoE,iCADV,IAELpT,KAAMlR,4CAHV,SAKW,SAAA2B,GAAI,MAAK,CAChBq8F,QADgB,WAEd,IAAMC,EAAiBruF,yBAAejO,EAAD,cAArC,QACMu8F,EAAkBtuF,yBACtBjO,EADoC,cAAtC,kBAIMI,EAAe6N,yBACnBjO,EADiC,cAAnC,gBAIMkjB,EAAUnB,sBAAhB,GACMy6E,EAAet5E,EAAA,iBACnB,SAAA+jC,GAAQ,OAAIh5C,yBAAeg5C,EAAfh5C,UAAJ,MD1BpB,6CC4BUwuF,UACQ,SAAAC,GACJ,MAQA,OANEC,EADEJ,EAAJ,IACwB,CACpB/7F,IAAK,IAAIqH,IAAI60F,MAAR,eAAoCH,EAApC,KACFz0F,MAGiB,CAAExH,UAAWo8F,sBAC9BjhE,YAAY,CAAC,EAElBmhE,GAFF,QAVJH,MAeQ,YAA4B,IAMhC,EANgC,mBAA1BC,EAA0B,KAAjBG,EAAiB,KAChC,IAAKA,MAAL,GACE,MAAM,IAAIn3F,MAAM,aAAV,6DAFwB,MAkBhC,OAVEu2F,EADEM,EAAJ,IACwB,CACpB/7F,IAAK,IAAIqH,IACPg1F,aADG,WAEH,IAAIh1F,IAAI60F,MAAR,eAAoCH,EAFjC,MAGHz0F,MAGkB,CACpBxH,UAAWu8F,yBAERphE,YAAY,CAAC,EAElBqhE,GAFF,QAjCJL,MAsCQ,YAAwC,uBAAtCR,EAAsC,KAAjBc,EAAiB,KACtC5vB,EAAkBl/D,yBAAeuuF,EAAc,CAAC,WAAtD,YAIM7+E,EAAS89E,GAAe,EAAD,IAA7B,GAMAz7F,sBAjDJy8F,OAmDS,SAAA73F,GACLD,iBACAue,yEAC2DljB,EAD3DkjB,0HAIAA,kBAAwBljB,EAAxBkjB,yB,uDChFRxQ,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCG,QAAS,CACPm1E,aAAct1E,kBAWlB,SAASoqF,GAAc17F,GACrB,IAGE,OADA,YACA,EACA,MAAOsD,GACP,OAAOtD,aAAP,MAIJ,SAAS27F,GAAa,GAanB,IAZDC,EAYC,EAZDA,UACA37E,EAWC,EAXDA,UACAhC,EAUC,EAVDA,SACA49E,EASC,EATDA,eACAC,EAQC,EARDA,gBACAC,EAOC,EAPDA,aACAjtF,EAMC,EANDA,UACAktF,EAKC,EALDA,aACAC,EAIC,EAJDA,aACAt2C,EAGC,EAHDA,SACAu2C,EAEC,EAFDA,YACAt6E,EACC,EADDA,QAEM5O,EAAU5B,KADf,EAEyBya,qBAFzB,mBAEMvoB,EAFN,KAEa0d,EAFb,KA0DD,GAvDAkL,qBAAU,WACR,GAAI0vE,EAAJ,IAAmB,CACjB,IAAMn3E,EAAUzG,GAAa49E,EAAD,UAAuBC,EAAnD,KACAC,KACAE,EAAa18E,GAAemF,EAHX,OAOdo3E,OAAsBA,iBAAvB,WACAD,iBAFF,UAIE56E,iEAMG66E,OAAsBH,GAAcG,EAArC,MACAH,GAAcE,EAHb,KAgBHxyF,sCACEyyF,OAAsBA,iBAAvB,YACCD,iBAHC,aAKH56E,sPAdAA,wLAsBJ,GAAI46E,EAAJ,UAAyB,CACvB,IAAMn3E,EAAUzG,GAAa49E,EAAD,UAA5B,aACAE,KACAE,EAAa18E,GAAemF,EAA5Bu3E,OAEEJ,EAAJ,QAAsBE,EAAgB,CAAE7tF,KAAM,wBAC7C,CAAC2tF,EAAWE,EAAiBD,EAjDhC3vE,IAuDI+vE,SAAJ,GACE,OACE,wBAAYzoF,UAAWR,EAAQvB,SAA/B,sJAIE,wBACEjL,KADF,sDAEEmuB,OAFF,SAGEwnE,IAAI,uBAPR,kDAYE,wBACE31F,KADF,wDAEEmuB,OAFF,SAGEwnE,IAAI,uBAfR,qBADF,iDAuBF,GAAIF,SAAJ,GACE,OACE,oCACE,wBAAYzoF,UAAWR,EAAQvB,SAA/B,6GAGE,wBACEjL,KADF,sDAEEmuB,OAFF,SAGEwnE,IAAI,uBANR,wFAWE,wBACE31F,KADF,wDAEEmuB,OAFF,SAGEwnE,IAAI,uBAdR,qBADF,iDAqBE,wBACE3oF,UAAWR,EADb,QAEElC,MAFF,EAGEhR,MAHF,cAIE0rD,WAJF,kBAKEoP,QALF,EAME7hC,WANF,EAOErE,SAAU,SAAAtI,GACR0vE,EAAgB,CAAE7tF,KAAMme,SAAatb,QACrCkrF,EAAa18E,GAAe8M,SAA5B4vE,SAEFI,YAAa,CACXC,mBAAoB,CAAE,cAAe,uBAGtCz6E,EAAA,qDACC,SAAA06E,GAAoB,MAElBA,+BACE,wBACEroF,IAAKqoF,EADP,KAEExrF,MAAOwrF,EAAqB55F,MAE3B45F,EAJH,WAWd,IAAKL,EAAL,KAGE,OAAO,4BAAP,uCACF,GAAIL,OAAiBA,EAAjBA,WAAwCA,EAA5C,OAA8D,CAC5D,IAAIxmE,EAAJ,KAwBA,OAtBEA,EADEwmE,OAAiBA,EAArB,UAEIK,8BACE,wBAAYzoF,UAAWR,EAAQvB,SAA/B,YACW,8BADX,yBAEE,8BAAOwqF,EAFT,6BAGE,8BAAOA,aAHT,MADFA,yEAQE,wBAAYzoF,UAAWR,EAAQvB,SAA/B,iBACgB,8BAAOwqF,EADvB,kCAEO,8BAFP,GATJ7mE,yEAiBE,wBAAY5hB,UAAWR,EAAQvB,SADjC2jB,6CAOA,sCAEG9xB,EACC,wBAAY8P,MAAO,CAAEzB,MAAO,WADxB,GAFR,KAKE,wBACE6B,UAAWR,EADb,QAEElT,MAFF,YAGE0rD,WAHF,wBAIEzyB,WAJF,EAKEjoB,MAAOmP,GALT,EAMEyU,SAAU,SAAAtI,GAAK,OAAI2vE,EAAa3vE,SAAjB,QACfoI,WAAY,CAAE,cAAe,oBAE/B,wBACEhhB,UAAWR,EADb,QAEElC,MAFF,EAGEhR,MAHF,YAIE0rD,WAJF,eAKEoP,QALF,EAME7hC,WANF,EAOErE,SAAU,SAAAtI,GACR4vE,EAAa5vE,SAAb4vE,QAEFI,YAAa,CACXC,mBAAoB,CAAE,cAAe,qBAGtCz6E,EAAA,mDAEM,SAAA26E,GAAkB,OACrB,wBACEtoF,IAAKsoF,EADP,KAEEzrF,MAAOyrF,EAAmB75F,MAEzB65F,EALkB,UAS3B,wBACEzrF,MADF,EAEEhR,MAFF,eAGE0rD,WAHF,4CAIEoP,QAJF,EAKE7hC,WALF,EAMErE,SA5JR,YACEwnE,EAAY9vE,SAAZ8vE,QA4JME,YAAa,CACXC,mBAAoB,CAAE,cAAe,wBAGtCz6E,EAAA,gBAAuB,SAAAs5E,GACtB,IAAMp8F,EAAe6N,yBAAeuuF,EAApC,QACA,OACE,wBAAUjnF,IAAV,EAA6BnD,MAAOhS,GADtC,QAUV,OAAO,+BAAP,MAkCF68F,gBAA4B,CAC1Bh2C,SAD0B,GAE1B72C,UAF0B,GAG1BmP,SAAU,IAGGxW,0BAAf,ICzTM2J,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6X,KAAM,CACJxa,QADI,OAEJqjD,cAAe,UAEjBhlC,MAAO,CACLxb,QAASF,kBAsCb,OAlCA,SAA2B,GAKxB,IAJDuqF,EAIC,EAJDA,eACAW,EAGC,EAHDA,kBACAZ,EAEC,EAFDA,UACAa,EACC,EADDA,aAEMzpF,EAAU5B,KAChB,OACE,yBAAKoC,UAAWR,EAAQmW,MACtB,wBAAO3V,UAAWR,EAAQga,OACxB,sBACEtqB,KADF,MAEE4M,YAFF,GAGEnJ,SAHF,EAIE2yB,YAAa2jE,IAEf,sBACE/5F,KADF,uBAEE4M,YAFF,sDAGEnJ,SAHF,EAIE2yB,YAAa0jE,OCtBjBprF,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6X,KAAM,CACJ9V,UAAW/B,cAEborF,QAAS,CACPpqF,gBAAiBhB,qBAAyB8b,SAE5C0sC,OAAQ,CACNzmD,UAAW/B,UADL,GAENiB,YAAajB,cAEfqrF,iBAAkB,CAChB/V,aAAct1E,cAEhBsrF,YAAa,CACXj1E,OAAQrW,kBAINurF,GAAQ,CAAC,mBAAf,sBA2Jep1F,2BAzJf,SAAwB,GAAW,IAATnJ,EAAS,EAATA,MAAS,EACGutB,mBADH,sBAC1BixE,EAD0B,KACdC,EADc,OAEKlxE,mBAFL,+BAE1BmxE,EAF0B,KAEbC,EAFa,OAGCpxE,mBAAS,CAAE3sB,IAAK,KAHjB,mBAG1B08F,EAH0B,KAGfa,EAHe,OAIW5wE,mBAAS,CAAE3sB,IAAK,KAJ3B,mBAI1B28F,EAJ0B,KAIVW,EAJU,OAKC3wE,mBALD,uBAK1B5L,EAL0B,KAKf87E,EALe,OAMClwE,mBAND,uBAM1B/c,EAN0B,KAMfktF,EANe,OAOOnwE,mBAPP,uBAO1BowE,EAP0B,KAOZH,EAPY,OAQDjwE,mBAC9BvtB,yCAT+B,uBAQ1BqnD,EAR0B,KAQhBu2C,EARgB,KAW3BlpF,EAAU5B,KACV6M,EAAW29E,MACbA,YAAoBA,uBADPA,GAAjB,KAIMh6E,EAAUnB,sBAAhB,GAqCA,aACE,GAAIq8E,IAAeD,UAAnB,GAIAZ,WAAwBL,EAAxBK,OACA,IAAM57E,EAAU,GAAH,OAAMJ,6BAAN,iBAEYre,KAFzB,OAIMs7F,EAAmBt7E,sBAAzB,GACAA,eAAqB,CACnBvB,QADmB,EAEnBpS,KAFmB,EAGnBvL,KAAMud,GAHa,EAInBuE,cAAe,CAJI,GAKnBC,QAAS,OAAF,IAAE,CAAF,sBAELonD,gBAAiBlrD,kBAAQu8E,EAAkB,CAAC,WAApB,gBAGxB5+F,EAAJ,KACEA,oBAEAsjB,sGAKFA,qBA3BEm7E,EAAcD,EAAdC,GA8BJ,aACEA,EAAcD,EAAdC,GAGF,aACE,UACE,OACE,QACEnB,OACAA,EADAA,WAEAA,EAFAA,MAGAA,EAJF,QAMF,OACE,SACG37E,GAAD,OAEAg8E,EAFA,MADF,GAMF,QACE,UAIN,OACE,yBAAKzoF,UAAWR,EAAQmW,MACtB,wBACE3V,UAAWR,EADb,QAEE8pF,WAFF,EAGEK,YAAY,YAEXN,GAAA,KAAU,qBACT,wBAAM5oF,IAAKnU,GACT,4BADF,GAEE,4BAtGV,YACE,UACE,OACE,OACE,sBACEk9F,YADF,EAEEC,eAFF,EAGErB,UAHF,EAIEa,aAJF,EAKEZ,eALF,EAMEW,kBAAmBA,IAGzB,OACE,OACE,sBACEv+E,SADF,EAEE2D,QAFF,EAGEi6E,eAHF,EAIED,UAJF,EAKE37E,UALF,EAME87E,aANF,EAOEjtF,UAPF,EAQEktF,aARF,EASEC,aATF,EAUEH,gBAVF,EAWEn2C,SAXF,EAYEu2C,YAAaA,IAGnB,QACE,OAAO,4BAAP,iBAwEOkB,CADH,GAEE,yBAAK5pF,UAAWR,EAAQ2pF,kBACtB,uBACE5tE,SADF,IACY+tE,EACV54E,QAFF,EAGE1Q,UAAWR,EAAQ8mD,QAJvB,QAQE,uBACE/qC,SAAUsuE,IACV5pF,QAFF,YAGE9B,MAHF,UAIEuS,QAJF,EAKE1Q,UAAWR,EALb,OAMEyb,cAAY,sBAEXquE,IAAeD,UAAfC,QArBA,mBCrJJ,YAAA3sF,GAAa,OAC1B,8BAA6B,CAC3B/R,GAD2B,aAE3B6P,KAAMlR,gBAFqB,kBAG3BqlB,KAAMrlB,sBACJoT,0BADIpT,kBCHGgR,GAAekO,8BAAoB,iBAAzC,ICoBQxU,2BAnBf,SAA6ByG,GAAO,IAC1BovF,EAAyCpvF,EADf,eACV5P,EAAyB4P,EADf,MACHqvF,EAAkBrvF,EADf,cAE5BsvF,EACJF,yBADF,GAGA,OACE,qBACEh/F,MAAO,CAAEq2B,OAAQr2B,GACjBi/F,cAAeA,O,qBC6ENE,OAlFf,SAA8BvvF,GAOd,IAEZwvF,EAMExvF,EANFwvF,sBACAJ,EAKEpvF,EALFovF,eACAK,EAIEzvF,EAJFyvF,kBACAC,EAGE1vF,EAHF0vF,oBACA9+F,EAEEoP,EAFFpP,aACA++F,EACE3vF,EADF2vF,gBAcF,OACE,0BAAMC,aAAa,OACjB,kBAAC,KAAD,CACEhtF,MAAOhS,EACPgB,MAAM,eACN0rD,WAAW,4CACXoP,QAAM,EACN7hC,WAAS,EACTrE,SAAU,SAACtI,GAAD,OAAiByxE,EAAgBzxE,EAAMuI,OAAO7jB,QACxD0jB,WAAY,CAAE,cAAe,uBAE5BopE,EAAoBt1F,KAAI,SAAAy1F,GAAkB,OACzC,kBAAC,KAAD,CAAU9pF,IAAK8pF,EAAoBjtF,MAAOitF,GACvCA,OAIP,kBAAC,KAAD,CACEjtF,MAAOwsF,EAAe56F,MAAQ,GAC9B5C,MAAM,iBACN0rD,WACE8xC,EAAehuF,YACb,oCACGguF,EAAehuF,YACfguF,EAAet9F,IACd,kBAAC,KAAD,CACEwG,KAAM82F,EAAet9F,IACrBm8F,IAAI,sBACJxnE,OAAO,SACPhjB,MAAM,aAEN,kBAAC,KAAD,OAEA,MAEJ,KAENipD,QAAM,EACN7hC,WAAS,EACTrE,SAlDN,SACEtI,GAEAuxE,EACED,EAAsBv4F,MACpB,SAAC64F,GAAD,OACEA,EAAqBt7F,OAAS0pB,EAAMuI,OAAO7jB,YA8C5C4sF,EAAsBp1F,KAAI,SAAC01F,GAAD,OACzB,kBAAC,KAAD,CACE/pF,IAAK+pF,EAAqBt7F,KAC1BoO,MAAOktF,EAAqBt7F,MAE3Bs7F,EAAqB3uF,aAAe2uF,EAAqBt7F,YCpEhE0O,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6X,KAAM,CACJ9V,UAAW/B,cAEborF,QAAS,CACPpqF,gBAAiBhB,qBAAyB8b,SAE5C0sC,OAAQ,CACNzmD,UAAW/B,UADL,GAENiB,YAAajB,cAEfqrF,iBAAkB,CAChB/V,aAAct1E,kBAIZurF,GAAQ,CAAC,2BAAf,wBA0Hep1F,2BAxHf,SAA6B,GAAW,IAATnJ,EAAS,EAATA,MAAS,EACMutB,mBADN,uBAC/ByxE,EAD+B,KACfK,EADe,OAEA9xE,mBAFA,uBAE/BoyE,EAF+B,KAElBC,EAFkB,OAGUryE,oBAHV,sBAG/BsyE,EAH+B,KAGbC,EAHa,OAIEvyE,mBAJF,uBAI/B/sB,EAJ+B,KAIjB++F,EAJiB,OAKFhyE,mBALE,sBAK/BixE,EAL+B,KAKnBC,EALmB,KAMhC/pF,EAAU5B,KAEVwQ,EAAUnB,sBAAhB,GAEQtQ,EAAkByR,EAVY,cAYtC,cACE+7E,KACAO,EACEG,EAAA,oBAAsC,CACpCC,aAAc,GAAF,OAAKD,EAAL,+BAA+Cz8F,KADvB,OAEpC9C,kBAoCN,aACMg+F,IAAeD,UAAnB,EAQF,WACE,IAAM0B,EAAiB38E,oBAAvB,GACAA,oBACAA,gBAXqC48E,GAChCzB,EAAcD,EAAdC,GAGP,aACEA,EAAcD,EAAdC,GAkBF,OACE,yBAAKvpF,UAAWR,EAAQmW,MACtB,wBACE3V,UAAWR,EADb,QAEE8pF,WAFF,EAGEK,YAAY,YAEX,QAAU,SAAAr9F,GAAK,OACd,wBAAMmU,IAAKnU,GACT,4BADF,GAEE,4BAjEV,WACE,UACE,OACE,OACE,sBACE49F,sBAAuBvtF,yBADzB,cAIEmtF,eAJF,EAKEK,kBALF,EAMEC,oBAAqBh8E,EAAA,gBAAuB,SAAA+jC,GAAQ,OAClDh5C,yBAAeg5C,EADmC,WAGpD7mD,aATF,EAUE++F,gBAAiBA,IAGvB,OACE,OACE,sBACEP,eADF,EAEEh/F,MAFF,EAGEi/F,cAAea,IAIrB,QACE,OAAO,4BAAP,iBAuCOxB,GACD,yBAAKppF,UAAWR,EAAQ2pF,kBACtB,uBACE5tE,SADF,IACY+tE,EACV54E,QAFF,EAGE1Q,UAAWR,EAAQ8mD,QAJvB,QAQE,uBACE/qC,WA5BX+tE,OAAoBQ,EAArB,MACCR,UAFH,GA8BcrpF,QAFF,YAGE9B,MAHF,UAIEuS,QAJF,EAKE1Q,UAAWR,EALb,OAMEyb,cAAY,qBAEXquE,IAAeD,UAAfC,YArBK,mBCjHT,sCAAkC,CAC/C1+F,GAD+C,aAE/C6P,KAAMlR,yCCDKgR,GAAekO,8BAAoB,sBAAzC,I,iECOD7K,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCC,sBAAuB,CACrB5C,QADqB,QAErB6C,QAASF,cAEXI,WAAY,CACVC,MAAO,eAIX,SAAS8sF,GAAS,GAOf,IANDngG,EAMC,EANDA,MACA2L,EAKC,EALDA,KACAy0F,EAIC,EAJDA,gBACA3vE,EAGC,EAHDA,SACA4vE,EAEC,EAFDA,WACA7/F,EACC,EADDA,aAEMkU,EAAU5B,KACVwtF,EAAW30F,OAAjB,KACMvH,EAAOuH,EAAKA,SAAlB,GAEM40F,EAAYvgG,8BAAlB,GAMMu6C,EAAQz4C,eAAd,OACM0+F,EAAgB1+F,2BAZrB,OAeD,OAAI0+F,OAAJ,IAA2BjmD,EAAoB,KAG7C,wBACEzlC,MAAO,CAAEC,UAAW,OACpBmW,UAAWlrB,gBAFb,GAGEo2B,SAAU,kBAAMp2B,iBAAN,KAEV,wBACEoT,WAAY,wBAAY8B,UAAWR,EAAQtB,cAE3C,wBAAY+B,QAAQ,SAApB,oBACEqrF,EAAgB,KAAH,cATnB,MAYE,wBAAkBtrF,UAAWR,EAAQzB,uBACnC,sBACEjT,MADF,EAEE2L,KAFF,EAGEy0F,gBAHF,EAIE3vE,SAJF,EAKE4vE,WALF,EAME7/F,aAAcA,MAgBxB2/F,gBAAwB,CACtB3/F,kBADsB,EAEtB4/F,gBAAiB,qBACjBz0F,KAHsB,GAItB8kB,UAJsB,EAKtB4vE,gBAAYz9F,GAGCuG,0BAAf,I,iCC1EM2J,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCytF,iBAAkB,CAChB5lE,WADgB,EAEhB,UAAW,CACT6lE,eADS,OAET1sF,gBAAiB2b,gBACf3c,eADmB,QAEnBA,iBAJO,cAOT,uBAAwB,CACtBgB,gBAAiB,gBAGrB8b,SAbgB,EAchBlc,UAAW,aAEb+sF,SAAU,CACRztF,QAAS,GAEXuL,MAAO,CACLpO,QADK,OAELqjD,cAAe,OAEjBktC,gBAAiB,CACf1tF,QAAS,OAIb,SAAS2tF,GAAW,GAA8C,IAA5C7gG,EAA4C,EAA5CA,MAAOywB,EAAqC,EAArCA,SAAU/R,EAA2B,EAA3BA,UAAWle,EAAgB,EAAhBA,aAC1CkU,EAAU5B,KADgD,EAEhCya,mBAFgC,yBAEzDkE,EAFyD,KAE/CsG,EAF+C,KAG1DzU,EAAUnB,sBAAhB,GACM2+E,EAAYtgG,EAAY,wCAE1B6N,yBAAeqQ,EAFnB,eAGMiD,EAAYtT,yBAAeqQ,EAAjC,QACMqD,EAAU1T,yBAAeqQ,EAA/B,WACMqiF,EACJp/E,IACCA,6BAAuCA,WAF1C,cAGM6B,EAAYF,0BACdA,0BADcA,GAAlB,GAIA,OACE,wBAAM6L,IAAE,GACN,yBAAKja,UAAWR,EAAQ+J,OACtB,wBAAS7J,MAAT,EAA2B4B,UAA3B,OAA4CwoB,WAAY,KACtD,wBACE9pB,UAAWR,EADb,iBAEE2iF,QACE,uBACEnhE,WAAY,CACV,0CAEFhhB,UAAWR,EAAQisF,WAGvBn/F,MACEhB,EAAe,uBAAH,cAXhB,EAaEqlB,QAAS7lB,EAAA,kBAAuB,SAAAkpC,GAAC,OAAIA,kBAAJ,KACjC9S,SAAU,kBAAMp2B,mBAAuB0e,EAA7B,UACV+R,SAAUA,GAAYswE,KAGzBv9E,SACC,wBACEtO,UAAWR,EADb,gBAEEkR,QAAS,SAAAkI,GACPiK,EAAYjK,EAAZiK,gBAEF1kB,MALF,YAME8c,cAAA,gCAEA,uBATH3M,OApBH,KAgCE,sBACEiO,SADF,EAEEF,gBAAiB,cACf1uB,IACAk1B,SAEF7I,KAAMe,QANR,GAOEuB,QAAS,WACPuG,SAEFvU,UAAWA,MAcrBq9E,gBAA0B,CACxBpwE,UADwB,EAExBjwB,aAAc,MAGD2I,0BAAf,IClHM2J,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCgnD,QAAS,CACPjlD,UAAW/B,UADJ,GAEPs1E,aAAct1E,kBAIlB,SAASguF,GAAS,GAQf,IAPDhhG,EAOC,EAPDA,MACA2L,EAMC,EANDA,KACAy0F,EAKC,EALDA,gBACA3vE,EAIC,EAJDA,SACA4vE,EAGC,EAHDA,WACArxE,EAEC,EAFDA,IACAxuB,EACC,EADDA,aAEMkU,EAAU5B,KAEZmuF,EAAYZ,EACZrgG,wBADsB,GAEtBA,YAFJ,GAIA2L,WAAa,SAAAu1F,GACXD,EAAYA,UAA4B,IAAxCA,OAGF,IAAME,EAAN,GACMt/E,EAAN,GACAje,gCAEW,YAAsB,uBAApBQ,EAAoB,KAAd2xF,EAAc,KACzBA,EAAJ,QACEoL,UAEAt/E,OAAgB,CAACzd,EAAjByd,OAIN,IAAMu/E,EAAkBphG,qBAAxB,GACMqhG,EAAkBryE,OAAxB,EAEA,OACE,oCACGqyE,EACC,oCACE,4BACE,sBACErhG,MADF,EAEE0e,UAFF,EAGEle,aAAcA,KAGlB,wBAAS0U,UAAWR,EAAQslD,WAVlC,KAaE,4BACGmnC,EAAA,eAAgD,SAAAziF,GAC/C,OACE,sBACE/I,IAAK+I,EADP,QAEE1e,MAFF,EAGE0e,UAHF,EAIE+R,SAAUA,QAKjB5O,EAAA,YAAsB,gBAAEzd,EAAF,2BACrB,sBACEuR,IADF,EAEE3V,MAFF,EAGE2L,KAAMA,SAAY,CAHpB,IAIEy0F,gBAJF,EAKE3vE,SALF,EAME4vE,WANF,EAOE7/F,aAAcA,QAiBxBwgG,gBAAwB,CACtBxgG,kBADsB,EAEtB4/F,gBAAiB,qBACjBz0F,KAHsB,GAItB8kB,UAJsB,EAKtB4vE,gBALsB,EAMtBrxE,KAAK,GAGQ7lB,0BAAf,IC/EM2J,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6X,KAAM,CACJmS,UADI,OAEJ9pB,QAASF,cAEXsuF,UAAW,CACThZ,aAAct1E,cAEhBuuF,IAAK,CACH7xE,MADG,QAEHziB,SAFG,SAGH8H,UAAW/B,UAHR,GAIHq5E,OAAQr5E,UAJL,GAKHud,MAAOvd,cAETwuF,iBAAkB,CAChBtuF,QAASF,UADO,GAEhB+B,UAAW/B,cAEbyuF,KAAM,CACJnZ,aAAct1E,kBAIZ0uF,GAAqBv4F,oBAAS,SAAAyG,GAAS,IACnCsf,EAAkCtf,EADC,KAC7B+xF,EAA4B/xF,EADC,UAClBgyF,EAAiBhyF,EADC,eAEmB+xF,GAFnB,GAEnCv9F,EAFmC,OAE7By9F,EAF6B,uBAEPC,EAFO,wBAG3C,OACE,wBACE3kC,kBADF,yBAEEC,mBAFF,+BAGEluC,KAAMA,GAEN,mDALF,KAME,4BACE,oCACG2yE,EACC,oCACE,4BADF,uCAIE,4BACG//F,OAAA,gBAAyC,mCAAE6T,EAAF,KAAOnD,EAAP,YACxC,wBAAUmD,IAAKA,GAAf,wBADwC,SAPlD,KAaE,4BApBN,qDAyBE,4BACE,uBACEiQ,QAAS,WACPg8E,KAEFvuF,MAAM,WALV,UASE,uBACE8B,QADF,YAEEyQ,QACE+7E,EACI,WACE,GAA2BG,IAC3BF,KAEF,aAENvuF,MAAM,WA7Cd,WAsDI0uF,GAAsB54F,oBAAS,SAAAyG,GAAS,IACpCsf,EAA2Ctf,EADP,KAC9B+xF,EAAqC/xF,EADP,UACnB0T,EAA0B1T,EADP,QACVgyF,EAAiBhyF,EADP,eAG1C+xF,GAH0C,GAEpC1B,EAFoC,iBAEpB77F,EAFoB,OAEdy9F,EAFc,uBAEQC,EAFR,wBAI5C,OACE,wBACE3kC,kBADF,yBAEEC,mBAFF,+BAGEluC,KAAMA,GAEN,oDALF,KAME,4BACG2yE,EACC,yEAEE,4BACG//F,OAAA,gBAAyC,mCAAE6T,EAAF,KAAOnD,EAAP,YACxC,wBAAUmD,IAAKA,GAAf,wBADwC,SALlD,KAWE,4BAjBJ,qDAqBE,4BACE,uBACEiQ,QAAS,WACPg8E,KAEFvuF,MAAM,WALV,UASE,uBACE8B,QADF,YAEEyQ,QACE+7E,EACI,WACE,GAA2BG,IAC3Bx+E,sBACAs+E,KAEF,aAENvuF,MAAM,WA1Cd,WAuRalK,2BApOf,SAAmC,GAAW,IAATnJ,EAAS,EAATA,MAAS,EACZutB,mBADY,yBACrCkE,EADqC,KAC3BsG,EAD2B,OAENxK,mBAFM,sBAErCy0E,EAFqC,KAExBC,EAFwB,OAGV10E,qBAHU,mBAGrCo0E,EAHqC,KAG1BC,EAH0B,KAItCltF,EAAU5B,KAEVwQ,EAAUnB,sBAAhB,GAUA,aACE4V,QAwBF,cACE,OAAK/3B,EAAL,YACaqO,yBAAe6zF,EAA5B,QACO99F,uBAA4BpE,aAAnC,eAkBF,cAA2D,IAAlBmiG,EAAkB,wDACnD/9F,EAAOiK,yBAAe4xF,EAA5B,QACMx8D,EAASngB,2BAAf,GACA,KAAY,wBACHw+E,EADG,KACoBD,EADpB,KAIN//F,yBAAJ,EACE8/F,EAAa,CACX3B,eADW,EAEX6B,sBAFW,EAGXD,qBAHW,EAIXz9F,KAJW,EAKX+9F,aAGFL,SAEOK,GACTP,EAAa,CAAEx9F,KAAF,EAAQ+9F,SAAR,EAAkBlC,mBAjFS,IAqFpC/5E,EAAkBlmB,EArFkB,cAsFtCQ,EAAe0lB,EAArB,GACA,MACE,YAGF,IAAMk8E,EACJpiG,wBAAwCsjB,EAAxCtjB,WADF,IAEEA,wBAAwCsjB,EAAxCtjB,yBAGF,OACE,yBACE2V,IAAK3V,OADP,GAEEkV,UAAWR,EAFb,KAGEyb,cAAY,+BAEXjK,WACC,wBACEhR,UAAWR,EADb,KAEElC,MAFF,EAGE4jB,SAlGR,cACE6rE,OAmGO/7E,EAAA,KAAkB,qBACjB,wBAAKvQ,IAAG,wBAAR,GAA8BnU,MAAO4C,QAZ7C,KAgBE,wBACE8Q,UAAWR,EADb,UAEElT,MAFF,gBAGEgR,MAAOxS,EAHT,WAIEgF,MAJF,EAKEkoD,WAAYk1C,EAAc,aAL5B,GAMEhsE,SAnGN,YACEp2B,gBAAoB8tB,SAApB9tB,QAmGIy6B,WAPF,EAQE0yB,WAAY,CACVE,aACE,wBAAgBpgD,SAAS,OACvB,wBAAYoG,MAAZ,YAA8BuS,QAAS5lB,EAAMqiG,iBAC3C,uBAFJ,WAQN,sBACEriG,MADF,EAEEogG,gBAFF,EAGE5/F,aAHF,EAIEwuB,KAAG,IAEL,4BACG1L,EAAA,oBAEG,SAAA28E,GAAc,OACZ5xF,yBAAe4xF,EAAf5xF,kBADY,KAFjB,KAKM,SAAA4xF,GACH,IAAM77F,EAAOiK,yBAAe4xF,EAA5B,QACMngG,EAAKmgG,EAAX,aACA,OACE,wBAAWx3D,KAAX,EAAe9yB,IAAK7V,GAClB,wBACEu3F,QACE,wBACExxE,QACEvC,gCACEA,EAAA,iCAEM,SAAA+8E,GAAU,OAAIA,SAAJ,KAEpBjqE,SAAU,kBA9G9B,YACE,IAAMksE,EAAsBh/E,0BAA5B,GAEEg/E,KACEA,EAAA,MACA,SAAAjC,GAAU,OACRA,SAAoBhyF,yBAAe4xF,EAD3B,WAIZsC,KAEAj/E,oBAmGgCk/E,CAAN,MAGdhhG,MAAO4C,IAET,wBACE+rB,cADF,oBAEEvK,QAAS,WACP28E,EAAgBtC,GAAhBsC,KAGF,uBAtBN,YA4BLj/E,EAAA,2BACC,oCACE,wBAAYnO,QAAQ,MADtB,eAEGmO,EAAA,gCAAkD,SAAA+8E,GAAU,OAC3D,wBACE1qF,IAAK0qF,EADP,KAEEnrF,UAAWR,EAFb,iBAGE2a,UAAW,GAEX,wBAAYla,QAAQ,MAAMkrF,EAL5B,MAME,sBACErgG,MADF,EAEEogG,gBAFF,EAGEC,WAHF,EAIE7/F,aAJF,EAKEwuB,KAAG,SA5Ff,KAmGE,wBAAK3b,MAAL,YAAuB6B,UAAWR,EAAlC,IAA+CkR,QAxLnD,YACEmS,EAAYjK,EAAZiK,iBAwLI,uBApGJ,OAsGE,wBACEj4B,GADF,cAEE2xB,SAFF,EAGEvC,KAAMe,QAHR,GAIEuB,QAASixE,GAET,wBAAU78E,QArLhB,WACE68E,IACA,IAAMC,EAASp/E,kCAAf,uBAIAA,kBAyKE,kBAOE,wBAAUsC,QA7KhB,WACE68E,IACA,IAAMC,EAASp/E,EAAA,4CAAsD,CACnEQ,KAAM9jB,OAAWF,KAEnBwjB,kBA2DA,cA+GE,sBACEq+E,UADF,EAEEC,aAFF,EAGE1yE,KAAMe,aAAuB0xE,EAH/B,SAIEr+E,QAASA,IAEX,sBACEq+E,UADF,EAEEC,aAFF,EAGE1yE,KAAMe,YAAsB0xE,EAH9B,SAIEr+E,QAASA,QC5XV,SAASq/E,GAAkBxB,GAChC,IAAMF,EAAY,IAAlB,IAkBA,OAhBAE,WAA4B,SAAAziF,GAC1B,IAAMmD,EAAa,OAAH,IAAG,CAAKxT,yBAAeqQ,EAAfrQ,aAAxB,IACIqQ,mBAAJ,iBACEmD,6BAIF,IADA,IAAI+gF,EAAJ,EACSl/F,EAAT,EAAgBA,EAAIme,EAApB,OAAuCne,IAAK,CAC1C,IAAMoe,EAAWD,EAAjB,GACK+gF,MAAL,IACEA,QAAwB,IAAxBA,KAEFA,EAAYA,MAAZA,GAEFA,MAAclkF,EAAdkkF,cAEF,EAGa,gBAAA/wF,GAAa,OAC1B,gDAC4C,CACxC/R,GADwC,aAExC6P,KAAMlR,gBAFkC,mCAGxCokG,UAAWpkG,YAAUA,QAHmB,SAIxCqkG,WAJwC,GAKxCh/E,KAAMrlB,sBACJoT,0BADIpT,iBANV,SAUW,SAAA2B,GAAI,MAAK,CAChB2iG,QADgB,YAEd3iG,UAEF4iG,eAJgB,YAKd5iG,mBAA8BA,gBAA9BA,KAEFiiG,gBAPgB,WAQdjiG,iBAEF6iG,cAVgB,YAWd7iG,oBArBN,OAwBS,SAAAA,GAAI,MAAK,CACd+gG,oBADc,cAEZ,OAAK/gG,EAAL,KAIoC,UAClC,SAAAse,GAKE,IAJ4BrQ,yBAAe,EAA3C,iBAIK60F,SAAL,GACE,SAEF,IARW,EASLz9E,EADW5T,cAA0BzR,OAA3C,MAC2B,kBACzB,SAAAskB,GAAW,OAAIA,EAAJ,QAVF,eAYWhG,EAZX,cAYX,2BAA0C,KAA/BrO,EAA+B,QACxC,GAAIoV,WAA4BpV,EAAhC,MACE,UAdO,8BAiBX,YArBF,IA2BJ8yF,mBA9Bc,YA8BmB,IAEzB97C,EADsBllC,sBADG,mBAEds4B,IAAjB,GACM/7B,EAAS,OAAG2oC,QAAH,IAAGA,OAAH,EAAGA,gBAAlB,SACM52C,EAAWoB,cAA0BzR,OAA3C,MACA,KAAe,sBACSse,EADT,mCACFrO,EADE,QAEX,GACEI,EAAA,mBACE,SAAAiU,GAAW,OAAIA,SAAqBrU,EAAzB,QAGb,SAAOqO,IANX,2BAA0C,8CAD7B,iCAcjB,oBACE,OAAOte,OAAYA,OAAZA,cAAP,IAGFgjG,8BArDc,YAsDZ,OAAKhjG,EAAL,KAG4BigG,EAA5B,OAEoC,QAClC,SAAA3hF,GACE,IADW,EAEL+G,EADW5T,cAA0BzR,OAA3C,MAC2B,kBACzB,SAAAskB,GAAW,OAAIA,EAAJ,QAHF,eAKWhG,EALX,cAKX,2BAA0C,KAA/BrO,EAA+B,QACxC,GAAIoV,WAA4BpV,EAAhC,MACE,UAPO,8BAUX,YAfF,IAqBJ4wF,UA5Ec,YA6EZ,IAAM39E,EAAUnB,sBAAhB,GACA,OAAOwgF,GACLviG,wBAAuCkjB,EADzC,UAKF+/E,oBAnFc,YAoFZ,OAAOV,GAAkBviG,gCAAzB,KAIFkjG,wBAxFc,gBAyFZ,IAAIC,EAAclD,EACdjgG,sBADwB,GAExBA,YAFJ,GAGAuL,WAAa,SAAA63F,GACXD,EAAcA,UAA6B,IAA3CA,OAEF,IAAIxlF,EAAJ,GAWA,OAVAwlF,WAAoB,cACdxN,EAAJ,QACEh4E,EAAOg4E,EAAPh4E,WAEAA,EAASjc,gBAEP1B,0BAA6BuL,SAAY,CAF3CoS,SAMJ,QC1JKtO,GAAekO,8BAAoB,kCAAzC,I,8GCaD7K,GAAYC,cAAW,iBAAO,CAClCsqE,MAAO,CACLxpE,SAAU,KAEZ4vF,WAAY,CACVvwF,QAAS,GAEXsoD,OAAQ,CACNnrD,QAAS,eACT6C,QAAS,EACT6X,UAAW,EACXlX,SAAU,OAwEC6vF,GApEOv6F,oBACpB,YAUM,IATJuxC,EASI,EATJA,UACAipD,EAQI,EARJA,yBACAC,EAOI,EAPJA,uBAQMlvF,EAAU5B,KAOhB,IAAM+wF,EAAOnpD,EAAU8E,QAAQG,WAAW31C,KAAI,SAACq9C,GAC7C,IAAMjjD,EAAOiK,yBAAeg5C,EAAU,QAChCtgC,EAAU1Y,yBAAeg5C,EAAU,WACzC,OACE,kBAACy8C,GAAA,EAAD,CAAUnuF,IAAKvR,GACb,kBAAC2/F,GAAA,EAAD,KAAY3/F,GACZ,kBAAC2/F,GAAA,EAAD,KAAYh9E,EAAUA,EAAQ5jB,WAAa,IAC3C,kBAAC4gG,GAAA,EAAD,CAAW7uF,UAAWR,EAAQ+uF,YAC5B,kBAAC,KAAD,CACEtzE,cAAA,UAAgB/rB,EAAhB,SACA8Q,UAAWR,EAAQ8mD,OACnB51C,QAAS,WACP+9E,GAAyB,GACzBC,EAAuBv8C,KAGzB,kBAAC,KAAD,CAAYh0C,MAAM,aAEpB,kBAAC,KAAD,CACE8c,cAAA,UAAgB/rB,EAAhB,WACA8Q,UAAWR,EAAQ8mD,OACnB51C,QAAS,YA1BnB,SAAwBxhB,GACtBs2C,EAAU8E,QAAQwkD,mBAAmB5/F,GA0B3B6/F,CAAe7/F,KAGjB,kBAAC,KAAD,CAAYiP,MAAM,gBAO5B,OACE,kBAAC6wF,GAAA,EAAD,CAAgBxxE,UAAWzb,MACzB,kBAACktF,GAAA,EAAD,KACE,kBAACC,GAAA,EAAD,KACE,kBAACN,GAAA,EAAD,KACE,kBAACC,GAAA,EAAD,aACA,kBAACA,GAAA,EAAD,gBACA,kBAACA,GAAA,EAAD,kBAGJ,kBAACM,GAAA,EAAD,KAAYR,Q,WCnFhB/wF,GAAYC,cAAW,SAACC,GAAD,OAC3BsxF,aAAa,CACXz5E,KAAM,CACJiF,SAAU,EACV1b,SAAU,SACVlB,QAASF,EAAMG,QAAQ,EAAG,IAE5Bub,MAAO,CACL5a,SAAU,IACVuV,OAAQ,GAAF,OAAKrW,EAAMG,QAAQ,GAAnB,WACND,QAASF,EAAMG,QAAQ,IAEzBoxF,aAAc,CACZl7E,OAAQ,qBAEVovE,aAAc,CACZC,KAAM,OACNrvE,OAAQ,GAAF,OAAKrW,EAAMG,QAAQ,GAAnB,WACND,QAASF,EAAMG,QAAQ,GACvBiB,SAAU,aAKVowF,GAAkBr7F,oBACtB,YAQM,IAPJs7F,EAOI,EAPJA,iBACAC,EAMI,EANJA,oBACAxoD,EAKI,EALJA,aAMA,OACE,kBAAC,KAAD,CACE1pC,MAAOiyF,EACPjjG,MAAM,OACN86D,QAAM,EACNpP,WAAW,yBACXzyB,WAAS,EACTrE,SAAU,SAAAtI,GACR42E,EAAoB52E,EAAMuI,OAAO7jB,SAGlC0pC,EAAalyC,KAAI,SAAAsI,GAAG,OACnB,kBAAC,KAAD,CAAUqD,IAAKrD,EAAKE,MAAOF,GACxBA,UAQPqyF,GAAex7F,oBACnB,YAoBM,IAnBJs7F,EAmBI,EAnBJA,iBACAhkF,EAkBI,EAlBJA,cACAmkF,EAiBI,EAjBJA,iBACAlkF,EAgBI,EAhBJA,YACAmkF,EAeI,EAfJA,eACAlkF,EAcI,EAdJA,YACAmkF,EAaI,EAbJA,eACAlkF,EAYI,EAZJA,eACAmkF,EAWI,EAXJA,kBAYA,MACuB,wBAArBN,GACqB,sBAArBA,EAGE,kBAAC,KAAD,CAAM3qE,WAAS,EAAC3mB,QAAS,GACvB,kBAAC,KAAD,CAAM6mB,MAAI,GACR,kBAAC,GAAD,CACE51B,KAAK,gBACLyD,SAAU4Y,EACV+Z,YAAa,SAAAwqE,GAAG,OAAIJ,EAAiBI,OAGzC,kBAAC,KAAD,CAAMhrE,MAAI,GACR,kBAAC,GAAD,CACE51B,KAAK,cACLyD,SAAU6Y,EACV8Z,YAAa,SAAAwqE,GAAG,OAAIH,EAAeG,OAGjB,sBAArBP,EACC,kBAAC,KAAD,CAAMzqE,MAAI,GACR,kBAAC,GAAD,CACE51B,KAAK,cACLyD,SAAU8Y,EACV6Z,YAAa,SAAAwqE,GAAG,OAAIF,EAAeE,OAGrC,MAKe,kBAArBP,EAEA,kBAAC,GAAD,CACErgG,KAAK,iBACLyD,SAAU+Y,EACV4Z,YAAa,SAAAwqE,GAAG,OAAID,EAAkBC,MAKrC,QAyHIC,GArHS97F,oBACtB,YAOM,IANJuxC,EAMI,EANJA,UACAwqD,EAKI,EALJA,YAMMxwF,EAAU5B,KAEVopC,EAAe,CACnB,sBACA,oBACA,iBANE,EASoC3uB,mBAAS,IAT7C,mBASG/sB,EATH,KASiB++F,EATjB,OAU4ChyE,mBAAS2uB,EAAa,IAVlE,mBAUGuoD,EAVH,KAUqBC,EAVrB,OAWsCn3E,mBAAS,CAAE3sB,IAAK,KAXtD,mBAWG6f,EAXH,KAWkBmkF,EAXlB,OAYkCr3E,mBAAS,CAAE3sB,IAAK,KAZlD,mBAYG8f,EAZH,KAYgBmkF,EAZhB,OAakCt3E,mBAAS,CAAE3sB,IAAK,KAblD,mBAaG+f,EAbH,KAagBmkF,EAbhB,OAcwCv3E,mBAAS,CAAE3sB,IAAK,KAdxD,mBAcGggB,EAdH,KAcmBmkF,EAdnB,KAiEJ,OACE,yBAAK7vF,UAAWR,EAAQmW,MACtB,kBAAC5T,GAAA,EAAD,CAAO/B,UAAWR,EAAQga,OACxB,kBAAC,KAAD,CACE5uB,GAAG,gBACHo2B,WAAY,CAAE,cAAe,iBAC7B10B,MAAM,gBACN2T,QAAQ,WACR3C,MAAOhS,EACP41B,SAAU,SAAAtI,GAAK,OAAIyxE,EAAgBzxE,EAAMuI,OAAO7jB,UAElD,kBAACgyF,GAAD,CACEC,iBAAkBA,EAClBC,oBAAqBA,EACrBxoD,aAAcA,IAEhB,yBAAKhnC,UAAWR,EAAQ+jF,cACtB,kBAACkM,GAAD,CACEF,iBAAkBA,EAClBhkF,cAAeA,EACfmkF,iBAAkBA,EAClBlkF,YAAaA,EACbmkF,eAAgBA,EAChBlkF,YAAaA,EACbmkF,eAAgBA,EAChBlkF,eAAgBA,EAChBmkF,kBAAmBA,MAIzB,kBAAC,IAAD,CACE7vF,UAAWR,EAAQ6vF,aACnBpvF,QAAQ,YACR9B,MAAM,YACN2yC,UAAW,kBAAC,KAAD,MACXpgC,QApFN,WAMI,IAAIi7C,EALe,KAAjBrgE,EACFk6C,EAAUp3B,QAAQ4xC,OAAO,4CAEzBgwC,GAAY,GAGa,wBAArBT,EACF5jC,EAAc,CACZz8D,KAAM5D,EACNk2D,SAAU,CACRvwC,QAAS,CACPxW,KAAM,sBACN8Q,gBACAC,iBAIwB,sBAArB+jF,EACT5jC,EAAc,CACZz8D,KAAM5D,EACNk2D,SAAU,CACRvwC,QAAS,CACPxW,KAAM,oBACN8Q,gBACAC,cACAC,iBAIwB,kBAArB8jF,IACT5jC,EAAc,CACZz8D,KAAM5D,EACNk2D,SAAU,CACRvwC,QAAS,CACPxW,KAAM,gBACNiR,qBAKR85B,EAAU8E,QAAQ2lD,gBAAgBtkC,GAClCnmB,EAAUp3B,QAAQ4xC,OAAlB,6BACwB10D,EADxB,0BAEE,cAmCF,2BC9NO4kG,GAXQj8F,oBACrB,YAKM,IAJJk+C,EAII,EAJJA,SAKA,OAAO,kBAAC,GAAD,CAAqBrnD,MAAO,CAAEq2B,OAAQgxB,QCK3Cv0C,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCqyF,SAAU,CACRhyF,MAAO,OACPW,gBAAiBhB,EAAMQ,QAAQyU,QAAQC,KACvC8U,UAAW,UAEbsoE,cAAe,CACbxsF,MAAO,KAETysF,WAAY,CACVlyF,MAAO,OACPpG,SAAU,WACVojB,KAAMrd,EAAMG,QAAQ,GACpB6b,IAAKhc,EAAMG,QAAQ,QA6GRqyF,OAzGSr8F,oBACtB,YASM,IARJuxC,EAQI,EARJA,UACAxrB,EAOI,EAPJA,KACAsC,EAMI,EANJA,QAOM9c,EAAU5B,KADZ,EAE8Bya,oBAAS,GAFvC,mBAEGk4E,EAFH,KAEeP,EAFf,OAGsD33E,oBAAS,GAH/D,mBAGGm4E,EAHH,KAG0B/B,EAH1B,OAIkDp2E,qBAJlD,mBAIGo4E,EAJH,KAIwB/B,EAJxB,KAMEgC,GAAqBH,IAAeC,EAE1C,OACE,kBAACnmE,GAAA,EAAD,CAAQrQ,KAAMA,GACZ,kBAACsQ,GAAA,EAAD,CAAatqB,UAAWR,EAAQ2wF,UAC7BO,EAAoB,mBAAqB,KACzCH,EACC,oCACE,kBAAC,KAAD,CACEh5E,aAAW,OACXvX,UAAWR,EAAQ6wF,WACnB3/E,QAAS,kBAAMs/E,GAAY,KAE3B,kBAAC,KAAD,OANJ,oBAUE,KACHQ,EACC,oCACE,kBAAC,KAAD,CACEj5E,aAAW,OACXvX,UAAWR,EAAQ6wF,WACnB3/E,QAAS,kBAAM+9E,GAAyB,KAExC,kBAAC,KAAD,OAyDhB,SAA4Bt8C,GAC1B,QAAiBzkD,IAAbykD,EACF,OAAOA,EAASjjD,KAElB,OAAO,KA3DMyhG,CAAmBF,IAEpB,MAEN,kBAAClmE,GAAA,EAAD,KACE,yBAAKvqB,UAAWR,EAAQ4wF,eACrBM,EACC,kBAAC,GAAD,CACElrD,UAAWA,EACXipD,yBAA0BA,EAC1BC,uBAAwBA,IAExB,KACH8B,EACC,kBAAC,GAAD,CAAgBr+C,SAAUs+C,IACxB,KACHF,EACC,kBAAC,GAAD,CACE/qD,UAAWA,EACXwqD,YAAaA,IAEb,OAGR,kBAACvlE,GAAA,EAAD,KACGimE,EACC,oCACE,kBAAC,IAAD,CACEvyF,MAAM,YACN8B,QAAQ,YACRyQ,QAAS,WACP4L,GAAQ,KAJZ,UASA,kBAAC,IAAD,CACErc,QAAQ,YACR9B,MAAM,YACN2yC,UAAW,kBAAC,KAAD,MACXpgC,QAAS,WACPs/E,GAAY,KALhB,qBAWA,U,sBCxGRpyF,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6X,KAAM,CACJxB,OAAQrW,EAAMG,QAAQ,IAExB2jB,QAAS,CACP5jB,QAASF,EAAMG,QAAQ,IAEzBkyF,SAAU,CACRhyF,MAAO,OACPW,gBAAiBhB,EAAMQ,QAAQyU,QAAQC,KACvC8U,UAAW,UAEbsoE,cAAe,CACbxsF,MAAO,KAETgtF,YAAa,CACXn0C,eAAgB,SAChB22B,aAAc,WAIZyd,GAAiB58F,oBACrB,YASM,IARJma,EAQI,EARJA,QACA0iF,EAOI,EAPJA,gBACAC,EAMI,EANJA,YAOMvxF,EAAU5B,KAEhB,OACE,kBAACmE,GAAA,EAAD,CAAO/B,UAAWR,EAAQmW,MACxB,kBAACq7E,GAAA,EAAD,CAAMhnE,UAAW,kBAACvM,GAAA,EAAD,gCACf,kBAACwzE,GAAA,EAAD,KACE,kBAACtzE,GAAA,EAAD,KACE,kBAAC,KAAD,CACEhN,QAASvC,EAAQlf,OAAS4hG,EAC1B5vE,SAAU,kBAAM6vE,EAAY3iF,OAGhC,kBAACmQ,GAAA,EAAD,CAAcxL,QAAS3E,EAAQlf,aA0H5BgiG,GAlHWj9F,oBACxB,YAWM,IAVJuxC,EAUI,EAVJA,UACAxrB,EASI,EATJA,KACAsC,EAQI,EARJA,QACA60E,EAOI,EAPJA,eAQM3xF,EAAU5B,KACRwQ,EAAYo3B,EAAZp3B,QAFJ,EAG0CiK,mBAAS84E,GAHnD,mBAGGL,EAHH,KAGoBM,EAHpB,KAMJ,SAASL,EAAYM,GACnBD,EAAmBC,EAAgBniG,MACnCs2C,EAAU8E,QAAQgnD,sBAAsBD,GACxCjjF,EAAQ4xC,OAAR,iCAC4BqxC,EAAgBniG,MAC1C,WAIJ,OACE,kBAACm7B,GAAA,EAAD,CAAQrQ,KAAMA,GACZ,kBAACsQ,GAAA,EAAD,CAAatqB,UAAWR,EAAQ2wF,UAAhC,uBAGA,kBAAC5lE,GAAA,EAAD,KACE,kBAAC,KAAD,CAAMvqB,UAAWR,EAAQoxF,YAAahsE,WAAS,GAC7C,kBAAC,KAAD,CAAME,MAAI,GACR,kBAAC,IAAD,CACE3mB,MAAM,YACN8B,QAAQ,YACRyQ,QAAS,WACP0gF,EAAmB,eACnB5rD,EAAU8E,QAAQgnD,sBAAsB,CACtCpiG,KAAM,gBAERkf,EAAQ4xC,OAAO,wBAAyB,aAR5C,2BAgBJ,kBAAC6wC,GAAD,CACEziF,QAASA,EACT0iF,gBAAiBA,EACjBC,YAAaA,IAEf,kBAAChvF,GAAA,EAAD,CAAO/B,UAAWR,EAAQmW,MACxB,kBAACq7E,GAAA,EAAD,CAAMhnE,UAAW,kBAACvM,GAAA,EAAD,wBACdrP,EAAQmjF,cAAc3iG,OACrBwf,EAAQmjF,cAAcz8F,KAEpB,SAACu8F,GAAyB,MACDA,EAAf9qF,aADgB,MACR,GADQ,EAElBirF,EAAcjrF,EAEjBzR,KAAI,SAAC8Z,GAAD,OAAeA,EAAK/F,OAAOja,UAC/BoU,QAAO,SAACtW,EAAWC,GAAZ,OAA0BD,EAAIC,IAAG,GAC3C,OAAI0kG,EAAgBniG,OAASkf,EAAQlf,KAEjC,kBAAC+hG,GAAA,EAAD,CAAUxwF,IAAK4wF,EAAgBniG,MAC7B,kBAACyuB,GAAA,EAAD,KACE,kBAAC,KAAD,CACEhN,QAAS0gF,EAAgBniG,OAAS4hG,EAClC5vE,SAAU,kBAAM6vE,EAAYM,OAGhC,kBAAC9yE,GAAA,EAAD,CACExL,QAASs+E,EAAgBniG,KACzB+jB,UAAS,UAAK1M,EAAM3X,OAAX,YAAqB6iG,KAC5B,OACAlrF,EAAM3X,QAFC,aAGH4iG,EAHG,+CAIDC,KAAU,QAASD,OAK5B,QAIX,kBAAC,KAAD,CAAYxxF,UAAWR,EAAQoiB,SAA/B,8BAOR,kBAAC6I,GAAA,EAAD,KACE,kBAAC,IAAD,CACEtsB,MAAM,YACN8B,QAAQ,YACRyQ,QAAS,WACP4L,GAAQ,KAJZ,e,+MC5IRptB,KAAO,uB,EAEPwG,QAAU,CACR46F,mBACAY,sB,sDAGMv0F,GACNA,EAAc+0F,mBACZ,kBACE,IAAI91F,EAAe,CACjB1M,KAAM,yBACNqL,aAAco3F,GACd12F,WAAY22F,GAAiBj1F,GAC7Bd,YAAa,iBACbC,YAAa,kDACbtP,IAAK,mEAIXmQ,EAAcgyD,eAAc,WAC1B,OAAO,IAAIlzD,EAAW,CACpBvM,KAAM,kCACNwM,QAAS,mBACTnB,aAAcs3F,GACd52F,WAAY62F,GAA2Cn1F,GACvDrC,eAAgBy3F,QAIpBp1F,EAAcgyD,eAAc,WAC1B,OAAO,IAAIlzD,EAAW,CACpBvM,KAAM,iBACNwM,QAAS,cACTnB,aAAcy3F,GACd/2F,WAAYg3F,GAA0Bt1F,GACtCrC,eAAgB43F,QAIpBv1F,EAAcgyD,eAAc,WAC1B,OAAO,IAAIlzD,EAAW,CACpBvM,KAAM,sBACNwM,QAAS,mBACTnB,aAAc43F,GACdl3F,WAAYm3F,GACZ93F,eAAgB+3F,U,gCAKZ11F,GACJoyD,iCAAsBpyD,EAAc6oC,aACtC7oC,EAAc6oC,UAAU8sD,aAAa,OAAQ,CAC3ChmG,MAAO,aACPskB,KAAM2hF,KACN7hF,QAAS,SAACtC,GACR,GAA6B,IAAzBA,EAAQ7H,MAAM3X,OAChBwf,EAAQ4xC,OAAO,gDACV,GAAI5xC,EAAQ7H,MAAM3X,QAAU,EAAG,CACpC,IAAM4+F,EAASp/E,EAAQymC,UACrB,iBACA,iBACA,CAAEjmC,KAAMR,EAAQ7H,MAAM,GAAG3b,KAE3BwjB,EAAQ0mC,WAAW04C,GACfp/E,EAAQ7H,MAAM3X,OAAS,GACzBwf,EAAQ4xC,OAAR,iMAORrjD,EAAc6oC,UAAU8sD,aAAa,OAAQ,CAC3ChmG,MAAO,kBACPskB,KAAM4hF,KACN9hF,QAAS,SAACtC,GACR,IAAMo/E,EAASp/E,EAAQymC,UACrB,sBACA,uBAEFzmC,EAAQ0mC,WAAW04C,W,GAnFAl3D,I,sBCVvBm8D,G,kDAOJ,WAAY/3F,GAAY,kCACtB,cAAMA,IACDszC,MAAQ,CAAE0kD,UAAU,GAFH,E,8DAYN5iG,EAAY6iG,GAE5B9iG,QAAQC,MAAMA,EAAO6iG,K,+BAGd,MACqBh/F,KAAKq6C,MAAzB0kD,EADD,EACCA,SAAU5iG,EADX,EACWA,MAClB,OAAI4iG,IAAQ,OAAI5iG,QAAJ,IAAIA,OAAJ,EAAIA,EAAO8xB,SACd,yBAAKhiB,MAAO,CAAEzB,MAAO,QAAUrO,EAAM8xB,SAGzBjuB,KAAK+G,MAAlB+E,Y,gDAjBsB3P,GAE9B,MAAO,CAAE4iG,UAAU,EAAM5iG,a,GAfK8iG,aA4GnB3+F,2BAzEf,SAAmCyG,GACjC,IAAMy0C,EAAmB12B,iBAAuB,MAC1C22B,EAAW32B,kBAAO,GAEhB3tB,EAAU4P,EAAV5P,MACFsjB,EAAUnB,sBAAWniB,GACrBgT,EAAQ4Y,GAAmBvJ,kBAAQiB,EAAS,UAsDlD,OApDAsK,qBAAU,WACR,IAAM22B,EAAUF,EAAiBr2B,QAC3Bw2B,EAAaF,EAASt2B,QA2C5B,OA1CA,WAAqB,IAEjBtlB,EAIE1I,EAJF0I,KACA6J,EAGEvS,EAHFuS,KACAgN,EAEEvf,EAFFuf,YACoBmlC,EAClB1kD,EADF2kD,mBAEEJ,GAAWvkD,EAAMykD,SACfD,GAAcD,GAChBK,iCAAuBL,GAEzBA,EAAQ/D,UAAYjuC,EASpBsyC,qBACE,WACOtsB,kBAAQv4B,KAGb+kD,kBACE,kBAACtf,GAAA,EAAD,CAAezyB,MAAOA,GACpB,kBAAC,GAAD,KACE,kBAAC0xC,EAAD,iBAAwBh8C,EAAU6W,MAGtCglC,GAEFD,EAASt2B,SAAU,KAErB,CAAE4U,QAAS,OAKjBoiB,GAEO,WACDT,GAAWC,GACbI,iCAAuBL,MAG1B,CAACvkD,EAAOgT,IAGT,yBACE4d,IAAKyzB,EACLY,iBAAgBjlD,EAAMuS,KAAKzO,OAC3BoR,UAAU,qBC/GVpC,GAAYC,aAAW,CAC3BmyC,QAAS,CACPz5B,YAAa,QACbzX,gBAAiB,UACjBsuC,gBACE,sHACFx1B,OAAQ,OACRhU,MAAO,OACPkkB,UAAW,UAEbh4B,MAAO,CACLqL,QAAS,QACTgD,MAAO,MACPyF,MAAO,OACPivF,SAAU,SACVlzE,WAAY,UAEdswB,aAAc,CACZ5xC,WAAY,UACZL,QAAS,QAEXkyC,WAAY,CACV7xC,WAAY,UACZL,QAAS,OACTG,MAAO,SAIX,SAASoyC,KAAiB,MAEEl4B,oBAAS,GAFX,mBAEjBsV,EAFiB,KAEVC,EAFU,KAGlBpuB,EAAU5B,KAMhB,OALA8a,qBAAU,WACR,IAAMgV,EAAUhR,YAAW,kBAAMkR,GAAS,KAAO,KACjD,OAAO,kBAAMjR,aAAa+Q,MACzB,IAEIC,EACL,yBAAK1S,cAAY,kBAAkBjb,UAAWR,EAAQwwC,SAAtD,iBAEE,kBAACuO,GAAA,EAAD,OAEA,KAGN,SAAS9N,GAAT,GAAgE,IAAxCqB,EAAwC,EAAxCA,YAChBtyC,EAAU5B,KAChB,OAAO,yBAAKoC,UAAWR,EAAQywC,cAAe6B,GAMhD,SAASnB,GAAT,GAAiD,IAA3B7gD,EAA2B,EAA3BA,MACd0P,EAAU5B,KAChB,OAAO,yBAAKoC,UAAWR,EAAQ0wC,YAAapgD,EAAM8xB,SAIpD,IAcemvB,GAdwB98C,oBAAS,YAA+B,IAA5BnJ,EAA4B,EAA5BA,MACjD,OAAIA,EAAMgF,MACD,kBAAC,GAAD,CAAYA,MAAOhF,EAAMgF,MAAOmrB,cAAY,kBAEjDnwB,EAAM82B,QACD,kBAAC,GAAD,CAAckwB,YAAahnD,EAAM82B,UAErC92B,EAAMykD,OAIJ,kBAAC,GAAD,CAA2BzkD,MAAOA,IAHhC,kBAAC,GAAD,SCpELgoG,GAGD,SAAAp4F,GAAS,IACJ5P,EAAoB4P,EAApB5P,MAAO2U,EAAa/E,EAAb+E,SADH,EAEyB3U,EAAM0I,MAAQ,GAFvC,IAEJg6B,eAFI,MAEM,EAFN,MAESC,eAFT,MAEmB,EAFnB,EAIN7e,EAAOC,6BAAkB/jB,GACzBgvB,EAAMlL,EAAKmkF,MAAM9vF,SAAWwqB,EAC5BtS,IAASvM,EAAKokF,MAAM/vF,SAAWuqB,GACrC,OACE,yBAAK5tB,MAAO,CAAE7H,SAAU,aACtB,yBACE6H,MAAO,CACL7H,SAAU,WACV+hB,MACAqB,SAGF,kBAACrwB,EAAMmoG,gBAAoBv4F,GAC1B+E,KAUTqzF,GAAelrE,aAAe,CAC5BnoB,SAAU,MAEGxL,0BAAS6+F,ICFjB,SAAS98C,GAAkBz7C,GAChC,OAAOhR,QACJ8B,QACC,iBACA0hB,GACAxjB,QACGuB,MAAM,CACL2P,KAAMlR,QAAMqkB,QAAQ,kBACpBnE,cAAeoE,iCAAuBtT,KAEvCyL,UAAS,iBAAO,CACfgrC,sBAAkBtjD,EAClB6hD,QAAQ,EACR/7C,UAAM9F,EACN2P,KAAM,GACNukB,aAASl0B,EACT+hD,wBAAoB/hD,EACpBulG,gBAAkBliD,QAGvBxqC,OAAM,SAAArb,GAAI,MAAK,CACd,uBACE,OAAOiiB,kBAAQjiB,EAAM,YAAYuP,MAEnC,kBACE,kCACK0P,GAAqBjf,IAD1B,IAEEmiB,aAAcniB,SAInBD,SAAQ,SAAAC,GACP,IAAI8lD,EAEJ,MAAO,CACLloC,YADK,WAEHmoC,iCACE/lD,EACAgmD,GACAC,GACA,CACEjiD,KAAM,GAAF,OAAKhE,EAAKuP,KAAV,YAAkBvP,EAAKN,GAAvB,cACJwmD,MAAO,IACPE,iBAAiB,GAEnB39C,KAAK49C,WACL59C,KAAK69C,YACL79C,KAAK6Z,WAIT+jC,WAjBK,SAiBMG,GACTxmD,EAAKqkD,QAAS,EACdrkD,EAAK02B,aAAUl0B,EACfxC,EAAKmS,KAAO,GACZnS,EAAKsI,UAAO9F,EACZxC,EAAK4E,WAAQpC,EACbxC,EAAKukD,wBAAqB/hD,EAC1BsjD,EAAmBU,GAErBG,WA1BK,SA0BMC,GACLd,IAAqBA,EAAiBh/C,OAAO2/C,SAC/CX,EAAiBY,QAEnB1mD,EAAKqkD,QAAS,EACdrkD,EAAK02B,QAAUkwB,EACf5mD,EAAKmS,KAAO,GACZnS,EAAKsI,UAAO9F,EACZxC,EAAK4E,WAAQpC,EACbxC,EAAKukD,wBAAqB/hD,EAC1BsjD,OAAmBtjD,GAErB8jD,YAtCK,SAsCOl+C,GAIT,IACOE,EAAmCF,EAAnCE,KAAM6J,EAA6B/J,EAA7B+J,KAAMoyC,EAAuBn8C,EAAvBm8C,mBACpBvkD,EAAKqkD,QAAS,EACdrkD,EAAK02B,aAAUl0B,EACfxC,EAAKmS,KAAOA,EACZnS,EAAKsI,KAAOA,EACZtI,EAAK4E,WAAQpC,EACbxC,EAAKukD,mBAAqBA,EAC1BuB,OAAmBtjD,GAErB8f,SApDK,SAoDI1d,GACPD,QAAQC,MAAMA,GACVkhD,IAAqBA,EAAiBh/C,OAAO2/C,SAC/CX,EAAiBY,QAGnB1mD,EAAKqkD,QAAS,EACdrkD,EAAK02B,aAAUl0B,EACfxC,EAAKmS,KAAO,GACZnS,EAAKsI,UAAO9F,EACZxC,EAAK4E,MAAQA,EACb5E,EAAKukD,wBAAqB/hD,EAC1BsjD,OAAmBtjD,OAM7B,SAASwjD,GAAgBhmD,GAA2B,IAC1C8jC,EAAe/hB,sBAAW/hB,GAA1B8jC,WACF7zB,EAAUjQ,EAERmf,EAA8BlP,EAA9BkP,YAAaq7B,EAAiBvqC,EAAjBuqC,aAKrBvsC,yBAAejO,EAAKue,eAT8B,IAW1C0E,EAAkBjjB,EAAlBijB,cACFxE,EAASkF,6BAAkB3jB,GACjCwI,sBAAYiW,GAbsC,IAc1CogD,EAAwDpgD,EAAxDogD,UAAWmpC,EAA6CvpF,EAA7CupF,WAAYC,EAAiCxpF,EAAjCwpF,WAAYC,EAAqBzpF,EAArBypF,QAASC,EAAY1pF,EAAZ0pF,QAEpD,MAAO,CACL3tD,eACA1W,aACA3kB,cACAglB,WAAY,CACVlhB,gBACAu3B,aAAcA,EAAax2C,KAC3Bmb,YAAa,2BACRA,GADM,IAETuE,KAAMlb,sBAAYiW,GAClB/F,MAAOmmD,EACPnyC,OAAQs7E,EACRC,aACAC,UACAC,YAEFnkE,UAAWrlB,GAAgB3e,GAC3BwiC,QAAS,M,SAKAyjB,G,iFAAf,WACEz2C,GADF,yBAAAhO,EAAA,yDAGOgO,EAHP,sBAIU,IAAI9J,MAAM,+BAJpB,cAOU80C,EAAyChrC,EAAzCgrC,aAAc1W,EAA2Bt0B,EAA3Bs0B,WAAYK,EAAe30B,EAAf20B,WAPpC,SASmCqW,EAAqB4M,eACpDtjB,EACAK,GAXJ,uBASUhyB,EATV,EASUA,KAAS7J,EATnB,2CAcS,CAAE6J,OAAM7J,OAAMi8C,mBAAoB/J,EAAaprC,iBAdxD,4C,sBC1KerG,2BAJf,SAA0ByG,GACxB,OAAO,kBAAC,GAAsBA,MCHjB+N,iCACb,kBACA,CACE6qF,SAAU,CACR74F,KAAM,aACNqB,YAAa,eACbhR,MAAOvB,QAAMo/D,YAAY,YAAa,CAAC,WACvCjgD,aAAc,UAEhBvK,MAAO,CACL1D,KAAM,QACNqB,YAAa,yCACb4M,aAAc,QACd+jC,kBAAmB,CAAC,YAEtBo4B,UAAW,CACTpqE,KAAM,SACNqB,YAAa,iCACb4M,aAAc,MAGlB,CAAEC,iBAAiB,ICAA4qF,G,oLAcGjgG,GASpB,OARAA,EAAK+W,YAAL,2BACK/W,EAAK+W,aADV,IAGEgkB,SAAU/6B,EAAK+6B,SAEfhhB,aAAc,KAGT/Z,I,iDAIkBi7B,EAA2Bj7B,GAGpD,OADAi7B,EAAOF,SAAW/6B,EAAK+6B,SAChBE,I,8CAQej7B,GACtB,GAAIK,KAAK4G,aAAc,CACrB,IAAMvB,EAASrF,KAAK4G,aAAajF,OAAOhC,EAAK0F,QAAU,IACvD1F,EAAK0F,OAASA,K,kIAiBGg2B,EAAiB17B,G,gFAC9BsJ,EAAiBjJ,KAAKs7B,sBAAsB37B,G,SAE7B07B,EAAWnhC,KAC9ByF,EAAK47B,UACL,oBACAtyB,G,cAHI2xB,E,OAMN56B,KAAKw7B,2BAA2BZ,EAAQj7B,G,kBACjCi7B,G,oJAQYc,EAAwBjvB,GAI3C,OAHoB,IAAIiS,GAAwB,CAC9CC,QAAS+c,EAAW/c,UAEH0d,OAAO5vB,EAASivB,K,8EAIhB/7B,G,8EACnBc,4BAAiBd,EAAKtB,QACtB2B,KAAKw8B,wBAAwB78B,GAC7Bc,4BAAiBd,EAAKtB,Q,SAEA2B,KAAKy8B,OAAO98B,G,cAA5B+8B,E,OACNj8B,4BAAiBd,EAAKtB,QACtBq+B,EAAQhzB,KAAOizB,0BAAeD,EAAQ11B,gBAC/B01B,EAAQ11B,QAKfhH,KAAK68B,2B,kBACEH,G,mLAGShB,G,yFACRC,EAAwBD,EAAxBC,YAAat9B,EAAWq9B,EAAXr9B,OAEjB2C,EAAU,IAGdA,EAAU06B,EAAW16B,UAEc,IAAnBA,EAAQ/F,O,uBACtBiB,QAAQ4H,KAAK,+C,kBACN,I,cAGH83B,EAAiB56B,EAAQG,KAAI,SAAAvG,GAGjC,IAAMihC,EAAgB,eAAKjhC,GAO3B,OANIihC,EAAcrlC,QAChBqlC,EAAcrlC,MAAQkO,KAAKsN,MAAM6pB,EAAcrlC,QAE7CqlC,EAAcnlC,MAChBmlC,EAAcnlC,IAAMgO,KAAKsN,MAAM6pB,EAAcnlC,MAExCmlC,KAIHC,EAAoBH,EAAYK,6BACpCJ,EACA,CACEv9B,W,kBAIGy9B,EACJn7B,KAECmN,cAAO,SAAArB,GAAO,OAAI,EAAKyvB,qBAAqBR,EAAYjvB,MACxD02C,gBAED/mB,a,8IAGiBf,EAAiB17B,GACrC,IAAMsJ,EAAiBjJ,KAAKs7B,sBAAsB37B,GAElD,OAAO07B,EAAWnhC,KAAKyF,EAAK47B,UAAW,gBAAiBtyB,K,sDAnJDxC,GCI3D,SAASo5F,GAAqBp2F,GAC5B,MAAoB,GAAbA,EAAIxO,OAAe,GAOrB,IAAM6kG,GAAgB3tF,GAAW4tF,QAAO,SAAAxoG,GAC7C,IAAM0zD,EAAcmV,aAAW4/B,IAAI,GACnC,MAAO,CACLptF,MAAO,CACL,8BACE,OAAO,GAET,wBACE,OAAO,GAET,oBACE,OAAO9C,GAAuBvY,GAAM,GAAO,IAE7C,kBACE,OAAO0zD,EAAYl0D,QAGvBO,QAAS,CACPi7D,eADO,SACQ7+C,GACbu3C,EAAYniD,IAAI4K,SAQlBusF,GAAeH,GAAcC,QAAO,SAAAxoG,GAAI,MAAK,CACjDqb,MAAO,CACL,YACE,OAAOqD,oBAAU1e,GAAM6+D,gBAKvB8pC,GAAeJ,GAAcC,QAAO,SAAAxoG,GAAI,MAAK,CACjDqb,MAAO,CACL,YACE,OAAOqD,oBAAU1e,GAAMgoG,iBAKd,SAASl9C,GAAkBr5C,GACxC,OAAOpT,QAAM8B,QACX6d,GACA3f,QACGuB,MAAM,cAAe,CACpBF,GAAItB,aACJmR,KAAMlR,QAAMqkB,QAAQ,eACpBq7C,aAAc,EACdrxC,OAAQ,IACRu7E,WAAY,GACZW,SAAU,EACVC,cAAe,EACfC,eAAgB,GAChB/+E,SAAU,GACVyzC,kBAAmB,eACnB13C,cAAeznB,QAAMwc,MAAMxc,QAAMU,QACjC+oG,MAAOzpG,QAAMC,SAASoqG,GAAc,IACpCb,MAAOxpG,QAAMC,SAASqqG,GAAc,IAEpChrF,OAAQtf,QAAMwc,MACZpJ,EAAcoR,iBACZ,QACA,eAOJkmF,iBAAkB1qG,QAAMwc,MACtBpJ,EAAc0S,0BAA0B,UAK1C6kF,oBAAqB3qG,QAAMwc,MAAMxc,QAAM6iD,YAExCpmC,UAAS,iBAAO,CACfE,mBAAexY,EACfoC,WAAOpC,EACP0lG,QAAS,IACTC,QAAS,QAEV9sF,OAAM,SAAArb,GAAI,MAAK,CACd,YACE,IAAKA,EAAKgb,cACR,MAAM,IAAItV,MAAM,yBAElB,OAAO1F,EAAKgb,mBAGfK,OAAM,SAAArb,GAAI,MAAK,CACd,kBACE,YACyBwC,IAAvBxC,EAAKgb,eACLhb,EAAK8nG,MAAMrvF,iBAAiB/U,OAAS,GACrC1D,EAAK6nG,MAAMpvF,iBAAiB/U,OAAS,GAGzC,cACE,OAAO1D,EAAK8lB,cAAcpiB,OAAS,IAAM+E,KAAKo/C,aAEhD,gBACE,OAAO7nD,EAAK0Y,MAAQ1Y,EAAKkoG,SAE3B,iBACE,OAAOloG,EAAK0sB,OAAS1sB,EAAKmoG,SAE5B,YACE,MAAO,CAACnoG,EAAK8nG,MAAO9nG,EAAK6nG,QAG3B,kBACE,kCACK5oF,GAAqBjf,IAD1B,IAEE47B,sBAAuB3Z,kBACrBF,sBAAW/hB,GACX,gCAKPD,SAAQ,SAAAC,GAAI,MAAK,CAChB4d,YADgB,WACF,WACNsF,EAAUnB,sBAAW/hB,GAC3BipD,sBACEjpD,EACA6oD,mBACE,WACE,QAA2BrmD,IAAvBxC,EAAKgb,cAA6B,CACpC,IAAMiuF,EAAO,CAACjpG,EAAK6+D,UAAW7+D,EAAKgoG,YAC7B3sF,EAAQ,CAACrb,EAAK8nG,MAAO9nG,EAAK6nG,OAC3B7nG,EAAK6nD,aACR7nD,EAAK8lB,cAAcjX,SAAQ,SAAC7K,EAAM2X,GAChC,IAAMsrC,EAAW/jC,EAAQm3B,gBAAgB76C,IAAIwE,GAC7C,GAAIijD,EAAU,KACJx9C,EAAYw9C,EAAZx9C,QACR,GAAIA,GAAWA,EAAQ/F,OAAQ,CAC7B,IAAMwlG,EAAkB1gG,sBAAYiB,GAChCy/F,GACFxkF,uBAAY,WACVrJ,EAAMM,GAAOV,oBAAoBiuF,GACjC7tF,EAAMM,GAAOR,WACXE,EAAMM,GAAOL,QAAU2tF,EAAKttF,eAU9C,CAAEuqC,MAAO,OAGb+C,sBACEjpD,EACA6oD,mBAAQ,WAEN,QAA2BrmD,IAAvBxC,EAAKgb,cAA6B,CAGpC,EAAKmuF,WACHh8F,KAAKuM,IACH1Z,EAAK8nG,MAAMxrF,cAAcrE,cAAcH,QACrC,SAACtW,EAAGC,GAAJ,OACE0L,KAAKuM,IACHlY,EACA8mG,GAAqB7mG,EAAE3C,QAAQ6J,MAAM,EAAG,QAE5C,GAVU,GAYZ,MAGJ,EAAKygG,WACHj8F,KAAKuM,IACH1Z,EAAK6nG,MAAMvrF,cAAcrE,cAAcH,QACrC,SAACtW,EAAGC,GAAJ,OACE0L,KAAKuM,IACHlY,EACA8mG,GAAqB7mG,EAAE3C,QAAQ6J,MAAM,EAAG,QAE5C,GAvBU,GAyBZ,YAOZygG,WAvEgB,SAuELjtF,GACTnc,EAAKkoG,QAAU/rF,GAEjBgtF,WA1EgB,SA0ELhtF,GACTnc,EAAKmoG,QAAUhsF,GAEjB+B,SA7EgB,SA6EPC,GACPne,EAAKgb,cAAgBmD,GAEvB+qC,UAhFgB,SAgFN0nC,GACR5wF,EAAK0sB,OAASkkE,GAGhBtuE,SApFgB,SAoFP5d,GACP1E,EAAK4E,MAAQF,GAGf86D,UAxFgB,WAyFd9gD,oBAAU1e,EAAM,GAAG0/D,WAAW1/D,IAGhCqkF,gBA5FgB,SA4FA33D,GACd1sB,EAAK+9D,aAAerxC,GAGtB4kE,cAhGgB,WAiGdtxF,EAAK8nG,MAAMlrF,UACX5c,EAAK6nG,MAAMjrF,WAEby0E,aApGgB,WAqGdrxF,EAAK8nG,MAAMjrF,SACX7c,EAAK6nG,MAAMhrF,UAEby3C,sBAxGgB,WAyGd,GAA+B,iBAA3Bt0D,EAAKw9D,kBAAsC,CAE7C,IAAMt6C,EAAenB,sBAAW/hB,GAC1B+/D,EAAW78C,EAAQymC,UACvB,kCACA,4BACA,CAAEjmC,KAAM1jB,IAGV,OADAkjB,EAAQ0mC,WAAWmW,GACZA,EAET,MAAM,IAAIr6D,MAAJ,sCAC2B1F,EAAKw9D,qBAIxC15C,UAzHgB,SAyHNnC,GAAuC,IAAtBsC,EAAsB,uDAAJ,GACrCg7C,EAAoBxtD,EAAc0S,0BACtC,SAEI5F,EAAgB6F,4BACpB66C,EACA56C,kBAAQrkB,GACR2hB,GAEIvR,EAAYqB,EAAc0U,aAAa5H,EAAchP,MAC3D,IAAKa,EACH,MAAM,IAAI1K,MAAJ,6BAAgC6Y,EAAchP,OAEtD,IAAMc,EAAWoB,EAAc2T,YAAYplB,EAAKuP,MAC1C+V,EAAc/G,EAAcqE,SAASnc,MACzC,SAACge,GACC,QACEpU,EAASL,aAAavJ,MACpB,SAAA6d,GAAW,OAAIA,EAAYtgB,OAASygB,EAAElV,WAQ9C,IAAK+V,EACH,MAAM,IAAI5f,MAAJ,4DACiD1F,EAAKuP,OAG9D,IAAM8O,EAAQjO,EAAUL,WAAW3F,OAArB,2BACT6Z,GADS,IAEZ1U,KAAMgP,EAAchP,KACpBgP,gBACAqE,SAAU,CAAC,CAAErT,KAAM+V,EAAY/V,KAAMgP,cAAe+G,OAEtDtlB,EAAK2d,OAAOzN,KAAKmO,IAGnBwF,UAjKgB,SAiKNlC,GACR,IAAMs9C,EAAoBxtD,EAAc0S,0BACtC,SAEI5F,EAAgB6F,4BACpB66C,EACA56C,kBAAQrkB,GACR2hB,GAGIw9C,EAAcn/D,EAAK2d,OAAOpH,QAC9B,SAAAuyB,GAAC,OAAIA,EAAEvqB,gBAAkBA,KAG3B,OADAmG,uBAAY,kBAAMy6C,EAAYtwD,SAAQ,SAAAi6B,GAAC,OAAI9oC,EAAK2d,OAAOgH,OAAOmkB,SACvDq2B,EAAYz7D,QAGrBi8D,YAlLgB,SAkLJh+C,GAEUlZ,KAAKob,UAAUlC,IAGjClZ,KAAKqb,UAAUnC,IAGnB0nF,iBA1LgB,SA0LCvjF,GACf9lB,EAAK8lB,cAAgB5K,eAAK4K,IAE5BwjF,SA7LgB,SA6LPC,GACPvpG,EAAK8nG,MAAQ5sF,eAAKquF,EAAI,IACtBvpG,EAAK6nG,MAAQ3sF,eAAKquF,EAAI,KAGxBC,UAlMgB,SAkMNC,EAAkBC,GAAgB,MACrBC,kBAAOD,EAAQ,GAAID,EAAU,IADR,mBACnCG,EADmC,KAC7BC,EAD6B,OAErBF,kBAAOD,EAAQ,GAAID,EAAU,IAFR,mBAEnCK,EAFmC,KAE7BC,EAF6B,KAG1C,OAAO58F,KAAKsgD,IAAIo8C,EAAOD,GAAQ,GAAKz8F,KAAKsgD,IAAIs8C,EAAOD,GAAQ,EACxD,CACE9pG,EAAK8nG,MAAM/rF,OAAO6tF,GAClB5pG,EAAK8nG,MAAM/rF,OAAO8tF,GAClB7pG,EAAK6nG,MAAM9rF,OAAO/b,EAAKgoG,WAAa8B,GACpC9pG,EAAK6nG,MAAM9rF,OAAO/b,EAAKgoG,WAAa+B,SAEtCvnG,GAGNqa,OA/MgB,SA+MT4sF,EAAkBC,GACvB,IAAMrmE,EAAS56B,KAAK+gG,UAAUC,EAAWC,GACzC,GAAIrmE,EAAQ,mBACeA,EADf,GACHoC,EADG,KACCC,EADD,KACKC,EADL,KACSC,EADT,KAEV5lC,EAAK8nG,MAAMrrF,OAAOgpB,EAAIC,GACtB1lC,EAAK6nG,MAAMprF,OAAOmpB,EAAID,KAG1BqkE,cAvNgB,SAuNFP,EAAkBC,GAC9B,IAAMrmE,EAAS56B,KAAK+gG,UAAUC,EAAWC,GACzC,GAAIrmE,EAAQ,mBACeA,EADf,GACHoC,EADG,KACCC,EADD,KACKC,EADL,KACSC,EADT,KAEJ1iB,EAAUnB,sBAAW/hB,GAErBiqG,EAAK1B,GAAcn+F,OAAO5B,sBAAYxI,EAAK8nG,QAC3CoC,EAAK3B,GAAcn+F,OAAO5B,sBAAYxI,EAAK6nG,QACjDoC,EAAG7uF,iBAAiBpb,EAAK8nG,MAAMpvF,OAC/BwxF,EAAG9uF,iBAAiBpb,EAAK6nG,MAAMnvF,OAC/BuxF,EAAGxtF,OAAOgpB,EAAIC,GACdwkE,EAAGztF,OAAOmpB,EAAID,GACdskE,EAAGvtF,OAAOutF,EAAGz7F,SAAWxO,EAAK0Y,MAAQ1Y,EAAK8nG,MAAMpvF,OAAQ,GACxDwxF,EAAGxtF,OAAOwtF,EAAG17F,SAAWxO,EAAK0Y,MAAQ1Y,EAAK6nG,MAAMnvF,OAAQ,GAKxD,IAAMiF,EAOA,GACN3d,EAAK2d,OAAO9O,SAAQ,SAAAwP,GAClB,IAAMC,EAAYD,EAAME,cAClB+G,EAAchH,EAAUsE,SAASnc,MACrC,SAACwJ,GAAD,MACmB,yBAAjBA,EAAQV,QAER+V,GACF3H,EAAOzN,KAAK,CACVX,KAAM+O,EAAU/O,KAChBgP,cAAeD,EACfsE,SAAU,CACR,CAAErT,KAAM+V,EAAY/V,KAAMgP,cAAe+G,SAKjD,IAAM6kF,EAAe,CACnB56F,KAAM,oBACN8L,MAAO,CAAC,yBAEJ9L,KAAM,oBACH/G,sBAAYyhG,IAHZ,IAIHtsF,OAAQ,GACRu/C,YAAY,IALT,yBAQH3tD,KAAM,oBACH/G,sBAAY0hG,IATZ,IAUHvsF,OAAQ,GACRu/C,YAAY,KAGhBv/C,UAGFuF,EAAQ8gD,QAAQ,oBAAqBmmC,SAI1C9uF,OAAM,SAAArb,GAAI,MAAK,CACd,gBACE,IAAMkjB,EAAUnB,sBAAW/hB,GAC3B,OAAIypD,qCAA0BvmC,GACrB,CACL,CACE9hB,MAAO,sBACPokB,QAASxlB,EAAKs0D,wBAIb,S,ICpbT8Y,GAAeg9B,EAAfh9B,WAcai9B,G,qNACC76F,G,0GAOdA,EALFosB,sBAAuByxB,O,MAAQ,E,EAC/B30C,EAIElJ,EAJFkJ,MACAgU,EAGEld,EAHFkd,OACA5e,EAEE0B,EAFF1B,OACAuN,EACE7L,EADF6L,MAGI2f,EAASD,GAAa5tB,KAAKkN,KAAK3B,EAAQ20C,GAAQ3gC,EAAS2gC,GACzDia,EAAMtsC,EAAOiB,WAAW,MACxB09C,EAAY1rE,yBAAeH,EAAQ,aACzCw5D,EAAIqS,UAAYA,EAChBrS,EAAIja,MAAMA,EAAOA,GACjBia,EAAIjrC,UAAYpuB,yBAAeH,EAAQ,S,cAChBuN,E,GAAhBysF,E,KAAOD,E,KACRyC,EAAMxC,EAAMxrF,cAAcrE,cAAc,GAAGF,SAC3CwyF,EAAM1C,EAAMvrF,cAAcrE,cAAc,GAAGF,UAC/C+vF,EAAM/sF,UAAY,IAAIlM,SAAQ,SAAAqG,GAC9B,IAAMjW,EAAQiW,EAAQ1V,IAAI,SACpBL,EAAM+V,EAAQ1V,IAAI,OAClBV,EAAUoW,EAAQ1V,IAAI,WACtB2zE,EAAOj+D,EAAQ1V,IAAI,QACnBgrG,EAAUr3B,EAAKr0E,QAGfmU,EAAQhF,yBAAeH,EAAQ,QAAS,CAACoH,IAC/CoyD,EAAIjrC,UAAYppB,EAChBq0D,EAAIlrC,YAAcnpB,EAClB,IAAMw3F,EAAM3C,EAAMtsF,OAAO,CAAE1c,UAAS2c,MAAOxc,IACrCyrG,EAAM5C,EAAMtsF,OAAO,CAAE1c,UAAS2c,MAAOtc,IACrCwrG,EAAM9C,EAAMrsF,OAAO,CAAE1c,QAAS0rG,EAAS/uF,MAAO03D,EAAKl0E,QACnD2rG,EAAM/C,EAAMrsF,OAAO,CAAE1c,QAAS0rG,EAAS/uF,MAAO03D,EAAKh0E,MACzD,QACUqD,IAARioG,QACQjoG,IAARkoG,QACQloG,IAARmoG,QACQnoG,IAARooG,EACA,CACA,IAAMC,EAAKJ,EAAMH,EACXQ,EAAKJ,EAAMJ,EACXS,EAAKJ,EAAMJ,EACXS,EAAKJ,EAAML,EACjB,GAAIp9F,KAAKsgD,IAAIo9C,EAAKC,GAAM,GAAK39F,KAAKsgD,IAAIs9C,EAAKC,GAAM,EAC/C1jC,EAAIU,SACF6iC,EAAKlxB,EAAY,EACjBjtD,EAASq+E,EAAKpxB,EAAY,EAC1BA,EACAA,OAEG,CACL,IAAIsxB,EAAQJ,EACRK,EAAQH,EACN19B,EAAQn4D,EAAQ1V,IAAI,OAAS0V,EAAQ1V,IAAI,SAC/C,GAAI6tE,EAAO,CACT,IAAMU,EAAWX,GAAWC,GAC5B/F,EAAI6jC,YACJ,IAAK,IAAI7nG,EAAI,EAAGA,EAAIyqE,EAASrqE,OAAQJ,GAAK,EAAG,CAC3C,IAAMgT,GAAOy3D,EAASzqE,GAChBqqE,EAAKI,EAASzqE,EAAI,GAElBi3D,EAAQ0wC,EACRG,EAAQF,EAEH,MAAPv9B,GACFs9B,GAAS30F,EAAMwxF,EAAMt5F,QACrB08F,GAAS50F,EAAMuxF,EAAMr5F,SACL,MAAPm/D,GAAqB,MAAPA,EACvBs9B,GAAS30F,EAAMwxF,EAAMt5F,QACL,MAAPm/D,IACTu9B,GAAS50F,EAAMuxF,EAAMr5F,SAEvB84D,EAAI7qD,OAAO89C,EAAO7tC,EAAS0+E,GAC3B9jC,EAAIkf,OAAOykB,EAAOv+E,EAASw+E,GAE7B5jC,EAAIjV,cAEJiV,EAAI6jC,YACJ7jC,EAAI7qD,OAAOouF,EAAIn+E,EAASq+E,GACxBzjC,EAAIkf,OAAOskB,EAAIp+E,EAASs+E,GACxB1jC,EAAIjV,eAIR1tD,QAAQ4H,KAAR,qBACgBzN,EADhB,YAC2BG,EAD3B,YACoCE,EADpC,YAC2CqrG,EAD3C,YACsDr3B,EAAKl0E,MAD3D,YACoEk0E,EAAKh0E,IADzE,+CACmHsrG,EADnH,YAC0HC,EAD1H,YACiIC,EADjI,YACwIC,O,kBAIrI3vE,GAAkBD,I,yKAGd7b,G,qGAETzG,EAGEyG,EAHFzG,MACAgU,EAEEvN,EAFFuN,O,EAEEvN,EADFuE,KAAQokF,E,EAAAA,MAAOD,E,EAAAA,MAEXwD,EAAa,CAAC3yF,EAAOgU,GACrB4+E,EAAgB,CAACxD,EAAOD,GAAOj+F,KAAI,SAAC9I,EAAM+a,GAC9C,IAAM6H,EAAO6kF,GAAcn+F,OAAOtJ,GAElC,OADA4iB,EAAKtI,iBAAiBiwF,EAAWxvF,IAC1B6H,K,SAEH+X,QAAQ4hB,IACZiuD,EAAc1hG,IAAd,uCAAkB,WAAM8Z,GAAN,SAAAliB,EAAA,kEAChBkiB,EADgB,SAER,EAAKva,YAAL,2BACDgW,GADC,IAEJ1V,QAASia,EAAKpH,cAAcrE,iBAJhB,wBACXsE,YADW,2DAAlB,wD,uBASsB9T,KAAK++D,cAAL,2BACnBroD,GADmB,IAEtB9D,MAAOiwF,K,cAFHzvE,E,OAKApsB,EAAUC,IAAMC,cACpBlH,KAAK2G,eADS,2BAET+P,GAFS,IAEIuN,SAAQhU,QAAOmjB,cACjC,M,kBAGK,CACLpsB,UACAosB,YACAnP,SACAhU,QACA4pB,QAASgpE,EAAc,GAAGhvF,cAAc/E,OAAO,GAAGQ,SAClDwqB,QAAS+oE,EAAc,GAAGhvF,cAAc/E,OAAO,GAAGQ,W,6GApIXwzF,I,qBC4F7C,G,WAnHE,aAA0B,IAAdrmG,EAAc,uDAAJ,GACpB,GADwB,sBAClBA,WAAmBA,UAAzB,GACE,MAAM,IAAIuG,UAAV,6CAGFhD,KAAA,QAAevD,EAAf,QACAuD,KAAA,MAAa,IAAb,IACAA,KAAA,SAAgB,IAAhB,IACAA,KAAA,Q,iDAGG8M,EAAKnD,GACR3J,KAAA,eACAA,KAAA,SAEIA,KAAK+iG,OAAS/iG,KAAlB,UACEA,KAAA,QACAA,KAAA,SAAgBA,KAAhB,MACAA,KAAA,MAAa,IAAb,O,0BAIA8M,GACF,GAAI9M,KAAKihE,MAAMtjD,IAAf,GACE,OAAO3d,KAAKihE,MAAMlqE,IAAlB,GAGF,GAAIiJ,KAAKgjG,SAASrlF,IAAlB,GAA4B,CAC1B,IAAMhU,EAAQ3J,KAAKgjG,SAASjsG,IAA5B,GAGA,OAFAiJ,KAAA,mBACAA,KAAA,UACA,K,0BAMA8M,EAAKnD,GAOP,OANI3J,KAAKihE,MAAMtjD,IAAf,GACE3d,KAAA,eAEAA,KAAA,UAGF,O,0BAGE8M,GACF,OAAO9M,KAAKihE,MAAMtjD,IAAI7Q,IAAQ9M,KAAKgjG,SAASrlF,IAA5C,K,2BAGG7Q,GACH,OAAI9M,KAAKihE,MAAMtjD,IAAf,GACS3d,KAAKihE,MAAMlqE,IAAlB,GAGEiJ,KAAKgjG,SAASrlF,IAAlB,GACS3d,KAAKgjG,SAASjsG,IAArB,QADF,I,6BAOK+V,GACL,IAAMm2F,EAAUjjG,KAAKihE,MAAMhwB,OAA3B,GAKA,OAJA,IACEjxC,KAAA,UAGKA,KAAKgjG,SAAS/xD,OAAOnkC,IAA5B,I,8BAIA9M,KAAA,cACAA,KAAA,iBACAA,KAAA,U,qIAIoBA,M,wDAClB,O,yBADU8M,E,cACV,E,4UAKsB9M,M,wDACtB,O,yBADY2J,E,cACZ,E,0MAIFuvC,OAAOC,S,iIACYn5C,KAAKihE,O,wDACtB,OADS9vC,E,iBACT,E,4JAGiBnxB,KAAKgjG,U,8DAAb7xE,E,sBACKA,E,GAAPrkB,E,KACF9M,KAAKihE,MAAMtjD,IAAI7Q,G,iBAClB,O,UAAA,E,kPAMJ,IADS,EACLo2F,EAAJ,EADS,eAESljG,KAAKgjG,SAFd,YAET,2BAAwC,KAA7Bl2F,EAA6B,QACjC9M,KAAKihE,MAAMtjD,IAAhB,KACEulF,OAJK,8BAQT,OAAOljG,KAAK+iG,MAAZ,M,KCxFiBnqF,G,kDAcnB,WAAmBvT,GAAyC,2BAC1D,cAAMA,IAdA47D,MAAQ,IAAIkiC,KAAsB,CACxCliC,MAAO,IAAImiC,GAAS,CAAEC,QAAS,IAC/BxpG,KAAM,SAACgG,EAAmBxB,GACxB,OAAO,EAAKy+D,MAAL,2BAAgBj9D,GAAhB,IAAsBxB,eAU2B,EANpDgf,mBAMoD,IAJpDnF,iBAIoD,EAE1D,IAAMA,EAAc1S,yBAAeH,EAAQ,eACrCgY,EAAgB7X,yBAAeH,EAAQ,iBAHa,OAI1D,EAAK6S,YAAchZ,wBAAagZ,GAChC,EAAKmF,cAAgBA,EALqC,E,2FAQhDhhB,G,yFACU2D,KAAKkY,YAAY9U,SAAjB,aAClByB,SAAU,QACPxI,I,cAFC0I,E,OAIAu+F,EAA0B,GAChCv+F,EAAKiyC,MAAM,MAAM5wC,SAAQ,SAACozE,EAActmE,GACtC,GAAIsmE,EAAKv+E,OAAQ,OAmBXu+E,EAAKxiC,MAAM,MAnBA,kBAEbusD,EAFa,KAMbC,GANa,WAObC,EAPa,KAQb/2F,EARa,KASbgyE,EATa,KAabglB,GAba,WAcb9kB,EAda,KAeb+kB,EAfa,KAgBbC,EAhBa,MAiBbC,EAjBa,MAkBVC,EAlBU,YAqBTxrG,EAAOW,OAAOmvE,YAClB07B,EAAO3iG,KAAI,SAAA0J,GACT,IAAMjQ,EAAIiQ,EAAMuhE,QAAQ,KAGxB,MAAO,CAFWvhE,EAAM3K,MAAM,EAAGtF,GACdiQ,EAAM3K,MAAMtF,EAAI,QAKvC0oG,EAAWpwF,GAAS,CAClB02D,QAAS,CACP,CAAEvzE,QAASktG,EAAM/sG,OAAQgtG,EAAQ9sG,KAAM+sG,GACvC,CAAEptG,QAASqoF,EAAMloF,OAAQktG,EAAQhtG,KAAMkoF,IAEzCttE,MAAO,aACLqyF,YAAaA,EACbC,UAAWA,EACXl3F,SACAm3F,aAAcA,GACXvrG,Q,kBAKJgrG,G,qRAOA,G,wQAKA,I,mIAGGljG,GAAwC,WAAxB/D,EAAwB,uDAAJ,GAC9C,OAAOgE,aAAgB,uCAAU,WAAMC,GAAN,iCAAAvH,EAAA,sEACN,EAAKkoE,MAAMlqE,IAAI,aAAcsF,EAAMA,EAAKgC,QADlC,OAM/B,GALMilG,EADyB,QAMhB,KADTpwF,EAAQ,EAAKmK,cAAc+uD,QAAQhsE,EAAOzI,eAE9C,IAASkD,EAAI,EAAGA,EAAIyoG,EAAWroG,OAAQJ,IAAK,EACfyoG,EAAWzoG,GAA9ByW,EADkC,EAClCA,MAAOs4D,EAD2B,EAC3BA,QAD2B,EAEVA,EAAQ12D,GAAhC1c,EAFkC,EAElCA,MAAOE,EAF2B,EAE3BA,IAAKL,EAFsB,EAEtBA,QAChBuzE,EAAQ12D,GAAO7c,UAAY+J,EAAO/J,SAChCsY,GAAevO,EAAO5J,MAAO4J,EAAO1J,IAAKF,EAAOE,IAClD4J,EAASgG,KACP,IAAIyX,GAAJ,aACEE,SAAU,OAAF,OAASpjB,GACjBrE,QACAE,MACAL,UACA0tG,UAAWlpG,EACX6vE,KAAM,CACJl0E,MAAOozE,IAAU12D,GAAO1c,MACxBE,IAAKkzE,IAAU12D,GAAOxc,IACtBL,QAASuzE,IAAU12D,GAAO7c,UAEzBib,KAQfhR,EAASS,WAhCsB,2CAAV,yD,8CA1FarB,2BAAnBkZ,GAYL8gE,aAAe,CAAC,cAAe,eCxChC5kE,qCACb,aACA,CACEuI,cAAe,CACbvW,KAAM,cACNiO,aAAc,IAEhBmD,YAAa,CACXpR,KAAM,eACNiO,aAAc,CAAEhd,IAAK,uBAGzB,CAAEid,iBAAiB,ICQAgvF,G,4MACnBzoG,KAAO,oB,0GAGLoE,G,8EAEMiyC,E,UAAkB5xC,KAAKgJ,cAAc6oC,iB,iBAAnB,EAA8Bp3B,e,aAA9B,EACpBm3B,gB,yCAEKjyC,G,gCAGFmyC,iCAAsBF,EAAiBjyC,I,8KAGlCA,G,yGAOFK,KAAKoxC,qBAAqBzxC,G,mBALlC47B,E,EAAAA,UACA/gB,E,EAAAA,cACAu3B,E,EAAAA,aACAr7B,E,EAAAA,YACArY,E,EAAAA,OAEGk9B,E,uBAAiB,IAAIt+B,MAAM,iC,WAEhCwD,4BAAiBpC,G,EAEO+xC,GACtBpwC,KAAKgJ,cACLuyB,EACA/gB,IAHMmhB,E,EAAAA,uBAKqBj8B,0B,uBACrB,IAAIzC,MAAJ,oEACyD0+B,I,WAG3Dl1B,EAAezG,KAAKgJ,cAAc2Q,gBAAgBo4B,G,uBAGhD,IAAI90C,MAAJ,oBAAuB80C,EAAvB,gB,WAEHtrC,EAAaE,e,uBACV,IAAI1J,MAAJ,mBACQ80C,EADR,qE,WAKFtrC,aAAwBq8F,G,uBACtB,IAAI7lG,MACR,+E,yBAGiBwJ,EAAawrC,eAAb,2BAChBv7B,GADgB,IAEnB6kB,YACAI,cACAt9B,Y,eAJIu8B,E,OAMNn6B,4BAAiBpC,G,kBACVu8B,G,6GA5DoC7xB,GCRhC,cACb,IAAMkB,EAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC4oD,oBAAqB,CACnB1oD,QAASF,EAAMG,QAAQ,IAEzB0oD,gBAAiB,CACfhoD,SAAU,KAEZkyC,aAAc,CACZ/oB,UAAW,SACX5R,WAAYpY,EAAMG,QAAQ,GAC1BkY,cAAerY,EAAMG,QAAQ,QAG3B25F,EAAU3jG,oBACd,YAUM,IATJnJ,EASI,EATJA,MACA8yB,EAQI,EARJA,SACAsD,EAOI,EAPJA,SACApxB,EAMI,EANJA,MAOM0P,EAAU5B,IACRoT,EAAkB/D,sBAAWniB,GAA7BkmB,cACR,OACE,kBAAC,KAAD,CAAM4T,WAAS,EAACE,MAAI,EAACqiC,QAAQ,SAASlpD,QAAS,EAAG4mB,WAAW,UAC3D,kBAAC,KAAD,CACEuiC,QAAM,EACNnnD,QAAQ,WACR3C,MAAO0T,EAAc4M,GAAYA,EAAW,GAC5CsD,SAAU,SAAAtI,GACRsI,EAASyrB,OAAO/zB,EAAMuI,OAAO7jB,SAE/BxN,MAAOirB,QAAQjrB,GACfyrB,SAAUR,QAAQjrB,GAClBkQ,UAAWR,EAAQmnD,iBAElB31C,EAAclc,KAAI,SAAC5F,EAAM6X,GAAP,OACjB,kBAAC,KAAD,CAAUtG,IAAKvR,EAAMoO,MAAOyJ,GACzB7X,WA6Ff,OArFmB+E,oBAAS,YAA4C,IAAzCnJ,EAAyC,EAAzCA,MACvB0U,EAAU5B,IADsD,EAEpDya,mBAAS,GAApBw/E,EAF+D,sBAGtCx/E,mBAAS,CAAC,EAAG,IAHyB,mBAG/DuF,EAH+D,KAGrDk6E,EAHqD,OAI5Cz/E,mBAAS,IAJmC,mBAI/DvoB,EAJ+D,KAIxD0d,EAJwD,OAKpC6K,mBAAuB,CAAE3sB,IAAK,KALM,mBAK/D08F,EAL+D,KAKpDa,EALoD,KAM9Dj4E,EAAkB/D,sBAAWniB,GAA7BkmB,cAuCR,OAtCKA,EAAcpiB,QACjB4e,EAAS,4BAsCT,kBAAC,IAAD,CAAWxN,UAAWR,EAAQknD,qBAC5B,kBAAC,KAAD,CAAM9hC,WAAS,EAAC3mB,QAAS,EAAGkpD,QAAQ,SAAStiC,WAAW,UACtD,kBAAC,KAAD,CAAMC,MAAI,GACR,uBAAGllB,MAAO,CAAEkoB,UAAW,WAAvB,sCAGC,YAAI,IAAIp5B,MAAMmpG,IAAU/iG,KAAI,SAAChB,EAAG+S,GAAJ,OAC3B,kBAAC+wF,EAAD,CACEn3F,IAAG,cAASoG,EAAT,YAAkB+W,EAAS/W,IAC9B/W,MAAOA,EACP8tB,SAAUA,EAAS/W,GACnBqa,SAAU,SAAA1f,GACR,IAAMpJ,EAAOwlB,EAAS/pB,MAAM,GAC5BuE,EAAKyO,GAASrF,EACds2F,EAAY1/F,IAEdtN,MAAOA,QAKb,kBAAC,KAAD,CAAMg6B,MAAI,GACR,kBAAC,KAAD,4CACA,kBAAC,GAAD,CACE51B,KAAK,MACL4M,YAAY,GACZnJ,SAAUy1F,EACV9iE,YAAa,SAAAwqE,GAAG,OAAI7G,EAAa6G,OAGrC,kBAAC,KAAD,CAAMhrE,MAAI,GACR,kBAAC,IAAD,CAAQpU,QAlEhB,WAUE,GATA5lB,EAAM0pG,SAAS,CACb,CAAE96F,QAAS,GAAKuJ,SAAU,GAC1B,CAAEvJ,QAAS,GAAKuJ,SAAU,KAE5BnY,EAAMypG,iBAAiB,CACrBvjF,EAAc4M,EAAS,IACvB5M,EAAc4M,EAAS,MAGrB,QAASwqE,EAAW,CACtB,IAAM39E,EAAW29E,EAAU18F,IACvB08F,EAAU18F,IAAImI,MAAMu0F,EAAU18F,IAAI4jF,YAAY,KAAO,GACrD,KAGE7lE,EAAgBwD,sBAAWniB,GAAOie,aAAa,CACnD8D,QAAS,YAAF,OAAcze,KAAK28C,OAC1B77C,KAAMub,EACNuG,cAAe4M,EAAS9oB,KAAI,SAAAk+C,GAAS,OAAIhiC,EAAcgiC,MACvDv4C,KAAM,eACNwW,QAAS,CACPxW,KAAM,aACNoR,YAAau8E,EACbp3E,cAAe4M,EAAS9oB,KAAI,SAAAk+C,GAAS,OAAIhiC,EAAcgiC,OAEzD5N,SAAU,CACR3qC,KAAM,qBAGV3P,EAAM+/D,YAAYphD,EAAcoD,WAoCE5M,QAAQ,YAAY9B,MAAM,WAAxD,e,kEC/HG,cACb,IAAMP,EAAYC,aAAW,CAC3ByjD,WAAY,CACVtjD,QAAS,MACTmW,OAAQ,eAEVusC,SAAU,CACRxhD,SAAU,SACVb,WAAY,QACZshB,WAAY,SACZ5nB,SAAU,WACVsH,UAAW,aACXD,OAAQ,oBACRic,MAAO,EACPvB,IAAK,EACLJ,OAAQ,QA8EZ,OA1EiBzlB,oBAAS,YAA4C,IAAzCnJ,EAAyC,EAAzCA,MACrB0U,EAAU5B,IAChB,OACE,yBAAKoC,UAAWR,EAAQkhD,UACtB,kBAAC,KAAD,CACEhwC,QAAS,WACP5lB,EAAMkoG,MAAM3qF,QAAQ,MAEtBrI,UAAWR,EAAQ8hD,WACnB5hD,MAAM,OACNvB,MAAM,aAEN,kBAAC,KAAD,OAGF,kBAAC,KAAD,CACEuS,QAAS,WACP5lB,EAAMkoG,MAAM3qF,OAAO,MAErBrI,UAAWR,EAAQ8hD,WACnB5hD,MAAM,OACNvB,MAAM,aAEN,kBAAC,KAAD,OAEF,kBAAC,KAAD,CACEuS,QAAS,WACP5lB,EAAMioG,MAAM1qF,OAAO,MAErBrI,UAAWR,EAAQ8hD,WACnB5hD,MAAM,OACNvB,MAAM,aAEN,kBAAC,KAAD,OAEF,kBAAC,KAAD,CACEuS,QAAS,WACP5lB,EAAMioG,MAAM1qF,QAAQ,MAEtBrI,UAAWR,EAAQ8hD,WACnB5hD,MAAM,OACNvB,MAAM,aAEN,kBAAC,KAAD,OAEF,kBAAC,KAAD,CACEuS,QAAS5lB,EAAM0xF,cACfx8E,UAAWR,EAAQ8hD,WACnBnjD,MAAM,aAEN,kBAAC,KAAD,OAGF,kBAAC,KAAD,CACEuS,QAAS5lB,EAAMyxF,aACfv8E,UAAWR,EAAQ8hD,WACnB5hD,MAAM,UACNvB,MAAM,aAEN,kBAAC,KAAD,OAGF,kBAAC,KAAD,CACEuS,QAAS5lB,EAAM00D,sBACf9/C,MAAM,sBACNpC,MAAM,eACN2d,cAAY,wBACZ9c,MAAM,aAEN,kBAACg4C,GAAD,YCzFJv4C,GAAYC,cAAW,SAAAC,GAC3B,MAAO,CACL6X,KAAM,CACJ5d,SAAU,WACVq7E,aAAct1E,EAAMG,QAAQ,GAC5BiB,SAAU,UAEZ+iB,cAAe,CACbpiB,UAAW,OAEb+kB,UAAW,CACTzpB,QAAS,OACT6C,QAAS,EACTjG,SAAU,YAEZmqD,QAAS,CACP50B,cAAe,OACfpuB,SAAU,SACV/D,QAAS,OACTyI,MAAO,OACPkgB,QAAS,MACTH,WAAY,MACZjK,OAAQ,IACR,SAAU,CACRhC,OAAQ,YACRlqB,KAAM,SAGVuqG,MAAO,CACLp0E,WAAY,MACZG,QAAS,MACTwJ,cAAe,QAEjBvX,QAAS,CACP4N,WAAY,MACZG,QAAS,OAEXo7B,OAAQ,CACNv7B,WAAY,MACZG,QAAS,OAEXk0E,MAAO,CACLr0E,WAAY,MACZG,QAAS,MACTwJ,cAAe,QAEjBx9B,MAAO,CACLqO,MAAO,OAET07C,QAAS,CACPx7C,WAAY,OACZO,SAAU,IACVF,UAAW,YACXgb,OAAQ,IACRta,OAAQ,kBACRkuB,cAAe,OACfv1B,SAAU,YAEZgsD,eAAgB,CACd9uC,SAAU,QAEZ0vC,UAAW,CACTpH,OAAQ,QAEVsH,UAAW,CACTtH,OAAQ,YASd,SAAS06C,GAAO/wF,EAAY0H,GAA0B,MACZA,EAAK3H,OAAOC,GAA5Cld,EAD4C,EAC5CA,QAASG,EADmC,EACnCA,MAAO2N,EAD4B,EAC5BA,OAAQwP,EADoB,EACpBA,IAC1BX,EAAQtO,KAAKsN,MAAMxb,EAAQ2N,GACjC,OAAOwP,EAAM,gBAAH,UAAwBtd,EAAxB,YAAmC2c,EAAMu3C,eAAe,UAGpE,SAASg6C,GACPz1F,EACA7T,EACAupG,GAEA,IAAMC,EAAiC,GACjCC,EAAe51F,EAAO5O,MAAM,GAAG0pB,MAAK,SAAC7wB,EAAGC,GAC5C,IAAM2rG,EAAO5rG,EAAErC,IAAMqC,EAAEvC,MAEvB,OADawC,EAAEtC,IAAMsC,EAAExC,MACTmuG,KAEVC,EAAY,IAAI7pG,MAAM2J,KAAK2O,MAAMpY,IAUvC,OATAypG,EAAat+F,SAAQ,YAAuB,IAApB0G,EAAoB,EAApBA,IAAKwC,EAAe,EAAfA,SACrBqwB,EAAIj7B,KAAK2O,MAAMpY,EAASqU,EAAWk1F,GACnCK,EAAc,CAACngG,KAAKuM,IAAI0uB,EAAI,GAAI,GAAIA,GAChC,IAANA,GAAWilE,EAAU1kG,MAAV,MAAA0kG,EAAmBC,GAAaz7E,KAAKhC,SAClDq9E,EAAqBh9F,KAAKqF,GAE1B83F,EAAU/qG,KAAV,MAAA+qG,EAAS,EAAM,GAAN,OAAeC,OAGrBJ,EAOF,SAAS9/C,GACdC,EACAC,EACAC,GAUA,IAPA,IAAMC,EAAkBF,GADxBD,EAAQlgD,KAAKsgD,IAAIJ,IAEXK,EAAiB9mD,SACrB66C,OAAO+L,GAAiBG,gBAAgBlO,MAAM,MAAM,GACpD,IAGEmO,EAAa,KAAH,IAAG,GAAMF,GAChBE,EAAaJ,MAClBI,GAAc,IACIJ,IAClBI,GAAc,IAKhB,IAAMC,GAFND,EAAazgD,KAAKuM,IAAIk0C,EAAY,IAEAP,EAE9BS,EAAa,EASjB,QARMF,EAAa,KAAOC,EAAe,IAAMN,EAC7CO,EAAaF,EAAa,KACfA,EAAa,IAAMC,EAAe,GAAKN,EAClDO,EAAaF,EAAa,IACfA,EAAa,IAAMC,EAAe,GAAKN,IAClDO,EAAaF,EAAa,GAGrB,CAAEA,aAAYE,cAGvB,SAASC,GACPtkD,EACA+E,GAOA,IAJA,IAFAw/C,IAEA,yDADAC,IACA,yDACMK,EAAQ,GACRJ,EAAYd,GAAgB5+C,EAAS,GAAI,IACzC6/C,EAAYH,EAAUJ,YAAcI,EAAUN,WAC3CtqD,EAAI,EAAGA,EAAImG,EAAQ/F,OAAQJ,IAOlC,IANA,IAAMuF,EAASY,EAAQnG,GACfrE,EAAwB4J,EAAxB5J,MAAOE,EAAiB0J,EAAjB1J,IAAKL,EAAY+J,EAAZ/J,QAChB6c,EAAQ,EAENwyC,EAAUlvD,EACVmvD,EAAUjvD,EAEVovD,EAAOphD,KAAKkN,KAAK8zC,EAAUE,GAAaA,EAC5CE,EAAOH,EACPG,GAAQF,EAEJJ,GAAaM,EAAOL,EAAUN,YAChCU,EAAMp+C,KAAK,CAAEX,KAAM,QAASg/C,KAAMA,EAAO,EAAG5yC,QAAO7c,YACnD6c,GAAS,GAETqyC,GACA7gD,KAAKsgD,IAAIc,EAAO1lD,EAAO5J,OAASivD,EAAUJ,aAE1CQ,EAAMp+C,KAAK,CAAEX,KAAM,QAASg/C,KAAMA,EAAO,EAAG5yC,QAAO7c,YACnD6c,GAAS,GAIf,OAAO2yC,EAGT,IAAMi/C,GAAiBxkG,oBAAS,YAA4C,IAAzCnJ,EAAyC,EAAzCA,MAC3B0U,EAAU5B,KACRmsD,EAA6Cj/D,EAA7Ci/D,UAAWspC,EAAkCvoG,EAAlCuoG,QAASL,EAAyBloG,EAAzBkoG,MAAOgB,EAAkBlpG,EAAlBkpG,cAC7B0E,EAAOR,GACXlF,EAAMxrF,cAAcrE,cACpB4mD,EACAipC,EAAM/vF,UAEFu2C,EAAQP,GAAU+5C,EAAM5uC,aAAajhD,cAAe6vF,EAAMt5F,SAChE,OACE,yBAAKkK,MAAOmmD,EAAWnyC,OAAQy7E,EAASrzF,UAAWR,EAAQw4F,OACzD,2BACGhF,EAAMxrF,cAAcrE,cAClB1B,QAAO,SAAA1N,GAAM,OAAK2kG,EAAKzjG,SAASlB,EAAO0M,QACvC3L,KAAI,SAAAf,GACH,IAAMxE,EAAIwE,EAAOkP,SAEjB,OACE,0BACEuU,UAAS,iBAAYw8E,EAAZ,YACPzkG,EAAIyjG,EAAM/vF,SADH,YAHH,EAGG,KAGTxC,IAAKS,KAAKC,UAAUpN,GACpBxE,EAAGA,EAAIyjG,EAAM/vF,SACbqwB,EAAGA,EACH9lC,KAAK,UACLyoF,iBAAiB,UACjBD,WAAW,OATb,UAWMjiF,EAAO/J,QAXb,YAYqB,IAAjB+J,EAAO5J,MACHkO,KAAKsN,MAAM5R,EAAO5J,OAAO+zD,eAAe,SACxC,QAKb1E,EAAM1kD,KAAI,SAAAkvD,GACT,IAAMz0D,GACHyjG,EAAMtsF,OAAO,CAAE1c,QAASg6D,EAAKh6D,QAAS2c,MAAOq9C,EAAKvK,QAAW,GAC9Du5C,EAAM/vF,SACR,OACE,0BACExC,IAAG,eAAUS,KAAKC,UAAU6iD,IAC5BrzB,GAAIphC,EACJqhC,GAAIrhC,EACJshC,GAAI,EACJC,GAAkB,UAAdkzB,EAAKvpD,KAAmB,EAAI,EAChC22E,YAAa,EACb7zB,OAAsB,UAAdyG,EAAKvpD,KAAmB,OAAS,OACzCuF,UACgB,UAAdgkD,EAAKvpD,KAAmB+E,EAAQmlD,UAAYnlD,EAAQqlD,UAEtD8zC,UAAS30C,EAAKvK,UAInBD,EACE/3C,QAAO,SAAAuiD,GAAI,MAAkB,UAAdA,EAAKvpD,QACpB3F,KAAI,SAAAkvD,GACH,IAAMz0D,GACHyjG,EAAMtsF,OAAO,CAAE1c,QAASg6D,EAAKh6D,QAAS2c,MAAOq9C,EAAKvK,QAAW,GAC9Du5C,EAAM/vF,SAER,OACE,0BACE1T,EAAGA,EAAI,EACP+jC,EAJM,EAKN9b,UAAS,iBAAYw8E,EAAZ,YAA6BzkG,EAA7B,YALH,EAKG,KACTkR,IAAG,eAAUS,KAAKC,UAAU6iD,IAC5BpkD,MAAO,CAAEqV,SAAU,QACnBjV,UAAWR,EAAQukD,eACnBkyB,iBAAiB,SACjBD,WAAW,QAEThyB,EAAKvK,KAAO,GAAGyE,eAAe,kBAQ1C06C,GAAe3kG,oBAAS,YAA4C,IAAzCnJ,EAAyC,EAAzCA,MACzB0U,EAAU5B,KACRw1F,EAA8CtoG,EAA9CsoG,QAASF,EAAqCpoG,EAArCooG,WAAYH,EAAyBjoG,EAAzBioG,MAAOgB,EAAkBjpG,EAAlBipG,cAC9B2E,EAAOR,GACXnF,EAAMvrF,cAAcrE,cACpB+vF,EACAH,EAAM9vF,UAEFu2C,EAAQP,GAAU85C,EAAM3uC,aAAajhD,cAAe4vF,EAAMr5F,SAChE,OACE,yBAAKsG,UAAWR,EAAQu4F,MAAOn0F,MAAOwvF,EAASx7E,OAAQs7E,GACrD,2BACGH,EAAMvrF,cAAcrE,cAClB1B,QAAO,SAAA1N,GAAM,OAAK2kG,EAAKzjG,SAASlB,EAAO0M,QACvC3L,KAAI,SAAAf,GACH,IAAMu/B,EAAIv/B,EAAOkP,SACX1T,EAAI6jG,EACV,OACE,0BACE57E,UAAS,iBAAYu8E,EAAZ,YAA6BxkG,EAA7B,YAAkC+jC,EAAlC,KACT7yB,IAAKS,KAAKC,UAAUpN,GACpBxE,EAAG6jG,EACH9/D,EAAG4/D,EAAa5/D,EAAIy/D,EAAM9vF,SAC1BzV,KAAK,UACLwoF,WAAW,OANb,UAQMjiF,EAAO/J,QARb,YASqB,IAAjB+J,EAAO5J,MAAckO,KAAKsN,MAAM5R,EAAO5J,OAAS,QAKzDqvD,EAAM1kD,KAAI,SAAAkvD,GACT,IAAM1wB,GACHy/D,EAAMrsF,OAAO,CAAE1c,QAASg6D,EAAKh6D,QAAS2c,MAAOq9C,EAAKvK,QAAW,GAC9Ds5C,EAAM9vF,SACR,OACE,0BACExC,IAAG,eAAUS,KAAKC,UAAU6iD,IAC5BnzB,GAAIqiE,EAAa5/D,EACjBxC,GAAIoiE,EAAa5/D,EACjB3C,GAAIyiE,EACJxiE,GAAIwiE,GAAyB,UAAdpvC,EAAKvpD,KAAmB,EAAI,GAC3C22E,YAAa,EACb7zB,OAAsB,UAAdyG,EAAKvpD,KAAmB,OAAS,OACzCuF,UACgB,UAAdgkD,EAAKvpD,KAAmB+E,EAAQmlD,UAAYnlD,EAAQqlD,UAEtD8zC,UAAS30C,EAAKvK,UAInBD,EACE/3C,QAAO,SAAAuiD,GAAI,MAAkB,UAAdA,EAAKvpD,QACpB3F,KAAI,SAAAkvD,GACH,IAAM1wB,GACHy/D,EAAMrsF,OAAO,CAAE1c,QAASg6D,EAAKh6D,QAAS2c,MAAOq9C,EAAKvK,QAAW,GAC9Ds5C,EAAM9vF,SACR,OACE,0BACEqwB,EAAG4/D,EAAa5/D,EAAI,EACpB/jC,EAAG6jG,EAAU,EACb3yF,IAAG,eAAUS,KAAKC,UAAU6iD,IAC5BgyB,WAAW,MACXC,iBAAiB,UACjBr2E,MAAO,CAAEqV,SAAU,QACnBjV,UAAWR,EAAQukD,iBAEjBC,EAAKvK,KAAO,GAAGyE,eAAe,kBAS1Co4B,GAAOriF,oBACX,YAQM,IAPJnJ,EAOI,EAPJA,MACA2U,EAMI,EANJA,SAMI,IALJ89C,cAKI,MALK,QAKL,EACIwM,EAAwCj/D,EAAxCi/D,UAAWmpC,EAA6BpoG,EAA7BooG,WAAYF,EAAiBloG,EAAjBkoG,MAAOD,EAAUjoG,EAAVioG,MAChC8F,EAAU7F,EAAMxrF,cAAcrE,cAC9B21F,EAAU/F,EAAMvrF,cAAcrE,cAC9B41F,EAAO/F,EAAMvsF,wBAA0BusF,EAAM/vF,SAC7C+1F,EAAUH,EAAQ,GAAG51F,SAAW+vF,EAAM/vF,SACtCg2F,EAAOlG,EAAMtsF,wBAA0BssF,EAAM9vF,SAC7Ci2F,EAAUJ,EAAQ,GAAG71F,SAAW8vF,EAAM9vF,SAC5C,OACE,yBACErD,MAAO,CAAEvB,WAAY,oBACrBuF,MAAOmmD,EACPnyC,OAAQs7E,GAEP,IACD,0BACE3jG,EAAGypG,EACH1lE,EAAG4/D,EAAa+F,EAChBr1F,MAAOm1F,EAAOC,EACdphF,OAAQqhF,EAAOC,EACf1rG,KAAK,SAEP,2BACGqrG,EAAQ/jG,KAAI,SAAAf,GACX,IAAMxE,EAAIwE,EAAOkP,SAAW+vF,EAAM/vF,SAClC,OACE,0BACExC,IAAKS,KAAKC,UAAUpN,GACpB48B,GAAIphC,EACJshC,GAAI,EACJD,GAAIrhC,EACJuhC,GAAIoiE,EACJ31C,OAAQA,OAIbu7C,EAAQhkG,KAAI,SAAAf,GACX,IAAMu/B,EAAI4/D,GAAcn/F,EAAOkP,SAAW8vF,EAAM9vF,UAChD,OACE,0BACExC,IAAKS,KAAKC,UAAUpN,GACpB48B,GAAI,EACJE,GAAIyC,EACJ1C,GAAIm5B,EACJj5B,GAAIwC,EACJiqB,OAAQA,OAId,0BAAM5sB,GAAIooE,EAAMloE,GAAI,EAAGD,GAAImoE,EAAMjoE,GAAIoiE,EAAY31C,OAAQA,IACzD,0BACE5sB,GAAI,EACJE,GAAIqiE,EAAa+F,EACjBroE,GAAIm5B,EACJj5B,GAAIoiE,EAAa+F,EACjB17C,OAAQA,KAGX99C,MAMM,YAAC9C,GAAiC,IACvC+qC,EAAc/qC,EAAd+qC,UACFkf,EAAalf,EAAUyxD,IACvB55C,EAAW7X,EAAU0xD,IAG3B,SAASC,EAAU1yF,EAAciW,GAC/B,OAAOjW,GAAU,CAACA,EAAM,GAAKiW,EAAKzB,KAAMxU,EAAM,GAAKiW,EAAK9C,KAE1D,IAAMw/E,EAAsBrlG,oBAC1B,YAA4C,UAAzCnJ,EAAyC,EAAzCA,MACOkoG,EAA6BloG,EAA7BkoG,MAAOD,EAAsBjoG,EAAtBioG,MAAOG,EAAepoG,EAAfooG,WAChB1zF,EAAU5B,KAF0B,EAGIya,qBAHJ,mBAGnCkhF,EAHmC,KAGlBC,EAHkB,OAIInhF,qBAJJ,mBAInCohF,EAJmC,KAIlBC,EAJkB,OAKArhF,qBALA,mBAKnCshF,EALmC,KAKpBC,EALoB,KAMpCl+E,EAAMjD,iBAAuB,MAC7B9C,EAAO8C,iBAAuB,MAC9BohF,EAAYphF,iBAAO,GACnBqhF,EAAYrhF,iBAAO,GACnBshF,EAAOthF,iBAAuB,MAC9BuhF,EAAOvhF,iBAAuB,MAC9BiV,EAAUjV,mBACV8sC,EAAQ9sC,iBAAO,GACf+sC,EAAY/sC,kBAAO,GACnBwhF,EAAQ,CAAE9+E,KAAM,EAAGrB,IAAK,EAAGlW,MAAO,EAAGgU,OAAQ,GAC7CsiF,GAAM,UAAAx+E,EAAI5C,eAAJ,eAAa+D,0BAA2Bo9E,EAC9CE,GAAQ,UAAAH,EAAKlhF,eAAL,eAAc+D,0BAA2Bo9E,EACjDG,GAAQ,UAAAL,EAAKjhF,eAAL,eAAc+D,0BAA2Bo9E,EACjDtF,EAAY0E,EAAUI,EAAiBS,GACvCG,EAAYhB,EAAUE,EAAiBW,GACvCtF,EAAUyE,EAAUM,EAAeO,GACnCI,EAAY1F,GAAWyF,EAoG7B,OAjGA3hF,qBAAU,WACR,SAASmtC,EAAQC,GACf,IAAMltC,EAAQmtC,KAAeD,GAC7BA,EAAUjtC,kBACgB,IAAtBitC,EAAUE,SACZT,EAAMzsC,SAAWF,EAAMqtC,OAAS,IAChCn7D,EAAMioG,MAAM7sC,eACVX,EAAMzsC,QAAU,EAAI,EAAIysC,EAAMzsC,QAAU,GAAK,EAAIysC,EAAMzsC,UAEzDhuB,EAAMkoG,MAAM9sC,eACVX,EAAMzsC,QAAU,EAAI,EAAIysC,EAAMzsC,QAAU,GAAK,EAAIysC,EAAMzsC,UAErD4U,EAAQ5U,SACV6D,aAAa+Q,EAAQ5U,SAEvB4U,EAAQ5U,QAAU4D,YAAW,WAC3B9M,uBAAY,WACV9kB,EAAMkoG,MAAM9sC,eAAe,GAC3Bp7D,EAAMioG,MAAM7sC,eAAe,GAC3Bp7D,EAAMkoG,MAAMprF,OACV29C,EAAMzsC,QAAU,EACZhuB,EAAMkoG,MAAMt5F,SAAW,EAAI6rD,EAAMzsC,SACjChuB,EAAMkoG,MAAMt5F,SAAW,EAAI6rD,EAAMzsC,UAEvChuB,EAAMioG,MAAMnrF,OACV29C,EAAMzsC,QAAU,EACZhuB,EAAMioG,MAAMr5F,SAAW,EAAI6rD,EAAMzsC,SACjChuB,EAAMioG,MAAMr5F,SAAW,EAAI6rD,EAAMzsC,aAGzCysC,EAAMzsC,QAAU,IACf,OAEH+gF,EAAU/gF,SAAWF,EAAMutC,OAC3B2zC,EAAUhhF,SAAWF,EAAMqtC,OACtBT,EAAU1sC,UACb0sC,EAAU1sC,SAAU,EAEpBljB,OAAO+vD,uBAAsB,WAC3B/1C,uBAAY,WACV9kB,EAAMkoG,MAAM3qF,OAAOwxF,EAAU/gF,SAC7BhuB,EAAMioG,MAAM1qF,OAAOyxF,EAAUhhF,YAE/B0sC,EAAU1sC,SAAU,EACpB+gF,EAAU/gF,QAAU,EACpBghF,EAAUhhF,QAAU,OAK5B,GAAI4C,EAAI5C,QAAS,CACf,IAAM8sC,EAAOlqC,EAAI5C,QAEjB,OADA8sC,EAAK3sC,iBAAiB,QAAS4sC,GACxB,WACLD,EAAK1sC,oBAAoB,QAAS2sC,IAGtC,OAAO,eACN,CAAC/6D,EAAMkoG,MAAOloG,EAAMioG,QAEvBr6E,qBAAU,WACR,SAASmiC,EAAgBjiC,GACvB4gF,EAAmB,CAAC5gF,EAAMi2B,QAASj2B,EAAMk2B,UAG3C,OADAl5C,OAAOqjB,iBAAiB,YAAa4hC,GAC9B,WACLjlD,OAAOsjB,oBAAoB,YAAa2hC,MAEzC,IAIHniC,qBAAU,WACR,IAAIgtC,EAAU,aAEd,SAAS3K,EAAcniC,GAEnB+7E,GACA0F,GACAhiG,KAAKsgD,IAAIg8C,EAAU,GAAK0F,EAAU,IAAM,GACxChiG,KAAKsgD,IAAIg8C,EAAU,GAAK0F,EAAU,IAAM,EAExCT,EAAiB,CAAChhF,EAAMi2B,QAASj2B,EAAMk2B,UAEvC4qD,OAAmBhsG,GAUvB,OANIinG,IAAcC,IAChBh/F,OAAOqjB,iBAAiB,UAAW8hC,GAAe,GAClD2K,EAAU,WACR9vD,OAAOsjB,oBAAoB,UAAW6hC,GAAe,KAGlD2K,IACN,CAACivC,EAAW0F,EAAWzF,IAGxB,yBAAKl5E,IAAK/F,EAAM3V,UAAWR,EAAQmW,MACjC,kBAAC4pC,EAAD,CAAUz0D,MAAOA,IAEjB,yBAAKkV,UAAWR,EAAQolB,WACtB,yBACEhlB,MAAO,CACLzE,QAAS,OACTqc,UAAW,UAAF,OAAY1sB,EAAMkoG,MAAMp0C,YAAxB,oBAA+C9zD,EAAMioG,MAAMn0C,YAA3D,OAGX,kBAACg6C,GAAD,CAAc9tG,MAAOA,IACrB,kBAAC2tG,GAAD,CAAgB3tG,MAAOA,IACvB,yBACE4wB,IAAKA,EACL9b,MAAO,CAAE7H,SAAU,YACnBiI,UAAWR,EAAQuW,SAElBukF,EACC,yBACE5+E,IAAKq+E,EACL/5F,UAAWR,EAAQq6C,QACnBj6C,MAAO,CACLub,KACEm/E,EAAU,IACT3F,GAAa2F,EAAU,GAAK3F,EAAU,GAAK,EACxCyF,EAAMx2F,MACN,GACNkW,IACEwgF,EAAU,IACT3F,GAAa2F,EAAU,GAAK3F,EAAU,GAAK,EACxCyF,EAAMxiF,OACN,KAbV,YAgBQqgF,GAAOqC,EAAU,GAAItH,IAC3B,6BAjBF,YAkBQiF,GAAO/E,EAAaoH,EAAU,GAAIvH,KAExC,KACH4B,GACD2F,GACAjiG,KAAKsgD,IAAIg8C,EAAU,GAAK2F,EAAU,IAAM,GACxCjiG,KAAKsgD,IAAIg8C,EAAU,GAAK2F,EAAU,IAAM,EACtC,yBACE5+E,IAAKs+E,EACLh6F,UAAWR,EAAQq6C,QACnBj6C,MAAO,CACLub,KACEw5E,EAAU,IACT2F,EAAU,GAAK3F,EAAU,GAAK,EAAI,EAAIwF,EAAMv2F,OAC/CkW,IACE66E,EAAU,IACT2F,EAAU,GAAK3F,EAAU,GAAK,EAAI,EAAIwF,EAAMviF,UATnD,YAYQqgF,GAAOtD,EAAU,GAAI3B,IAC3B,6BAbF,YAcQiF,GAAO/E,EAAayB,EAAU,GAAI5B,KAExC,KAEJ,yBACEz5E,KAAK,eACL1Z,MAAO,CAAE8X,OAAQ,aACjB0B,YAAa,SAAAR,GACU,IAAjBA,EAAM0tC,SACRozC,EAAmB,CAAC9gF,EAAMi2B,QAASj2B,EAAMk2B,UACzC0qD,EAAmB,CAAC5gF,EAAMi2B,QAASj2B,EAAMk2B,aAI7C,kBAAC,GAAD,CAAMhkD,MAAOA,GACV6pG,GAAa2F,EACZ,0BACE9sG,KAAK,oBACL+B,EAAG8I,KAAKC,IAAIgiG,EAAU,GAAI3F,EAAU,IACpCrhE,EAAGj7B,KAAKC,IAAIgiG,EAAU,GAAI3F,EAAU,IACpC/wF,MAAOvL,KAAKsgD,IAAI2hD,EAAU,GAAK3F,EAAU,IACzC/8E,OAAQvf,KAAKsgD,IAAI2hD,EAAU,GAAK3F,EAAU,MAE1C,OAGR,yBAAK30F,UAAWR,EAAQ0/C,UAE1B,yBAAKl/C,UAAWR,EAAQ0iD,SACrBp3D,EAAM+d,OAAO/T,KAAI,SAAAyU,GAAS,IAClBpO,EADkB,YACPoO,EAAMuE,SADC,MAEjB0hC,EAAuBr0C,EAAvBq0C,mBAER,OAAOA,EACL,kBAACA,EAAD,CACE/uC,IAAK0M,kBAAQ5D,EAAO,WACpBze,MAAOqQ,IAEP,SAGR,kBAAC,GAAD,CACE6e,KAAMe,QAAQ65E,GACdv4E,gBAAiB,SAACvoB,EAAGnG,GACnBA,IACAisG,OAAiBlsG,GACjBgsG,OAAmBhsG,IAErB4uB,QAAS,WACPs9E,OAAiBlsG,GACjBgsG,OAAmBhsG,IAErBshD,gBAAgB,iBAChBC,eACE0qD,EACI,CACE7/E,IAAK6/E,EAAc,GAAK,GACxBx+E,KAAMw+E,EAAc,GAAK,SAE3BjsG,EAENkS,MAAO,CAAE8Z,OAAQ,KACjBpL,UAAW,CACT,CACEhiB,MAAO,UACPokB,QAAS,WACHikF,GAAaC,GACf9pG,EAAMid,OAAO4sF,EAAWC,KAI9B,CACEtoG,MAAO,2BACPokB,QAAS,WACHikF,GAAaC,GACf9pG,EAAMoqG,cAAcP,EAAWC,cAmCrD,OAvBoB3gG,oBAAS,YAA4C,IAAzCnJ,EAAyC,EAAzCA,MACtBioD,EAAgCjoD,EAAhCioD,YAAa/C,EAAmBllD,EAAnBklD,QAASlgD,EAAUhF,EAAVgF,MACxB0P,EAAU5B,KAEhB,OAAKm1C,GAAgB/C,EAIjBlgD,EACK,uBAAGkQ,UAAWR,EAAQ1P,OAAQ2C,OAAO3C,IAE1CkgD,EAEA,6BACE,yCACA,kBAACuO,GAAA,EAAD,OAKC,kBAAC+6C,EAAD,CAAqBxuG,MAAOA,IAf1B,kBAAC87D,EAAD,CAAY97D,MAAOA,QCjsBjB,eAA4C,IAAzC48C,EAAyC,EAAzCA,UAEhB,OAAO,IADUA,EAAU,gDACpB,CAAa,CAClBx4C,KAAM,cACN+L,WAAYysC,EAAU6yD,IACtBjgG,eAAgBotC,EAAU8yD,OCyBtBliC,GAAeg9B,EAAfh9B,WAmCR,SAASmiC,GAAUliC,GAGjB,IAFA,IAAMU,EAAWX,GAAWC,GACxB3pE,EAAS,EACJJ,EAAI,EAAGA,EAAIyqE,EAASrqE,OAAQJ,GAAK,EAAG,CAC3C,IAAM+Y,GAAO0xD,EAASzqE,GAChBqqE,EAAKI,EAASzqE,EAAI,GACb,MAAPqqE,GAAqB,MAAPA,IAChBjqE,GAAU2Y,GAGd,OAAO3Y,EAGT,SAAS8rG,GAAsBniC,GAG7B,IAFA,IAAMU,EAAWX,GAAWC,GACxB3pE,EAAS,EACJJ,EAAI,EAAGA,EAAIyqE,EAASrqE,OAAQJ,GAAK,EAAG,CAC3C,IAAM+Y,GAAO0xD,EAASzqE,GAChBqqE,EAAKI,EAASzqE,EAAI,GACb,MAAPqqE,GAAqB,MAAPA,GAAqB,MAAPA,GAAqB,MAAPA,IAC5CjqE,GAAU2Y,GAGd,OAAO3Y,E,IAiBY+rG,G,4MACnBzrG,KAAO,gB,sDAECyN,GACNA,EAAc6xD,aAAY,kBAAM7xD,EAAc+qC,UAAUkzD,OAExDj+F,EAAcusC,gBAAe,WAC3B,IAAM3uC,Ed3FL,SAA6BoC,GAClC,OAAO8L,8BACL,iBACA,CACE28B,SAAU77C,QAAMC,SACdmT,EAAc0S,0BAA0B,YACxC,CAAE5U,KAAM,qBAGZ,CAAEmO,mBAAoB,YAAaD,iBAAiB,IckF7BkyF,CAAkCl+F,GACvD,OAAO,IAAItB,EAAY,CACrBnM,KAAM,iBACNqL,eACAU,WAAY6/F,GAAgCvgG,GAC5Ce,UAAW,eACXC,SAAU,cACVjB,eAAgBygG,QAIpBp+F,EAAc06D,iBACZ,kBACE,IAAIk+B,GAAgB,CAClBrmG,KAAM,kBACNqL,aAAcygG,GACd1gG,eAAgB2gG,QAItBt+F,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,aACNqL,aAAc2gG,GACdngG,aAAcwR,QAKpB5P,EAAcqpC,cAAa,kBAAM,IAAI2xD,GAAkBh7F,Q,gCAG/CA,GACJoyD,iCAAsBpyD,EAAc6oC,YACtC7oC,EAAc6oC,UAAUwpB,gBAAgB,CAAC,OAAQ,OAAQ,CACvD1iE,MAAO,eACPskB,KAAMuqF,KACNzqF,QAAS,SAACtC,GACRA,EAAQ8gD,QAAQ,cAAe,OAKrC,IAAMrC,EAAK,SAACzsD,EAAkBjF,GAC5B,OAAOiF,EACH,CACE,CACE9T,MAAO,yBACPskB,KAAMwqF,KACN1qF,QAAS,WACP,IAAMtC,EAAUnB,sBAAW9R,GACrBkgG,EAAUj7F,EAAQ1V,IAAI,WACtB6tE,EAAQn4D,EAAQ1V,IAAI,SACpBotE,EAAQ13D,EAAQ1V,IAAI,SACpB4wG,GACHl7F,EAAQ1V,IAAI,QACT0V,EAAQ1V,IAAI,QAAQ4wG,GACpBl7F,EAAQ1V,IAAI,QAAU,GACtBkzE,EAAWx9D,EAAQ1V,IAAI,QACvB6wG,EAAe,GAAH,OAAM39B,EAAN,aACZ49B,EAAgBruF,kBAEpBhS,EAAQiS,YACR,iBACA,GACI4D,EAAgB,CAACwqF,EAAeD,GAChC1uF,EAAU,SAAH,OAAYze,KAAK28C,OACxBt+B,EAAY,GAAH,OAAMmxD,EAAN,eAAqB49B,GAC9BC,EAA0BH,EAAG3wD,MAAM,KACtClpC,QAAO,SAAAi6F,GAAG,QAAMA,KAChB5mG,KAAI,SAAC4mG,EAAK70F,GAAU,MACyB60F,EAAI/wD,MAAM,KADnC,mBACZgxD,EADY,KACLC,EADK,KACIC,EADJ,KACcC,EADd,KAEbC,EArI1B,SAAwBxjC,GAGtB,IAFA,IAAMU,EAAWX,GAAWC,GACxBuF,EAAc,EACTtvE,EAAI,EAAGA,EAAIyqE,EAASrqE,OAAQJ,GAAK,EAAG,CAC3C,IAAM+Y,GAAO0xD,EAASzqE,GAChBqqE,EAAKI,EAASzqE,EAAI,GACb,MAAPqqE,GAAqB,MAAPA,GAAqB,MAAPA,IAC9BiF,GAAev2D,GAGnB,OAAOu2D,EA2HiCk+B,CAAeF,GAC/BG,EAAWxB,GAAUqB,GACrBI,EAAuBxB,GAAsBoB,GAC7CK,EAAkC,MAAbN,GAAoB,EAAI,EAC7CO,EAlG1B,SAAiB7jC,EAAel4D,GAC9B,OAAmB,IAAZA,IACDk4D,EAAMjrE,MAAM,eAAiB,IAAI,IAAM,IACvCirE,EAAMjrE,MAAM,iBAAmB,IAAI,IAAM,EA+FX+uG,CAAQP,EAASK,GAC7BG,GAAeV,EAAU,EAAIQ,EACnC,MAAO,CACLpyG,QAAS2xG,EACTxxG,MAAOmyG,EACPjyG,IAAKiyG,EAAcP,EACnBQ,UAAWN,EACXZ,QAASe,EACTI,MAAOV,EACPxwG,aAAckwG,EACdn7F,OAAQ87F,EACRvqF,SAAU,GAAF,OAAKxR,EAAQxV,KAAb,cAAuBic,GAC/Bw3D,KAAM,CACJl0E,MAAOiyG,EACP/xG,IAAK+xG,EAAYF,EACjBlyG,QAAS4zE,OAKXh8D,EAAOxB,EAAQ+R,SACrBvQ,EAAKy8D,KAAO,CACVr0E,QAAS4zE,EACTzzE,MAAOkxG,EACPhxG,IAAKgxG,EAAUX,GAAsBniC,IAMvC,IAAMkkC,EAGAhC,GADI,KAAR3iC,EACc2jC,EAAwB,GAAGe,MAC3BjkC,GAEVtyD,EAAW,CACfrE,GADY,mBAET65F,IAGLx1F,EAASsX,MAAK,SAAC7wB,EAAGC,GAAJ,OAAUD,EAAE2uG,QAAU1uG,EAAE0uG,WAEtC,IAAMqB,EAAYz2F,EAASjD,QACzB,SAACtW,EAAGimB,GAAJ,OAAUjmB,EAAIimB,EAAEtoB,IAAMsoB,EAAExoB,QACxB,GAGFikB,EAAQ8gD,QAAQ,cAAe,CAC7Bz0D,KAAM,cACNu4F,MAAO,CACL/vF,SAAU,EACVvJ,QAASgjG,EAAY,IACrB/4F,iBAAkBsC,EAASnR,KAAI,SAAA6d,GAC7B,MAAO,CACLxoB,MAAOwoB,EAAExoB,MACTE,IAAKsoB,EAAEtoB,IACPL,QAAS2oB,EAAE3oB,QACXsB,aAAckwG,OAIpBzI,MAAO,CACL9vF,SAAU,EACVvJ,QAAS+iG,EAAc,IACvB94F,iBAAkB,CAChB,CACErY,aAAciwG,EACdpxG,MAAO,EACPE,IAAKoyG,EACLzyG,QAAS4zE,KAIfq2B,iBAAkB,CAChB,CACEx5F,KAAM,eACNuW,gBACAC,QAAS,CACPxW,KAAM,oBACNwL,YAEF4G,UACA3d,KAAMud,IAGVynF,oBAAqB,CACnB,CACEhlG,KAAMqsG,EACN/5C,SAAU,CACR/mD,KAAM,yBACNoS,QAAS,GAAF,OAAK+wD,EAAL,YAAiBxvE,KAAK28C,OAC7B95B,QAAS,CACPxW,KAAM,4BACNwL,SAAU,CAAC7F,EAAQ+R,cAK3BnB,gBACAnI,OAAQ,CACN,CACEY,cAAeoD,EACfpS,KAAM,eACNqT,SAAU,CACR,CACErT,KAAM,iBACNgP,cAAe,GAAF,OAAKoD,EAAL,uBAKrBhR,YAAa,GAAF,OAAK+hE,EAAL,eAAoB49B,QAKvC,IAEN,SAASmB,EAAe/tF,GACJ,qBAAdA,EAAKnU,MACPmU,EAAK/F,OAAO9O,SAAQ,SAAAwP,GACC,oBAAfA,EAAM9O,MACR8O,EAAMuE,SAAS/T,SAAQ,SAAAoB,GAEF,wBAAjBA,EAAQV,MACPU,EAAQw3C,mCAAmC19C,SAAS43D,GAIpC,4BAAjB1xD,EAAQV,MACRU,EAAQ8lE,gBACP9lE,EAAQ8lE,cAActuB,mCAAmC19C,SACxD43D,IAGF1xD,EAAQ8lE,cAAc5rB,qCAAqCwX,GAR3D1xD,EAAQk6C,qCAAqCwX,SAezD9Y,mBAAQ,WAAM,MACN3lC,EAAO,UAAGzR,EAAc6oC,iBAAjB,aAAG,EAAyBp3B,QACrCA,GACFA,EAAQ7H,MAAMxM,SAAQ,SAAA6U,GAChBA,EAAKrI,MACPqI,EAAKrI,MAAMxM,SAAQ,SAAAnM,GAAC,OAAI+uG,EAAe/uG,MAEvC+uG,EAAe/tF,a,GA1OgB0nB,ICxF5B,gBAAA/7B,GACb,OAAO,4CAGL,cACS,CACLE,KAAMlR,gBADD,0BAELkgB,cAAeoE,iCAFV,GAGL+uF,gBAAiB,iBAAerzG,cAAYA,QAA3B,SAA0C,uBAC3DquB,OAJK,IAKLilF,qBALK,GAMLC,iBANK,EAOLC,UAAWxzG,YAAUA,YAAUA,QAP1B,YADT,OAUS,SAAA2B,GAAI,MAAK,CACd,kBACE,IAAMonB,EA/BhB,SAAqBjF,GACnB,IADiC,EAC3BiF,EAAN,GACQyqF,EAAc1vF,EAFW,yBAGV0vF,EAHU,YAGjC,2BAAyC,OAA9BC,EAA8B,uBACnBD,SADmB,YACvC,2BAAoD,KAAzCz/F,EAAyC,QAC9Cy/F,aAAJ,IACEzqF,oFAHmC,gCAHR,8BAYjC,SAmBwB2qF,CAAhB,GACA,8CACK9yF,GADL,IAEKxW,KAFL,yBAGE0Z,aAHF,EAIErU,OAAQ9N,gBAJV,SAKEonB,aAGJ,yBACE,OAAOpnB,SAAcA,EAAdA,iBAAsCA,EAA7C,sBAEF,8BACE,OAAOmN,SAASnN,EAATmN,wBAAP,KAEF,8BACE,OAAOA,SAASnN,SAATmN,GAAP,IAEF,uBACE,OAAOnN,yBAAP,UA/BN,SAkCW,SAAAA,GAAI,MAAK,CAChBgyG,wBADgB,YAOd,OALIphB,EAAY5wF,EAAhB,wBACM4wF,EAAY5wF,EAAhB,wBACEA,uBADF,EAEKA,uBAA4BA,EAA5BA,wBACAA,uBAA4BA,EAA5BA,wBACAA,EAAP,sBAEFiyG,qBATgB,YAcd,OAJkBjyG,EAAlB,qBACkBA,0BAChBA,uBADF,IAKFkyG,aAhBgB,gBAiBTlyG,gBAAL,IAAmCA,sBACpBA,gBAAf,GACA6jC,IAAWt8B,OAAXs8B,c,SC/DJsuE,GAAS,SAAAv/F,GAAK,MAAK,CACvB6X,KAAM,CACJtX,WAAYP,qBADR,QAEJoB,SAFI,OAGJgX,WAHI,EAIJC,cAAerY,UAJX,GAKJyY,YAAazY,UALT,GAMJqf,aAAcrf,UANV,GAOJ3C,QAPI,OAQJwlD,SAAU,QAEZ/1B,OAAQ,CACNhnB,MAAO,QAETlE,MAAO,KAmBT,IAAM49F,GAAkB,OAAAC,GAAA,OACtBtpG,oBAAS,gBAAG+oG,EAAH,WAAalyG,EAAb,QAAoB0U,EAApB,UAA6BuvB,EAA7B,gBACP,wBAAavR,UAAb,WAAkCxd,UAAWR,EAAQg+F,aACnD,wBAAWhgF,UAAU,UADvB,GAEE,wBAAW+V,KAAG,GACVxE,EAAD,OAKCA,EAAA,KAAW,SAAAzxB,GAAK,OACd,wBACEmD,IAAG,wBADL,GAEE0hF,QACE,uBACExxE,UAEI7lB,oBACAA,uBAAkC2H,OAJxC,KAOEyuB,SAAU,SAAA+/D,GAAG,OACXn2F,mBAAoCm2F,SADzB,YAKjB30F,MAAOgR,OApBX,wBAAgBsC,MAAO,CAAEb,YAAa,QADvC,4BA8BTu+F,aAA4B,CAC1BN,SAAUS,WADgB,WAE1B3yG,MAAOP,qCAFmB,WAG1BwkC,OAAQ0uE,YAAuBA,IAAvBA,QAA8CvzG,Y,IAGlDwzG,G,kDACJ,cAAmB,2BACjB,kBACA,MAAa,CAAEC,eAAgB,IAFd,IAGT7yG,EAAU4P,EAHD,aAIjB,kBAAuBkjG,oBACrB,WACE,IAAMC,EAAN,GAOA,OANA1wF,kBAAQriB,EAARqiB,6BAA2C,SAAA6vF,GACpCa,EAAL,KAAkCA,SAhE5C,SAAuB/yG,EAAOkyG,GAAU,MAC9B/2F,EAAwBnb,EADM,SACpBiyG,EAAcjyG,EADM,UAEhCikC,EAAS,IAAf,IAFsC,eAGhB9oB,EAHgB,cAGtC,2BAAyC,KAA9B7F,EAA8B,QACvC2uB,MAAW3uB,MAAX2uB,KAJoC,8BAMtC,GAAIguE,MAAJ,GAA6B,sBACPA,SADO,YAC3B,2BAAoD,KAAzCz/F,EAAyC,QAClDyxB,UAFyB,+BAK7B,OAAOrgC,WAAWqgC,EAAXrgC,UAAP,OAsDQovG,CAAchzG,EAAdgzG,YAAuC,SAAAxgG,GACrCugG,iBAGJ,KAEF,SAAAA,GACE,YAAc,SAAA7vD,GACZ,IAAM2vD,EAAN,GAOA,OANA/wG,wBAAuC,SAAAowG,GACrCW,gCACM3vD,qBADN2vD,IAEKE,EAFLF,OAKK,CAAEA,uBAGb,CAAEvsD,MAAO,MA3BM,E,mEAgCjBz9C,KAAA,oB,+BAGO,MAC2BA,KAD3B,MACC6L,EADD,UACUI,EADV,QACiB9U,EADjB,QAEC6yG,EAAmBhqG,KAFpB,qBAGP,OACE,yBAAKiM,MAAL,EAAmBI,UAAWR,EAAQmW,MACpC,yBAAK3V,UAAWR,EAAQorB,QACtB,wBACE5qB,UAAWR,EADb,MAEES,QAFF,YAGE89F,cAAY,GALlB,YAUGnxG,OAAA,oBAEM,SAAAowG,GAAQ,OACX,sBACEv8F,IADF,EAEEu8F,SAFF,EAGElyG,MAHF,EAIEikC,OAAQniC,YAAY+wG,EAAZ/wG,qB,GAzDOgmG,aA0E7B8K,gBAA8B,CAAE99F,MAAO,IAExB29F,wBAAmBtpG,mBAAlC,KC7JM2J,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC3C,QAAS,CACPkD,WADO,QAEPuZ,OAFO,OAGP1Y,SAAU,UAEZ8+F,aAAc,CACZvkF,UADY,OAEZyB,UAAW,UAEb+iF,eAAgB,CACd5/F,WAAYP,qBAAyB8b,aAkC1B3lB,2BA9Bf,SAAgCyG,GAAO,IAC7B5P,EAAU4P,EADmB,MAE/B8E,EAAU5B,KACRsgG,EAA+DpzG,EAHlC,mBAGT+xG,EAA2C/xG,EAHlC,qBAGagyG,EAAqBhyG,EAHlC,iBAIrC,OACE,yBAAKkV,UAAWR,EAAQrE,SACtB,yBACE6E,UAAWR,EADb,aAEEI,MAAO,CAAEgY,OAAQsmF,IAEjB,qBALJ,IAOE,sBACEjmF,OAAQntB,EADV,qBAEE8U,MAAO,CACLgY,OADK,EAELvZ,WAFK,OAGLgB,UAHK,aAIL4lD,UAAW,uBAGf,oCAAgBrlD,MAAO,CAAEgY,OAAQilF,IAjBrC,Q,mNChBA3tG,KAAO,uB,sDAECyN,GACNA,EAAcusC,gBAAe,WAC3B,IAAM3uC,ECRL,YACL,OAAOkO,8BAAoB,yBAEzB,CACE01F,iBAAkB,CAChB1jG,KADgB,cAEhBiO,aAAc,CAFE,QAGhB5M,YAAa,oDAGjB,CACEi6C,kBAAmBuY,GADrB,GAEE3lD,iBAAiB,IDJIy1F,CACnBzhG,GAEF,OAAO,IAAItB,EAAY,CACrBnM,KAAM,yBACNqL,eACAU,WAAYojG,GAAmC9jG,GAC/Ce,UAAW,eACXC,SAAU,mBACVjB,eAAgBgkG,Y,GAdKhoE,I,2EEkC3B,WAAmBt9B,GAAyC,2BAC1D,cAAMA,IALEulG,SAIkD,IAFlDC,oBAEkD,EAE1D,IAAMtzF,EAAgB/R,yBAAeH,EAAQ,iBACvC6R,EAAY1R,yBAAeH,EAAQ,CAAC,QAAS,cAC7CrG,EAAWwG,yBAAeH,EAAQ,CAAC,QAAS,aAC5CwlG,EAAiBrlG,yBAAeH,EAAQ,kBALY,OAO1D,EAAKwlG,eAAiBA,GAAkB,CAAC,aAAc,SAAU,UACjE,EAAKD,IAAM,IAAI1xB,oBAAiB,CAC9B/zE,WAAYjG,wBAAaqY,GACzBqxD,cAA6B,QAAd1xD,EAAsBhY,wBAAaF,QAAYjF,EAC9Do/E,cAA6B,QAAdjiE,EAAsBhY,wBAAaF,QAAYjF,EAC9Dq/E,eAAgB,GAAK,KAAL,IAAK,EAAK,IAC1B0xB,cAAe,SAACp3F,GAAD,OAAeA,KAb0B,E,6LAiBnCrX,E,+BAAoB,G,kBACpC2D,KAAK4qG,IAAIvxB,0BAA0Bh9E,I,wIAGzB+7D,GAAiD,WAAxB/7D,EAAwB,uDAAJ,GAC9D,OAAOgE,aAAgB,uCAAU,WAAMC,GAAN,eAAAvH,EAAA,sEACR,EAAK6xG,IAAIG,cADD,OACzBnlG,EADyB,OAE/B,EAAKolG,kBAAkB5yC,EAAO/7D,EAAMuJ,EAAUtF,GAAU,GAFzB,2CAAV,sDAGpBjE,EAAKgC,U,iFAIR+5D,G,iHACA/7D,E,+BAAoB,GACpBuJ,E,uBACAtF,E,uBACA2qG,E,uBACAC,E,+BAAgB9yC,E,SAGR+yC,EAAuB,G,SAEvBnrG,KAAK4qG,IAAItxB,SACblhB,EAAM/hE,QACN+hE,EAAM5hE,MACN4hE,EAAM1hE,KACN,SAAC8iF,EAAcC,GACb0xB,EAAM1jG,KAAK,EAAKgxE,UAAU7yE,EAASwlG,cAAe5xB,EAAMC,O,WAGxDwxB,IAAmBE,EAAMlwG,O,oBACvBowG,EAAWhnG,IACXinG,GAAUjnG,IACd8mG,EAAM/kG,SAAQ,SAAAozE,GACZ,IAAM+xB,EAAc/xB,EAAKsqB,OAAO,GAGhC,IAAK,EAAK+G,eAAevpG,SAASiqG,GAAc,CAC9C,IAAM/0G,EAAQgjF,EAAKhjF,MAAQ,EACvBA,EAAQ60G,IACVA,EAAW70G,GAETgjF,EAAK9iF,IAAM40G,IACbA,EAAS9xB,EAAK9iF,WAIhB40G,EAASlzC,EAAM1hE,KAAO20G,EAAWjzC,EAAM5hE,O,wBAOzCwJ,KAAKgrG,kBAAL,2BACO5yC,GADP,IACc5hE,MAAO60G,EAAU30G,IAAK40G,IAClCjvG,EACAuJ,EACAtF,GACA,EACA83D,G,2BAMAozC,EAAOL,EACVhqG,KAAI,SAACsqG,GAOJ,OANIA,EAAW3H,OAAO,IAA+B,MAAzB2H,EAAW3H,OAAO,GACvC2H,EAAW3H,OAAO,GAAGxiG,SAAS,eACjCmqG,EAAW3H,OAAO,IAAlB,qBAAsC2H,EAAWC,WAEnDD,EAAW3H,OAAO,GAAlB,oBAAoC2H,EAAWC,UAE1CD,EAAW3H,OAAOv6F,KAAK,SAE/BA,KAAK,MAESqhG,KAAIe,gBAAgBH,EAAM,CACzCI,eAAe,EACfC,eAAe,EACfC,iBAAiB,EACjBC,gBAAgB,IAGT3lG,SAAQ,SAAA4lG,GAAW,OAC1B,EAAKC,eAAeD,GAAa5lG,SAAQ,SAAA4Y,GAErCrQ,GACEqQ,EAAEjoB,IAAI,SACNioB,EAAEjoB,IAAI,OACNm0G,EAAc10G,MACd00G,EAAcx0G,MAGhB4J,EAASgG,KAAK0Y,SAIpB1e,EAASS,W,kDAETT,EAASnE,MAAT,M,iJAKFivG,EACA5xB,EACAC,GAEA,IAAMqqB,EAAStqB,EAAKxiC,MAAM,MAG1B,MAAO,CACLxgD,OAAQstG,EAAOsH,EAAc50G,MAAQ,GACrCE,KAAMotG,EAAOsH,EAAc10G,IAAM,GACjCg1G,SAAUjyB,EACVqqB,Y,qCAImBkI,GAA2B,WAChD,OAAOA,EAAY7qG,KACjB,SAAA+qG,GAAU,OACR,IAAInuF,GAAc,CAChBle,KAAM,EAAKsO,YAAY+9F,GACvBj1G,GAAI,GAAF,OAAK,EAAKA,GAAV,mBAAuBi1G,EAAW/+F,WAAWg/F,UAAU,W,kCAK7CtsG,GAAkB,WAC9Bmf,EAA6B,eAAKnf,GAEtCmf,EAAExoB,OAAoB,EACxBwoB,EAAEtS,OAAS,CAAE,IAAK,EAAG,KAAM,EAAG,IAAK,EAAG,SAAK3S,GAAY8F,EAAK6M,QAC5DsS,EAAEyzB,MAAQuG,OAAOn5C,EAAK4yC,OACtBzzB,EAAE3oB,QAAUwJ,EAAKqoE,OACE,OAAfroE,EAAK28D,cACAx9C,EAAEw9C,MAEQ,OAAf38D,EAAK4yC,cACAzzB,EAAEw9C,MAEX,IAAM4vC,EAAgB,CACpB,QACA,MACA,SACA,QACA,OACA,SACA,QACA,UAgCF,OA9BAnzG,OAAOC,KAAK2G,EAAKsN,YAAY/G,SAAQ,SAAArN,GACnC,IAAIC,EAAID,EAAEgU,cAMV,GALIq/F,EAAc9qG,SAAStI,KAGzBA,GAAK,KAEoB,OAAvB6G,EAAKsN,WAAWpU,GAAa,CAC/B,IAAIszG,EAAOxsG,EAAKsN,WAAWpU,GAC3B,GAAIgC,MAAMC,QAAQqxG,IAAyB,IAAhBA,EAAKpxG,OAAc,OAClCoxG,EAARA,EAD0C,oBAG9CrtF,EAAEhmB,GAAKqzG,MAGXrtF,EAAE3oB,QAAU2oB,EAAEkpD,OAGVroE,EAAKysG,gBAAkBzsG,EAAKysG,eAAerxG,SAC7C+jB,EAAEb,YAActe,EAAKysG,eAClBnrG,KAAI,SAAAorG,GAAS,OAAIA,EAAUprG,KAAI,SAAAqrG,GAAQ,OAAI,EAAKr+F,YAAYq+F,SAC5DC,eAGEztF,EAAEstF,sBACFttF,EAAEnf,YACFmf,EAAE0tF,wBACF1tF,EAAE2tF,iBACF3tF,EAAE7R,kBACF6R,EAAEkpD,OACFlpD,I,8CA9MkBtf,2BCnCdoV,iCACb,mBACA,CACEyC,cAAe,CACbzQ,KAAM,eACNiO,aAAc,CAAEhd,IAAK,uBAEvBmb,MAAO4B,8BAAoB,iBAAkB,CAC3CoC,UAAW,CACT/f,MAAOvB,QAAMo/D,YAAY,YAAa,CAAC,MAAO,QAC9CluD,KAAM,aACNiO,aAAc,OAEhB/V,SAAU,CACR8H,KAAM,eACNiO,aAAc,CAAEhd,IAAK,6BAGzB8yG,eAAgB,CACd/jG,KAAM,cACNiO,aAAc,CAAC,aAAc,YAGjC,CAAEC,iBAAiB,I,+MCjBnBzZ,KAAO,kB,sDAECyN,GACNA,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,mBACNqL,aAAcgmG,GACdxlG,aAAcylG,Y,GATKlqE,I,iCCHvBmqE,GAAW,CAAEz2G,QAAS,UAEtB02G,GAAW,CAAE7kC,OAAQ,WAKN8kC,G,WASnB,WAAYC,EAAgBj3F,EAAkB/e,GAAa,yBAPnDg2G,eAOmD,OALnDjvF,kBAKmD,OAHnDC,cAGmD,EACzDje,KAAKitG,UAAYA,EACjBjtG,KAAKie,SAAWhnB,GAAMg2G,EAAUh2G,KAChC+I,KAAKge,aAAehI,E,kDAIpB,MAAM,IAAI/Y,MAAM,qB,qCAGHqM,GAGb,OADewjG,GAASxjG,IAAQA,GAClByD,gB,qCAGDzD,GACb,IAAM+2B,EAAI/2B,EAAIyD,cAGd,OADeggG,GAAS1sE,IAAMA,I,0BAK5BgpE,GAAuB,WACnBgD,EAAOrsG,KAAKitG,UAAUl2G,IAAIiJ,KAAKktG,eAAe7D,IACpD,OAAIgD,GAAqB,gBAAbhD,EAEHgD,EAAKlrG,KAAI,SAACgsG,GAAD,OAAqB,IAAIH,EAAcG,EAAY,MAC9Dd,I,6BAMQ,WACf,OAAOrsG,KAAKitG,UAAU9kC,OAAOhnE,KAAI,SAACk/B,GAAD,OAAe,EAAK+sE,eAAe/sE,Q,2BAOpE,OAAOrgC,KAAKie,W,+BAOZ,OAAOje,KAAKge,e,iCAOZ,OAAOhe,KAAKjJ,IAAI,iB,+BAGgB,WAC1B8I,EAAgC,CAAEoe,SAAUje,KAAK/I,MAavD,OAZA+I,KAAKitG,UAAU9kC,OAAO/hE,SAAQ,SAACkD,GAC7B,IAAM+jG,EAAY,EAAKD,eAAe9jG,GAChCK,EAAQ,EAAKsjG,UAAUl2G,IAAIuS,GACf,gBAAd+jG,EACFxtG,EAAKse,aAAexU,GAAS,IAAIxI,KAAI,SAAC6d,GAEpC,OAAO,IAAIguF,EAAchuF,EAAG,GAAMR,YAGpC3e,EAAKwtG,GAAa1jG,KAGf9J,M,KC/EUytG,G,kDAMnB,WAAYjoG,GAAyC,2BACnD,cAAMA,IALAkoG,YAI6C,IAF7CC,oBAE6C,EAEnD,IAAMnsG,EAAWmE,yBAAeH,EAAQ,YAClC2S,EAAkBxS,yBAAeH,EAAQ,mBAHI,OAInD,EAAKmoG,eAAiBnsG,EAEtB,EAAKksG,OAAS,IAAIE,KAAY,CAC5B5gC,QAAS,GACT6gC,YAAa11F,EAAgBjgB,IAC7BqL,SAAU,SAACvK,GAAD,OACR8F,mBACEqZ,EAAgBhgB,QACZ,IAAIoH,IAAIvG,EAAKmf,EAAgBhgB,SAASsC,WACtCzB,GACJuK,cAd6C,E,wDA0BzChD,GAAwC,WAAxB/D,EAAwB,uDAAJ,GAC9C,OAAOgE,aAAgB,uCAAU,WAAMC,GAAN,6BAAAvH,EAAA,sDACvBsF,EAAWhC,EAAXgC,OADuB,kCAEH,EAAKkvG,OAAO7sG,YAAYN,EAAQ/D,IAF7B,yHAEdoQ,EAFc,EAG7BhM,4BAAiBpC,GACjBiC,EAASgG,KAAK,EAAKqnG,YAAYlhG,IAJF,iTAM/BnM,EAASS,WANsB,4EAAV,yD,kCAWbksG,GACV,OAAO,IAAID,GACTC,OACAlzG,EAFK,UAGFiG,KAAK/I,GAHH,YAGSg2G,EAAUh2G,S,iFAIJZ,G,uFACH2J,KAAKutG,OAAOK,YAAYv3G,G,cAArC2rB,E,4BACIA,GAAQA,EAAK+W,OAAS/W,EAAK+W,MAAMkjC,e,2IAQ3C,OAAOjpC,QAAQC,QAAQjzB,KAAKwtG,gBAAkB,M,8CA9DP9tG,2BCd5BoV,iCACb,gBACA,CACEkD,gBAAiB,CACflR,KAAM,eACNiO,aAAc,CAAEhd,IAAK,wCAEvBsJ,SAAU,CACRyF,KAAM,cACNiO,aAAc,GACd5M,YAAa,0DAGjB,CAAE6M,iBAAiB,ICZNF,iCACb,qBACA,CACE+4F,gBAAiB,CACf/mG,KAAM,eACNiO,aAAc,CAAEhd,IAAK,mCACrBoQ,YACE,uGAGN,CAAEi6C,kBAAmBwwC,K,iECPhB,SAASkb,GAAazoG,EAAyBxM,GACpD,GAAsB,kBAAXwM,EAAqB,CAC9B,IAAI0oG,EACJ,IACEA,EAAaxgG,KAAKW,MAAM7I,GACxB,MAAOlJ,GACP,MAAM,IAAIc,MAAJ,UAAad,EAAb,iCAER,OAAO6xG,GAAeD,EAAYl1G,GAEpC,OAAOm1G,GAAe3oG,EAAQxM,GAGzB,SAASo1G,GAAa5oG,EAAgBxM,GAC3C,IAAIk1G,EACJ,IACEA,EAYJ,SAAehpG,EAAclM,GAC3B,IACIq1G,EACAC,EACAxkG,EAEAykG,EALAC,EAAoB,GAIlBxuG,EAAe,CAAEqV,OAAQ,IAG/B,SAASo5F,IAEL,IAAIC,EADN,QAAcx0G,IAAV4P,EAQF,IAEE,IAAMhQ,EAAQgQ,EAAMhQ,MAAM,eAO1B,GANW40G,EAAP50G,EAAqB4T,KAAKW,MAAMvU,EAAM,IAEjC,gCAAgCmC,KAAK6N,GAC9B+1D,WAAW/1D,EAAMjQ,QAAQ,KAAM,KAC5BiQ,GAEdukG,EACH,MAAM,IAAIjxG,MAAJ,mCAAsCoxG,EAAQ9kG,KAAK,SAC3D,IAAMzG,EAAOurG,EAAQpwE,OAAOiwE,GAAS3kG,KAAK,KAC1C,GAAkB,OAAd4kG,EAAoB,CACtB,IAAIK,EAAW10G,KAAS+F,EAAMiD,GAC1B0rG,EACGzzG,MAAMC,QAAQwzG,KAAWA,EAAW,CAACA,IACrCA,EAAW,GAElBA,EAAS/mG,KAAK8mG,GACdA,EAAcC,EAEI,SAAhBD,IAAwBA,GAAc,GACtB,UAAhBA,IAAyBA,GAAc,GAC3C/hF,KAAS3sB,EAAMiD,EAAMyrG,GACrB,MAAOtyG,GACP,MAAM,IAAIgB,MAAJ,sBACWpE,EAAM,OAAH,OAAUA,GAAQ,IADhC,OAEFu1G,EAAa,YAAH,OAAeA,EAAa,GAAM,MA2DtD,OApDArpG,EAAKiyC,MAAM,MAAM5wC,SAAQ,SAACqoG,EAAU5zG,GAClCuzG,EAAavzG,EAAI,EACjB,IAGIlB,EAHE6/E,EAAOi1B,EAAS/0G,QAAQ,UAAW,IAIzC,GAAKC,EAAQ6/E,EAAK7/E,MAAM,kBAEtB20G,IACAJ,OAAUn0G,EACV4P,OAAQ5P,EAEe,KADvBs0G,EAAU10G,EAAM,GAAGq4F,OAAOh7C,MAAM,aACpB/7C,QAA6C,YAA7BozG,EAAQ,GAAGthG,gBACrCshG,EAAU,SAGT,GACF10G,EAAQ6/E,EAAK7/E,WACFI,IAAV4P,EAAsB,sBAAwB,yBAEhD,CACA2kG,IACAJ,EAAUv0G,EAAM,GAAGq4F,OAAOh7C,MAAM,YAFhC,MAGmBr9C,EAHnB,mBAGMw0G,EAHN,KA3EY,YA+EME,EAAQpwE,OAAOiwE,GAAS3kG,KAAK,OAC7C4kG,EAAY,MAEdxkG,EAAQhQ,EAAM,GAAGq4F,iBAILj4F,IAAZm0G,IACCv0G,EAAQ6/E,EAAK7/E,MAAM,uBAEpB20G,IACAH,EAAY,KACZxkG,EAAQhQ,EAAM,GAAGq4F,aAGAj4F,IAAV4P,IAAwBhQ,EAAQ6/E,EAAK7/E,MAAM,eAClDgQ,GAASA,EAAM1O,OAAN,WAAmBtB,EAAM,GAAGq4F,QAAWr4F,EAAM,GAAGq4F,QAIzDsc,IACAJ,OAAUn0G,EACV4P,OAAQ5P,MAIZu0G,IAEOzuG,EAnHQqO,CAAM7I,EAAQxM,GAC3B,MAAOsD,GACP,MAAM,IAAIc,MAAJ,UAAad,EAAb,iCAER,OAAO6xG,GAAeD,EAAYl1G,GAyH7B,SAASm1G,GAAeryG,EAAc9C,GAE3C,GAAI8C,EAAKuZ,SAAWna,MAAMC,QAAQW,EAAKuZ,QAErC,GAAIzc,aAAQkD,EAAKuZ,QAASvZ,EAAKuZ,OAAS,CAACvZ,EAAKuZ,YAEzC,CAEH,IADA,IAAMA,EAAkB,GACxB,MAAoBjc,OAAOC,KAAKyC,EAAKuZ,QAArC,eAA8C,CAAzC,IAAMvc,EAAK,KACRid,EAAQja,EAAKuZ,OAAOvc,GACtBF,aAAQmd,GAAQV,EAAOzN,KAAKmO,GAC3BV,EAAOzN,KAAP,aAAc9O,SAAUid,IAE/Bja,EAAKuZ,OAASA,EAKlB,IAAMw5F,EAAO/yG,EAAKgzG,cAClB,GAAID,GAAQA,EAAKE,QAAS,CAKxB,GAH4B,kBAAjBF,EAAKE,UAAsBF,EAAKE,QAAU,CAACF,EAAKE,UACvDh2G,aAAS81G,EAAKE,WAAUF,EAAKE,QAAU,CAACF,EAAKE,WAE5C7zG,MAAMC,QAAQ0zG,EAAKE,SAAU,CAEhC,IADA,IAAMA,EAAoB,GAC1B,MAAmB31G,OAAOC,KAAKw1G,EAAKE,SAApC,eAA8C,CAAzC,IAAMrzG,EAAI,KACPF,EAASqzG,EAAKE,QAAQrzG,GACtB,SAAUF,IAASA,EAAOE,KAAOA,GACvCqzG,EAAQnnG,KAAKpM,GAEfqzG,EAAKE,QAAUA,EAIjBF,EAAKE,QAAUF,EAAKE,QAAQztG,KAC1B,SAAC0tG,GACC,GAAyB,kBAAdA,EAAwB,CACjC,IAAMC,EAAuB,CAAEj2G,IAAKg2G,GAC9BE,EAAYF,EAAUl1G,MAAM,YAElC,OADIo1G,IAAWD,EAAahoG,KAAOioG,EAAU,GAAGhiG,eACzC+hG,EAET,OAAOD,KAWb,GANAlzG,EAAKqzG,UAAYrzG,EAAKqzG,WAAan2G,EAC/B8C,EAAKqzG,UAAUnsG,WAAW,OAC5BlH,EAAKqzG,UAAY,IAAI5vG,IAAIzD,EAAKqzG,UAAW/sG,OAAOjD,SAASK,MAAMA,MACjE1D,EAAKkxE,QAAUlxE,EAAKkxE,SAAW,IAAIztE,IAAI,IAAKzD,EAAKqzG,WAAW3vG,KACxD1D,EAAKkxE,QAAQ5xE,SAAWU,EAAKkxE,QAAQz1D,SAAS,OAAMzb,EAAKkxE,SAAW,KAEpElxE,EAAKqzG,UAAW,CAGlB,IAAMC,EAAqC,GACvCtzG,EAAKuZ,QAAQ+5F,EAAQxnG,KAAR,MAAAwnG,EAAO,YAAStzG,EAAKuZ,SAClCvZ,EAAKuzG,QAAQD,EAAQxnG,KAAR,MAAAwnG,EAAO,YAASh2G,OAAOmiC,OAAOz/B,EAAKuzG,UAChDvzG,EAAKwzG,OAAOF,EAAQxnG,KAAK9L,EAAKwzG,OAElCF,EAAQ7oG,SAAQ,SAACi6B,GACVA,EAAEwsC,UAASxsC,EAAEwsC,QAAUlxE,EAAKkxE,SAAW,QAI1ClxE,EAAKyzG,SAAmC,kBAAjBzzG,EAAKyzG,UAC9BzzG,EAAKyzG,QAAU,IAAIhwG,IAAIzD,EAAKyzG,QAASzzG,EAAKqzG,WAAW3vG,MACnD1D,EAAK0zG,UAAS1zG,EAAK0zG,QAAU,IAAIjwG,IAAIzD,EAAK0zG,QAAS1zG,EAAKqzG,WAAW3vG,MAuCzE,OApCA1D,EAAKuzG,OAASvzG,EAAKuzG,QAAU,IAC3BvzG,EAAKuZ,QAAU,IAAI9O,SAAQ,SAACizF,GAG5B,GAAIA,EAAYh0F,OAAQ,CACtB,IAAMiZ,EAAI+6E,EAAYh0F,cACfg0F,EAAYh0F,OACnBg0F,EAAc,2BAAK/6E,GAAM+6E,GAM3B,IAAIiW,EAFAjW,EAAYtvB,QAIdulC,EADuB,iBAArBjW,EAAYvyF,KACG,kCACW,eAArBuyF,EAAYvyF,KACF,gCACW,sBAArBuyF,EAAYvyF,KACF,uCACW,kBAArBuyF,EAAYvyF,KACF,8BAEAyoG,GAAgB,qBAAsBlW,EAAYvyF,MAErEuyF,EAAYvyF,KAAOwoG,EAEnBE,GAA2B7zG,EAAM09F,GAE7BA,EAAYoW,aACTpW,EAAYoW,WAAW5iC,UAC1BwsB,EAAYoW,WAAW5iC,QAAUwsB,EAAYxsB,SAC/C2iC,GAA2B7zG,EAAM09F,EAAYoW,iBAI1C9zG,EAQT,SAAS4zG,GAAgBvtF,EAAc3V,GACrC,OAAKA,GACAA,EAAU/K,SAAS,OAAM+K,EAAY,GAAH,OAAM2V,EAAN,YAAc3V,IACrDA,EAAYA,EAAU3S,QAAQ,MAAO,KAFd,GA2CzB,SAAS81G,GACPE,EACArW,GACM,IAKFsW,EALE,EAGuBtW,EAArBqU,mBAHF,MAGgB,GAHhB,EAUN,GAHEiC,EADEtW,EAAYsW,WACDJ,GAAgB,gBAAiBlW,EAAYsW,YA/C9D,SACEtW,EACAqU,GAEA,OAAKrU,EACDA,EAAYvyF,MAAQuyF,EAAYvyF,KAAKxF,SAAS,eACzC,iCAAP,OACiC,IAA/B+3F,EAAYuW,eAAuB,MAAQ,IAE3C,aAAa9zG,KAAK4xG,GACb,kCAAP,OACiC,IAA/BrU,EAAYuW,eAAuB,MAAQ,IAE3C,UAAU9zG,KAAK4xG,GAAqB,+BACpC,WAAW5xG,KAAK4xG,GAAqB,gCACrC,YAAY5xG,KAAK4xG,GAAqB,gCACtC,UAAU5xG,KAAK4xG,GAAqB,+BACpC,eAAe5xG,KAAK4xG,GACf,oCACL,iBAAiB5xG,KAAK4xG,GACjB,qCACL,eAAe5xG,KAAK4xG,GACf,oCACL,kBAAkB5xG,KAAK4xG,GAClB,kCACL,kBAAkB5xG,KAAK4xG,GAClB,kCACL,iBAAiB5xG,KAAK4xG,GACjB,wCACL,uBAAuB5xG,KAAK4xG,GACvB,6CACL,WAAW5xG,KAAK4xG,GAAqB,kCACrCrU,EAAYvyF,MAAQuyF,EAAYvyF,KAAKsQ,SAAS,aACzC,uCACF,GA9BkB,GA4CPy4F,CAAgBxW,EAAaqU,GAE/C,CAQA,IAAMoC,EAAmB,2BAAKzW,GAAR,IAAqBvyF,KAAM6oG,IAK/B,yCAAfA,GACgB,wCAAfA,GACe,0CAAfA,GACe,+CAAfA,GACe,oCAAfA,GACe,kCAAfA,IACAtW,EAAY0W,kBACZL,EAASR,QAAUQ,EAASR,OAAOc,QAIrCF,EAAUv0G,KAAV,eAAyBnC,aAAkB02G,IAF3CA,EAAUv0G,KAAO,UAKdm0G,EAASR,SAAQQ,EAASR,OAAS,IACxCQ,EAASR,OAAOY,EAAUv0G,MAAQu0G,EAGlCzW,EAAYtvB,MAAQ+lC,EAAUv0G,UA9B5BW,QAAQ4H,KAAR,2EACsEu1F,EAAY1gG,MADlF,oECrTJ,SAASoG,GAAcC,GACrB,YAAyCjF,IAAjCiF,EAAyBjH,IAGnC,SAASkH,GACPD,GAEA,YAAqDjF,IAA7CiF,EAA+BnH,U,8CAGlC,kEAAAkB,EAAA,yDACLk3G,EADK,+BACkB,CAAEl4G,IAAK,IAC9Bm4G,EAFK,+BAEgB,CACnBC,QAAS,CAAC,4BAA6B,2BAEzCC,EALK,+BAKwB,CAAEr4G,IAAK,IAE9Bgf,EAAW,QAASk5F,EAAW,MAAQ,YACvCI,EAAc9iG,KAAKW,MAAMX,KAAKC,UAAUyiG,IAC1CK,EAAmB,GACnBvxG,GAAckxG,KAAWK,EAAmBL,EAASl4G,KACrDkH,GAAoBgxG,KAAWK,EAAmBL,EAASp4G,WAC3Dy4G,EAAiBl5F,SAAS,OAC5Bi5F,EAAYt5F,GAAYu5F,EAAiBpwG,MACvC,EACAowG,EAAiBr1G,OAAS,MAG3B8D,GAAcqxG,IAAmBA,EAAer4G,KAChDkH,GAAoBmxG,IAAmBA,EAAev4G,WAnBpD,iBAqBG04G,EAAe,QAASH,EAAiB,MAAQ,YACnDI,EAAqB,GACrBzxG,GAAcqxG,KAAiBI,EAAqBJ,EAAer4G,KACnEkH,GAAoBmxG,KACtBI,EAAqBJ,EAAev4G,WAClC24G,EAAmBp5F,SAAS,OAC9Bo5F,EAAqBA,EAAmBtwG,MACtC,EACAswG,EAAmBv1G,OAAS,IAE5Bw1G,EAAoB,GA/BrB,MAgCgB,CAAC,eAAgB,qBAhCjC,iDAgCQ90G,EAhCR,KAiCG+0G,EAAgB,KAjCnB,oBAqCuBC,GAAgB,gBACnCJ,EADkC,UAChBC,EADgB,YACM70G,KAtC5C,QAqCC+0G,EArCD,0DAyCCx0G,QAAQC,MAAR,0BACqBq0G,EADrB,YAC2C70G,EAD3C,iBAzCD,QA6CD80G,EAAYG,GAAaH,EAAWC,IAAkB,GA7CrD,2CA+CCL,EAAYt5F,KAAW05F,EAAUR,SAAWI,EAAYt5F,IA/CzD,kBAgDI85F,GAAkBJ,IAhDtB,eAkDCA,EAAYzC,GAAekC,EAAYjuG,OAAOjD,SAASK,MACzDgxG,EAAYt5F,KAAW05F,EAAUR,SAAWI,EAAYt5F,IAnDvD,kBAoDE85F,GAAkBJ,IApDpB,4D,sBAuDA,SAAeI,GAAtB,mC,8CAAO,WACLX,GADK,+BAAAn3G,EAAA,6DAEL+3G,EAFK,+BAEMC,GAELC,EAAqBl4G,aAAWqB,aAAM22G,GAAWZ,GAJlD,SAKmBe,GAAaD,GALhC,cAOLE,GADAC,EAAcP,GADVO,EALC,OAMmCjB,IAAeiB,EAC5BA,GAE3BC,GADAD,EAAcz1G,aAAUy1G,IARnB,kBAUEA,GAVF,6C,sBAaA,SAAeR,GAAtB,mC,8CAAO,WAA+B3xG,GAA/B,eAAAjG,EAAA,sEACgBmG,wBAAaF,GAAUoE,SAAS,QADhD,UAEiB,kBADhBw3B,EADD,8BAGG,IAAI39B,MAAJ,kCAAqC+B,IAHxC,WAIDD,GAAcC,GAJb,yCAI+BqyG,GAASz2E,EAAQ57B,EAASjH,MAJzD,WAKDkH,GAAoBD,GALnB,yCAKqCqyG,GAASz2E,EAAQ57B,EAASnH,YAL/D,gCAMEw5G,GAASz2E,IANX,6C,sBASA,SAASy2E,GAAShsG,GAAkC,IAAlBxM,EAAkB,uDAAZ,GAC7C,OAAIwM,EAAO2sF,OAAOnvF,WAAW,KAAairG,GAAazoG,EAAQxM,GACxDo1G,GAAa5oG,EAAQxM,GAM9B,SAAS+3G,GAAa73G,EAAkBC,GACtC,GAAU,OAANA,EAAY,OAAO,KAEb,OAAND,IAAYA,EAAI,IAEpB,cAAmBE,OAAOC,KAAKF,GAA/B,eAAmC,CAA9B,IAAMG,EAAI,KACb,GAAa,WAATA,GAAqBA,KAAQJ,EAAG,CAClC,IAAMu4G,EAAUv4G,EAAEI,IAAS,GACrBo4G,EAAUv4G,EAAEG,IAAS,GAC3B,IAAI4B,MAAMC,QAAQs2G,KAAYv2G,MAAMC,QAAQu2G,GAG1C,MAAM,IAAIt0G,MAAJ,0DAC+Cq0G,EAD/C,YAC0DC,IAHhEx4G,EAAEI,GAAQq4G,GAAkBF,GAAW,GAAIC,GAAW,QAyJxC,aAnJEp4G,GAClBA,KAAQJ,GAEW,kBAAZC,EAAEG,IAEU,kBAAZJ,EAAEI,GAGTJ,EAAEI,GAAQL,aAAWC,EAAEI,GAAOH,EAAEG,IACd,aAATA,QAEKY,IAAZhB,EAAEI,IACW,SAAZJ,EAAEI,SAAgCY,IAAZf,EAAEG,MAEzBJ,EAAEI,GAAQH,EAAEG,SAGOY,IAAZhB,EAAEI,SAAmCY,IAAZf,EAAEG,KAEpCJ,EAAEI,GAAQH,EAAEG,IAGhB,OAAOJ,EAMT,SAASy4G,GAAkBz4G,EAAYC,GACrC,IAAKA,EAAEiC,OAAQ,OAAOlC,EAGtB,IAAMu4G,EAAiC,GAevC,OAdAv4G,EAAEqN,SAAQ,SAACi6B,EAAGxlC,GACZwlC,EAAEntB,MAAQrY,EACVy2G,EAAQjxE,EAAE1nC,OAAS0nC,KAGrBrnC,EAAEoN,SAAQ,SAACqrG,GACT,IAAMC,EAAKJ,EAAQG,EAAG94G,OAClB+4G,EACFd,GAAac,EAAID,GAEjB14G,EAAE0O,KAAKgqG,MAIJ14G,E,SAQMk4G,G,iFAAf,WAA4BU,GAA5B,IAGiBC,EAHjB,WAAA74G,EAAA,iGAAAA,EAAA,MAGE,WACEsM,EACAwsG,GAFF,qBAAA94G,EAAA,yDAIQi2G,EAAY3pG,EAAO2pG,WAAa3pG,EAAOwnE,QAJ/C,sBAMU,IAAI5vE,MAAJ,0CAC+BsQ,KAAKC,UAAUnI,KAPxD,UASQysG,EAAkBlB,GAAaz2G,aAAM03G,GAAexsG,GAT5D,sBAU8B,IAAIpI,MAAM,2BAVxC,cAWQqE,EAAW4vG,GACfa,GAAmB1sG,EAAO8qG,SAAW,IACrC2B,UAEKzsG,EAAO8qG,QAER6B,EAAQ1wG,EAASH,IAAT,uCACZ,WAAOgvG,GAAP,eAAAp3G,EAAA,6DACEo3G,EAAQ8B,YAAcN,EAAYM,YADpC,SAE6BtB,GAAgB,CACzC54G,IAAK,IAAIqH,IAAI+wG,EAAQt3G,IAAKm2G,GAAW3vG,OAHzC,cAEQ6yG,EAFR,yBAKSN,EAAUM,EAAcJ,IALjC,2CADY,uDAjBhB,UA0BoC9+E,QAAQ4hB,IAAIo9D,GA1BhD,sBA2BsB5rG,SAAQ,SAAC8rG,GAC3B7sG,EAASurG,GAAavrG,EAAQ6sG,IAAiB7sG,KA5BnD,kBA8BSA,GA9BT,6CAHF,uBAGiBusG,EAHjB,8CACED,EAAcx3G,aAAMw3G,GADtB,kBAoCSC,EAAUD,EAAa,KApChC,4C,sBAuCA,SAASI,GACPzwG,GAEA,OAAKA,GAGAvG,MAAMC,QAAQsG,KAAWA,EAAW,CAACA,IAEnCA,EAASH,KACd,SAACgvG,GAWC,MATuB,kBAAZA,IAAsBA,EAAU,CAAEt3G,IAAKs3G,IAG5C,WAAYA,IAChBA,EAAQ7uC,OAAS6uC,EAAQt3G,IAAIue,SAAS,SAAW,OAAS,WAErC,YAAnB+4F,EAAQ7uC,QAA0B,YAAa6uC,IACjDA,EAAQt5D,QAAU,GAEbs5D,MAjBW,GAuBxB,SAASe,GAA6BiB,EAAc9sG,GAClD,IAAK8sG,EACH,OAAOA,EAET,GAAIp3G,MAAMC,QAAQm3G,GAChB,IAAK,IAAIt3G,EAAI,EAAGA,EAAIs3G,EAAUl3G,OAAQJ,GAAK,EACzCs3G,EAAUt3G,GAAKq2G,GAAciB,EAAUt3G,GAAIwK,QAExC,GAAyB,kBAAd8sG,EAGhB,IADA,IAAM/mC,EAAM+mC,EACZ,MAAmBl5G,OAAOC,KAAKkyE,GAA/B,eAAqC,CAAhC,IAAM7vE,EAAI,KACb6vE,EAAI7vE,GAAQ21G,GAAc9lC,EAAI7vE,GAAO8J,QAElC,GAAyB,kBAAd8sG,EAEhB,OAAO54G,aAAa44G,EAAW9sG,GAGjC,OAAO8sG,EAWT,IAAMpB,GAAiB,CACrB77F,OAAQ,GAERk9F,YAAa,gBACbnC,SAAU,OACVoC,gBAAgB,EAChBC,UAAU,EACVC,WAAW,EACXC,eAAe,EACfC,mBAAmB,EACnBC,sBAAsB,EACtBC,kBAAkB,EAElBvD,QAAS,8BACTe,QAAS,CAAC,eAAgB,qBAC1Bd,QAAS,6BAETuD,SAAU,CACRC,mBAAmB,EACnBC,OAAQ,CAAEj6G,IAAK,gCAAiC0C,KAAM,kBACtDw3G,UAAW,CACTl6G,IAAK,mCACL0C,KAAM,qBAERy3G,MAAO,CAAEn6G,IAAK,+BAAgC0C,KAAM,kBAGtD03G,0BAA0B,EAC1BC,mBAAoB,QAQtB,SAAS9B,GAAe/rG,GAEtB,GADKA,EAAO6P,SAAQ7P,EAAO6P,OAAS,KAC/B7P,EAAOwnE,QACV,MAAM,IAAI5vE,MAAM,6CCnQb,SAASk2G,GACdC,EACAnD,EACAvrC,GAEA,IAAM2uC,EAA2B,CAC/Bn6F,QAAS5f,KAAW85G,GACpB73G,KAAM63G,EAAetmG,KAAOsmG,EAAez6G,OAGvCwP,EACJirG,EAAextG,WACdwtG,EAAextG,SAASuC,aAAeirG,EAAextG,SAAS0tG,aAC9DnrG,IAAakrG,EAAelrG,YAAcA,GAE9C,IAAM8Q,EACJm6F,EAAen6F,UACdm6F,EAAextG,UAAYwtG,EAAextG,SAASqT,SACtDo6F,EAAep6F,SAAWA,EAAWA,EAAS+9B,MAAM,YAAc,GAdxD,IAgBF24D,EAAeyD,EAAfzD,WACR,IAAKyD,EAAe1F,YAAa,CAC/B,IAAMiC,IAAcA,EAAWv4F,SAAS,cAAgB,CACtD,IAAMm8F,EAAkBH,EAAetmG,KAAOsmG,EAAez6G,MAI7D,OAHAuD,QAAQ4H,KAAR,2CACsCyvG,EADtC,8EAGO16F,GACLw6F,EAAe93G,KACfg4G,EACAF,EAAep6F,UAGnB,OA6PJ,SACEm6F,EACAC,GAEA,IACMG,GADcJ,EAAe9gG,UAAY,IACfnR,KAC9B,SAACsL,GACC,IAAMgnG,EAAyBlmG,KAAKW,MAAMX,KAAKC,UAAUf,IAKzD,OAJAgnG,EAAWp9G,QAAUoW,EAAQy7D,OAC7BurC,EAAWx1F,SAAX,UAAyBxR,EAAQy7D,OAAjC,YAA2Cz7D,EAAQjW,MAAnD,YACEiW,EAAQ/V,IADV,YAEI+V,EAAQlR,MAAQ,IACbk4G,KAQX,OALAJ,EAAe/1F,QAAU,CACvBxW,KAAM,oBACNwL,SAAUkhG,GAEZH,EAAevsG,KAAO,eACfusG,EAjREK,CAA8BN,EAAgBC,GAGvD,IAAMM,EAAqB,SAACjG,GAC1B,OAAO,IAAItuG,IAAIsuG,EAAR,UAAwBuC,EAAxB,MAAqC5wG,KACzC3F,QAAQ,QAAS,KACjBA,QAAQ,QAAS,MAEhBg0G,EAAciG,EAAmBP,EAAe1F,aAEtD,GAAIiC,EAAY,CACd,GAAmB,iCAAfA,EAA+C,CACjD,IAAMryF,EAAsB,CAC1BxW,KAAM,aACNmQ,YAAa,CAAElf,IAAK21G,IAYtB,OAVI0F,EAAeQ,eACjBt2F,EAAQpK,MAAQ,CACdlU,SAAU,CAAEjH,IAAK47G,EAAmBP,EAAeQ,kBAE9CR,EAAeS,eACtBv2F,EAAQpK,MAAQ,CACdlU,SAAU,CAAEjH,IAAK47G,EAAmBP,EAAeS,iBACnD38F,UAAW,OAEVoG,EAAQpK,MAAQ,CAAElU,SAAU,CAAEjH,IAAK,GAAF,OAAK21G,EAAL,UACtC,2BACK2F,GADL,IAEEvsG,KAAM,kBACNwW,YAGJ,GAAmB,kCAAfqyF,EAAgD,CAClD,IAAMryF,EAAsB,CAC1BxW,KAAM,cACNuQ,aAAc,CAAEtf,IAAK21G,GACrBhpC,mBAOF,OALI0uC,EAAeU,gBACjBx2F,EAAQhG,aAAe,CACrBvf,IAAK47G,EAAmBP,EAAeU,kBAEtCx2F,EAAQhG,aAAe,CAAEvf,IAAK,GAAF,OAAK21G,EAAL,UACjC,2BACK2F,GADL,IAEEvsG,KAAM,kBACNwW,YAGJ,GAAmB,oCAAfqyF,EACF,kCACK0D,GADL,IAEEvsG,KAAM,eACNwW,QAAS,CACPxW,KAAM,gBACNkR,gBAAiB,CAAEjgB,IAAK21G,MAI9B,GACiB,oCAAfiC,GACe,yBAAfA,EAUA,OARIyD,EAAetsG,MAAQssG,EAAetsG,KAAKsQ,SAAS,UACtDi8F,EAAerwC,iBAAmB,SAElCowC,EAAetsG,MACfssG,EAAetsG,KAAKsQ,SAAS,aAE7Bi8F,EAAerwC,iBAAmB,WAEpC,2BACKqwC,GADL,IAEEvsG,KAAM,oBACNwW,QAAS,CACPxW,KAAM,gBACN6Q,eAAgB,CAAE5f,IAAK21G,MAI7B,GAAmB,sCAAfiC,EAAoD,CACtD,IAAMryF,EAAsB,CAC1BxW,KAAM,kBACN0Q,cAAe,CAAEzf,IAAK21G,IAYxB,OAVI0F,EAAeW,eACjBz2F,EAAQpK,MAAQ,CACdlU,SAAU,CAAEjH,IAAK47G,EAAmBP,EAAeW,kBAE9CX,EAAeS,eACtBv2F,EAAQpK,MAAQ,CACdlU,SAAU,CAAEjH,IAAK47G,EAAmBP,EAAeS,iBACnD38F,UAAW,OAEVoG,EAAQpK,MAAQ,CAAElU,SAAU,CAAEjH,IAAK,GAAF,OAAK21G,EAAL,UACtC,2BACK2F,GADL,IAEEvsG,KAAM,eACNwW,YAGJ,GAAmB,wCAAfqyF,EACF,OAAO92F,GACLw6F,EAAe93G,KADkB,sBAElBmyG,EAFkB,KAGjC2F,EAAep6F,UAGnB,GAAmB,kCAAf02F,EACF,OAAO92F,GACLw6F,EAAe93G,KADkB,gBAExBmyG,EAFwB,KAGjC2F,EAAep6F,UAGnB,GAAmB,oCAAf02F,EACF,kCACK0D,GADL,IAEEvsG,KAAM,eACNwW,QAAS,CACPxW,KAAM,gBACN4Q,eAAgB,CAAE3f,IAAK21G,MAI7B,GAAmB,uCAAfiC,EACF,OAAO92F,GACLw6F,EAAe93G,KADkB,qBAEnBmyG,EAFmB,KAGjC2F,EAAep6F,UAGnB,GAAmB,iCAAf02F,EACF,OAAO92F,GACLw6F,EAAe93G,KADkB,eAEzBmyG,EAFyB,KAGjC2F,EAAep6F,UAGnB,GAAmB,sCAAf02F,EACF,OAAO92F,GACLw6F,EAAe93G,KADkB,oBAEpBmyG,EAFoB,KAGjC2F,EAAep6F,UAGnB,GAAmB,iCAAf02F,EACF,OAAO92F,GACLw6F,EAAe93G,KADkB,eAEzBmyG,EAFyB,KAGjC2F,EAAep6F,UAGnB,GACiB,2CAAf02F,GACe,yCAAfA,EAEA,OAAO92F,GACLw6F,EAAe93G,KADkB,yBAEfmyG,EAFe,KAGjC2F,EAAep6F,UAGnB,GAAmB,4CAAf02F,EACF,OAAO92F,GACLw6F,EAAe93G,KADkB,0BAEdmyG,EAFc,KAGjC2F,EAAep6F,UAGnB,GAAmB,0CAAf02F,EAAwD,CAC1D,IAAMryF,EAAsB,CAC1BxW,KAAM,sBACN8Q,cAAe,CAAE7f,IAAK21G,IAOxB,OALI0F,EAAeY,eACjB12F,EAAQzF,YAAc,CACpB9f,IAAK47G,EAAmBP,EAAeY,iBAEtC12F,EAAQzF,YAAc,CAAE9f,IAAK,GAAF,OAAK21G,EAAL,SAChC,2BACK2F,GADL,IAEEvsG,KAAM,gBACNwW,YAGJ,GAAmB,+CAAfqyF,EAA6D,CAC/D,IAAMryF,EAAsB,CAC1BxW,KAAM,oBACN8Q,cAAe,CAAE7f,IAAK21G,IAYxB,OAVI0F,EAAeY,eACjB12F,EAAQzF,YAAc,CACpB9f,IAAK47G,EAAmBP,EAAeY,iBAEtC12F,EAAQzF,YAAc,CAAE9f,IAAK,GAAF,OAAK21G,EAAL,SAC5B0F,EAAea,eACjB32F,EAAQxF,YAAc,CACpB/f,IAAK47G,EAAmBP,EAAea,iBAEtC32F,EAAQxF,YAAc,CAAE/f,IAAK,GAAF,OAAK21G,EAAL,SAChC,2BACK2F,GADL,IAEEvsG,KAAM,yBACNwW,YAGJ,GAAmB,oCAAfqyF,EACF,kCACK0D,GADL,IAEEvsG,KAAM,yBACNwW,QAAS,CACPxW,KAAM,gBACNiR,eAAgB,CAAEhgB,IAAK21G,MAQ/B,GADA2F,EAAe/1F,QAAUzG,GAAa62F,EAAa,QAC9C2F,EAAe/1F,QAClB,MAAM,IAAIrgB,MAAM,+BAGlB,OAAIo2G,EAAe/1F,QAAQxW,OAAS8P,GAC3BiC,GACLw6F,EAAe93G,KACfmyG,EACA2F,EAAep6F,UAGfo6F,EAAe/1F,QAAQxW,OAAS6P,GAC3BwC,GACLk6F,EAAe93G,KACfmyG,EACA2F,EAAep6F,WAInBo6F,EAAevsG,KAAOqR,GAAek7F,EAAe/1F,QAAQxW,MAEhC,sBAAxBusG,EAAevsG,OACbssG,EAAetsG,MAAQssG,EAAetsG,KAAKsQ,SAAS,UACtDi8F,EAAerwC,iBAAmB,SACzBowC,EAAetsG,MAAQssG,EAAetsG,KAAKsQ,SAAS,aAC7Di8F,EAAerwC,iBAAmB,YAI/BqwC,GCpUM,mBACb,OAAO,qCAEL1f,GAFK,GAGL,cACS,CACL79E,cAAeoE,iCADV,IAELpT,KAAMlR,wCAHV,SAKW,SAAA2B,GAAI,MAAK,CAChBq8F,QADgB,WAEd,IAAMia,EAAkBroG,yBACtBjO,EADoC,cAAtC,mBAIMkjB,EAAUnB,sBAAhB,IFLH,WAAP,iCEMU46F,UACQ,SAAA7uG,GACJ,IAAM1N,EAAe6N,yBACnBjO,EADiC,cAAnC,gBAIMw8F,EAAet5E,EAAA,iBACnB,SAAA+jC,GAAQ,OAAIh5C,yBAAeg5C,EAAfh5C,UAAJ,KAEJk/D,EAAkBl/D,yBAAeuuF,EAAc,CAAC,WAAtD,YAIMogB,EAAY9uG,EAAA,YAAkB,SAAA+uG,GAClC,IAAMC,EAAWlB,GAAmB,EAElC9tG,EAFiC,SAAnC,GAMA,OADAgvG,gBAAyB,CAAzBA,GACA,KAEF98G,sBAtBJ28G,OAwBS,SAAA/3G,GACLD,iBACAue,mFACqEljB,EADrEkjB,qHAIAA,kBAAwBljB,EAAxBkjB,yBC7CO65F,G,4MACnB/4G,KAAO,sB,sDAECyN,GACNA,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,gBACNqL,aAAc2tG,GACdntG,aAAcotG,QAIpBxrG,EAAc+0F,mBACZ,kBACE,IAAI91F,EAAe,CACjB1M,KAAM,qBACNqL,aAAc6tG,GACdntG,WAAYotG,GAAqB1rG,GACjCd,YAAa,iBACbC,YAAa,6BACbtP,IAAK,0B,GArBkC8pC,I,sBCVlCriC,uBAAS,SAAmCyG,GAAO,IACxD5P,EAAU4P,EAD8C,MAExDlH,EAA8D1I,EAFN,KAElDuf,EAAwDvf,EAFN,YAEjB0kD,EAAuB1kD,EAFN,mBAIhE,OAAOA,SACL,uCADKA,IAGL,2BAHF,cCAI8S,GAAYC,aAAW,CAC3BmyC,QAAS,CACPz5B,YAAa,QACbzX,gBAAiB,UACjBsuC,gBACE,sHACFx1B,OAAQ,OACRhU,MAAO,OACPkkB,UAAW,UAEbh4B,MAAO,CACLqL,QAAS,QACTgD,MAAO,MACPyF,MAAO,OACPivF,SAAU,SACVlzE,WAAY,UAEdswB,aAAc,CACZ5xC,WAAY,UACZL,QAAS,QAEXkyC,WAAY,CACV7xC,WAAY,UACZL,QAAS,OACTG,MAAO,SAIX,SAASoyC,KAAiB,MAEEl4B,oBAAS,GAFX,mBAEjBsV,EAFiB,KAEVC,EAFU,KAGlBpuB,EAAU5B,KAMhB,OALA8a,qBAAU,WACR,IAAMgV,EAAUhR,YAAW,kBAAMkR,GAAS,KAAO,KACjD,OAAO,kBAAMjR,aAAa+Q,OAGrBC,EACL,yBAAK1S,cAAY,kBAAkBjb,UAAWR,EAAQwwC,SAAtD,iBAEE,kBAACuO,GAAA,EAAD,OAEA,KAGN,SAAS9N,GAAT,GAAgE,IAAxCqB,EAAwC,EAAxCA,YAChBtyC,EAAU5B,KAChB,OAAO,yBAAKoC,UAAWR,EAAQywC,cAAe6B,GAMhD,SAASnB,GAAT,GAAiD,IAA3B7gD,EAA2B,EAA3BA,MACd0P,EAAU5B,KAChB,OAAO,yBAAKoC,UAAWR,EAAQ0wC,YAAapgD,EAAM8xB,SAIpD,IAcemvB,GAdwB98C,oBAAS,YAA+B,IAA5BnJ,EAA4B,EAA5BA,MACjD,OAAIA,EAAMgF,MACD,kBAAC,GAAD,CAAYA,MAAOhF,EAAMgF,QAE9BhF,EAAM82B,QACD,kBAAC,GAAD,CAAckwB,YAAahnD,EAAM82B,UAErC92B,EAAMykD,OAIJ,kBAAC,GAAD,CAA2BzkD,MAAOA,IAHhC,kBAAC,GAAD,SCrELw9G,GAGD,SAAA5tG,GAAS,IACJ5P,EAAoB4P,EAApB5P,MAAO2U,EAAa/E,EAAb+E,SACf,OACE,6BACE,kBAAC3U,EAAMmoG,gBAAoBv4F,GAC1B+E,IASP6oG,GAAyB1gF,aAAe,CACtCnoB,SAAU,MAEGxL,0BAASq0G,ICJjB,SAASxyD,GAAoBn5C,GAClC,OAAO8L,8BACL,2BACA,CAAE28B,SAAUzoC,EAAc0S,0BAA0B,aACpD,CAAE0mC,kBAAmBxJ,GAA+B5jC,iBAAiB,IAIlE,SAASqtC,GAAkBz7C,GAChC,OAAOhR,QACJ8B,QACC,2BACA0hB,GACAxjB,QAAMuB,MAAM,CACV2P,KAAMlR,QAAMqkB,QAAQ,4BACpBnE,cAAeoE,iCAAuBtT,GACtCqd,OAAQ,OAGX5R,UAAS,kBACRgrC,sBAAkBtjD,EAClB6hD,QAAQ,EACR/7C,UAAM9F,EACN2P,KAAM,GACNukB,aAASl0B,EACT+hD,wBAAoB/hD,EACpBulG,gBAAkBliD,OAEnBxqC,OAAM,SAAArb,GAAI,MAAK,CACd,uBACE,OAAOiiB,kBAAQjiB,EAAM,YAAYuP,MAEnC,kBACE,MAAO,CACL4S,aAAcniB,QAInBD,SAAQ,SAAAC,GACP,IAAI8lD,EAEJ,MAAO,CACLloC,YADK,WAEHmoC,iCACE/lD,EACAgmD,GACAC,GACA,CACEjiD,KAAM,GAAF,OAAKhE,EAAKuP,KAAV,YAAkBvP,EAAKN,GAAvB,cACJwmD,MAAO,IACPE,iBAAiB,GAEnB39C,KAAK49C,WACL59C,KAAK69C,YACL79C,KAAK6Z,WAIT+jC,WAjBK,SAiBMG,GACTxmD,EAAKqkD,QAAS,EACdrkD,EAAK02B,aAAUl0B,EACfxC,EAAKmS,KAAO,GACZnS,EAAKsI,UAAO9F,EACZxC,EAAK4E,WAAQpC,EACbxC,EAAKukD,wBAAqB/hD,EAC1BsjD,EAAmBU,GAErBG,WA1BK,SA0BMC,GACLd,IAAqBA,EAAiBh/C,OAAO2/C,SAC/CX,EAAiBY,QAEnB1mD,EAAKqkD,QAAS,EACdrkD,EAAK02B,QAAUkwB,EACf5mD,EAAKmS,KAAO,GACZnS,EAAKsI,UAAO9F,EACZxC,EAAK4E,WAAQpC,EACbxC,EAAKukD,wBAAqB/hD,EAC1BsjD,OAAmBtjD,GAErB8jD,YAtCK,SAsCOl+C,GAIT,IACOE,EAAmCF,EAAnCE,KAAM6J,EAA6B/J,EAA7B+J,KAAMoyC,EAAuBn8C,EAAvBm8C,mBACpBvkD,EAAKqkD,QAAS,EACdrkD,EAAK02B,aAAUl0B,EACfxC,EAAKmS,KAAOA,EACZnS,EAAKsI,KAAOA,EACZtI,EAAK4E,WAAQpC,EACbxC,EAAKukD,mBAAqBA,EAC1BuB,OAAmBtjD,GAErB8f,SApDK,SAoDI1d,GACPD,QAAQC,MAAMA,GACVkhD,IAAqBA,EAAiBh/C,OAAO2/C,SAC/CX,EAAiBY,QAGnB1mD,EAAKqkD,QAAS,EACdrkD,EAAK02B,aAAUl0B,EACfxC,EAAKmS,KAAO,GACZnS,EAAKsI,UAAO9F,EACZxC,EAAK4E,MAAQA,EACb5E,EAAKukD,wBAAqB/hD,EAC1BsjD,OAAmBtjD,OAK7B,SAASwjD,GAAgBhmD,GAAgC,IAC/C8jC,EAAe/hB,sBAAW/hB,GAA1B8jC,WACF7zB,EAAUjQ,EAGdmf,EAE2ClP,EAF3CkP,YACAq7B,EAC2CvqC,EAD3CuqC,aAMFvsC,yBAAejO,EAAKue,eAZmC,IAc/C0E,EAAkBjjB,EAAlBijB,cACFxE,EAASkF,6BAAkB3jB,GAC3BgkC,EAAYrlB,GAAgB3e,GAGlC,OAFAwI,sBAAYiW,GAEL,CACL+7B,eACA1W,aACA3kB,cACAglB,WAAY,CACVlhB,gBACAu3B,aAAcA,EAAax2C,KAC3Bmb,YAAa,2BACRA,GADM,IAETuE,KAAMlb,sBAAYiW,KAEpBulB,YACAxB,QAAS,M,SAKAyjB,G,iFAAf,WAAiCz2C,GAAjC,yBAAAhO,EAAA,yDACOgO,EADP,sBAEU,IAAI9J,MAAM,+BAFpB,cAKU80C,EAAyChrC,EAAzCgrC,aAAc1W,EAA2Bt0B,EAA3Bs0B,WAAYK,EAAe30B,EAAf20B,WALpC,SAOkCqW,EAAa4M,eAC3CtjB,EACAK,GATJ,uBAOUhyB,EAPV,EAOUA,KAAS7J,EAPnB,2CAYS,CAAE6J,OAAM7J,OAAMi8C,mBAAoB/J,EAAaprC,iBAZxD,4C,sBC1JA,IAAMsD,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCmhD,UAAW,CACT4yB,SAAU,kBACV12E,QAAS,QAEX+jD,OAAQ,CACNtkC,SAAU,GAEZk3D,SAAU,CACRzzE,WAAYP,EAAMQ,QAAQ2U,UAAUD,KACpChV,QAASF,EAAMG,QAAQ,IAEzBiqB,QAAS,CACP7pB,WAAYP,EAAMQ,QAAQ2U,UAAUuP,OAEtC3mB,YAAa,CACXwC,WAAYP,EAAMQ,QAAQ2U,UAAUD,KACpCkD,WAAY,EACZK,YAAazY,EAAMG,QAAQ,GAC3Bkf,aAAcrf,EAAMG,QAAQ,IAE9ByhB,UAAW,CACTvhB,MAAOL,EAAMQ,QAAQ2U,UAAU6C,cAEjC+J,UAAW,CACT,UAAW,CACT/gB,gBAAiBhB,EAAMQ,QAAQ2U,UAAUuP,QAG7C1C,aAAc,CACZ2C,YAAa3kB,EAAMQ,QAAQyU,QAAQC,KACnClU,gBAAiBhB,EAAMQ,QAAQ2U,UAAUuP,WAIvCuvD,GAAwB99E,oBAC5B,YAAsD,IAAnDnJ,EAAmD,EAAnDA,MACD,OACE,kBAAC,KAAD,CACE4lB,QAAS5lB,EAAM0kF,eACf9vE,MAAM,uCAEL5U,EAAMojF,gBACL,kBAAC,KAAD,MAEA,kBAAC,KAAD,UAOJ8D,GAAY/9E,oBAChB,YAAsD,IAAnDnJ,EAAmD,EAAnDA,MACD,OACE,kBAAC,KAAD,CACE4lB,QAAS5lB,EAAM4kF,gBACfhwE,MAAM,mDAEL5U,EAAMmjF,UACL,kBAAC,KAAD,CAAU9vE,MAAM,cAEhB,kBAAC,KAAD,CAAaA,MAAM,kBAOvB8zE,GAAOh+E,oBAAS,YAAsD,IAAnDnJ,EAAmD,EAAnDA,MACvB,OACE,kBAAC,KAAD,CACE4lB,QAAS5lB,EAAM2kF,qBACf/vE,MAAM,oCAEL5U,EAAMkjF,mBACL,kBAAC,KAAD,CAAa7vE,MAAM,cAEnB,kBAAC,KAAD,CAAgBA,MAAM,kBAMxB+zE,GAASj+E,oBACb,YAMM,IALJnJ,EAKI,EALJA,MACAuG,EAII,EAJJA,KAKMmO,EAAU5B,KAGhB,OADA9S,EAAMykF,gBAAgBl+E,EAAKumB,QAEzB,yBAAK5X,UAAWR,EAAQy/C,WACtB,kBAAC,GAAD,CAAWn0D,MAAOA,IAClB,kBAAC,GAAD,CAAuBA,MAAOA,IAC9B,kBAAC,GAAD,CAAMA,MAAOA,IAEb,yBAAKkV,UAAWR,EAAQ0/C,aAMjBizB,uBAAS,CAAEC,eAAe,GAA1BD,CAAkCD,IC/G3Ct0E,GAAYC,cAAW,SAAAC,GAC3B,MAAO,CACL6X,KAAM,CACJ5d,SAAU,WACVq7E,aAAct1E,EAAMG,QAAQ,GAC5BiB,SAAU,UAEZm0E,iBAAkB,CAChBt7E,SAAU,WACV+hB,IAAK,EACLlC,OAAQ,OACRhU,MAAO,MACPvF,WAAY,WAEd4jB,cAAe,CACbpiB,UAAW,OAEb+kB,UAAW,CACTzpB,QAAS,QAEX+mD,QAAS,CACPxoC,OAAQ,IACRm4D,SAAU,OAEZ97D,QAAS,CACP87D,SAAU,WAQV02B,GAAWt0G,oBAAS,YAAsB,IAAnBnJ,EAAmB,EAAnBA,MACrB0U,EAAU5B,KAChB,OACE,oCACG9S,EAAM+d,OAAO/T,KAAI,SAAAyU,GAAS,IAClBpO,EADkB,YACPoO,EAAMuE,SADC,MAEjB0hC,EAAuBr0C,EAAvBq0C,mBACR,OAAOA,EACL,yBACExvC,UAAWR,EAAQ0iD,QACnBzhD,IAAK0M,kBAAQ5D,EAAO,WACpB3J,MAAO,CAAEgY,OAAQzc,EAAQyc,SAEzB,kBAAC43B,EAAD,CAAoB1kD,MAAOqQ,KAE3B,YAONqtG,GAAwBv0G,oBAAS,YAAsB,IAAnBnJ,EAAmB,EAAnBA,MAClC0U,EAAU5B,KACR2I,EAAUzb,EAAVyb,MAKAjM,EAJkB2S,sBAAWniB,GAA7B6R,cAGuB2T,YAAY/J,EAAM,GAAG9L,MAC5CH,eAER,OACE,6BACE,kBAAC,GAAD,CAAQxP,MAAOA,IACf,yBAAKkV,UAAWR,EAAQolB,WACtB,kBAACtqB,EAAD,CAAgBxP,MAAOyb,EAAM,KAC7B,yBAAK3G,MAAO,CAAEzE,QAAS,SACrB,kBAACotG,GAAD,CAAUz9G,MAAOA,KAEnB,kBAACwP,EAAD,CAAgBxP,MAAOyb,EAAM,UAK/BkiG,GAAyBx0G,oBAAS,YAAsB,IAAnBnJ,EAAmB,EAAnBA,MACnC0U,EAAU5B,KACR2I,EAAUzb,EAAVyb,MACA5J,EAAkBsQ,sBAAWniB,GAA7B6R,cACR,OACE,6BACE,kBAAC,GAAD,CAAQ7R,MAAOA,IACf,yBAAKkV,UAAWR,EAAQolB,WACtB,yBAAK5kB,UAAWR,EAAQuW,SACtB,yBAAKnW,MAAO,CAAE7H,SAAU,aACrBwO,EAAMzR,KAAI,SAAA8Z,GAET,IACQtU,EADSqC,EAAc2T,YAAY1B,EAAKnU,MACxCH,eACR,OAAO,kBAACA,EAAD,CAAgBmG,IAAKmO,EAAKhkB,GAAIE,MAAO8jB,QAGhD,kBAAC25F,GAAD,CAAUz9G,MAAOA,UAkBZ49G,GAXez0G,oBAAS,YAAsB,IAAnBnJ,EAAmB,EAAnBA,MAIxC,OAHeA,EAAM+d,OAAOkU,MAAK,SAAAiX,GAAC,OAChCA,EAAElmB,SAASiP,MAAK,SAACpN,GAAD,OAA8BxC,kBAAQwC,EAAG,gBAGzD,kBAAC64F,GAAD,CAAuB19G,MAAOA,IAE9B,kBAAC29G,GAAD,CAAwB39G,MAAOA,OC3FpB,SAASkrD,GAAkBr5C,GAA8B,IAE9DrT,GAAco+C,EADA/qC,EAAd+qC,WACwB,gCAAxBp+C,UAGR,OAAOC,QACJ8B,QACC,wBACA6d,GACA3f,QAAMuB,MAAM,CACVF,GAAItB,EACJmR,KAAMlR,QAAMqkB,QAAQ,yBACpBgK,OARgB,IAShB/b,YAAa,iBACb6sD,kBAAmB,eACnBslB,oBAAoB,EACpBC,WAAW,EACXC,iBAAiB,EACjBrlE,OAAQtf,QAAMwc,MACZpJ,EAAcoR,iBAAiB,QAAS,eAE1CxH,MAAOhd,QAAMwc,MACXpJ,EAAc2T,YAAY,oBACvBrV,YAMLg5F,iBAAkB1qG,QAAMwc,MACtBpJ,EAAc0S,0BAA0B,UAK1C6kF,oBAAqB3qG,QAAMwc,MAAMxc,QAAM6iD,aAG1CpmC,UAAS,iBAAO,CACfijD,aAAc,EACdrlD,MAAO,QAER2C,OAAM,SAAArb,GAAI,MAAK,CACd,kBACE,OAAOA,EAAKqb,MAAM3X,OAAS,GAG7B,eACE,OAAQ1D,EAAKqb,OAAS,IAAIzR,KAAI,SAAAlH,GAAC,mBAC1B,IAAIujB,IAAIvjB,EAAEw2D,aAAatvD,KAAI,SAAA2lE,GAAC,OAAIA,EAAEzwE,iBAIzC,oBACE,mBAAW,IAAImnB,IAAIjmB,EAAKqb,MAAMzR,KAAI,SAAAlH,GAAC,OAAIA,EAAEojB,iBAAeovF,cAW3Dn1G,SAAQ,SAAAC,GAAI,MAAK,CAChB4d,YADgB,WACF,WACZqrC,sBACEjpD,EACA4iF,mBAAS5iF,GAAM,SAACy9G,GACd,GAAIz9G,EAAK+iF,UAAW,KACV/+E,EAAqBy5G,EAArBz5G,KAAMuH,EAAekyG,EAAflyG,KAAMnD,EAASq1G,EAATr1G,KACJ,CACd,mBACA,SACA,iBACA,YACA,YACA,eAEU2B,SAAS/F,IAASuH,GAC5B,EAAK24E,gBAAgBlgF,EAAMuH,EAAMnD,SAO3C87E,gBAvBgB,SAuBAC,EAAoB54E,GAAgC,IAAlBnD,EAAkB,uDAAJ,GAC9DpI,EAAKqb,MAAMxM,SAAQ,SAAA6U,GACjB,IAAMrZ,EAAMw4E,kBAAQn/D,GAChBrZ,EAAI+5E,YAAY74E,KAAUlB,EAAI3G,OAAS6H,EAAK7H,QAE9CggB,EAAKygE,GAAY/7E,EAAK,QAK5B8V,SAjCgB,SAiCPC,GACPne,EAAK0Y,MAAQyF,EACbne,EAAKqb,MAAMxM,SAAQ,SAAAnM,GAAC,OAAIA,EAAEwb,SAASC,OAErC+qC,UArCgB,SAqCN0nC,GACR5wF,EAAK0sB,OAASkkE,GAGhB0Y,SAzCgB,SAyCPjuF,GACPrb,EAAKqb,MAAQH,eAAKG,IAGpBqkD,WA7CgB,SA6CLh8C,GACT1jB,EAAKqb,MAAMsJ,OAAOjB,IAGpB87C,UAjDgB,WAkDd9gD,oBAAU1e,EAAM,GAAG0/D,WAAW1/D,IAGhCqkF,gBArDgB,SAqDA33D,GACd1sB,EAAK+9D,aAAerxC,GAGtB43D,eAzDgB,WA0DdtkF,EAAKgjF,iBAAmBhjF,EAAKgjF,iBAE/BuB,qBA5DgB,WA6DdvkF,EAAK8iF,oBAAsB9iF,EAAK8iF,oBAElC0B,gBA/DgB,WAgEdxkF,EAAK+iF,WAAa/iF,EAAK+iF,WAGzBzuB,sBAnEgB,WAoEd,GAA+B,iBAA3Bt0D,EAAKw9D,kBAaT,MAAM,IAAI93D,MAAJ,sCAAyC1F,EAAKw9D,oBAZlD,IAAMt6C,EAAUnB,sBAAW/hB,GAC3B,GAAIypD,qCAA0BvmC,GAAU,CACtC,IAAM68C,EAAW78C,EAAQymC,UACvB,kCACA,4BACA,CAAEjmC,KAAM1jB,IAGV,OADAkjB,EAAQ0mC,WAAWmW,GACZA,IAObJ,YApFgB,SAoFJh+C,GAEUlZ,KAAKob,UAAUlC,IAGjClZ,KAAKqb,UAAUnC,IAInBmC,UA7FgB,SA6FNnC,GAAuC,IAAtBsC,EAAsB,uDAAJ,GACrCg7C,EAAoBxtD,EAAc0S,0BACtC,SAEI5F,EAAgB6F,4BACpB66C,EACA56C,kBAAQrkB,GACR2hB,GAEIvR,EAAYqB,EAAc0U,aAAa5H,EAAchP,MAC3D,IAAKa,EACH,MAAM,IAAI1K,MAAJ,6BAAgC6Y,EAAchP,OAEtD,IAAMc,EAAWoB,EAAc2T,YAAYplB,EAAKuP,MAC1C2vD,EAAoB7uD,EAASL,aAAapG,KAC9C,SAAA0a,GAAW,OAAIA,EAAYtgB,QAEvBshB,EAAc/G,EAAcqE,SAASnc,MACzC,SAACge,GAAD,OAA8By6C,EAAkBn1D,SAAS0a,EAAElV,SAE7D,IAAK+V,EACH,MAAM,IAAI5f,MAAJ,4DACiD1F,EAAKuP,OAG9D,IAAM8O,EAAQjO,EAAUL,WAAW3F,OAArB,2BACT6Z,GADS,IAEZ1U,KAAMgP,EAAchP,KACpBgP,gBACAqE,SAAU,CAAC,CAAErT,KAAM+V,EAAY/V,KAAMgP,cAAe+G,OAEtDtlB,EAAK2d,OAAOzN,KAAKmO,IAGnBwF,UA/HgB,SA+HNlC,GACR,IAAMs9C,EAAoBxtD,EAAc0S,0BACtC,SAEI5F,EAAgB6F,4BACpB66C,EACA56C,kBAAQrkB,GACR2hB,GAGIw9C,EAAcn/D,EAAK2d,OAAOpH,QAC9B,SAAAuyB,GAAC,OAAIA,EAAEvqB,gBAAkBA,KAG3B,OADAmG,uBAAY,kBAAMy6C,EAAYtwD,SAAQ,SAAAi6B,GAAC,OAAI9oC,EAAK2d,OAAOgH,OAAOmkB,SACvDq2B,EAAYz7D,YAGtB2X,OAAM,SAAArb,GAAI,MAAK,CACd,gBACE,IAAMojB,EAAwB,GAc9B,OAbApjB,EAAKqb,MAAMxM,SAAQ,SAAC6U,EAAM7H,GACpB6H,EAAKN,WACPA,EAAUlT,KAAK,CACb9O,MAAO,QAAF,OAAUya,EAAM,EAAhB,SACL0X,QAAS7P,EAAKN,eAIpBA,EAAUlT,KAAK,CACb9O,MAAO,sBACPokB,QAASxlB,EAAKs0D,sBACd5uC,KAAMg9C,KAEDt/C,OCxPA,mBAA4C,IAAzCo5B,EAAyC,EAAzCA,UAEhB,OAAO,IADUA,EAAU,gDACpB,CAAa,CAClBx4C,KAAM,wBACN+L,WAAYysC,EAAU6yD,IACtBjgG,qBC2BG,SAAS07C,GACdz7C,GAEA,OAAOhR,QACJ8B,QACC,uBACAu9G,GAAiBruG,GACjBhR,QAAMuB,MAAM,CACV2P,KAAMlR,QAAMqkB,QAAQ,wBACpBnE,cAAeoE,iCAAuBtT,MAIzCgM,OAAM,SAAArb,GAAI,MAAK,CACd,4BACE,OAAO,GAET,kBACE,IAAM29G,EAAah6F,6BAAkB3jB,GACrC,MAAO,CACLmiB,aAAcniB,EACd8N,OAAQmU,kBAAQjiB,EAAM,YACtB0Y,MAAOilG,EAAWjlG,MAClBgU,OAAQ,MAGZ,uBACE,OAAO1sB,EAAKue,cAAc27B,SAAS3qC,MAErC,oBAEE,oBACEvL,KAAMhE,EAAKkiB,YAAY3D,cAAcwH,QAAQxW,KAC7CuW,cAAe7D,kBAAQjiB,EAAM,kBAC1BiiB,kBAAQjiB,EAAKkiB,YAAa,aAIjC,eACE,OAAOD,kBAAQjiB,EAAM,iB,gBCoDZ49G,IAJV,SAASC,GAAiBC,EAAepxF,GAC9C,OAAOoxF,EAAO,EAAIpxF,EAAS,EAGtB,SAAUkxF,KAAV,+FACLG,EADK,+BACW,GAChBC,EAFK,+BAEW,GAChBr8C,EAHK,uBAKDr+D,EAAI,EACJkgC,EAAI,EANH,YAOElgC,EAAIy6G,EAAGr6G,QAAU8/B,EAAIw6E,EAAGt6G,QAP1B,oBAQGlC,EAAImgE,EAAGo8C,EAAGz6G,IACV7B,EAAIkgE,EAAGq8C,EAAGx6E,MACZhiC,EAAIC,GAVL,iBAWD6B,IAXC,6BAYQ7B,EAAID,GAZZ,iBAaDgiC,IAbC,wBAeD,OAfC,UAeK,CAACu6E,EAAGz6G,GAAI06G,EAAGx6E,IAfhB,QAgBDlgC,IACAkgC,IAjBC,gE,OC/GiB,CAAC,EAAG,EAAG,EAAG,GAA3ByhD,G,MAAQhb,G,MAIPmD,GAAeg9B,EAAfh9B,WAER,SAASpxD,GACP0H,EACAviB,GAEA,OAAQuiB,EAAKlI,OAAOra,IAAQ,IAAI4W,UAAY,EAqM/BhP,2BAjKf,SAAgCyG,GAQ9B,IAAMghB,EAAMjD,iBAA0B,MAEpCb,EAMEld,EANFkd,OACAhU,EAKElJ,EALFkJ,MAJD,EASGlJ,EAJF2S,oBALD,MAKgB,GALhB,IASG3S,EAHFosB,6BAND,MAMyB,EANzB,EAOC7gB,EAEEvL,EAFFuL,SAIIkjG,GAFFzuG,EADF0uG,SAG2BC,mBAC3B,kBACEpjG,EAASnR,KAAI,SAAA+sB,GACX,OAAOA,EACJ/sB,KAAI,SAAA6d,GAAC,OAAI,IAAIjB,GAAciB,MAC3B4K,MAAK,SAAC7wB,EAAGC,GAAJ,OAAUD,EAAEhC,IAAI,aAAeiC,EAAEjC,IAAI,qBAEjD,CAACub,KAIKM,EADWsI,6BAAkBxB,GAC7B9G,MACF+iG,EA/DR,SAAuBrjG,GAErB,IADA,IAAMqjG,EAAU,GACP96G,EAAI,EAAGA,EAAIyX,EAASrX,OAAQJ,IACnC,IAAK,IAAIkgC,EAAIlgC,EAAGkgC,EAAIzoB,EAASrX,OAAQ8/B,IACnC,GAAIlgC,IAAMkgC,EAAG,sBACYo6E,GAAgB7iG,EAASzX,GAAIyX,EAASyoB,IAAI,SAAA9sB,GAAI,OACnEA,EAAKlX,IAAI,iBAFA,IACX,2BAEG,8BAFSimF,EAET,KAFaG,EAEb,KACDw4B,EAAQluG,KAAK,CACX,CACEgF,QAASuwE,EACT9uD,MAAOrzB,EACPxE,QAAS2mF,EAAGjmF,IAAI,WAChBoqC,OAAQ,CAAC67C,EAAGjmF,IAAI,SAAU,EAAGimF,EAAGjmF,IAAI,OAAQ,KAE9C,CACE0V,QAAS0wE,EACTjvD,MAAO6M,EACP1kC,QAAS8mF,EAAGpmF,IAAI,WAChBoqC,OAAQ,CAACg8C,EAAGpmF,IAAI,SAAU,EAAGomF,EAAGpmF,IAAI,OAAQ,QAfvC,+BAsBjB,OAAO4+G,EAqCSh5B,CAAc64B,GACxBI,EAAUhjG,EAAMzR,KAAI,SAAA8Z,GAAI,OAAIA,EAAK3L,YAwHvC,OAtHAyV,qBAAU,WACR,GAAKgD,EAAI5C,QAAT,CAGA,IAAM05C,EAAM92C,EAAI5C,QAAQqO,WAAW,MACnC,GAAKqrC,EAAL,CAGAA,EAAI0R,UAAU,EAAG,EAAGtgE,EAAOgU,GAC3B46C,EAAIja,MAAMzxB,EAAuBA,GACjC0rC,EAAIjrC,UAAYpa,kBAAQE,EAAc,CAAC,WAAY,UACnDmlD,EAAIlrC,YAAcna,kBAAQE,EAAc,CAAC,WAAY,UAIrDi8F,EAAQvvG,SAAQ,SAAA0gE,GAGd,IAAK,IAAIjsE,EAAI,EAAGA,EAAIisE,EAAE7rE,OAAS,EAAGJ,GAAK,EAAG,OACsBisE,EAAEjsE,GAAhDkiF,EADwB,EAChC57C,OAAqB67C,EADW,EACpBvwE,QAAoB6oG,EADA,EACPpnF,MAAoB2nF,EADb,EACIx/G,QADJ,EAEsBywE,EAAEjsE,EAAI,GAApDqiF,EAFwB,EAEhC/7C,OAAqBg8C,EAFW,EAEpB1wE,QAAoB8oG,EAFA,EAEPrnF,MAAoB4nF,EAFb,EAEIz/G,QACtC0/G,EAAKnjG,EAAM0iG,GACXU,EAAKpjG,EAAM2iG,GAEjB,IAAKx4B,IAAOG,EAEV,YADAhhF,QAAQ4H,KAAK,8CAKf,GAA2BwxG,IAAOC,EAAlC,CAGA,IAAMU,EAAUj5B,EAAGjmF,IAAI,OAASimF,EAAGjmF,IAAI,SACjCm/G,EAAU/4B,EAAGpmF,IAAI,OAASomF,EAAGpmF,IAAI,SAElCk/G,EAAUF,EAAGhwG,SAAqBiwG,EAAGjwG,QAAtC,EAIJ,IAAMowG,EAAM5iG,GAAGwiG,EAAI,CAAE1/G,QAASw/G,EAAM7iG,MAAO+pE,EAAGP,MAAWo5B,EAAQN,GAC3Dc,EAAM7iG,GAAGwiG,EAAI,CAAE1/G,QAASw/G,EAAM7iG,MAAO+pE,EAAGvb,MAAYo0C,EAAQN,GAC5De,EAAM9iG,GAAGyiG,EAAI,CAAE3/G,QAASy/G,EAAM9iG,MAAOkqE,EAAGV,MAAWo5B,EAAQL,GAC3De,EAAM/iG,GAAGyiG,EAAI,CAAE3/G,QAASy/G,EAAM9iG,MAAOkqE,EAAG1b,MAAYo0C,EAAQL,GAE5Dr4E,EACFk4E,GAAiBE,EAAKC,EAAItxF,GAIxBkZ,EACFi4E,GAAiBG,EAAKD,EAAIrxF,GAO9B,GAAIgyF,EAAUF,EAAGhwG,SAAWmwG,EAAUF,EAAGjwG,QACvC84D,EAAI6jC,YACJ7jC,EAAI7qD,OAAOmiG,EAAKj5E,GAChB2hC,EAAIkf,OAAOs4B,EAAKl5E,GAChB0hC,EAAIjV,aACC,CACL,IAAI2sD,EAASJ,EACTK,EAASH,EAIPI,EAAON,EAAMC,EAAM,GAAK,EACxBM,EAAOL,EAAMC,EAAM,GAAK,EAExB1xC,EAAQoY,EAAGjmF,IAAI,OAASimF,EAAGjmF,IAAI,SACrC,GAAI6tE,EAEF,IADA,IAAMU,EAAWX,GAAWC,GACnB7pC,EAAI,EAAGA,EAAIuqC,EAASrqE,OAAQ8/B,GAAK,EAAG,CAC3C,IAAMltB,GAAOy3D,EAASvqC,GAChBmqC,EAAKI,EAASvqC,EAAI,GAElB47E,EAASJ,EACTK,EAASJ,EAEJ,MAAPtxC,GACFrG,EAAIjrC,UAAY,QAChB2iF,GAAW1oG,EAAM+E,EAAM,GAAG7M,QAAW0wG,EACrCD,GAAW3oG,EAAM+E,EAAM,GAAG7M,QAAW2wG,GACrB,MAAPxxC,GACTrG,EAAIjrC,UAAY,QAChB2iF,GAAW1oG,EAAM+E,EAAM,GAAG7M,QAAW0wG,GACrB,MAAPvxC,GACTrG,EAAIjrC,UAAY,QAChB2iF,GAAW1oG,EAAM+E,EAAM,GAAG7M,QAAW0wG,GACrB,MAAPvxC,IACTrG,EAAIjrC,UAAY,QAChB4iF,GAAW3oG,EAAM+E,EAAM,GAAG7M,QAAW2wG,GAEvC73C,EAAI6jC,YACJ7jC,EAAI7qD,OAAO2iG,EAAQz5E,GACnB2hC,EAAIkf,OAAOw4B,EAAQr5E,GACnB2hC,EAAIkf,OAAOy4B,EAAQr5E,GACnB0hC,EAAIkf,OAAO64B,EAAQz5E,GACnB0hC,EAAIg4C,YACJh4C,EAAIhlE,YAGNglE,EAAI6jC,YACJ7jC,EAAI7qD,OAAOmiG,EAAKj5E,GAChB2hC,EAAIkf,OAAOq4B,EAAKl5E,GAChB2hC,EAAIkf,OAAOu4B,EAAKn5E,GAChB0hC,EAAIkf,OAAOs4B,EAAKl5E,GAChB0hC,EAAIg4C,YACJh4C,EAAIhlE,kBAQZ,4BACEkuB,IAAKA,EACLT,cAAY,iBACZrX,MAAOA,EACPgU,OAAQA,OCvNCnP,iCAAoB,wBAEjC,CACEtK,MAAO,CACL1D,KADK,QAELqB,YAFK,yCAGL4M,aAAc,yBAGlB,CAAEC,iBAAiB,ICRA8hG,G,8MACNpgG,G,iGAMTzG,EAEEyG,EAFFzG,MACQ2C,EACN8D,EADFuE,KAAQrI,MAEJiwF,EAAgBjwF,EAAMzR,KAAI,SAAA9I,GAC9B,IAAM4iB,EAAO9I,GAAWxQ,OAAOtJ,GAE/B,OADA4iB,EAAKtI,iBAAiB1C,GACfgL,K,SAEc+X,QAAQ4hB,IAC7BiuD,EAAc1hG,KAAI,SAAA8Z,GAAI,OACpB,EAAKva,YAAL,2BACKgW,GADL,IAEE1V,QAASia,EAAKw1C,aAAajhD,qB,OAMjC,IAVM8C,E,OASAykG,EAAqBxpG,KAAKW,MAAMX,KAAKC,UAAU8E,IAC5CzX,EAAI,EAAGA,EAAIk8G,EAAmB97G,OAAQJ,IAC7C,IAASkgC,EAAI,EAAGA,EAAIg8E,EAAmBl8G,GAAGI,OAAQ8/B,IAEhDg8E,EAAmBl8G,GAAGkgC,GAAGi8E,OAASn8G,E,yBAI/B,CACLyX,SAAUykG,I,gLAMOp3G,G,8EACnBK,KAAKw8B,wBAAwB78B,G,SAEPK,KAAKy8B,OAAO98B,G,cAA5B+8B,E,OAKN18B,KAAK68B,2B,kBACEH,G,4GAhDwComE,ICiB7C74F,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC4oD,oBAAqB,CACnB1oD,QAASF,EAAMG,QAAQ,IAEzB0oD,gBAAiB,CACfhoD,SAAU,KAEZkyC,aAAc,CACZ/oB,UAAW,SACX5R,WAAYpY,EAAMG,QAAQ,GAC1BkY,cAAerY,EAAMG,QAAQ,QAG3B25F,GAAU3jG,oBACd,YAUM,IATJnJ,EASI,EATJA,MACA8yB,EAQI,EARJA,SACAsD,EAOI,EAPJA,SACApxB,EAMI,EANJA,MAOM0P,EAAU5B,KACRoT,EAAkB/D,sBAAWniB,GAA7BkmB,cACR,OACE,kBAAC,KAAD,CAAM4T,WAAS,EAACE,MAAI,EAACqiC,QAAQ,SAASlpD,QAAS,EAAG4mB,WAAW,UAC3D,kBAAC,KAAD,CACEuiC,QAAM,EACNnnD,QAAQ,WACR3C,MAAO0T,EAAc4M,GAAYA,EAAW,GAC5CsD,SAAU,SAAAtI,GACRsI,EAASyrB,OAAO/zB,EAAMuI,OAAO7jB,SAE/BxN,MAAOirB,QAAQjrB,GACfyrB,SAAUR,QAAQjrB,GAClBkQ,UAAWR,EAAQmnD,iBAElB31C,EAAclc,KAAI,SAAC5F,EAAM6X,GAAP,OACjB,kBAAC,KAAD,CAAUtG,IAAKvR,EAAMoO,MAAOyJ,GACzB7X,WAkHA03D,GA1GI3yD,oBAAS,YAAkD,IAA/CnJ,EAA+C,EAA/CA,MACvB0U,EAAU5B,KAD4D,EAE5Cya,mBAAS,CAAC,EAAG,IAF+B,mBAErEuF,EAFqE,KAE3Dk6E,EAF2D,OAGlDz/E,mBAAS,IAHyC,mBAGrEvoB,EAHqE,KAG9D0d,EAH8D,OAI1D6K,mBAAS,GAApBw/E,EAJqE,sBAK1Cx/E,mBAAuB,CAAE3sB,IAAK,KALY,mBAKrE08F,EALqE,KAK1Da,EAL0D,KAMpEj4E,EAAkB/D,sBAAWniB,GAA7BkmB,cANoE,4CAW5E,kCAAAtkB,EAAA,+DAC8BugB,sBAAWniB,GAA/By6C,EADV,EACUA,gBADV,KAGEz6C,EAHF,SAKU67B,QAAQ4hB,IACZ3qB,EACG9oB,IADH,uCACO,WAAMk+C,GAAN,eAAAtmD,EAAA,sEACoB64C,EAAgB2hB,gBACrCl2C,EAAcgiC,IAFb,YACGb,EADH,iDAKM,CACL13C,KAAM,mBACNf,QAAS,EACTuJ,SAAU,EACVmlD,YAAY,EAEZzkD,iBAAkBjQ,sBAAYy+C,EAASx9C,WAXxC,gCAcI,MAdJ,2CADP,uDAiBG8M,QAAO,SAAAkR,GAAC,QAAMA,MAvBvB,wBAGQ6hF,SAHR,gBA2BE1pG,EAAMyb,MAAMxM,SAAQ,SAAA6U,GAAI,OAAIA,EAAKxF,SAASte,EAAM8Y,UAE5C,QAASwkF,IACL39E,EAAW29E,EAAU18F,IACvB08F,EAAU18F,IAAImI,MAAMu0F,EAAU18F,IAAI4jF,YAAY,KAAO,GACrD,KAGE7lE,EAAgBwD,sBAAWniB,GAAOie,aAAa,CACnD8D,QAAS,YAAF,OAAcze,KAAK28C,OAC1B77C,KAAMub,EACNuG,cAAe4M,EAAS9oB,KAAI,SAAAk+C,GAAS,OAAIhiC,EAAcgiC,MACvDv4C,KAAM,eACNwW,QAAS,CACPxW,KAAM,aACNoR,YAAau8E,EACbp3E,cAAe4M,EAAS9oB,KAAI,SAAAk+C,GAAS,OAAIhiC,EAAcgiC,OAEzD5N,SAAU,CACR3qC,KAAM,2BAGV3P,EAAM+/D,YAAYphD,EAAcoD,UAjDpC,4CAX4E,sBAgE5E,OAzDKmE,EAAcpiB,QACjB4e,EAAS,4BAyDT,kBAAC,IAAD,CAAWxN,UAAWR,EAAQknD,qBAC5B,kBAAC,KAAD,CAAM9hC,WAAS,EAACE,MAAI,EAACqiC,QAAQ,SAASlpD,QAAS,EAAG4mB,WAAW,UAC3D,kBAAC,KAAD,CAAMC,MAAI,GACR,uBAAGllB,MAAO,CAAEkoB,UAAW,WAAvB,sCAGC,YAAI,IAAIp5B,MAAMmpG,IAAU/iG,KAAI,SAAChB,EAAG+S,GAAJ,OAC3B,kBAAC,GAAD,CACEpG,IAAG,cAASoG,EAAT,YAAkB+W,EAAS/W,IAC9B/W,MAAOA,EACP8tB,SAAUA,EAAS/W,GACnBqa,SAAU,SAAA1f,GACR,IAAMpJ,EAAOwlB,EAAS/pB,MAAM,GAC5BuE,EAAKyO,GAASrF,EACds2F,EAAY1/F,IAEdtN,MAAOA,QAKb,kBAAC,KAAD,CAAMg6B,MAAI,GACR,kBAAC,KAAD,4CACA,kBAAC,GAAD,CACE51B,KAAK,MACL4M,YAAY,GACZnJ,SAAUy1F,EACV9iE,YAAa,SAAAwqE,GAAG,OAAI7G,EAAa6G,OAIrC,kBAAC,KAAD,CAAMhrE,MAAI,GACR,kBAAC,IAAD,CAAQpU,QAjG4D,2CAiGtCzQ,QAAQ,YAAY9B,MAAM,WAAxD,cCvJKysG,GAVW32G,oBACxB,YAAkD,IAA/CnJ,EAA+C,EAA/CA,MAED,OADwBA,EAAhBioD,YAID,kBAAC,GAAD,CAAgCjoD,MAAOA,IAFrC,kBAAC,GAAD,CAAYA,MAAOA,OCLjB,SAASkrD,GAAkBr5C,GACxC,OAAOpT,QAAM8B,QACXw/G,GAAUluG,GACVpT,QAAMuB,MAAM,oBAAqB,CAC/B2P,KAAMlR,QAAMqkB,QAAQ,wBCLX,gBAACjR,GAAiC,IACvC+qC,EAAc/qC,EAAd+qC,UAER,OAAO,IADUA,EAAU,gDACpB,CAAa,CAClBx4C,KAAM,oBACN+L,WAAYysC,EAAU6yD,IACtBjgG,qBCkBiBwwG,G,kDAoBnB,WACE9xG,EACAqrC,GACA,2BACA,cAAMrrC,IAvBA47D,MAAQ,IAAIkiC,KAAsB,CACxCliC,MAAO,IAAImiC,GAAS,CAAEC,QAAS,IAC/BxpG,KAAM,kBAAM,EAAKijE,WAoBjB,EAjBM1d,aAAc,EAiBpB,EAfMg4D,eAAiC,GAevC,EAbMC,cAAgC,GAatC,EAXMC,iBAWN,IATMj6F,mBASN,IAPMk6F,2BAON,EAEA,IAAMD,EAAc9xG,yBAAeH,EAAQ,eACrCgY,EAAgB7X,yBAAeH,EAAQ,iBAH7C,OAIA,EAAKkyG,sBAAwBr4G,wBAC3BsG,yBAAeH,EAAQ,0BAGzB,EAAKiyG,YAAcA,EAAYn2G,KAAI,SAACwuE,GAClC,IAAMh0C,EAAW,OAAG+U,QAAH,IAAGA,OAAH,EAAGA,EAAgBi/B,GAAYh0C,YAChD,GAAIA,aAAuBj8B,0BACzB,OAAOi8B,EAET,MAAM,IAAI1+B,MAAJ,mCAAsCoI,EAAOsqE,WAAW7oE,KAAxD,SAGR,EAAKuW,cAAgBA,EAhBrB,E,4KAoBKrd,KAAKo/C,Y,gCACYp/C,KAAKu3G,sBAAsBn0G,SAAS,Q,cACnD4zC,MAAM,MAAM5wC,SAAQ,SAACozE,EAActmE,GACtC,GAAIsmE,EAAKv+E,QAAmB,QAATu+E,EAAgB,OACHA,EAAKxiC,MAAM,MADR,mBAC1BwgE,EAD0B,KACnBC,EADmB,KACZj7C,EADY,UAEEziE,IAA/B,EAAKq9G,eAAeI,KACtB,EAAKJ,eAAeI,GAAS,SAEIz9G,IAA/B,EAAKq9G,eAAeK,KACtB,EAAKL,eAAeK,GAAS,IAE/B,EAAKL,eAAeI,GAAO/vG,KAAKyL,GAChC,EAAKkkG,eAAeK,GAAOhwG,KAAKyL,GAChC,EAAKmkG,cAAcnkG,GAAS,CAAEskG,QAAOC,QAAOj7C,OAAQA,OAGxDx8D,KAAKo/C,aAAc,E,oRAQd,G,wQAKA,I,mIAGGh/C,GAAwC,WAAxB/D,EAAwB,uDAAJ,GAC9C,OAAOgE,aAAgB,uCAAU,WAAMC,GAAN,iBAAAvH,EAAA,sEACzB,EAAKkoE,MAAMlqE,IAAI,aAAcsF,EAAMA,EAAKgC,QADf,WAMhB,KADT6U,EAAQ,EAAKmK,cAAc+uD,QAAQhsE,EAAOzI,eALjB,uBAOvB2a,EAAW,EAAKglG,YAAYpkG,GAAOxS,YAAYN,GAPxB,SAQvBkS,EACH3R,KACCs7B,cAAI,SAAAxvB,IAIW,EAAK2qG,eAAe3qG,EAAQ1V,IAAI,UAAY,IACpDqP,SAAQ,SAAAw5B,GACXt/B,EAASgG,KACP,IAAIyX,GAAJ,2BACKtR,EAAQ+R,UADb,IAEEulF,UAAWnkE,aAMpBxD,YAzB0B,OA4B/B97B,EAASS,WA5BsB,2CAAV,yD,8CA5EuBrB,2BAA7By3G,GAkBLz9B,aAAe,CAAC,cAAe,eC5ChC5kE,qCACb,uBACA,CACEyiG,sBAAuB,CACrBzwG,KAAM,eACNiO,aAAc,CAAEhd,IAAK,4BAEvBu/G,YAAa,CACXxwG,KAAM,SACNiO,aAAc,IAEhBsI,cAAe,CACbvW,KAAM,cACNiO,aAAc,KAGlB,CAAEC,iBAAiB,ICuBb2vD,GAAeg9B,EAAfh9B,WAmCR,SAASmiC,GAAUliC,GAGjB,IAFA,IAAMU,EAAWX,GAAWC,GACxB3pE,EAAS,EACJJ,EAAI,EAAGA,EAAIyqE,EAASrqE,OAAQJ,GAAK,EAAG,CAC3C,IAAM+Y,GAAO0xD,EAASzqE,GAChBqqE,EAAKI,EAASzqE,EAAI,GACb,MAAPqqE,GAAqB,MAAPA,IAChBjqE,GAAU2Y,GAGd,OAAO3Y,EAGT,SAAS8rG,GAAsBniC,GAG7B,IAFA,IAAMU,EAAWX,GAAWC,GACxB3pE,EAAS,EACJJ,EAAI,EAAGA,EAAIyqE,EAASrqE,OAAQJ,GAAK,EAAG,CAC3C,IAAM+Y,GAAO0xD,EAASzqE,GAChBqqE,EAAKI,EAASzqE,EAAI,GACb,MAAPqqE,GAAqB,MAAPA,GAAqB,MAAPA,GAAqB,MAAPA,IAC5CjqE,GAAU2Y,GAGd,OAAO3Y,E,mNA0BPM,KAAO,8B,sDAECyN,GACNA,EAAc6xD,aAAY,kBACxB7xD,EAAc+qC,UAAU2jE,OAE1B1uG,EAAc6xD,aAAY,kBACxB7xD,EAAc+qC,UAAU4jE,OAG1B3uG,EAAc0xD,cAAa,WACzB,IAAM9zD,EAAekO,8BACnB,eACA,GACA,CAAEstC,kBAAmBhlC,GAAsBpU,KAE7C,OAAO,IAAI3B,EAAU,CACnB9L,KAAM,eACNqL,eACAU,WAAYyS,GACV/Q,EACA,eACApC,QAINoC,EAAcusC,gBAAe,WAC3B,IAAM3uC,EAAegxG,GACnB5uG,GAEF,OAAO,IAAItB,EAAY,CACrBnM,KAAM,2BACNqL,eACAU,WAAYuwG,GAA0CjxG,GACtDe,UAAW,eACXC,SAAU,wBACVjB,eAAgBmxG,QAGpB9uG,EAAcusC,gBAAe,WAC3B,IAAM3uC,EXvJL,SAA6BoC,GAClC,OAAO8L,8BACL,uBACA,CACE2gG,SAAU,CACR3uG,KAAM,cACNiO,aAAc,IAEhB08B,SAAU77C,QAAMC,SACdmT,EAAc0S,0BAA0B,YACxC,CAAE5U,KAAM,0BAEVixG,OAAQ,CAAEjxG,KAAM,UAAWiO,cAAc,IAE3C,CACEqtC,kBAAmB41D,GAAkBhvG,GACrCgM,iBAAiB,IWuIIijG,CACnBjvG,GAEF,OAAO,IAAItB,EAAY,CACrBnM,KAAM,uBACNqL,eACAU,WAAY4wG,GAAsCtxG,GAClDe,UAAW,eACXC,SAAU,oBACVjB,eAAgBmxG,QAGpB9uG,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,uBACNqL,aAAcuxG,GACd/wG,aAAc+vG,QAGpBnuG,EAAc06D,iBACZ,kBACE,IAAIozC,GAAsB,CACxBv7G,KAAM,wBACNqL,aAAcwxG,GACdzxG,eAAgB0xG,U,gCAKdrvG,GACJoyD,iCAAsBpyD,EAAc6oC,YACtC7oC,EAAc6oC,UAAUwpB,gBAAgB,CAAC,OAAQ,OAAQ,CACvD1iE,MAAO,sBACPskB,KAAMq7F,KACNv7F,QAAS,SAACtC,GACRA,EAAQ8gD,QAAQ,oBAAqB,OAK3C,IAAMrC,EAAK,SAACzsD,EAAkBmJ,GAC5B,OAAOnJ,EACH,CACE,CACE9T,MAAO,qBACPskB,KAAMwqF,KACN1qF,QAAS,WACP,IAAMtC,EAAUnB,sBAAW1D,GACrB8xF,EAAUj7F,EAAQ1V,IAAI,WACtB6tE,EAAQn4D,EAAQ1V,IAAI,SACpBotE,EAAQ13D,EAAQ1V,IAAI,SACpB4wG,GACHl7F,EAAQ1V,IAAI,QACT0V,EAAQ1V,IAAI,QAAQ4wG,GACpBl7F,EAAQ1V,IAAI,QAAU,GACtBkzE,EAAWx9D,EAAQ1V,IAAI,QACvB6wG,EAAe,GAAH,OAAM39B,EAAN,aACZ49B,EAAgBruF,kBAEpB5D,EAAM6D,YACN,iBACA,GACI4D,EAAgB,CAACwqF,EAAeD,GAChC1uF,EAAU,SAAH,OAAYze,KAAK28C,OACxBt+B,EAAY,GAAH,OAAMmxD,EAAN,eAAqB49B,GAC9BC,EAA0BH,EAAG3wD,MAAM,KACtClpC,QAAO,SAAAi6F,GAAG,QAAMA,KAChB5mG,KAAI,SAAC4mG,EAAK70F,GAAU,MACyB60F,EAAI/wD,MAAM,KADnC,mBACZgxD,EADY,KACLC,EADK,KACIC,EADJ,KACcC,EADd,KAEbC,EA5K1B,SAAwBxjC,GAGtB,IAFA,IAAMU,EAAWX,GAAWC,GACxBuF,EAAc,EACTtvE,EAAI,EAAGA,EAAIyqE,EAASrqE,OAAQJ,GAAK,EAAG,CAC3C,IAAM+Y,GAAO0xD,EAASzqE,GAChBqqE,EAAKI,EAASzqE,EAAI,GACb,MAAPqqE,GAAqB,MAAPA,GAAqB,MAAPA,IAC9BiF,GAAev2D,GAGnB,OAAOu2D,EAkKiCk+B,CAAeF,GAC/BG,EAAWxB,GAAUqB,GACrBI,EAAuBxB,GAAsBoB,GAC7CK,EAAkC,MAAbN,GAAoB,EAAI,EAC7CO,EA1I1B,SAAiB7jC,EAAel4D,GAC9B,OAAmB,IAAZA,IACDk4D,EAAMjrE,MAAM,eAAiB,IAAI,IAAM,IACvCirE,EAAMjrE,MAAM,iBAAmB,IAAI,IAAM,EAuIX+uG,CAAQP,EAASK,GAC7BG,GAAeV,EAAU,EAAIQ,EACnC,MAAO,CACLpyG,QAAS2xG,EACTxxG,MAAOmyG,EACPjyG,IAAKiyG,EAAcP,EACnBQ,UAAWN,EACXZ,QAASe,EACTI,MAAOV,EACPxwG,aAAckwG,EACdn7F,OAAQ87F,EACRvqF,SAAU,GAAF,OAAKxR,EAAQxV,KAAb,cAAuBic,GAC/Bw3D,KAAM,CACJl0E,MAAOiyG,EACP/xG,IAAK+xG,EAAYF,EACjBlyG,QAAS4zE,OAKXh8D,EAAOxB,EAAQ+R,SAErBvQ,EAAKy8D,KAAO,CACVr0E,QAAS4zE,EACTzzE,MAAOkxG,EACPhxG,IAAKgxG,EAAUX,GAAsBniC,IAMvC,IAAMkkC,EAGAhC,GADI,KAAR3iC,EACc2jC,EAAwB,GAAGe,MAC3BjkC,GAEVtyD,EAAW,CACfrE,GADY,mBAET65F,IAGLx1F,EAASlM,SAAQ,SAAC4Y,EAAG9L,GACnB8L,EAAE+kF,UAAY7wF,EACd8L,EAAE0rD,KAAKq5B,UAAY7wF,EACnB8L,EAAE0rD,KAAKzsD,SAAP,UAAqBe,EAAEf,SAAvB,YAEF3L,EAASsX,MAAK,SAAC7wB,EAAGC,GAAJ,OAAUD,EAAE2uG,QAAU1uG,EAAE0uG,WAItC,IAAM6Q,EAAqBjmG,EAAS2rB,OAElC3rB,EAASnR,KAAI,SAAA6d,GAAC,OAAIA,EAAE0rD,SAGhBq+B,EAAYz2F,EAASjD,QACzB,SAACtW,EAAGimB,GAAJ,OAAUjmB,EAAIimB,EAAEtoB,IAAMsoB,EAAExoB,QACxB,GAGFikB,EAAQ8gD,QAAQ,oBAAqB,CACnCz0D,KAAM,oBACN8L,MAAO,CACL,CACE9L,KAAM,mBACN2tD,YAAY,EACZnlD,SAAU,EACVvJ,QAASgjG,EAAY,IACrB/4F,iBAAkBsC,EAASnR,KAAI,SAAA6d,GAC7B,MAAO,CACLxoB,MAAOwoB,EAAExoB,MACTE,IAAKsoB,EAAEtoB,IACPL,QAAS2oB,EAAE3oB,QACXsB,aAAckwG,OAIpB,CACE/gG,KAAM,mBACN2tD,YAAY,EACZnlD,SAAU,EACVvJ,QAAS+iG,EAAc,IACvB94F,iBAAkB,CAChB,CACErY,aAAciwG,EACdpxG,MAAO,EACPE,IAAKoyG,EACLzyG,QAAS4zE,MAKjBq2B,iBAAkB,CAChB,CACEx5F,KAAM,eACNuW,gBACAC,QAAS,CACPxW,KAAM,oBACNwL,SAAUimG,GAEZ9mE,SAAU,CACR3qC,KAAM,yBAERoS,UACA3d,KAAMud,IAGV5D,OAAQ,CACN,CACEY,cAAeoD,EACfpS,KAAM,eACNqT,SAAU,CACR,CACErT,KAAM,uBACNgP,cAAe,GAAF,OAAKoD,EAAL,6BAKrBhR,YAAa,GAAF,OAAK+hE,EAAL,eAAoB49B,QAKvC,IAEN,SAASmB,EAAe/tF,GACJ,qBAAdA,EAAKnU,MACPmU,EAAK/F,OAAO9O,SAAQ,SAAAwP,GACC,oBAAfA,EAAM9O,MACR8O,EAAMuE,SAAS/T,SAAQ,SAAAoB,GAEF,wBAAjBA,EAAQV,MACPU,EAAQw3C,mCAAmC19C,SAAS43D,GAIpC,4BAAjB1xD,EAAQV,MACRU,EAAQ8lE,gBACP9lE,EAAQ8lE,cAActuB,mCAAmC19C,SACxD43D,IAGF1xD,EAAQ8lE,cAAc5rB,qCAAqCwX,GAR3D1xD,EAAQk6C,qCAAqCwX,SAezD9Y,mBAAQ,WAAM,MACN3lC,EAAO,UAAGzR,EAAc6oC,iBAAjB,aAAG,EAAyBp3B,QACrCA,GACFA,EAAQ7H,MAAMxM,SAAQ,SAAA6U,GAChBA,EAAKrI,MACPqI,EAAKrI,MAAMxM,SAAQ,SAAAnM,GAAC,OAAI+uG,EAAe/uG,MAEvC+uG,EAAe/tF,a,GAjRE0nB,ICpHtB,SAAS0f,GAAkBz7C,GAChC,OAAOhR,QACJ8B,QACC,wBACA+iD,GACA7kD,QAAMuB,MAAM,CACV2P,KAAMlR,QAAMqkB,QAAQ,yBACpBnE,cAAeoE,aAAuBtT,MAIzCgM,OAAM,SAAArb,GAAI,MAAK,CACd,gBACE,MAAO,iBAET,kBACE,OAAO,KAET,kBACE,8CACKA,EAAK0qD,qBACLzrC,GAAqBjf,IAF1B,IAGE8N,OAAQ9N,EAAKue,cAAc27B,YAG/B,uBACE,OAAOl6C,EAAKue,cAAc27B,SAAS3qC,UC3B3C,SAAS0xG,GAAU,GAOhB,IAND/rG,EAMC,EANDA,QACApH,EAKC,EALDA,OAKC,IAJDozG,aACE94E,EAGD,EAHCA,EAGD,IAFC9/B,KAAQ64G,EAET,EAFSA,QAAS/2B,EAElB,EAFkBA,SAAUnlB,EAE5B,EAF4BA,MAGvBm8C,EAAanzG,yBAAeH,EAAQ,aAAc,CAAxD,IAEMuzG,EAAc95G,OAApB,GAEM+5G,EAAN,KADkB,EAACl3B,EAAgBi3B,EAAnC,QAEA,OAAIC,EAAJ,GAA4B,KAE1B,0BACE5sG,MAAO,CAAEqV,SAAF,EAAwBznB,KAAMiyC,GAAqB6sE,IAC1D/8G,EAFF,EAGE+jC,EAAGA,IAAek5E,EAHpB,IAIEx2B,WAJF,SAKEC,iBAAiB,WANrB,GA8BF,SAASw2B,GAAS/xG,GAChB,IAAMgyG,EAAqB,SAAA9zF,GAAS,IACN+zF,EAAqBjyG,EADf,mBACG0F,EAAY1F,EADf,QAElC,KACA,OAAOiyG,EAAQ/zF,EAAOxY,EAAtB,OAGIwsG,EAAsB,SAAAh0F,GAAS,IACN+zF,EAAqBjyG,EADf,oBACG0F,EAAY1F,EADf,QAEnC,KACA,OAAOiyG,EAAQ/zF,EAAOxY,EAAtB,OAGIysG,EAAoB,SAAAj0F,GAAS,IACN+zF,EAAqBjyG,EADf,kBACG0F,EAAY1F,EADf,QAEjC,KACA,OAAOiyG,EAAQ/zF,EAAOxY,EAAtB,OAGI0sG,EAAqB,SAAAl0F,GAAS,IACN+zF,EAAqBjyG,EADf,mBACG0F,EAAY1F,EADf,QAElC,KACA,OAAOiyG,EAAQ/zF,EAAOxY,EAAtB,OAGI2sG,EAAmB,SAAAn0F,GAAS,IACN+zF,EAAqBjyG,EADf,iBACG0F,EAAY1F,EADf,QAEhC,KACA,OAAOiyG,EAAQ/zF,EAAOxY,EAAtB,OAGI4sG,EAAsB,SAAAp0F,GAAS,IACN+zF,EAAqBjyG,EADf,oBACG0F,EAAY1F,EADf,QAEnC,KACA,OAAOiyG,EAAQ/zF,EAAOxY,EAAtB,OAGI6sG,EAAqB,SAAAr0F,GAAS,IACN+zF,EAAqBjyG,EADf,mBACG0F,EAAY1F,EADf,QAElC,KACA,OAAOiyG,EAAQ/zF,EAAOxY,EAAtB,OAGIo1C,EAAiB,SAAA58B,GAAS,IACN+zF,EAAqBjyG,EADf,eACG0F,EAAY1F,EADf,QAE9B,KAEA,OADAke,oBACO+zF,EAAQ/zF,EAAOxY,EAAtB,OAIAA,EAQE1F,EA3DmB,QAoDrB1B,EAOE0B,EA3DmB,SA2DnBA,EA3DmB,aAsDnBwyG,EAtDmB,iBAuDnB55E,EAvDmB,aAwDXgiD,EAxDW,WAwDDnlB,EAxDC,QA0DrB7hC,EACE5zB,EA3DmB,kBA6DjByyG,EAAa,CACjB3/G,KAAM2L,yBAAeH,EAAQ,cAAe,CAAxB,KAElBvG,YAA8BA,OAAO2N,EAAzC,QACE+sG,cAGF,IAAMC,EAAa,CACjB5/G,KAAM2L,yBAAeH,EAAQ,aAAc,CAAvB,KAGhBo4E,EAAcj4E,yBAAeH,EAAQ,cAAe,CAA1D,IAEA,OACE,uBAAGiiB,cAAa7a,QACd,+BAAQjH,yBAAeH,EAAQ,UAAW,CAD5C,KAEE,4BACEq+E,GADF,EAEEC,GAAIhkD,EAFN,EAGE/kC,EAHF,EAIEqR,MAJF,EAKEwZ,YALF,EAME6rD,aANF,EAOE58C,WAPF,EAQED,YARF,EASEm+B,UATF,EAUE5Q,aAVF,EAWE93B,YAXF,EAYEnN,QAZF,EAaEwvC,QAbF,EAcE9+B,OAAQyrF,IAETv3B,YACC,4BACE+B,GADF,EAEEC,GAAIhkD,EAFN,EAGE/kC,EAAG+mF,EAHL,EAIE11E,MAJF,EAKEwZ,YALF,EAME6rD,aANF,EAOE58C,WAPF,EAQED,YARF,EASEm+B,UATF,EAUE5Q,aAVF,EAWE93B,YAXF,EAYEnN,QAZF,EAaEwvC,QAbF,EAcE9+B,OAAQyrF,IAGZ,yCAAsB18C,MAAOA,MAyCnCs8C,gBAAwB,CACtBn+E,uBADsB,EAGtBo+E,wBAHsB,EAItBE,yBAJsB,EAKtBC,uBALsB,EAMtBC,wBANsB,EAOtBC,sBAPsB,EAQtBC,yBARsB,EAStBC,wBATsB,EAWtBz3D,oBAAgB9nD,GAEHuG,0BAAf,IClNA,SAASo5G,GAAM3yG,GAAO,IAElB0F,EAQE1F,EAVgB,QAGlB1B,EAOE0B,EAVgB,SAUhBA,EAVgB,aAKhBwyG,EALgB,iBAMhB55E,EANgB,IAORgiD,EAPQ,gBASlBhnD,EACE5zB,EAVgB,kBAYdkF,EAAQ,CAAEpS,KAAM2L,yBAAeH,EAAQ,YAAa,CAAtB,KAIpC,OAHIvG,YAA8BA,OAAO2N,EAAzC,QACER,cAGA,0BACE+wB,GADF,EAEEE,GAFF,EAGED,GAHF,EAIEE,GAAIwC,EAAI,EAJV,EAKEiqB,OAAQpkD,yBAAeH,EAAQ,aAAc,CAL/C,IAMEo4E,YAAaj4E,yBAAeH,EAAQ,aAAc,CAAvB,cA0BjCq0G,gBAAqB,CACnB/+E,uBAAmB5gC,GAGNuG,0BAAf,IClDA,SAASq5G,GAAkB5yG,GACzB,IAYMuqE,EAAe,SAAArsD,GAAS,IACN+zF,EAAYjyG,EADN,aAE5B,KACA,OAAOiyG,EAAP,IAGIh3D,EAAe,SAAA/8B,GAAS,IACN+zF,EAAYjyG,EADN,aAE5B,KACA,OAAOiyG,EAAP,IAqBF,cAA0B,IAChBvsG,EAAqC9M,EADrB,QACPoG,EAA4BpG,EADrB,QACES,EAAmBT,EADrB,OACUwhC,EAAWxhC,EADrB,OAGlB65D,EAAW90D,SAAS+H,aAAqBA,MAA9B/H,UAAjB,EACM40D,EAAWvmD,kBAAOymD,EAAUp5D,EAAlC,GACMuhF,EAAWn8E,yBAAe7F,EAAD,gBAAwB,CAAvD,IAEA,GACEzD,cACE,IAAIe,MAAM,mBAAV,4CACwDwP,EAF1DvQ,QAKFilC,MAAW10B,EAAX00B,SAAmCwgD,EAAnCxgD,EAAiDwgD,EAAc,CAC7D7/B,UAAWr1C,EADkD,KAE7DisG,QAF6D,EAG7D/2B,SAH6D,EAI7DnlB,MAAOh3D,yBAAe7F,EAAD,eAAuB,CAAvB,MA5DO,MAiE9BqB,EAME+F,EAvE4B,QAkE9BhB,EAKEgB,EAvE4B,QAmE9Bo6B,EAIEp6B,EAvE4B,OAoE9B1B,EAGE0B,EAvE4B,OAqE9BuL,EAEEvL,EAvE4B,SAsEd4zB,EACd5zB,EAvE4B,+BAyEzB3G,EAzEyB,oBA0E1Bw5G,EAAN,GACMC,EAAN,GA3EgC,eA4EVvnG,EA5EU,cA4EhC,2BAAyC,CACvCwnG,EAAW,CACTrtG,QAFqC,QAGrC1G,QAFS,EAGT3F,OAHS,EAITiF,OAJS,EAKT87B,YAlF4B,mDAsFLA,eAtFK,cAsFhC,2BAA8D,KAAnDs3E,EAAmD,QACtDhsG,EAAU6F,MAAammG,OAA7B,WACAoB,OACE,yCAEEpB,aAFF,EAGEhsG,QAHF,EAIEK,IAAG,gBAAWL,EAJhB,MAKEkuB,kBAAmBA,OA9FO,mDAmGLwG,eAnGK,cAmGhC,2BAA8D,KAAnDs3E,EAAmD,QACtDhsG,EAAU6F,MAAammG,OAA7B,WACAoB,OACE,yCAEEpB,aAFF,EAGEhsG,QAHF,EAIEK,IAAG,eAAUL,EAJf,MAKEkuB,kBAAmBA,OA3GO,8BAgHhC,IAAM1qB,GAAS7P,MAAaA,EAAd,OAAd,EACM6jB,EAASkd,EAAf,iBAEA,OACE,yBACE90B,UADF,oBAEE4D,MAFF,EAGEgU,OAHF,EAIEhY,MAAO,CACL7H,SAAU,YAEZqhB,YA1HgB,SAAAR,GAAS,IACN+zF,EAAYjyG,EADN,YAE3B,KACA,OAAOiyG,EAAP,IAwHEpmD,UArHc,SAAA3tC,GAAS,IACN+zF,EAAYjyG,EADN,UAEzB,KACA,OAAOiyG,EAAP,IAmHE1nC,aATF,EAUEtvB,aAVF,EAWEvtB,YAtGgB,SAAAxP,GAAS,IACN+zF,EAAYjyG,EADN,YAE3B,KACA,OAAOiyG,EAAP,IAoGEtkF,WAjGe,SAAAzP,GAAS,IACN+zF,EAAYjyG,EADN,WAE1B,KACA,OAAOiyG,EAAP,IA+FEzsD,QAbF,EAcE9+B,OAdF,EAeE1Q,QA9FY,SAAAkI,GAAS,IACN+zF,EAAYjyG,EADN,QAEvB,KACA,OAAOiyG,EAAP,KA4EA,EADF,GAiDFW,gBAAiC,CAC/BjgG,aAD+B,GAG/BpH,SAAU,IAHqB,IAK/BmT,iBAL+B,EAM/BmtC,eAN+B,EAO/B0e,kBAP+B,EAQ/BtvB,kBAR+B,EAS/BvtB,iBAT+B,EAU/BC,gBAV+B,EAW/B3X,aAAShjB,GAGIuG,0BAAf,ICzLewU,iCACb,mBACA,CACEilG,YAAa,CACXjzG,KAAM,QACNqB,YAAa,mCACb4M,aAAc,QACd+jC,kBAAmB,CAAC,YAEtB6/D,WAAY,CACV7xG,KAAM,QACNqB,YAAa,mCACb4M,aAAc,UACd+jC,kBAAmB,CAAC,YAEtB2kC,YAAa,CACX32E,KAAM,SACNqB,YAAa,8BACb4M,aAAc,EACd+jC,kBAAmB,CAAC,YAEtBwwC,OAAQ,CACNxiF,KAAM,SACNqB,YAAa,yCACb4M,aAAc,2OAUd+jC,kBAAmB,CAAC,YAEtBkhE,QAAS,CACPlzG,KAAM,SACNqB,YACE,sEACF4M,aAAc,iEAKd+jC,kBAAmB,CAAC,YAEtBmhE,eAAgB,CACdnzG,KAAM,SACNqB,YAAa,6CACb4M,aAAc,GAEhBmlG,WAAY,CACVpzG,KAAM,QACNqB,YAAa,8BACb4M,aAAc,QACd+jC,kBAAmB,CAAC,YAEtBqhE,WAAY,CACVrzG,KAAM,SACNqB,YAAa,wCACb4M,aAAc,EACd+jC,kBAAmB,CAAC,YAEtB0jB,MAAO,CACL11D,KAAM,SACNqB,YACE,kFACF4M,aAAc,kEAKd+jC,kBAAmB,CAAC,aAGxB,CAAE9jC,iBAAiB,IC9DRolG,GAAb,WAKE,cAA0C,IAA5BnqG,EAA4B,EAA5BA,MACZ,GADwC,yBAJ1CA,WAI0C,OAF1CswB,YAAc,EAE4B,KAK1C85E,MAAsB,GALoB,KAO1Cl5E,OAAoB,IAAI14B,IAPkB,KAS1C6xG,aAAc,GARPrqG,EAAO,MAAM,IAAIhT,MAAM,+CAC5B+C,KAAKiQ,MAAQA,EAPjB,gDAiBIgO,EACAs7F,EACAtpG,EACAgU,EACApkB,GAEAG,KAAKq6G,MAAM5yG,KAAK,CAAEwW,WAAUs7F,iBAAgBtpG,QAAOgU,SAAQpkB,SAC3DG,KAAKs6G,aAAc,IAxBvB,gCA8BYxkG,GACR,IAAK9V,KAAKs6G,YAAa,OAAOt6G,KAAKmhC,OACnC,IAAKrrB,EAAe,MAAM,IAAI7Y,MAAM,iCAWpC,IATA,IAAM8iD,EAAOv6C,yBAAesQ,EAAe,kBAIrCykG,EAASv6G,KAAKq6G,MAAMzwF,MAAK,SAAC7wB,EAAGC,GAAJ,OAAUD,EAAE8G,KAAK28D,MAAQxjE,EAAE6G,KAAK28D,SAG3Dg+C,EAAY,EACVC,EAAyC1/G,MAAMw/G,EAAOt/G,QACnDJ,EAAI,EAAGA,EAAI0/G,EAAOt/G,OAAQJ,GAAK,EAAG,CASzC,IARA,IAAM6/G,EAAcH,EAAO1/G,GACnB0+G,EAAkCmB,EAAlCnB,eAAgBtpG,EAAkByqG,EAAlBzqG,MAAOgU,EAAWy2F,EAAXz2F,OACzBztB,EAAQ+iH,EAAiBtpG,EAAQ,EACjCvZ,EAAMF,EAAQyZ,EAChBkW,EAAM45B,EACNyjC,EAASr9D,EAAMlC,EAGV8W,EAAI,EAAGA,EAAIlgC,EAAGkgC,GAAK,EAAG,KACpB4/E,EADoB,YACMF,EAAc1/E,GADpB,MAGxB6/E,EAIDD,EAJF/+G,EACGi/G,EAGDF,EAHFh7E,EACOm7E,EAELH,EAFF1qG,MAII8qG,EAAaF,EAFfF,EADF12F,OAKAtV,GAAeisG,EAHDA,EAAYE,EAGStkH,EAAOE,IAC1CiY,GAAeksG,EAASE,EAAY50F,EAAKq9D,KAIzCA,GADAr9D,EAAM40F,GACS92F,EACf8W,GAAK,GAKT0/E,EAAc5/G,GAAK,CACjB6/G,EAAYz8F,SADK,2BAEZy8F,GAFY,IAEC9+G,EAAGpF,EAAOmpC,EAAGxZ,KAE7Bq9D,EAASg3B,IAAWA,EAAYh3B,GAQtC,OAHAxjF,KAAKugC,YAAci6E,EACnBx6G,KAAKmhC,OAAS,IAAI14B,IAAIgyG,GACtBz6G,KAAKs6G,aAAc,EACZt6G,KAAKmhC,SAtFhB,uCA0FI,GAAInhC,KAAKs6G,YACP,MAAM,IAAIr9G,MAAM,0DAClB,OAAO+C,KAAKugC,cA5FhB,wCAgGI,OAAOvgC,KAAKwe,WAhGhB,+BAoGI,GAAIxe,KAAKs6G,YACP,MAAM,IAAIr9G,MAAM,kDAClB,MAAO,CAAE+9G,MAAO,YAAIh7G,KAAKi7G,aAAc16E,YAAavgC,KAAKwgC,qBAtG7D,kCA0GI,MAAM,IAAIvjC,MAAM,qBA1GpB,KA8Gai+G,GAAb,WAKE,cAMG,IALDF,EAKC,EALDA,MACAz6E,EAIC,EAJDA,YAIC,yBAVHY,YAUG,OARHZ,iBAQG,EACDvgC,KAAKmhC,OAAS,IAAI14B,IAAIuyG,GACtBh7G,KAAKugC,YAAcA,EAbvB,gDAgBMtiB,GACF,IAAKje,KAAKmhC,OAAOxjB,IAAIM,GACnB,MAAM,IAAIhhB,MAAJ,sDAAyDghB,MAlBrE,kCAsBI,OAAOje,KAAKmhC,SAtBhB,uCA0BI,OAAOnhC,KAAKugC,eA1BhB,gCA8BI9hB,GAEA,OAAO,IAAIy8F,EAA0Bz8F,OAhCzC,KCxHM08F,G,2KACS,MAGYn7G,KAAKgB,QAHjB,GAILoO,GAJK,eAIqBpP,KAAhC,QACA,OAAO,IAAI,GAAJ,GAAgC,CAAEiQ,MAAOb,M,sCAIhD,OAD0B,M,GATMwyB,I,+KAepBjiC,GACZ,OAAO,IAAI,GAAX,K,gDAGwB8e,GACxB,OAAO,IAAI,GAAX,O,GANyByjB,I,+MCN3B3mC,KAAO,iB,sDAECyN,GACNA,EAAc06D,iBACZ,kBACE,IACI03C,GAAiB,CACnB7/G,KAAM,mBACNoL,eAAgB00G,GAChBz0G,aAAc00G,QAIpBtyG,EAAcusC,gBAAe,WAC3B,IAAM3uC,ECxBL,SAA6BoC,GAClC,OAAO8L,8BACL,wBACA,CAAE28B,SAAUzoC,EAAc0S,0BAA0B,aACpD,CACE0mC,kBAAmBxJ,GACnB5jC,iBAAiB,IDkBIumG,CACnBvyG,GAEF,OAAO,IAAItB,EAAY,CACrBnM,KAAM,wBACNqL,eACAU,WAAYk0G,GAAuC50G,GACnDe,UAAW,eACXC,SAAU,mBACVjB,eAAgB8zD,Y,GAxBK93B,I,uFELvB14B,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6X,KAAM,CACJxB,OAAQrW,EAAMG,QAAQ,IAExBmxG,SAAU,CACRj7F,OAAQrW,EAAMG,eAyCHhK,2BArCf,YAAwD,IAAvCnJ,EAAuC,EAAvCA,MACT0U,EAAU5B,KACV+X,EAAO7qB,EAAQmiB,sBAAWniB,GAAS,CAAE0/C,QAAS,IACpD,OACE,yBAAKxqC,UAAWR,EAAQmW,MACtB,kBAAC,KAAD,CAAY1V,QAAQ,KAAKovG,MAAM,SAASlxG,MAAM,WAA9C,aAGA,kBAAC,KAAD,CAAY8B,QAAQ,KAAKovG,MAAM,SAASrvG,UAAWR,EAAQ4vG,UACxDz5F,EAAK60B,SAER,kBAAC,KAAD,CAAY6kE,MAAM,SAASpvG,QAAQ,SAAnC,eACe,IACb,kBAAC,KAAD,CAAMjN,KAAK,mBAAmBmuB,OAAO,SAASwnE,IAAI,uBAAlD,QAEQ,IAJV,WAOA,6BACA,kBAAC,KAAD,CAAY0mB,MAAM,UAAlB,sDChCO90G,GAAekO,8BAAoB,cAAzC,IAEMxN,GAAa,4BAA2B,CACnDrQ,GADmD,aAEnD6P,KAAMlR,iCCAFqU,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6X,KAAM,CACJxB,OAAQrW,EAAMG,QAAQ,GACtBgX,SAAU,SAEZm6F,SAAU,CACRj7F,OAAQrW,EAAMG,eA8DHhK,2BA1Df,YAAwD,IAAxCnJ,EAAwC,EAAxCA,MACR0U,EAAU5B,KACV+X,EAAO7qB,EAAQmiB,sBAAWniB,GAAS,CAAE0/C,QAAS,IACpD,OACE,yBAAKxqC,UAAWR,EAAQmW,MACtB,kBAAC,KAAD,CAAY1V,QAAQ,KAAKovG,MAAM,SAASlxG,MAAM,WAA9C,aAGA,kBAAC,KAAD,CAAY8B,QAAQ,KAAKovG,MAAM,SAASrvG,UAAWR,EAAQ4vG,UACxDz5F,EAAK60B,SAGR,yIAIA,4BACE,4BACE,kBAAC,KAAD,CACEx3C,KAAK,yDACLmuB,OAAO,SACPwnE,IAAI,uBAHN,4BAQF,4BACE,kBAAC,KAAD,CACE31F,KAAK,+DACLmuB,OAAO,SACPwnE,IAAI,uBAHN,iBAQF,4BACE,kBAAC,KAAD,CACE31F,KAAK,0CACLmuB,OAAO,SACPwnE,IAAI,uBAHN,eAQF,4BACE,kBAAC,KAAD,CACE31F,KAAK,gCACLmuB,OAAO,SACPwnE,IAAI,uBAHN,uBC3DGpuF,GAAekO,8BAAoB,aAAzC,IAEMxN,GAAa,2BAA0B,CAClDrQ,GADkD,aAElD6P,KAAMlR,gC,wFCmBR,SAAS+lH,GAASC,EAAUC,GAC1B,OAAO,SAAA90G,GAAK,OAAI80G,EAAQ90G,EAAZ,KAGd,IAAMkD,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6X,KAAM,CACJxB,OAAQrW,cAEV0b,MAAO,CACLre,QADK,OAELqjD,cAAe,UAEjBixD,SAAU,CACR3nF,UADQ,SAER3T,OAAQrW,UAFA,GAGRE,QAASF,UAHD,GAIRmiB,YAJQ,EAKRD,aALQ,EAMRyC,YAAa6sF,GAAS,eAAgB,CACpCI,KAAM5xG,oBAD8B,MAEpC6xG,MAAO7xG,UAAcgnD,UAEvB/kC,YAVQ,SAWRjhB,gBAAiBwwG,GAAS,eAAgB,CACxCI,KAAMj1F,gBAAK3c,eAAD,QAA6BA,iBADC,cAExC6xG,MAAO7xG,qBAAyB8b,UAElCD,QAfQ,OAgBRonC,WAhBQ,0BAiBR,UAAW,CACTt+B,YAAa3kB,oBAAwB0kB,QAGzCotF,WAAY,CACVzxG,MAAOL,eAAmBmV,WAE5B48F,cAAe,CACbhwG,UAAW/B,cAEb+yC,aAAc,CACZhxC,UAAW/B,UADC,GAEZgqB,UAAW,UAEbgoF,SAAU,CACR9xG,QAASF,gBAEXI,WAAY,CACVC,MAAO,eAiMIlK,2BA7Lf,SAA6ByG,GAAO,MACM2d,mBADN,uBAC3Bw4B,EAD2B,KACbk/D,EADa,OAEoB13F,mBAFpB,uBAE3B23F,EAF2B,KAENC,EAFM,OAQ9BC,aAAY,CACdC,OAAQ,kBAAMJ,EAAN,OALRK,EAJgC,gBAKhCC,EALgC,eAMhCC,EANgC,gBAOhCC,EAPgC,eAWlC73F,qBAAU,WAAM,4CACd,wCAAAhsB,EAAA,sDACQ8jH,EADR,iFAEan3G,EAFb,QAGQL,OAHR,EAKO,CAAC,oBAAD,SAA2DK,EALlE,uBAOML,EAAS,CAAElJ,MAAO,+BAAF,OAAiCuJ,EAAjC,OAPtB,6BAQaA,OAAY,IAAM,KAAN,SARzB,qBASML,EAAS,CACPlJ,MAAO,sBAAF,OAAwBuJ,EAAxB,yCAA6DA,EAA7D,OAVb,+BAaYo3G,EAAa59G,wBAAa,CAAEO,KAAMiG,IACpCq3G,OAdV,sBAiB+BD,WAjB/B,gBAiBQC,EAjBR,0DAmBQ7gH,oBACAmJ,EAAS,CAAElJ,MAAO,wBAAF,OAA0BuJ,EAA1B,yBApBxB,QAsBM,KACE,IACEL,EAASkI,WAATlI,GACA,MAAOlJ,GACPD,iBACAmJ,EAAS,CAAElJ,MAAO,iBAAF,OAAmBuJ,EAAnB,sBAEfL,EAAL,QACOA,EAAL,iBAA4BA,qBACvBA,iBAAL,OACEA,gDAAgDK,EAAhDL,QAhCV,QAmCIw3G,UAnCJ,+IAsCEP,EACEG,EAAA,KAAkB,cAEhB,OADA/2G,SAAcm3G,EAAdn3G,GACA,MAzCN,yEADc,0DA+Cds3G,KACC,CAhDHj4F,IAiDA,IAAMlZ,EAAU5B,GAAU,CAAE2yG,iBAEpBK,EAAyCl2G,EA9Df,YA8Dbm2G,EAA4Bn2G,EA9Df,iBA8DK5P,EAAU4P,EA9Df,MA+D5B0T,EAAUnB,sBAAhB,GA/DkC,4CAiElC,sBAAAvgB,EAAA,+EAEUkkH,EAAYZ,EAAA,KAAwB,SAAA32G,GAAI,OAAIA,EAAJ,WAFlD,OAGIw3G,EAAiBb,2BAAjBa,MACAziG,gBAJJ,gDAMI2hG,EAAgB,GAAD,SAAfA,KANJ,0DAjEkC,sBAoFlC,OACE,yBAAK/vG,UAAWR,EAAQmW,MACtB,wBAAO3V,UAAWR,EAAQga,OACxB,wBAAS62F,EAAa,CAAErwG,UAAWR,EAAQiwG,WACzC,0BAAWa,KACX,wBAAiBtwG,UAAWR,EAA5B,WAAgDyV,SAAS,UACzD,wBAAY9W,MAAZ,gBAAkCkxG,MAAlC,SAAiDpvG,QAAQ,SAH3D,4BAME,wBAAY9B,MAAZ,gBAAkCkxG,MAAlC,SAAiDpvG,QAAQ,SAN3D,MASE,uBAAQ9B,MAAR,UAAwB8B,QAAQ,aAXtC,kBAgBG+vG,EAAA,OACC,oCACE,wBAAMhmF,UAAW,sCACdgmF,EAAA,KAAwB,qBACvB,wBAAUvvG,IAAKpH,EAAK5C,MAClB,4BACG4C,eAAoB,uBAApBA,MAAoC,uBAFzC,OAIGA,EAAA,aACC,wBAAY8E,MAAZ,QAA0B6B,UAAWR,EAAQswG,UAC1Cz2G,SAFJ,OAKC,wBACEiE,MAAOjE,wBADT,KAEEksB,WAFF,EAGEyyB,WAAY3+C,EAHd,KAIE6nB,SAAU,SAAAtI,IA3C5B,cACEq3F,EACED,EAAA,KAAwB,cAEtB,OADIjpG,IAAJ,IAAqB1N,gCACrB,MAwCcy3G,CAAiBl4F,SAAD,MAAhBk4F,IAEF9wG,UAAWR,EAAQswG,WAGvB,4BACE,wBACEp/F,QAAS,WACPs/F,cACA,IAAIA,UAAkCD,MACtCE,EAAuBD,EAAA,KAAwB,SAAApgH,GAAC,cAElDuO,MAAM,aAEN,uBA7BiB,aAmC3B,uBACEA,MADF,UAEE8B,QAFF,YAGEsb,SAAUR,QACR81B,GACEm/D,EAAA,MAAyB,SAAA32G,GAAI,OAAIA,SAAJ,UAEjCqX,QAlJwB,4CAqG7B,WAhBH,KAmEGmgC,EACC,oCACE,yBAAK7wC,UAAWR,EAAQqxC,cACtB,wBAAW1yC,MAAX,QAAyB8W,SAAS,WAEpC,6BACE,wBAAWrV,MAAO,CAAEC,UAAW,IAC7B,wBACE3B,WAAY,wBAAgB8B,UAAWR,EAAQtB,cAE/C,wBAAYC,MAAZ,QAA0BkxG,MAAM,UAC7BW,8EALP,yGAUE,4BACE,yBAAKpwG,MAAO,CAAEsb,UAAW,SACvB,wBAAY/c,MAAZ,QAA0BkxG,MAAM,UAlB/B,QApEjB,SC9JW90G,GAAekO,8BAAoB,4BAAzC,IAEMxN,GAAa,0CAAyC,CACjErQ,GADiE,aAEjE6P,KAAMlR,+C,sBCeFqU,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6X,KAAM,CACJxB,OAAQrW,cAEV8jB,QAAS,CACP5jB,QAASF,kBAIPizG,GAAgB98G,oBAAS,YAAiB,IAAdma,EAAc,EAAdA,QAC1B5O,EAAU5B,KACVozG,EAAmB9vG,WACvBwpC,qBAAqBt8B,EAArBs8B,qBADuBxpC,MAAzB,QAF8C,GAMvB8vG,GANuB,UAMtCzqG,OANsC,WAOxCirF,EAAcjrF,EAAA,KACb,SAAAqI,GAAI,OAAIA,SAAJ,UADS,QAEV,qBAAUliB,EAAV,IAFV,GAIA,OAAOskH,EACL,wBAAOhxG,UAAWR,EAAQmW,MACxB,wBAAMqU,UAAW,yDACf,wBAAUs8B,QAAV,EAAiB51C,QAAS,kBAAMtC,EAAN,wBACxB,4BACE,uBAFJ,OAIE,wBACE2E,QAASi+F,EADX,KAEE/9F,UACE7E,SAAiB4iG,EAAjB5iG,gCAEO7H,EAFP6H,mBAEuBqjF,KAAU,OAE3BlrF,EAJN6H,oEAMoBqjF,KAAU,QAN9BrjF,SAVZ,QAyBana,uBAAS,YAAiB,IAAdma,EAAc,EAAdA,QACnB5O,EAAU5B,KADuB,EAEiBya,mBAFjB,yBAEhC44F,EAFgC,KAEVC,EAFU,OAGf74F,oBAHe,sBAGhC2B,EAHgC,KAG1BqF,EAH0B,KAUvC,aAAkD,IAAvB4L,EAAuB,wDAChD,GACE7c,qBAA2BA,gBAA3BA,IAEF8iG,QACA7xF,MAGF,IAAM8xF,EACJF,SACI7iG,mBADJ6iG,KADF,GAKA,OACE,oCACE,sBAAe7iG,QAASA,IACxB,wBAAOpO,UAAWR,EAAQmW,MACxB,wBAAMqU,UAAW,+CACd5b,EAAA,qBACCA,EAAA,mBAA0B,cAA0B,MAC3BijF,EAD2B,MAC1C9qF,OAD0C,WAE5CirF,EAAcjrF,EAAA,KACb,SAAAqI,GAAI,OAAIA,SAAJ,UADS,QAEV,qBAAUliB,EAAV,IAFV,GAGA,OACE,wBACE45D,QADF,EAEE/qC,SAAUnN,SAAiBijF,EAF7B,KAGE3gF,QAAS,kBAAMtC,kBAAwBijF,EAA9B,OACT5wF,IAAK4wF,EAAgBniG,MAErB,4BACE,uBAPJ,OASE,wBACE6jB,QAASs+E,EADX,KAEEp+E,UACE7E,SAAiBijF,EAAjBjjF,gCAEO7H,EAFP6H,mBAEuBqjF,KAAU,OAE3BlrF,EAJN6H,oEAMYqjF,KAAU,QANtBrjF,MASJ,4BACE,wBACEoV,KADF,MAEEjI,SAAUnN,SAAiBijF,EAF7B,KAGE95E,aAHF,SAIE7G,QAAS,kBAxD7B,YACEwgG,KACA7xF,MAsDiC+xF,CAAN,KAET,uBA7BR,YAoCF,wBAAYpxG,UAAWR,EAAQoiB,SA9CvC,6BAoDE,wBACE5H,KADF,EAEEiuC,kBAFF,qBAGEC,mBAAiB,4BAEjB,wBAAat9D,GAAG,sBAAhB,4BALF,OAQE,4BACE,wBAAmBA,GAAG,4BAT1B,iCAaE,4BACE,uBAAQ8lB,QAAS,kBAAM0Z,KAAqBjsB,MAAM,WADpD,UAIE,uBACEuS,QAAS,kBAAM0Z,GAAN,IACTjsB,MAFF,UAGEgtB,WAAS,GAzEnB,gBCvFW5wB,GAAekO,8BAAoB,iBAAzC,IAEMxN,GAAa,+BAA8B,CACtDrQ,GADsD,aAEtD6P,KAAMlR,oC,+MC2BN2F,KAAO,c,sDAECyN,GACNA,EAAcgyD,eAAc,WAC1B,OAAO,IAAIlzD,EAAW,CACpBvM,KAAM,cACNwM,QAAS,QACTnB,aAAc82G,GACdp2G,WAAYq2G,GACZh3G,eAAgBi3G,QAIpB50G,EAAcgyD,eAAc,WAC1B,OAAO,IAAIlzD,EAAW,CACpBvM,KAAM,aACNwM,QAAS,OACTnB,aAAci3G,GACdv2G,WAAYw2G,GACZn3G,eAAgBo3G,QAIpB/0G,EAAcgyD,eAAc,WAC1B,OAAO,IAAIlzD,EAAW,CACpBvM,KAAM,4BACNwM,QAAS,uBACTnB,aAAco3G,GACd12G,WAAY22G,GACZt3G,eAAgBu3G,QAIpBl1G,EAAcgyD,eAAc,WAC1B,OAAO,IAAIlzD,EAAW,CACpBvM,KAAM,iBACNwM,QAAS,WACTnB,aAAcu3G,GACd72G,WAAY82G,GACZz3G,eAAgB03G,U,gCAKZr1G,GACJoyD,iCAAsBpyD,EAAc6oC,aACtC7oC,EAAc6oC,UAAU8sD,aAAa,OAAQ,CAC3ChmG,MAAO,QACPskB,KAAMC,KACNH,QAAS,SAACtC,GACR,IAAMo/E,EAASp/E,EAAQymC,UAAU,cAAe,eAChDzmC,EAAQ0mC,WAAW04C,MAGvB7wF,EAAc6oC,UAAU8sD,aAAa,OAAQ,CAC3ChmG,MAAO,OACPskB,KAAMqhG,KACNvhG,QAAS,SAACtC,GACR,IAAMo/E,EAASp/E,EAAQymC,UAAU,aAAc,cAC/CzmC,EAAQ0mC,WAAW04C,MAGvB7wF,EAAc6oC,UAAU0sE,aACtB,OACA,CACE5lH,MAAO,qBACPskB,KAAMuhG,KACNzhG,QAAS,SAACtC,GACR,IAAMo/E,EAASp/E,EAAQymC,UAAU,iBAAkB,kBACnDzmC,EAAQ0mC,WAAW04C,KAGvB,GAEF7wF,EAAc6oC,UAAU0sE,aACtB,OACA,CACE5lH,MAAO,eACPskB,KAAMwhG,KACN1hG,QAAS,SAACtC,GAEJA,EAAQikG,4BAEVjkG,EAAQikG,4BAERjkG,EAAQ4xC,OAAR,yBAAiC5xC,EAAQlf,KAAzC,KAAkD,cAIxD,GAEFyN,EAAc6oC,UAAU0sE,aACtB,OACA,CACE5lH,MAAO,oBACPskB,KAAM0hG,KACN5hG,QAAS,SAACtC,GAAkC,MAC1C,UAAAA,EAAQmkG,+BAAR,cAAAnkG,KAGJ,Q,GArGqBkoB,I,sBCgBRk8E,G,kDAanB,WAAmBx5G,GAAyC,kCAC1D,cAAMA,IAbA4S,cAYoD,IAVpD6mG,mBAUoD,IARpDC,2BAQoD,IANpDC,2BAMoD,IAJpDxR,oBAIoD,IAFpDnsG,cAEoD,EAE1D,EAAK4W,SAAWzS,yBAAeH,EAAQ,YAAYtN,IACnD,EAAK+mH,cAAgBt5G,yBAAeH,EAAQ,iBAC5C,EAAK25G,sBAAwBx5G,yBAAeH,EAAQ,yBACpD,EAAK05G,sBAAwBv5G,yBAAeH,EAAQ,yBACpD,EAAKmoG,eAAiBhoG,yBAAeH,EAAQ,YANa,E,+LASnChJ,E,+BAAoB,IACvC2D,KAAKqB,S,yCAAiBrB,KAAKqB,U,UAC3BA,EAAW,IACXrB,KAAK++G,sB,wBACDD,EAAgBG,mBAAmBj/G,KAAK++G,uB,SACxB/+G,KAAKk/G,YAAYJ,EAAeziH,G,OAAhDqgC,E,OACNr7B,EAAWrB,KAAKm/G,kBAAkBziF,G,wBACzB18B,KAAKwtG,iBACdnsG,EAAWrB,KAAKwtG,gB,eAElBxtG,KAAKqB,SAAWA,E,kBACTA,G,yIAGU+2D,GAAiD,WAAxB/7D,EAAwB,uDAAJ,GAC9D,OAAOgE,aAAgB,uCAAU,WAAMC,GAAN,mBAAAvH,EAAA,6DACzBqmH,EAAiBH,mBACrB39C,KAAO,EAAKw9C,cAAe1mD,IAErB/hE,EAAY+hE,EAAZ/hE,QAJuB,SAKT,EAAK6oH,YAAYE,EAAgB/iH,GALxB,OAKzBqgC,EALyB,OAM/B,EAAK2iF,kBAAkB3iF,EAASrmC,GAAS+P,SAAQ,SAAAqG,GAC/CnM,EAASgG,KAAKmG,MAEhBnM,EAASS,WATsB,2CAAV,sDAUpB1E,EAAKgC,U,2EAIgB+5D,EAAe/7D,G,kFACnC2iH,EAAwB,GACxBh/G,KAAKg/G,sBAAsB/jH,SAC7B+jH,EAAwB,IAAH,OAAOh/G,KAAKg/G,sBAAsBz1G,KAAK,OACxDlL,EAAShC,GAAQA,EAAKgC,O,SACL/B,MAAM,GAAD,OACvB0D,KAAKiY,SADkB,kBACAmgD,GADA,OACQ4mD,GAClC,CACEpiH,QAAS,CAAE0iH,OAAQ,oDACnBjhH,W,cAJEC,E,yBAOCA,EAASmgB,Q,iJAGQngB,GACxB,IAAM08F,IAAS18F,GAAY,IAAIo+B,SAAW,IAAI6iF,UAAY,GAC1D,IAAKvkB,EAAK//F,OAAQ,MAAO,GAEzB,IADeqD,EAASkhH,KAAKC,KACjBn+G,SAAS,WACnB,MAAM,IAAIrE,MAAM,yDAClB,OAAO+9F,EAAK75F,KAAI,SAAAy+B,GAAG,OAAIA,EAAIvpC,QAAQsT,W,wCAInC+yB,EACArmC,GAEA,IAAM2kG,IAASt+D,GAAW,IAAIA,SAAW,IAAI6iF,UAAY,GACzD,IAAKvkB,EAAK//F,OAAQ,MAAO,GACzB,IAAM6oG,EAASpnE,EAAQ8iF,KAAKC,KACL,CAAC,QAAS,MAAO,YACzBr5G,SAAQ,SAAAs5G,GAChB5b,EAAOxiG,SAASo+G,IACnBxjH,QAAQC,MAAR,yBACoBujH,EADpB,kCAIJ,IAAMC,EAA8C,GACpD3kB,EAAK50F,SAAQ,SAAAw5B,GACX,IAAMggF,EAAoC,CAAC,IAC3C9b,EAAO19F,SAAQ,SAAAyE,GACb,GAAIA,KAAS+0B,EAAK,CAGhB,IAHgB,IACRj2B,EAAUi2B,EAAI/0B,GAAdlB,MACJyJ,EAAM,EACHvI,EAAMhI,WAAW,SACtBgI,EAAQA,EAAM3K,MAAM,GACpBkT,GAAO,EAET,KAAOA,EAAMwsG,EAAQ3kH,OAAS,GAAG2kH,EAAQn4G,KAAK,IAC9Cm4G,EAAQxsG,GAAKvI,GAASlB,MAI1Bi2G,EAAQx5G,SAAQ,SAACy5G,EAAIzsG,GAAQ,IACnB6K,EAAa4hG,EAAb5hG,SACJ7K,EAAMwsG,EAAQ3kH,OAAS,IAAG2kH,EAAQxsG,EAAM,GAAG0sG,eAAiB7hG,GAChE0hG,EAAa1hG,GAAY,CACvBpe,KAAM,2BACDggH,GADD,IAEF5hG,WACA5nB,UACAG,MAAO2H,SAAS0hH,EAAGrpH,MAAO,IAC1BE,IAAKyH,SAAS0hH,EAAGnpH,IAAK,IACtBgW,OAAQvO,SAAS0hH,EAAGnzG,OAAQ,KAAO,WAO3C,cAA4BzT,OAAOiE,QAAQyiH,GAA3C,eAA0D,2BAA9C1hG,EAA8C,KAApCe,EAAoC,KAClD+gG,EAAM/gG,EAAEnf,KAAKigH,eAEnB,UADO9gG,EAAEnf,KAAKigH,eACVC,EAAK,CACP,IAAM3hG,EAAIuhG,EAAaI,GACvB,GAAI3hG,EACGA,EAAEve,KAAKse,cAAaC,EAAEve,KAAKse,YAAc,IAC9CC,EAAEve,KAAKse,YAAY1W,KAAnB,2BACKuX,EAAEnf,MADP,IAEEoe,qBAEK0hG,EAAa1hG,OACf,CACL,IADK,EACCE,EAAcllB,OAAOmiC,OAAOukF,GAC/Bx+G,KAAI,SAAA6+G,GAAE,OAAIA,EAAGngH,KAAKse,eAClBrQ,QAAO,SAAAkyG,GAAE,QAAMA,KACfvT,OACCwT,GAAQ,EALP,eAMoB9hG,GANpB,IAML,2BAAsC,KAA3BgvF,EAA2B,QACpC,GAAIA,GAAcA,EAAWlvF,WAAa8hG,EAAK,CACxC5S,EAAWhvF,cAAagvF,EAAWhvF,YAAc,IACtDgvF,EAAWhvF,YAAY1W,KAAvB,2BACKuX,EAAEnf,MADP,IAEEoe,qBAEK0hG,EAAa1hG,GACpBgiG,GAAQ,EACR,MACS9S,GAAcA,EAAWhvF,aAClCA,EAAY1W,KAAZ,MAAA0W,EAAW,YAASgvF,EAAWhvF,eAjB9B,8BAoBA8hG,GAAO/jH,QAAQC,MAAR,kCAAyC4jH,MAK3D,OAAO9mH,OAAOC,KAAKymH,GAAcx+G,KAC/B,SAAA++G,GAAW,OACT,IAAIniG,GAAJ,2BACK4hG,EAAaO,GAAargH,MAD/B,IAEEoe,SAAUiiG,EACV/hG,YAAawhG,EAAaO,GAAargH,KAAKse,oB,iFAMlD9nB,G,4FACAgG,E,+BAAoB,G,SAEG2D,KAAKoB,YAAY/E,G,YAAlCgF,E,QACOpG,QAAWoG,EAASC,SAASjL,G,0CAAiB,G,iCACpD,G,qJA/KgCqJ,2BChD5BoV,iCACb,gBACA,CACEmD,SAAU,CACRnR,KAAM,eACNiO,aAAc,CAAEhd,IAAK,+BACrBoQ,YAAa,8BAEf22G,cAAe,CACbh4G,KAAM,OACNiO,aAAc,GACd5M,YACE,kFAEJ42G,sBAAuB,CACrBj4G,KAAM,OACNiO,aAAc,GACd5M,YACE,wEAEJ9G,SAAU,CACRyF,KAAM,cACNiO,aAAc,GACd5M,YACE,kGAEJ62G,sBAAuB,CACrBl4G,KAAM,cACNiO,aAAc,GACd5M,YACE,kEAGN,CAAE6M,iBAAiB,IC3BAmrG,G,4MACnB5kH,KAAO,Y,sDAECyN,GACNA,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,gBACNqL,aAAcw5G,GACdh5G,aAAci5G,Y,GATe19E,I,gECoBrC,WAAmBt9B,GAA+B,2BAChD,cAAMA,IAdEi7G,WAawC,IAX1CC,SAAW,IAAIpd,KAAsB,CAC3CliC,MAAO,IAAIu/C,GAAI,CAAEnd,QAAS,MAC1BxpG,KAAM,WAAF,4BAAE,WACJ8F,GADI,mBAAA5G,EAAA,6DAII1C,EAAwBsJ,EAAxBtJ,QAASG,EAAemJ,EAAfnJ,MAAOE,EAAQiJ,EAARjJ,IAJpB,kBAKG,EAAK4pH,MAAMG,YAAYpqH,EAASG,EAAOE,IAL1C,2CAAF,mDAAE,KAWN,IAAMkhB,EAAgBpS,yBAAeH,EAAQ,iBACvCwS,EAAcrS,yBAAeH,EAAQ,eAC3C,IAAKuS,EACH,MAAM,IAAI3a,MAAM,8BAElB,IAAK4a,EACH,MAAM,IAAI5a,MAAM,4BAElB,IAAMyjH,EAAY,CAChBJ,MAAOphH,wBAAa0Y,GACpB+oG,IAAKzhH,wBAAa2Y,IAZ4B,OAehD,EAAKyoG,MAAQ,IAAIM,gBAAaF,GAfkB,E,0DAmBhD,OAAO1gH,KAAKsgH,MAAMO,oB,mKAIK7gH,KAAKsgH,MAAMQ,mB,cAA5BC,E,yBACC9nH,OAAOC,KAAK6nH,GAAU5/G,KAC3B,SAAC9K,GAAD,MAAwC,CACtCA,UACAG,MAAO,EACPE,IAAKqqH,EAAS1qH,Q,2IAU0C,WAAzCA,EAAyC,EAAzCA,QAASG,EAAgC,EAAhCA,MAAOE,EAAyB,EAAzBA,IACnC,OAAO2J,aAAgB,uCAAU,WAAMC,GAAN,6BAAAvH,EAAA,sEACZ,EAAKunH,MAAMU,gBAAgB3qH,GADf,OAQ/B,IAPMqH,EADyB,OAEzB+S,OAAqB1W,IAAT2D,EAAqBgH,KAAKC,IAAIjH,EAAMhH,GAAOA,EACvDuqH,EAAS,GACG,MAGZhlH,EAAIvF,GAHQ,MAGYA,EAHZ,OAIT2yE,EAFH7tE,EAAIhF,EAASA,EAFD,MAIO6yE,EAAaptE,EAAGotE,GAJvB,MAKVzuE,EAAI,CACRvE,UACAG,MAAO6yE,EACP3yE,IAAK2yE,EARS,OAUhB43C,EAAOx5G,KAAK,EAAK84G,SAASxpH,IAAIwW,KAAKC,UAAU5S,GAAIA,IAdpB,iBAgBZo4B,QAAQ4hB,IAAIqsE,GAhBA,SAgBzBl3D,EAhByB,OAiB5BxgD,KAAK,IACLrJ,MAAM1J,EAAQgF,GACd0E,MAAM,EAAGxJ,EAAMF,KAEhB8J,EAASgG,KACP,IAAIyX,GAAc,CAChB9mB,GAAI,GAAF,OAAKZ,EAAL,YAAgBG,EAAhB,YAAyBia,GAC3B5Q,KAAM,CAAExJ,UAASG,QAAOE,IAAK+Z,EAAWs5C,UAI9CzpD,EAASS,WA5BsB,4CAAV,yD,8CArDErB,2B,qDCL3B,WAAmB2F,GAAyC,0BAC1D,cAAMA,GACN,IAAMuS,EAAgBpS,yBAAeH,EAAQ,iBACvCwS,EAAcrS,yBAAeH,EAAQ,eACrCyS,EAActS,yBAAeH,EAAQ,eAC3C,IAAKuS,EACH,MAAM,IAAI3a,MAAM,8BAElB,IAAK4a,EACH,MAAM,IAAI5a,MAAM,4BAElB,IAAK6a,EACH,MAAM,IAAI7a,MAAM,4BAElB,IAAMyjH,EAAY,CAChBJ,MAAOphH,wBAAa0Y,GACpB+oG,IAAKzhH,wBAAa2Y,GAClBqpG,IAAKhiH,wBAAa4Y,IAjBsC,OAoB1D,EAAKwoG,MAAQ,IAAIa,qBAAkBT,GApBuB,E,UADjCE,ICNd9rG,iCACb,oBACA,CACE8C,cAAe,CACb9Q,KAAM,eACNiO,aAAc,CAAEhd,IAAK,uBAEvB8f,YAAa,CACX/Q,KAAM,eACNiO,aAAc,CAAEhd,IAAK,2BAEvB+f,YAAa,CACXhR,KAAM,eACNiO,aAAc,CAAEhd,IAAK,4BAGzB,CAAEid,iBAAiB,I,qDCCnB,WAAmB3P,GAAyC,2BAC1D,cAAMA,IALE+pG,aAIkD,IAFlD/zG,YAEkD,EAE1D,IAAM+lH,EAAqB57G,yBAAeH,EAAQ,sBAClD,IAAK+7G,EACH,MAAM,IAAInkH,MAAM,mCAElB,IAAMyI,EAAOxG,wBAAakiH,GANgC,OAO1D,EAAK/lH,OAASqK,EAAKpL,WACnB,EAAK80G,QAAU,EAAK3sG,KAAKiD,GARiC,E,0FAWzCA,G,yFACGA,EAAKtC,SAAS,Q,UAA5BvD,E,OACAuvG,EAAqC,GACtCvvG,EAAK5E,O,sBACF,IAAIgC,MAAJ,8BAAiCyI,EAAKpL,a,cAE9CuF,EAAKm3C,MAAM,MAAM5wC,SAAQ,SAACozE,GACxB,GAAIA,EAAKv+E,OAAQ,OACQu+E,EAAKxiC,MAAM,MADnB,mBACRz7C,EADQ,KACFN,EADE,KAEfm0G,EAAQ7zG,IAASN,M,kBAGdm0G,G,4PAIAn2G,O,SAAkB+G,KAAKovG,Q,iDAAhBl2G,K,0RAIQ8G,KAAKovG,Q,cAArBA,E,yBACCn2G,OAAOC,KAAKk2G,GAASjuG,KAAI,SAAA9K,GAAO,MAAK,CAC1CA,UACAG,MAAO,EACPE,IAAK04G,EAAQ/4G,Q,0IAKf,OAAOgK,cAA0B,SAAAC,GAE/BA,EAASS,gB,8CAhDcrB,2BCXdoV,iCACb,oBACA,CACEssG,mBAAoB,CAClBt6G,KAAM,eACNiO,aAAc,CAAEhd,IAAK,kCAGzB,CAAEid,iBAAiB,ICgBrB,IAAMqsG,GAAc,WAClB,IAAMC,EAAkB,WAKlBC,EAAkB,CACtBC,EAAG,IACHliD,EAAG,IACHn/C,EAAG,IACHvlB,EAAG,IACH7B,EAAG,IACH0oH,EAAG,IACHC,EAAG,IACH9lH,EAAG,IACHogB,EAAG,IACH2lG,EAAG,IACHC,EAAG,IACHjiF,EAAG,IACHkiF,EAAG,IACHviF,EAAG,IACHniC,EAAG,IACH4iB,EAAG,IACHgtE,EAAG,IACH1sD,EAAG,IACHxgB,EAAG,IACHnM,EAAG,IACHouG,EAAG,IACHC,EAAG,IACHj7C,EAAG,IACH7sE,EAAG,IACH+nH,EAAG,IACHxmH,EAAG,IACHymH,EAAG,IACH3jG,EAAG,IACH4jG,EAAG,IACHlpH,EAAG,IACHmpH,EAAG,IACHliG,EAAG,KAGL,OAAO,SAACmiG,GACN,OAAOA,EAAU1oH,QAAQ4nH,GAAiB,SAAAx6C,GAAC,OAAIy6C,EAAgBz6C,IAAM,OA1CrD,GA8Cdu7C,GAAgB,CAAC,OACjBC,GAAe,CAAC,MAAO,MAAO,OAC9BC,GAAoB,CACxBC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,KAiCP,SAASC,GAAYz/G,GAoCnB,IA1BC,IAEC0/G,EASE1/G,EATF0/G,WACA18D,EAQEhjD,EARFgjD,IACA28D,EAOE3/G,EAPF2/G,MACA3gH,EAMEgB,EANFhB,QACA3F,EAKE2G,EALF3G,OACA6jB,EAIEld,EAJFkd,OACA0b,EAGE54B,EAHF44B,EARD,EAWG54B,EAFFwvD,eATD,SAUCpsD,EACEpD,EADFoD,MAEIy6C,EAAQ7+C,EAIR4gH,EAAO,EAAKvmH,EAAO5J,MAAQ,EAK3BowH,GAAkBF,EAAQC,EAAO,GAAK,EAEtCE,EAAY98D,EAAI7pD,MAAM0mH,GAEtBE,EAAkD,GAC/CjsH,EAAI,EAAGA,EAAIgsH,EAAU5rH,OAAQJ,GAAK,EAAG,CAC5C,IAAMksH,EAAQF,EAAU3mH,MAAMrF,EAAGA,EAAI,GAC/BmsH,EAAkBzwD,EA1LnB8qD,GA0LoC0F,GA1Ld/vE,MAAM,IAAIuf,UAAUhtD,KAAK,IA0LFw9G,EAC5CE,EAAYR,EAAWO,IAAoB,GACjDF,EAAWr/G,KAAK,CAAEy/G,OAAQD,EAAWF,MAAOC,EAAgB7vG,gBAG9D,IAAMmoD,EAAK,EAAI1a,EAAS,EAClBuiE,EAAwB,IAAjB/mH,EAAO5J,MAAc,EAAI8oE,EAChC7iC,EAAS,EAAI12B,GAAW,GACxBkK,GAAS7P,EAAO1J,IAAM0J,EAAO5J,OAASuP,EAEtC5E,EAAM,CAAC,UAAW,UAAW,WAAWo1D,UAC9C,OACE,oCACGuwD,EAAW3lH,KAAI,SAAC6F,EAASkM,GACxB,IAAMtX,EAAIwE,EAAOhJ,SACb6Y,GAASqvD,GAAKpsD,EAAQ,GAAK0zG,EAAiBhiE,EAAQuiE,GACpD7nD,EAAIpsD,EAAQ0zG,EAAiBhiE,EAAQuiE,EACjCD,EAAkBlgH,EAAlBkgH,OAAQH,EAAU//G,EAAV+/G,MAChB,OACE,kBAAC,IAAMK,SAAP,CAAgBt6G,IAAG,UAAKoG,EAAL,YAAcg0G,IAC/B,0BACEtrH,EAAGA,EACH+jC,EAAGA,EACH1vB,MACEwsB,EAAS6iC,EAAIA,EAAI,GAEnBr7C,OAAQA,EACR2lC,OAAQntB,EAAS,OAAS,OAC1B5iC,KACEwoH,GAAc/gH,SAASylH,GACnB58G,EAAMQ,QAAQgV,WACd2iG,GAAahhH,SAASylH,GACtB58G,EAAMQ,QAAQ+U,UACdve,EAAIuD,KAAKsgD,IAAI0hE,MAGpBjqF,EACC,0BACE7gC,EAAGA,EAAI0jE,EAAI,EACX3/B,EAAGA,EAAI1b,EAAS,EAChBq+D,iBAAiB,SACjBD,WAAW,UAEV6kC,GAED,UAQhB,SAASG,GAAItgH,GAQV,IACOhB,EAAoDgB,EAApDhB,QAAS3F,EAA2C2G,EAA3C3G,OAAQqM,EAAmC1F,EAAnC0F,QAAStC,EAA0BpD,EAA1BoD,MAAO8Z,EAAmBld,EAAnBkd,OAAQ8lC,EAAWhjD,EAAXgjD,IAAKpqB,EAAM54B,EAAN44B,EAChDlD,EAAS,EAAI12B,GAAW,GAF7B,EAIyB6qE,oBACxBnkE,EAAQ1V,IAAI,SACZ0V,EAAQ1V,IAAI,OACZqJ,EACA2F,GARD,mBAIMgL,EAJN,KAIcC,EAJd,KAUKulD,EAAUn2D,EAAOhJ,SACjBwc,EAAMnH,EAAQ1V,IAAI,OAAS0V,EAAQ1V,IAAI,SACvCuoE,EAAI56D,KAAKuM,KAAKD,EAAUD,GAAU6C,EAAK,IAE7C,OACE,oCACGm2C,EAAI/S,MAAM,IAAI71C,KAAI,SAAC+lH,EAAQh0G,GAE1B,IAAM1I,EAAQL,EAAMQ,QAAQiV,MAAMsnG,EAAO/vG,eACnCvb,EAAI26D,EAAUvlD,GAAWkC,EAAQ,GAAKosD,EAAIvuD,EAASmC,EAAQosD,EACjE,OACE,kBAAC,IAAM8nD,SAAP,CAAgBt6G,IAAKoG,GACnB,0BACEtX,EAAGA,EACH+jC,EAAGA,EACH1vB,MAAOqvD,EACPr7C,OAAQA,EACRpqB,KAAM2Q,EAAQA,EAAM6U,KAAO,OAC3BuqC,OAAQntB,EAAS,OAAS,SAE3BA,EACC,0BACE7gC,EAAGA,EAAI0jE,EAAI,EACX3/B,EAAGA,EAAI1b,EAAS,EAChBq+D,iBAAiB,SACjBD,WAAW,SACXxoF,KAAM2Q,EAAQshC,GAAqBthC,EAAM6U,MAAQ,SAEhD6nG,GAED,UA6GD5mH,2BArGf,SAAkByG,GAAgB,MAS5BA,EAPFuL,gBAF8B,MAEnB,IAAI7J,IAFe,EAG9BzH,EAME+F,EANF/F,QACA+E,EAKEgB,EALFhB,QACO0sE,EAIL1rE,EAJFoD,MAL8B,EAS5BpD,EAHFugH,mBAN8B,WAS5BvgH,EAFFwgH,mBAP8B,WAS5BxgH,EADFygH,uBAR8B,SAU1Br9G,EAAQ4Y,GAAmB0vD,GAC1BryE,EAXyB,YAWfY,EAXe,MAY1BiP,GAAS7P,EAAO1J,IAAM0J,EAAO5J,OAASuP,EAEtC0gH,EA3LR,SAA4BjyC,GAC1B,IAAMizC,EAA4C,GAsBlD,OArBAxuH,OAAOC,KAAKs7E,GAAOpuE,SAAQ,SAAA2gH,GAGzB,IAFA,IAAMW,EAAKlzC,EAAMuyC,GACXY,EAAmB,GAChB9sH,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,IAAM+sH,EAAMb,EAAMnzC,OAAO/4E,GACzB8sH,EAAK9sH,GAAK,GACV8sH,EAAK9sH,GAAG,GAAK+sH,EAAIzwG,cACjBwwG,EAAK9sH,GAAG,GAAK+sH,EAAI76G,cAEnB,IAAK,IAAIlS,EAAI,EAAGA,EAAI,EAAGA,IAErB,IADA,IAAMgtH,EAAKF,EAAK,GAAG9sH,GACVkgC,EAAI,EAAGA,EAAI,EAAGA,IAErB,IADA,IAAM+sF,EAAKH,EAAK,GAAG5sF,GACV59B,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,IAAM4qH,EAAKJ,EAAK,GAAGxqH,GAEnBsqH,EADgBI,EAAKC,EAAKC,GACAL,MAK3BD,EAoKYO,CAAmBzF,IAG/B91G,EAjByB,YAiBV6F,EAAS8oB,UAjBC,GAkBhC,IAAK3uB,EACH,OAAO,KAET,IAAMs9C,EAAct9C,EAAQ1V,IAAI,OAChC,IAAKgzD,EACH,OAAO,KAKT,IAAI04C,GAAS,GAEb,OACE,yBACExyF,MAAOA,EACPgU,OApBgB,IAqBhBhY,MAAO,CAAEgE,QAAOgU,OArBA,MAyBfujG,IAAoBpnH,EAAOhJ,SAAWmwH,EAAcD,GACjD,CAAC,EAAG,EAAG,GAAGnmH,KAAI,SAAA+R,GAAK,OACjB,kBAACszG,GAAD,CACE15G,IAAG,sBAAiBoG,GACpB62C,IAAKA,EACLpqB,EAAI8iE,GAAS,GACbgkB,WAAYA,EACZC,MAAOxzG,EACPnN,QAASA,EACT3F,OAAQA,EACR+J,MAAOA,EACP8Z,OAlCG,GAmCHsyC,QAASn2D,EAAOhJ,cAGpB,KAEHkwH,EACC,kBAACD,GAAD,CACEpjG,OA1CO,GA2CP0b,EAAI8iE,GAAS,GACbh2F,QAASA,EACTrM,OAAQA,EACR2pD,IAAK3pD,EAAOhJ,SAAWiqH,GAAWt3D,GAAOA,EACzChkD,QAASA,EACToE,MAAOA,IAEP,KAEHo9G,EACC,kBAACF,GAAD,CACEpjG,OAtDO,GAuDP0b,EAAI8iE,GAAS,GACbh2F,QAASA,EACTrM,OAAQA,EACR2pD,IAAK3pD,EAAOhJ,SAAW2yD,EAAMs3D,GAAWt3D,GACxChkD,QAASA,EACToE,MAAOA,IAEP,KAIHq9G,IAAoBpnH,EAAOhJ,SAAWkwH,EAAcC,GACjD,CAAC,GAAI,GAAI,GAAGpmH,KAAI,SAAA+R,GAAK,OACnB,kBAACszG,GAAD,CACE15G,IAAG,0BAAqBoG,GACxB62C,IAAKA,EACLpqB,EAAI8iE,GAAS,GACbgkB,WAAYA,EACZC,MAAOxzG,EACPnN,QAASA,EACT3F,OAAQA,EACR+J,MAAOA,EACP8Z,OA7EG,GA8EHsyC,SAAUn2D,EAAOhJ,cAGrB,SC5ZK0d,iCACb,sBACA,CACEmP,OAAQ,CACNnd,KAAM,SACNqB,YAAa,4CACb4M,aAAc,KAGlB,CAAEC,iBAAiB,ICTNF,iCACb,sBACA,CACE8C,cAAe,CACb9Q,KAAM,eACNiO,aAAc,CAAEhd,IAAK,oBAEvB8f,YAAa,CACX/Q,KAAM,eACNiO,aAAc,CAAEhd,IAAK,yBAGzB,CAAEid,iBAAiB,ICXRpO,GAAekO,8BAC1B,iCACA,CAAE28B,SAAUw2E,IACZ,CAAEhzG,mBAAoB,YAAaD,iBAAiB,I,eCQjC0D,G,kDAKnB,WAAYrT,GAAuC,2BACjD,cAAMA,IAHA6iH,YAE2C,EAEjD,IAAMC,EAAa,CACjBhjH,WAAYjG,wBAAasG,yBAAeH,EAAQ,oBAHD,OAMjD,EAAK6iH,OAAS,IAAIE,cAAWD,GANoB,E,0DAUjD,OAAOnoH,KAAKkoH,OAAOG,qB,mKAIIroH,KAAKkoH,OAAOpH,mB,cAA7BwH,E,yBACCrvH,OAAOC,KAAKovH,GAAUnnH,KAC3B,SAAC9K,GAAD,MAAwC,CACtCA,UACAG,MAAO,EACPE,IAAK4xH,EAASjyH,Q,2IAU0C,WAAzCA,EAAyC,EAAzCA,QAASG,EAAgC,EAAhCA,MAAOE,EAAyB,EAAzBA,IACnC,OAAO2J,aAAgB,uCAAU,WAAMC,GAAN,mBAAAvH,EAAA,sEACZ,EAAKmvH,OAAOlH,gBAAgB3qH,GADhB,cACzBqH,EADyB,OAEzB+S,OAAqB1W,IAAT2D,EAAqBgH,KAAKC,IAAIjH,EAAMhH,GAAOA,EAF9B,SAGL,EAAKwxH,OAAOzH,YACpCpqH,EACAG,EACAia,GAN6B,QAGzBs5C,EAHyB,SAS7BzpD,EAASgG,KACP,IAAIyX,GAAc,CAChB9mB,GAAI,GAAF,OAAKZ,EAAL,YAAgBG,EAAhB,YAAyBia,GAC3B5Q,KAAM,CAAExJ,UAASG,QAAOE,IAAK+Z,EAAWs5C,UAI9CzpD,EAASS,WAhBsB,2CAAV,yD,8CAlCjBrB,2BCbKoV,iCACb,gBACA,CACEiD,eAAgB,CACdjR,KAAM,eACNiO,aAAc,CAAEhd,IAAK,sBAGzB,CAAEid,iBAAiB,I,ICyBfuzG,G,gLACcnoH,GAChB,kCACKA,GADL,IAEE5J,MAAOkO,KAAKuM,IAAI7Q,EAAO5J,MAAQ,EAAG,GAClCE,IAAK0J,EAAO1J,IAAM,Q,GALUgsC,IAUb8lF,G,4MACnBjtH,KAAO,iB,sDAECyN,GACNA,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,gBACNqL,aAAc6hH,GACdrhH,aAAcshH,QAIpB1/G,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,oBACNqL,aAAc+hH,GACdvhH,aAAcwhH,QAIpB5/G,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,sBACNqL,aAAciiH,GACdzhH,aAAc0hH,QAIpB9/G,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,oBACNqL,aAAcmiH,GACd3hH,aAAc4hH,QAIpBhgH,EAAc0xD,cAAa,WACzB,IAAM9zD,EC5EL,SAAuCoC,GAC5C,OAAO8L,8BACL,yBACA,CACEwI,QAAStU,EAAc0S,0BAA0B,WACjDvB,SAAUvkB,QAAMwc,MAAMpJ,EAAc0S,0BAA0B,YAC9D9V,SAAU,CACRkB,KAAM,SACNqB,YAAa,mCACb4M,aAAc,KAGlB,CACEwI,mBAAoB,SAAA/hB,GAClB,IAAMnD,EAAOkV,KAAKW,MAAMX,KAAKC,UAAUhS,IACjC+L,EAAe,IAAIiW,IAFF,EAGGnlB,EAAlB8hB,gBAHe,MAGJ,GAHI,EAIF,kBAAjB9hB,EAAK6gB,UAIPiB,EAAS/T,SAAQ,SAAC4V,GAAD,OAAYA,GAAKzU,EAAakW,IAAIzB,EAAElV,SACnCkC,EAAc0U,aAAarlB,EAAKyO,MACxCS,aAAanB,SAAQ,SAAAyV,GACxBtU,EAAaoW,IAAI9B,EAAYtgB,OAChC4e,EAAS1S,KAAK,CACZ8T,UAAW,GAAF,OAAKljB,EAAK6gB,QAAV,YAAqB2C,EAAYtgB,MAC1CuL,KAAM+U,EAAYtgB,WAK1B,kCAAYlD,GAAZ,IAAkB8hB,cAEpBlF,mBAAoB,UACpBD,iBAAiB,EACjB1d,QAAS,SAACC,GAAD,MAAgB,CACvBqmB,eADuB,SACRf,GAAkD,IACvD/V,EAAS+V,EAAT/V,KACR,IAAKA,EAAM,MAAM,IAAI7J,MAAJ,+BAAkC6J,IACnD,IAAMU,EAAUjQ,EAAK4iB,SAASnc,MAC5B,SAACge,GAAD,OAAYA,GAAKA,EAAET,YAAcsB,EAAYtB,aAE/C,GAAI/T,EACF,OAAOA,EAET,IAAMvM,EAAS1D,EAAK4iB,SAAS1S,KAAKoV,GAClC,OAAOtlB,EAAK4iB,SAASlf,EAAS,QD6BbguH,CAA8BjgH,GAEnD,OAAO,IAAI3B,EAAU,CACnB9L,KAAM,yBACNqL,eACAU,WAAYyS,GACV/Q,EACA,yBACApC,QAKNoC,EAAcusC,gBAAe,WAC3B,IE1FuB3uC,EF0FjBU,GE1FiBV,EF2FrBsiH,GE1FCtzH,QACJ8B,QACC,iCACA+iD,GACA7kD,QAAMuB,MAAM,CACV2P,KAAMlR,QAAMqkB,QAAQ,kCACpBnE,cAAeoE,iCAAuBtT,GACtC0gH,YAAa1xH,QAAMC,SAASD,QAAMyB,SAAS,GAC3CkwH,YAAa3xH,QAAMC,SAASD,QAAMyB,SAAS,GAC3CmwH,gBAAiB5xH,QAAMC,SAASD,QAAMyB,SAAS,GAC/C4sB,OAAQ,OAGXrR,OAAM,SAAArb,GAAI,MAAK,CACd,kBAAkB,IACR+vH,EAA8C/vH,EAA9C+vH,YAAaC,EAAiChwH,EAAjCgwH,YAAaC,EAAoBjwH,EAApBiwH,gBAClC,8CACKjwH,EAAK0qD,qBACLzrC,GAAqBjf,IAF1B,IAGE8N,OAAQ9N,EAAKue,cAAc27B,SAC3B61E,cACAC,cACAC,qBAGJ5tG,uBAZc,WAaZ,IAAMqB,EAAOC,6BAAkB3jB,GAC/B,GAAI0jB,GAAQA,EAAKlV,SAAW,EAC1B,MAAO,2BAKX,uBACE,OAAOxO,EAAKue,cAAc27B,SAAS3qC,UAGtCxP,SAAQ,SAAAC,GAAI,MAAK,CAChB4xH,kBADgB,WAEd5xH,EAAK+vH,aAAe/vH,EAAK+vH,aAE3B8B,kBAJgB,WAKd7xH,EAAKgwH,aAAehwH,EAAKgwH,aAE3B8B,sBAPgB,WAQd9xH,EAAKiwH,iBAAmBjwH,EAAKiwH,qBAGhC50G,OAAM,SAAArb,GAAI,MAAK,CACd,qBACE,MAAO,CACL,CACEoB,MAAO,eACPmO,KAAM,WACNkW,QAASzlB,EAAK+vH,YACdvqG,QAAS,WACPxlB,EAAK4xH,sBAGT,CACExwH,MAAO,eACPmO,KAAM,WACNkW,QAASzlB,EAAKgwH,YACdxqG,QAAS,WACPxlB,EAAK6xH,sBAGT,CACEzwH,MAAO,mBACPmO,KAAM,WACNkW,QAASzlB,EAAKiwH,gBACdzqG,QAAS,WACPxlB,EAAK8xH,iCFoBb,MAAO,CACL9tH,KAAM,iCACNqL,aAAcsiH,GACd5hH,aACAK,UAAW,yBACXC,SAAU,mBACVjB,eAAgB8zD,OAIpBzxD,EAAc06D,iBACZ,kBACE,IAAI6kD,GAAoB,CACtBhtH,KAAM,sBACNoL,eAAgB2iH,GAChB1iH,aAAcqhH,Y,GAzEoBtlF,IGjCvB4mF,G,WAuBnB,WACEhuH,EACAisB,EACArB,EACAlW,EACAgU,EAEApkB,GAEA,GADA,yBA9BMtE,UA8BN,OA5BKisB,UA4BL,OA1BKrB,SA0BL,OAxBKlW,WAwBL,OAtBKgU,YAsBL,OAnBKpkB,UAmBL,OAjBMiM,cAiBN,OAfM09G,mBAeN,OAbKxzG,YAaL,EAEEkjB,mBACiB,kBAAT39B,GACU,kBAATisB,GACPwxB,OAAOywE,MAAMjiG,IACE,kBAARrB,GACP6yB,OAAOywE,MAAMtjG,IACI,kBAAVlW,GACP+oC,OAAOywE,MAAMx5G,IACK,kBAAXgU,GACP+0B,OAAOywE,MAAMxlG,IAEf,MAAM,IAAIjhB,UAAU,gCAGtBhD,KAAKzE,KAAOA,EACZyE,KAAKwnB,KAAOA,EACZxnB,KAAKmmB,IAAMA,EACXnmB,KAAKiQ,MAAQA,EACbjQ,KAAKikB,OAASA,EACdjkB,KAAKH,KAAOA,EACZG,KAAK8L,SAAW,IAAIrD,IACpBzI,KAAKwpH,cAAgB,CAAEE,OAAO,G,qDAI9BC,EACAniG,EACArB,EACAlW,EACAgU,EAEApkB,GAEA,IAAI0e,EAKJ,MAJ4CA,EAAxCorG,aAA4BJ,EAAoBI,EAE1C,IAAIJ,EAAWI,EAAkBniG,EAAMrB,EAAKlW,EAAOgU,EAAQpkB,cAE9C0pH,GACrB,MAAM,IAAIvmH,UACR,yDAIJ,GAAIhD,KAAK8L,SAAS6R,IAAIY,EAAMhjB,MAC1B,MAAM,IAAI0B,MAAJ,uBAA0BshB,EAAMhjB,KAAhC,qBAGRgjB,EAAMvI,OAAShW,KAhBH,MAsBRue,EAAMqrG,SAJFC,EAlBI,EAkBVriG,KACOsiG,EAnBG,EAmBVpiG,MACKqiG,EApBK,EAoBV5jG,IACQ6jG,EArBE,EAqBVxmC,OAWF,YARgBzpF,IAAd8vH,QACe9vH,IAAf+vH,QACa/vH,IAAbgwH,QACgBhwH,IAAhBiwH,IAEAhqH,KAAKiqH,OAAOJ,EAAWC,EAAYC,EAAUC,GAC7ChqH,KAAK8L,SAAShD,IAAIyV,EAAMhjB,KAAMgjB,IAEzBA,I,mCAGIhjB,GACX,OAAOyE,KAAK8L,SAAS/U,IAAIwE,K,6BAazB2uH,EACAC,EACAC,EACAC,GACM,MAC+BrqH,KAAK4pH,SAAlCpiG,EADF,EACEA,KAAME,EADR,EACQA,MAAOvB,EADf,EACeA,IAAKq9D,EADpB,EACoBA,OAC1B,QAAazpF,IAATytB,GAAsB0iG,EAAU1iG,EAAM,CACxC,IAAM8iG,EAAO9iG,EAAO0iG,EACpBlqH,KAAKiQ,OAASq6G,EACdtqH,KAAKwnB,MAAQ8iG,EAKf,QAHcvwH,IAAV2tB,GAAuByiG,EAAWziG,IACpC1nB,KAAKiQ,OAASk6G,EAAWziG,QAEf3tB,IAARosB,GAAqBikG,EAASjkG,EAAK,CACrC,IAAMmkG,EAAOnkG,EAAMikG,EACnBpqH,KAAKikB,QAAUqmG,EACftqH,KAAKmmB,KAAOmkG,OAECvwH,IAAXypF,GAAwB6mC,EAAY7mC,IACtCxjF,KAAKikB,QAAUomG,EAAY7mC,GAEzBxjF,KAAKgW,QAAQhW,KAAKgW,OAAOi0G,OAAOC,EAASC,EAAUC,EAAQC,GAC/DrqH,KAAKwpH,cAAcE,OAAQ,I,kCAWjB1vH,GACNgG,KAAKgW,SACPhc,EAASgG,KAAKgW,QACdhW,KAAKgW,OAAOu0G,YAAYvwH,M,mCAIfA,GAA0B,qBACnBgG,KAAK8L,SAASsvB,UADK,IACrC,2BAA0C,KAA/BgwC,EAA+B,QACxCpxE,EAASoxE,GACTA,EAAIo/C,aAAaxwH,IAHkB,iC,2BA4BlC4B,EAAW+jC,GACd3/B,KAAKwnB,MAAQ5rB,EACboE,KAAKmmB,KAAOwZ,EAEZ3/B,KAAKwpH,cAAcE,OAAQ,EAC3B1pH,KAAKwqH,cAAa,SAAClsG,GACjBA,EAAEkrG,cAAcE,OAAQ,KANK,MAQM1pH,KAAK4pH,SAAlCpiG,EARuB,EAQvBA,KAAME,EARiB,EAQjBA,MAAOvB,EARU,EAQVA,IAAKq9D,EARK,EAQLA,YAEfzpF,IAATytB,QACUztB,IAAV2tB,QACQ3tB,IAARosB,QACWpsB,IAAXypF,GAEAxjF,KAAKiqH,OAAOziG,EAAME,EAAOvB,EAAKq9D,K,6BAzDhC,OAAOxjF,KAAKmmB,IAAMnmB,KAAKikB,S,4BAIvB,OAAOjkB,KAAKwnB,KAAOxnB,KAAKiQ,Q,+BAkBxB,GAAIjQ,KAAKwpH,cAAcE,MAAO,CAC5B,IAAIe,EAAU,EACV3tC,EAAU,EACd98E,KAAKuqH,aAAY,SAACl0G,GAChBo0G,GAAWp0G,EAAKmR,KAChBs1D,GAAWzmE,EAAK8P,OAElBnmB,KAAKwpH,cAAgB,CACnBE,OAAO,EACPliG,KAAMxnB,KAAKwnB,KAAOijG,EAClB/iG,MAAO1nB,KAAK0nB,MAAQ+iG,EACpBtkG,IAAKnmB,KAAKmmB,IAAM22D,EAChB0G,OAAQxjF,KAAKwjF,OAAS1G,EACtB7sE,MAAOjQ,KAAKiQ,MACZgU,OAAQjkB,KAAKikB,QAGjB,OAAOjkB,KAAKwpH,kB,KC9LD,SAASkB,GAAM3jH,GAU3B,IAEChC,EASEgC,EATFhC,KACAnJ,EAQEmL,EARFnL,EACA+jC,EAOE54B,EAPF44B,EAJD,EAWG54B,EANFyD,aALD,MAKS,QALT,IAWGzD,EALF8xG,kBAND,MAMc,GANd,EAOC8R,EAIE5jH,EAJF4jH,aACAvzH,EAGE2P,EAHF3P,SACAwzH,EAEE7jH,EAFF6jH,sBATD,EAWG7jH,EADF8jH,qBAGIC,EAAYjS,QAbjB,MAUwB,GAVxB,GAcKkS,EACJJ,GAAgBC,EACZD,EAAeC,EACfvmH,IAEN,OACE,0BACEzI,EAAGxE,EAAWwE,GAAK+uH,GAAgB,GAAKG,EAAY/lH,EAAK9J,OAASW,EAClE+jC,EAAGA,EACH1zB,MAAO,CAAEqV,SAAUu3F,EAAYh/G,KAAM2Q,EAAOuZ,OAAQ,WACpDu+D,iBAAiB,WAEhBwoC,EAAY/lH,EAAK9J,OAAS8vH,EAA1B,UACMhmH,EAAK7E,MAAM,EAAG6qH,EAAaD,GADjC,OAEG/lH,GCjCV,SAASimH,GAAajkH,GAAO,IAEzB0F,EAWE1F,EAbuB,QAGzBkkH,EAUElkH,EAbuB,WAIzBkjB,EASEljB,EAbuB,SAKzB1B,EAQE0B,EAbuB,OAMzBxL,EAOEwL,EAbuB,KAOzBmkH,EAMEnkH,EAbuB,eAQzBoB,EAKEpB,EAbuB,YASzBokH,EAIEpkH,EAbuB,sBAUzB8xG,EAGE9xG,EAbuB,WAWzB6jH,EAEE7jH,EAbuB,sBAYzB3P,EACE2P,EAbuB,SAerBqkH,EAAgBH,eAAwBnsH,OAAO2N,EAArD,OACQ4+G,EAAmBD,EAhBA,oBAkBrBE,EAAkB,CACtB,mCACEx+G,IAAG,gBAAWL,EAAX,OADL,GAGEA,QAHF,EAIE2+G,cAJF,EAKEnhG,SAAUA,MAwCd,OApCA,GACEqhG,OACE,sBACEx+G,IAAG,qBAAgBL,EADrB,MAEE1H,KAFF,EAGEnJ,EAAGqvH,qCAHL,KAIEtrF,EAAGsrF,qCAJL,IAKEzgH,MAAOhF,yBAAeH,EAAQ,CAAC,SAAV,aAAkC,CALzD,IAMEwzG,WANF,EAOEzhH,SAPF,EAQEuzH,aAAcS,EARhB,MASER,sBAAuBA,KAK7B,GACEU,OACE,sBACEx+G,IAAG,4BAAuBL,EAD5B,MAEE1H,KAFF,EAGEnJ,EAAGqvH,4CAHL,KAIEtrF,EAAGsrF,4CAJL,IAKEzgH,MAAOhF,yBAAe,EAEpB,CAAC,SAFkB,oBAGnB,CARJ,IAUEqzG,WAVF,EAWE8R,aAAcS,EAXhB,MAYEh0H,SAZF,EAaEwzH,sBAAuBA,KAKtB,2BAAP,GA8BFI,gBAA4B,CAC1B5zH,UAD0B,EAE1B6yB,UAF0B,EAG1B1uB,KAH0B,GAI1B2vH,gBAJ0B,EAK1B/iH,YAL0B,GAM1BgjH,uBAN0B,EAO1BtS,gBAP0B,EAQ1B+R,2BAAuB7wH,GAGVuG,0BAAf,IC7CA,SAASirH,GAAT,GAKqB,IAJnBtiG,EAImB,EAJnBA,KACA7oB,EAGmB,EAHnBA,OACA2F,EAEmB,EAFnBA,QACGylH,EACgB,4CACnB,IAAKviG,EACH,OAAO,KAFU,kBAIwBA,EAJxB,GAIZunD,EAJY,KAIJC,EAJI,KAIGC,EAJH,KAIYC,EAJZ,OAKOC,oBAASJ,EAAQE,EAAStwE,EAAQ2F,GALzC,mBAKZgL,EALY,KAKJC,EALI,KAMb6/D,EAAUnsE,KAAK2O,MAAMo9D,GACrBg7C,GAAerrH,EAAO1J,IAAM0J,EAAO5J,OAASuP,EAC5C+qE,EAAapsE,KAAK2O,MAAMs9D,EAAWF,GACnCxgE,EAAQe,EAAUD,EAExB,GAAIA,EAASd,EAAQ,EACnB,OAAO,KAET,IAAMy7G,EAAkBhnH,KAAKuM,IAAIF,EAAQ,GACnCu5G,EAAOoB,EAAkB36G,EACzB46G,EAAmBjnH,KAAKuM,IAAI,EAAGvM,KAAKC,IAAIsL,EAAQq6G,EAAMmB,IAE5D,OACE,wCACE7vH,EAAG8vH,EAAkB,EACrB/rF,EAAGkxC,EAAU,EACb5gE,MAAO07G,EAAmB,EAC1B1nG,OAAQ6sD,EAAa,GACjB06C,IA2JKlrH,2BAtJf,YAYoB,QAXlBoZ,aACEgmC,EAUgB,EAVhBA,oBACA/kB,EASgB,EAThBA,kBACAmkB,EAQgB,EARhBA,oBACAC,EAOgB,EAPhBA,mBAEFrkB,EAKkB,EALlBA,SACAt6B,EAIkB,EAJlBA,OACA2F,EAGkB,EAHlBA,QACAgqE,EAEkB,EAFlBA,yBACG67C,EACe,0FACZt7C,EAAW,OAAG5wB,QAAH,IAAGA,OAAH,EAAGA,EAAqB3oD,IAAI2jC,GAC7C,IAAK41C,EACH,OAAO,KAET,IAAMu7C,EAAqB/sE,IAAmB,OAAIC,QAAJ,IAAIA,OAAJ,EAAIA,EAAoB9nD,MAsBtE,SAASiiH,EACPj0F,GAGA,IAC2B+zF,EAAY4S,EAA/B1S,kBACR,GAAMF,GAAW6S,EAGjB,OAAO7S,EAAQ/zF,EAAO4mG,GAGxB,SAAS1S,EACPl0F,GAGA,IAC4B+zF,EAAY4S,EAAhCzS,mBACR,GAAMH,GAAW6S,EAGjB,OAAO7S,EAAQ/zF,EAAO4mG,GAsDxB,OACE,oCACGA,EACC,kBAACN,GAAD,CACEtiG,KAAMqnD,EAAYv5E,IAAI80H,GACtBzrH,OAAQA,EACR2F,QAASA,EACTlM,KAAK,OACLiyH,YAAY,MACZrmG,YAxGR,SACER,GACA,IAC4B+zF,EAAY4S,EAAhC7S,mBACR,GAAMC,GAAW6S,EAGjB,OAAO7S,EAAQ/zF,EAAO4mG,IAkGhBv6C,aA/FR,SACErsD,GACA,IAC6B+zF,EAAY4S,EAAjC3S,oBACR,GAAMD,GAAW6S,EAGjB,OAAO7S,EAAQ/zF,EAAO4mG,IAyFhBn3F,WAAYwkF,EACZzkF,YAAa0kF,EACbvmD,UAhER,SACE3tC,GACA,IAC0B+zF,EAAY4S,EAA9BxS,iBACR,GAAMJ,GAAW6S,EAGjB,OAAO7S,EAAQ/zF,EAAO4mG,IA0DhB7pE,aAvDR,SACE/8B,GACA,IAC6B+zF,EAAY4S,EAAjCvS,oBACR,GAAML,GAAW6S,EAGjB,OAAO7S,EAAQ/zF,EAAO4mG,IAiDhB3hG,YA9CR,SACEjF,GACA,IAC4B+zF,EAAY4S,EAAhCtS,mBACR,GAAMN,GAAW6S,EAGjB,OAAO7S,EAAQ/zF,EAAO4mG,IAwChB9uG,QArCR,SAAwBkI,GACtB,IAAI8qD,EAAJ,CAD2E,IAEnDipC,EAAY4S,EAA5B/pE,eACR,GAAMm3D,GAAW6S,EAIjB,OADA5mG,EAAMqU,kBACC0/E,EAAQ/zF,EAAO4mG,KA+BhB5wE,cA5BR,SACEh2B,GACA,IAC8B+zF,EAAY4S,EAAlC7pE,qBACR,GAAMi3D,GAAW6S,EAIjB,OADA5mG,EAAMqU,kBACC0/E,EAAQ/zF,EAAO4mG,IAqBhBt/D,QAAS4sD,EACT1rF,OAAQyrF,EACR5xF,cAAaukG,IAEb,KACHlxF,EACC,kBAAC4wF,GAAD,CACEtiG,KAAMqnD,EAAYv5E,IAAI4jC,GACtBv6B,OAAQA,EACR2F,QAASA,EACT6jD,OAAO,UACP/vD,KAAK,SAEL,SC/OV,SAAS,GAAT,GAAoB,IAKlB,EAJQ4S,EAA8D1F,EADpD,QACD3G,EAAqD2G,EADpD,OACO1B,EAA6C0B,EADpD,OACeqkH,EAAqCrkH,EADpD,cAC8BkjB,EAAsBljB,EADpD,SACwChB,EAAYgB,EADpD,QAEZ0kH,GAAerrH,MAAaA,EAAd,OAApB,EAEM2rH,EAASvmH,yBAAeH,EAAQ,SAAU,CAAhD,IAEA,IACE2mH,EAAmB9/E,GAAU6/E,EAA7BC,IACA,MAAO7vH,GACP6vH,IAEF,IAAMC,EAASzmH,yBAAeH,EAAQ,SAAU,CAAhD,IAXkB,EAamB+lH,EAbnB,SAaV5jG,EAbU,OAaJrB,EAbI,MAaClW,EAbD,QAaQgU,EAbR,SAelB,GAAIuD,IAAJ,EACE,YAEF,IAAMkkG,EAAkBhnH,WAAxB,GACM4lH,EAAOoB,EAAb,EACMC,EAAmBjnH,WAAYA,SAASuL,EAATvL,EAArC,IAEA,OACE,0BACE4iB,cAAA,cAAoB7a,EADtB,MAEE7Q,EAFF,EAGE+jC,EAHF,EAIE1vB,MAJF,EAKEgU,OALF,EAMEpqB,KAAMowB,EAAW+hG,EANnB,EAOEpiE,OAAQ3/B,EAAWgiG,OAASlyH,IAwBlCmyH,gBAAmB,CACjBjiG,UAAU,GAGG3pB,0BAAf,ICvDA,SAAS6rH,GAAQplH,GAAO,IAEpB0F,EAOE1F,EATkB,QAGpBhB,EAMEgB,EATkB,QAIpB3G,EAKE2G,EATkB,OAKpB1B,EAIE0B,EATkB,OAMpBqkH,EAGErkH,EATkB,cAOpBkjB,EAEEljB,EATkB,SAQpB3P,EACE2P,EATkB,SAWhB0kH,GAAerrH,MAAaA,EAAd,OAApB,EACM6P,EAAQvL,SAAS0mH,WAAT1mH,MAAd,GACQ8iB,EAAS4jG,EAbK,gBAcAA,EAdA,SAchBjlG,EAdgB,MAcXlC,EAdW,SAelBmoG,GAAJ,KACEjmG,GAAQ,KAARA,EACAlC,GAnBJ,KAsBE,IAKA,EAJMsC,EADS9Z,MAAf,WAC4BrV,GAAQ,EAApC,GACMoT,EAAQ4hH,MACV5mH,yBAAeH,EAAQ,SAAU,CADvB+mH,IAEV5mH,yBAAeH,EAAQ,SAAU,CAFrC,IAIA,IACEgnH,EAAkBngF,GAAU1hC,EAA5B6hH,IACA,MAAOlwH,GACPkwH,IAEF,IAAMJ,EAASzmH,yBAAeH,EAAQ,SAAU,CAAhD,IAEA,GAAImiB,IAAJ,EACE,YAEF,IAAMkkG,EAAkBhnH,WAAxB,GACM4lH,EAAOoB,EAAb,EACMC,EAAmBjnH,WAAYA,SAASuL,EAATvL,EAArC,IAEA,OACE,oCACE,0BACE4iB,cAAa7a,EADf,KAEEm9C,OAAQ3/B,EAAWgiG,OAFrB,EAGEpyH,KAAMowB,EAAWoiG,EAHnB,EAIEzwH,EAJF,EAKE+jC,EALF,EAME1vB,MANF,EAOEgU,OAAQA,IAETsC,EAAA,OAAiB+jG,EAChB,6BACE1gE,OAAQ3/B,EAAWgiG,OADrB,EAEEpyH,KAAMowB,EAAWoiG,EAFnB,EAGE9iE,OAAQ,CACN,CAAC/hC,EADK,GAEN,CAACA,EAAOvD,EAAR,EAAoBkC,EAAMlC,EAFpB,GAGN,CAACuD,EAAMrB,EAHD,MAdd,KAqBGI,EAAA,GAAiBmlG,IAAjB,EACC,6BACE9hE,OAAQ3/B,EAAWgiG,OADrB,EAEEpyH,KAAMowB,EAAWoiG,EAFnB,EAGE9iE,OAAQ,CACN,CAACmiE,EAAD,EADM,GAEN,CAACA,IAAqCznG,EAAtC,EAAkDkC,EAAMlC,EAFlD,GAGN,CAACynG,EAAD,EAAqCvlG,EAH/B,MA1BhB,MAyDFgmG,gBAAuB,CACrBliG,UADqB,EAErB7yB,UAAU,GAGGkJ,0BAAf,ICzGA,SAASgsH,GAASvlH,GAAO,IAIvB,EAHQ0F,EAAuD1F,EADxC,QACNqkH,EAA8CrkH,EADxC,cACSkjB,EAA+BljB,EADxC,SACmB1B,EAAqB0B,EADxC,OAC2B3P,EAAa2P,EADxC,SAGjBklH,EAASzmH,yBAAeH,EAAQ,SAAU,CAAhD,IAEA,IACEknH,EAAmBrgF,GAAU+/E,EAA7BM,IACA,MAAOpwH,GACPowH,IARqB,MAUcnB,EAVd,SAUf5jG,EAVe,OAUTrB,EAVS,MAUJlW,EAVI,QAUGgU,EAVH,SAWjBslC,EAAS,CACb,CAAC/hC,EAAMrB,EAAMlC,EADA,GAEb,CAACuD,EAAD,EAAerB,EAAMlC,EAFvB,IAIMvX,EAASD,MAAf,UAQA,OAPA,GACE88C,OACE,CAAC/hC,IAAevD,EAAhB,EAA4BkC,EAAMlC,EADpCslC,GAEE,CAAC/hC,IAAevD,EAAhB,EAA4BkC,EAAWlC,EAFzCslC,EAEoC,GAClC,CAAC/hC,EAAD,EAAerB,EAAMlC,EAHvBslC,IAOA,oCACE,8BACEjiC,cAAa7a,EADf,KAEEoX,UACEnX,KAAatV,GAAYsV,EAAd,GAA8BtV,GAAYsV,EAArDA,wBACkB8a,EAAOvX,EADzBvD,cACsCyZ,EAAMlC,EAD5CvX,YAHJ,EAOE68C,OAPF,EAQEK,OAAQ3/B,EAAWsiG,EAAmBN,IAEvCx/G,EAAA,wBAA+B,SAAA0gG,GAC9B,IAAMqf,EAAe1tH,OAAOquG,EAA5B,MACMsf,EAAmBrB,eAFmB,GAI5C,MAAuB,OAAO,KAJc,IAKpCC,EAAmBoB,EALiB,oBAM5C,OACE,mCACE3/G,IAAG,oBADL,GAGEL,QAHF,EAIE2+G,cAJF,EAKEnhG,SAAUA,SA2BtBqiG,gBAAwB,CACtBriG,UADsB,EAEtB7yB,UAAU,GAGGkJ,0BAAf,ICjFA,SAASosH,GAAoB3lH,GAC3B,OAAO,qBAAP,GAGF2lH,UAA6B,YAMvB,IALJvrF,EAKI,EALJA,OACA10B,EAII,EAJJA,QACA1G,EAGI,EAHJA,QACA3O,EAEI,EAFJA,SACAiO,EACI,EADJA,OAEM47B,EAAY0rF,GAAc,CAC9BxrF,OAD8B,EAE9B10B,QAF8B,EAG9B1G,QAH8B,EAI9B3O,SAJ8B,EAK9BiO,WAcF,OAPAunH,GAAkB,CAChBzrF,OADgB,EAEhBhjB,aAPmB1R,sBAAD,YAA0C,SAAA0gG,GAAU,MACtE,CAAC,MAAO,MAAO,iBAAkB,mBAAmB7rG,SAClD6rG,MAFoE,YAQtEpnG,QAHgB,EAIhB3O,SAJgB,EAKhBiO,WAEF,GAGa/E,0BAAf,IChCA,SAASusH,GAAY9lH,GAAO,IAClB0F,EAAqC1F,EADnB,QACTqkH,EAA4BrkH,EADnB,cACMkjB,EAAaljB,EADnB,SAG1B,OACE,oCACG0F,EAAA,wBAA+B,SAAA0gG,GAC9B,IAAMqf,EAAe1tH,OAAOquG,EAA5B,MACMsf,EAAmBrB,eAAzB,GACQC,EAAmBoB,EAHiB,oBAI5C,OACE,mCACE3/G,IAAG,oBADL,GAGEL,QAHF,EAIE2+G,cAJF,EAKEnhG,SAAUA,SAiBtB4iG,gBAA2B,CACzB5iG,UADyB,EAEzB7yB,UAAU,GAGZy1H,UAAqB,YAAoD,IAAjD1rF,EAAiD,EAAjDA,OAAQ10B,EAAyC,EAAzCA,QAAS1G,EAAgC,EAAhCA,QAAS3O,EAAuB,EAAvBA,SAAUiO,EAAa,EAAbA,OACpD47B,EAAY0rF,GAAc,CAC9BxrF,OAD8B,EAE9B10B,QAF8B,EAG9B1G,QAH8B,EAI9B3O,SAJ8B,EAK9BiO,WAEIs5B,EAAcn5B,yBAAeH,EAAnC,eACA,6BAAIs5B,EAAyC,CAC3C,IAAMxgB,EAAc1R,sBAApB,GACIqgH,EAAJ,EACA3uG,WAAoB,SAAAgvF,GAClB,IAAM4f,EAA2BC,GAAjC,GACMC,EAAmBznH,yBAAeH,EAAQ,SAAU,CAA1D,KAEsB0nH,UAAD,IAA4C,CAC/D5rF,OAD+D,EAE/D10B,QAF+D,EAG/D1G,QAH+D,EAI/D3O,SAJ+D,EAK/DiO,WAEF6nH,UACAJ,IACGnuF,cAA4BsuF,EAA5BtuF,EAAD,GADFmuF,KAKJ,UAGaxsH,0BAAf,IC7DO,SAAS0sH,GAAqBvgH,GACnC,IAAM0R,EAAc1R,EAAQ1V,IAAI,eAC5Bo2H,GAAY,EAChB,GAAIhvG,EAAa,CAIf,GAHAA,EAAY/X,SAAQ,SAAC+mG,GACfA,EAAWp2G,IAAI,iBAAgBo2H,GAAY,MAE7CA,EAAW,OAAON,GACtB,IAAM/lH,EAAO2F,EAAQ1V,IAAI,QACzB,MACE,CAAC,OAAQ,cAAcuK,SAASwF,IAChCqX,EAAYngB,MAAK,SAACghB,GAAD,MAAkC,QAAlBA,EAAEjoB,IAAI,WAEhC21H,GACFJ,GAET,IAAM5/G,EAASD,EAAQ1V,IAAI,UAC3B,MAAI,CAAC,GAAI,GAAGuK,SAASoL,GAAgBy/G,GAC9BD,GAkBF,SAASkB,GAAT,GAM2B,IALhCjsF,EAKgC,EALhCA,OACA10B,EAIgC,EAJhCA,QACA1G,EAGgC,EAHhCA,QACA3O,EAEgC,EAFhCA,SACAiO,EACgC,EADhCA,OAEMs5B,EAAcn5B,yBAAeH,EAAQ,eACrC47B,EAAY0rF,GAAc,CAC9BxrF,SACA10B,UACA1G,UACA3O,WACAiO,WAWF,MAToB,0BAAhBs5B,GACFiuF,GAAkB,CAChBzrF,OAAQF,EACR9iB,YAAa1R,EAAQ1V,IAAI,gBAAkB,GAC3CgP,UACA3O,WACAiO,WAGG47B,EAGF,SAAS0rF,GAAchtH,GAAqC,IACzDwhC,EAA+CxhC,EAA/CwhC,OAAQ10B,EAAuC9M,EAAvC8M,QAAS1G,EAA8BpG,EAA9BoG,QAAS3O,EAAqBuI,EAArBvI,SAAUiO,EAAW1F,EAAX0F,OACtCs5B,EAAcn5B,yBAAeH,EAAQ,eACrCgmH,EACY,0BAAhB1sF,EACIwtF,GACAa,GAAqBvgH,GACrB4gH,EAAgB5gH,EAAQuJ,SAC1Bpa,EAAI,EACJyxH,IACFzxH,EAAIxE,GACCi2H,EAAct2H,IAAI,OAAS0V,EAAQ1V,IAAI,QAAUgP,GACjD0G,EAAQ1V,IAAI,SAAWs2H,EAAct2H,IAAI,UAAYgP,GAC5D,IAAMke,EAASze,yBAAeH,EAAQ,SAAU,CAACoH,IAC3CwD,GAASxD,EAAQ1V,IAAI,OAAS0V,EAAQ1V,IAAI,UAAYgP,EACtDunH,EAAensF,EAAOnrB,OACtBmQ,EAAMmnG,EAAeA,EAAannG,IAAM,EAS9C,OARkBgb,EAAOosF,SACvBzuH,OAAO2N,EAAQxV,MACf2E,EACgB,aAAhB+iC,EAA6B,EAAIxY,EACjClW,EACgB,YAAhB0uB,EAA4B1a,EAAS,EAAIA,EACzC,CAAEonG,mBAKC,SAASuB,GAAkBjtH,GAAkC,IAClDshC,EAAsDthC,EAA9DwhC,OAAmBhjB,EAA2Cxe,EAA3Cwe,YAAapY,EAA8BpG,EAA9BoG,QAAS3O,EAAqBuI,EAArBvI,SAAUiO,EAAW1F,EAAX0F,OAC3D8Y,EAAY/X,SAAQ,SAAC+mG,IACc6f,GAAqB7f,GAC3BigB,QAAUA,IAAQ,CAC3CjsF,OAAQF,EACRx0B,QAAS0gG,EACTpnG,UACA3O,WACAiO,cAKC,SAAS+mH,GAAM3/G,GACpB,MAAO,yCAAyC3Q,KAC9C2Q,EAAQ1V,IAAI,SAAW,IC9G3B,IACMy2H,GAAiB,CACrBppH,SAAU,YAGZ,SAASqpH,GAAqB1mH,GAAO,IAgBnC,EACA,EACA,EACA,EACA,EACA,EApBQ0F,EAA0D1F,EAD/B,QAClBhB,EAAiDgB,EAD/B,QACT3G,EAAwC2G,EAD/B,OACD1B,EAAgC0B,EAD/B,OACO43B,EAAwB53B,EAD/B,YACoBo6B,EAAWp6B,EAD/B,OAE3B3P,EAAagJ,EAFc,SAG7B5J,EAAQiW,MAAYrV,EAAW,MAArC,SACMoyD,EAAUz2C,kBAAOvc,EAAO4J,EAA9B,GACMstH,EAAgB/uF,eAAtB,cAAmDA,EAE7CssF,EAAa,IAAI,GAAJ,aAAnB,GAEMG,GADiB4B,GAAvB,GACuB3B,QAAD,IAAkC,CACtDlqF,OADsD,EAEtD10B,QAFsD,EAGtD1G,QAHsD,EAItD3O,SAJsD,EAKtDiO,WAQF,KAAmB,CACjBwzG,EAAarzG,yBAAeH,EAAQ,CAAC,SAAV,YAAiC,CAA5DwzG,YACA8U,EAAYnoH,yBAAeH,EAAfG,6BAAZmoH,EACApyH,EAAOiK,yBAAeH,EAAQ,CAAC,SAAV,QAA6B,CAA3CG,KAAPjK,GACA2vH,EAAiB,KAAKpvH,KAAtBovH,GAEA/iH,EACE3C,yBAAeH,EAAQ,CAAC,SAAV,eAAoC,CAAlDG,KADF2C,GAEAgjH,EAAwB,KAAKrvH,KAA7BqvH,GACA,IAAML,EApCV,GAoCsBjS,EAGd+U,EAAJ,EACA,IACEA,EAAYlpH,WACVA,SAASnJ,SAATmJ,EAAkCumH,QADpC2C,IAGA3C,yBAGEG,SAVJ,EAOEH,MASF,IAAI4C,EAAJ,EACA,KAA2B,CACzB,IAAMC,EAAc5C,EAChBD,eAD8B,aAAlC,EAGA4C,EAAmBnpH,WACjBA,SAASyD,SAATzD,EAAyCumH,QAD3C4C,IAGA5C,gCAGE6C,SA3BJ,EAwBE7C,MAUJ,IAAMx6C,EAAQtvC,UACZ10B,EADY00B,KAEZ10B,MAFY00B,SAGZ10B,eAAuBw+G,QAHX9pF,EAIZ8pF,EAJF,QAMA,cAAIx6C,EACF,MAEFw6C,YAGE,oCACEn+G,IAAG,sBAAiBL,EADtB,MAEEA,QAFF,EAGE00B,OAHF,EAIE8pF,WAJF,EAKEllH,QALF,EAMEV,OANF,EAOE9J,KAPF,EAQE2vH,eARF,EASE/iH,YATF,EAUEgjH,sBAVF,EAWEtS,WAXF,EAYE+R,sBAZF,EAaExzH,SAAUgJ,EAAOhJ,UAdrB,KAoCF,IAAM22H,GAAmBztH,oBAAS,SAAAyG,GAAS,MACjCuL,EAAavL,EADoB,SAEnCinH,EAAN,GAFyC,eAGnB17G,EAHmB,cAGzC,2BAAyC,KAA9B7F,EAA8B,QACvCuhH,OACE,oCAAsBlhH,IAAKL,EAA3B,KAAyCA,QAASA,GADpDuhH,MAJuC,8BAQzC,OAAO,oCAAP,MAiBF,SAASC,GAAoBlnH,GAAO,IAEhCo6B,EAOEp6B,EAT8B,OAGhC2zB,EAME3zB,EAT8B,SAIhC/F,EAKE+F,EAT8B,QAKhChB,EAIEgB,EAT8B,QAMhCuL,EAGEvL,EAT8B,SAOhC1B,EAEE0B,EAT8B,OAQhC2S,EACE3S,EAT8B,eAUjB/F,GAViB,GAU3BZ,EAV2B,oBAW5B6P,GAAS7P,MAAaA,EAAd,OAAd,EACMu+B,EAAcn5B,yBAAeH,EAAnC,eAEM0iB,EAAMjD,mBAdsB,EAeIJ,oBAfJ,sBAe3BmrD,EAf2B,KAedC,EAfc,OAgB8BprD,oBAhB9B,sBAgB3BqrD,EAhB2B,KAgBDC,EAhBC,OAmBNtrD,mBAnBM,sBAmB3BT,EAnB2B,KAmBnBw8B,EAnBmB,KAqBhC/rB,EASE3tB,EA9B8B,WAsBhC0e,EAQE1e,EA9B8B,YAuBhCi7C,EAOEj7C,EA9B8B,aAwBhCuqE,EAMEvqE,EA9B8B,aAyBhC0tB,EAKE1tB,EA9B8B,YA0BhCmjB,EAIEnjB,EA9B8B,YA2BhC6rD,EAGE7rD,EA9B8B,UA4BhCgW,EAEEhW,EA9B8B,QA6BhCk0C,EACEl0C,EA9B8B,cAgC5BigD,EAAY8F,uBAChB,SAAA7nC,GACE6qD,MACAE,MAEA,GADA,EAEA,OAFA,EAEA,KAEF,CARF,IAWM3qD,EAAUynC,uBACd,SAAA7nC,GACE6qD,MAEA,GADA,EAEA,OAFA,EAEA,KAEF,CAPF,IAUMo+C,EAAaphE,uBACjB,SAAA7nC,GAEE,GADA,EAEA,OAFA,EAEA,KAEF,CANF,IASMkpG,EAAarhE,uBACjB,SAAA7nC,GAEE,GADA,EAEA,OAFA,EAEA,KAEF,CANF,IASMmpG,EAAYthE,uBAChB,SAAA7nC,GAEE,GADA,EAEA,OAFA,EAEA,KAEF,CANF,IASMgiC,EAAW6F,uBACf,SAAA7nC,GAEE,GADA,EAEA,OAFA,EAEA,KAEF,CANF,IASMD,EAAY8nC,uBAChB,SAAA7nC,GACE,GACE+qD,MAEF,IAAIn2C,EAAJ,EACIC,EAAJ,EACI/R,EAAJ,UACE8R,EAAU9R,kCAAV8R,KACAC,EAAU/R,kCAAV+R,KAEFD,EAAU5U,UAAV4U,EACAC,EAAU7U,UAAV6U,EACA,IAAMvmB,EAAKnT,WAAkB6P,EAAlB7P,EAAX,EACM4+D,EAAW5+D,QAAe2F,EAAhC,EAEMq3D,EAAQ1jD,4BAAd,GAKM20G,EAA+BjxD,SACjCA,KADiCA,UAArC,EAIA,GACElzC,EAAYjF,EAAZiF,KAGJ,CAAC,EAAD,MAKE9pB,EALF,SAMEA,EANF,QA7BF,IAyCMkuH,EAAQxhE,uBACZ,SAAA7nC,GAEE,GAGA,GACElI,OAGJ,CAACgzD,EAVH,IAaMw+C,EAAczhE,uBAClB,SAAA7nC,GACE,GAGA,GACEg2B,OAGJ,CAAC80B,EATH,IAgBA,OAJAhrD,qBAAU,WACR07B,EAAUtf,EAAVsf,oBACC,CAFH17B,IAKE,yBAAK9Y,MAAOuhH,IACV,yBACEzlG,IADF,EAEE1b,UAFF,sBAGE4D,MAAK,YAHP,MAIEgU,OAAM,YAJR,MAKEwB,YALF,EAMEmtC,UANF,EAOE0e,aAPF,EAQEtvB,aARF,EASEvtB,YATF,EAUEC,WAVF,EAWExK,YAXF,EAYEqiC,QAZF,EAaE9+B,OAbF,EAcE1Q,QAdF,EAeEk+B,cAfF,EAgBEhvC,MAAO,CAAEzE,QAAS,UAElB,oCACE8K,SADF,EAEEqsB,YAAaA,GAFf,GAIEv+B,OAJF,EAKE2vE,yBAA0BA,KAE5B,yCAAuB3vE,OAAQA,OAzMvC2tH,aAA6B,CAC3Bz7G,SAAUw3F,cAAyB,CACjCA,eADiC,KAEjCA,YAAuBA,IAHE,WAK3B3oE,OAAQ,UAAqB,CAC3BlB,QAAS6pE,SADkB,WAE3BtpE,eAAgBspE,SAAoBvzG,aACnCA,YAGLw3H,gBAAgC,CAC9Bz7G,SAAU,IAqOZ27G,gBAAmC,CACjCv0G,aADiC,GAGjCpH,SAAU,IAHuB,IAIjCooB,cAJiC,EAMjCjV,iBANiC,EAOjCmtC,eAPiC,EAQjC0e,kBARiC,EASjCtvB,kBATiC,EAUjCvtB,iBAViC,EAWjCC,gBAXiC,EAYjCxK,iBAZiC,EAajCnN,aAbiC,EAcjCk+B,mBAdiC,EAejC4G,oBAfiC,EAgBjCE,0BAAsBhoD,GAGTuG,0BAAf,IC5YewU,iCACb,qBACA,CACEi3G,OAAQ,CACNjlH,KAAM,QACNqB,YAAa,iCACb4M,aAAc,YACd+jC,kBAAmB,CAAC,YAEtBmzE,OAAQ,CACNnlH,KAAM,QACNqB,YACE,sEACF4M,aAAc,QACd+jC,kBAAmB,CAAC,YAEtB01E,OAAQ,CACN1nH,KAAM,QACNqB,YACE,qFACF4M,aAAc,UACd+jC,kBAAmB,CAAC,YAEtB70B,OAAQ,CACNnd,KAAM,SACNqB,YAAa,oDACb4M,aAAc,GACd+jC,kBAAmB,CAAC,YAGtB21E,OAAQ35G,8BAAoB,mBAAoB,CAC9CvZ,KAAM,CACJuL,KAAM,SACNqB,YACE,iEACF4M,aACE,wEACF+jC,kBAAmB,CAAC,YAEtB41E,UAAW,CACT5nH,KAAM,QACNqB,YAAa,wCACb4M,aAAc,QACd+jC,kBAAmB,CAAC,YAEtB3wC,YAAa,CACXrB,KAAM,SACNqB,YAAa,sDACb4M,aACE,iFACF+jC,kBAAmB,CAAC,YAEtB61E,iBAAkB,CAChB7nH,KAAM,QACNqB,YAAa,yCACb4M,aAAc,OACd+jC,kBAAmB,CAAC,YAEtBx3B,SAAU,CACRxa,KAAM,SACNqB,YACE,iEACF4M,aAAc,GACd+jC,kBAAmB,CAAC,cAGxBna,YAAa,CACX73B,KAAM,aACN3P,MAAOvB,QAAMo/D,YAAY,cAAe,CACtC,SACA,UACA,wBACA,aAEF7sD,YAAa,4BACb4M,aAAc,UAEhBqtB,yBAA0B,CACxBt7B,KAAM,SACNqB,YACE,2GACF4M,aAAc,KAEhBzJ,UAAW,CACTxE,KAAM,UACNqB,YAAa,mDACb4M,aAAc,MAGlB,CAAEC,iBAAiB,ICpFA45G,G,4MACnBrzH,KAAO,Y,sDAECyN,GACNA,EAAc06D,iBACZ,kBACE,IAAIxhC,GAAgB,CAClB3mC,KAAM,qBACNoL,eAAgBkoH,GAChBjoH,aAAckoH,Y,GATensF,ICLxB7tB,iCAAoB,gCAEjC,CACEi6G,UAAW,CACTjoH,KADS,SAETiO,aAFS,GAGT5M,YAAa,gDAGjB,CAAEi6C,kBAAmBwwC,KCThB,SAAS,GAAT,OAIL,OAYA,cAA6C,IAAhBo8B,EAAgB,uDAAJ,GACvC,OAAIp5G,EAAJ,QACS3c,OAAA,OAAc2c,EAAd,cACA,SAAAq5G,GAAQ,OACXC,EAAa,EAEXt5G,aAAmBo5G,SAAiB,CAACp5G,EAArCA,aAHS,MADf,QAQFA,eACO,CAAP,IAxBgBs5G,CAAa,CAAEC,QADPl8B,EAF2C,wBAI9D,KAAc,SAAAg8B,GACnB,IAAMrtH,EA0BV,gBACE,IACI0xF,EADc19E,EAAlB,KACoBjO,cAApB,cAEE2rF,WACA19E,oCAFF,UAIE09E,UAPyD,IAa3D,EALQ87B,EAAex5G,EARoC,WASrD29E,EAAkB,CACtBx7F,IAAK,IAAIqH,IAAIgwH,EAAYC,GAAYhwH,MAE/B2Z,EAAepD,EAZoC,WAc3D,UACE,UAaE,OAXE69E,EADF,EACyB79E,EAAA,aACnB,CACE7d,IAAK,IAAIqH,IAAIwW,EAAR,gBAAwCvW,MAE/C,CACEtH,IAAK,IAAIqH,IAAI,GAAR,OAAWwW,EAAX,sBAA+CvW,MAGnCuW,EAAA,aACnB,CAAE/d,UAAW+d,EAAM05G,cACnB,CAAEz3H,UAAW,GAAF,OAAK+d,EAAL,oBACV,CACL9O,KADK,kBAELvL,KAAMqa,EAFD,WAGLzN,YAAayN,EAHR,UAILqD,SAJK,EAKLqE,QAAS,CACPxW,KADO,aAEPmQ,YAFO,EAGP/D,MAAO,CACLlU,SAAUy0F,KAIlB,UAMA,qBAMA,eAMA,qBAMA,kBACE,OAAO56E,GACLjD,EADiC,aAAnC,GAKF,aACE,MAAO,CACL9O,KADK,eAELvL,KAAMqa,EAFD,WAGLzN,YAAayN,EAHR,UAILqD,SAJK,EAKLqE,QAAS,CACPxW,KADO,gBAEP4Q,eAAgB67E,IAGtB,eAMA,kBAMA,aAMA,aACE,OAAO16E,GACLjD,EADiC,aAAnC,GAKF,aACE,MAAO,CACL9O,KADK,oBAELvL,KAAMqa,EAFD,WAGLzN,YAAayN,EAHR,UAILqD,SAJK,EAKLqE,QAAS,CACPxW,KADO,gBAEP6Q,eAAgB47E,IAGtB,gBAMA,kBACE,OAAO16E,GACLjD,EADiC,aAAnC,GAKF,WAaE,OAXE69E,EADF,EACyB79E,EAAA,aACnB,CACE7d,IAAK,IAAIqH,IAAIwW,EAAR,gBAAwCvW,MAE/C,CACEtH,IAAK,IAAIqH,IAAI,GAAR,OAAWwW,EAAX,sBAA+CvW,MAGnCuW,EAAA,aACnB,CAAE/d,UAAW+d,EAAM05G,cACnB,CAAEz3H,UAAW,GAAF,OAAK+d,EAAL,oBACV,CACL9O,KADK,kBAELvL,KAAMqa,EAFD,WAGLzN,YAAayN,EAHR,UAILqD,SAJK,EAKLqE,QAAS,CACPxW,KADO,cAEPmQ,YAFO,EAGP/D,MAAO,CAAElU,SAAUy0F,GACnB/uB,oBAGN,UAMA,UAMA,iBAMA,qBAMA,eAMA,UAMA,aACE,OAAO7rD,GACLjD,EADiC,aAAnC,GAKF,QACE,MAAM,IAAI3Y,MAAM,2BAAV,OAAN,KA/NUy2F,CAAgB,EAG1BT,cAHyB,IAA3B,GAQA,OAFArxF,sCAAmCtI,KAAnCsI,IACAA,gBAAoB,CAApBA,GACAA,KCNW,mBACb,OAAO,gDAEL+xF,GAFK,GAGL,cACS,CACL7sF,KAAMlR,gBADD,iCAELkgB,cAAeoE,iCAAuB,MAH1C,SAKW,SAAA3iB,GAAI,MAAK,CAChBq8F,QADgB,YAEdr8F,UACA,IAAMw3H,EAAYvpH,yBAAe4xF,EAAjC,aACA96F,MAAM,uDAAD,OAALA,UAGQ,SAAAizH,GAAW,OAAIA,EAAJ,UAHnBjzH,MAIQ,SAAA22F,GACJ,IAAMt7F,EAAe6N,yBACnBjO,EADiC,cAAnC,gBAKMw8F,EADUz6E,sBAAhB,GACqB,iBACnB,SAAAklC,GAAQ,OAAIh5C,yBAAeg5C,EAAfh5C,UAAJ,KAEJk/D,EAAkBl/D,yBAAeuuF,EAAc,CAAC,WAAtD,YAIAx8F,gBACEy7F,GAAeC,EAASt7F,EAD1BJ,OAjBJ+E,OAqBS,SAAAH,GACLD,2B,iCCsDd,OApFA,SAAoB6K,GAAO,MACK2d,mBADL,yBAClBuvE,EADkB,KACTu7B,EADS,OAEe9qG,mBAFf,yBAElBw4B,EAFkB,KAEJk/D,EAFI,KAIjBqT,EAAQ1oH,EAJS,IAMZ2oH,EAAkCD,EANtB,IAMJE,EAA0BF,EANtB,UAMOG,EAAeH,EANtB,WAuCzB,OA/BA1qG,qBAAU,WAAM,4CACd,gCAAAhsB,EAAA,sEAGU82H,EAAY3wH,wBAAa,CAAEnH,IAAK23H,IAH1C,SAImBG,WAJnB,eAIIC,EAJJ,8DAMI1T,EACE,8BACE,gCADF,4BACyC,KADzC,YACwD,uBADxD,MADFA,IANJ,2BAcE,IACQ2T,EAAa,IAAI,GAAJ,QADjB,GAEFP,KACA,MAAOrzH,GACPigH,EACE,8BACE,gCADF,qCACiD,uBADjD,MAEGjgH,EAFH,YAEkB,uBAFlB,MADFigH,IAlBJ,0DADc,0DA6Bd4T,KACC,CA9BHjrG,IA+BA,EAEI,2BACE,2BACE,wBAAYva,MAAM,SAHxB,KAOF,EAEI,2BACE,wBAAYuB,MAAO6jH,IACnB,2BACE,yBAAKK,0BAA2BC,oBAElC,4BACE,wBACE7wH,KAAI,iBAAY40F,MADlB,UAEEe,IAFF,sBAGExnE,OAHF,SAIEhjB,MAAM,aAEN,uBAPJ,OASGypF,EAAA,sBACC,wBACE50F,KACE,IAAID,IAAI60F,MAAR,kBAAuC,IAAI70F,IAA3C,IAFJ,KAIE41F,IAJF,sBAKExnE,OAAO,UAEP,wBAAehjB,MAAM,eAvB/B,OA6BK,wBAAgB8B,QAAQ,WCnF3BrC,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC0/F,YAAa,CACX7+F,SADW,IAEXgnB,WAAY7nB,UAFD,GAGXiB,YAAajB,kBA6CjB,OAzCA,SAAmB,GAMhB,IALDgmH,EAKC,EALDA,WACAC,EAIC,EAJDA,aACAC,EAGC,EAHDA,aACA13H,EAEC,EAFDA,MACA23H,EACC,EADDA,SAEMzkH,EAAU5B,KAChB,OACE,wBAAaoC,UAAWR,EAAQg+F,aAC9B,4BADF,GAEE,wBAAQlgG,MAAR,EAA6B4jB,SAAU8iG,GACpCF,EAAA,KAAe,SAAAh/F,GACd,MACA,EAKA,OAJIA,EAAJ,OACExnB,EAAQwnB,EAARxnB,KACAxB,EAAc,GAAH,OAAMgpB,EAAN,kBAAoBA,gBAApB,KAAXhpB,MAGA,wBAAU2E,IAAK3E,GAAf,EAAoCwB,MAAOA,GAASwnB,GACjDhpB,GAFL,OAOJ,4BAAiBioH,EAAe,GAlBpC,KCRF,SAASG,GAAYxpH,GAAO,IAClB/J,EAAW+J,EADO,OAE1B,OACE,oCACE,wBAAgBuF,QAAQ,UACxB,4BAHJ,IAcF,SAASkkH,GAAK,GACZ,OAAO1kH,EAD6B,EAAtBA,UAAsB,8BAItC,IAAM7B,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCsmH,QAAS,CACPnlH,UADO,IAEPwa,UAAW,QAEb4qG,eAAgB,CACdxkH,UAAW/B,kBA+Rf,OA3RA,SAAgC,GAA0B,IAAxBhT,EAAwB,EAAxBA,MAAOi/F,EAAiB,EAAjBA,cAAiB,EAChB1xE,mBADgB,yBACjDw4B,EADiD,KACnCk/D,EADmC,OAEpB13F,mBAFoB,yBAEjDoyB,EAFiD,KAErC65E,EAFqC,OAGVjsG,mBAHU,uBAGjDksG,EAHiD,KAGhCC,EAHgC,OAIRnsG,mBAJQ,uBAIjDosG,EAJiD,KAI/BC,EAJ+B,OAKhCrsG,mBAAS,IALuB,wBAKjDssG,EALiD,KAK3CC,EAL2C,OAMRvsG,oBANQ,sBAMjDwsG,EANiD,KAM/BC,EAN+B,OAOlBzsG,mBAPkB,uBAOjD0sG,EAPiD,KAOpCC,EAPoC,KAQlDxlH,EAAU5B,KARwC,yFA4CxD,yCAAAlR,EAAA,gEAEQu4H,EAAU34F,EAAQ,IAAH,IAAe,IAAIlwB,IAF1C,GAGQ8oH,EAAO7sH,WAAWssH,OAH1B,eAIyBQ,EAAO,8CAE5B,CAAEhzE,SAAUsyE,GACZ,CAAES,KAAF,EAAQE,iBAPZ,iBAIQnzH,EAJR,wCAUuBA,EAVvB,sEAUe6yB,EAVf,SAWUA,mBAXV,2BAYQA,0DAZR,+BAccs+F,EAAMvwH,wBAAa,CAAEnH,IAAKo5B,MAASt4B,MAdjD,oBAiBgB42H,EAjBhB,kEAmBUt+F,QAAa,KAAbA,QAnBV,QAsBMmgG,MAAYngG,EAAZmgG,MAtBN,gJAwBIL,KACIK,SAAiBhzH,EAArB,eAA6C6yH,MAzBjD,yEA5CwD,+GA+FxD,6CAAAp4H,EAAA,6DAA0BqrD,EAA1B,kCAEQstE,EAAYz4H,OAAA,aACX,SAAA+7G,GAAK,8BAAgB5wD,EAAhB,OADM,KAFpB,uBAMwB9nD,MAAM,GAAD,iBAAUo1H,EAAY,IAAH,UANhD,YAMInC,EANJ,8DAQInT,EACE,8BACE,gCADF,iCAC6C,uBAD7C,MAEG,KAFH,YAEkB,uBAFlB,MADFA,IARJ,mCAiBOmT,EAjBP,2BAkBInT,EACE,8BACE,gCADF,oCACgD,uBADhD,MAEGmT,EAFH,YAEyBA,EAFzB,eAEiD,uBAFjD,MADFnT,IAlBJ,yDA2BSmT,EA3BT,kEA/FwD,+GA6HxD,+CAAAx2H,EAAA,6DAA2B8G,EAA3B,kCAAsCukD,EAAtC,kCAEQstE,EAAYz4H,OAAA,aACX,SAAA+7G,GAAK,8BAAgB5wD,EAAhB,OADM,KAFpB,uBAMwB9nD,MAAM,GAAD,iBAAUo1H,EAAY,IAAH,UAAnB,IAA8C,CACrEn1H,OADqE,OAErEg8C,KAAMhrC,oBARZ,OAMIgiH,EANJ,8DAWInT,EACE,8BACE,gCADF,iCAC6C,uBAD7C,MAEG,KAFH,YAEkB,uBAFlB,MADFA,IAXJ,mCAoBOmT,EApBP,2BAqBInT,EACE,8BACE,gCADF,oCACgD,uBADhD,MAEGmT,EAFH,YAEyBA,EAFzB,eAEiD,uBAFjD,MADFnT,IArBJ,yDA8BSmT,EA9BT,kEA7HwD,sBAUxDxqG,qBAAU,WACSqxE,IAAjB,KAEC,CAACg7B,EAHJrsG,IAKAA,qBAAU,WAAM,4CACd,8BAAAhsB,EAAA,sEAC6B44H,EAD7B,4DACQC,EADR,+DAOMA,OAPN,uBAQIxV,+BARJ,2CAWmCuV,EAXnC,iEAWQE,EAXR,SAeIlB,KAfJ,6CADc,0DAoBdmB,KApBF/sG,IAuBAA,qBAAU,WACR,IACI+rG,IAAqBE,EAAzB,KAAoCe,GAApC,GACSf,SAAJ,GAAoCe,QAqH3C,IAAMC,EAAc,CAClB,wBAAYllH,IAAZ,UAA0BR,QAAQ,MADpC,2BAMA,KAME,OALA0lH,OACE,wBAAYllH,IAAZ,eAA+BtC,MAAM,SADvCwnH,IAKO,6BAAP,GAGF,MAIE,OAHAA,OACE,sBAAallH,IAAb,cAA+B9P,OAAO,+BAEjC,6BAAP,GAGF,IAAMi1H,EAAch5H,OAAA,uBAEV,SAAAk4B,GAAI,OAAIA,yBAAJ,cAad,GAXA6gG,OACE,sBACEllH,IADF,gBAEEqjH,WAFF,EAGEC,aAHF,EAIEC,aApHJ,YACEQ,EAAmB5rG,SAAnB4rG,OACAE,MACAE,EAAQ,IAARA,KACAI,MACAF,OAgHEx4H,MALF,UAME23H,SAAS,sBAIb,EAAqB,CACnB,IAAM1uH,EAAMk1C,EAAA,WACV,SAAAt7C,GAAC,QAAMA,mBAAN,SAA6BA,kBAEhCw2H,OACE,sBACEllH,IADF,iBAEEqjH,WAFF,EAGEC,aAHF,EAIEC,aA3HN,YACEU,EAAoB9rG,SAApB8rG,OACAE,EAAQ,IAARA,KACAI,MACAF,OAwHIx4H,MALF,WAME23H,SAAS,wBAqEf,OAhEA,IACE0B,OACE,yBAAKllH,IAAI,aACP,4BACE,4BADF,SAEE,yBAAKT,UAAWR,EAAQ4kH,SACtB,wBAAY9mH,MAAZ,EAAgC4jB,SAjI1C,YACE,IAAM2kG,EAASjtG,SAAf,MACAosG,KACAl6H,kBAAsB65H,aAAtB75H,YACAA,4BA8HW4D,MAAA,KAAWi2H,EAAX,kBAEG,SAAAvB,GAAG,OACDA,qBACAA,6BAFC,MAFN,KAMM,SAAAA,GACH,IAAM7nG,EAAWR,QAAQqoG,EAAzB,OACM0C,EACJ,yBACElC,0BAA2B,CACzBnmH,OAAQomH,cAAmBT,MAAnBS,eAIRkC,EACJ,yBACEnC,0BAA2B,CACzBnmH,OAAQomH,cAAmBT,MAAnBS,cAId,OACE,sBAAMpjH,IAAK2iH,EAAX,GAAmB9lH,MAAO8lH,EAAIx4H,KAC3B,SAAAo7H,GAAgB,OACf,wBACEtmH,MAAO6b,EAAW6nG,EAAH,MADjB,EAEE9hH,UAFF,OAGE2kH,aAAW,GAEX,sCACExlH,IAAK2iH,EADP,GAEE9lH,MAAO8lH,EAFT,GAGE92H,MAHF,EAIEivB,SAJF,EAKE4mE,QAAS,8BAXE,gBAwBnC,GACEwjC,EAAA,KAAiB,sBAAallH,IAAb,YAA6B9P,OAAO,sBAGzD,GACEg1H,EAAA,KACE,sBAAYllH,IAAZ,aAA6B2iH,IAAKuB,SAAsBvB,OAGrD,oCAAP,IC5TmB8C,G,4MACnBh3H,KAAO,yB,sDAECyN,GACNA,EAAc+0F,mBACZ,kBACE,IAAI91F,EAAe,CACjB1M,KAAM,gCACNqL,gBACAwB,sBAAuBoqH,GACvBlrH,WAAYs/F,GAAa59F,GACzBd,YAAa,yBACbC,YAAa,oCACbtP,IAAK,mC,GAbqC8pC,ICDrC,YAAA35B,GAAiB,IACtB+qC,EAAc/qC,EADQ,UAGtBpT,EAAUm+C,EAHY,2BAI0BA,EAJ1B,+BAItBj/B,EAJsB,sBAIDoF,EAJC,yBAOtBgB,EAAsB64B,EAPA,wCAQtBv9B,EAAyBu9B,EARH,kDASxBntC,EAAekO,EAAoB,sBAEvC,CACE28B,SAAU77C,EAAA,SACRoT,4BADQ,YAER,CAAElC,KAAM,oCAGZ,CAAEs7C,kBAAF,GAA6CptC,iBAAiB,IA8BhE,MAAO,CAAE1N,WA3BU1R,EAAA,iCAIfA,EAAA,MAAY,CACVkR,KAAMlR,UADI,uBAEVkgB,cAAeoE,EAAuBtT,MANzB,OASV,SAAArP,GAAI,MAAK,CACd,uBACE,OAAOA,yBAAP,MAEF,kBACE,IAAM0jB,EAAOC,EAAb,GACA,kCACK1E,EADL,QAEEkD,aAFF,EAGEixE,aAAc1vE,WAAgB1jB,EAHhC,kBAIE+xF,OAAQruE,EAJV,SAKEk/B,iBAAkBn6C,KALpB,iBAMEqF,OAAQ9N,gBANV,SAOEizF,aAAcjzF,EAAKizF,oBAKN5jF,iBChDR,YAACoC,GAAiC,IACvC6qC,EAAc7qC,EAAd6qC,IAAK5a,EAASjwB,EAATiwB,KACPvxB,EAAcmsC,EAAI,mDAFuB,EAIV5a,EAAKw5F,IAAlCnrH,EAJuC,EAIvCA,WAER,OAAO,IAAII,EAAY,CACrBnM,KAAM,sBACNqL,aAR6C,EAI3BA,aAKlBU,aACAK,UAAW,eACXC,SAAU,eACVjB,eAAgB+rH,GAAiC1pH,MCPrD,IAAMoqC,GAAgB,IAAI3qC,IAAI,CAC5B,CAAC,SAAU,kBACX,CAAC,MAAO,wBAGK,YAAC7B,GAAD,OACbhR,QACG8B,QACC,uBACA+iD,GACA7kD,QAAMuB,MAAM,CACV2P,KAAMlR,QAAMqkB,QAAQ,wBACpBnE,cAAeoE,iCAAuBtT,MAGzCtP,SAAQ,SAAAC,GAAI,MAAK,CAChBwpD,cADgB,SACFt0C,GACZ,IAAMgO,EAAUnB,sBAAW/hB,GAC3B,GAAIypD,qCAA0BvmC,GAAU,CACtC,IAAMwmC,EAAgBxmC,EAAQymC,UAC5B,uBACA,iBACA,CAAE/yC,YAAa1B,EAAQ+R,WAEzB/D,EAAQ0mC,WAAWF,GAGrBxmC,EAAQ4mC,aAAa50C,QAGxBmG,OAAM,SAAArb,GAAI,MAAK,CAKd,uBACE,IAAMipE,EAAWhnD,kBAAQjiB,EAAM,oBACzBw6C,EAAeqB,GAAcr8C,IAAIypE,GACvC,IAAKzuB,EACH,MAAM,IAAI90C,MAAJ,uCAA0CujE,IAClD,OAAOzuB,GAOT,kBAEE,IAAM1sC,EAAS9N,EAAKw6C,aAAanrC,aAAajF,OAC5C6X,kBAAQjiB,EAAM,CAAC,YAAaA,EAAK8hB,oBAAsB,IAEzD,8CACK9hB,EAAK0qD,qBACLzrC,GAAqBjf,IAF1B,IAGE8N,SACAqU,aAAcniB,UCjET,eAAmB,IAAhBw8C,EAAgB,EAAhBA,UACV9sC,EAAQ8sC,EAAd,SACQ2hE,EAAY3hE,EAFY,mBAGeA,EAHf,cAGxBzzC,EAHwB,WAIxB2gF,GAJwB,YAIHltC,EAJG,wCAKxBvuC,EAAmBuuC,EALK,8CAOOA,EAPP,0CAUdA,EAAlB,cAEA,gBACE,IAAM4+E,EAAa5jH,kBAA0BA,SAA7C,MACM6jH,EAAW7jH,kBAA0BA,SAA3C,IAGA,OAFiBA,UAAgB6jH,EAAhB7jH,EAAiC2W,EAAlD,GAC2B3W,EAAX8jH,YAA+B9jH,EAA/C,aAIF,IAAM+jH,EAAQxyH,GAAS,SAAe,GAQnC,IAMD,EAMA,EACA,EApBAmM,EAOC,EAPDA,QACAsmH,EAMC,EANDA,cACAzpC,EAKC,EALDA,OACAjkF,EAIC,EAJDA,OACAslF,EAGC,EAHDA,aACA1gE,EAEC,EAFDA,SACAlN,EACC,EADDA,QAGMi2G,EAAaD,EAActmH,MAAjC,YACA,MACE,YAGF,GAAIA,MAAJ,QAAyB,OACXA,sBADW,GACrB4kF,EADqB,yBAEd5kF,MAAJ,UACL4kF,UAIF,WAAIA,EAAkB,CAEpB,IACM5Q,GADyBh0E,cAAD,IAA9B,GACqByzE,mBAArB,KACA+yC,EAAc90H,SAASsiF,EAAD,GAAtBwyC,IACAC,EAAWH,EAActyC,EAAzByyC,SACK,WAAI7hC,EAAkB,CAE3B,IAAM3S,IAASjyE,eAAD,UAAD,IAAb,GACM/V,IAAQ+V,eAAD,SAAD,IAAZ,GACAwmH,EAAc90H,SAASzH,EAAvBu8H,IACAC,EAAWH,EAAXG,QACK,YAAI7hC,EAAmB,CAE5B,IAAM3mB,EAAOj+D,MAAb,QACMiyE,EAAOhU,EAAb,QACAuoD,EAAcvoD,EAAduoD,MACAC,EAAWH,EAAXG,GAEF,KAAc,CACZ,IAUA,EAVM/yC,EAAW1zE,MAAjB,SACMo1E,EAAesxC,EAAYH,EAAjC,GACMpxC,EAAauxC,EAAYD,EAA/B,GACM3xC,EAAUN,EAAiBqI,EAAjC,GACM9H,EAAQP,EAAiBqI,EAA/B,GACM8pC,EAAYnyC,EAAiB,GAEhCW,EAAD,GAFF,GAOEm4B,EAAcv0G,EAAeH,EAD/B,EACuC,sBAEA,cAFuB,CAA5D00G,IAIF,IAAMsZ,EAAmB7tH,EAAeH,EAAQ,mBAAoB,CAApE,IAGA,OACE,wBACEiiB,cAAA,gBAAsB7a,EADxB,MAEEuP,EAAG,CAAC,KAAD,gEAFL,KAGE/P,MAAO,CAAE29C,OAAQmwD,GACjBh9F,QAAS,SAAAuwE,GAAG,OACVvwE,EAAQtQ,EAASumH,EAAV,OAA6BE,EAA7B,OADG,IAGZz+F,YAAa,SAAA64D,GACX,IAAeA,0BAEjB54D,WAAY,SAAA44D,GACV,IAAeA,4BAMvB,eAGF,cAAwC,MAEpCh7E,EASEvL,EAXkC,SAGpC1B,EAQE0B,EAXkC,OAIpC2S,EAOE3S,EAXkC,aAKpCozC,EAMEpzC,EAXkC,iBAMpCuiF,EAKEviF,EAXkC,OAOpC4jF,EAIE5jF,EAXkC,aAQpB4zB,EAGd5zB,EAXkC,+BAUpCyjF,EACEzjF,EAXkC,aAahCusH,EAAoB5d,GAAQ,WAChC,IAAMqd,EAAN,GASA,OARA54E,WAAyB,SAAAprC,IACPA,gBACZA,SADYA,QAEZ,CAACA,EAFL,SAGA/N,SAAgB,SAAAZ,GACd2yH,EAAc3yH,EAAd2yH,iBAGJ,IACC,CAxBmC,IA0BhCQ,EAAN,GA1BsC,sBA2BtC,2BAAsC,8BAA1Bt8H,EAA0B,KAAtBwV,EAAsB,KAC9Bwd,EAAWnrB,YAA8BA,OAAO2N,EAAtD,MACA8mH,OACE,mBACEzmH,IADF,EAEEL,QAFF,EAGEpH,OAHF,EAIEqU,aAJF,EAKE4vE,OALF,EAMEqB,aANF,EAOEooC,cAPF,EAQE9oG,SARF,EASElN,QAASytE,MAvCuB,8BA2CtC,IAAMgpC,EAAe,UAAH,OAAa95G,EAA/B,IACA,OACE,qBAAGziB,GAAH,EAAqBqwB,cAAY,kCAC/B,yBAEEzd,wBAAyB,CACvBC,OAAQ,gBAAF,iGALd,GAoCF,OANA2pH,eAAuC,CACrC/5G,kBADqC,EAErCihB,kBAFqC,GAGrC6vD,kBAAczwF,GAGTuG,EAAP,ICpLa,eAAmB,IAAhByzC,EAAgB,EAAhBA,UACV2/E,EAAoB3/E,EAA1B,2EAGQj/B,EAAwBi/B,EAJA,mDAgChC,OAAO,IAAI2/E,EAAkB,CAC3Bn4H,KAD2B,iCAE3BoL,eA5BqBotC,EAAvB,IA6BEntC,aA5BmBkO,EAAoB,iCAEvC,CACEilG,YAAa,CACXjzG,KADW,QAEXqB,YAFW,6BAGX4M,aAHW,uBAIX+jC,kBAAmB,CAAC,YAEtB66E,oBAAqB,CACnB7sH,KADmB,QAEnBqB,YAFmB,kDAGnB4M,aAHmB,QAInB+jC,kBAAmB,CAAC,YAEtB86E,iBAAkB,CAChB9sH,KADgB,QAEhBqB,YAFgB,qEAIhB4M,aAJgB,OAKhB+jC,kBAAmB,CAAC,aAGxB,CAAE9jC,iBAAiB,OChBjB/K,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrCqqE,MAAO,CACLnqE,QAAS,GAEXwpH,UAAW,CACT30B,SADS,aAET70F,QAASF,cAEXW,UAAW,CACTtD,QADS,eAETwD,SAFS,OAGTsW,SAHS,QAITpW,aAJS,kBAKTC,gBALS,OAMTC,YAAajB,UANJ,GAOTE,QAASF,eAEXkB,WAAY,CACV7D,QADU,eAEV8Z,SAAU,SAEZ2V,OAAQ,CACN5sB,QAASF,UADH,IAENgB,gBAAiB,QAEnBY,MAAO,CACLuV,SAAU,OAGZwyG,OAAQ,CACNroH,OAAQ,sBAIZ,SAASsoH,GAAehtH,GACtB,IAAM8E,EAAU5B,KACRwC,EAAY1F,EAFS,QAG7B,IAAK0F,EAAL,QACE,YAEF,IAAM7K,EAAM3I,YAAYwT,EAAxB,SACA,IAAK7K,EAAL,OACE,YAEF,IAAMoyH,EAAa/6H,YAAYwT,UAAgB7K,EAA/C,KAEA,OACE,yCAAqBmK,MAAM,YACzB,yBAAKE,MAAO,CAAEgE,MAAF,OAAiB3E,UAAjB,IAAiCC,SAAU,SACrD,wBAAOc,UAAWR,EAAQ2oE,OACxB,4BACE,4BACE,4BADF,UAEGw/C,EAAA,KAAe,SAAAh1G,GAAC,OACf,wBAAWlS,IAAKkS,GADD,QAKrB,4BACG/lB,OAAA,QAAewT,EAAf,cACC,mCAAEK,EAAF,KAAOnD,EAAP,YACEA,GACE,wBAAUmD,IAAKA,GACb,wBAAW+c,UAAX,KAA0BoqG,MAAM,OADlC,GAIGD,EAAA,KAAe,SAAAh1G,GAAC,OACf,wBAAW3S,UAAWR,EAAtB,UAAyCiB,IAAKkS,GAC3CrV,aAAuB7K,OAAO6K,EAFlB,gBAwDtBrJ,2BArCf,SAA+ByG,GAC7B,IAAM8E,EAAU5B,KACR9S,EAAU4P,EAFkB,MAG9BkH,EAAOV,WAAWA,eAAepW,EAAvC,cACoBmB,GAAS2V,EAJO,qCAoBpC,OACE,wBAAO5B,UAAWR,EAAlB,KAAgCyb,cAAY,uBAC1C,oCACE7a,QADF,EAEEgB,aAnBe,CACnBymH,MADmB,sDAEnBC,IAFmB,wEAInBC,GAJmB,8EAMnBC,IANmB,4EAQnBC,IARmB,8EAUnBC,KAVmB,oEAWnBC,OACE,qIAIF,IAME,uBANF,MAOE,oCAAgB/nH,QAASwB,GAR7B,QCrHWrH,GAAekO,8BAAoB,uBAAzC,IACMxN,GAAa,qCACO,CAC7BrQ,GAD6B,aAE7B6P,KAAMlR,gBAFuB,wBAG7BuY,YAAavY,qBAJS,SAMf,SAAA2B,GAAI,MAAK,CAChBmhD,eADgB,YAEdnhD,iBAEFohD,iBAJgB,WAKdphD,sB,sBCcek9H,G,WAYnB,WAAY90H,GAAiD,yBAVrD2M,aAUqD,OAPrD8rE,YAOqD,OALrDv4E,UAKqD,OAHrD60H,SAGqD,EAC3D10H,KAAKsM,QAAU3M,EAAK2M,QACpBtM,KAAKo4E,OAASz4E,EAAKy4E,OACnBp4E,KAAKH,KAAOG,KAAK20H,gBAAgB30H,KAAKsM,SACtCtM,KAAK00H,IAAM/0H,EAAK1I,G,gDAId4T,GACF,MAAc,YAAVA,EAA4B7K,KAAKsM,QAAQsoH,QACtC50H,KAAKsM,QAAQzB,IAAU7K,KAAKH,KAAKgL,K,kIAmBxC,MALU,GAAH,mBACF5R,OAAOC,KAAK8G,KAAKH,OADf,YAEF5G,OAAOC,KAAK8G,KAAKsM,UAFf,CAGL,c,2BAMF,OAAOtM,KAAK00H,M,sCAIEpoH,GACd,IAAM9V,EAAQ8V,EAAQ6nH,IAAM,EADa,EAEVn0H,KAAK60H,yBAClCvoH,EAAQ+nH,IACR/nH,EAAQgoH,KAJ+B,mBAElCQ,EAFkC,KAEzB3sH,EAFyB,KAMnC4sH,EACJzoH,EAAQgoH,KAAOhoH,EAAQgoH,IAAIlrG,MAAK,SAACpK,GAAD,MAAgC,UAANA,KACtDg2G,EACJ1oH,EAAQgoH,KACRhoH,EAAQgoH,IAAIlrG,MACV,SAACpK,GAAD,MACe,kBAANA,IAAsC,IAApBA,EAAEotD,QAAQ,QAgBzC,MAdiC,CAC/B/1E,QAASiW,EAAQ4nH,MACjB19H,QACAE,IACEs+H,GAAc1oH,EAAQk0E,KAAK3B,MAAQk2C,EAC/B/7E,OAAO1sC,EAAQk0E,KAAK3B,IAAI,IACxBroF,EAAQ8V,EAAQ+nH,IAAIp5H,OAC1BkN,cACArB,KAAMguH,EACNv5H,KAAM+Q,EAAQ8nH,GAAK9nH,EAAQ8nH,GAAG,QAAKr6H,EACnCmkB,QACE5R,EAAQ8nH,IAAM9nH,EAAQ8nH,GAAGn5H,OAAS,EAAIqR,EAAQ8nH,GAAGl0H,MAAM,QAAKnG,K,+CAUhEguB,EACAqzD,GAC2C,WAE3C,IAAKA,GAAOA,IAAQ,GAClB,MAAO,CAAC,SAAU,0BAGpB,IAAM65C,EAAuB,IAAIz3G,IAC7B/P,EAA4B,IAAI+P,IAYpC,GAXA49D,EAAIh1E,SAAQ,SAAArN,GAAK,MACa,EAAKm8H,yBAAyBntG,EAAKhvB,GADhD,mBACVo8H,EADU,KACFhtH,EADE,KAEf,IAAKgtH,EAAQ,OACc,EAAKC,2BAA2BrtG,EAAKhvB,GADnD,mBACTo8H,EADS,KACDhtH,EADC,KAGTgtH,GAAUhtH,IACZ8sH,EAAQx3G,IAAI03G,GACZ1nH,EAAagQ,IAAItV,OAIjBsF,EAAa/P,KAAO,EAAG,CACzB,IAAM23H,EAAwB,IAAI73G,IAClC/P,EAAarH,SAAQ,SAAAkvH,GACnB,IAAMC,EAAS,+BAA+Br3H,KAAKo3H,GAC/CC,GAAUA,EAAO,GAAIF,EAAS53G,IAAI83G,EAAO,IACxCF,EAAS53G,IAAI63G,MAEpB,IAAME,EAAsB,GAC3B,YAAIH,GAAUjvH,SAAQ,SAACmvH,GACtB,IAAME,EAAqB,GAC1B,YAAIhoH,GAAcrH,SAAQ,SAACkvH,GACtBA,EAAKzyH,WAAW0yH,IAClBE,EAAShuH,KAAK6tH,EAAKp1H,MAAMq1H,EAAOt6H,YAGpCu6H,EAAU/tH,KAAK8tH,EAASE,EAASlsH,KAAK,SAExCkE,EAAe,IAAI+P,IAAIg4G,GAEzB,OAAIP,EAAQv3H,KACH,CAAC,YAAIu3H,GAAS1rH,KAAK,KAAM,YAAIkE,GAAclE,KAAK,MAElD,MAACxP,OAAWA,K,+CAiBnBguB,EACAqzD,GAGA,GAAmB,kBAARA,EACT,MAAO,CACL,WACA,qEAIJ,GAAmB,kBAARA,IAAqBA,EAAIv4E,WAAW,KAC7C,MAAO,MAAC9I,OAAWA,GAGrBqhF,EAAMA,EAAI1hF,QAAQ,SAAU,IAG5B,IAAIy7H,EAASV,EAAWiB,aAAat6C,GAIrC,IAFK+5C,GAAUn1H,KAAKo4E,OAAO2yB,YAAY,MAAO3vB,KAC5C+5C,EAAS,oBACPA,EAIF,MAAO,CAACA,EAHYn1H,KAAKo4E,OAAO2yB,YAAY,MAAO3vB,EAAK,eAApC,UACbA,EADa,cACJp7E,KAAKo4E,OAAO2yB,YAAY,MAAO3vB,EAAK,gBAChDp7E,KAAK21H,uBAAuBR,EAAQptG,EAAKqzD,IAK/C,IAAMw6C,EAASx6C,EAAIpkC,MAAM,KACzB,OAAI4+E,EAAO36H,OAAS,EACX+E,KAAKk1H,yBACVntG,EADK,WAED6tG,EAAO11H,MAAM,EAAG01H,EAAO36H,OAAS,GAAGsO,KAAK,KAFvC,MAMF,MAACxP,OAAWA,K,iDAInBguB,EACAqzD,GAEA,MAAmB,kBAARA,EACF,CAAC,WAAYp7E,KAAK21H,uBAAuB,WAAY5tG,EAAKqzD,IAEhD,IAAfrzD,EAAI9sB,QAA+B,IAAfmgF,EAAIngF,OAGnB,CAAC,MAAO+E,KAAK21H,uBAAuB,MAAO5tG,EAAKqzD,IAErDrzD,EAAI9sB,SAAWmgF,EAAIngF,OACjB8sB,EAAIivB,MAAM,IAAIuf,UAAUhtD,KAAK,MAAQ6xE,EAChC,CAAC,YAAap7E,KAAK21H,uBAAuB,YAAa5tG,EAAKqzD,IAE5D,CACL,eACAp7E,KAAK21H,uBAAuB,eAAgB5tG,EAAKqzD,IAGnDrzD,EAAI9sB,QAAUmgF,EAAIngF,OACb,CAAC,YAAa+E,KAAK21H,uBAAuB,YAAa5tG,EAAKqzD,IAEjErzD,EAAI9sB,OAASmgF,EAAIngF,OACZ,CAAC,WAAY+E,KAAK21H,uBAAuB,WAAY5tG,EAAKqzD,IAE5D,CAAC,QAASp7E,KAAK21H,uBAAuB,QAAS5tG,EAAKqzD,M,6CAI3D+5C,EACAptG,EACAqzD,GAEA,gBAAU+5C,EAAV,YAAoBptG,EAApB,eAA8BqzD,K,+BAK9B,4CACEn9D,SAAUje,KAAK00H,KACZ10H,KAAKH,MACLG,KAAKsM,SAHV,IAIEupH,QAAS71H,KAAKsM,QAAQsoH,c,KArOPH,GAkIZiB,aAAsD,CAC3DI,IAAK,WACLC,IAAK,YACLC,IAAK,cACLC,IAAK,YACLC,OAAQ,uBACRC,IAAK,wBACLC,IAAK,gBACL,aAAc,qBACdC,QAAS,mBACT,IAAK,oB,yDC7IP,WAAmBhxH,GAAyC,2BAC1D,cAAMA,IAREixH,SAOkD,IALlDnxH,gBAKkD,IAFlDizE,YAEkD,EAE1D,IAAM5gE,EAAgBhS,yBAAeH,EAAQ,iBACvCrG,EAAWwG,yBAAeH,EAAQ,CAAC,QAAS,aAC5C6R,EAAY1R,yBAAeH,EAAQ,CAAC,QAAS,cAJO,OAM1D,EAAKF,WAAajG,wBAAasY,GAC/B,EAAK8+G,IAAM,IAAIp9C,oBAAiB,CAC9B/zE,WAAY,EAAKA,WACjByjE,cACgB,QAAd1xD,EACIhY,wBAAaF,QACbjF,EACNo/E,cACgB,QAAdjiE,EACIhY,wBAAaF,QACbjF,EACNq/E,eAAgB,GAAK,KAAL,IAAK,EAAK,MAG5B,EAAKhB,OAAS,EAAKk+C,IAChBhlF,YACAgnC,MAAK,SAACrhD,GAAD,OAAoB,IAAIs/F,KAAU,CAAEt/F,cAtBc,E,6LAyBnC56B,E,+BAAoB,G,kBACpC2D,KAAKs2H,IAAIj9C,0BAA0Bh9E,I,wQAIrB2D,KAAKs2H,IAAIhlF,Y,cAAxBra,E,yBACCA,EACJ+f,MAAM,MACNlpC,QAAO,SAAA0rE,GAAI,OAAIA,EAAK32E,WAAW,SAC/B1B,KAAI,SAAAq4E,GACH,IAAM/vE,EAAM+vE,EAAKt5E,MAAM,GACjBgT,EAAQzJ,EAAI2iE,QAAQ,KAFf,EAGS,CAAC3iE,EAAIvJ,MAAM,EAAGgT,GAAQzJ,EAAIvJ,MAAMgT,EAAQ,IAC5D,MAAO,CAAE5J,IAJE,KAIGzJ,KAJH,U,0QASMG,KAAKo4E,O,cAApBA,E,yBACCA,EAAO2yB,e,wIAGG3yC,GAAiD,WAAxB/7D,EAAwB,uDAAJ,GAC9D,OAAOgE,aAAgB,uCAAU,WAAMC,GAAN,eAAAvH,EAAA,sEACV,EAAKq/E,OADK,cACzBA,EADyB,gBAEzB,EAAKk+C,IAAIh9C,SAASlhB,EAAM/hE,QAAS+hE,EAAM5hE,MAAO4hE,EAAM1hE,IAAK,CAC7D6iF,aAAc,SAACC,EAAcC,GAC3B,IAAMntE,EAAU8rE,EAAOK,UAAUe,GAE3B/sE,EAAU,IAAI+pH,GAAW,CAC7BlqH,UACA8rE,SACAnhF,GAAI,GAAF,OAAK,EAAKA,GAAV,gBAAoBwiF,KAExBn5E,EAASgG,KAAKmG,IAEhBpO,OAAQhC,EAAKgC,SAbgB,OAe/BiC,EAASS,WAfsB,2CAAV,sDAgBpB1E,EAAKgC,U,mDAkBR2C,GAEA,WADA3E,EACA,uDADoB,GAIdo6H,EAAoC,4EAC1C,OAAOp2H,aAAgB,uCAAU,WAAOC,GAAP,mBAAAvH,EAAA,sEACX,EAAK29H,gBAAgB11H,GADV,cACzBk3C,EADyB,gBAEZ,EAAK/yC,WAAW9B,OAFJ,OAEzBA,EAFyB,QAG3BszH,EAAMjyH,KAAK2O,MAAO6kC,EAAQ70C,EAAK3F,KAAQ,MACjC,MAERi5H,EAAM,KAEJA,EAAM,IACRz6H,QAAQ4H,KAAR,gDAC2C6yH,EAD3C,gEAIFF,EACGv8H,KAAK,EAAM8G,EAAS3E,GACpByE,UAAUR,GAfkB,4CAAV,yD,+EAyBKU,G,gGACDgyB,QAAQ4hB,IACjC5zC,EAAQG,KAAI,SAAAf,GAAM,OAEhB,EAAKk2H,IAAIpjH,MAAM0jH,eAAex2H,EAAO/J,QAAS+J,EAAO5J,MAAO4J,EAAO1J,S,cAHjEmgI,E,OAiBAC,EAA0B,GAChCD,EAAazwH,SAAQ,SAAC0I,GACpBA,EAAO1I,SAAQ,SAAA2I,GACb,IAAMvY,EAAQuY,EAAMgoH,KAAKC,cACnBtgI,EAAMqY,EAAMkoH,KAAKD,cAAgB,KAEpCF,EAAW94H,MAAK,SAAAnB,GACf,OAAIA,EAAMrG,OAASE,GAAOmG,EAAMnG,KAAOF,IACrCqG,EAAMrG,MAAQkO,KAAKC,IAAI9H,EAAMrG,MAAOA,GACpCqG,EAAMnG,IAAMgO,KAAKuM,IAAIpU,EAAMnG,IAAKA,IACzB,OAKXogI,EAAWrvH,KAAK,CAAEjR,QAAOE,c,kBAKxBogI,EAAWznH,QAAO,SAACtW,EAAGC,GAAJ,OAAUD,EAAIC,EAAEtC,IAAMsC,EAAExC,MAAQ,IAAG,I,gJA/JnCkJ,2BClBdoV,iCACb,kBACA,CACE0C,cAAe,CACb1Q,KAAM,eACNiO,aAAc,CAAEhd,IAAK,uBAEvBmb,MAAO4B,8BAAoB,WAAY,CACrCoC,UAAW,CACT/f,MAAOvB,QAAMo/D,YAAY,YAAa,CAAC,MAAO,QAC9CluD,KAAM,aACNiO,aAAc,OAEhB/V,SAAU,CACR8H,KAAM,eACNiO,aAAc,CAAEhd,IAAK,8BAI3B,CAAEid,iBAAiB,ICMAkiH,G,4MACnB37H,KAAO,iB,sDAECyN,GACNA,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAY,CACd5L,KAAM,kBACNqL,aAAcuwH,GACd/vH,aAAcgwH,QAIpBpuH,EAAc06D,iBAAgB,kBAC5B16D,EAAc+qC,UAAUsjF,OAE1BruH,EAAc0xD,cAAa,WACzB,IAAM9zD,EAAekO,8BACnB,eACA,GACA,CAAEstC,kBAAmBhlC,GAAsBpU,KAE7C,OAAO,IAAI3B,EAAU,CACnB9L,KAAM,eACNqL,eACAU,WAAYyS,GACV/Q,EACA,eACApC,QAKNoC,EAAcusC,gBAAe,kBAC3BvsC,EAAc+qC,UAAU0+E,OAG1BzpH,EAAcusC,gBAAe,WAC3B,IAAM3uC,EC7DL,SACLoC,GAEA,IAAM+jE,EAA6B/jE,EAAc2Q,gBAC/C,kBACA/S,aACIomE,EAAiChkE,EAAc2Q,gBACnD,sBACA/S,aAEF,OAAOkO,8BACL,uBACA,CACEkuD,iBAAkB,CAChBl8D,KAAM,aACN3P,MAAOvB,QAAMo/D,YAAY,YAAa,CAAC,SAAU,QACjDjgD,aAAc,OAGhBkuD,UAAWnuD,8BAAoB,yBAA0B,CACvDq4D,eAAgBJ,EAChBK,mBAAoBJ,KAGxB,CAAE5qB,kBAAmBxJ,GAA+B5jC,iBAAiB,IDqC9CsiH,CACnBtuH,GAEF,OAAO,IAAItB,EAAY,CACrBnM,KAAM,uBACNqL,eACAU,WAAYiwH,GAAiC3wH,GAC7Ce,UAAW,eACXC,SAAU,mBACVjB,eAAgB8zD,QAIpBzxD,EAAcgyD,eACZ,kBACE,IAAIlzD,EAAW,CACbvM,KAAM,uBACNwM,QAAS,kBACTnB,aAAc4wH,GACdlwH,WAAYmwH,GACZ9wH,eAAgB+wH,Y,GA1DkB/0F,I,sBE5B7B,YAAA35B,GAAiB,IACtB+qC,EAAc/qC,EADQ,UAEtB1I,EAAayzC,EAFS,uBAGxB9sC,EAAQ8sC,EAAd,SACQrvB,EAAwBzd,EAJF,SAIZ8d,EAAc9d,EAJF,UAKtB0wH,EAAiB5jF,EALK,iCAMtBvuC,EAAmBuuC,EANG,8CAOtB7pC,EAAe6pC,EAPO,uCAQxB6jF,EAAO7jF,EAAb,0BACM8jF,EAAc9jF,EAApB,iCACM+jF,EAAc/jF,EAApB,iCACMgkF,EAAYhkF,EAAlB,+BACMikF,EAAYjkF,EAAlB,+BACMkkF,EAAmBlkF,EAAzB,sCACMmkF,EAAWnkF,EAAjB,8BACMokF,EAAapkF,EAAnB,gCACMqkF,EAAQrkF,EAAd,2BACM2uC,EAAY3uC,EAAlB,+BACM0uC,EAAS1uC,EAAf,4BACM4uC,EAAO5uC,EAAb,0BACMskF,EAAatkF,EAAnB,gCACM8uC,EAAY9uC,EAAlB,+BACM6uC,EAAW7uC,EAAjB,8BACMukF,EAASvkF,EAAf,4BAEM9pC,EAAYC,GAAW,SAAAC,GAC3B,MAAO,CACL6X,KAAM,CACJ5d,SADI,WAEJiG,QAASF,UAFL,GAGJO,WAAY,SAEd6tH,UAAW,CACTtoH,MADS,MAETuQ,OAAQ,CAAC,CAACrW,UAAD,GAFA,SAGTsB,OAAQ,CAAC,CAAC,MAAO,QAAStB,gBAAlB,QAEVquH,gBAAiB,CAAEtsH,UAAW/B,kBAI5BgkF,EAAe7tF,GACnB,YAAyD,IAAtDnJ,EAAsD,EAAtDA,MAAOywB,EAA+C,EAA/CA,SAAU6wG,EAAqC,EAArCA,cAAeC,EAAsB,EAAtBA,gBAAsB,EACjCh0G,EAASvtB,EADwB,uBAChD0W,EADgD,KAC3CugF,EAD2C,KASvD,OAPArpE,GAAU,WACR,IAAMspE,EAAMlwF,SAAS0P,EAArB,IACKmrC,aAAL,KACMq1C,EAAJ,EAAal3F,KAAb,GACKi3F,QAEN,CAACj3F,EAAOuhI,EANX3zG,IAQE,mBACEpb,MADF,EAEEie,SAFF,EAGE9gB,KAHF,SAIEymB,SAAU,SAAA+/D,GAAG,OAAIc,EAAOd,SAAX,QACbrhF,MAAO,CAAEgE,MAAF,OAAiBy9C,cAAe,iBAKzCuF,EAAa3yD,GAAS,YAAe,IAAZnJ,EAAY,EAAZA,MACvB0U,EAAU5B,IACV0uH,EACJxhI,oBADF,QAC8BA,WAG5B+7D,EAQE/7D,EAdqC,oBAOvCg8D,EAOEh8D,EAdqC,uBAQvCyhI,EAMEzhI,EAdqC,SASvC0hI,EAKE1hI,EAdqC,UAUvC2hI,EAIE3hI,EAdqC,YAWvC4hI,EAGE5hI,EAdqC,kBAYvC6hI,EAEE7hI,EAdqC,wBAavC8hI,EACE9hI,EAdqC,gBAgBzC,OACE,uBACE,mBACE8U,MAAO,CAAEgE,MAAF,QAAkBuQ,OAAQ,UACjCyQ,WAFF,EAGE3mB,QAHF,EAIEic,UAJF,SAKE2K,WAAW,cAEX,mBAAMC,MAAI,GACR,mBAAatH,UAAU,YACrB,mBAAWA,UAAU,UADvB,gBAEE,uBACE,mBACE7qB,SAAU7H,EADZ,WAEEw6B,YAAax6B,EAFf,cAGEu5B,kBAAgB,OAKxB,mBAAMS,MAAI,GACR,mBAAatH,UAAb,WAAkCxd,UAAWR,EAAQg+F,aACnD,mBAAWhgF,UAAU,UADvB,aAEE,mBAAYjG,aAAZ,YAAmCroB,KAAnC,OAA+CoO,MAAOivH,GACpD,mBAAM3nG,WAAN,EAAgB3mB,QAAhB,EAA4Bic,UAAU,OACnCsyG,EAAA,KAAc,SAAAK,GACb,OACE,mBAAM/nG,MAAN,EAAWrkB,IAAKosH,GACd,mBACEl8G,QAAS47G,IADX,EAEEjvH,MAFF,EAGEoT,QAAS,kBAAM+7G,EAAN,IACTtqC,QAAS,kBAJX,MAKE71F,MAAOugI,YAStBP,EACC,mBAAMxnG,MAAI,GACR,mBAAatH,UAAb,WAAkCxd,UAAWR,EAAQg+F,aACnD,mBAAWhgF,UAAU,UADvB,gBAEE,2BACE,mBACEjC,UADF,EAEEjvB,MAFF,2BAGEwgI,eAHF,MAIE3qC,QACE,mBACExxE,QADF,EAEED,QAASi8G,MAIf,mBACE7hI,MADF,EAEEywB,UAAW+wG,IAFb,EAGEF,cAHF,uBAIEC,gBAAgB,+BA7D5B,KAmEE,mBAAMvnG,MAAI,GACR,mBAAaS,WAAS,GACpB,mBAAW/H,UAAU,UADvB,4BAEE,mBACElgB,MADF,EAEE4jB,SAAU,SAAA+/D,GAAG,OAAIn6B,EAAuBm6B,SAA3B,SAEZ2rC,EAAA,KAAoB,cACnB,IAAM19H,EAAOiK,EAAeg5C,EAA5B,QACA,OACE,mBAAU1xC,IAAV,EAAqBnD,MAAOyJ,GAD9B,SASR,mBAAM+d,MAAN,EAAW9kB,UAAWR,EAAQ2sH,iBAC3BrhI,YACC,mBACEmV,QADF,YAEE9B,MAFF,UAGEuS,QAAS5lB,EAHX,aAIEywB,UAAWzwB,EAAMiiI,WALpBjiI,UADH,SAWE,mBACEywB,UAAWzwB,EADb,cAEEmV,QAFF,YAGE9B,MAHF,UAIEuS,QAAS5lB,EAAMkiI,QAtGzB,cAgHIC,EAAeh5H,GAAS,YAAsB,IAAnB48C,EAAmB,EAAnBA,aACzBrxC,EAAU5B,IAChB,OACE,mBAAMoC,UAAWR,EAAQ0sH,WACvB,uBACE,mBAAYjsH,QAAZ,KAAyB9B,MAAM,SAC5B1L,OAJT,SAyBF,OAdqBwB,GAAS,YAAe,IAAZnJ,EAAY,EAAZA,MACzB0U,EAAU5B,IAChB,OACE,gCACG9S,EAAA,MACC,mBAAWkV,UAAWR,EAAQ0tH,gBAC5B,mBAAcr8E,aAAY,UAAK/lD,EAAL,UAHhC,KAME,mBAAYA,MAAOA,S,uFC/MZ,YAAA6R,GAAiB,IACtB+qC,EAAc/qC,EADQ,UAEtB1I,EAAayzC,EAFS,uBAGxB9sC,EAAQ8sC,EAAd,SAEQ5Y,EAAY4Y,EALU,8BAMtB9oB,EAAS8oB,EANa,yBAqL9B,OA7KmBzzC,GACjB,YAAuE,IAApEg6C,EAAoE,EAApEA,UAAWk/E,EAAyD,EAAzDA,iBAAkBC,EAAuC,EAAvCA,kBAAmBC,EAAoB,EAApBA,cAC3CC,EAAkB,WACtBD,SAQF,IAAME,EAAeH,GAAqBA,EAA1C,UAEMI,EAAgB,SAAAC,GACpBN,iBAAgC,CAC9B,CACEI,aADF,EAEEE,iBASEC,EAAoBP,EAzByC,gBA4B/DQ,EAAuB,IAA7B,IACAD,WAAwB,SAAAE,GAAkB,IAChC/xH,EAA8B+xH,EADE,YACnBC,EAAiBD,EADE,aAExC,GACOD,MAAL,IACEA,QAAuC,CACrCG,YADqC,EAErCC,aAAc,KAGlBJ,+BAIAA,cAIJ,IAAMK,EACJZ,GAAqBD,aADvB,SAEMc,EAAgBD,GAAYA,EAAb,MAArB,GACME,EACHd,GACCD,sBADF,aADF,GAKMgB,EAAqBpzG,QACzBoyG,yBAEEA,EAAA,kBACE,SAAAiB,GAAG,OACDA,iBAAqBhB,EAArBgB,YACCA,EAFA,eAKHC,EAAsBtzG,QAC1BoyG,yBAEEA,EAAA,kBACE,SAAAiB,GAAG,OACDA,iBAAqBhB,EAArBgB,WACAA,EAFC,eAKT,aACEd,IACAH,qBAGF,IAAM7+G,EAAY,CAEhB,CACEhiB,MADF,iBAEEskB,KAFF,KAGEnW,KAHF,QAIEkW,QAJF,EAKED,QAASy9G,EAAkB,EAEvBX,iBAEN,CACElhI,MADF,kBAEEskB,KAFF,KAGEnW,KAHF,QAIEkW,QAJF,EAKED,QAAS29G,EAAmB,EAExBb,iBAGN,CACElhI,MAAO,SAAF,OADP,GAEEskB,KAFF,KAGE6N,QAASqQ,EACP6+F,EADc,WAEd,YAA2B,uBAAzB9xH,EAAyB,KAAZ7B,EAAY,KACjB+zH,EAA2B/zH,EADV,aACHusC,EAAavsC,EADV,SAEzB,KAAc,CACZ,IAAMs0H,EAAY,CAChBhiI,MAAOuP,GADS,EAEhB6U,QAAS,WACPy8G,uBAMJ,OAHIc,IAAJ,IACEK,aAEF,EAEF,SACS,CACLhiI,MADK,EAELskB,KAAMm9G,EAAA,MAAkB,SAAAv/H,GAAC,OAAIA,aAAJ,KAAnB,UAFD,EAKLiwB,QAASsvG,EAAA,KACP,gBACYQ,EADZ,iBAGO,CACLjiI,MAJF,cAKEskB,KACE29G,gBAHG,EAIL79G,QAAS,WACPy8G,2BASV,QAxCK,kBAwDb,OARIa,GAAYA,EAAhB,WACE1/G,OAAe,CACbhiB,MADa,gBAEbskB,KAFa,KAGbF,QApIoB,WACtBu9B,0CAmIWugF,gBAKX,mBACEjyG,SAAU6wG,GAAqBA,EADjC,SAEEpzG,KAAMe,QAFR,GAGEsB,gBA5JJ,cACE1uB,IACA2/H,KA2JEhxG,QAJF,EAKEhO,UALF,EAMEiR,aAAc,CACZrH,SADY,SAEZsH,WAAY,eCxKT,YAAC7iB,GAAiC,IACvC6qC,EAAQ7qC,EAAR6qC,IACAvzC,EAAauzC,EAAI,cAAjBvzC,SACF2G,EAAQ4sC,EAAI1G,MAgDlB,OA9CgB7sC,GAAS,YAA4C,MAAzCg6C,EAAyC,EAAzCA,UAAWk/E,EAA8B,EAA9BA,iBAC/BsB,EAAiBtB,EAAiBuB,gBAChCC,EAAuBxB,EAAvBwB,mBAEFC,EAAe,WACnBD,EAAmB,OAGfE,EAAS,UAAG1B,EAAiBuB,uBAApB,aAAG,EAAkCG,UACpD,QAAkBnhI,IAAdmhI,EAAyB,OAAO,KAEpC,IAAMt7F,EAAM45F,EAAiB2B,OAAOngC,KAAKkgC,EAAY,GAQrD,IAAMvgH,EAAwB2/B,EAAU8gF,aAAaj6H,KAAI,SAAAgwB,GACvD,GAA6B,oBAAlBA,EAAKvJ,SAAyB,CACvC,IAAMA,EAAWuJ,EAAKvJ,SACpB0yB,EACAk/E,EACA0B,EACAt7F,GAEF,kCAAYzO,GAAZ,IAAkBvJ,aAEpB,OAAOuJ,KAGT,OACE,gBAAC,GAAD,CACEvI,SAAUkyG,GAAkBA,EAAelyG,SAC3CvC,KAAMe,QAAQ0zG,GACdpyG,gBAvBJ,SAA6BoD,EAAiB9xB,GAC5CA,EAASsgD,EAAWk/E,EAAkB0B,EAAWt7F,GACjDq7F,KAsBEtyG,QAASsyG,EACTtgH,UAAWA,EACXiR,aAAc,CACZrH,SAAU,SACVsH,WAAY,eClCP,gBAAA7iB,GAAiB,IACtB+qC,EAAc/qC,EADQ,YAEiB+qC,EAFjB,cAEtBzzC,EAFsB,WAGxB2G,GAHwB,YAGhB8sC,EAAd,UACQrvB,EAAazd,EAJS,SAMtBgP,GADe89B,EAAvB,cACsBA,EANQ,8BAQtB7pC,EAAe6pC,EARO,yCASLA,EATK,4BAStBnpC,EATsB,OAShBy7B,EATgB,SAUxB6xF,EAAWnkF,EAAjB,8BACMkqC,EAAalqC,EAAnB,gCACMna,EAAUma,EAAhB,6BACMkkF,EAAmBlkF,EAAzB,sCAEMsnF,EAAatnF,EAAnB,IACMunF,EAAUvnF,EAAhB,IAEM9pC,EAAYC,GAAW,SAAAC,GAC3B,MAAO,CACL6X,KAAM,CACJ5d,SADI,WAEJq7E,aAAct1E,UAFV,GAGJO,WAAYE,EAHR,KAIJW,SAAU,QAEZgwH,UAAW,CACTC,eADS,WAETC,cAFS,EAGT/vH,UAHS,aAIT,OAAQ,CACND,OAAQ,aAAF,OAAeb,EADf,MAENP,QAFM,SAGNY,SAHM,OAINM,SAJM,SAKNmwH,aAAc,aAGlBC,cAAe,CACbjxH,WAAY,SAEdkxH,WAAY,CACVlxH,WAAYE,EADF,KAEVupB,UAFU,OAGV1oB,OAAQ,aAAF,OAAeb,EAHX,MAIVxG,SAJU,WAKViG,QALU,YAMV2hB,WANU,SAOV6vG,WAAY,QAEdX,UAAW,CACTjhF,WADS,SAETzyC,QAFS,eAGTqoF,KAHS,OAITrmE,aAJS,OAKThJ,OALS,EAMTwL,WAAY,UAEd8vG,cAAe,CACbzxH,QADa,EAEbmW,OAFa,EAGbpc,SAHa,WAIbsjB,MAJa,EAKblgB,QALa,eAMbwkB,WANa,SAOb6jE,KAAM,QAERksC,kBAhDK,GAiDLC,YAAa,CACX53H,SADW,WAEX+hB,IAFW,OAGX3F,OAHW,EAIXnW,QAAS,YAEX4xH,WAAY,CACVhiF,WADU,SAEVvvC,WAAYE,EAFF,KAGVa,OAAQ,aAAF,OAAeb,EAHX,MAIVxG,SAJU,SAKV+hB,IALU,OAMVJ,OANU,EAOViG,WAPU,SAQV3hB,QAAS,CAAC,CAAC,EAAGF,UAAL,MAEX+xH,cAAe,CACb93H,SADa,WAEb+hB,IAFa,SAGb7E,SAAU,QAEZ66G,sBAAuB,CACrB30H,QADqB,OAErBpD,SAFqB,WAGrBsjB,MAHqB,EAIrBvB,IAJqB,EAKrBzb,WAAYE,EALS,KAMrBqZ,OANqB,OAOrBvY,UAPqB,aAQrBykF,WAAY,aAAF,OAAevlF,EAAf,OAEZwxH,aAAc,CACZ/xH,QAAS,GAEXgyH,cAAe,CACb3xH,WAAYE,EADC,KAEbxG,SAFa,SAGb+hB,IAHa,OAIbJ,OAJa,EAKb/a,SAAUb,UALG,GAMbgqB,UAAW,QAEbmoG,gBAAiB,CACf5xH,WAAY27B,EADG,KAEf,OAAQ,CACN37B,WAAY27B,EAAO,OAGvBk2F,aAAc,CAAEC,YAAa,cAI3BC,EAAWn8H,GAAS,YAA8C,IAA3Co8H,EAA2C,EAA3CA,KAAMlD,EAAqC,EAArCA,iBAAkBI,EAAmB,EAAnBA,aAC3CS,EAAab,cADiD,YAEtE,OAAIa,EAAJ,uBAEI,gBAACA,EAAD,wBACEqC,KADF,EAEErC,SAFF,EAGET,aAHF,EAIE+C,YAAanD,IAKZkD,EAAP,QAGIE,EAAUt8H,GAAS,YAA+C,IAA5Cu8H,EAA4C,EAA5CA,SAAU3B,EAAkC,EAAlCA,UAAW1B,EAAuB,EAAvBA,iBACzC3tH,EAAU5B,IACR6yH,EAAyCtD,EAFqB,iBAE5CuD,EAAuBvD,EAFqB,mBAGlEwD,EAAWnxH,EAAf,QAGA,cACEgxH,iBACAvvC,oBACAA,mBAYF,OAjBIuvC,EAAJ,aAAyBG,GAAY,IAAJ,OAAQnxH,EAAhBmxH,kBAkBvB,sBAAI3wH,UAAW2wH,GACb,sBAAI3wH,UAAWR,EAAf,WAAmCkR,QAASkgH,GAC1C,mBACE5wH,UAAWR,EADb,UAEE2iF,QACEsuC,EAAmB,KACjB,mBACEzwH,UAAWR,EADb,YAEEmR,QAAS6/G,EAFX,WAGE9/G,QAASkgH,IAIftkI,MAAOkkI,EAAS5lI,KAElB,mBACEoV,UAAWR,EADb,cAEEkR,QA3BR,YACEy8G,qBAAoC,CAClC5wG,SAAU3D,EADwB,cAElCi2G,cAEFj2G,mBACAA,qBAsBMza,MAAM,aAEN,sBAAe6B,UAAWR,EAAQkwH,sBAGrCgB,EAAA,KAAuB,SAAAG,GAAS,OAC/B,sBAAIpwH,IAAKowH,GACNL,EAAA,0BACC,mBACEH,KAAMG,mBADR,GAEErD,iBAFF,EAGEI,aAAcsD,IANW,aAevC,cAAgD,IAAvB/lI,EAAuB,EAAvBA,MAAOyiI,EAAgB,EAAhBA,aACxB/tH,EAAU5B,IACVkzH,EAAWhmI,EAAA,kBACf,SAAAmnB,GAAC,OAAIA,iBAAJ,KAGH,SACyB6+G,EADX,WAGV,sBAAqB9wH,UAAWR,EAAQqwH,gBAExC,sBAAuB7vH,UAAWR,EAAQqwH,gBAG9C,KAGF,IAAMkB,EAAgB98H,GACpB,YAAmD,IAAhD06F,EAAgD,EAAhDA,KAAMw+B,EAA0C,EAA1CA,iBAAkBjI,EAAwB,EAAxBA,KAAM8L,EAAkB,EAAlBA,YACzBxxH,EAAU5B,IAChB,OACE,yBAAOoC,UAAWR,EAAQ8vH,eACvB3gC,EAAA,MAAWqiC,EAAX,EAA+BA,GAAe9L,EAA9C,SAA6D,SAAA3xF,GAAG,OAC/D,mBACE9yB,IAAK8yB,EADP,GAEEs7F,UAAWt7F,EAFb,GAGE45F,iBAHF,EAIEqD,SAAUj9F,WAQhB09F,EAAYh9H,GAAS,YAAkC,IAA/BnJ,EAA+B,EAA/BA,MAAOo6H,EAAwB,EAAxBA,KAAM8L,EAAkB,EAAlBA,YACjCN,EAAwD5lI,EADL,mBAC/BomI,EAAoCpmI,EADL,QACtBqmI,EAA2BrmI,EADL,eACNgkI,EAAWhkI,EADL,OAErD0U,EAAU5B,IAF2C,EAKhBya,EALgB,yBAKpD+0G,EALoD,KAKjCC,EALiC,KAM3D,gBACEA,EAAc,CACZwD,UADY,EAEZt0G,SAAU0kE,EAAInjE,gBATyC,MAcVzF,EAdU,yBAcpD+4G,EAdoD,KAc9BC,EAd8B,KAe3D,WAA+BR,GAC7BQ,KAEF,aACEA,QAGF,IAAMC,EAAYxC,EAAlB,MACMngC,EAAOmgC,EAAb,mBAEA,OACE,gCACE,mBACE7gF,UAAWrkC,EADb,GAEEujH,iBAFF,EAGEC,kBAHF,EAIEC,cAAeA,IAEjB,mBAASp/E,UAAWrkC,EAApB,GAAsCujH,iBAAkBriI,IACxD,yBAAOkV,UAAWR,EAAQ0vH,WACxB,6BACE,0BACE,sBAAIlvH,UAAWR,EAAQwwH,eACrB,mBAAStwH,MAAT,eAA8B4B,UAAU,SACtC,4BACE,mBACEtB,UAAWR,EADb,kBAEEkR,QAAS5lB,EAFX,YAGEywB,UAAWzwB,SAHb,cAIEqT,MAAM,aAEN,sBAAc6B,UAAWR,EAAQ+xH,uBAKxCb,EAAA,KAAuB,SAAAG,GAAS,OAC/B,sBACE7wH,UAAWR,EADb,WAEEiB,IAFF,EAGE2nB,YAAaopG,YAHf,GAIEnpG,WAAYopG,gBAEZ,mBAAe3mI,MAAf,EAA6ByiI,aAAcsD,IACzCM,GAAkBD,SAAnB,MAlTZ,SAAsBlvC,GAC3B,cACE,OAAOvvF,oBAAoB4U,EAA3B,IAEF,GAAI26E,GAAJ,EAAc,CACZ,GAAIA,EAAJ,GACE,OAAO0vC,EAAP,GAEF,GAAI1vC,EAAM,IACR,OAAO0vC,EAAUr5H,WAAW2pF,KAArB0vC,IAAsCA,EAAU1vC,EAAvD,IAIJ,MAAM,IAAI2vC,WAAV,8BAsSkBC,CARJ,GASE,uBACE5xH,UAAWR,EADb,sBAEEI,MAAO,CACLzE,QACEi2H,OACChE,GACCA,cAFFgE,UAII,SAGR,mBACEpxH,UAAWR,EADb,aAEEkR,QAASmhH,YAFX,GAGE1zH,MAAM,aAEN,sBAAe6B,UAAWR,EAAQ+xH,2BAO9C,mBACE5iC,KADF,EAEEw+B,iBAFF,EAGEjI,KAHF,EAIE8L,YAAaA,IAEbriC,EAAD,OAjEP,KAkEQ,2BAAS3uF,UAAWR,EAAQ0wH,cACzBoB,EAAY,yBAFhB,wBAUT,cAA2D,IAApCxmI,EAAoC,EAApCA,MAAO8sB,EAA6B,EAA7BA,OAAQstG,EAAqB,EAArBA,KAAM8L,EAAe,EAAfA,YACpCxxH,EAAU5B,IAEhB,OACE,uBAAKoC,UAAWR,EAAhB,KAA8BI,MAAO,CAAEgY,WACpC9sB,GAASA,EAAT,QAAyBA,SAAzB,UAAkDA,EAAlD,YACC,mBAAWA,MAAX,EAAyBo6H,KAAzB,EAAqC8L,YAAaA,IAElD,2BALN,eAiBF,OAHAc,eAA2B,CACzBhnI,WAAO4C,GAEFuG,EAAP,ICpXa,YAAA0I,GAAiB,IACtB+qC,EAAc/qC,EADQ,UAEtB1I,EAAayzC,EAFS,uBAGxB9sC,EAAQ8sC,EAAd,SACQhvB,EAAwB9d,EAJF,UAIXyd,EAAazd,EAJF,SAKtBiD,EAAe6pC,EALO,uCAMxBkqC,EAAalqC,EAAnB,gCACMqqF,EAAiBrqF,EAAvB,oCACQg4C,EAAgBh4C,EARM,kCASxB8uC,EAAY9uC,EAAlB,+BAEM9pC,EAAYC,GAAW,WAC3B,MAAO,CACLm0H,8BAA+B,CAAEjzH,YAAa,aAI5CkzH,EAAah+H,GAAS,YAAoB,IAAjBi+H,EAAiB,EAAjBA,WACvB1yH,EAAU5B,IAD8B,EAGAya,EAC5C65G,EAJ4C,iCAGvCC,EAHuC,KAGtBC,EAHsB,KAMxCC,EAAsB3yC,EAAYyyC,EAAxC,KAKA,OAJAz5G,GAAU,WACRw5G,iBACC,CAACG,EAFJ35G,IAKE,uBAAK1Y,UAAWR,EAAQy+F,gBACtB,mBACE3xG,MADF,cAEEgR,MAFF,EAGE4jB,SAAU,SAAA+/D,GAAG,OAAImxC,EAAmBnxC,SAAvB,QACbjhF,UAAWR,EAJb,kBAKES,QALF,WAMEg4C,WAAY,CACVmI,eACE,mBACEpgD,UAAWR,EADb,gCAEEzH,SAAS,SAET,qBANM,OASVogD,aACE,mBACEn4C,UAAWR,EADb,8BAEEzH,SAAS,OAET,mBACEwf,aADF,eAEE7G,QAAS,kBAAM0hH,EAAN,KACTj0H,MAAM,aAEN,qBATJ,eAyBZ,OANuBlK,GAAS,YAAe,IAEvCi+H,EAFuC,EAAZpnI,MAEdA,eAAnB,YACA,OAAO,mBAAYonI,WAAYA,QCpEpB,YAAAv1H,GAAiB,IACtB+qC,EAAc/qC,EADQ,YAEiB+qC,EAFjB,cAEtBzzC,EAFsB,WAGtB2V,GAHsB,YAGR89B,EAHQ,8BAIxB9sC,EAAQ8sC,EAAd,SAEQ7pC,EAAe6pC,EANO,uCAQxB4uC,EAAO5uC,EAAb,0BACMkqC,EAAalqC,EAAnB,gCACMskF,EAAatkF,EAAnB,gCAEM9pC,EAAYC,GAAW,SAAAC,GAC3B,MAAO,CACLw0H,WAAY,CAAEjxE,cAAF,SAA2BlkC,aAAc,SACrDo1G,aAAc,CACZrzH,SADY,SAEZygB,WAFY,SAGZtgB,UAHY,aAIZuE,MAJY,OAKZ7L,SAAU,YAEZy6H,WAAY,CAAEz6H,SAAF,WAAwB+hB,IAAK,QACzC24G,aAAc,CACZp0H,WAAYP,mBADA,KAEZK,MAFY,QAGZH,QAAS,CAAC,CAAC,EAAGF,UAAL,YAKf,cAA2C,IAAf40H,EAAe,EAAfA,YAC1B,SACS,gBAACA,EAAD,gBAA4BA,YAAaA,IAElD,KAgDF,OA1C6Bz+H,GAC3B,YAAsD,IAAnDg6C,EAAmD,EAAnDA,UAAWykF,EAAwC,EAAxCA,YAAanF,EAA2B,EAA3BA,aAAc31G,EAAa,EAAbA,OACjCpY,EAAU5B,IAOV+0H,EAAmB1kF,sBAAzB,GACA,MACE,MAAM,IAAIr9C,MAAV,0DAGF,OACE,mBACEg0B,WADF,EAEE1K,UAFF,MAGEla,UAAWR,EAHb,aAIEI,MAAO,CAAEgY,WAET,mBAAMkN,MAAN,EAAW9kB,UAAWR,EAAQizH,cAC5B,sBAAYzyH,UAAWR,EAAQgzH,cAEjC,mBAAM1tG,MAAI,GACR,mBACEpU,QAtBa,WACI9G,EAAU8oH,EAAjC,GACAz0B,uBAqBMv+F,MAFF,gBAGEvB,MAAM,aAEN,qBANJ,OAQE,mBAAY6B,UAAWR,EAAvB,WAA2Cge,UAAU,QAClDm1G,EATL,UAWE,mBAAkBD,YAAaA,UCzE5B,YAAA/1H,GAAiB,IACtB+qC,EAAc/qC,EADQ,YAEE+qC,EAFF,cAEtBzzC,EAFsB,WAGxB2G,GAHwB,YAGhB8sC,EAAd,UACMkqC,EAAalqC,EAAnB,gCAJ8B,EAKSA,EALT,qBAKtBgkF,EALsB,YAKXkH,EALW,kBAMtB/0H,EAAe6pC,EANO,uCAOxB4uC,EAAO5uC,EAAb,0BACQ1vB,EAAiB0vB,EARK,iCAUxBmrF,EAAenrF,EAArB,IACMoqF,EAAcpqF,EAApB,IACMorF,EAAuBprF,EAA7B,IACMqrF,EAAuBrrF,EAA7B,IAMM9pC,EAAYC,GAAW,SAAAC,GAAK,MAAK,CACrC6X,KAAM,CACJ5d,SADI,WAEJq7E,aAAct1E,UAFV,GAGJO,WAHI,QAIJa,SAAU,UAEZ0rB,OAAQ,CACN1rB,SADM,SAENygB,WAFM,SAGNtgB,UAHM,aAINuY,OAfJ,GAgBIrB,YAAazY,cAEfk1H,YAAa,CAAE9zH,SAAU,QACzBqzH,aAAc,CACZrzH,SADY,SAEZygB,WAFY,SAGZtgB,UAHY,aAIZuY,OAvBJ,GAwBIrB,YAAazY,cAEfm1H,aAAc,CACZ9+G,OAAQ,GAEV++G,SAAU,CACRvtG,WAAY7nB,cAEdq1H,UAAW,CACTp7H,SADS,WAETsG,WAAYP,qBAFH,MAGTqd,KAHS,EAITg8D,OAJS,EAKTv/D,OAnCJ,GAoCIhU,MANS,OAOTvE,UAPS,aAQT4lD,UARS,qBAST1uC,YAAazY,cAEfs1H,iBAAkB,CAChBj4H,QADgB,OAEhBshD,eAFgB,SAGhB+B,cAAe,UAEjBU,OAAQ,CACNtkC,SAAU,GAEZy4G,2BAA4B,CAAEt0H,YAAa,aAGvCu0H,EAAer/H,GAAS,YAAe,IAAZnJ,EAAY,EAAZA,MACzB0U,EAAU5B,IAChB,OACE,mBACEoC,UAAWR,EADb,aAEEolB,WAFF,EAGE3mB,QAHF,EAIEic,UAJF,MAKE2K,WAAW,UAEX,mBAAMC,MAAI,GACR,mBACEpU,QAAS,kBAAM5lB,EAAN,iBACTkV,UAAWR,EAFb,WAGEE,MAHF,sBAIEub,cAJF,wBAKE9c,MAAM,aAEN,qBAhBR,YAuBIo1H,EAAkBt/H,GAAS,YAAqB,IAAlBq8H,EAAkB,EAAlBA,YAClC,GAAIA,GAAeA,SAAnB,SAAgD,KAQ9C,EAR8C,EAM1CA,EAN0C,OAE5CkD,EAF4C,sBAG5CnuF,EAH4C,QAI5CouF,EAJ4C,gBAK5CC,EAL4C,iCAS9C,GAAIF,IAAJ,GAEE,GADAG,EAAa,GAAH,OAAMrD,SAAN,wCAAwDA,SAAxD,MAAVqD,UACA,EAAmB,CACjBA,GAAc,KAAJ,SAAVA,aACA,IAAMC,EACJH,EADF,EAEA,IACEE,GAAc,KAAJ,SAAVA,8CAIJA,EAAa,GAAH,OAAMrD,SAAN,MAAVqD,SACA,IACEA,GAAc,KAAJ,SAAVA,cAGJ,SAEF,eA4HF,OAAO1/H,GAzHP,YAAoC,IAATnJ,EAAS,EAATA,MACnB0U,EAAU5B,IAER0yH,EAAgCxlI,EAHN,YAK5B+oI,EAFkC/oI,EAHN,eAKXmzG,cAAvB,OALkC,EAMVrjG,WANU,sBAM3BsqH,EAN2B,KAMrB4O,EANqB,OAOIl5H,WAPJ,wBAO3Bo2H,EAP2B,KAOd+C,EAPc,KAkBlC,OACE,uBACE/zH,UAAWR,EADb,KAEEI,MAAO,CAAEgY,OAAQ9sB,EAAV,OAAwB8Y,MAAO9Y,EAAM8Y,OAC5CqX,cAAanwB,EAAMF,IAEnB,mBAAMg6B,WAAN,EAAgB1K,UAAhB,MAAgCla,UAAWR,EAAQorB,QAChD9/B,wBACC,mBAAMg6B,MAAI,GACR,mBAAch6B,MAAOA,KAGxBA,oBAA4BA,EAA5BA,wBACC,mBAAMg6B,MAAI,GACR,mBAAsBh6B,MAAOA,MAKlCA,oBAA4BA,EAA5BA,wBAEGA,EAAA,kCAAuC,cACrC,OACE,mBACE2V,IAAG,UAAKgB,EAAL,yBADL,GAEEwsC,UAFF,EAGEykF,YAHF,EAIEnF,aAAc9rH,EAJhB,aAKEmW,OA3JhB,QAgKM,uBACE5X,UAAWR,EADb,YAEEI,MAAO,CAAEgY,OAAQ9sB,SAnKzB,KAqKSA,uBACC,mBAAcA,MAAOA,EAAMkpI,eAE7B,uBACEp0H,MAAO,CACL7H,SADK,WAELoD,QAASrQ,0BAAuC,SAGlD,mBACEo6H,KADF,EAEE8L,YAFF,EAGElmI,MAHF,EAIE8sB,OACE9sB,SAnLd,GACA,GAoLc+oI,EAnLd,OA0LM,uBACE7zH,UAAWR,EADb,UAEEI,MAAO,CAAEzE,QAASrQ,0BAAuC,SAExDwlI,EACC,mBAAW/8F,KAAG,GACZ,uBAAKvzB,UAAWR,EAAQ4zH,kBACtB,mBAAiB9C,YAAaA,KAEhC,uBAAKtwH,UAAWR,EAAQ0/C,SACxB,mBACE+0E,mBAAoB,CAAC,GAAI,GAAI,IAD/B,KAEE5uF,MAAOirF,SAFT,MAGE9yG,UAHF,MAIEwzG,YAJF,EAKE9L,KALF,EAMEgP,aArFa,SAACt7G,EAAOu7G,GAC/BL,MAqFUM,oBAlFoB,SAAAx7G,GAC9Bm7G,GAAgBn7G,SAAhBm7G,OACAD,QAkFQ,uBAAK9zH,UAAWR,EAAQ0/C,UA9EhC,MAkFGp0D,gCACC,mBACEmtB,OAAQntB,EADV,aAEE8U,MAAO,CACLgY,OAAQ9sB,EADH,iBAELiN,SAFK,WAGLo/E,OAHK,EAILh8D,KAJK,EAKL9c,WALK,OAMLgB,UANK,aAOL4lD,UAAW,4B,sBClPV,YAAAtoD,GAAiB,IAEtBpT,GAAUm+C,EADI/qC,EADQ,oCAiC9B,OA5BA,cASE,QANE03H,8BAMF,MAN2B,KAM3B,MALEC,uBAKF,MALoB,KAKpB,EAJEC,EAIF,EAJEA,QAIF,IAHE14H,mBAGF,WAHgBnO,EAGhB,MAFEmgI,oBAEF,WAFiBngI,EAEjB,EACA,OAAOnE,EAAA,iCAC2B,CAC9BkR,KAAMlR,eAFH,UAIK,iBAAO,CACf8qI,uBADe,EAEfC,gBAFe,EAGfz4H,YAAaA,GAHE,EAIfgyH,mBARG,OAUE,iBAAO,CACZ0G,QADY,EAEZ,gBACE,iBCvBK,YAAA53H,GAAiB,IACtB+qC,EAAc/qC,EADQ,YAEQ+qC,EAFR,mBAEtBn+C,EAFsB,QAEfm7F,EAFe,UAEN96E,EAFM,YAGtB3V,EAAayzC,EAHS,uBAIxB9sC,EAAQ8sC,EAAd,SAJ8B,EAMgCA,EANhC,qCAMtBg7C,EANsB,kBAML8xC,EANK,uBAMiBjyC,EANjB,eAUsB76C,EAVtB,sBAUtB+sF,EAVsB,cAUTxnH,EAVS,aAUGq+C,EAVH,iBAcxBopE,EAA4BhtF,EAAlC,IAEQ7pC,EAAe6pC,EAhBO,uCAiBxBkqC,EAAalqC,EAAnB,gCACM8uC,EAAY9uC,EAAlB,+BACM6uC,EAAW7uC,EAAjB,8BACMqqF,EAAiBrqF,EAAvB,oCACMukF,EAASvkF,EAAf,4BAEM9pC,EAAYC,GAAW,WAC3B,MAAO,CACLw1H,2BAA4B,CAAEt0H,YAAa,SAC3C41H,kBAAmB,CACjBxgH,OAAQ,CAAC,CAAC,EAAG,EAAG,EADC,WAEjB,0BAA2B,CACzBtU,UAAW,GAEb,+BAAgC,CAC9Bia,IAD8B,OAE9B,yBAA0B,CACxBA,IAAK,cAQT86G,EAAuB3gI,GAAS,YAAqB,IAAlBy+H,EAAkB,EAAlBA,YACjClzH,EAAU5B,IACVi3H,EAAmBL,EACvBjyC,EAAWG,EAAgBgC,EAAD,GAD5B,eAGA,OACE,gCACE,mBACEpnF,MAAOo1H,EADT,UAEExxG,SAAU,SAAAtI,GACR85G,eAAyBjgI,OAAOmmB,SAAhC85G,UAGDmC,EAAA,KAAqB,SAAA3lI,GAAI,OACxB,mBAAUuR,IAAV,EAAqBnD,MAAOpO,GADJ,OAP9B,IAaE,mBACE5C,MADF,QAEEi1F,YAFF,eAGEzxF,MAAO4iI,EAHT,mBAIEp1H,MAAOo1H,EAJT,UAKExxG,SAAU,SAAA+/D,GAAG,OAAIyxC,eAAyBzxC,SAA7B,QACbjhF,UAAWR,EANb,kBAOEy4C,WAAY,CACVE,aACE,mBACEn4C,UAAWR,EADb,2BAEEzH,SAAS,OAET,mBACEwf,aADF,eAEE7G,QAAS,kBAAMgiH,eAAN,KACTv0H,MAAM,aAEN,qBATJ,eAmBN22H,EAAa,CAAC,gBAAD,8EAzFW,oBAmGxBC,EAAuB,CAC3B,gBAAiB,cACf,OACEC,YAAyBC,EAAzBD,SACA1yH,GACE0yH,EADY,MAEZA,EAFY,IAGZC,EAHY,MAIZA,EANJ,MAUF,mBAAoB,cAClB,OACED,YAAyBC,EAAzBD,SACAzyH,GACEyyH,EADe,MAEfA,EAFe,IAGfC,EAHe,MAIfA,EANJ,MAUF,iBAAkB,cAChB,OACED,YAAyBC,EAAzBD,SACAzyH,GACE0yH,EADe,MAEfA,EAFe,IAGfD,EAHe,MAIfA,EANJ,MAWJD,mBAA2C,cAIzC,OAAQA,qBAAR,IAKFA,uBAA+C,cAI7C,OAAQA,wBAAR,IAKFA,mBAA2C,cAIzC,OAAQA,sBAAR,KA5J4B,4CA6O9B,uDAAAroI,EAAA,6DACQ0hB,EAAUnB,EADlB,GAEUs4B,EAAoBn3B,EAF9B,gBAGU9iB,EAAiBglI,EAH3B,eAIiB1mH,EAJjB,GAIUhf,EAJV,cAKyB26C,kBALzB,aAKQ4M,EALR,gBAOU29C,EAAMxkC,EAAe+kE,EAAD,MAAY,SAAAnhI,GAAI,OACxCq2C,mBAAqC+qF,EADG,iBAGlCtmI,EAAY8lG,EAVxB,QAWUlkC,EAAmBzZ,sBAX7B,GAYU2Z,EAAqB3Z,EAAA,cACzB,SAAAp+C,GAAM,OAAIA,YAAJ,KAGFmhI,EAhBV,2BAiBQtmH,EAAOR,EAAA,YAAmB,SAAAxgB,GAAC,OAAIA,OAAJ,KAjBnC,wBAmBMghB,EAAOR,EAAA,2BAAoC,CACzCvS,YADyC,EAEzCjR,GAAIsqI,KAKNtmH,oBAAyB,CACvB1N,WAAWA,eADb0N,MA1BN,UA6BYumH,iBAAK,kBAAMvmH,EAAN,eA7BjB,QA+BIA,iBAAoByhH,EAApBzhH,MA/BJ,kDAiCIR,kCAjCJ,2DA7O8B,sBA8S9B,OAV4BsmH,EAA0B,YAAa,CACjE7G,aADiE,WAEjEhyH,YAFiE,gBAGjE04H,QAHiE,cAI/D,OAAOE,EAAYW,EAAD,aAAqBC,EAAvC,eAEFf,gBAvIsB/qI,EAAA,8BACU,CAC9BkR,KAAMlR,UADwB,aAE9BgkI,aAAchkI,EAFgB,QAG9Bu2D,UAH8B,GAI9BgiD,UAAWv4G,WAAeA,cAAfA,GAA8CurI,EAA9CvrI,MALS,OAOf,SAAA2B,GAAI,MAAK,CACd,yBACE,GAAIA,EAAJ,UAAoB,CAClB,IAAMoqI,EAASpqI,EAAf,gBACA,OACGoqI,GAAD,KACAA,WADA,kBAEOA,EAAP,OAFA,kBAGOA,EAAP,KACAA,QAAeA,EALjB,IAQF,UAEF,sBACE,IAAMlnH,EAAUnB,EAAhB,GAEQ3hB,EADMse,EAAU1e,EAAV0e,GAAd,YAFoB,aAIpB,IACE,OAAO0hD,EAAepgE,EAAD,WAAiB,SAAAlB,GAAO,OAC3CokB,mCAD2C,MAG7C,MAAOxe,GACP,SAIJ,gBACE,IAAK1E,EAAD,WAAmBA,EAAvB,mBACE,OAAO,WACL,UAHU,IAONugE,EAA6CvgE,EAPvC,gBAOW42G,EAA4B52G,EAPvC,UAOsBqiI,EAAiBriI,EAPvC,aAQd,OAAO,SAAyBqqI,EAAOhiG,GAAK,IAEpC88F,EAD8B98F,EADM,iBAE1C,GAEA,IAAK88F,IAASA,EAAV,OAAwBA,EAA5B,aACE,SAEF,IAAMmF,EAAiBnF,EAAvB,aACA,IAAKmF,EAAL,QACE,SAGF,IAAMtpE,EAAY6oE,EAAlB,GACA,MACE,MAAM,IAAInkI,MAAM,IAAV,SAAN,yCAGF,OAAOs7D,EAAUspE,EAAjB,SA3DgB,SA+Db,SAAAtqI,GAAI,MAAK,CAChBuqI,aADgB,YAEdvqI,eAEFwqI,aAJgB,YAKdxqI,mBApEkB,UAuEZ,iBAAO,CAAEoP,eAAgBs6H,MAiEnCP,uBAzB6BpgI,GAC7B,YAAyC,IAAtCo8H,EAAsC,EAAtCA,KAAM9C,EAAgC,EAAhCA,aAAc+C,EAAkB,EAAlBA,YAKrB,OACE,qBACE5/G,QANJ,YACEuwE,mBArRwB,wCAsRxB00C,CAAkBrF,EAAa/C,EAA/BoI,IAKEj2H,MAFF,qCAGE1M,KAAK,SAEJq9H,EANL,YC1RS,YAAA1zH,GAAiB,IACtB+qC,EAAc/qC,EADQ,YAEH+qC,EAFG,mBAEtBn+C,EAFsB,QAEfm7F,EAFe,UAGtBzwF,EAAayzC,EAHS,uBAIxB9sC,EAAQ8sC,EAAd,SAJ8B,EAMgCA,EANhC,qCAMtBg7C,EANsB,kBAML8xC,EANK,uBAMiBjyC,EANjB,aAUxBmyC,EAA4BhtF,EAAlC,IAEMotF,EAAa,CAAC,SAAD,6DAZW,aAsBxBC,EAAuB,CAC3Ba,SAAU,cACR,WAAOC,4BAETC,OAAQ,cACN,OAAOD,kBAAP,GAEF,cAAe,cACb,WAAOA,4BAET,YAAa,cACX,IAAMhvH,EAAQgvH,wBAAd,GACA,WAAIhvH,GACGA,IAAUgvH,SAAoBE,EAArC,QAGJhB,mBAA2C,cACzC,OAAQA,aAAR,IAEFA,iBAAyC,cACvC,OAAQA,WAAR,KAGMl3H,EAAe6pC,EA7CO,uCA8CxBkqC,EAAalqC,EAAnB,gCACM8uC,EAAY9uC,EAAlB,+BACM6uC,EAAW7uC,EAAjB,8BACMqqF,EAAiBrqF,EAAvB,oCACMukF,EAASvkF,EAAf,4BAEM9pC,EAAYC,GAAW,WAC3B,MAAO,CACLw1H,2BAA4B,CAAEt0H,YAAa,SAC3C41H,kBAAmB,CACjBxgH,OADiB,EAEjB,0BAA2B,CACzBtU,UAAW,GAEb,+BAAgC,CAC9Bia,IAD8B,OAE9B,yBAA0B,CACxBA,IAAK,cAQT86G,EAAuB3gI,GAAS,YAAqB,IAAlBy+H,EAAkB,EAAlBA,YACjClzH,EAAU5B,IACVi3H,EAAmBL,EACvBjyC,EAAWG,EAAgBgC,EAAD,GAD5B,eAGA,OACE,gCACE,mBACEpnF,MAAOo1H,EADT,UAEExxG,SAAU,SAAAtI,GACR85G,eAAyBjgI,OAAOmmB,SAAhC85G,UAGDmC,EAAA,KAAqB,SAAA3lI,GAAI,OACxB,mBAAUuR,IAAV,EAAqBnD,MAAOpO,GADJ,OAP9B,IAaE,mBACE5C,MADF,OAEEgR,MAAOo1H,EAFT,aAGExxG,SAAU,SAAA+/D,GAAG,OAAIyxC,YAAsBzxC,SAA1B,QACbjhF,UAAWR,EAJb,kBAKEy4C,WAAY,CACVE,aACE,mBACEn4C,UAAWR,EADb,2BAEEzH,SAAS,OAET,mBACEwf,aADF,eAEE7G,QAAS,kBAAMgiH,YAAN,KACTv0H,MAAM,aAEN,qBATJ,eAoBN63H,EAAmBzsI,EAAA,yBACI,CACzBkR,KAAMlR,UADmB,QAEzBgkI,aAAchkI,EAFW,QAGzBwsI,aAHyB,GAIzBj0B,UAAWv4G,WAAeA,cAAfA,GAA8CurI,EAA9CvrI,MALU,OAOhB,SAAA2B,GAAI,MAAK,CAEd,gBAAgB,IACN6qI,EAA0C7qI,EADpC,aACQqiI,EAA4BriI,EADpC,aACsB42G,EAAc52G,EADpC,UAEd,MACE,OAAO,WACL,UAGJ,IAAMiE,EAAI4mI,EAPI,cAQd,OAAO,SAAyBR,EAAOhiG,GAAK,IAEpC88F,EADY98F,EADwB,SAI1C,IAAK88F,IAASA,EAAd,KAAyB,OAAO,EAChC,IAAMnkE,EAAY6oE,EAAlB,GACA,MACE,MAAM,IAAInkI,MAAM,IAAV,SAAN,yCACF,OAAOs7D,EAAUmkE,EAAD,KAAhB,SAzBiB,SA6Bd,SAAAnlI,GAAI,MAAK,CAChB+qI,UADgB,YAEd/qI,kBAEFwqI,aAJgB,YAKdxqI,mBAlCmB,UAqCb,iBAAO,CAAEoP,eAAgBs6H,MASrC,MAAO,CAAEsB,WAPcxB,EAA0B,OAAQ,CACvDH,QADuD,cAErD,OAAOa,qBAAyBC,EAAhC,OAEFf,gBAAiB0B,IAGkB1B,gBAAiB0B,ICnKzC,eAAmB,IAAhBtuF,EAAgB,EAAhBA,UACRn+C,EAAUm+C,EADc,yBAE1BgtF,EAA4BhtF,EAAlC,IAEyByuF,EAAsBzuF,EAJf,oBAsBhC,OATegtF,EAA0B,SAAU,CACjD7G,aADiD,WAEjDhyH,YAFiD,gBAGjD04H,QAHiD,cAI/C,OAAOa,qBAAyBC,EAAhC,OAEFf,gBAbsB/qI,EAAA,UAEtBA,EAAA,MAAY,CACVkR,KAAMlR,0BCVG,eAAmB,IAAhBm+C,EAAgB,EAAhBA,UACRn+C,EAAUm+C,EADc,yBAExBzzC,EAAayzC,EAFW,uBAG1B9sC,EAAQ8sC,EAAd,SAEMgtF,EAA4BhtF,EAAlC,IAEQ7pC,EAAe6pC,EAPS,uCAQ1B8uC,EAAY9uC,EAAlB,+BACM6uC,EAAW7uC,EAAjB,8BACMukF,EAASvkF,EAAf,4BAEMotF,EAAa,CAAC,SAAD,qCAZa,eAqB1BC,EAAuB,CAC3Be,OAAQ,cACN,OAAOM,IAAP,GAEF,eAAgB,cACd,OAAOA,EAAP,GAEF,YAAa,cACX,OAAOA,EAAP,GAEFC,QAAS,gBACP,OAAOD,KAA8BA,EAArC,GAGJrB,cAAsC,gBAKpC,OAAQA,cAAR,KAOIn3H,EAAYC,GAAW,WAC3B,MAAO,CACLw1H,2BAA4B,CAAEt0H,YAAa,SAC3C41H,kBAAmB,CACjBxgH,OAAQ,CAAC,CAAC,EAAG,EAAG,EADC,WAEjB,0BAA2B,CACzBtU,UAAW,GAEb,+BAAgC,CAC9Bia,IAD8B,OAE9B,yBAA0B,CACxBA,IAAK,cAQT86G,EAAuB3gI,GAAS,YAAqB,IAAlBy+H,EAAkB,EAAlBA,YACjClzH,EAAU5B,IAEVi3H,EAAN,EAEA,OACE,gCACE,mBACEv3H,MAAOo1H,EADT,UAEExxG,SAAU,SAAAtI,GACR85G,eAAyBjgI,OAAOmmB,SAAhC85G,UAGDmC,EAAA,KAAqB,SAAA3lI,GAAI,OACxB,mBAAUuR,IAAV,EAAqBnD,MAAOpO,GADJ,OAP9B,IAaE,mBACE5C,MADF,SAEEi1F,YAFF,MAGE9mF,KAHF,SAIE3K,MAAO4iI,EAJT,qBAKEhqH,aAAcgqH,EALhB,YAMExxG,SAAU,SAAA+/D,GACRyxC,iBAA2Br/D,WAAW4tB,SAAtCyxC,SAEF1yH,UAAWR,EAAQm1H,oBAEpBjC,yCACDA,YADCA,KAEC,wCAEE,mBACEpmI,MADF,SAEEi1F,YAFF,MAGE9mF,KAHF,SAIE3K,MAAO4iI,EAJT,sBAKEhqH,aAAcgqH,EALhB,aAMExxG,SAAU,SAAA+/D,GAAG,OACXyxC,kBAA4Br/D,WAAW4tB,SAD5B,SAGbjhF,UAAWR,EAAQm1H,yBASzBL,EAAkB/qI,EAAA,2BACO,CAC3BkR,KAAMlR,UADqB,UAE3BgkI,aAAchkI,EAFa,QAG3B+sI,YAAa/sI,QAAYA,EAHE,QAI3BgtI,aAAchtI,QAAYA,EAJC,QAK3Bu4G,UAAWv4G,WAAeA,cAAfA,GAA8CurI,EAA9CvrI,MANS,OAQf,SAAA2B,GAAI,MAAK,CAEd,gBACE,qBAAWA,EAAP,YACF,OAAO,WACL,UAHU,IAMNorI,EAAuDprI,EANjD,YAMOqrI,EAA0CrrI,EANjD,aAMqB42G,EAA4B52G,EANjD,UAMgCqiI,EAAiBriI,EANjD,aAOd,OAAO,SAAyBqqI,EAAOhiG,GAAK,IAEpC88F,EADY98F,EADwB,MAE1C,GAEA,IAAK88F,IAASA,EAAd,KAAyB,OAAO,EAEhC,IAAMmF,EAAiBniE,WAAWg9D,EAAlC,MACA,qBAAWmF,EAA6B,OAAO,EAE/C,IAAMtpE,EAAY6oE,EAAlB,GACA,MACE,MAAM,IAAInkI,MAAM,IAAV,SAAN,yCAEF,OAAOs7D,EAAUspE,EAAgBc,EAAjC,SA9BgB,SAkCb,SAAAprI,GAAI,MAAK,CAChBsrI,eADgB,YAEV7pF,iBAAJ,kBAA8BtlC,EAC5Bnc,mBADF,EAEKA,iBAEPurI,gBANgB,YAOV9pF,iBAAJ,kBAA8BtlC,EAC5Bnc,oBADF,EAEKA,kBAEPwqI,aAXgB,YAYdxqI,mBA9CkB,UAiDZ,iBAAO,CAAEoP,eAAgBs6H,MASrC,MAAO,CAAE8B,aAPYhC,EAA0B,SAAU,CACvDH,QADuD,cAErD,OAAOlhE,WAAW+hE,EAAX/hE,MAAyBA,WAAWgiE,EAA3C,OAEFf,oBAGqBA,oBC/KV,eAAmB,IAAhB5sF,EAAgB,EAAhBA,UACRn+C,EAAUm+C,EADc,yBAE1BgtF,EAA4BhtF,EAAlC,IAEyByuF,EAAsBzuF,EAJf,oBAsBhC,OATiBgtF,EAA0B,WAAY,CACrD7G,aADqD,WAErDhyH,YAFqD,QAGrD04H,QAHqD,cAInD,OAAOlhE,WAAW+hE,EAAX/hE,MAAyBA,WAAWgiE,EAA3C,OAEFf,gBAbsB/qI,EAAA,UAEtBA,EAAA,MAAY,CACVkR,KAAMlR,4BCTG,eAAmB,IAAhBm+C,EAAgB,EAAhBA,UACRn+C,EAAUm+C,EADc,yBAE1BgtF,EAA4BhtF,EAAlC,IAEyByuF,EAAsBzuF,EAJf,oBAsBhC,OATegtF,EAA0B,SAAU,CACjD7G,aADiD,WAEjDhyH,YAFiD,MAGjD04H,QAHiD,cAI/C,OAAOlhE,WAAW+hE,EAAX/hE,MAAyBA,WAAWgiE,EAA3C,OAEFf,gBAbsB/qI,EAAA,UAEtBA,EAAA,MAAY,CACVkR,KAAMlR,0BCJG,YAACoT,GAAiC,IACvC+qC,EAAc/qC,EAAd+qC,UACAn+C,EAAUm+C,EAAU,mBAApBn+C,MAKFotI,EAAc,CAClBhqF,OAJ+BjF,EAAUkvF,IAAnCF,aAKNp/G,KAJ2BowB,EAAUmvF,IAA/BX,WAKNY,UAAWpvF,EAAUqvF,IACrBC,OAAQtvF,EAAUuvF,IAClBC,SAAUxvF,EAAUyvF,IACpBC,OAAQ1vF,EAAU2vF,KAGdC,EAAiB1qI,OAAOmiC,OAAO4nG,GAC/BY,EAAgBhuI,EAAM4C,MAAN,MAAA5C,EAAK,YAAU+tI,IAErC,OAAO1qI,OAAO4rF,OAAO,CACnBm+C,cACAY,gBAEAC,mBAAoBjuI,EAAM4C,MAAN,MAAA5C,EAAK,YACpB+tI,EACAxiI,KAAI,SAAA2iI,GAKH,OAH4BA,EAAWniI,OAAO,CAC5CmF,KAAMg9H,EAAW/7D,WAAWjhE,KAAK6C,QAD3Bg3H,mBAMT7yH,QAAO,SAAAuyB,GAAC,QAAMA,UCvCR,YAACr3B,GAAiC,MAC/BA,EAAR6qC,IACyB,mBAAzBj+C,EAFuC,EAEvCA,MAAOqgB,EAFgC,EAEhCA,UAET8tH,EAAYnuI,EAAMuB,MAAM,kBAAmB,CAC/C4N,KAAMnP,EAAMU,OACZ0tI,aAAcpuI,EAAMqC,MAAMrC,EAAM6iD,YAqClC,OAlCiB7iD,EACduB,MAAM,iBAAkB,CACvBF,GAAIrB,EAAME,WACVmuI,MAAOruI,EAAMwc,MAAM2xH,GACnBC,aAAcpuI,EAAMqC,MAAMrC,EAAM6iD,UAChCyrF,YAAY,IAEb5sI,SAAQ,SAAAC,GAAI,MAAK,CAChB4sI,aADgB,WAEd5sI,EAAK2sI,YAAc3sI,EAAK2sI,YAE1BE,SAJgB,WAKd7sI,EAAK2sI,YAAa,GAEpBzwE,OAPgB,WAQdl8D,EAAK2sI,YAAa,GAEpBG,gBAVgB,SAUAxkI,GACdtI,EAAKysI,aAAenkI,OAGvB+S,OAAM,SAAArb,GAAI,MAAK,CACd,uBAAuB,IACbgmI,EAAYtnH,EAAU1e,EAAM,GAA5BgmI,QACJ1iI,EAAI,EACR,OAAO0iI,EAAQp8H,KAAI,SAACmjI,GAClB,OAAIA,EAAOC,UACFD,EAAOttI,KAAKO,EAAM+sI,GAEpB/sI,EAAK0sI,MAAMppI,cCrCb,YAACmO,GAAiC,IACvC6qC,EAAc7qC,EAAd6qC,IAAK5a,EAASjwB,EAATiwB,KADkC,EAElB4a,EAAI,mBAAzBj+C,EAFuC,EAEvCA,MAAOqgB,EAFgC,EAEhCA,UACTuuH,EAAWvrG,EAAKwrG,IAEtB,OAAO7uI,EACJuB,MAAM,eAAgB,CACrButI,SAAU9uI,EAAMqkB,SAAQ,GACxB+gF,KAAMplG,EAAMwc,MAAMoyH,KAEnB5xH,OAAM,SAAArb,GAAI,MAAK,CACd,YACE,OAAOA,EAAKyjG,KAAK//F,QAGnB,0BACE,OAAO+E,KAAK2kI,mBAAmB1pI,QAGjC,oBACE,OAAO+E,KAAK4kI,aAAa3pI,QAG3B,qCACE,OAAO+E,KAAK6kI,qBAAqB5pI,QAGnC,iBACE,IAAM+a,EAASC,EAAU1e,GACzB,OAAOA,EAAKyjG,KAAK96F,QAAQ0pB,KAAK5T,EAAO8uH,+BAGvC,mBACE,OAAOvtI,EAAKyjG,KAAKltF,QAAO,SAAAlT,GAAC,OAAIA,EAAEspI,eAGjC,2BACE,IAAMtC,EAAQ3rH,EAAU1e,GAEhB+yG,EADKr0F,EAAU2rH,GACft3B,eACR,OAAOtqG,KAAK4kI,aAAa92H,QAAO,SAAA8xB,GAAG,OACjC0qE,EAAey6B,iBAAiBnD,EAAOhiG,OAK3C,yBACE,IAAMgiG,EAAQ3rH,EAAU1e,GAEhB+yG,EADKr0F,EAAU2rH,GACft3B,eACR,OAAO/yG,EAAKyjG,KACTltF,QAAO,SAAA8xB,GAAG,OAAI0qE,EAAey6B,iBAAiBnD,EAAOhiG,MACrDhW,KAAKg4G,EAAMkD,mCAGjBxtI,SAAQ,SAAAC,GAAI,MAAK,CAChBytI,YADgB,WAEdztI,EAAKyjG,KAAK50F,SAAQ,SAAAw5B,GAAG,OAAIA,EAAIwkG,oBCnDtB,YAACp7H,GAAiC,IACvC6qC,EAAc7qC,EAAd6qC,IAAK5a,EAASjwB,EAATiwB,KADkC,EAElB4a,EAAI,mBAAzBj+C,EAFuC,EAEvCA,MAAOqgB,EAFgC,EAEhCA,UAFgC,EAIRgjB,EAAKgsG,IAApCjC,EAJuC,EAIvCA,YAAaY,EAJ0B,EAI1BA,cAEfsB,EAAoBjsG,EAAKksG,IAGzBC,EAAmBxvI,EACtBuB,MAAM,mBAAoB,CACzBoE,KAAM3F,EAAMqC,MAAMrC,EAAMU,QACxB+jI,SAAUzkI,EAAMC,SAAS+tI,GAAe,iBAAO,CAC7C98H,KAAM,WAKRy9H,WAAW,EAEXc,uBAAwBzvI,EAAMqC,MAAMrC,EAAMU,UAE3Csc,OAAM,SAAArb,GAAI,MAAK,CACd,WACE,GAAIA,EAAKgtI,UAEP,OAAOzlH,aAAiBhgB,OAAOvH,EAAK8tI,8BAyH5C,OAlHmBzvI,EAChBuB,MAAM,cAAe,CACpBgkI,OAAQvlI,EAAMC,SAASqvI,GAAmB,kBACxCA,EAAkBvjI,YAEpB47H,QAAS3nI,EAAMwc,MAAMgzH,GACrBrI,mBAAoBnnI,EAAMwc,MAAMxc,EAAMa,QACtC+mI,gBAAgB,EAEhB8H,YAAa1vI,EAAMwc,MACjBxc,EACGuB,MAAM,cAAe,CACpByiI,aAAchkI,EAAMa,OACpBqjI,YAAY,IAEbxiI,SAAQ,SAAAC,GAAI,MAAK,CAChBguI,gBADgB,WAEdhuI,EAAKuiI,YAAcviI,EAAKuiI,iBAKhCniI,aAAc/B,EAAMqC,MAAMrC,EAAMU,UAEjC+b,UAAS,iBAAO,CACfmzH,gBAAiBxC,EAAYr/G,KAC7Bo3G,gBAAiB,KACjB2J,UAAU,MAEX9xH,OAAM,SAAArb,GAAI,MAAK,CACd,kBACE,IAAMkjB,EAAUnB,sBAAW/hB,GACrBgE,EAAOhE,EAAKI,aAClB,GAAI4D,EAAM,CACR,IAAM65D,EAAM36C,EAAQm3B,gBAAgB76C,IAAIwE,GACxC,OAAO65D,GAAOA,EAAIhW,YAEpB,OAAO,GAET,uBAEE,OAAOnpC,EAAU1e,GAAMulI,kBAKzB,sBAIE,OAHkB7jI,OAAOC,KACvB8pI,GAEe7hI,KAAI,SAAAyxC,GACnB,IAAMynF,EAAW2I,EAAYpwF,GAAUjxC,OAAO,CAAEmF,KAAM8rC,IAEtD,MAAO,CAAEA,WAAU1qC,YADmBmyH,EAA9BnyH,YACwBgyH,aADMG,EAAjBH,kBAKzB4K,6BA5Bc,SA4BeW,EAAWC,GACtC,IAAK,IAAI7qI,EAAI,EAAGA,EAAItD,EAAK+tI,YAAYrqI,OAAQJ,GAAK,EAAG,OACdtD,EAAK+tI,YAAYzqI,GAA9C++H,EAD2C,EAC3CA,aAAcE,EAD6B,EAC7BA,WAEhBl/F,EADerjC,EAAKgmI,QAAQ3D,GAA1BS,SACgBuG,QACtB6E,EAAKE,iBAAiB/L,GACtB8L,EAAKC,iBAAiB/L,IAExB,GAAIh/F,EAAQ,OAAOk/F,GAAcl/F,EAASA,EAE5C,OAAO,OAGVtjC,SAAQ,SAAAC,GAAI,MAAK,CAChB4d,YADgB,WACF,WACZqrC,sBACEjpD,EACA6oD,kBAAO,sBAAC,8BAAArnD,EAAA,yDACA0hB,EAAUnB,sBAAW/hB,GACnBq6C,EAAoBn3B,EAApBm3B,gBAFF,UAIAr6C,EAAKI,aAJL,gCAKIi6C,EAAgB2hB,gBAAgBh8D,EAAKI,cALzC,OAMF,EAAKiuI,WAAU,GANb,uDASJnrH,EAAQ4xC,OAAR,kCAC6B90D,EAAKI,aADlC,kBAEE,SAXE,4DAkBZiuI,UAtBgB,SAsBNl3D,GACRn3E,EAAKmtI,SAAWh2D,GAGlBssD,mBA1BgB,SA0BG6K,GACjBtuI,EAAKwjI,gBAAkB8K,GAGzBC,eA9BgB,SA+BdC,GAGIA,IAASxuI,EAAK+tI,YAAcS,IAElCC,cApCgB,SAoCFpM,EAAsBqM,GAClC1uI,EAAKgmI,QAAQ3D,GAAcS,SAAW,CAAEvzH,KAAMm/H,IAEhDjB,YAvCgB,WAwCd,OAAOztI,EAAK4jI,OAAO6J,oB,gCCpJpB,SAASkB,GAAe7oI,GAC7B,OAAO,IAAI8oI,YAAY,QAAS,CAAEC,OAAO,IAAQC,OAAOhpI,GAG1D,SAASipI,GAAUjpI,GAA8B,IAAdZ,EAAc,uDAAJ,GAC3C,OAAO8pI,KAAI,aAAEC,UAAU,EAAMC,OAAQ,OAAUhqI,IAAWiqI,WACxDR,GAAe7oI,IAkCnB,SAASspI,GACPxL,EACAvB,EACAriE,GAEA,IAIIqvE,EAJE7hI,EAAOo2H,EAAOngC,KAAK,GAAGipC,MAAMrK,GAAc70H,MAAQ,GAEpD8hI,EAAc,OAGlB,IACED,EAAYjvE,0BAAe5yD,EAAMwyD,GACjC,MAAOp7D,IAYT,OATIyqI,GAAaA,EAAUvwI,SAAsC,kBAApBuwI,EAAUpwI,MACrDqwI,EAAc,YACL,gBAAgB/qI,KAAKiJ,KAC9B8hI,EAAc,UAMTA,EAGT,SAASC,GACP9rC,GAMA,IALAv+F,EAKA,uDALwB,CACtBs8H,mBAAmB,EACnBgO,qBAAsB,EACtBxvE,eAAgB,kBAAM,IAKpByvE,EAAU,EACR7L,EAAiB,CACrBuJ,UAAU,EACV1pC,KAAMA,EAAK75F,KAAI,SAACy+B,EAAKs7F,GACnB,IAAMjkI,EAAKikI,GAAaz+H,EAAQs8H,kBAAoB,EAAI,GAExD,OADIn5F,EAAI3kC,OAAS+rI,IAASA,EAAUpnG,EAAI3kC,QACjC,CACLhE,GAAI6H,OAAO7H,GACXgtI,MAAOrkG,EAAIz+B,KAAI,SAAC4D,EAAM60H,GACpB,MAAO,CAAEA,eAAc70H,gBAOzBkiI,EAAsC,GAC5C,GAAIxqI,EAAQs8H,wBAAsDh/H,IAAjC0C,EAAQsqI,qBAAoC,OACrD5L,EAAOngC,KAAKz+E,OAChC9f,EAAQsqI,qBAAuB,EAC/B,GAHyE,mBACpEG,EADoE,KAMvEA,GACFA,EAAYjD,MAAM79H,SAAQ,SAACs2H,EAAM9C,GAC/BqN,EAAYrN,GAAgB8C,EAAK33H,MAAQ,MAQ/C,IAFA,IAAMw4H,EAAoB,GACpBR,EAAqB,GAnC3B,WAoCSnD,GACPmD,EAAmBt1H,KAAKmyH,GACxB,IAAMiN,EAAcF,GAClBxL,EACAvB,EACAn9H,EAAQ86D,gBAIU,cAAhBsvE,GACF1L,EAAOngC,KAAK50F,SAAQ,SAAAw5B,GAClB,IAAM88F,EAAO98F,EAAIqkG,MAAMrK,GACvB8C,EAAKsH,aAAersE,0BAAe+kE,EAAK33H,KAAMtI,EAAQ86D,mBAI1DgmE,EAAQ3D,GAAgB,CACtBr+H,KAAM0rI,EAAYrN,GAClBS,SAAU,CACRvzH,KAAM+/H,KAnBHjN,EAAe,EAAGA,EAAeoN,EAASpN,GAAgB,EAAG,EAA7DA,GAwBT,MAAO,CACLuB,SACA4B,qBACAS,iBAAkB/gI,EAAQs8H,kBAC1BwE,UACA5lI,aAAc8E,EAAQ0qI,sBAInB,SAAeC,GAAtB,mC,8CAAO,WACL/pI,GADK,6BAAAtE,EAAA,6DAEL0D,EAFK,+BAEmB,CACtBs8H,mBAAmB,EACnBgO,qBAAsB,EACtBxvE,eAAgB,kBAAM,IALnB,SAQc+uE,GAAUjpI,GARxB,cAQC29F,EARD,yBASE8rC,GAA0B9rC,EAAMv+F,IATlC,4C,sBAYA,SAAe4qI,GAAtB,mC,8CAAO,WACLhqI,GADK,6BAAAtE,EAAA,6DAEL0D,EAFK,+BAEmB,CACtBs8H,mBAAmB,EACnBgO,qBAAsB,EACtBxvE,eAAgB,kBAAM,IALnB,SAQc+uE,GAAUjpI,EAAQ,CAAEiqI,UAAW,OAR7C,cAQCtsC,EARD,yBASE8rC,GAA0B9rC,EAAMv+F,IATlC,4C,sBCrJP,IAAM8qI,GAAmD,CACvD,CAAEhsI,KAAM,QAASuL,KAAM,QACvB,CAAEvL,KAAM,MAAOuL,KAAM,UACrB,CAAEvL,KAAM,KAAMuL,KAAM,QACpB,CAAEvL,KAAM,MAAOuL,KAAM,QACrB,CAAEvL,KAAM,MAAOuL,KAAM,QACrB,CAAEvL,KAAM,OAAQuL,KAAM,UACtB,CAAEvL,KAAM,SAAUuL,KAAM,QACxB,CAAEvL,KAAM,OAAQuL,KAAM,QACtB,CAAEvL,KAAM,SAAUuL,KAAM,SAI1B,SAAS0gI,GAAeC,EAAgBjuD,EAAc40B,GACpD,IAAMs5B,EAAaD,EAAUhvD,UAAUe,GACjCmuD,EAAa,IAAInR,GAAW,CAChClqH,QAASo7H,EACTtvD,OAAQqvD,EACRxwI,GAAI,OAAF,OAASm3G,KAGPvuG,EAAO25E,EAAKxiC,MAAM,MAAM71C,KAAI,SAAA6a,GAAC,MAAW,MAANA,EAAY,GAAKA,KAezD,OAboB,IAAhBnc,EAAK5E,QACP4E,EAAK4H,KAAK,IAEK,CACfxQ,GAAI6H,OAAOsvG,EAAa,GACxB41B,aAAc,CAAE2D,WAAYA,EAAWnpH,UACvCylH,MAAOpkI,EAAKsB,KAAI,SAAC4D,EAAM60H,GACrB,MAAO,CACLA,eACA70H,YAOD,SAAS6iI,GACdvqI,GAMA,IALAZ,EAKA,uDALwB,CACtBs8H,mBAAmB,EACnBgO,qBAAsB,EACtBxvE,eAAgB,kBAAM,IAExB,EACuBswE,GAA0B3B,GAAe7oI,IAA1D45B,EADN,EACMA,OAAQshB,EADd,EACcA,KACRyiD,EAAc,GACdysC,EAAY,IAAIK,KAAI,CAAE7wG,WAC5BA,EAAS,GACTshB,EAAKvB,MAAM,MAAM5wC,SAAQ,SAACozE,EAAc40B,GAClC,KAAKtyG,KAAK09E,IACZwhB,EAAKvzF,KAAK+/H,GAAeC,EAAWjuD,EAAM40B,OAG9C71D,EAAO,GASP,IAPA,IAAM4iF,EAAiB,CACrBuJ,UAAU,EACV1pC,QAGI+hC,EAA+B,GAC/BQ,EAAoB,GACjB1iI,EAAI,EAAGA,EAAI0sI,GAAetsI,OAAQJ,GAAK,EAC9CkiI,EAAmBt1H,KAAK5M,GACxB0iI,EAAQ1iI,GAAK,CACXU,KAAMgsI,GAAe1sI,GAAGU,KACxB8+H,SAAU,CAAEvzH,KAAMygI,GAAe1sI,GAAGiM,OAGxC,IAAK,IAAIjM,EAAI,EAAGA,EAAI4sI,EAAU5R,QAAQ56H,OAAQJ,GAAK,EAAG,CACpD,IAAMktI,EAAKR,GAAetsI,OAASJ,EACnCkiI,EAAmBt1H,KAAKsgI,GACxBxK,EAAQwK,GAAM,CAAExsI,KAAMksI,EAAU5R,QAAQh7H,GAAIw/H,SAAU,CAAEvzH,KAAM,SAiBhE,OAdAi2H,EAAmBt1H,KAAKs1H,EAAmB9hI,QAC3CsiI,EAAQyK,QAAQ,CACdzsI,KAAM,WACN8+H,SAAU,CAAEvzH,KAAM,aAClBy9H,WAAW,EACXc,uBAAwB,8SASnB,CACLlK,SACA4B,qBACAS,gBAAgB,EAChBD,UACA5lI,aAAc8E,EAAQ0qI,sBAInB,SAASU,GAA0BI,GAIxC,IAFA,IACIC,EADAC,EAAiB,EAEdA,EAAiBF,EAAUhtI,OAAQktI,GAAkB,EAAG,CAC7D,IAAM7pH,EAAI2pH,EAAUE,GACpB,GAAiB,OAAbD,GAA2B,MAAN5pH,EAAW,MACpC4pH,EAAW5pH,EAGb,MAAO,CACL2Y,OAAQgxG,EAAU1hE,OAAO,EAAG4hE,GAC5B5vF,KAAM0vF,EAAU1hE,OAAO4hE,ICzH3B,IAAMC,GAAe,WAAWpxF,MAAM,IAAI71C,KAAI,SAAAmd,GAAC,OAAIA,EAAE8zD,WAAW,MAC1Di2D,GAAa,SAASrxF,MAAM,IAAI71C,KAAI,SAAAmd,GAAC,OAAIA,EAAE8zD,WAAW,MAE5D,SAASk2D,GAAgBlkI,EAAkB/G,EAAgB66C,GAEzD,IADA,IAAIr9C,EAAI,EACDA,EAAIq9C,EAAMj9C,OAAQJ,GAAK,EAC5B,GAAIwC,EAAO+G,EAAWvJ,KAAOq9C,EAAMr9C,GAAI,OAAO,EAEhD,OAAO,EAEF,SAAS0tI,GAAiBlrI,GAG/B,IADA,IAAIxC,EAAI,EACDA,EAAIwC,EAAOpC,SAEdqtI,GAAgBztI,EAAGwC,EAAQ+qI,KAC3BE,GAAgBztI,EAAGwC,EAAQgrI,KAHLxtI,GAAK,EAM3B,GACEA,GAAK,QACgB,KAAdwC,EAAOxC,IAMpB,OAAIA,EACKwC,EAAO6C,MAAMrF,GAEfwC,EAGF,SAAemrI,GAAtB,qC,8CAAO,WAA8BnrI,EAAgBZ,GAA9C,mBAAA1D,EAAA,6DACCC,EAAIuvI,GAAiBlrI,GADtB,SAEcgqI,GAAeruI,GAF7B,cAEC6G,EAFD,OAGC4oI,EAAa,CACjB,CAAEltI,KAAM,QAAS8+H,SAAU,CAAEvzH,KAAM,WACnC,CAAEvL,KAAM,aAAc8+H,SAAU,CAAEvzH,KAAM,aACxC,CAAEvL,KAAM,WAAY8+H,SAAU,CAAEvzH,KAAM,WACtC,CAAEvL,KAAM,OAAQ8+H,SAAU,CAAEvzH,KAAM,SAClC,CAAEvL,KAAM,QAAS8+H,SAAU,CAAEvzH,KAAM,WACnC,CAAEvL,KAAM,SAAU8+H,SAAU,CAAEvzH,KAAM,UAEtCjH,EAAK09H,QAAQn3H,SAAQ,SAACq0H,EAAKyC,GACzB,IAAMwL,EAAYD,EAAWvL,GACzBwL,IACFjO,EAAIl/H,KAAOmtI,EAAUntI,KACrBk/H,EAAIJ,SAAWqO,EAAUrO,aAG7Bx6H,EAAK29H,gBAAiB,EACtB39H,EAAKlI,aAAe8E,EAAQ0qI,qBAE5BtnI,EAAKk9H,mBAAmBt1H,KAAK5H,EAAKk9H,mBAAmB9hI,QACrD4E,EAAK09H,QAAQyK,QAAQ,CACnBzsI,KAAM,WACN8+H,SAAU,CAAEvzH,KAAM,aAClBy9H,WAAW,EACXc,uBAAwB,oOA1BrB,kBA+BExlI,GA/BF,6C,sBAkCA,SAAe8oI,GAAtB,qC,8CAAO,WAAgCtrI,EAAgBZ,GAAhD,iBAAA1D,EAAA,sEACcsuI,GAAehqI,GAD7B,cACCwC,EADD,OASC4oI,EAA0B,CAC9B,CAAEltI,KAAM,SAAU8+H,SAAU,CAAEvzH,KAAM,QAAU8hI,aAAc,CAAC,YAC7D,CAAErtI,KAAM,SAAU8+H,SAAU,CAAEvzH,KAAM,UAAY8hI,aAAc,CAAC,UAC/D,CAAErtI,KAAM,OAAQ8+H,SAAU,CAAEvzH,KAAM,UAAY8hI,aAAc,CAAC,QAC7D,CACErtI,KAAM,SACN8+H,SAAU,CAAEvzH,KAAM,QAClB8hI,aAAc,CAAC,OAAQ,YAEzB,CACErtI,KAAM,SACN8+H,SAAU,CAAEvzH,KAAM,UAClB8hI,aAAc,CAAC,OAAQ,UAEzB,CACErtI,KAAM,OACN8+H,SAAU,CAAEvzH,KAAM,UAClB8hI,aAAc,CAAC,OAAQ,QAEzB,CAAErtI,KAAM,OAAQ8+H,SAAU,CAAEvzH,KAAM,QAAU8hI,aAAc,CAAC,SAC3D,CAAErtI,KAAM,QAAS8+H,SAAU,CAAEvzH,KAAM,UAAY8hI,aAAc,CAAC,UAC9D,CAAErtI,KAAM,UAAW8+H,SAAU,CAAEvzH,KAAM,QAAU8hI,aAAc,CAAC,WAC9D,CACErtI,KAAM,UACN8+H,SAAU,CAAEvzH,KAAM,QAClB8hI,aAAc,CAAC,OAAQ,YAG3B/oI,EAAK09H,QAAQn3H,SAAQ,SAACq0H,EAAKyC,GACzB,IAAMwL,EAAYD,EAAWvL,GACzBwL,IACFjO,EAAIl/H,KAAOmtI,EAAUntI,KACrBk/H,EAAIJ,SAAWqO,EAAUrO,aAG7Bx6H,EAAK29H,gBAAiB,EAGtB39H,EAAKs7H,OAAOngC,KAAK50F,SAAQ,SAACw5B,EAAKs7F,GAE7B,IAAM/sH,EAAmC,GACzCyxB,EAAIqkG,MAAM79H,SAAQ,WAAWwzH,GAAiB,IAAzB70H,EAAyB,EAAzBA,KACb2jI,EAAYD,EAAW7O,GACvB/rH,EACJ66H,GAAyC,WAA5BA,EAAUrO,SAASvzH,MAAqB/B,EACjD26D,WAAW36D,GACXA,EACF2jI,EAEoC,IAAlCA,EAAUE,aAAa3tI,QACpBkT,EAAYu6H,EAAUE,aAAa,MACtCz6H,EAAYu6H,EAAUE,aAAa,IAAM,IAC3Cz6H,EAAYu6H,EAAUE,aAAa,IACjCF,EAAUE,aAAa,IACrB/6H,GAEJM,EAAYu6H,EAAUE,aAAa,IAAM/6H,EAI3CM,EAAY,SAAD,OAAUyrH,EAAe,IAAO/rH,KAG/CM,EAAY8P,SAAZ,gBAAgCi9G,GAChCt7F,EAAIokG,aAAe,CACjBv3H,QAAS0B,MAIbtO,EAAKlI,aAAe8E,EAAQ0qI,qBA9EvB,kBAgFEtnI,GAhFF,4C,sBCnEP,SAASgpI,GAAgCp/H,GACvC,IAAMq6F,EAASr6F,EAAIutC,MAAM,KAIzB,MAAO,CAAE3gD,QAHOytG,EAAO,GAGLp+E,IAFNvnB,SAAS2lG,EAAO,GAAI,IAETp3F,OADM,MAAdo3F,EAAO,IAAc,EAAI,GAI1C,IAAMglC,GAA0C,CAC9CC,mBAAmB,EACnBC,MAAM,EACNC,kBAAkB,EAClBC,mBAAmB,EACnBC,mBAAmB,GAGd,SAAeC,GAAtB,qC,8CAAO,WACL/rI,EACAZ,GAFK,eAAA1D,EAAA,sEAIcsuI,GAAehqI,EAAQ,CACxC07H,mBAAmB,EACnBgO,qBAAsB,EACtBI,qBAAsB1qI,EAAQ0qI,qBAC9B5vE,eAAgB,kBAAM,KARnB,cAIC13D,EAJD,QAWA09H,QAAQ,GAAGhiI,KAAOsE,EAAK09H,QAAQ,GAAGhiI,KAAK7B,QAAQ,IAAK,IAEzDmG,EAAK09H,QAAQn3H,SAAQ,SAAAq0H,GACfqO,GAAerO,EAAIl/H,QAAOk/H,EAAIJ,SAAW,CAAEvzH,KAAM,cAIvDjH,EAAKs7H,OAAOngC,KAAK50F,SAAQ,SAACw5B,EAAKs7F,GAE7B,IAAM/sH,EAAmC,GACzCyxB,EAAIqkG,MAAM79H,SAAQ,WAAWwzH,GAAiB,IAAzB70H,EAAyB,EAAzBA,KACbu/H,EAASzkI,EAAK09H,QAAQ3D,GAC5B,GAAoB,mBAAhB0K,EAAO/oI,MAA6BwJ,EAAM,OACX8jI,GAAgC9jI,GAAzD1O,EADoC,EACpCA,QAASqvB,EAD2B,EAC3BA,IAAKhZ,EADsB,EACtBA,OACtByB,EAAY9X,QAAUA,EACtB8X,EAAY3X,MAAQkvB,EACpBvX,EAAYzX,IAAMgvB,EAClBvX,EAAYzB,OAASA,OAChB,GAAoB,oBAAhB43H,EAAO/oI,MAA8BwJ,EAAM,OACnB8jI,GAAgC9jI,GAAzD1O,EAD4C,EAC5CA,QAASqvB,EADmC,EACnCA,IAAKhZ,EAD8B,EAC9BA,OACtByB,EAAYu8D,KAAO,CACjBr0E,UACAG,MAAOkvB,EACPhvB,IAAKgvB,EACLhZ,eAEO3H,GAAQ+jI,GAAexE,EAAO/oI,MAEvC4S,EAAYm2H,EAAO/oI,MAAQmkE,WAAW36D,GAGtCoJ,EAAYm2H,EAAO/oI,MAAQwJ,KAG/BoJ,EAAY8P,SAAZ,aAA6Bi9G,EAAY,GACzCt7F,EAAIokG,aAAe,CACjBv3H,QAAS0B,MA/CR,kBAmDEtO,GAnDF,4C,sBCTP,IAEe,YAACmJ,GAAiC,IACvC6qC,EAAQ7qC,EAAR6qC,IADuC,EAETA,EAAI,mBAAlCj+C,EAFuC,EAEvCA,MAAOqgB,EAFgC,EAEhCA,UAAW2F,EAFqB,EAErBA,QAClB1c,EAAiB20C,EAAI,yBAArB30C,aACAsG,EAAmBquC,EAAI,+BAAvBruC,eAEFqzH,EAAY,CAAC,MAAO,MAAO,MAAO,MAAO,QAAS,eAClDwQ,EAAkB,CACtBC,IAAKlC,GACLmC,IAAKlC,GACLS,IAAKF,GACLpvD,IAAKgwD,GACLgB,MAAOb,GACP,cAAeS,IAGXK,EAAkB,IAAI9uI,OAAJ,cACfk+H,EAAUtvH,KAAK,KADA,cAEtB,KAGF,OAAO3T,EACJuB,MAAM,0BAA2B,CAChCyhI,SAAUhjI,EAAMC,SAASD,EAAMo/D,YAAY6jE,GAAY,OACvDx8E,SAAS,EACT08E,mBAAmB,EACnBgO,qBAAsB,EACtB7zE,oBAAqB,IAEtB7gD,UAAS,iBAAO,CACfwmH,YAEA6Q,gBAAY3vI,EACZoC,WAAOpC,MAER6Y,OAAM,SAAArb,GAAI,MAAK,CACd,oBACE,OACGA,EAAK4E,OACN5E,EAAKmyI,aACJnyI,EAAKmyI,WAAWjqI,MACflI,EAAKmyI,WAAW7xI,WAChBN,EAAKmyI,WAAW3xI,MAGtB,gBACE,OAAOke,EAAU1e,GAAMoyI,gBAEzB,sBACE,OAAO/tH,EAAQrkB,GAAMo/C,QAAQG,YAE/B,2BACE,IAAMse,EAAMx5C,EAAQrkB,GAAMo/C,QAAQG,WAAWv/C,EAAK27D,qBAClD,GAAIkC,EACF,OAAO5vD,EAAe4vD,EAAK,SAK/B,eACE,OACE79D,EAAKmyI,WAAW3xI,KAChBR,EAAKmyI,WAAW7xI,WACfN,EAAKmyI,WAAWjqI,MAAQlI,EAAKmyI,WAAWjqI,KAAKlE,MAIlD,oBACE,OAAOyE,KAAK8W,SAASM,SAAS,OAGhCmgD,eApCc,SAoCClhE,EAAiBsB,GAC9B,OAAO2hB,sBAAW/hB,GAAMq6C,gBAAgB2lB,eACtClhE,EACAsB,QAILL,SAAQ,SAAAC,GAAI,MAAK,CAChBqyI,cADgB,SACFC,GAIZ,GAHAtyI,EAAKmyI,WAAaG,EAClBtyI,EAAK4E,WAAQpC,EAETxC,EAAKmyI,WAAY,CAEnB,IAAMnuI,EAAOhE,EAAKuf,SAElB,GAAIvb,EAAM,CACR,IAAM5B,EAAQ8vI,EAAgBvrI,KAAK3C,GAC/B5B,GAASA,EAAM,KACA,QAAbA,EAAM,IAAgB4B,EAAK+F,SAAS,eACtC/J,EAAKqhI,SAAW,cAEhBrhI,EAAKqhI,SAAWj/H,EAAM,GAAGwd,kBAOnCg8C,uBAtBgB,SAsBO//C,GACrB7b,EAAK27D,oBAAsB9/C,GAG7B4lH,wBA1BgB,WA2BdzhI,EAAKwhI,mBAAqBxhI,EAAKwhI,mBAGjC+Q,wBA9BgB,SA8BQC,GAClBA,EAAY,IAAGxyI,EAAKwvI,qBAAuBgD,IAGjDjR,YAlCgB,SAkCJlmF,GACVr7C,EAAKqhI,SAAWhmF,GAGlB/4B,SAtCgB,SAsCP1d,GACPD,QAAQC,MAAMA,GACd5E,EAAK8kD,SAAU,EACf9kD,EAAK4E,MAAQA,GAGfypI,UA5CgB,WA6CdruI,EAAK8kD,SAAU,EACf9kD,EAAK4E,WAAQpC,GAGfiwI,aAjDgB,WAkDdzyI,EAAK4E,WAAQpC,EACbkc,EAAU1e,GAAM0yI,kBAKlB5Q,OAxDgB,WAwDP,WACP,IACE,IAAK9hI,EAAKmyI,WAAY,OACtB,IAAMQ,EACJb,EAAgB9xI,EAAKqhI,UACvB,IAAKsR,EACH,MAAM,IAAIjtI,MAAJ,qCAAwC1F,EAAKqhI,SAA7C,MACR,GAAIrhI,EAAK8kD,QACP,MAAM,IAAIp/C,MAAM,2CAClB1F,EAAK8kD,SAAU,EAEf,IAAMl3C,EAAajG,EAAa3H,EAAKmyI,YACrCvkI,EACG9B,OACAi1E,MAAK,SAAAj1E,GACJ,GAAIA,EAAK3F,KAvJG,IAwJV,MAAM,IAAIT,MAAJ,gEACqD,IAEvDstD,iBAHE,WAMT+tB,MAAK,kBAAMnzE,EAAW/B,cACtBk1E,MAAK,SAAAj7E,GACJ,OAAO9F,EAAK4yI,cAAgBC,iBAAM/sI,GAAUA,KAE7Ci7E,MAAK,SAAAj7E,GAAM,OAAI6sI,EAAW7sI,EAAkB9F,MAC5C+gF,MAAK,SAAAqkD,GACJ,EAAKiJ,YACL3vH,EAAU1e,GAAM8yI,mBAAmB1N,MAEpC96H,MAAM7B,KAAK6Z,UACd,MAAO1d,GACP6D,KAAK6Z,SAAS1d,UC9KT,YAAC6M,GAAiC,IACvC6qC,EAAc7qC,EAAd6qC,IAAK5a,EAASjwB,EAATiwB,KADkC,EAElB4a,EAAI,mBAAzBj+C,EAFuC,EAEvCA,MAAOqgB,EAFgC,EAEhCA,UAEaq0H,EAAoBrxG,EAAKgsG,IAA7CpB,mBAGF0G,EAAoB30I,EACvBuB,MAAM,oBAAqB,CAC1B2P,KAAMlR,EAAMqkB,QAAQ,eACpBmoH,aAAc,KAEfxvH,OAAM,SAAArb,GAAI,MAAK,CAEd,gBACE,IAAIiE,EAAIjE,EAAK6qI,aACb,OAAK5mI,GAILA,EAAIA,EAAEuR,cACC,SACLy9H,EACA5qG,GAGA,IAFA,IACQqkG,EAAUrkG,EAAVqkG,MAEFrK,EAAe,EACnBA,EAAeqK,EAAMhpI,OACrB2+H,GAAgB,EAChB,CACA,IAAM8C,EAAOuH,EAAMrK,GAGnB,GAAI8C,EAAK33H,MAAQ23H,EAAK33H,KAAKgI,cAAczL,SAAS9F,GAAI,OAAO,EAE/D,OAAO,IAnBA,WACL,OAAO,QAsBdlE,SAAQ,SAAAC,GAAI,MAAK,CAChB+qI,UADgB,SACN9mI,GACRjE,EAAK6qI,aAAe5mI,GAEtB8Z,MAJgB,WAKd/d,EAAK6qI,aAAe,QAI1B,OAAOxsI,EACJuB,MAAM,4BAA6B,CAClCszI,YAAa70I,EAAMC,SACjB00I,GACA,iBACG,CACCzjI,KAAM,cACNs7H,aAAc,OAGpBsI,cAAe90I,EAAMwc,MAAMk4H,KAE5B13H,OAAM,SAAArb,GAAI,MAAK,CACd,cACE,MAAO,CAACA,EAAKkzI,aAAN,mBAAsBlzI,EAAKmzI,gBAAe58H,QAAO,SAAAkR,GAAC,QAAMA,MAEjE2rH,qBAJc,SAIOvI,GAEnB7qI,EAAKkzI,YAAc,CACjB3jI,KAAM,cACNs7H,iBAGJ2C,iBAXc,SAWGnD,EAAgBhiG,GAC/B,IAAK,IAAI/kC,EAAI,EAAGA,EAAImF,KAAK2e,QAAQ1jB,OAAQJ,GAAK,EAC5C,IAAKmF,KAAK2e,QAAQ9jB,GAAG09D,UAAUqpE,EAAOhiG,GAAM,OAAO,EAErD,OAAO,OAGVtoC,SAAQ,SAAAC,GAAI,MAAK,CAChBqzI,qBADgB,SACKhR,GAAsB,IACjCS,EAAapkH,EAAU1e,GAAMolI,YAAYY,QAAQ3D,GAAjDS,SACR9iI,EAAKmzI,cAAcjjI,KAAK,CACtBX,KAAMuzH,EAASvzH,KACf8yH,kBAGJiR,mBARgB,SAQG/8H,GACjB,OAAOvW,EAAKmzI,cAAcxuH,OAAOpO,IAEnCg9H,gBAXgB,WAYdvzI,EAAKmzI,cAAcp1H,QACnB/d,EAAKkzI,YAAYn1H,cC3EnBy1H,GAAsD,CAC1D,CACEpyI,MAAO,gBACPskB,KAAM+tH,KACNjuH,QAHF,SAIIkuH,EACAtO,GACA,MACMzB,EAAS,UAAGyB,EAAY5B,uBAAf,aAAG,EAA6BG,eAC7BnhI,IAAdmhI,GACFyB,EAAYxB,OAAOngC,KAAKkgC,EAAY,GAAGiJ,kBAMhC,YAACn7H,GAAiC,IACvC6qC,EAAc7qC,EAAd6qC,IAAK5a,EAASjwB,EAATiwB,KACLgU,EAAS4G,EAAT5G,KAFuC,EAGV4G,EAAI,mBAAjCj+C,EAHuC,EAGvCA,MAAOqgB,EAHgC,EAGhCA,UAAWi1H,EAHqB,EAGrBA,OAClB31H,EAAkBs+B,EAAI,8CAAtBt+B,cAEF41H,EAAmBlyG,EAAKklG,IACxBiN,EAAoBnyG,EAAKimG,IACzBmM,EAAsBpyG,EAAK8wE,IAI3B5yG,EAAQvB,EACXuB,MAAM,kBAAmB,CACxB2P,KAAMlR,EAAMqkB,QAAQ,mBACpB3K,SAAU,EACV2U,OAAQruB,EAAMC,SACZD,EAAMgpD,WACJ,wBACAhpD,EAAMa,QACN,SAAAid,GAAC,OAAIA,GAVK,MACI,KAclB43H,kBAAkB,EAClB7lD,0BAA0B,EAC1B8lD,oBAAoB,EAEpBjhC,eAAgB10G,EAAMC,SAASw1I,GAAqB,kBAClDA,EAAoB1pI,OAAO,OAI7BiC,KAAMhO,EAAMC,SACVD,EAAMo/D,YAAY,sBAAuB,CAAC,SAAU,YACpD,UAEFqrE,aAAczqI,EAAMC,SAASu1I,GAAmB,kBAC9CA,EAAkBzpI,YAEpBg7H,YAAa/mI,EAAMqC,MAAMkzI,KAE1B94H,UAAS,iBAAO,CACfpC,MAAO,IACPmrH,aAAcnuF,EAAKmzB,WAAW2qE,QAE/Bn4H,OAAM,SAAArb,GAAI,MAAK,CACd,qBACE,QAASA,EAAKolI,aAAeplI,EAAKolI,YAAY+H,UAGhD,uBACE,QAASwG,EAAO3zI,GAAMulI,kBAGxB,iBACE,GAAIvlI,EAAKolI,aAAeplI,EAAKolI,YAAYxB,OAAOuJ,SAAU,CACxD,IAAMz6G,EAAW1yB,EAAKolI,YAAYxB,OAAO0J,qBACzC,OAAI56G,EAAShvB,OAAegvB,EACrB1yB,EAAKolI,YAAYxB,OAAOwJ,qBAKnC,eACE,GAAIptI,EAAKolI,aAAeplI,EAAKolI,YAAYhlI,aAAc,CAErD,IACM6mD,GADallC,sBAAW/hB,GAAMu/C,YACJ,IAAI94C,MAClC,SAAAo3D,GAAG,aACD5vD,yBAAe4vD,EAAK,WAApB,UAAgC79D,EAAKolI,mBAArC,aAAgC,EAAkBhlI,iBAEtD,GAAI6mD,EACF,OAAOA,QAMdlnD,SAAQ,SAAAC,GAAI,MAAK,CAChBi0I,gBADgB,SACAC,GACdl0I,EAAK6jI,aAAa1hI,QAAQ+xI,IAE5Bh2H,SAJgB,SAIPC,GAEP,OADAne,EAAK0Y,MAAQyF,EACNne,EAAK0Y,OAEdwwC,UARgB,SAQN0nC,GAGR,OAF2B5wF,EAAK0sB,OAA5BkkE,EA/EQ,GA+E6BA,EA/E7B,GAiFL5wF,EAAK0sB,QAEdy8B,aAbgB,SAaH/rC,GACX,IAAMgsC,EAAYppD,EAAK0sB,OAEvB,OADkBjkB,KAAKygD,UAAUlpD,EAAK0sB,OAAStP,GAC5BgsC,GAErB2nC,YAlBgB,SAkBJ3zE,GACV,IAAM4zE,EAAWhxF,EAAK0Y,MAEtB,OADiBjQ,KAAKyV,SAASle,EAAK0Y,MAAQ0E,GAC1B4zE,GAIpB8hD,mBAzBgB,SAyBG1N,GACjBplI,EAAK+yG,eAAewgC,kBAEpBvzI,EAAKolI,YAAcA,EACnBplI,EAAKqM,KAAO,WAGd8nI,cAhCgB,WAiCdn0I,EAAKqM,KAAO,UAGdqmI,eApCgB,WAqCV1yI,EAAKoyI,iBAAgBpyI,EAAKqM,KAAO,YAGvCmzD,UAxCgB,WAyCd9gD,EAAU1e,EAAM,GAAG0/D,WAAW1/D,QAMpC,OAFmB3B,EAAM8B,QAAQ6d,EAAepe,IC9JnC,eAAkC,IAA/B48C,EAA+B,EAA/BA,UACVlsC,EAAWksC,EAAU,gDAErBptC,EAAiBotC,EAAU8yD,IAGjC,OAAO,IAAIh/F,EAAS,CAAEtM,KAAM,kBAAmB+L,WAF5BysC,EAAUsO,IAE8B17C,oBCJxCglI,G,4MACnBpwI,KAAO,wB,sDAECyN,GACNA,EAAc6xD,aAAY,kBACxB7xD,EAAc+qC,UAAU63F,S,gCAIlB5iI,GACJoyD,iCAAsBpyD,EAAc6oC,YACtC7oC,EAAc6oC,UAAUwpB,gBAAgB,CAAC,OAAQ,OAAQ,CACvD1iE,MAAO,mBACPskB,KAAM4uH,KACN9uH,QAAS,SAACtC,GACRA,EAAQ8gD,QAAQ,kBAAmB,W,GAfM54B,I,sBCJpC,YAAA35B,GAAiB,IACtB+qC,EAAc/qC,EADQ,YAEE+qC,EAFF,cAEtBzzC,EAFsB,WAGxB2G,GAHwB,YAGhB8sC,EAAd,UACMkqC,EAAalqC,EAAnB,gCACQ7pC,EAAe6pC,EALO,uCAMxB4uC,EAAO5uC,EAAb,0BACMkkF,EAAmBlkF,EAAzB,sCACMmkF,EAAWnkF,EAAjB,8BACQ1vB,EAAiB0vB,EATK,iCAUtBnpC,EAASmpC,EAVa,iCAcxB9nC,EAAQ,CACZgE,MADY,EAEZvF,WAFY,OAGZgB,UAHY,aAIZ4lD,UAAW,qBAEPrnD,EAAYC,GAAW,SAAAC,GAC3B,MAAO,CACL6X,KAAM,CACJy9D,aAAct1E,UADV,GAEJO,WAFI,QAGJa,SAAU,UAEZ0rB,OAAQ,CACN1rB,SADM,SAENygB,WAFM,SAGNtgB,UAHM,aAINuY,OAnBN,GAoBMvZ,WAAYE,EALN,MAQR00H,aAAc,CACZ9+G,OAAQ,GAEVsrH,eAAgB,CACdtkI,QAAS,QAEXukI,yBAA0B,CACxB9oD,YAAa,CAAC,CAAC,MAAO,QAASr4E,EADP,OAExBW,SAAU,UAEZygI,oBAAqB,CACnB3hI,QAASF,UADU,GAEnBO,WAAYE,EAAK,UAKjB+0H,EAAer/H,GAAS,YAAe,IAAZnJ,EAAY,EAAZA,MACzB0U,EAAU5B,IAChB,OACE,mBACEoC,UAAWR,EADb,aAEEolB,WAFF,EAGE3mB,QAHF,EAIEic,UAJF,MAKE2K,WAAW,UAEX,mBAAMC,MAAI,GACR,mBACEpU,QAAS,kBAAM5lB,EAAN,iBACTkV,UAAWR,EAFb,WAGEE,MAHF,sBAIEub,cAJF,yBAKE9c,MAAM,aAEN,qBAhBR,YAuBIyhI,EAAsB3rI,GAAS,YAAqB,IAAlB4rI,EAAkB,EAAlBA,YAChCrgI,EAAU5B,IAEhB,OACE,mBACEgnB,WADF,EAEE5kB,UAAWR,EAFb,oBAGEI,MAAO,CAAEgY,OAAQioH,EAAYC,+BAE7B,mBAAMh7G,MAAI,GACR,mBACEq9D,QACE,mBACEniF,UAAWR,EADb,YAEEmR,QAASkvH,EAFX,yCAGEnvH,QAAS,SAAAuwE,GAAG,OACV4+C,8CACE5+C,SAFQ,YAOhB30F,MAAM,qCAmEhB,OAAO2H,GA5DP,YAAoC,IAATnJ,EAAS,EAATA,MACnB0U,EAAU5B,IAGdy2C,EAKEvpD,EAT8B,aAKhCgyG,EAIEhyG,EAT8B,iBAMhCi1I,EAGEj1I,EAT8B,8BAOhCk1I,EAEEl1I,EAT8B,2BAQhCm1I,EACEn1I,EAT8B,iBAWlC,OACE,uBAAKkV,UAAWR,EAAhB,KAA8Byb,cAAanwB,EAAMF,IAC/C,mBAAMg6B,WAAN,EAAgB1K,UAAhB,MAAgCla,UAAWR,EAAQorB,QACjD,mBAAM9F,MAAI,GACR,mBAAch6B,MAAOA,MAGzB,uBAAKkV,UAAWR,EAAQigI,gBACtB,uBAAKz/H,UAAWR,EAAQkgI,0BACtB,mBAA+B50I,MAAOA,EAAMo1I,mBAG7CD,EACC,gCACE,mBACEhoH,OAAQ,SAAA3P,GACN,IAAM63H,EAAOr1I,4BAAb,GAEA,OADaA,+BAAb,IAGFotB,UANF,EAOEC,SAPF,EAQEvY,MAAOA,IAET,uBACEI,UAAWR,EADb,sBAEEI,MAAO,CAAEgE,MAAO9Y,eAAmB8Y,QAEnC,mBAAqBi8H,YAAa/0I,IAClC,mBAA4BA,MAAOA,EAAMs1I,iBA5BnD,MAiCE,mBACEnoH,OADF,EAEErY,MAAO,CACLgY,OADK,EAELvZ,WAFK,OAGLgB,UAHK,aAIL4lD,UAAW,4BC7JR,eAAmB,IACxBqG,GAAmB5jB,EADK,EAAhBA,WAAgB,qCAGhC,wBASE,IAAM24F,EAAN,GASA,OARAnP,WAAgB,cACd,IAAIoP,WAAJ,IADwC,IAElC5nI,EAAS66B,QAFyB,QAGxC,WAAI0kG,kBAAmCv/H,EAAO26D,WAAP36D,IACvC2nI,EAAUpI,EAAVoI,YAIF,kCAEEzuH,SAAU,sBAAF,OAFV,GAGE5nB,QAASu2I,EAHX,QAIEp2I,MAAOo2I,EAJT,MAKEl2I,IAAKk2I,EALP,IAMEliE,KAAM,CACJr0E,QAASw2I,EADL,QAEJr2I,MAAOq2I,EAFH,MAGJn2I,IAAKm2I,EAAKn2I,OAKhB,sBAQE,IAAMk2I,EAAOj1E,EACX/3B,QAAUktG,EAAVltG,IADyB,KAA3B,GAIMitG,EAAOl1E,EACX/3B,QAAUktG,EAAVltG,IADyB,KAA3B,GAUA,OAAOmtG,EAAiB,EALc,CACpCD,EADoC,GAEpCA,EAFF,IAKuB,MAAvB,GAUF,wBAQE,IAAME,EAAS,SAAAC,GAAK,OAAIrtG,WAAJ,MACdgtG,EAAO,CACXv2I,QAAS22I,EAAOE,EADL,IAEX12I,MAAO2H,SAAS6uI,EAAOG,EAAR,IAARhvI,IAFI,EAGXzH,IAAKyH,SAAS6uI,EAAOI,EAAR,SAETP,EAAO,CACXx2I,QAAS22I,EAAOE,EADL,IAEX12I,MAAO2H,SAAS6uI,EAAOG,EAAR,IAARhvI,IAFI,EAGXzH,IAAKyH,SAAS6uI,EAAOI,EAAR,SAUf,OAAOL,EAAiB,EARc,CACpCG,EADoC,GAEpCC,EAFoC,GAGpCC,EAHoC,GAIpCF,EAJoC,GAKpCC,EALoC,GAMpCC,EANF,IAQuB,MAAvB,GAqDF,MAAO,CACLC,mBA1CF,kBAAmE,IACzD9P,EAAgCqE,EADyB,QAChD7E,EAAuB6E,EADyB,mBAE3D0L,EAAN,GACAvQ,WAA2B,SAAAnD,GACzB,IAAMoF,EAAmBzB,EAAzB,GACK+P,EAAYtO,WAAjB,QACEsO,EAAYtO,WAAZsO,UACFA,EAAYtO,WAAZsO,iBAEF,IAAMR,EAAwBQ,aAA9B,GACMH,EAAwBG,YAA9B,GACMF,EAAsBE,UAA5B,GACMJ,EAAsBI,UAZqC,GAejE,OAAIR,UAAJ,EACSS,EAAmC,EAAD,MAAzC,GASAL,aACAC,UADAD,GAEAE,UAHF,EAKSI,EAAyC,EAAD,QAA/C,QALF,GAmBAD,mCAFK,EAGLC,6CCrJW,YAAAxkI,GAAiB,IACtB+qC,EAAc/qC,EADQ,UAEtBsQ,EAAey6B,EAFO,iCAItBs5F,EAAuBt5F,EAJD,uBAM9B,oBAME,GAAInU,EAAJ,aAAsB,CACpB,GAAIA,eAAJ,WAAiC,OAAOA,eAAP,WACjC,GAAIA,eAAJ,QAA8B,OAAOA,eAAP,QAEhC,IAAM6tG,EAAeJ,EACnBd,EADqC,gBAIrC9xH,kBAJF,gBAMA,KAAkB,OAAOgzH,EAI3B,sBAOE,IAAMhzH,EAAUnB,EAAhB,GACMnL,EAAcu/H,EAA2B,EAAD,IAA9C,GAMA,KAAiB,CACf,IAAMjhI,EAAU,IAAI,GAApB,GACAgO,kBACA,IAAM7S,EAAWoB,cAAjB,uBACQyjI,EAAiBkB,EAJV,aASf,OAJqB/lI,gCAArB,IAuDJ,MAAO,CACL8lI,2BADK,EAELE,wCAFK,EAGLC,uCAxBF,oBAOE,IACE,IAAMnsC,EAAeksC,EAAwC,EAAD,MAA5D,GAOA,OAAOxmH,QAAP,GACA,MAAOnrB,GACP,WAQF6xI,oCAlDF,oBAOE,IAAMpsC,EAAeksC,EAAwC,EAAD,MAA5D,GAOA,KAAkB,KAERnB,EAAiBkB,EAFT,aAGhBjsC,qBAAkC+qC,UAAlC/qC,IACAA,qBAAkC+qC,UAAlC/qC,IAEgBpoF,EAAhB,GACAmB,qCC3EN,SAASszH,GAAoBthI,EAASuhI,EAAYhlI,GAAe,OAGrB+qC,EAFpB/qC,EADyC,iCAGvDkS,EAHuD,oBAMzDT,GAAUnB,EAN+C,cAM/D,GACAmB,kBACA,IAAMQ,EAAOC,EAAb,GAEMwmF,EADW14F,cAAjB,uBACqBpB,8BAV0C,GAkC/D85F,qBAAkCzmF,UAAlCymF,IACAA,qBAAkCzmF,UAAlCymF,IACAA,cAA2Bj1F,EAA3Bi1F,KAEAjnF,mCAGa,gBAAAzR,GAAiB,IACtB+qC,EAAc/qC,EADQ,YAEA+qC,EAFA,QAEtBqM,EAFsB,UAEb6pD,EAFa,aAGyBl2D,EAHzB,mBAGtBn+C,EAHsB,QAGfqgB,EAHe,YAGJuqC,EAHI,cAGSzgD,EAHT,cAMtBwV,EAAkBw+B,EANI,4DAStBz6B,EAAey6B,EATO,iCAUtBvuC,EAAmBuuC,EAVG,8CAYxBk6F,EAAsBjlI,cAA5B,mBACMklI,EAAmBllI,cAAzB,gBAb8B,EAwB1B+qC,EAxB0B,IAqB5B85F,EArB4B,yCAsB5BC,EAtB4B,sCAuB5BJ,EAvB4B,6BA0BxBv2I,EAAQvB,EAAA,wBACc,CACxBkR,KAAMlR,UADkB,mBAExBuzG,iBAFwB,EAGxBllF,OAAQruB,EAAA,SACNA,EAAA,mCAEEA,EAFF,QAGE,SAAA8d,GAAC,OAAIA,GAnBb,OACA,KAuBIy6H,0CAZwB,EAexBvqI,KAAMhO,WACJA,oCAAyC,CAAC,SADtCA,YAfkB,UAoBxB22I,gBAAiB32I,EAAA,SAAeq4I,EAAf,YAA+C,kBAC9DA,EAAA,kBAAsC,CACpCnnI,KADoC,kBAEpCwkI,kBAFoC,EAGpC7lD,0BAA0B,OAI9BgnD,aAAc72I,EAAA,SAAes4I,EAAf,YAA4C,kBACxDA,EAAA,kBAAmC,CACjCpnI,KADiC,eAEjC2+E,0BAFiC,EAGjCC,yBAHiC,EAIjCE,mBAAmB,SAlCb,UAsCF,iBAAO,CACf31E,MAAO,QAvCG,OAyCL,SAAA1Y,GAAI,MAAK,CACd,mBACE,OAAOA,yBAAP,cAGF,mBAAmB,IACTinD,EAAajnD,EADJ,yBAEjB,KAAc,OAAOiO,EAAeg5C,EAAtB,SAIhB,uBACE,kBAAOjnD,wBAGT,oCACE,IAAMkjB,EAAUnB,EAAhB,GACA,MAAO,CACLxS,KADK,oBAELwL,UAAW/a,8BAAD,SACH,qBACHm2I,EAA2B,EAEzBn2I,EAFwB,kBADvB,MADG,QASA,SAAAynB,GAAC,OAAIoI,QAAJ,QAKf,wBAOE,OAHgB,IAAI4pE,EADhBhoF,iBAHkB,mCAKpBzR,EADF,+BAGA,eAGF,yCAgBE,MAfsB,CACpBuP,KADoB,eAEpBoS,QAAS,8BAAF,OAAgC3hB,EAFnB,IAGpBgE,KAHoB,6BAIpB+hB,QAAS/lB,EAJW,8BAKpB8lB,cAAe,CAAC9lB,EALI,cAMpB4iB,SAAU,CACR,CACErT,KADF,sBAEEyU,UAAW,4CAAF,OAA8ChkB,EAFzD,IAGEizF,aAAcujD,GAHhB,WAIEt8F,SAAU,CAAE3qC,KAAM,0CAhGhB,UAuGF,iBAAO,CACfslI,8BAA+B6B,EADhB,eAEf5B,2BAA4B6B,EAFb,eAGf/B,6BAlHJ,OAQc,SA4GH,SAAA50I,GAAI,MAAK,CAChB4d,YADgB,WAGdqrC,EAAY,EAEVJ,GACE,WAEE,GAAI7oD,EAAJ,iBAA2B,CACzB,IAAM62I,EAAmB1pI,WAAzB,IAAoCnN,SAC9B82I,EAAoB92I,QAA1B,EACAA,2BAA8B62I,EAJhC,GAKE72I,gCAEAA,2BAA8BA,EAA9BA,SAGJ,CAAEgE,KAAM,mCAIZilD,EAAY,EAEVJ,GACE,WACE7oD,4BAA+BA,SA9I3C,IA+IYA,yBACEA,SAhJd,GACA,MAkJU,CAAEgE,KAAM,oCAKZilD,EAAY,EAEVJ,GACE,WAAM,IAEFzoD,EAIEJ,EANA,aAGF42I,EAGE52I,EANA,yCAIFk1I,EAEEl1I,EANA,aAKF+2I,EACE/2I,EANA,kBAOI2d,EAAWu3H,EAPf,OAQEhyH,EAAUnB,EAAhB,GACA,KAAkB,CAChB,IAAMklC,EAAW/jC,sBAAjB,GACA,KAAc,KACG8zH,EAAoB/vF,EADvB,QAOZ,GAFE+vF,EAHF,EAGoBxuI,EAAlBwuI,GAFAA,GAIF,GACE,OAAIr5H,SAAqB,KAErBgjD,EACEz9C,sBAHmB,uBAKvB6zH,QACQ,SAAAE,GAEJ,IAAMC,EAA2B,IAAIjxH,IACnCgxH,EAAA,KACE,SAAAn4I,GAAO,OACL6hE,MADK,MAILloD,EAAmBu+H,EAAA,QAAuB,SAAA3zI,GAAC,OAC/C6zI,MAA6B7zI,EADkB,YAGjD6xI,sBACEl/H,WAAWA,eADbk/H,QAZJ6B,OAgBS,SAAAryI,GAAC,OAAIwwI,WAAJ,YAGZA,8BAGFA,6BAIN,CAAElxI,KAAM,4CAKZilD,EAAY,EAEVypD,GACE,iBAAO,CACLykC,mBACEn3I,GAAQA,EAFL,mCAGLI,aAAcJ,GAAQA,EAAKI,iBAE7B,SAAAkI,GACE,MADM,IAEElI,EAAqCkI,EAFvC,aAEgB6uI,EAAuB7uI,EAFvC,mBAIFtI,sBAAJ,QACEA,+BAAiC,SAAAqe,GAC/Bre,yBAA4Bqe,gBAA5Bre,YAKAI,GAAJ,GACEJ,8BAAmD,CACjDI,oBAIN,CACE4D,KADF,8CAEEoiD,iBAAiB,KAMvB6C,EAAY,EAEVJ,GAAQ,WACN7oD,kCAGE,CACE,CACEoB,MADF,yBAEEskB,KAFF,KAGE2K,SAHF,kBAII,OAAQimH,EAAuC,EAAD,MAA9C,IAQF9wH,QAZF,kBAaI+wH,EAAoC,EAAD,MAAnCA,YAcdr4H,SAhKgB,YAiKdle,WAEFkpD,UAnKgB,YAsKd,OAF2BlpD,SAAvB4wF,EA3RV,IA2RM,EA3RN,IA6Ra5wF,EAAP,QAEFmpD,aAxKgB,YAyKd,IAAMC,EAAYppD,EAAlB,OAEA,OADkBA,YAAeA,SAAjC,GACA,GAGFm0I,cA9KgB,WA+Kdn0I,mCAGF0yI,eAlLgB,WAmLd1yI,oCAGFw/D,UAtLgB,WAuLd9gD,EAAU1e,EAAV0e,kBAGFzD,oBA1LgB,YA2Ldjb,uCAGFo3I,4CA9LgB,YA+Ldp3I,2CAAgD6vB,QAAhD7vB,QAMN,MAAO,CAAE+P,WAFU1R,YAAnB,KClXa,eAAmB,IAAhBm+C,EAAgB,EAAhBA,UACVlsC,EAAWksC,EAAjB,gDAEMptC,EAAiBotC,EAAvB,IAGA,OAAO,IAAIlsC,EAAS,CAAEtM,KAAF,kBAA2B+L,WAFxBysC,EAJS,eAM2BptC,oBCAxCioI,G,4MACnBrzI,KAAO,wB,sDAECyN,GACNA,EAAc6xD,aAAY,kBACxB7xD,EAAc+qC,UAAU86F,S,gCAIlB7lI,GACJoyD,iCAAsBpyD,EAAc6oC,YACtC7oC,EAAc6oC,UAAUwpB,gBAAgB,CAAC,OAAQ,OAAQ,CACvD1iE,MAAO,eACPskB,KAAM6xH,KACN/xH,QAAS,SAACtC,GACRA,EAAQ8gD,QAAQ,kBAAmB,W,GAfM54B,ICPpC7tB,iCACb,aACA,CACEvP,YAAa,CACXuB,KAAM,eACNiO,aAAc,CAAEhd,IAAK,qBAGzB,CAAEid,iBAAiB,I,WCNN,cACb,MAAO,CACLpO,gBACAQ,aAAc2nI,OCuBHzuI,2BAxBf,SAAsByG,GAOnB,IACOkJ,EAAkBlJ,EAAlBkJ,MAAOgU,EAAWld,EAAXkd,OACTotD,EAAc3sE,KAAKkN,KAAK3B,GAE9B,OACE,yBACE5D,UAAU,kBACVJ,MAAO,CAAE7H,SAAU,WAAY6L,MAAOohE,EAAaptD,WAEnD,kBAAC,GAAD,iBACMld,EADN,CAEEkF,MAAO,CAAE7H,SAAU,WAAYojB,KAAM,EAAGrB,IAAK,UCtBtCrR,iCACb,cACA,CACEy+D,UAAW,CACTzsE,KAAM,QACNqB,YAAa,6CACb4M,aAAc,QAEhBvK,MAAO,CACL1D,KAAM,QACNqB,YAAa,+CACb4M,aAAc,4HAGd+jC,kBAAmB,CAAC,QAAS,WAAY,cAG3CxtC,UAAW,CACTxE,KAAM,UACNqB,YAAa,mDACb4M,aAAc,MAGlB,CAAEC,iBAAiB,I,sBCmBAg6H,G,qNACCjoI,G,0IAEhBuL,EAMEvL,EANFuL,SACAjN,EAKE0B,EALF1B,OACArE,EAIE+F,EAJF/F,QACA+E,EAGEgB,EAHFhB,Q,EAGEgB,EAFFosB,6B,MAAwB,E,EACxBwI,EACE50B,EADF40B,Y,cAEe36B,E,GAAVZ,E,KACD6P,GAAS7P,EAAO1J,IAAM0J,EAAO5J,OAASuP,EACtCke,EAASze,yBAAeH,EAAQ,a,SACpBs2B,EAAYz1B,cAAcH,G,UAAtCjJ,E,OAEAmT,EAAQ,GAAQgU,EAAS,E,yCACtB,CAAEA,OAAQ,EAAGhU,MAAO,EAAG6uB,kBAAkB,I,OAWlD,GARMvM,EAASD,GACb5tB,KAAKkN,KAAK3B,EAAQkjB,GAClBlP,EAASkP,GAELmsC,EAAIxiE,GAAOiJ,EAAUrB,KAAKm3D,KAAK,KAC/BgD,EAAMtsC,EAAOiB,WAAW,OAC1BoxB,MAAMzxB,EAAuBA,GAC3BogD,EAAYlR,KAAM78D,yBAAeH,EAAQ,cAC3CiN,EAASrX,OAAQ,CAKnB,IAJMkJ,EAASmO,EAAS,GAAG28H,KACvBxuE,EAAW,EACXyuE,EAAS,EACTC,EAAS,EACJt0I,EAAI,EAAGA,EAAIyX,EAASrX,OAAQJ,IAAK,EACTyX,EAASzX,GAAhCo0I,EADgC,EAChCA,KAAMG,EAD0B,EAC1BA,KAAMx7E,EADoB,EACpBA,OACpB6M,EAAW/7D,KAAKuM,IAAI2iD,EAAQ6M,GAC5ByuE,EAASxqI,KAAKC,IAAID,KAAKC,IAAIsqI,EAAMG,GAAOF,GACxCC,EAASzqI,KAAKuM,IAAIvM,KAAKuM,IAAIg+H,EAAMG,GAAOD,GAG1C,IADAtwE,EAAIwwE,QAAQ3qI,KAAKy/E,GAAK,GACbtpF,EAAI,EAAGA,EAAIyX,EAASrX,OAAQJ,IAAK,EACTyX,EAASzX,GAAhCo0I,EADgC,EAChCA,KAAMG,EAD0B,EAC1BA,KAAMx7E,EADoB,EACpBA,OACpBiL,EAAIjrC,UAAYpuB,yBAAeH,EAAQ,QAAS,CAC9CuuD,EACA6M,EACA8S,IAEF1U,EAAIU,UAAU0vE,EAAO9qI,GAAUm7D,GAAI8vE,EAAOjrI,GAAUm7D,EAAGA,EAAGA,G,iBAItC9sC,GAAkBD,G,eAApCa,E,yBACC,CACLA,YACAnP,SACAhU,U,yKAISyG,G,iGAMD1W,KAAK++D,cAAcroD,G,uBAJ3BuN,E,EAAAA,OACAhU,E,EAAAA,MACAmjB,E,EAAAA,UACA0L,E,EAAAA,iBAEI93B,EAAUC,IAAMC,cACpBlH,KAAK2G,eADS,2BAGT+P,GAHS,IAIZtW,OAAQsW,EAAY1V,QAAQ,GAC5BijB,SACAhU,QACAmjB,cAEF,M,kBAGK,CACLpsB,UACAosB,YACAnP,SACAhU,QACA6uB,qB,2QAKFnD,E,EAAAA,YACAt9B,E,EAAAA,OACA0H,E,EAAAA,QACA/E,E,EAAAA,Q,SAEuB26B,EACpBj7B,YAAYM,EAAQ,GAAI,CAAE3C,SAAQ0H,YAClCpF,KAAKwiD,gBACL/mB,Y,cAHG9pB,E,yBAQCA,G,iJAGgBsoB,GAEvB,OADmB,eAAMA,K,iDAKzBA,EACAj7B,GAGA,IAAMk7B,EAAe,eAAMD,GACrBE,EAAc,IAAIryB,IAIxB,OAFAoyB,EAAavoB,SAAWwoB,EACxBD,EAAaH,SAAW/6B,EAAK+6B,SACtBG,M,GAtH8B6H,IC1B1B4sG,GAbe,SAACtmI,GAC7B,IAAMumI,EAA0BvmI,EAAc2Q,gBAAgB,eAC3D/S,aAEH,OAAOkO,8BACL,mBACA,CAAE28B,SAAU89F,GACZ,CAAEntF,kBAAmBxJ,GAA+B5jC,iBAAiB,KCN1D,YAACpO,GAAD,OACbhR,QACG8B,QACC,mBACA+iD,GACA7kD,QAAMuB,MAAM,CACV2P,KAAMlR,QAAMqkB,QAAQ,oBACpBnE,cAAeoE,iCAAuBtT,MAGzCgM,OAAM,SAAArb,GAAI,MAAK,CACd,gBACE,MAAO,iBAET,uBACE,MAAO,eAOT,kBACE,IAAM8N,EAAS9N,EAAKw6C,aAAanrC,aAAajF,OAC5C6X,kBAAQjiB,EAAM,aAAe,IAG/B,8CACKA,EAAK0qD,qBACLzrC,GAAqBjf,IAF1B,IAGE8N,SACAqU,aAAcniB,UCbT,sE,4MCFbgE,KAAO,Y,sDAECyN,GACNA,EAAcu6D,gBACZ,kBACE,IAAIp8D,EAAJ,aACE5L,KAAM,cACHyN,EAAc+qC,UAAUy7F,SAGjCxmI,EAAc06D,iBACZ,kBACE,IAAIsrE,GAAY,CACdzzI,KAAM,cACNoL,eAAgB8oI,GAChB7oI,aAAc8oI,QAGpB1mI,EAAc0xD,cAAa,WACzB,IAAM9zD,EAAekO,8BACnB,WACA,GACA,CACEstC,kBAAmBhlC,GAAsBpU,GACzCiM,mBAAoB,YAGxB,OAAO,IAAI5N,EAAU,CACnB9L,KAAM,WACNqL,eACAU,WAAYyS,GACV/Q,EACA,WACApC,QAINoC,EAAcusC,gBAAe,WAC3B,IAAM3uC,EAAe+oI,GAAoC3mI,GACzD,OAAO,IAAItB,EAAY,CACrBnM,KAAM,mBACNqL,eACAU,WAAYsoI,GAA6BhpI,GACzCe,UAAW,WACXC,SAAU,mBACVjB,eAAgB8zD,Y,GA9Ce93B,K,uDCSjC14B,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC0lI,SAAU,CACR17G,UADQ,SAERvR,YAAa,OAEfktH,YAAa,CACX,UAAW,CACT3kI,gBAAiB2b,gBACf3c,kBADmB,aAEnBA,iBAHO,cAKT,uBAAwB,CACtBgB,gBAAiB,iBAIvB4kI,eAAgB,CACd1lI,QAASF,cAEX6lI,YAAa,CACX5rI,SADW,WAEXsjB,MAAOvd,UAFI,GAGXgc,IAAKhc,UAHM,GAIXK,MAAOL,yBAMX,SAAS8lI,GAAelpI,GAKtB,IAAM8E,EAAU5B,KACR0e,EAAkC5hB,EAFzC,QAEgBsf,EAAyBtf,EAFzC,KAEsBmpI,EAAmBnpI,EAFzC,iBAG6B2d,mBAH7B,sBAGM0yC,EAHN,KAGe+4E,EAHf,OAI2CzrH,oBAJ3C,sBAIM0rH,EAJN,KAIsBC,EAJtB,KAMK1kH,EAAc,WAClBorB,qBAbJ,mBAaIA,GACApuB,MAGF,OACE,oCACE,wBACEA,QADF,EAEE2rC,kBAFF,sBAGEjuC,KAAMA,GAEN,wBAAapvB,GAAG,uBAAhB,4BAEG00B,EACC,wBAAYtf,UAAWR,EAAvB,YAA4CkR,QAAS4O,GACnD,uBAFQ,OAPhB,MAaE,4BACE,mGAEE,wBAAY5O,QAAS,kBAAMszH,GAAN,KACnB,uBAJN,QAOE,wBAAaxmH,UAAU,YACrB,wBACEjG,aADF,SAEEroB,KAFF,UAGEoO,MAHF,EAIE4jB,SAAU,SAAAtI,GACR,IAAMpX,EAAMoX,SAAZ,MACAkrH,OAGF,wBACExmI,MADF,QAEE6kF,QAAS,uBAFX,MAGE71F,MAAM,cAER,wBACEgR,MADF,OAEE6kF,QAAS,uBAFX,MAGE71F,MAAM,iBAMhB,sBACE0tB,KADF,EAEEsC,QAAS,WACP0nH,UAMV,SAASC,GAAWvpI,GAClB,IAAM8E,EAAU5B,KACR0e,EAAkB5hB,EAFqC,QAE9Csf,EAAStf,EAFqC,KAIzD4kB,EAAc,WAClBhD,KAGF,OACE,wBACEA,QADF,EAEE2rC,kBAFF,sBAGEjuC,KAAMA,GAEN,wBAAapvB,GAAG,uBAAhB,0BAEG0xB,EACC,wBAAYtc,UAAWR,EAAvB,YAA4CkR,QAAS4O,GACnD,uBAFI,OAPZ,MAaE,4BACE,4BADF,qaAUE,4BAVF,uUAkBE,4BAhCN,wDAwCF,IAAM4kH,GAAcjwI,oBAClB,YAMO,IALLqrB,EAKI,EALJA,YACAlR,EAII,EAJJA,QAKM5O,EAAU5B,KADZ,EAE4Bya,mBAF5B,uBAEG8rH,EAFH,KAEaC,EAFb,OAG0B/rH,oBAH1B,sBAGG23B,EAHH,KAGYuB,EAHZ,OAIsBl5B,qBAJtB,mBAIGvoB,EAJH,KAIU0d,EAJV,OAKgD6K,oBALhD,sBAKGgsH,EALH,KAKuBC,EALvB,KAOE93I,EAAM4hB,EAAZ,SACMy1H,EACJn5F,qBAxIN,qBAuII,QAEM1+C,EAAO0H,sBAAb,GAEAglB,qBAAU,WACR,IAAI6rH,GAAJ,EA0BA,OAzBC,sBAAC,gCAAA73I,EAAA,mEACIm3I,EADJ,iCAGItyF,MACMizF,EAAc,IAAIzxI,IAAI6C,gBAJhC,eAKyB6uI,GAAqB,EAAD,EAGvCD,EARN,aAKUj2G,EALV,OAUI,IACEgjB,OACMwG,EAAS,IAAI2sF,gBAAgBF,EAFrB,SAGdzsF,8BAA+BxpB,OAA/BwpB,YACAA,iBAAuBxpB,EAAvBwpB,UACAysF,SAAqBzsF,EAArBysF,WACAJ,EAAYI,EAAZJ,OAhBN,kDAmBI7yF,MACA/jC,EAAS,EAATA,IApBJ,yDAAD,GAyBM,WACL+2H,QAED,CAACV,EAAe,EA1Cf,IA6CJ,IAAM/3F,EAAI,UAAMC,wBAAa7qC,eAAexN,sBAA5C,MACMixI,EAAU,IAAI5xI,IAAI6C,gBAAxB,MACMgvI,EAAa,IAAIF,gBAAgBC,EAAvC,QAGA,OAFAC,sCACAD,SAAiBC,EAAjBD,WAEE,oCACE,wBACE/lI,SADF,KAEEob,MAFF,EAGEsC,QAHF,EAIE2rC,kBAJF,qBAKEC,mBAAiB,4BAEjB,wBAAat9D,GAAG,sBAAhB,yBAEG00B,EACC,wBAAYtf,UAAWR,EAAvB,YAA4CkR,QAAS4O,GACnD,uBAFQ,OAThB,MAeE,uBAfF,MAiBE,oCACE,4BACE,wBAAmB10B,GAAG,4BAAtB,4DAEE,wBAAY8lB,QAAS,kBAAM4zH,GAAN,KACnB,uBALR,SAUE,4BACG,UAAAT,EACC/zI,EACE,wBAAYqO,MAAM,SAAlB,2CADG,IAID6xC,EACF,4BADS,2BAGT,wBACE1jD,MADF,MAEEgR,MAFF,EAGE26C,WAAY,CACV8f,UAAU,GAEZ93D,QANF,SAOEL,MAAO,CAAEgE,MAAO,QAChB8M,QAAS,SAAAkI,GACQA,EAAf,OACAuI,YAKN,wBACE70B,MADF,MAEEgR,MAAOqnI,EAFT,WAGE1sF,WAAY,CACV8f,UAAU,GAEZ93D,QANF,SAOEL,MAAO,CAAEgE,MAAO,QAChB8M,QAAS,SAAAkI,GACQA,EAAf,OACAuI,cAMV,4BACE,uBACEzQ,QAAS,WACPtY,KAAK+rI,GAAYQ,EAAjBvsI,YACAgW,2CAEFjQ,MALF,UAME2yC,UAAW,4BAPf,yBAYE,uBAAQpgC,QAAR,EAA8BvS,MAA9B,UAA8CgtB,WAAS,GAhF7D,WAsFE,sBACEnR,KADF,EAEEsC,QAAS,WACPgoH,OAEFT,eAAgBA,QAsC1B,GA/BoB5vI,oBAAS,YAAuC,IAAD,EACzCokB,oBADyC,sBAC1D2B,EAD0D,KACpDqF,EADoD,KAGzDjR,EAAY1T,EAH6C,QAI3D8E,EAAU5B,KAMhB,OACE,yBAAKoC,UAAWR,EAAQgkI,UACtB,uBACEvoH,cADF,eAEEvK,QAAO,sBAAE,sBAAAhkB,EAAA,sDACP2yB,MADO,2CAGThuB,KALF,QAME8M,MANF,UAOE2yC,UAAW,uBAPb,MAQEtxC,QAAS,CAAEmW,KAAMnW,EAAQikI,cAT7B,SAaGzpH,EACC,sBAAasF,YAnBC,WAClBD,OAkB2CjR,QAASA,IAftD,SC7UF,SAASy2H,GAAe7rI,GACtB,qBAAWA,EACT,cAAkBpM,YAAlB,kBAAuC,CAAlC,IAAM6T,EAAG,EAAT,GACH,kBAAWzH,EAAP,GACF6rI,GAAe7rI,EAAf6rI,IACK,QAAIpkI,UACFzH,EAAP,SAMR,IAgFA,GAhFgB/E,oBAAS,YAAwB,IAArB0I,EAAoB,EAApBA,cAAoB,EAC3BmoI,aAAc,WADa,MACvCC,EADuC,sBAExBD,aAAc,cAFU,MAEvCE,EAFuC,sBAGrBF,aAAc,UAHO,MAGrCG,EAHqC,oBAItCz/F,EAAc7oC,EAJwB,YAKV6oC,GALU,GAKtC11C,EALsC,QAK/Bw6C,EAL+B,UAKtBl8B,EALsB,UAMlC82H,EAAqB92H,EANa,GA0C9C,GAlCAsK,qBAAU,WACRusH,EAAa,SAAD,OADE,IAGdrvI,wBAHc,EAKdA,0BACC,CAACsvI,EAAiB,EAAlB,EANHxsH,IAQAA,qBAAU,WACRysH,qBAAW76F,EAAD,uCAAU,mCAAA59C,EAAA,oFAGhBm4I,GADM7rI,EAASkI,WAAWA,eAFV,KAIVkkI,EAAU,CAAEL,SAAF,EAAY/rI,UAJZ,SAMO/I,MAAM+0I,GAAD,gBAAiC,CAC3D90I,OAD2D,OAE3DK,QAAS,CACP,eAAgB,oBAElB27C,KAAMhrC,oBAXQ,WAMVjP,EANU,6CAcQA,EAdR,eAcR2vB,EAdQ,OAedxT,uCACyBnc,EADzBmc,oBAC6Cnc,EAD7Cmc,wBAEIwT,GAFJxT,KAfc,4CAAV,yDAuBT,CAACk8B,EAAQ,EAAT,EAxBH5xB,IA0BA,EACE,MAAM5oB,EAGR,IAAMgO,EAAQqP,kBAAQq4B,EAAD,QAArB,SA9C8C,EA+CC7oC,oCA/CD,QA+CtC2zF,EA/CsC,kBA+CrBY,EA/CqB,oBAkD9C,OACE,wBAAepzF,MAAO4Y,GAAmB5Y,IACvC,uBADF,MAEE,sBACEsQ,QADF,EAEE4V,cAAe,sBAAa5V,QAASA,MAEtC22H,EACC,oCACE,qBACEv/F,UADF,EAEExrB,KAAMwrB,EAFR,kBAGElpB,QAAS,WACPkpB,4BAGJ,qBACEA,UADF,EAEExrB,KAAMwrB,EAFR,wBAGElpB,QAAS,WACPkpB,gCAEF2rD,eAAgB3rD,yBAAiCt2C,QAtB3D,SCtDIm2I,GAAgB,CACpB,mBACA,mBACA,oBACA,iBACA,iBACA,mBACA,qBACA,mBACA,mBACA,mBACA,mBACA,iBACA,kBACA,iBACA,oBACA,qBACA,mBACA,qBACA,mBACA,oBACA,qBACA,qBACA,qBACA,qBACA,qBACA,oB,SAGaC,G,uFAAf,WACEnzF,EACAozF,EACAn1I,EACA4B,GAJF,+BAAAtF,EAAA,6DAMUwiC,EAAc9+B,EAAd8+B,UANV,SAOQimG,iBAAK,kBAAMp6G,QAAQo3B,EAASx9C,SAAWw9C,EAASqzF,kBAAiB,CACrExzI,SACA9C,KAAM,wBATV,uBAYyBijD,EAASnjB,WAAWnhC,KACzCqhC,EACA,kBAFqB,aAInB/gB,cAAeo3H,EACfvzI,UACG5B,GAEL,CAAEs9B,QAAS,MApBf,UAYQ14B,EAZR,OAsBQkpF,EAAqC,GAChB/rC,EAAnBqzF,eAvBV,uBAyBU,IAAI50I,MAAJ,iCAAoCuhD,EAASjjD,KAA7C,sBAzBV,QAsCE,IAVA8F,EAAS+E,SAAQ,SAAC/P,GAChBy7I,GAAaz7I,GACb,IAAM07I,EAAQvzF,EAAS0Z,oBAAoB7hE,GACvC07I,IACFxnD,EAAWwnD,GAAS17I,MAKlBe,EAAmC,GACzC,MAA2C6B,OAAOiE,QAAQqtF,GAA1D,eAAuE,sBAA3DynD,EAA2D,KAA5CC,EAA4C,KACrE76I,EAAS66I,GAAeD,EAvC5B,yBA0CS,CACLE,WAAY3nD,EACZ4nD,WAAY/6I,IA5ChB,6C,sBAgDA,SAAS06I,GAAaz7I,GAEpB,IACGA,EAAQsD,MACP,+DAGF,MAAM,IAAIsD,MAAJ,wCAA2C5G,EAA3C,MAqBK,SAAS+7I,GACtBC,EACArpI,GAEA,IAAMspI,EAAe,IAAInvC,KAAsB,CAC7CliC,MAAO,IAAImiC,GAAS,CAAEC,QAAS,MACzBxpG,KAFuC,SAG3C8F,EACA4yI,EACAj2G,GACA,4HACQs1G,EAA+BjyI,EAA/BiyI,YAAar6I,EAAkBoI,EAAlBpI,KAAMkF,EAAYkD,EAAZlD,QAD3B,kBAEOk1I,GACLp6I,EACAq6I,EAFmB,YAAC,eAGfn1I,GAHc,IAGL6/B,mBACdi2G,IANF,gDAWJ,OAAO38I,QACJuB,MAAM,CACL2e,cAAelgB,QAAM48I,cAAcH,GACnCrxI,QAASpL,QAAMqC,MAAMrC,QAAMwc,MAAMqgI,YACjCZ,eAAgBj8I,QAAMqC,MAAMrC,QAAMuL,IAAIvL,QAAMU,WAE7Csc,OAAM,SAAArb,GAAI,MAAK,CACd,kBACE,OAAO6vB,QAAQ7vB,EAAKs6I,iBAEtB,WACE,OAAOrsI,yBAAejO,EAAKue,cAAe,SAE5C,cACE,OAAOtQ,yBAAejO,EAAKue,cAAe,YAE5C,eACE,OAAOve,EAAKyJ,SAAWzJ,EAAKyJ,QAAQG,KAAI,SAAAf,GAAM,OAAIA,EAAO/J,YAE3D,kBACE,GAAKkB,EAAKs6I,eAGV,OAAO92I,MAAMwC,KAAKhG,EAAKs6I,eAAe34I,SAExC,iBACE,OAAO+c,oBAAU1e,EAAM,GAAG8jC,YAE5B,oBACE,IAAM3X,EAASle,yBACbjO,EAAKue,cACL,iBAEF,OAAsB,IAAlB4N,EAAOzoB,OACFy2I,GAEFhuH,OAGV9Q,OAAM,SAAArb,GAAI,MAAK,CACd2gE,oBADc,SACM7hE,GAClB,IAAKkB,EAAKs6I,eACR,MAAM,IAAI50I,MACR,4FAGJ,OAAO1F,EAAKs6I,eAAe96I,IAAIV,IAEjC4zD,gBATc,SASE5zD,GAAiB,MACzB+c,EAAG,UAAG7b,EAAK8J,gBAAR,aAAG,EAAe8R,WAAU,SAAAvY,GAAC,OAAIA,IAAMvE,KAChD,QAAY0D,IAARqZ,IAA8B,IAATA,EAGzB,OAAO7b,EAAKm6I,cAAct+H,EAAM7b,EAAKm6I,cAAcz2I,SAErDs8D,eAhBc,SAgBClhE,GACb,IAAKkB,EAAKs6I,eACR,MAAM,IAAI50I,MACR,8EAEJ,QAAS+C,KAAKk4D,oBAAoB7hE,QAGrCiB,SAAQ,SAAAC,GAAI,MAAK,CAChBqmD,WADgB,aAEhBgoF,UAFgB,YAQb,IALD8M,EAKC,EALDA,2BACAb,EAIC,EAJDA,eAKA7xI,KAAK2yI,WAAWD,GAChB1yI,KAAK4yI,kBAAkBf,IAEzBh4H,SAZgB,SAYP1d,GACF8Z,oBAAU1e,EAAM,GAAGs7I,mBACtB58H,oBAAU1e,EAAM,GAAGsiB,SAAS1d,IAGhCw2I,WAjBgB,SAiBL3xI,GACTzJ,EAAKyJ,QAAUyR,eAAKzR,IAEtB4xI,kBApBgB,SAoBEf,GAChBt6I,EAAKs6I,eAAiBp/H,eAAKo/H,IAE7B18H,YAvBgB,WAwBdmoC,iCAEE/lD,EAqDV,SAA8ByR,GAC5B,OAAO,SAACzR,GACN,GAAIA,EAAKue,cAAe,CACtB,IAAMg9H,EAAwBttI,yBAAejO,EAAKue,cAAe,CAC/D,WACA,YAEIi9H,EACJx7I,EAAKue,cAAc+7H,gBACnBrsI,yBAAejO,EAAKue,cAAe,CAAC,iBAAkB,YACxD,MAAO,CACLg9H,wBACAn7I,aAAcJ,EAAKgE,KACnBw3I,8BACA/pI,mBAjEEgqI,CAAqBhqI,GACrBiqI,GACA,CAAE13I,KAAM,GAAF,OAAKhE,EAAKgE,KAAV,qBAAmCoiD,iBAAiB,GAC1D39C,KAAK49C,WACL59C,KAAK4lI,UACL5lI,KAAK6Z,eAIVjH,OAAM,SAAArb,GAAI,MAAK,CACd27I,mBADc,SACKtB,EAAsBn1I,GAAsB,IACrD4B,EAAoC5B,EAApC4B,OAAQi+B,EAA4B7/B,EAA5B6/B,eAAmBhkC,EAD0B,aACjBmE,EADiB,6BAE7D,IAAKA,EAAQ8+B,UACX,MAAM,IAAIt+B,MAAM,yBAElB,IAAMk2I,EAhJd,SAAsBvB,GACpB,OAAOrhG,KAAoBqhG,GA+IHwB,CAAaxB,GAC/B,OAAOU,EAAav7I,IAClBo8I,EACA,CACEvB,cACAr6I,KAAMA,EACNkF,QAASnE,GAEX+F,EACAi+B,IAOE6uD,wBAtBQ,SAsBgBymD,EAAsBv1I,GAAmB,+HAChEA,GAASA,EAAKk/B,UADkD,sBAE7D,IAAIt+B,MAAM,yBAFmD,uBAInD,EAAKi2I,mBAAmBtB,EAAav1I,GAJc,cAI/D8E,EAJ+D,yBAK9DA,EAAI+wI,YAL0D,8CAWjEmB,+BAjCQ,SAkCZzB,EACAv1I,GACA,4IACkB,EAAK62I,mBAAmBtB,EAAav1I,GADvD,cACM8E,EADN,yBAEOA,EAAIgxI,YAFX,kD,SA0BOc,G,mFAAf,WACElsI,EACA1I,GAFF,mCAAAtF,EAAA,yDAIOgO,EAJP,wDASI+rI,EAIE/rI,EAJF+rI,sBACAn7I,EAGEoP,EAHFpP,aACAo7I,EAEEhsI,EAFFgsI,4BACA/pI,EACEjC,EADFiC,cAGIynC,EAAkBznC,EAAc0R,eACpCo4H,EAAsBhsI,MAElBwW,EAAU,IAAImzB,EAAgBrpC,aAClC0rI,GAnBJ,SAqBgCx1H,EAAQg2H,WAAW,CAAEj1I,WArBrD,UAqBQk1I,EArBR,OAuBQb,EAA6Ba,EAAepyI,KAAI,SAAAqyI,GAGpD,OADA1B,GADoB0B,EAAZn9I,SAER,2BAAYm9I,GAAZ,IAA2B77I,oBAEvBk6I,EAAiC,IACnCkB,EA7BN,wBA8BUU,EAAsBzqI,EAAc0R,eACxCq4H,EAA4BjsI,MAExB4sI,EAAsB,IAAID,EAAoBrsI,aAClD2rI,GAlCN,UAoCsCW,EAAoBC,kBAAkB,CACtEt1I,WArCN,eA2CuB+H,SAAQ,YAA0B,IAAvB/P,EAAuB,EAAvBA,QAAuB,EAAd6nB,QAC7B9X,SAAQ,SAAAwtI,GACd9B,GAAa8B,GACb/B,EAAe+B,GAASv9I,QA9ChC,eAoDEq8I,EAA2BtsI,SAAQ,SAAAhG,GACjCyxI,EAAezxI,EAAO/J,SAAW+J,EAAO/J,WArD5C,kBAwDS,CAAEq8I,6BAA4Bb,mBAxDvC,6C,sBCjSe,SAASgC,GACtBxB,EACArpI,GAEA,IAAM8qI,EAAW1B,GAAgBC,EAAoBrpI,GACrD,OAAOpT,QACJuB,MAAM,CACL2/C,WAAYlhD,QAAMwc,MAAM0hI,KAEzBlhI,OAAM,SAAArb,GAAI,MAAK,CACdR,IADc,SACVY,GACF,IAAMq6I,EAAgBhyI,KAAK+zI,SAASh9I,IAAIY,GACxC,OAAOJ,EAAKu/C,WAAW94C,MACrB,SAAAwgD,GAAQ,OAAIA,EAASjjD,QAAUy2I,GAAiBr6I,OAIpD,mBACE,OAAOse,oBAAU1e,GAAMo/C,QAAQG,WAAW52C,SAG5C,eACE,IAAMge,EAA+B,IAAIzV,IAQzC,OAPAlR,EAAKu/C,WAAW1wC,SAAQ,SAAAo4C,GAClBA,EAAStgC,QAAQjjB,QACnBujD,EAAStgC,QAAQ9X,SAAQ,SAAA4tI,GACvB91H,EAAQpV,IAAIkrI,EAAex1F,EAASjjD,YAInC2iB,GAET,iBACE,OAAOjI,oBAAU1e,GAAM8jC,YAEzB,oBACE,OAAOplB,oBAAU1e,GAAMyR,eAEzB,0BACE,IADwB,EACpB3H,EAAqB,GADD,eAED9J,EAAKu/C,YAFJ,IAExB,2BAAwC,KAA7B0H,EAA6B,QACtC,IAAKA,EAASy1F,YACZ,OAEF5yI,EAAWA,EAAS48B,OAAOugB,EAASy1F,cANd,8BAQxB,OAAO5yI,OAGVuR,OAAM,SAAArb,GAAI,MAAK,CAGRg8D,gBAHQ,SAGQ57D,GAAsB,sHACrCA,EADqC,sBAElC,IAAIsF,MAAM,gDAFwB,UAIpC+0I,EAAgBz6I,EAAKw8I,SAASh9I,IAAIY,KAClC6mD,EAAWjnD,EAAKu/C,WAAW94C,MAC/B,SAAAo3D,GAAG,OAAIA,EAAI75D,QAAUy2I,GAAiBr6I,OANE,gCASlC6pI,iBAAK,kBAAMp6G,QAAQo3B,EAASx9C,SAAWw9C,EAASqzF,mBATd,gCAUjCrzF,GAViC,qCAYnCzkD,GAZmC,8CAetCoxF,wBAlBQ,SAmBZymD,EACAj6I,EACA0E,GACA,iIACMmlI,iBAAK,kBAAMp6G,QAAQ7vB,EAAKR,IAAIY,MAAgB,CAChD0G,OAAQhC,EAAKgC,OACb9C,KAAM,wBAHR,YAMMijD,EAAWjnD,EAAKR,IAAIY,IAN1B,yCAQS6mD,EAAS2sC,wBAAwBymD,EAAav1I,IARvD,qCAUOtC,GAVP,8CAYIs5I,+BAlCQ,SAmCZzB,EACAj6I,EACA0E,GACA,iIACMmlI,iBAAK,kBAAMp6G,QAAQ7vB,EAAKR,IAAIY,MAAgB,CAChD0G,OAAQhC,EAAKgC,OACb9C,KAAM,wBAHR,YAKMijD,EAAWjnD,EAAKR,IAAIY,IAL1B,yCAOS6mD,EAAS60F,+BAA+BzB,EAAav1I,IAP9D,qCASOtC,GATP,8CAWFw9D,eAjDc,SAiDClhE,EAAiBsB,GAC9B,GAAIA,EAAc,CAChB,IAAM6mD,EAAWjnD,EAAKR,IAAIY,GAC1B,GAAI6mD,EACF,OAAOA,EAAS+Y,eAAelhE,GAEjC,MAAM,IAAI4G,MAAJ,6BACkBtF,EADlB,qCAIR,IAAKJ,EAAK28I,oBACR,MAAM,IAAIj3I,MAAJ,+JAIR,OAAO1F,EAAK28I,oBAAoB5yI,SAASjL,QAG5CiB,SAAQ,SAAAC,GAAI,MAAK,CAChB6jG,eADgB,SACDhmC,GACb79D,EAAKu/C,WAAW56B,OAAOk5C,IAEzBjgD,YAJgB,WAIF,WACZqrC,sBACEjpD,EACA0yG,oBAEE,kBAAM1yG,EAAK49D,gBACX,SACEg/E,GAGA58I,EAAKu/C,WAAW1wC,SAAQ,SAAAgvD,GACjBA,EAAIt/C,eACP,EAAKslF,eAAehmC,MAGxB++E,EAAgB/tI,SAAQ,SAAAguI,IAKO,IAJD78I,EAAKu/C,WAAW3jC,WAC1C,SAAAqrC,GAAQ,OACNA,EAASjjD,OAASiK,yBAAe4uI,EAAgB,YAGnD,EAAKC,YAAYD,QAIvB,CAAEz2F,iBAAiB,EAAMpiD,KAAM,iCAIrC84I,YAjCgB,SAkCdD,GAEA78I,EAAKu/C,WAAWrvC,KAAK,CAAEqO,cAAes+H,KAExCE,gBAtCgB,SAuCdlhI,EACAghI,GAEA78I,EAAKu/C,WAAW1jC,GAAOX,eAAK,CAC1BqD,cAAes+H,SC5KV,gBAACprI,GACd,IAAMurI,EAA2Bz/H,8BAC/B,eACA,CACEoJ,QAAS,CACPpX,KAAM,cACNiO,aAAc,GACd5M,YAAa,yCAEf0lD,SAAU7kD,EAAc0U,aAAa,0BAClC9W,aACH8qI,cAAe,CACb5qI,KAAM,cACNiO,aAAc,GACd5M,YACE,sIAGN,CAAE8M,mBAAoB,SAGlBu/H,EAAuB1/H,8BAC3B,WACA,CACE+8H,eAAgB/8H,8BAAoB,iBAAkB,CACpDwI,QAAStU,EAAc0S,0BAA0B,cAGrD,CAAE0mC,kBAAmBmyF,IAcvB,MAAO,CACLE,sBAAuB,CAACD,EAAsBD,GAC9CG,WAbF,SACEz/G,GAIA,OAAKA,GACsBA,EAAnB48G,eACmB2C,EAFLD,KCtCXz/H,iCAAoB,aAAc,CAC/C6/H,cAAe,CACb7tI,KAAM,SACNqB,YACE,oGACF4M,aAAc,wB,WCMlB,SAAS6/H,GAAWpzI,GAClB,MAAqB,oBAAVA,KAGPA,aAAiBvE,O,8CAQhB,WAA2B43I,EAAsBC,GAAjD,SAAA/7I,EAAA,sEAEC87I,EAAO36I,KAAK,OAAQ,GAAI,CAAE6/B,QAAS,MAFpC,gCAKE,IAAI/G,SAAQ,SAAC+hH,EAAU/+F,IAC5B,SAASyH,IACP10B,WAAU,sBAAC,sBAAAhwB,EAAA,+EAED87I,EAAO36I,KAAK,OAAQ,GAAI,CAAE6/B,QAAoB,EAAX+6G,IAFlC,OAGPr3F,IAHO,+CAKPzH,EAAO,EAAD,IALC,wDAOR8+F,GAELr3F,OAhBG,4C,0BA4BDu3F,G,WAKJ,WAAYC,GAAuB,yBAJnCJ,YAImC,OAFnCI,YAEmC,EACjCj1I,KAAKi1I,OAASA,E,sDAGNjsI,GAA8B,WACtC,IAAKhJ,KAAK60I,OAAQ,CAChB,IAAMA,EAAS70I,KAAKi1I,OAAOC,WAAWlsI,IAvCrC,SAAP,sCAwCMmsI,CAAYN,EAAQ70I,KAAKi1I,OAAOG,aAAavzI,OAAM,WAC7C,EAAKgzI,SACP34I,QAAQ4H,KAAK,0DACb,EAAK+wI,OAAOQ,UACZ,EAAKR,OAAO73I,OAAS,SACrB,EAAK63I,YAAS96I,MAGlBiG,KAAK60I,OAASA,EAEhB,OAAO70I,KAAK60I,W,KAIcS,G,iDACpBC,sBAAwB,E,KAExBC,kBAAoB,IAAI/sI,I,KAExBgtI,YAAc,E,KAIdC,gB,OAERN,YAAc,I,KAEdO,qBAAuB,I,uDAIrBn0I,EACAwH,EACAuyB,GACY,WACZ,GAAIxgC,MAAMC,QAAQwG,GAChB,OAAQA,EACLsM,OAAO8mI,IACPzzI,KAAI,SAAAk/B,GAAC,OACJ,EAAKu1G,WAAWv1G,EAAGr3B,EAAeuyB,MAGxC,GAAqB,kBAAV/5B,GAAgC,OAAVA,EAAgB,CAE/C,GAAIA,aAAiBq0I,YACnB,O/XlGD,SACLx3I,EACAy3I,GAEA,IAAIntI,EAAgBL,EAAevR,IAAIsH,GAYvC,OAXKsK,IACHN,GAAsB,EACtBC,EAAeQ,IAAIzK,EAAQgK,GAC3BM,EAAgBN,EAChBhK,EAAOinB,iBAAiB,SAAS,WAC/B,IAAMywH,EAAWztI,EAAevR,IAAIsH,QACnBtE,IAAbg8I,GACFD,EAAS,cAAeC,OAIvB,CAAEptI,iB+XkFKqtI,CACNx0I,EACAxB,KAAKi2I,YAAY9yI,KAAKnD,KAAMgJ,EAAeuyB,IAI/C,GAAIz7B,0BAAgB0B,KAAWkuB,kBAAQluB,GACrC,MAAM,IAAIvE,MAAM,2CAGlB,OAAOwjC,6BACLxnC,OAAOiE,QAAQsE,GACZsM,QAAO,SAAA7R,GAAC,OAAI24I,GAAW34I,EAAE,OACzBkF,KAAI,mCAAEhE,EAAF,KAAKlD,EAAL,WAAY,CAACkD,EAAG,EAAKy4I,WAAW37I,EAAG+O,EAAeuyB,QAG7D,OAAO/5B,I,kCAIPwH,EACAuyB,EACA26G,EACAH,GAEe/1I,KAAKm2I,UAAU56G,EAAWvyB,GAClC9O,KAAKg8I,EAAcH,EAAU,CAAEh8G,QAAS,Q,yCAGhB,WACzBq8G,EA/FV,WACE,IAAMC,EAA+B,qBAAXp0I,OACpBq0I,EAAY,wBAAyBr0I,OAAOxD,UAClD,OAAI43I,GAAcC,EACTr0I,OAAOxD,UAAU23I,oBAEnB,EAyFuBG,GAEtBd,EACJz1I,KAAKy1I,aAAe/wI,KAAKuM,IAAI,EAAGvM,KAAKkN,MAAMwkI,EAAsB,GAAK,IAExE,OAAO,YAAI,IAAIr7I,MAAM06I,IAAct0I,KAAI,kBAAM,IAAI6zI,GAAW,Q,sCAI5D,IAAKh1I,KAAK01I,WAAY,CACpB,IAAM54I,EAAMkD,KAAKw2I,mBAEjB,OADAx2I,KAAK01I,WAAa54I,EACXA,EAET,OAAOkD,KAAK01I,a,gCAGJn6G,EAAmBvyB,GAC3B,IAAMytI,EAAUz2I,KAAK02I,gBACjBC,EAAe32I,KAAKw1I,kBAAkBz+I,IAAIwkC,GAC9C,QAAqBxhC,IAAjB48I,EAA4B,CAC9B,IAAMC,GAAoB52I,KAAKu1I,qBAAuB,GAAKkB,EAAQx7I,OACnE+E,KAAKw1I,kBAAkB1sI,IAAIyyB,EAAWq7G,GACtC52I,KAAKu1I,qBAAuBqB,EAC5BD,EAAeC,EAIjB,IAAM/B,EAAS4B,EAAQE,GAAcR,UAAUntI,GAC/C,IAAK6rI,EACH,MAAM,IAAI53I,MAAM,qCAElB,OAAO43I,I,oEAIP7rI,EACAuyB,EACA26G,EACAv2I,G,6GACAlD,E,+BAAU,GAEL8+B,E,sBACG,IAAIv4B,UAAU,yB,cAEhB6xI,EAAS70I,KAAKm2I,UAAU56G,EAAWvyB,GACnC6tI,EAAY7tI,EAAc8tI,iBAAiBZ,G,SACpBW,EAAUE,mBAAmBp3I,G,cAApDsJ,E,OACA+tI,EAA4Bh3I,KAAK41I,WACrC3sI,EACAD,EACAuyB,GAII07G,EAAQpC,EAAO36I,KAAKg8I,EAAcc,EAA1B,aACZj9G,QAAS,IACTuC,eAAgB38B,EAAK28B,gBAClB7/B,IAMCy6I,EAAU,IAAIlkH,SAAQ,SAAC+hH,EAAU/+F,GACrCmhG,EAAsBC,aAAY,WAEV,WAAlBvC,EAAO73I,QACTg5C,EACE,IAAI/4C,MAAM,6DAGb,EAAK04I,yBACP0B,SAAQ,WACTC,cAAcH,MAMVI,EAAUvkH,QAAQwkH,KAAK,CAACP,EAAOC,I,KAE9BL,E,UAAkCU,E,kDAAxBE,kB,sICpNfC,G,wKAEF13I,KAAKy2I,QAAQ,GAAGkB,c,oEAIhBzB,EACAv2I,EACAtD,G,kFAEMu7I,E,kBAAqB7hJ,KAAQC,YAC7B6hJ,EAAW,SAAC5pH,GACZ5xB,EAAKigC,gBACPjgC,EAAKigC,eAAerO,IAIxBjuB,KAAK83I,GAAGF,EAASC,G,uEACe3B,E,2BAAmBv2I,G,IAAMi4I,YAAWv7I,G,cAA9Du+B,E,OAEN56B,KAAK+3I,IAAIH,EAASC,G,kBACXj9G,G,gHArBmBo9G,KAAIC,QAyBbC,G,kDAKnB,aAEEC,GACA,MAFEC,EAEF,EAFEA,YAEF,4BACA,gBARFA,iBAOE,IALFD,6BAKE,EAEA,EAAKC,YAAcA,EACnB,EAAKD,wBAA0BA,EAH/B,E,yDAUA,IAAMtD,EAAS,IAAI6C,GAAgB,CAAEjB,QAAS,CAAC,IAAIz2I,KAAKo4I,eAGxD,OADAvD,EAAO4B,QAAQ,GAAG4B,YAAYr4I,KAAKm4I,yBAC5BtD,M,GArBqCS,I,ICqB1CgD,G,yKAIFC,EACAC,G,uHACW,G,uBAEJz+I,G,2GASU0+I,G,kDAGnB,WAAYx9G,GAAW,kCACrB,gBAHFi6G,gBAEuB,EAErB,EAAKA,WAAa,kBAAmB,IAAIoD,IAFpB,E,0FAMrBtvI,EACAuyB,EACA26G,EACAv2I,G,gFAEK47B,E,sBACG,IAAIv4B,UAAU,yB,cAEhB6zI,EAAY7tI,EAAc8tI,iBAAiBZ,G,SACpBW,EAAUE,mBAAmBp3I,G,cAApDsJ,E,OACA+tI,EAA4Bh3I,KAAK41I,WACrC3sI,EACAD,EACAuyB,G,SAEmBs7G,EAAU6B,QAAQ1B,G,cAAjCp8G,E,yBACCi8G,EAAUY,kBAAkB78G,I,mHAzBU06G,I,GC3DJrzI,O,MAArCo1B,0B,OAAoB,G,GAAIr1B,G,GAAAA,S,SAEjB22I,G,iFAAf,WAAoBC,GAApB,SAAA7/I,EAAA,+EACS,IAAIi6B,SAAQ,SAAAC,GACjBlK,WAAWkK,EAAS2lH,OAFxB,4C,0BASMC,G,WASJ,WACE12I,EACAF,EACAoD,GACA,yBAZMlD,iBAYN,OAVMF,YAUN,OARMoD,YAQN,OANM86D,OAAQ,EAOdngE,KAAKmC,YAAcA,EACnBnC,KAAKiC,OAASA,EACdjC,KAAKqF,OAASA,E,sDAIdrF,KAAKiC,OAAOozI,Y,iJAKPr1I,KAAKmgE,M,iBACJ24E,GAAiB,E,UACbA,E,iCACAH,GAAK,K,uBACe34I,KAAKmC,YAAY42I,aACzC/4I,KAAKiC,OACL,2B,OAFF62I,I,+CAMmB94I,KAAKmC,YAAY42I,aACpC/4I,KAAKiC,OACL,YACAjC,KAAKqF,Q,yCAGC,IAAIpI,MAAM,8B,QAElB+C,KAAKmgE,OAAQ,E,2KAKf+1E,EACA8C,G,kGACA38I,E,+BAAoD,G,SAE9C2D,KAAK88D,Q,cAEyBzgE,EAA5BigC,eAAmBhkC,E,aAAS+D,E,oBAC9Bu7I,E,kBAAqB7hJ,KAAQC,YAC7B6hJ,EAAW,SAAC/rH,EAAiBmC,GAC7B5xB,EAAKigC,gBACPjgC,EAAKigC,eAAerO,IAGxBjuB,KAAKmC,YAAY21I,GAAGF,EAASC,G,SACR73I,KAAKmC,YAAY42I,aACpC/4I,KAAKiC,OACL,OACAi0I,EAHmB,2BAId8C,GAJc,IAIApB,YACnBt/I,G,cALIsiC,E,OAON56B,KAAKmC,YAAY82I,eAAerB,EAASC,G,kBAClCj9G,G,iHC/ELs+G,GAAgB,CACpBhB,sBACAO,uBACAU,kB,kDDqFA,aAEE9zI,GACA,MAFE+zI,EAEF,EAFEA,sBAEF,4BACA,gBARF/zI,YAOE,IALFuyI,aAKE,EAGA,EAAKvyI,OAASA,EACd,EAAKuyI,QAAUwB,EAJf,E,yDAO+B,IACvBj3I,EAAgBk1B,GAAhBl1B,YACR,IAAKA,EACH,MAAM,IAAIlF,MACR,mFAGJ,IAAK+E,GACH,MAAM,IAAI/E,MACR,oEAGJ,IAAMo8I,EAAiBr3I,GAASs3I,OAC1BC,EAAWp3I,EAAYq3I,SAASx5I,KAAK43I,SACrC31I,EAASo3I,EAAeI,cAAcC,OAAOH,GAEnD,OADe,IAAIV,GAAmB12I,EAAaF,EAAQjC,KAAKqF,U,oEAKhE2D,EACAuyB,EACA26G,EACAv2I,G,8FACAlD,E,+BAAU,G,uEAGRuM,EACAuyB,EACA26G,EACAv2I,EACAlD,G,aAGe,kBARX7B,E,SAQ6B,OAANA,GAAc,cAAeA,KAClDm4B,EAAM,IAAIF,OAEZz4B,IAAMQ,EAAEw4B,UAAUX,QAEtB73B,EAAEw4B,UAAYL,G,kBAETn4B,G,kHAxDoC06I,KC7E1BqE,G,WAanB,WACE3wI,GAIA,IAHA4wI,EAGA,uDAH+C,GAC/CC,EAEA,uCADAC,EACA,uCACA,GADA,yBAfFC,mBAeE,OAbF/wI,mBAaE,OAXF6wI,uBAWE,OATFC,2BASE,OAPFF,8BAOE,GACKC,EACH,MAAM,IAAI58I,MAAM,qDAElB+C,KAAKgJ,cAAgBA,EACrBhJ,KAAK45I,yBAA2BA,EAChC55I,KAAK65I,kBAAoBA,EACzB75I,KAAK85I,sBAAwBA,EAC7B95I,KAAK+5I,cAAgB,IAAItxI,I,sDAGjBuxI,GACR,IAAM/E,EAASj1I,KAAK+5I,cAAchjJ,IAAIijJ,GACtC,GAAI/E,EAAQ,OAAOA,EAEnB,IAAMgF,EAAuBj6I,KAAK85I,sBAAsBE,GAClDE,EAAkBhB,GAAcc,GAEtC,IAAKE,EACH,MAAM,IAAIj9I,MAAJ,gCAAmC+8I,EAAnC,uBACD,IAAKC,EACV,MAAM,IAAIh9I,MAAJ,gCAAmC+8I,EAAnC,wBAGR,IAAMG,EAAY,IAAID,EAAgBD,EAA6B,CACjE/mG,QAASlzC,KAAK45I,2BAGhB,OADA55I,KAAK+5I,cAAcjxI,IAAIkxI,EAAaG,GAC7BA,I,uCAGQC,EAAoB7B,EAAuBt9G,GAK1D,IAAM++G,EAAcx0I,yBAAexF,KAAK65I,kBAAmB,iBAE3D,OAAO75I,KAAKq6I,UAAUL,K,oEAGbz+G,EAAmB26G,EAAsBv2I,G,sFAAUtD,E,+BAAO,GAE9Dk/B,E,sBACG,IAAIt+B,MAAM,yB,gCAEX+C,KAAKs6I,iBAAiB/+G,EAAW26G,EAAcv2I,GAAMzF,KAC1D8F,KAAKgJ,cACLuyB,EACA26G,EACAv2I,EACAtD,I,kHArEes9I,GACZ/yI,aAAe2zI,G,kCCNT,SAASC,GAAW,EAApB,KAKb,IAAMC,EAAe,2BACE,CACnB3kI,cAAehB,8BAAoB,OAAQ,CACzC4lI,IAAKf,GADoC,aAGzCxmH,sBAAuB,CACrBrsB,KADqB,SAErBiO,aAAc,GAEhB4lI,SAAU,CACR7zI,KADQ,SAERiO,aACE,kEAEJ6lI,iBAAkB,CAChB9zI,KADgB,UAEhBiO,cAAc,GAEhB5K,MAAO,CAAErD,KAAF,SAAkBiO,aAAc,MAEzCm+B,QAASt9C,QAnBU,SAoBnBkhD,WAAYlhD,cApBO,GAuBnBsf,OAAQtf,cAAYoT,4BAvBD,UAwBnB6rB,YAAaj/B,cACXoT,4BAzBiB,eA2BnB6xI,eAAgB,iBAAejlJ,eAAf,GAAsC,CACpD2F,KAAK,kBA7BU,SAgCV,SAAAhE,GAAI,MAAK,CAChBujJ,YADgB,WAEd,IAAMj0E,EAAN,GACAtvE,yBAA2B,SAAAI,GACzB,MACE,MAAM,UAAN,kDAEF,GAAIkvE,WAAJ,GACE,MAAM,6DAAN,IAIAA,cAINy1B,gBAhBgB,YAgBe,IACrB/gG,EAASw4F,EADW,KAE5B,MACE,MAAM,UAAN,sCAEF,IAAMv1C,EAAWjnD,EAAA,iBAAqB,SAAA69D,GAAG,OAAIA,SAAJ,KACzC,KACE,OAAO5W,EAET,IAAMvjD,EAAS1D,EAAA,kDAEbs2D,SAAS,OAAD,IAAC,CAAD,CACN/mD,KADM,yBAENoS,QAAQ,GAAD,qBAAaze,KAAb,QACHs5F,YAHE,OAMV,OAAOx8F,aAAgB0D,EAAvB,IAEFkgG,mBAnCgB,YAoCd,IAAM4/C,EAAWxjJ,EAAA,iBACf,SAAAinD,GAAQ,OAAIA,SAAJ,KAEV,GACEjnD,wBAGJ6d,aA3CgB,YA2CS,IACftO,EAAS+O,EADK,KAEtB,MAAW,MAAM,uCAAN,IACX,IAAMD,EAAQre,EAAA,aAAiB,SAAA8oC,GAAC,OAAIA,YAAcxqB,EAAlB,WAChC,KACE,OAAOD,EAET,IAAM3a,EAAS1D,cAAf,GACA,OAAOA,SAAY0D,EAAnB,IAEF2iB,eArDgB,cAqDsB,IAC5B9W,EAAS+V,EADkB,KAEnC,MACE,MAAM,yCAAN,IAEF,IAAMjH,EAAQre,EAAA,aAAiB,SAAA8oC,GAAC,OAAIA,YAAJ,KAChC,MACE,MAAM,iDAAN,IAEF,OAAOzqB,iBAAP,IAEFolI,kBAhEgB,YAgEmB,IACzBl0I,EAASswF,EADe,KAEhC,MAAW,MAAM,4CAAN,IACX,IAAMn8F,EAAS1D,mBAAf,GACA,OAAOA,cAAiB0D,EAAxB,IAGFggJ,qBAvEgB,YAwEd,IAAM7nI,EAAM7b,EAAA,uBACV,SAAA2jJ,GAAI,OAAIA,OAAYplI,EAAhB,MAEN,QAAI1C,EAGJ,OAAO7b,uBAAP,IAGF4jJ,gBAjFgB,YAiFY,IAClBjiI,EAAYrD,EADK,QAEnBzC,EAAM7b,EAAA,kBAAsB,SAAA8oC,GAAC,OAAIA,YAAJ,KACnC,QAAIjtB,EAIJ,OAAO7b,kBAAP,IAEFomG,sBA1FgB,YA2Fd,MAMQpiG,GAJN6/I,EADEnlI,sCAAiColI,EAArC,KACet7I,sBAAbq7I,GAEaE,eAAbF,IAL+B,KAQjC,MACE,MAAM,qDAAN,IAEF7jJ,wBArIe,OAwIZ,SAAAA,GAAI,MAAK,CACd,oBACE,OAAOA,EAAA,gBAAoB,SAAAinD,GAAQ,OAAIh5C,yBAAeg5C,EAAnB,YAErC,iBACE,OAAOvoC,uBAAP,gBAIN,OAAO,4BAAsC,CAC3C7d,cAD2C,YASzC,OAPA,SAASmjJ,EAAWliJ,EAAI,GACtB,IAAK,IAAL,OACMF,IAAJ,SAA0BE,EAA1B,GACK,kBAAWA,EAAP,IAA+BkiJ,EAAWliJ,EAAXkiJ,IAG5CA,CAAWtmH,EAAXsmH,WACOtmH,KAlKbhzB,iCACAA,6C,0BC2Be,SAASu5I,GAAoBxyI,GAE1C,OAAO,uCAC4B,CAC/B/R,GAAIrB,iBAAeA,QAAfA,WAAiCG,QACrCwF,KAAM3F,QAFyB,OAG/B4qB,OAH+B,EAI/B8P,YAAa,iBACX,mBAAiB16B,QAAjB,SAAgC,SAAAqa,GAAK,OAAIA,GAP/C,OAEmC,KAQ/B2C,MAAOhd,cAAYoT,0BARY,eAS/ByyI,QAAS7lJ,YACPoT,4BAV6B,eAY/B0yI,cAAe9lJ,YACbA,sBACEoT,4BAd2B,gBAiB/B2yI,oBAAqB/lJ,YACnBA,cAAYoT,gCAlBiB,gBAoB/B+R,cAAenlB,cACboT,4BArB6B,UAuB/B4yI,mBAAoBhmJ,cAClBoT,4BADkBpT,iBAxBjB,UA4BK,iBAAC,CACToT,cADyB,EAOzBq2C,eAPyB,EAazBw8F,UAAM9hJ,MAzCH,OA2CE,SAAAxC,GAAI,MAAK,CACd,eACE,OAAOiiB,kBAAQvD,uBAAD,QAAd,aAEF,iBACE,OAAOA,+BAAP,YAEF,oBACE,OAAOA,+BAAP,eAEF,iBACE,OAAOA,+BAAP,YAEF,oBACE,OAAOA,+BAAP,eAEF,aACE,MAAM,GAAN,mBAAW1e,EAAX,2BAAkC0e,+BAAlC,UAEF,kBACE,MAAM,GAAN,mBACK1e,EADL,gCAEK0e,+BAFL,eAKF,gBACE,OAAOA,uBAAP,WAEF,oBACE,OAAOA,uBAAP,eAEF,yBACE,OAAOA,uBAAP,oBAEF,wBACE,OAAOA,uBAAP,mBAEF,cACE,OAAOA,uBAAP,SAEF,YACE,OAAOA,uBAAP,OAEF,sBACE,OAAOA,uBAAP,iBAEF,cACE,OAAOA,uBAAP,SAEF,kBACE,MAAO,CAAE9L,MAAO3E,yBAAexF,KAAD,yBAEhC,oBACE,GAAI0vB,kBAAJ,GAEE,OAAO30B,WAAWxD,gBAAXwD,UACLxD,qBADF,IAYJukJ,aAnEc,YAoEZ,IAAMC,EAAN,GAYA,OAXAC,eAAK/lI,oBAAD,IAAkB,SAAAI,GACpB,GAAI6+B,sBAAY67C,kBAAhB,IAAgC,CAC9B,IAAMo+B,EAAUt+B,qBAAhB,GACA53F,eAAek2H,EAAfl2H,qBAA2C,YAAmB,IAAD,mBAAhB6T,EAAgB,KAAXnD,EAAW,KAEvDsyI,8BAA0B5lI,OAA9B,GACE0lI,OAAU,CAAE1lI,KAAF,EAAQvJ,eAKnBivI,OA3HN,SA8HI,SAAAxkJ,GAAI,MAAK,CAChB2kJ,QADgB,YAEd3kJ,UAGF4kJ,eALgB,YAQb,IADD3gI,EACA,uDADkB,GAEV1U,EAASgP,EADjB,KAEA,MAAW,MAAM,UAAN,4CACX,IAAMva,EAAOiK,yBAAesQ,EAA5B,QACMqgF,EAAiBntF,oBAAvB,GACA,MAAqB,MAAM,4CAAN,IACrB,IAAMrR,EAAe6N,yBAAesQ,EAApC,gBACMsmI,EAAc,kCAElB7gJ,KAFkB,EAGlBuL,KAHkB,EAIlBgP,kBAEGve,0BAAL,IACEA,gCACF,IAAMkiG,EAAsBliG,0BAA5B,GACA,MACE,MAAM,+BAAN,eACF,IAAM0D,EAASw+F,OAAf,GACA,OAAOA,EAAoBx+F,EAA3B,IAGFohJ,gBA9BgB,kBAmCb,IAAD,OACAC,WAAkB,YAA8B,IAA3BjmI,EAA0B,EAA1BA,KACfkmI,GAAJ,EACA,IAGE,IAAMz1I,EAAN,gBACMmU,EAAOC,6BAAb,GACAshI,QAAe,kBAAMvhI,YAAerF,EAArB,YACf2mI,KACKvjD,EAAL,KACEA,QAEFA,QACA,UAKF,GAAIzhG,cAAiB8e,EAArB,IAA+B,CAG7B,IAAMvP,EAAN,iCACA01I,QAAe,kBAAM,aAAN,MACfD,KACKvjD,EAAL,KAAiCA,QACjCA,QAEF,MACE,MAAM,wHACmGzrF,eACrGxN,sBAFJ,UAQN08I,yBAxEgB,YAwEgD,IAAD,OACvDC,EAAN,GACM1jD,EAAN,GACMz9F,EAAOiK,yBAAesQ,EAA5B,QACMne,EAAe6N,yBAAesQ,EAApC,gBAGM0hF,GADJjgG,8BADF,IAEmB,MAAyB,SAAA+mB,GAAC,OAAIA,SAAJ,KAC7C,KAAgB,CACdk5E,kBAA0B,YACxB,IAAM8kD,EAAY/kJ,eAAlB,GACA,8BAWF,MAAO,CAJuB,WAC5BmlJ,WAAoC,SAAAxjF,GAAE,OAAIA,OAC1C,sBAEF,KAKJwgC,gBAnGgB,YAoGd,IAAMn+F,EAAOiK,yBAAesQ,EAA5B,QACMne,EAAe6N,yBAAesQ,EAApC,gBACM6lI,EAAsBpkJ,0BAA5B,GACA,MACE,MAAM,sCAAN,eACF,IAAMigG,EAAamkD,EAAA,MAAyB,SAAAr9H,GAAC,OAAIA,SAAJ,KAC7Cq9H,aAGFgB,iBA7GgB,YA8Gd,MAMA,GALIplJ,EAAJ,YACEqlJ,EAAc3mI,oDAAd2mI,KAIF,EAAkB,CAAC,IACTzlD,EAAiBrhF,EADT,aAEV1C,EAAM7b,EAAA,8BACV,SAAA+mB,GAAC,OAAIA,iBAAJ,KAEH,QAAIlL,EACF,OAEF,OAAO7b,8BAAP,GAEF,OAAOqlJ,GAGTC,kBAjIgB,YAkId,GAAIvsH,IAAgB/4B,EAApB,YAAsC,OAAOA,EAAP,YACtC,IAAIulJ,EAAJ,EAGA,OAFIA,EAnQV,MAmQ2CA,EAnQ3C,KAoQMvlJ,gBACOulJ,GAGTC,aAzIgB,YA0Id,IAAMC,EAAiBzlJ,EAAvB,YAGA,OADuBylJ,EADAh9I,KAAK68I,kBAAkBG,EAA9C,IAKFzhF,QAhJgB,YAgJ8B,IAApB0hF,EAAmB,uDAAJ,GACjCC,EAAiBl0I,wBAAvB,GACA,MAAqB,MAAM,sCAAN,IAErB,IAAM/N,EAAS1D,EAAA,6CAEbuP,KAAM8rC,KAER,OAAOr7C,QAAW0D,EAAlB,IAGFg8D,WA3JgB,YA2JO,IAAD,iBACK1/D,EADL,mBACpB,2BAA6C,CAAC,IAAhCsiG,EAA+B,0BACvCA,QAAeA,YAAmB5+E,EAAtC,IACEjb,KAAKm9I,WAAWtjD,IAHA,8BAMpBtiG,mBAGF+kG,gBApKgB,YAqKd,OAAOrmF,+CAAP,IAGFb,aAxKgB,YAyKd,GAAI7d,EAAJ,UACE,OAAO0e,4CAAP,GAF2C,IAIrCiD,EAAkBrD,EAJmB,QAI5B/O,EAAS+O,EAJmB,KAK7C,MACE,MAAM,uCAAN,IAEF,IAAMD,EAAQre,EAAA,oBAAwB,mBAAY8oC,YAAZ,KACtC,KACE,OAAOzqB,EAET,IAAM3a,EAAS1D,qBAAf,GACA,OAAOA,gBAAmB0D,EAA1B,IAGFkgJ,gBAxLgB,YAyLd,IAAMuB,EAAN,GAEMJ,EAAY/kJ,eAAlB,GAQA,GAPAyI,KAAKq8I,gBAAgB,EAArB,IAFA,IAQAK,WAAoC,SAAAxjF,GAAE,OAAIA,OACtC3hE,EAAJ,UACE,OAAO0e,+CAAP,GAZ8C,IAcxCiD,EAAYrD,EAd4B,QAe1CzC,EAAM7b,EAAA,yBAA6B,SAAA8oC,GAAC,OAAIA,YAAJ,KAC1C,WAAIjtB,EAGG7b,yBAAP,QAHA,GAMFyjJ,kBA9MgB,YA+Md,GAAIzjJ,EAAJ,UACE,OAAO0e,iDAAP,GAFmC,IAI7BkhF,EAAuBC,EAJM,aAIftwF,EAASswF,EAJM,KAKrC,MACE,MAAM,4CAAN,IAEF,IAAMI,EAAajgG,EAAA,oBACjB,mBAAY+mB,iBAAZ,KAEF,KACE,OAAOk5E,EAET,IAAMv8F,EAAS1D,0BAAf,GACA,OAAOA,qBAAwB0D,EAA/B,IAGFmiJ,8BAhOgB,YAgOwD,IAApBH,EAAmB,uDAAJ,GACjE,OAAOj9I,KAAA,uCAAP,IAOFq9I,kBAxOgB,cA4Ob,IADDJ,EACA,uDADoB,GAEdz+F,EAAWjnD,EAAA,iBACf,mBACEiO,yBAAehK,EAAfgK,UADF,KAGF,MACE,MAAM,sDAAN,+BAOF,OAJAy3I,iCAA8Cz3I,yBAAe,EAA7Dy3I,QAIOj9I,KAAA,UAAP,IAGFs9I,uBA5PgB,cAgQb,IADDL,EACA,uDADgD,GAE1C5iG,EAAK,eAAX,GAEA,OADAA,mBAAyBt6C,sBAAYw9I,EAArCljG,kBACOr6C,KAAA,UAAP,IAGFkhD,UAtQgB,cA2Qb,IAFD+7F,EAEA,uDAFe,GACfnnI,EACA,uDADgB,CAAEhP,KAAM8rC,GAElBsqG,EAAiBl0I,0BAAvB,GACA,MAAqB,MAAM,wCAAN,IACrB,IAAMnJ,EAAI,kCAER5I,GAFQ,EAGR6P,KAHQ,EAIRgP,kBAGF,OADAve,mBACOA,cAAP,IAGF4pD,WAxRgB,YAyRV5pD,oBAAuBsiG,EAA3B,KACEtiG,uBAA0BsiG,EAA1BtiG,IACFA,oBAAuBsiG,EAAvBtiG,OAGFimJ,UA9RgB,YA+Rd,OAAOjmJ,oBAAuBsiG,EAA9B,KAGFsjD,WAlSgB,YAmSd5lJ,uBAA0BsiG,EAA1BtiG,KAGFkmJ,eAtSgB,WAuSdlmJ,yBAQF8pD,aA/SgB,YAgTd9pD,eAMFgqD,eAtTgB,WAuTdhqD,oBAGFmmJ,iBA1TgB,WA2TdnmJ,8BACAA,8BAGFomJ,gBA/TgB,YAgUd,OAAO1nI,uCAAP,IAGF2nI,mBAnUgB,YAoUd,OAAO3nI,0CAAP,IAGF4nI,qBAvUgB,YAwUd,OAAO5nI,4CAAP,IAGF2oG,wBA3UgB,WA4Ud,OAAO3oG,uBAAP,2BAEFkjB,gBA9UgB,YA+Ud,OAAOljB,uCAAP,IAEF6nI,kBAjVgB,WAkVd,OAAO7nI,uBAAP,qBAEFyoG,0BApVgB,WAqVd,OAAOzoG,uBAAP,6BAEF8nI,oBAvVgB,WAwVd,OAAO9nI,uBAAP,2BAtdC,QAydG,WACN,IAAM4X,EAAmBuyC,aAAzB,QAEA,MAAO,CACLxtD,MAAO,CACL,uBACE,OAAOib,IAGXv2B,QAAS,CACP+0D,OADO,cAEL,OAAOrsD,KAAA,sBAAP,IAGFg+I,oBALO,cAML,OAAOnwH,OAAsB,CAACI,EAA9B,KAGFL,mBATO,WAUL,OAAOC,EAAP,YA5eH,SAifI,SAAAt2B,GAAI,MAAK,CAMhB0mJ,kBANgB,YAOd,IAAKn8G,+BAAL,GACE,MAAM,UAAN,wDAIF,IAAMo8G,EAAN,EACMC,EAASD,EAAA,qDAGb,CAAE1wH,OAAQ1X,IAEZooI,iBAEF/iI,uBApBgB,YAqBd,IACG5jB,EAAD,YADF,IAEEA,2BAEA,MAAM,UAAN,uDAEFyI,KAAKi+I,kBAAkBnoI,QA5gBtB,OA+gBE,SAAAve,GAAI,MAAK,CACd82D,wBADc,YAEZ,IAAM5zC,EAAN,EACM2jI,EACJ3jI,aACAA,EAAA,oBAA2B,YACzB,OAAO7E,YAAkBvQ,EAAzB,WAGJ,MAAO,CACL,CACE1M,MADF,WAEEivB,UAFF,EAGE7K,QAAS,WACPtC,6BAEFwC,KAAMohI,MAER,CACE1lJ,MADF,eAEEivB,UAFF,EAGE7K,QAAS,WACPtC,sBAEFwC,KAAMqhI,MAER,CACE3lJ,MADF,aAEEokB,QAAS,WACP,IAAMwhI,EAAgBhxI,WACpBA,eAAexN,sBADjB,KAGMq3C,EAAM38C,KAAZ,MACA8jJ,yBACAA,oBACE,YACE/2I,8BAMCiT,EAAL,YACE8jI,2BACAA,mBAEFA,kBACA9jI,mBAEFwC,KAAMuhI,YC5kBH,SAASC,GAAU,GAG/B,IADD3jI,EACA,wDACM4jI,EAAUlD,GAAhB,GADA,EAE8CmD,GAF9C,GAEQlK,EAFR,wBAE+BC,EAF/B,aAKMkK,EAA4BhpJ,4BAAK,CACrC,CAAE8+I,eADmC,mBAAvC,KAIMmK,EAAsBhL,GAAuB,EAAnD,GAIA,OAAO,qBACU,CACbl9F,QAASmoG,GAAkB,EAAD,EADb,GAMbC,WAAYnpJ,cAAYA,QANX,QAOb6kB,QAAS7kB,cAPI,GAQbg8C,gBARa,EASbiF,QAASjhD,cAAYA,QATR,QAUbi9I,mBAVa,EAWbmM,yBAAyB,IAZtB,UAcK,iBAAO,CACfC,sBAAuB7+E,iBADR,IAEfp3D,cAFe,EAGf7M,WAAOpC,MAjBJ,OAmBE,SAAAxC,GAAI,MAAK,CACd,oBACE,OAAOwD,WAAWxD,wBAAlB,WAEF2nJ,eAJc,YAKZ,MAAM,cAAN,qBAA6B3nJ,EAA7B,aAEF,iBACE,MAAM,YAAN,OAAmBA,EAAnB,aAEF,yBACE,MAAM,oBAAN,OAA2BA,EAA3B,iBA9BC,OAiCE,SAAAA,GAAI,MAAK,CACd,wBACE,OAAOA,EAAA,mBAAuB,SAAAkjB,GAAO,OAAIA,EAAJ,SAEvC,uBAAwB,IAAD,EACfo2H,EAAc,IAAIzxI,IAAI6C,gBAA5B,MACMmiD,EAAS,IAAI2sF,gBAAgBF,EAAnC,QACA,cAAOzsF,QAAP,IAAOA,GAAP,UAAOA,MAAP,+BAAOA,kBAAP,QAxCC,SA2CI,SAAA7sD,GAAI,MAAK,CAChBujJ,YADgB,WAEd7hJ,qCACU,mCAAE6T,EAAF,iBAAiBA,aAAjB,kBADV7T,QAGI,mCAAE6T,EAAF,qBAAiBA,UAAYvV,cAAZuV,gBAHrB7T,SAKW,YAAiB,IAAD,mBAAd6T,EAAc,KAATe,EAAS,KACvB,IAAK,IACK4M,EAAYlN,WADlB,WAEFhW,iCACA,SACA2E,iDAGNskD,sBAAY,EAEVJ,mBAAQ,WAAM,qBAEW7oD,wBAFX,eAEZ,2BAA6D,CAAC,IAAD,yBAA9CsW,GAA8C,WAC3D,IACE,IAAMf,EAAMvV,iBAAoBsW,EAAhC,MACAkpC,uBAA0BxpC,KAAA,UAAe,CAAEkN,QAAS5M,KACpD,SACI5R,eAAJ,SAAuBA,QAErBkjJ,8FATM,mCAiBhB3+F,sBAAY,EAEVJ,mBACE,WACE,GAAI7oD,EAAJ,QAAkB,CAChB,IACM09B,EAAWl1B,sBAAYxI,EAAZwI,UADC,CAAExE,KAAM,SAE1B6jJ,iCAEE7xI,KAAA,UAAe,CAAEkN,QAASwa,KAG5B8hB,wCACcx/C,EADdw/C,YAEExpC,KAAA,UAAe,CACbkN,QAAQ,OAAD,IAAC,CAAD,sBAELlf,KAAK,GAAD,OAAK05B,EAAL,2BAMd,CAAEwoB,MAAO,QAIf4hG,WA7DgB,YA8Dd9nJ,UAAekb,eAAflb,IAEF+nJ,mBAhEgB,YAiEd/nJ,uBAEFgoJ,yBAnEgB,YAoEdhoJ,6BAEFumJ,kBAtEgB,WAsEK,IACXjD,EAAmBtjJ,EADT,uBAEZy/B,EAAU,kCAEdz7B,KAAK,GAAD,OAAKs/I,EAAL,kBAA4B,IAAIpgJ,MAAhC,oBAGNuF,KAAKq/I,WAAWroH,IAElB6mH,qBA/EgB,YAgFd,GAAItmJ,EAAJ,QAAkB,CAChB,IAAM09B,EAAW1nB,WAAWA,eAAexN,sBAAYxI,EAAvD,WACA09B,SACAj1B,KAAKq/I,WAAWpqH,KAIpB0oH,gBAvFgB,YAwFd,IAAM7wI,EAAMvV,iBAAoBkjB,EAAhC,MACAljB,kCAGFqmJ,mBA5FgB,YA6Fd,IAAM9wI,EAAMvV,iBAAoBkjB,EAAhC,MACAs8B,2BACAx/C,mCAGFqnH,wBAlGgB,WAmGd,GAAIrnH,EAAJ,QAAkB,CAChB,IAAM09B,EAAW1nB,WAAWA,eAAexN,sBAAYxI,EAAvD,WACIioJ,EAAe,UAAMjoJ,UAAN,KAAnB,WACA,GAAIA,6BAAJ,GAAsD,CACpD,IAAIkoJ,EAAJ,EACA,GACED,EAAe,UAAMjoJ,UAAN,yBAAfioJ,KACAC,WACOloJ,6BAHT,IAKF09B,SACAj1B,KAAKq/I,WAAWpqH,KAGpBkE,gBAjHgB,YAkHd,IAAMumH,EAAUnoJ,iBAAhB,GACMooJ,EAAqB5oG,qBAA3B,GACA,MACE,MAAM,6CAAN,qCAKF/2C,KAAKq/I,WAAW9xI,cAAhB,UAEFmxG,0BA5HgB,WA6Hd,GAAInnH,EAAJ,QAAkB,CAChB,IAAMuV,EAAMvV,iBAAoBA,UAAhC,MACAA,8BAAoCwI,sBAAYxI,EAAhDA,YAGJwmJ,oBAlIgB,WAmId,IAAM6B,EAAmB7oG,qBAAqBx/C,EAA9C,oBACM8lH,EAAmBuiC,EACrBryI,cADqC,QAAzC,GAGQhS,EAAS8hH,EALG,KAMpBA,iBAA2B9hH,uBAA3B8hH,iBACAr9G,KAAKq/I,WAAWhiC,IAGlBxjG,SA5IgB,YA6IdtiB,eAxLC,UA2LK,SAAAA,GAAI,MAAK,CACjBsoJ,QADiB,GAEjBC,MAAM,CACJ,CACEnnJ,MADF,OAEEgiB,UAAW,CACT,CACEhiB,MADF,cAEEskB,KAFF,KAIEF,QAAS,YACP,IAAMgjI,EAAehpG,qBAAqBx/C,EAA1C,YACA,GACEw/C,qBAAqBx/C,EAArBw/C,sBAEFt8B,wBAGJ,CACE9hB,MADF,0BAEEskB,KAFF,KAGEF,QAAS,WACPxlB,0BApBL,mBAyBCujB,EACA,CACE,CACEniB,MADF,QAEEgiB,UAAW,CACT,CACEhiB,MADF,wBAEEskB,KAFF,KAIEF,QAAS,YACW9G,oBAAlB,GACA47B,yBAGJ,CACEl5C,MADF,sBAEEskB,KAFF,KAIEF,QAAS,YACW9G,oBAAlB,GACA47B,kCA/CC,KAuDjBxW,WAAY,IAAI,GAAJ,EAEV9jC,UAFU,QAGVA,wBAHU,IAIV,CACE2gJ,mBAAoB,CAAEE,YAAa4H,MACnCvH,oBAAqB,KAGzB39H,gBA3PG,SA6PI,SAAAvjB,GAAI,MAAK,CAEhB0oJ,WAFgB,YAGd1oJ,aAEF2oJ,SALgB,YAMd3oJ,WAOF4oJ,WAbgB,YAcd,OAAO5oJ,EAAA,WAAgB,CAAEoB,MAAF,EAAmBgiB,UAAW,MAUvDylI,WAxBgB,cAyBd,IAAMC,EACJj8I,IAAe7M,eAAf6M,EADF,EAGA,OADA7M,mBAAqC,CAAEoB,MAAF,EAAmBgiB,UAAW,KAC5DpjB,QAAP,QAQFonG,aApCgB,cAqCd,IAAMnuE,EAAOj5B,EAAA,YAAgB,SAAAuvE,GAAC,OAAIA,UAAJ,KAC9B,SAIOt2C,iBAAP,IAHEj5B,aAAgB,CAAEoB,MAAF,EAAmBgiB,UAAW,CAAC0O,KACxC,IAaXk1F,aArDgB,gBAsDd,IAAM/tF,EAAOj5B,EAAA,YAAgB,SAAAuvE,GAAC,OAAIA,UAAJ,KAC9B,MAEE,OADAvvE,aAAgB,CAAEoB,MAAF,EAAmBgiB,UAAW,CAAC0O,KACxC,EAET,IAAMg3H,EACJj8I,IAAeosB,mBAAfpsB,EADF,EAGA,OADAosB,0BACOA,YAAP,QASF6qC,gBAvEgB,cAwEd,IAAIilF,EAAU/oJ,EAAA,YAAgB,SAAAuvE,GAAC,OAAIA,UAAYy5E,EAAhB,MAC/B,MAAc,CACZ,IAAMntI,EAAMpT,KAAKmgJ,WAAWI,EAA5B,IACAD,EAAU/oJ,QAAW6b,EAArBktI,GAJoD,IAMrCx1H,EANqC,YAOhD01H,EAAY,CAACD,EAAnB,IAeA,OAdAA,oBAA0B,SAAAE,GACxBD,UACA,IAAIE,EAAK51H,EAAA,MAAa,SAAA61H,GAAE,MAAI,aAAiBA,UAArB,KACxB,MAAS,CACP,IAAMvtI,EAAM0X,EAAA,KAAa,CAAEnyB,MAAF,EAAmBmyB,QAAS,KACrD41H,EAAK51H,EAAQ1X,EAAbstI,GAEF,KAAM,YAAN,GACE,MAAM,+CAAN,uBAIF51H,EAAU41H,EAAV51H,WAEKA,OAAP,IAYF81H,gBAzGgB,gBA8Gd,IAAIN,EAAU/oJ,EAAA,YAAgB,SAAAuvE,GAAC,OAAIA,UAAYy5E,EAAhB,MAC/B,MAAc,CACZ,IAAMntI,EAAMpT,KAAKmgJ,WAAWI,EAA5B,IACAD,EAAU/oJ,QAAW6b,EAArBktI,GAJF,IAMiBx1H,EANjB,YAOM01H,EAAY,CAACD,EAAnB,IAgBA,OAfAA,oBAA0B,SAAAE,GACxBD,UACA,IAAIE,EAAK51H,EAAA,MAAa,SAAA61H,GAAE,MAAI,aAAiBA,UAArB,KACxB,MAAS,CACP,IAAMvtI,EAAM0X,EAAA,KAAa,CAAEnyB,MAAF,EAAmBmyB,QAAS,KACrD41H,EAAK51H,EAAQ1X,EAAbstI,GAEF,KAAM,YAAN,GACE,MAAM,+CAAN,uBAIF51H,EAAU41H,EAAV51H,WAEFA,gBACOA,EAAP,Y,eCjbR,8C,8CAAe,sBAAA/xB,EAAA,sDAEbkJ,gBAAkBA,gBAAlBA,SAFa,4C,sBCcf,IAAMgI,GAAYC,aAAW,CAC3BsmB,KAAM,CACJhJ,KAAM,SA8DV,OA1DA,YAAgE,IAAnCkO,EAAkC,EAAlCA,YAAa3Y,EAAqB,EAArBA,QAAS8Y,EAAY,EAAZA,SAC3ChqB,EAAU5B,KAD6C,EAE/Bya,oBAF+B,sBAEtD6P,EAFsD,KAE7CC,EAF6C,OAGrB9P,mBAHqB,yBAGtDqR,EAHsD,KAGxCC,EAHwC,KAUvDC,EAAkB,SAAA1K,GAEtB,GADAyK,QACA,WAAIzK,EAAqB,OAAOsK,EAAP,IAI3B,OACE,oCACE,wBACEpB,YAAa,kBAAMD,GAAN,IACbE,WAAY,kBAAMF,GAAN,IACZzX,QAAS,kBAAMA,EAAN,IACT4X,OAAQvN,QAJV,GAKEurC,QAAM,GAEN,wBAAS5mD,MAAT,EAA6BoqB,WAAY,KACvC,wBAAY7pB,QAAZ,QAA4B8pB,QAA5B,EAAmCnqB,MAAO,CAAEgE,MAAO,MARvD,IAYE,wBAAY5D,UAAWR,EAAvB,KAAqCkR,QAzB3C,SAAqBkI,GACnBA,oBACA+Q,EAAgB/Q,EAAhB+Q,iBAwBM,wBAAcxrB,MAAM,gBAGxB,wBACEvT,GADF,cAEE2xB,SAFF,EAGE2N,aAHF,EAIElQ,KAAMe,QAJR,GAKEuB,QAASsN,GAET,wBAAUlZ,QAAS,kBAAMkZ,EAAN,YACjB,4BACE,wBAAYzrB,MAAM,eAEpB,wBAAY8B,QAAQ,WA7B5B,cCNIrC,GAAYC,cAAW,SAAAC,GAAK,MAAK,CACrC6sB,WAAY,CACV7rB,gBAAiBhB,eADP,KAEVE,QAASF,UAFC,GAGV+B,UAAW/B,cAEb8sB,OAAQ,CACNzW,OAAQrW,cAEV+sB,SAAU,CACRrQ,MAAO,aAILsQ,GAAsB,SAAC,GAQtB,IAPLC,EAOI,EAPJA,gBACAzO,EAMI,EANJA,QACA3G,EAKI,EALJA,KAKI,EACsC0C,oBADtC,sBACG4S,EADH,KACkBC,EADlB,KAkBJ,OAhBAxS,qBAAU,WACP,sBAAC,sBAAAhsB,EAAA,sDACA,IACE,IACEw+B,MACAvV,qBAAwB,CAAEzmB,KAAM67B,IAChCzO,OAEF,SACA4O,GAAiB,WACf,MAAMt7B,KATV,0CAAD,KAaA,CAACq7B,EAAc,EAAf,EAdHvS,IAiBE,wBAAQsB,OAAR,EAAiCsC,QAAS,kBAAMA,GAAN,KACxC,wBAAa1xB,GAAG,sBAAhB,4BADF,OAIE,4BACE,wBAAmBA,GAAG,4BAL1B,iCASE,4BACE,uBAAQ8lB,QAAS,kBAAM4L,GAAN,IAAsBne,MAAM,WAD/C,UAIE,uBACEuS,QAAS,WACPwa,OAEF/sB,MAJF,UAKE8B,QALF,YAMEkrB,WAAS,GApBjB,aA6Ba,SAAS,GAAT,GAMX,IALFxV,EAKC,EALDA,KACAwU,EAIC,EAJDA,eAKM3qB,EAAU5B,KADf,EAG+Bya,qBAH/B,mBAGMyT,EAHN,KAGgBC,EAHhB,OAI6C1T,qBAJ7C,mBAIM0S,EAJN,KAIuBiB,EAJvB,OAKyC3T,qBALzC,mBAKM6T,EALN,KAKqBC,EALrB,OAMmD9T,oBANnD,sBAMM+T,EANN,KAM0BC,EAN1B,OAOuChU,mBAPvC,yBAOMqR,EAPN,KAOoBC,EAPpB,OAQyBtR,oBARzB,sBAQMiU,EARN,KAQaC,EARb,KAUKlB,OAAeS,QAArB,GAmCA,OAlCApT,qBAAU,WACP,sBAAC,sBAAAhsB,EAAA,sDACA,IACE,GACEipB,qBAEF,SACAoW,GAAY,WACV,MAAMn8B,KAPV,0CAAD,KAWA,CAAC+lB,EAZJ+C,IAcAA,qBAAU,WACP,sBAAC,4BAAAhsB,EAAA,sDACA,IACE,IACE2/B,MACMmoH,EAAoB7+H,EAAA,mBACxB,YAA4B,IAAD,EACzB,iBAAOzU,WAAWA,eAAlB,wBAAOA,EAAP,QAGJ6qB,MAEF,SACAA,GAAY,WACV,MAAMn8B,KAbV,0CAAD,KAiBA,CAAC+lB,EAAD,cAlBH+C,IAoBA,EAeE,oCACE,sBACEsB,KADF,EAEEmQ,eAFF,EAGE7N,QAAS,WACPiQ,SAGJ,sBACE5W,KADF,EAEEoV,gBAFF,EAGEzO,QAAS,SAAA0Q,GACPhB,UACAK,QAGJ,wBACErsB,UAAWR,EADb,SAEEkR,QAAS,SAAAkI,GACPA,oBACA+Q,EAAgB/Q,EAAhB+Q,iBAGF,uBAvBJ,OAyBE,uBAAW/qB,SAAS,MAClB,qBADF,MAEE,yBAAKoB,UAAWR,EAAQmrB,YACtB,wBAAY1qB,QAAZ,KAAyBD,UAAWR,EAAQorB,QAD9C,uBAIE,wBAAMhG,WAAN,EAAgB3mB,QAAS,GACvB,wBAAM6mB,MAAN,EAAW7J,cAAY,gBACrB,sBAAqBtF,KAAMA,KAE7B,wBAAMmP,MAAN,EAAW7J,cAAY,mBACrB,sBAA8BtF,KAAMA,KAEtC,wBAAMmP,MAAN,EAAW7J,cAAY,kBACrB,sBAAyBtF,KAAMA,OAIrC,6BACE,wBAAY1V,QAAZ,KAAyBD,UAAWR,EAAQorB,QAD9C,mBAIE,wBACEhrB,MAAO,CACLV,SADK,OAELD,UAAW,MAGZosB,EACGA,EAAA,KAAiB,mBACf,sBACE5qB,IADF,EAEE4oB,YAFF,EAGE3Y,QAAS,WACPyb,MAEF3C,SAAU,WACRwC,WA9DlB,QAuEE,wBACEphC,GADF,cAEE2xB,SAFF,EAGE2N,aAHF,EAIElQ,KAAMe,QAJR,GAKEuB,QAAS,WACPqN,UAGF,4BATF,qBAUE,wBACEjZ,QAAS,WACP6b,MACA5C,UAGF,4BACE,uBAPJ,OASE,wBAAY1pB,QAAQ,WA3F5B,YAZI,wBACEL,MAAO,CACL7H,SADK,QAEL+hB,IAFK,MAGLqB,KAHK,MAILtb,WAJK,GAKL8lB,YAAa,IAEft0B,KAAM,KCtHd,SAASojJ,KACP,IAAMtlJ,EAAIyG,gBAAV,OAaA,OACE,6BACE,4BADF,6IAME,+EAEE,uBAAG5C,KAAK,+CARZ,sBAaG65B,iBACC,oCACE,6BADF,2BAEE,4BA7BM,CACZ,CAAC,+BADW,sBAEZ,CAAC,wBAFW,eAGZ,CAAC,6BAHW,qBAIZ,CAAC,+BAJW,cAKZ,CAAC,mCALW,cAMZ,CAAC,gCANW,uBAOZ,CAAC,4CAPW,uBAQZ,CAAC,sCARW,iBASZ,CAAC,qCATW,gBAUZ,CAAC,iCAVH,aA8BW,KAAU,mCAAE6nH,EAAF,KAAQxlJ,EAAR,YACT,wBAAIuR,IAAKvR,GACP,uBAAG8D,KAAI,oBAAS7D,EAAC,IAAV,0BAFA,SAQf,oCACE,6BADF,0BAEE,4BACE,4BACE,uBAAG6D,KAAK,wCA9BpB,0BApBG4C,OAAL,cACEA,mCAEGA,OAAL,cACEA,mCA2DF,IAAM++I,GAAgB,cACb,CACLjC,WAAYnpJ,cAAYA,QADnB,QAEL6gD,aAAc7gD,cAAYA,QAFrB,QAGLyiD,SAAUziD,cAAYA,QAHjB,QAILw7I,SAAUx7I,cAAYA,QAAZA,UALQ,UAOV,iBAAO,CACfqrJ,cADe,EAEfC,oBAFe,EAGfxjD,qBAHe,EAIfxqD,QAJe,GAKfiuG,kBALe,EAMfC,iBANe,EAOfC,IACEp/I,yBACA,IAAIA,OAAJ,iBATa,sBAUfq/I,IACEr/I,yBACA,IAAIA,OAAJ,2CAnBgB,OAqBb,SAAA1K,GAAI,MAAK,CACd,oBAAqB,IAAD,EAClB,iBAAOA,EAAP,iCAAOA,aAAP,WAGF,qBAAsB,IAAD,EACnB,iBAAOA,EAAP,iCAAOA,aAAP,aAGF,mBAAoB,IAAD,EACjB,iBAAOA,EAAP,iCAAOA,aAAP,WAGF,YACE,OAAOyI,KAAA,gBAAuBzI,EAA9B,aAGF,YACE,OAAOA,eAAoBA,EAA3B,cAGF,oBACE,QACIA,EAAF,gBAAyBA,EAAzB,mBAAmDA,EADrD,cAKF,mBACE,QAASA,EAAF,eAAwBA,EAA/B,oBAjDgB,SAoDX,SAAAA,GAAI,MAAK,CAChBgqJ,gBADgB,YAEdhqJ,kBAEFiqJ,eAJgB,YAKdjqJ,iBAGFkqJ,gBARgB,YASdlqJ,kBAEFmqJ,WAXgB,YAYdnqJ,aAEFoqJ,kBAdgB,YAedpqJ,oBAEFqqJ,mBAjBgB,YAkBdrqJ,oBACA6nJ,iCAAkC7xI,eAAlC6xI,KAEFyC,gBArBgB,YAsBdtqJ,sBA1EgB,SA6EX,SAAAA,GAAI,MAAK,CACVuqJ,aADU,YAC6C,OAAD,6HAElDC,EAAe,IAAI,GAAa18I,EAFkB,UAGxD08I,+BAHwD,SAI3BA,EAJ2B,cAIlDC,EAJkD,OAKxDzqJ,wDALwD,gDAOxDA,uBAPwD,4DAUtD0qJ,YAXU,WAWK,IAAD,gJAEVC,EAAiB,CACrBnqJ,IAAKR,cAAmB,eAEpByH,EAAWE,wBALD,YAMUF,WANV,sBAMVmjJ,EANU,OAQV98I,EAASkI,WARC,GASV60I,EAAY,IAAIhjJ,IAAI8iJ,EAAR,IAA4BjgJ,gBAT9B,MAUhBogJ,GAAgBh9I,EAAhBg9I,GAVgB,UAWV,eAXU,WAYhB9qJ,uBAZgB,kDAchBA,uBAdgB,6DAkBd+qJ,2BA7BU,WA6BoB,OAAD,qHAC3BC,EAAanD,uBADc,WAE3BhnF,EAAS7gE,EAAD,8BAFmB,0BAMzBirJ,EAAcj1I,uBANW,GAO3B6qD,IAAUoqF,EAPiB,0BAQ7BjrJ,wBAR6B,8BAY7BA,EAZ6B,4BAa/BA,qBACMggJ,EAAU,IAAIvkH,SAAQ,cACtBz7B,EAAJ,MACEA,gBAAqB,SAAAkrJ,GACnBxvH,EAAQwvH,EAARxvH,QAGJlK,YAAW,kBAAMitB,MAAjBjtB,QApB6B,qCAwBvB6R,EAxBuB,OA0B7BrjC,uDAAqCN,GAAIlB,UA1BZ,8DAiCjCwB,kBAAqB,IAAI0F,MAAzB1F,oCAjCiC,8DAoC7BmrJ,mBAjEU,WAiEY,OAAD,qHAEnBC,EAAW,SAAC,EAAD,KAKf,OAAQhnJ,iBAAD,QAAP,GAPuB,0EAYMinJ,GAAsB,GAAD,OAC/CD,EAASprJ,EAAD,0BAbY,kEAY2B,QAElDA,gBAFkD,GAGlDA,YAfuB,WAYnBsrJ,EAZmB,OAkBnBpoI,EAAUlN,WAAWu1I,0BAlBF,IAmBzBvrJ,uDAAsCN,GAAIlB,UAnBjB,8CAsBrBgtJ,wBAvFU,WAuFiB,OAAD,0GACxBtoI,EAAUlN,WAEdu1I,0BAAevrJ,kCAHa,MAK9BA,uDAAsCN,GAAIlB,UALZ,8CAO1B+kJ,YA9FU,WA8FK,IAAD,uIACVkI,EAA4DzrJ,EADlD,aACI0rJ,EAA8C1rJ,EADlD,eACoB2rJ,EAA8B3rJ,EADlD,cACmCwnJ,EAAexnJ,EADlD,YAIZwoJ,EAAehpG,wCAJH,MAMhBA,sDANgB,kBAWV,EAXU,4EAahBx/C,uBAbgB,6EAmBR,EAnBQ,6FAqBR,EArBQ,kGAuBR,EAvBQ,iEAwBLA,EAxBK,oCA0BR,UA1BQ,uCA6BdA,sBA7Bc,QA+BZA,EAAJ,MACEA,gBAAqB,SAAAkrJ,GACnB,IAAM7gJ,EACJ2L,WAAW6xI,mCAAX7xI,eADF,GAGI3L,OAAW6gJ,EAAf,MACMlrJ,EAAJ,KACEA,uBAtCQ,mDA4ChBA,wBA5CgB,wEAiDjB,SAAS4rJ,GAAO,GAAqD,IAAnDC,EAAkD,EAAlDA,iBAGjBnqH,EAAO,SAAC+7E,GAAD,OACXA,gBADW,GAH4D,EAMxDm8B,aAAc,SAN0C,MAMlE9rI,EANkE,sBAOvD8rI,aAAc,UAPyC,MAOlE12H,EAPkE,sBAQtD02H,aAAc,WARwC,MAQlE94F,EARkE,sBAStD84F,aAAc,WATwC,MASlEC,EATkE,oBAWnEiS,EAASrC,GAAA,OAAqB,CAClCjC,WAAY9lH,EADsB,GAElCwd,aAAcxd,EAFoB,GAGlCof,SAAUpf,EAHwB,GAIlCm4G,SAAUn4G,EAAKm4G,KAGjB,OACE,sBACEiS,OADF,EAEED,iBAFF,EAGEE,oBAAqB7oI,IAK3B,IAAM8oI,GAAWjjJ,oBACf,YAQO,IA4GG,EAnHR+iJ,EAOI,EAPJA,OACAD,EAMI,EANJA,iBACAE,EAKI,EALJA,oBAKI,EACoBnS,aAAc,WADlC,MACKqS,EADL,oBAEIrC,EAAqCkC,EAFzC,aAEkBjC,EAAuBiC,EAFzC,YAE+BljF,EAAUkjF,EAFzC,QAG2B3+H,qBAH3B,mBAGGkxD,EAHH,KAGO6tE,EAHP,KA0FJ,OArFA1+H,qBAAU,WAAO,IAEbmuB,EAKEmwG,EAPU,QAGZjS,EAIEiS,EAPU,SAIZnC,EAGEmC,EAPU,eAKZ3lD,EAEE2lD,EAPU,gBAMZtE,EACEsE,EAPU,WASd,KAAW,CAGT,IAAMr6I,EAAgB,IAAI,GAAckqC,EAAA,KAAY,SAAAwwG,GAAC,OAAI,IAAH,MAEtD16I,4BAEA,IAAM26I,EAAmBC,GAAwB,IAAjD,GAKA,GAAIP,EAAJ,eAA2B,CACzB,IAAMxxG,EAAY8xG,EAAA,OAAwB,CACxChtG,QADwC,EAExC/E,gBAFwC,GAGxCiF,QAASgtG,GAH+B,QAIxC9E,eAMF,KACEltG,EADgB,oBAIZA,EAAJ,SACEA,kDAC4BsvG,EAD5BtvG,kOAOG,KACLA,aAAqBwxG,EAArBxxG,qBACK,CACL,IAAMiyG,EAAwBjyG,UAA9B,gBACA,OAAIiyG,QAAJ,IAAIA,OAAJ,EAAIA,EAAJ,QACMA,eAAJ,GACEjyG,sBAOJA,IACCrsC,yBAAeqsC,UAAD,cAFjB,sBnVpZH,SAAP,gCmVwZYkyG,CAAkBlyG,EAAU,EAA5BkyG,GnVtVL,SAAP,8BmVuVYC,CAAiBnyG,EAAjBmyG,IAOFh7I,kBACAA,cACAy6I,EAjDyB,GAoDzBD,cAGH,CAAC,EAAD,QA5EHz+H,IAqFA,EAEI,6BACE,qBADF,MAEGq8H,EACC,yBACEn1I,MAAO,CACLR,OADK,kBAELpB,QAFK,EAGLmW,OAHK,EAILrV,gBAAiB,YALrB,UADU,IAHhB,MAiBF,GACM,UAACyqE,EAAD,8BAACA,EAAL,SAGO,sBAAS5sE,cAAe4sE,IAFtB,sBAAa5zD,KAAM4zD,EAAnB,UAAiCp/C,eAAgBytH,KAIrD,uBAAP,SAIJ,SAAS5B,GAAgBh9I,EAAzB,GACE,qBAAWA,EACT,cAAkBpM,YAAlB,kBAAuC,CAAlC,IAAM6T,EAAG,EAAT,GACH,kBAAWzH,EAAP,GACFg9I,GAAgBh9I,EAAD,GAAfg9I,GACK,QAAIv1I,IACTzH,UAAiB+8I,EAAjB/8I,OAMR,IAAM6+I,GAAmC,SAACn9I,GACxC,OACE,oCACEqzB,gBADF,gBAEE5D,eAAgBytH,IAHpB,KAQa,sBAAyD,IAAtDb,EAAqD,EAArDA,iBAChB,OACE,wBAAee,kBAAmBD,IAChC,4BACE,sBAAQd,iBAAkBA,Q,iCClflC,oTAeO,SAASx0D,EAAW9nF,GACzB,MACA,GAAIs9I,yBAAJ,GACE/jH,EAAIv5B,YAAiBA,EAArBu5B,SACK,KAAIgkH,2BAAqBC,oBAAzB,GAEA,wBAAWx9I,EAAP,WACT,OAAOA,EAAP,aAEA,MAAM,IAAI9D,UAAV,wBAJAq9B,EAAIv5B,YAAiBA,EAAjBA,UAAkCA,EAAtCu5B,QAMF,MAEE,MAAM,IAAIpjC,MAAV,yBAEF,SAQK,SAAS6xF,EAAiBy1D,GAC/B,IAAKC,sBAAL,GAA6B,MAAM,IAAIxhJ,UAAV,yBAC7B,IAAMq9B,EACJkkH,UACAA,EADAA,OAEA31D,KAFA21D,QAGA31D,KAJF,MAKA,MAEE,MAAM,IAAI3xF,MAAV,6CAEF,SAUK,SAAS8xF,EAAgBjoF,EAAM29I,GAEpC,OADqB39I,aAArB,GAQK,SAASD,EAAgBC,GAC9B,IAAKs9I,yBAAL,GACE,MAAM,IAAIphJ,UAAV,iCAEF,OAAO8D,iBAAsBA,EAA7B,aAIK,SAAS+5H,EAAqB/5H,GAGnC,OAFiBgoF,EADwB,GAGlC,KAAa,SAAAzuD,GAAC,OAAIA,EAAJ,SAGhB,SAASqkH,EAAgBC,GAC9B,OACGH,sBAAD,IACCH,sBADD,KAEAO,qBAHF,GAOA,EAFSD,EAAP,e,oKC9EJ,IAAME,EAA0C,CAC9Cz1D,YAAax5F,QAAMwc,MAAMxc,QAAMU,QAC/B+4F,eAAgBz5F,QAAMuL,IAAIvL,QAAMwc,MAAMxc,QAAMU,SAC5Cg5F,UAAW15F,QAAMuL,IAAIvL,QAAMa,QAC3BY,QAASzB,QAAMyB,QACfmT,MAAO5U,QAAMgpD,WAAW,QAAShpD,QAAMU,QATzC,WAEE,OAAO,KAQPi5F,QAAS35F,QAAM25F,QACf94F,OAAQb,QAAMa,OACdH,OAAQV,QAAMU,OACdyO,KAAMnP,QAAMU,OACZ64F,aAAc52F,eACdkgD,OAAQ7iD,QAAM6iD,UAIVqsG,EAAgD,CACpD11D,YAAa,GACbC,eAAgB,GAChBC,UAAW,GACXj4F,SAAS,EACTmT,MAAO,QACP+kF,QAAS,EACT94F,OAAQ,EACRH,OAAQ,GACRyO,KAAM,GACNoqF,aAAc,CAAEp3F,IAAK,yBACrB0gD,OAAQ,IAGJssG,EAAc,SAACxtJ,GAAD,MAA2B,CAC7Cqb,MAAO,CACL,gBACE,OAAOrb,EAAKoS,UAKZq7I,EAAa,SAACztJ,GAAD,MAA2B,CAC5Cqb,MAAO,CACL,gBACE,OAAOrF,KAAKC,UAAUjW,EAAKoS,WAM3Bs7I,EAAkE,CACtE91D,aAAc61D,EACdvuJ,OAAQsuJ,EACRx1D,QAASw1D,EACT1tJ,QAAS0tJ,EACTtsG,OAAQusG,EAER51D,YAAa,SAAC73F,GAAD,MAAgC,CAC3Cqb,MAAO,CACL,gBACE,OAAOrF,KAAKC,UAAUjW,EAAKoS,SAG/BrS,QAAS,CACPmmB,IADO,SACH5P,GACFtW,EAAKoS,MAAMlC,KAAKoG,IAElBmgF,cAJO,SAIO56E,GACZ7b,EAAKoS,MAAM4S,OAAOnJ,EAAK,IAEzB26E,WAPO,SAOI36E,EAAavF,GACtBtW,EAAKoS,MAAMyJ,GAAOvF,MAIxBwhF,eAAgB,SAAC93F,GAAD,MAA6C,CAC3Dqb,MAAO,CACL,gBACE,OAAOrF,KAAKC,UAAUjW,EAAKoS,SAG/BrS,QAAS,CACPmmB,IADO,SACH3Q,EAAae,GACftW,EAAKoS,MAAMb,IAAIgE,EAAKe,IAEtBqO,OAJO,SAIApP,GACLvV,EAAKoS,MAAMsnC,OAAOnkC,IAEpBo4I,SAPO,SAOEp4I,EAAae,GACpB,IAAMs3I,EAAK5tJ,EAAKoS,MAAM5S,IAAI+V,GAC1B,IAAKq4I,EAAI,MAAM,IAAIloJ,MAAJ,UAAa6P,EAAb,eACfq4I,EAAG19I,KAAKoG,IAEVu3I,iBAZO,SAYUt4I,EAAasG,GAC5B,IAAM+xI,EAAK5tJ,EAAKoS,MAAM5S,IAAI+V,GAC1B,IAAKq4I,EAAI,MAAM,IAAIloJ,MAAJ,UAAa6P,EAAb,eACfq4I,EAAG5oI,OAAOnJ,EAAK,IAEjBiyI,cAjBO,SAiBOv4I,EAAasG,EAAavF,GACtC,IAAMs3I,EAAK5tJ,EAAKoS,MAAM5S,IAAI+V,GAC1B,IAAKq4I,EAAI,MAAM,IAAIloJ,MAAJ,UAAa6P,EAAb,eACfq4I,EAAG/xI,GAAOvF,MAIhByhF,UAAW,SAAC/3F,GAAD,MAA2C,CACpDqb,MAAO,CACL,gBACE,OAAOrF,KAAKC,UAAUjW,EAAKoS,SAG/BrS,QAAS,CACPmmB,IADO,SACH3Q,EAAae,GACftW,EAAKoS,MAAMb,IAAIgE,EAAKe,IAEtBqO,OAJO,SAIApP,GACLvV,EAAKoS,MAAMsnC,OAAOnkC,QAMpBw4I,EAAqB1vJ,QAAMgpD,WAC/B,iBACAhpD,QAAMU,QACN,SAAAmT,GAAG,OAAI87I,IAAezpJ,KAAK2N,M,aCjD7B,SAAS+7I,EAGPC,EAAmBC,EAA8BjpJ,GAGjD,IACI3G,EADE6vJ,EAAuC,GAO7C,GAJIlpJ,EAAQuY,kBACV2wI,EAAgB7+I,KAAOlR,QAAMC,SAASD,QAAMqkB,QAAQwrI,GAAYA,IAG9DhpJ,EAAQwY,oBAAsBxY,EAAQmpJ,mBACxC,MAAM,IAAI3oJ,MAAJ,gEACqDwoJ,IAEzDhpJ,EAAQwY,mBACgC,kBAA/BxY,EAAQwY,oBACjB0wI,EAAgBlpJ,EAAQwY,oBAAsBrf,QAAME,WACpDA,EAAa2G,EAAQwY,qBAErB0wI,EAAgB1uJ,GAAKrB,QAAME,WAC3BA,EAAa,MAEN2G,EAAQmpJ,qBACyB,kBAA/BnpJ,EAAQmpJ,oBACjBD,EAAgBlpJ,EAAQmpJ,oBAAsBjwJ,YAC9CG,EAAa2G,EAAQmpJ,qBAErBD,EAAgB1uJ,GAAKtB,YACrBG,EAAa,OAKjB,IAAM+vJ,EAAyC,CAC7CC,8BAA8B,EAC9BC,cAAe,CACbN,YACAxvG,WAAYyvG,EACZjpJ,YAGJxD,OAAOiE,QAAQwoJ,GAAkBt/I,SAAQ,YAAgC,uBAA9B8tE,EAA8B,KAApB8xE,EAAoB,KACvE,GACG/wG,iBAAO+wG,IAAmBpB,qBAAWoB,IACtC11D,YAA0B01D,GAI1BL,EAAgBzxE,GAAY8xE,OACvB,GACqB,kBAAnBA,GACmB,kBAAnBA,EAEPH,EAAkB3xE,GAAY8xE,MACzB,IAA8B,kBAAnBA,EAgBhB,MAAM,IAAI/oJ,MAAJ,oDACyCi3E,EADzC,yGAdN,IAAK8xE,EAAel/I,KAClB,MAAM,IAAI7J,MAAJ,sCAAyCwoJ,EAAzC,YAAsDvxE,IAE9D,IACEyxE,EAAgBzxE,GDOT,SACbA,EADa,GASb,QANE/rE,mBAMF,MANgB,GAMhB,EALEhR,EAKF,EALEA,MACA2P,EAIF,EAJEA,KACAiO,EAGF,EAHEA,aAGF,IAFE+jC,yBAEF,MAFsB,GAEtB,EACA,IAAKhyC,EAAM,MAAM,IAAI7J,MAAM,sBAE3B,GADK9F,IAAOA,EAAQ0tJ,EAAW/9I,KAC1B3P,EACH,MAAM,IAAI8F,MAAJ,uCAC4B6J,EAD5B,sCAKR,QAAqB/M,IAAjBgb,EAA4B,MAAM,IAAI9X,MAAM,8BAIhD,IAAMgpJ,EAAsB,GAAH,OAAM/xE,EAC5BN,OAAO,GACPz8D,eAFsB,OAEN+8D,EAASh0E,MAAM,GAFT,cAGrBk0E,EAAOx+E,QACRuB,MAAM8uJ,EAAqB,CAC1B1qJ,KAAM3F,QAAMqkB,QAAQi6D,GACpB/rE,YAAavS,QAAMqkB,QAAQ9R,GAC3BrB,KAAMlR,QAAMqkB,QAAQnT,GACpB6C,MAAO/T,QAAMC,SACXD,QAAM4C,MAAM8sJ,EAAoBnuJ,GAChC4d,KAGH1C,UAAS,iBAAO,CACfymC,wBAEDlmC,OAAM,SAAArb,GAAI,MAAK,CACd,iBACE,OAAOguJ,IAAezpJ,KAAKgD,OAAOvH,EAAKoS,aAG1CiJ,OAAM,SAAArb,GAAI,MAAK,CACd,WACE,OAAIA,EAAK2uJ,WAEApnI,YAAiBhgB,OAAOvH,EAAKoS,OAAQ,CAC1Cw8I,wBAAyBjtH,gBACrB4f,OACA/+C,IAGD,kBAAMxC,EAAKoS,QAMpB,gBAEE,IAAcA,EADd,IAAIpS,EAAK2uJ,WAOT,OANcv8I,EAMFpS,EAAKoS,QALFA,EAAM6U,OACV7U,EAAM6U,SAEf,WAAW7U,EAAX,UAKL4T,oBACC,SAAA1P,GAAG,MACc,kBAARA,GAAoBA,EAAItS,OAAS24E,EACpCrmE,EACA,CACEtS,KAAM24E,EACN/rE,cACArB,OACA6C,MAAOkE,MAShBq0C,qBAAoB,SAAA7pD,GACnB,MAA0B,kBAAfA,EAAKsR,MACP4D,KAAKC,UAAUnV,EAAKsR,SAAW4D,KAAKC,UAAUuH,GACjD1c,EAAKsR,WACL5P,EACC1B,EAAKsR,QAAUoL,EAAe1c,EAAKsR,WAAQ5P,KAEnDzC,SAAQ,SAAAC,GAAI,MAAK,CAChBuR,IADgB,SACZggF,GACFvxF,EAAKoS,MAAQm/E,GAEfnwD,MAJgB,WAKdphC,EAAKoS,MAAQoL,GAEfqxI,kBAPgB,WAQV7uJ,EAAK2uJ,aACT3uJ,EAAKoS,MAAL,mBAAyBpS,EAAKuhD,kBAAkBvvC,KAAK,MAArD,yBACGhS,EAAK8uJ,UADR,WAKFC,eAdgB,WAed,GAAK/uJ,EAAK2uJ,WAAV,CAEA,IACE,IAAMK,EAAahvJ,EAAKP,OACxB,QAAmB+C,IAAfwsJ,EAEF,YADAhvJ,EAAKoS,MAAQ48I,GAGf,MAAOtqJ,IAMT,GAHA1E,EAAKoS,MAAQoL,EAGTxd,EAAK2uJ,WAAY,CACnB,KAAMp/I,KAAQg+I,GACZ,MAAM,IAAI7nJ,MAAJ,8CAAiD6J,IAEzDvP,EAAKoS,MAAQm7I,EAAiBh+I,UAOlCm+I,EAAoBn+I,KACtBstE,EAAOA,EAAK2rB,OAAOklD,EAAoBn+I,KAGzC,IAMMggE,EANgBlxE,QAAMC,SAASu+E,EAAM,CACzC74E,KAAM24E,EACNptE,OACAqB,cACAwB,MAAOoL,IAIT,OADA9b,OAAOutJ,eAAe1/E,EAAG,6BAA8B,CAAEn9D,OAAO,IACzDm9D,ECzJ2B2/E,CAC1BvyE,EACA8xE,GAEF,MAAO/pJ,GACP,MAAM,IAAIgB,MAAJ,6CACkCwoJ,EADlC,YAC+CvxE,EAD/C,aAC4Dj4E,EAAEgyB,eAU1E,IAAIy4H,EAAgB9wJ,QACjBuB,MADiB,UACRsuJ,EADQ,uBACwBE,GACzCruJ,SAAQ,SAAAC,GAAI,MAAK,CAChBovJ,aADgB,SAEdzyE,EACAr0E,GAEA,IAAKywF,YAA0Bq1D,EAAgBzxE,IAC7C,MAAM,IAAIj3E,MAAJ,UAAai3E,EAAb,wCAER,IAAM0yE,EAAY9mJ,0BAAgBD,GAC9BA,EACA8lJ,EAAgBzxE,GAAUvyE,OAAO9B,GAErC,OADAtI,EAAK28E,GAAY0yE,EACVA,OAIT3tJ,OAAOC,KAAK2sJ,GAAmB5qJ,SACjCyrJ,EAAgBA,EAAcr0I,UAAS,wBAErC5V,EAAQnF,UACVovJ,EAAgBA,EAAcpvJ,QAAQmF,EAAQnF,UAE5CmF,EAAQmW,QACV8zI,EAAgBA,EAAc9zI,MAAMnW,EAAQmW,QAE1CnW,EAAQsjG,SACV2mD,EAAgBA,EAAc3mD,OAAOtjG,EAAQsjG,SAE/C2mD,EAAgBA,EAAcxkG,qBAAoB,SAAA7pD,GAChD,IAAMwuJ,EAA6C,GAanD,OAXA5tJ,OAAOiE,QAAQ7E,GAAM+N,SAAQ,YAAkB,IAlL5B5E,EAkL4B,mBAAhBsL,EAAgB,KAAXnD,EAAW,UAEjC5P,IAAV4P,QAC2B5P,IAA3B8rJ,EAAkB/4I,KAnLL,kBAFEtL,EAsLAmI,IAnLlB5O,MAAMC,QAAQwG,IACL,OAAVA,GAC8B,IAA9BvI,OAAOC,KAAKsI,GAAOvG,UAIvB,SAAsBuG,GACpB,OAAOzG,MAAMC,QAAQwG,IAA2B,IAAjBA,EAAMvG,OA6K9B6rJ,CAAan9I,KAGdk9I,EAAQ/5I,GAAOnD,MAGZk9I,KAGLpqJ,EAAQ8gB,qBACVmpI,EAAgBA,EAAcnpI,mBAAmB9gB,EAAQ8gB,qBAG3D,IAAMwpI,EAAoBjxJ,EAAa,eAAGA,EAAa,iBAAoB,GAO3E,OANmBF,QAAMC,SACvB6wJ,EACAjqJ,EAAQuY,gBAAR,aACMlO,KAAM2+I,GAAcsB,GACtBA,GAkBD,SAASjyI,EAId2wI,EACAuB,EACAC,GAC4B,MAhM9B,SACExB,EACAuB,GAEA,IADAC,EACA,uDAD2C,GAE3C,GAAyB,kBAAdxB,EACT,MAAM,IAAIxoJ,MACR,gFAMJ,IAAIyoJ,EAAmBsB,EACnBvqJ,EAAUwqJ,EAed,OAbEA,EAAa7kG,mBACb6kG,EAAa7kG,kBAAkB8kG,0BAE/BxB,EAAmB,2BACduB,EAAa7kG,kBAAkB8kG,yBAC/BxB,UAELjpJ,EAAU,2BACJwqJ,EAAa7kG,kBAAkB+kG,sBAAwB,IACxDF,IAEU7kG,mBAEV,CAAEsjG,mBAAkBjpJ,WAoKW2qJ,CACpC3B,EACAuB,EACAC,GAHMvB,EADoB,EACpBA,iBAAkBjpJ,EADE,EACFA,QAKpB4qJ,EAAa7B,EACjBC,EACAC,EACAjpJ,GAMF,OAHA4qJ,EAAWvB,8BAA+B,EAC1CuB,EAAWH,wBAA0BxB,EACrC2B,EAAWF,qBAAuB1qJ,EAC3B4qJ,EAGF,SAASntI,EAAuBmtI,GACrC,OAAOzxJ,QAAM4C,MAAM5C,QAAM0xJ,UAAUD,GAAaA,K,iCCrQlD,0sBA6BO,SAASrwF,EACdx1D,GAEA,OACE1B,0BAAgB0B,IAChB,eAAgBA,GAChB,YAAaA,GACb,UAAWA,EAwBR,SAAS+lJ,EAAe/lJ,GAC7B,MACmB,kBAAVA,GACG,OAAVA,GACA,kBAAmBA,GACnB,kBAAmBA,EAQhB,SAASqZ,EACdrZ,GAEA,OAAO+lJ,EAAe/lJ,IAAU,sBAAuBA,EAelD,SAASw/C,EACdx/C,GAEA,OAAO+lJ,EAAe/lJ,IAAU,YAAaA,EAQxC,SAAS4/C,EACd5/C,GAEA,MACmB,kBAAVA,GACG,OAAVA,GACA,cAAeA,GACf,iBAAkBA,EAWf,SAASgmJ,EAAYhmJ,GAC1B,MACmB,kBAAVA,GACG,OAAVA,GACA,UAAWA,GACX,aAAcA,EAOX,SAASimJ,EAAiBjmJ,GAC/B,MACmB,kBAAVA,GACG,OAAVA,GACA,cAAeA,GACf,cAAeA,EAyBZ,SAAS45D,EACd55D,GAEA,MACmB,kBAAVA,GACG,OAAVA,GACA,eAAgBA,GAChB,oBAAqBA,I,oICzKZ+jJ,EAAiB,gDAExBmC,EAA6C,GAQ5C,SAAS5oI,EACdrV,GAaA,IAZAhN,EAYA,uDADI,GAEI0pJ,EAA4B1pJ,EAA5B0pJ,wBAEF71G,EAAW,GAAH,OACZ61G,EAA0BA,EAAwB58I,KAAK,KAAO,QADlD,YAEVE,GACJ,IAAKi+I,EAAiBp3G,GAAW,CAC/B,IAAM32C,EAAQ4rJ,EAAernJ,KAAKuL,GAClC,IAAK9P,EACH,MAAM,IAAIsD,MAAM,uDAElB,IAAM0qJ,EAAYhuJ,EAAM,GAAGq9C,MAAM,KAAK71C,KAAI,SAAA3F,GAAC,OAAIA,EAAEw2F,UAC7C9mB,EAAOvxE,EAAM,GAAGD,QAAQ,QAAS,IACjCysJ,IAKFj7E,EAAO,4BAAH,OACFi7E,EAAwBlrJ,OADtB,0GAE8FkrJ,EAAwB58I,KACxH,MAHE,gEAIqD2hE,IAI3D,IAAM08E,EAAW,YAAIC,SAAP,YAAmBF,GAAnB,gCAA+Cz8E,MAC7Dw8E,EAAiBp3G,GAAYs3G,EAG/B,IAAI5wJ,EAAO0wJ,EAAiBp3G,GAC5B,GAAI7zC,EAAQ0G,KAAM,qBACW1G,EAAQ0G,MAA5B2kJ,EADS,KACGxvJ,EADH,WAEhBtB,GAAO,EAAAA,GAAKmM,KAAL,SAAU2kJ,GAAV,mBAAsBxvJ,KAE/B,OAAOtB,I,iOCzDH+wJ,E,4MACG78E,U,0BADgBjuE,QAelB,SAASwD,EAAiBpC,GAC/B,GAAKA,EAAL,CAEA,KAAMA,aAAkBw3I,aACtB,MAAM,IAAI7yI,UAAU,4BAGtB,GAAI3E,EAAO2/C,QAET,MAAMgqG,KAIH,SAASA,IACd,GAA4B,qBAAjBC,aACT,OAAO,IAAIA,aAAa,UAAW,cAErC,IAAMhsJ,EAAI,IAAI8rJ,EAAW,WAEzB,OADA9rJ,EAAEivE,KAAO,cACFjvE,EAGF,SAAS4E,EAAmBxC,GACjC,OAAKA,EACE6pJ,YAAU7pJ,EAAQ,SADLqD,IAAWC,SAQ1B,SAASkC,EAAiBskJ,GAC/B,MAEqB,eAAnBA,EAAU5sJ,MAEyB,gBAAlC4sJ,EAAyBj9E,QAMxBi9E,EAAUl6H,QAAQt0B,MAAM,+B,6SC1BvB,SAAS6L,EACd4iJ,GAIK,IAHLC,EAGK,4DAHqCtuJ,EAC1C4F,EAEK,uDAFa,GAGlB,IAAKyoJ,EAAY,MAAM,IAAIplJ,UAAU,oCACrC,IAAKqlJ,EAAU,OAAOtoJ,sBAAYqoJ,GAClC,GAAwB,kBAAbC,EAAuB,CAChC,IAAIj0E,EAAOg0E,EAAWC,GAStB,IANGj0E,GACDt0E,0BAAgBsoJ,IAChB9D,oBAAUvzD,kBAAQq3D,MAElBh0E,EAAOg0E,EAAWrxJ,IAAIsxJ,KAEnBj0E,EACH,OAYF,GAAIA,EAAKp9E,KAAM,CACb,IAAMsxJ,EAAcl0E,EAAKp9E,KAAK+nB,MAAM,KAAMpf,GAC1C,OAAIG,0BAAgBwoJ,GAAqBvoJ,sBAAYuoJ,GAC9CA,EAET,OAAIxoJ,0BAAgBs0E,GAAcr0E,sBAAYq0E,GACvCA,EAGT,IAAMF,EAAWm0E,EAAS,GAC1B,GAAIA,EAASptJ,OAAS,EAAG,CACvB,IAAMstJ,EAAUF,EAASnoJ,MAAM,GAC3BsoJ,EAAUJ,EAAWl0E,GASzB,IANGs0E,GACD1oJ,0BAAgBsoJ,IAChB9D,oBAAUvzD,kBAAQq3D,MAElBI,EAAUJ,EAAWrxJ,IAAIm9E,KAEtBs0E,EACH,OAEF,OAAOhjJ,EAAegjJ,EAASD,EAAS5oJ,GAE1C,OAAO6F,EAAe4iJ,EAAYl0E,EAAUv0E,GAWvC,SAAS6Z,EACdriB,GAGA,IAFAkxJ,EAEA,4DAF0CtuJ,EAC1C4F,EACA,uDADkB,GAElB,IAAKxI,EAAO,MAAM,IAAI6L,UAAU,+BADhC,MAE0B7L,EAAlB2e,EAFR,EAEQA,cACR,GAAIgsB,EAAqBhsB,GACvB,OAAOtQ,EAAesQ,EAAeuyI,EAAU1oJ,GAEjD,MAAM,IAAIqD,UAAU,yDAUf,SAASytF,EAAqCg4D,GACnD,GAAIxzG,iBAAOwzG,KACTA,EAAiB/D,0BAAgB+D,GAE7BjE,sBAAYiE,IAAiB,CAC/B,IAAMC,EAAsB,GAc5B,OAbA55D,2BAAiB25D,GAAgBriJ,SAAQ,SAAAU,GAEvC,IAAI8rC,EAAW69C,EADf3pF,EAAO49I,0BAAgB59I,IAElB8rC,EAAS33C,SAEZ23C,EAAW,CADC/rC,0BAAgBC,GACZA,OAElB,IAAK8rC,EAAS,GAEZ,MAAM,IAAI31C,MAAJ,qCAAwC6J,IAEhD4hJ,EAAUjhJ,KAAV,MAAAihJ,EAAS,YAAS91G,OAEb81G,EAGX,MAAO,GAGF,SAASvzG,EACd3zC,GAEA,GAAIyzC,iBAAOzzC,GAAQ,CACjB,GACE0zC,sBAAY1zC,KACX,iCAAkCA,GACjCA,EAAMjG,KAAK+F,SAAS,wBAEtB,OAAO,EAGT,GAAIsjJ,qBAAWpjJ,GAAQ,OAAO,EAEhC,OAAO,EAGF,SAAS8uF,EAA0B9uF,GACxC,QAAKyzC,iBAAOzzC,OAQR2zC,EAA8B3zC,KAE9BgjJ,sBAAYhjJ,GACPstF,2BAAiBttF,GAAOqzD,OAC7B,SAAAx0B,GAAC,OAAIiwD,EAA0BjwD,IAAiB,cAAXA,EAAE9kC,WAIvC6oJ,yBAAe5iJ,KAAU8uF,EAA0B1B,qBAAWptF,UAI9D6iJ,sBAAY7iJ,KAAU8uF,EAA0B1B,qBAAWptF,SAI3D8iJ,oBAAU9iJ,KAAU8uF,EAA0B1B,qBAAWptF,QAOxD,SAASsgC,EACdtgC,GAEA,OAAO1B,0BAAgB0B,IAAU8uF,EAA0BS,kBAAQvvF,IAG9D,SAASmvF,EAAwBnvF,GACtC,MACmB,kBAAVA,GACG,OAAVA,GACA,+BAAgCA,I,gCC7MpC,giB,6qFC6BKvI,OAAOmvE,aAEVA,IAAYugF,OAGP,IAAMzvH,EACQ,kBAAZ0vH,GACPA,sHACAA,EACWC,GAAgB3vH,EAOtB,SAASkf,EAAa3uC,GAC3B,IAAMyuC,GAAQ,IAAI4wG,aAAcC,OAAOt/I,GACjCu/I,EAAWC,kBAAQ/wG,GACnBgxG,EAAUC,wBAAcH,GACxBtjI,EAAMwjI,EAAQ98E,QAAQ,KAC5B,OAAO1mD,EAAM,EACTwjI,EAAQhpJ,MAAM,EAAGwlB,GAAKhsB,QAAQ,MAAO,KAAKA,QAAQ,MAAO,KACzDwvJ,EAAQxvJ,QAAQ,MAAO,KAAKA,QAAQ,MAAO,KAQ1C,SAASopJ,EAAesG,GAC7B,IAAMC,EAUR,SAAsBD,GACpB,IAAI/6D,EAAM,EAEV,OADW+6D,EAAInuJ,OAAS,GAEtB,KAAK,EACHozF,EAAM,EACN,MACF,KAAK,EACHA,EAAM,EACN,MACF,KAAK,EACHA,EAAM,EACN,MACF,QACE,MAAM,IAAIpxF,MAAM,6BAEpB,OAAOmsJ,EAAM,IAAIE,OAAOj7D,GA1BJk7D,CAAaH,EAAI1vJ,QAAQ,KAAM,KAAKA,QAAQ,KAAM,MAChEw+C,EAAQsxG,sBAAYH,GACpBI,EAAWC,kBAAQxxG,GACzB,OAAO,IAAIiuF,aAAcE,OAAOojB,GA0B3B,SAAS19D,EAAepiF,EAAU8zC,GAAkB,MACb/4B,mBAAS/a,GADI,mBAClDggJ,EADkD,KAClCC,EADkC,KAYzD,OATA7kI,qBAAU,WACR,IAAMi0F,EAAUjwF,YAAW,WACzB6gI,EAAkBjgJ,KACjB8zC,GACH,OAAO,WACLz0B,aAAagwF,MAEd,CAACrvG,EAAO8zC,IAEJksG,EAKF,SAASz6F,EACdl1D,GAEA,IADA2+I,EACA,uDADO,IAGDkR,EAAU/kI,mBACViV,EAAUjV,mBAEhB,SAASitC,IACHh4B,EAAQ5U,SACV6D,aAAa+Q,EAAQ5U,SAOzB,OAFAJ,qBAAU,kBAAMgtC,IAAS,IAElB,WAAuC,2BAATpyD,EAAS,yBAATA,EAAS,gBAE5CkqJ,EAAQ1kI,QAAUxlB,EAGlBoyD,IAGAh4B,EAAQ5U,QAAU4D,YAAW,WACvB8gI,EAAQ1kI,SACVnrB,EAAQ,WAAR,cAAY6vJ,EAAQ1kI,YAErBwzH,IAKA,SAASmR,EACdzzI,EACAkiD,GAGA,IADA,IAAI9hD,EAA6CJ,EAC1CI,GAAeiZ,kBAAQjZ,IAAc,CAC1C,GAAI8hD,EAAU9hD,GAAc,OAAOA,EACnC,IAAIszI,oBAAUtzI,GACT,MADuBA,EAAcR,oBAAUQ,GAGtD,MAAM,IAAIxZ,MAAM,0BAUX,SAAS28D,EACdowF,EACAC,EACAz9H,GAKA,IAMI09H,EAVJC,EAIA,uDAJW,aACXC,EAGA,uDAHY,EACZC,EAEA,uDAFU,IACVC,EACA,uDADW,GAELC,EAAO,EAOb,SAASlxH,EAAOqjB,GACd,IAAM8tG,EAAO/vJ,KAAK28C,MACdhzC,EAAWs4C,EAAU+tG,aACrBC,EAAWhuG,EAAUguG,UAAYF,EACjCG,EAAWjuG,EAAUkuG,cAAgB,EAErCJ,EAAOE,EAAW,KACpBA,EAAWF,GAIb,IADA,IAAMK,EAAWnmJ,KAAKsN,MAAMw4I,EAAOE,GAC1B7vJ,EAAI,EAAGA,EAAIgwJ,IAAYhwJ,EAAG,CAKjCuJ,GAAwB,GADxBumJ,GAA4B,KAHbN,GAAWjmJ,EAAW6lJ,IACpBK,EAAWK,GACaJ,GACR,KACJ,IAE/B,IAAMO,EAAapmJ,KAAKsgD,IAAI2lG,IAAaP,EACnCW,EACQ,IAAZV,GAAgB3lJ,KAAKsgD,IAAIilG,EAAU7lJ,IAAagmJ,EAC3BU,GAAcC,GAEnCv+H,EAASy9H,GACTE,MAEA39H,EAASpoB,GACT8lJ,EAAmBl4F,uBAAsB,kBACvC34B,EAAO,CACLoxH,aAAcrmJ,EACdsmJ,SAAUF,EACVI,aAAcD,QAMtB,OA3CKP,IACHA,EAAY1lJ,KAAKsgD,IAAIilG,EAAUD,GAAa,KA0CvC,CACL,kBAAM3wH,EAAO,CAAEoxH,aAAcT,KAC7B,kBAAMgB,qBAAqBd,KAKxB,SAASe,EAGd50I,EACAkiD,GAEA,OAAOuxF,EAAezzI,EAAMkiD,GAKvB,SAASj/C,EAAWjD,GACzB,IACE,OAAO40I,EAAiB50I,EAAMkxI,kBAC9B,MAAOtrJ,GACP,MAAM,IAAIgB,MAAM,4BAKb,SAASie,EAAkB7E,GAChC,IACE,OAAO40I,EAAiB50I,EAAMmxI,eAC9B,MAAOvrJ,GACP,MAAM,IAAIgB,MAAM,6BAsCb,SAASmU,EAAkBhR,GAAiC,IAG7D8qJ,EAQAC,EAVIxzJ,EAAsCyI,EAAtCzI,aAActB,EAAwB+J,EAAxB/J,QAASG,EAAe4J,EAAf5J,MAAOE,EAAQ0J,EAAR1J,IAChC00J,EAAqBzzJ,EAAe,IAAH,OAAOA,EAAP,KAAyB,GAkBhE,OAfEuzJ,OADYnxJ,IAAVvD,EACY,IAAH,QAAQA,EAAQ,GAAG+zD,eAAe,eAC5BxwD,IAARrD,EACK,KAEA,GAIdy0J,OADUpxJ,IAARrD,OAEUqD,IAAVvD,GAAuBA,EAAQ,IAAME,EACjC,GADJ,YAESA,EAAI6zD,eAAe,eAERxwD,IAAVvD,EAAsB,KAAO,GAE3C,UAAU40J,GAAV,OAA+B/0J,GAA/B,OAAyC60J,GAAzC,OAAuDC,GAUlD,SAASE,EACdl/F,EACAoL,GAEA,IAAKpL,EACH,MAAM,IAAIlvD,MAAM,gDAMlB,IAAMquJ,GAHNn/F,EAAYA,EAAUzyD,QAAQ,KAAM,KAGJC,MAAM,mBACtC,IAAK2xJ,EACH,MAAM,IAAIruJ,MAAJ,oCAAuCkvD,EAAvC,MAVS,kBAYoBm/F,EAZpB,GAYN3zJ,EAZM,KAYQqH,EAZR,KAaXusJ,EAAevsJ,EAAS28E,YAAY,KAC1C,IAAsB,IAAlB4vE,EAAqB,CACvB,GAAIh0F,EAAev4D,EAAUrH,GAC3B,MAAO,CAAEA,eAActB,QAAS2I,GAElC,MAAM,IAAI/B,MAAJ,sCAAyC+B,EAAzC,MAER,IAAMu2H,EAASv2H,EAASkB,MAAM,EAAGqrJ,GAC3BC,EAASxsJ,EAASkB,MAAMqrJ,EAAe,GAC7C,GACEh0F,EAAeg+D,EAAQ59H,IACvB4/D,EAAev4D,EAAUrH,GAEzB,MAAM,IAAIsF,MAAJ,sCAAyCkvD,EAAzC,MACD,GAAIoL,EAAeg+D,EAAQ59H,GAAe,CAC/C,IAAI6zJ,EAyCF,MAAO,CAAE7zJ,eAActB,QAASk/H,GAvChC,IAAMk2B,EAAaD,EAAO7xJ,MACxB,kEAGI+xJ,EAAcF,EAAO7xJ,MAAM,yCACjC,GAAI8xJ,EAAY,mBACeA,EADf,GACLj1J,EADK,KACQE,EADR,KAEd,QAAcqD,IAAVvD,QAA+BuD,IAARrD,EACzB,MAAO,CACLiB,eACAtB,QAASk/H,EACT/+H,OAAQA,EAAMkD,QAAQ,KAAM,IAC5BhD,KAAMA,EAAIgD,QAAQ,KAAM,SAGvB,KAAIgyJ,EAmBT,MAAM,IAAIzuJ,MAAJ,iCACsBuuJ,EADtB,0BAC8Cr/F,EAD9C,MAnBgB,kBACWu/F,EADX,GACbl1J,EADa,KACFm1J,EADE,KAEtB,QAAc5xJ,IAAVvD,EACF,OAAIm1J,EAEK,CACLh0J,eACAtB,QAASk/H,EACT/+H,OAAQA,EAAMkD,QAAQ,KAAM,KAGzB,CACL/B,eACAtB,QAASk/H,EACT/+H,OAAQA,EAAMkD,QAAQ,KAAM,IAC5BhD,KAAMF,EAAMkD,QAAQ,KAAM,WAW7B,GAAI69D,EAAev4D,EAAUrH,GAClC,MAAO,CAAEA,eAActB,QAAS2I,GAElC,MAAM,IAAI/B,MAAJ,uDAA0DkvD,EAA1D,MAwCD,SAASwL,EACdxL,EACAoL,GAEA,IAAMoqE,EAAS0pB,EAAuBl/F,EAAWoL,GAIjD,MAH4B,kBAAjBoqE,EAAOnrI,QAChBmrI,EAAOnrI,OAAS,GAEXmrI,EAGF,SAASb,EAAY8qB,EAAuBC,GACjD,IAAMC,EACJF,EAAKj0J,cAAgBk0J,EAAKl0J,cACrBi0J,EAAKj0J,cAAgB,IAAI65F,cAAcq6D,EAAKl0J,cAAgB,IAC7D,EACN,GAAIm0J,EAAc,OAAOA,EAEzB,IAAMC,EACJH,EAAKv1J,SAAWw1J,EAAKx1J,SAChBu1J,EAAKv1J,SAAW,IAAIm7F,cAAcq6D,EAAKx1J,SAAW,IACnD,EACN,GAAI01J,EAAS,OAAOA,EAEpB,QAAmBhyJ,IAAf6xJ,EAAKp1J,YAAsCuD,IAAf8xJ,EAAKr1J,MAAqB,CACxD,IAAMw1J,EAAYJ,EAAKp1J,MAAQq1J,EAAKr1J,MACpC,GAAIw1J,EAAW,OAAOA,EAExB,QAAiBjyJ,IAAb6xJ,EAAKl1J,UAAkCqD,IAAb8xJ,EAAKn1J,IAAmB,CACpD,IAAMu1J,EAAUL,EAAKl1J,IAAMm1J,EAAKn1J,IAChC,GAAIu1J,EAAS,OAAOA,EAEtB,OAAO,EAGF,SAASC,EACdnzJ,EACAC,EACAu+D,GAIA,OAAOupE,EAFMnpE,EAAe5+D,EAAGw+D,GAClBI,EAAe3+D,EAAGu+D,IAW1B,SAAShjD,EAAM85E,EAAa1pF,EAAasM,GAC9C,OAAIo9E,EAAM1pF,EAAYA,EAClB0pF,EAAMp9E,EAAYA,EACfo9E,EAGT,SAAS89D,EAAuB99D,GAC9B,OAAO3pF,KAAK2O,MAAY,GAANg7E,GAAY,GAQzB,SAASt7E,EACdU,EACArT,EACA2F,GAEA,OAAI3F,EAAOhJ,SACF+0J,GAAwB/rJ,EAAO1J,IAAM+c,GAAM1N,GAE7ComJ,GAAwB14I,EAAKrT,EAAO5J,OAASuP,GAGtD,IAAMqmJ,EAAkB,IAAQ1nJ,KAAKy/E,GAC/BkoE,EAAkB3nJ,KAAKy/E,GAAK,IAC3B,SAASjD,EAASe,GACvB,OAAQA,EAAUmqE,EAAmB,IAEhC,SAASE,EAASC,GACvB,OAAQA,EAAUF,GAAoB,EAAI3nJ,KAAKy/E,IAM1C,SAASlD,EAAiB+C,EAAaC,GAC5C,MAAO,CAACD,EAAMt/E,KAAK8nJ,IAAIvoE,GAAQD,EAAMt/E,KAAK+nJ,IAAIxoE,IAQzC,SAASF,EAAiBnoF,EAAW+jC,GAG1C,MAAO,CAFKj7B,KAAKm3D,KAAKjgE,EAAIA,EAAI+jC,EAAIA,GACpBj7B,KAAKw/E,KAAKvkD,EAAI/jC,IAIvB,SAASyjE,EACd5yD,EACArM,EACA2F,GAEA,OAAO6qE,EAASnkE,EAAQ1V,IAAI,SAAU0V,EAAQ1V,IAAI,OAAQqJ,EAAQ2F,GAG7D,SAAS6qE,EACdJ,EACAE,EACAtwE,EACA2F,GAEA,IAAMvP,EAAQuc,EAAOy9D,EAAQpwE,EAAQ2F,GAC/BrP,EAAMqc,EAAO29D,EAAStwE,EAAQ2F,GACpC,OAAO3F,EAAOhJ,SAAW,CAACV,EAAKF,GAAS,CAACA,EAAOE,GAG3C,IAAM+pC,EAAoBxnC,OAAOmvE,YAAYjlE,KAAKlK,QAGlD,SAASkiC,EACduxH,EACA11J,EACA21J,GAEA,IADK,EACCjwH,EAAUiwH,EAAW,IAAI5xJ,MAAM4xJ,GAAY,GAC7CC,EAAU,EAFT,cAGcF,GAHd,IAGL,2BAA6B,KAAlBv7H,EAAkB,QAC3BuL,EAAQkwH,GAAW51J,EAAKm6B,GACxBy7H,GAAW,GALR,8BAOL,OAAOlwH,EAoBF,SAASk0E,EAAa/wF,EAAWmiG,GACtC,IAAM6qC,EAAS3rJ,IAAM2e,EAAGmiG,GAGxB,OAFIA,EAAE64B,eAAgBgS,EAAOhS,eAAiB74B,EAAE64B,eACvCh7H,EAAEg7H,iBAAgBgS,EAAOhS,eAAiBh7H,EAAEg7H,gBAC9CgS,EAaF,SAASpiI,EACdrY,EACAmmD,GAGA,IADA,IAAIz9D,EAAIsX,EAAMnX,OACPH,KACL,GAAIy9D,EAAUnmD,EAAMtX,GAAIA,EAAGsX,GACzB,OAAOtX,EAGX,OAAQ,EAoBH,SAASwiD,GACd/lD,EACAu1J,EACAC,EAMAC,EACAC,EACAC,EACAC,GAEA,IAAIC,EAEJ,SAASC,EAAYlxJ,GACd0H,YAAiB1H,KAChBuzB,kBAAQn4B,GACV41J,EAAchxJ,GAEdD,QAAQC,MAAMA,IAKpB,IAAMmxJ,EAAmBrjD,oBACvB,WACE,IACE,OAAO6iD,EAAav1J,GACpB,MAAO4E,GAEP,YADAkxJ,EAAYlxJ,MALe,uCAS/B,WAAO0D,EAAM0tJ,GAAb,iBAAAx0J,EAAA,yDACMq0J,IAAeA,EAAW/uJ,OAAO2/C,SACnCovG,EAAWnvG,QAGRvuB,kBAAQn4B,GALf,wDAQE61J,EAAa,IAAIvkJ,gBAGjBokJ,EADMO,EAAiBJ,GAVzB,kBAayBL,EACnBltJ,EACA2tJ,EAAenvJ,OACf9G,EACAg2J,GAjBN,OAaU3yH,EAbV,OAmBIn6B,YAAiB+sJ,EAAenvJ,QAC5BqxB,kBAAQn4B,IACV21J,EAAgBtyH,GArBtB,kDAwBQ4yH,IAAmBA,EAAenvJ,OAAO2/C,SAC3CwvG,EAAevvG,QACjBovG,EAAY,EAAD,IA1Bf,0DAT+B,wDAsC/BL,GAGFxsG,sBAAYjpD,EAAM+1J,GAClB9sG,sBAAYjpD,GAAM,WACZ61J,IAAeA,EAAW/uJ,OAAO2/C,SACnCovG,EAAWnvG,WAKV,SAASwvG,GACdljE,EACAnqF,GAEA,GAAIN,0BAAgBM,KAAYsvB,kBAAQtvB,GACtC,OAAOA,EAET,GAAIA,GAAUmqF,GAAcA,EAAWnqF,EAAO/J,SAAU,CAStD,IAAMq3J,EAASnjE,GANbnqF,EADEN,0BAAgBM,GACT,eAAKL,sBAAYK,IAEjB,eAAKA,IAIiB/J,SACjC,GAAIq3J,EACF,kCAAYttJ,GAAZ,IAAoB/J,QAASq3J,EAAQhkF,gBAAiBtpE,EAAO/J,UAGjE,OAAO+J,EAGF,SAAe0xC,GAAtB,qC,8CAAO,WASLF,EAAkCjyC,GAT7B,yBAAA5G,EAAA,yDAUGpB,EAAyCgI,EAAzChI,aAAcqJ,EAA2BrB,EAA3BqB,QAASwZ,EAAkB7a,EAAlB6a,cAC1B7a,EAAK47B,UAXL,sBAYG,IAAIt+B,MAAM,yBAZb,UAcC0wJ,EAdD,2BAeAhuJ,GAfA,IAgBHqB,QAAS,YAAKrB,EAAKqB,SAAW,OAE5BrJ,EAlBC,gCAmBsBi6C,EAAgBu5C,wBACvC3wE,EACA7iB,EACAg2J,GAtBC,OA0BH,IAPMpjE,EAnBH,SA0BevpF,GAAW2sJ,EAAQ3sJ,QACnC,IAASnG,EAAI,EAAGA,EAAImG,EAAQ/F,OAAQJ,GAAK,EACvC8yJ,EAAQ3sJ,QAAQnG,GAAK4yJ,GAAqBljE,EAAYvpF,EAAQnG,IA5B/D,gCAgCE8yJ,GAhCF,6C,sBAmCA,SAASzsD,GAAOnoG,EAAWC,GAChC,MAAO,CAAC0L,KAAKC,IAAI5L,EAAGC,GAAI0L,KAAKuM,IAAIlY,EAAGC,IAG/B,SAASwU,GAAUrJ,GACxB,gBAAUA,EAAO9N,QAAjB,YAA4B8N,EAAO6O,MAAMu3C,eAAe,UAGnD,IAAM/rD,GACO,qBAAXyD,QAA0BmlB,QAAQnlB,OAAOD,W,2LC9vB3C,SAASw/H,EACdosB,GAEA,6DADsC,GAApC7zH,EACF,EADEA,QAAS17B,EACX,EADWA,OAAQ9C,EACnB,EADmBA,KAEnB,OAAO,IAAIy3B,SAAQ,SAACC,EAAS+iB,GAC3B,IAKIjoB,EALA8/H,GAAW,EAETC,EAAcC,eAASH,GAIzBI,EAAgB,aAChBj0H,IACFhM,EAAYhF,YAAW,WAChB8kI,IACHA,GAAW,EACXC,EAAYG,SACZj4G,EAAO,IAAI/4C,MAAJ,gCAAmC1B,GAAQ,oBAEnDw+B,GACHi0H,EAAgB,kBAAMjgI,GAAa/E,aAAa+E,KAI9C1vB,GACFA,EAAOinB,iBAAiB,SAAS,WAC1BuoI,IACHA,GAAW,EAGXC,EAAYG,SACZD,IAEAh4G,EAAOgyG,mBAKb8F,EACGx1E,MAAK,WACCu1E,IACHA,GAAW,EACXG,IAEA/6H,QAGHpxB,OAAM,SAAAiD,GACA+oJ,IACHA,GAAW,EACXG,IAEAh4G,EAAOlxC,UAWV,SAAeopJ,EAAtB,kC,4CAAO,WACLN,GADK,2BAAA70J,EAAA,6DAELsD,EAFK,+BAEY,GAFZ,SAICmlI,GAAK,WACT,IAAM3zH,EAAM+/I,IACZ,YAAe7zJ,IAAR8T,GAA6B,OAARA,IAC3BxR,GAPE,gCASEuxJ,KATF,4C,qJCpEC5rJ,EAAaC,OAAbD,SAKa7C,E,WAOnB,WAAY9D,GACV,IAAI8G,EAEJ,GAH4B,yBANtB0vB,cAMsB,OAJtBs8H,QAIsB,OAFtBhsJ,iBAEsB,EAExBH,IAAUG,EAAcH,EAASG,cAChCA,EACH,MAAM,IAAIlF,MACR,kEAEJ+C,KAAKmC,YAAcA,EACnBnC,KAAK6xB,SAAWx2B,E,iKAIX2E,KAAK6xB,S,sBAAgB,IAAI50B,MAAM,0B,cAC/B+C,KAAKmuJ,KACRnuJ,KAAKmuJ,GAAKnuJ,KAAKmC,YAAYO,OAAO,OAAQ1C,KAAK6xB,SAAU,M,kBAGpD7xB,KAAKmuJ,I,0KAIZ9wJ,G,oGACA8G,E,+BAAS,EACTlJ,E,uBACAmJ,E,+BAAW,EAELgqJ,EAAc1pJ,KAAKC,IAAItH,EAAOpC,OAASkJ,EAAQlJ,G,SACpC+E,KAAKquJ,Q,cAAhBF,E,gBACanuJ,KAAKmC,YAAYO,OAClC,OACAyrJ,EACA9wJ,EACA8G,EACAiqJ,EACAhqJ,G,cANItH,E,QAUFO,OAASC,EAAOC,KAAKT,EAAIO,QAE7BP,EAAIO,OAAOoH,KAAKpH,G,kBACTP,G,uSAG6B,GAC/BkD,KAAK6xB,S,sBAAgB,IAAI50B,MAAM,0B,uBAEf+C,KAAKmC,YAAYO,OAAO,WAAY1C,KAAK6xB,U,cAAxD+I,E,8BAEuB7gC,IAAtB6gC,EAAO0zH,WAA2BhxJ,EAAOC,KAAKq9B,GAAUA,G,yPAKxD56B,KAAKmC,Y,SAAiCnC,KAAKquJ,Q,iDAA1B3rJ,O,UAAO,O","file":"static/js/4.5376da79.chunk.js","sourcesContent":["import shortid from 'shortid'\nimport { types } from 'mobx-state-tree'\nimport propTypes from 'prop-types'\nimport { PropTypes as MxPropTypes } from 'mobx-react'\n\nexport const ElementId = types.optional(types.identifier, shortid.generate)\n\n// PropTypes that are useful when working with instances of these in react components\nexport const PropTypes = {\n  Region: propTypes.shape({\n    refName: propTypes.string.isRequired,\n    start: propTypes.number.isRequired,\n    end: propTypes.number.isRequired,\n  }),\n  ConfigSchema: MxPropTypes.objectOrObservableObject,\n  Feature: propTypes.shape({\n    get: propTypes.func.isRequired,\n    id: propTypes.func.isRequired,\n  }),\n}\n\nexport const NoAssemblyRegion = types\n  .model('NoAssemblyRegion', {\n    refName: types.string,\n    start: types.number,\n    end: types.number,\n    reversed: types.optional(types.boolean, false),\n  })\n  .actions(self => ({\n    setRefName(newRefName: string): void {\n      self.refName = newRefName\n    },\n  }))\n\nexport const Region = types.compose(\n  'Region',\n  NoAssemblyRegion,\n  types.model({\n    assemblyName: types.string,\n  }),\n)\n\nexport const LocalPathLocation = types.model('LocalPathLocation', {\n  localPath: types.string, // TODO: refine\n})\n\nexport const UriLocationRaw = types.model('UriLocation', {\n  uri: types.string, // TODO: refine\n  baseUri: types.maybe(types.string),\n})\n\nexport const UriLocation = types.snapshotProcessor(UriLocationRaw, {\n  postProcessor: snap => {\n    const { baseUri, ...rest } = snap\n    if (!baseUri) {\n      return rest\n    }\n    return snap\n  },\n})\n\nexport const FileLocation = types.union(LocalPathLocation, UriLocation)\n","import getValue from 'get-value'\nimport objectHash from 'object-hash'\nimport { Track, Source, Config } from './types'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function isTrack(arg: any): arg is Track {\n  return arg && arg.label && typeof arg.label === 'string'\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function isSource(arg: any): arg is Source {\n  return arg && arg.url && typeof arg.url === 'string'\n}\n\n/**\n * updates a with values from b, recursively\n */\nexport function deepUpdate(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  a: Record<string, any>,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  b: Record<string, any>,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n): Record<string, any> {\n  for (const prop of Object.keys(b)) {\n    if (\n      prop in a &&\n      typeof b[prop] === 'object' &&\n      typeof a[prop] === 'object'\n    ) {\n      deepUpdate(a[prop], b[prop])\n    } else if (\n      typeof a[prop] === 'undefined' ||\n      typeof b[prop] !== 'undefined'\n    ) {\n      a[prop] = b[prop]\n    }\n  }\n  return a\n}\n\n/**\n * Does a (deep) crc32 of any object.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function objectFingerprint(obj: Record<string, any>) {\n  return objectHash(obj)\n}\n\n/**\n * replace variables in a template string with values\n * @param template - String with variable names in curly brackets\n * e.g., `http://foo/{bar}?arg={baz.foo}`\n * @param fillWith - object with attribute-value mappings\n * e.g., `{ 'bar': 'someurl', 'baz': { 'foo': 42 } }`\n * @returns the template string with variables in fillWith replaced\n * e.g., 'htp://foo/someurl?arg=valueforbaz'\n */\nexport function fillTemplate(\n  template: string,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  fillWith: Record<string, any>,\n): string {\n  return template.replace(\n    /\\{([\\w\\s.]+)\\}/g,\n    (match, varName: string): string => {\n      varName = varName.replace(/\\s+/g, '') // remove all whitespace\n      const fill = getValue(fillWith, varName)\n      if (fill !== undefined) {\n        if (typeof fill === 'function') return fill(varName)\n        return fill\n      }\n      if (fillWith.callback) {\n        // @ts-ignore\n        const v = fillWith.callback.call(this, varName)\n        if (v !== undefined) return v\n      }\n      return match\n    },\n  )\n}\n\n/**\n * Clones objects (including DOM nodes) and all children.\n * Warning: do not clone cyclic structures\n * (Lifted from dojo https://github.com/dojo/dojo/blob/master/_base/lang.js)\n * @param src - The object to clone\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function clone(src: any): any {\n  if (\n    !src ||\n    typeof src !== 'object' ||\n    Object.prototype.toString.call(src) === '[object Function]'\n  ) {\n    // null, undefined, any non-object, or function\n    return src // anything\n  }\n  if (src.nodeType && 'cloneNode' in src) {\n    // DOM Node\n    return src.cloneNode(true) // Node\n  }\n  if (src instanceof Date) {\n    // Date\n    return new Date(src.getTime()) // Date\n  }\n  if (src instanceof RegExp) {\n    // RegExp\n    return new RegExp(src) // RegExp\n  }\n  let r\n  let i\n  let l\n  if (Array.isArray(src)) {\n    // array\n    r = []\n    for (i = 0, l = src.length; i < l; ++i) {\n      if (i in src) {\n        r[i] = clone(src[i])\n      }\n    }\n    // we don't clone functions for performance reasons\n    //    }else if(d.isFunction(src)){\n    //      // function\n    //      r = function(){ return src.apply(this, arguments); };\n  } else {\n    // generic objects\n    r = src.constructor ? new src.constructor() : {}\n  }\n  return mixin(r, src, clone)\n}\n\n/**\n * Copies/adds all properties of source to dest; returns dest.\n * (Lifted from dojo https://github.com/dojo/dojo/blob/master/_base/lang.js)\n *\n * All properties, including functions (sometimes termed \"methods\"), excluding\n * any non-standard extensions found in Object.prototype, are copied/added to\n * dest. Copying/adding each particular property is delegated to copyFunc\n * (if any); copyFunc defaults to the Javascript assignment operator if not\n * provided. Notice that by default, mixin executes a so-called \"shallow copy\"\n * and aggregate types are copied/added by reference.\n * @param dest - The object to which to copy/add all properties contained in\n * source.\n * @param source - The object from which to draw all properties to copy into dest.\n * @param copyFunc - The process used to copy/add a property in source; defaults\n * to the Javascript assignment operator.\n * @returns dest, as modified\n */\nfunction mixin(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  dest: Record<string, any>,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  source: Record<string, any>,\n  copyFunc: Function,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n): Record<string, any> {\n  let name\n  let s\n  const empty = {}\n  // eslint-disable-next-line guard-for-in\n  for (name in source) {\n    // the (!(name in empty) || empty[name] !== s) condition avoids copying\n    // properties in \"source\" inherited from Object.prototype.\t For example,\n    // if dest has a custom toString() method, don't overwrite it with the\n    // toString() method that source inherited from Object.prototype\n    s = source[name]\n    if (\n      !(name in dest) ||\n      // @ts-ignore\n      (dest[name] !== s && (!(name in empty) || empty[name] !== s))\n    ) {\n      dest[name] = copyFunc ? copyFunc(s) : s\n    }\n  }\n\n  return dest // Object\n}\n\nexport function evalHooks(conf: Config): Config {\n  if (conf) {\n    for (const x of Object.keys(conf)) {\n      // @ts-ignore\n      if (typeof conf[x] === 'object')\n        // recur\n        // @ts-ignore\n        conf[x] = evalHooks(conf[x])\n      // @ts-ignore\n      else if (typeof conf[x] === 'string') {\n        // compile\n        // @ts-ignore\n        const spec = conf[x]\n        if (/^\\s*function\\s*\\(/.test(spec)) {\n          // @ts-ignore\n          conf[x] = evalHook(spec)\n        }\n      }\n    }\n  }\n  return conf\n}\n\nfunction evalHook(...args: string[]): Function {\n  // can't bind arguments because the closure compiler\n  // renames variables, and we need to assign in the eval\n  if (typeof args[0] !== 'string') return args[0]\n  try {\n    // eslint-disable-next-line no-eval\n    eval(`arguments[0]=${args[0]};`)\n  } catch (e) {\n    console.error(`${e} parsing config callback '${args[0]}'`)\n  }\n  // @ts-ignore\n  return args[0]\n}\n","import 'whatwg-fetch'\n// import tenaciousFetch from 'tenacious-fetch'\n\nimport { HttpRangeFetcher } from 'http-range-fetcher'\nimport { Buffer } from 'buffer'\nimport { RemoteFile, GenericFilehandle } from 'generic-filehandle'\n\n// function unReplacePath() {\n//   throw new Error('unimplemented') // TODO\n// }\n\nfunction getfetch(url: RequestInfo, opts: RequestInit = {}): Promise<Response> {\n  return fetch(url, {\n    method: 'GET',\n    credentials: 'same-origin',\n    // retries: 5,\n    // retryDelay: 1000, // 1 sec, 2 sec, 3 sec\n    // retryStatus: [500, 404, 503],\n    // onRetry: ({ retriesLeft }: { retriesLeft: number }) => {\n    //   console.warn(\n    //     `${url} request failed, retrying (${retriesLeft} retries left)`,\n    //   )\n    // },\n    ...opts,\n  })\n}\n\nasync function fetchBinaryRange(\n  url: string,\n  start: number,\n  end: number,\n  options: { headers?: HeadersInit; signal?: AbortSignal } = {},\n) {\n  const requestDate = new Date()\n  const requestHeaders = { ...options.headers, range: `bytes=${start}-${end}` }\n  const res = await getfetch(url, {\n    ...options,\n    headers: requestHeaders,\n    // onRetry: ({ retriesLeft }: { retriesLeft: number }) => {\n    //   console.warn(\n    //     `${url} bytes ${start}-${end} request failed, retrying (${retriesLeft} retries left)`,\n    //   )\n    // },\n  })\n  const responseDate = new Date()\n  if (res.status !== 206 && res.status !== 200) {\n    throw new Error(\n      `HTTP ${res.status} when fetching ${url} bytes ${start}-${end}`,\n    )\n  }\n\n  // translate the Headers object into a regular key -> value object.\n  // will miss duplicate headers of course\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const headers: Record<string, any> = {}\n  for (const [k, v] of res.headers.entries()) {\n    headers[k] = v\n  }\n\n  if (res.status === 200) {\n    throw new Error(\n      `HTTP ${res.status} when fetching ${url} bytes ${start}-${end}`,\n    )\n  }\n\n  // return the response headers, and the data buffer\n  const arrayBuffer = await res.arrayBuffer()\n  return {\n    headers,\n    requestDate,\n    responseDate,\n    buffer: Buffer.from(arrayBuffer),\n  }\n}\n\nconst globalRangeCache = new HttpRangeFetcher({\n  fetch: fetchBinaryRange,\n  size: 500 * 1024 * 1024, // 500MB\n  chunkSize: 2 ** 17, // 128KB\n  maxFetchSize: 100 * 1024 * 1024,\n  minimumTTL: 300000000,\n})\n\nasync function globalCacheFetch(\n  url: RequestInfo,\n  opts?: RequestInit,\n): Promise<Response> {\n  // if it is a range request, route it through the global range cache\n  const requestHeaders = opts && opts.headers\n  let range\n  if (requestHeaders) {\n    if (requestHeaders instanceof Headers) range = requestHeaders.get('range')\n    else if (Array.isArray(requestHeaders))\n      [, range] = requestHeaders.find(([key]) => key === 'range') || [\n        undefined,\n        undefined,\n      ]\n    else range = requestHeaders.range\n  }\n  if (range) {\n    const rangeParse = /bytes=(\\d+)-(\\d+)/.exec(range)\n    if (rangeParse) {\n      const [, start, end] = rangeParse\n      const s = parseInt(start, 10)\n      const e = parseInt(end, 10)\n      const response = await (globalRangeCache.getRange(url, s, e - s + 1, {\n        signal: opts && opts.signal,\n      }) as ReturnType<typeof fetchBinaryRange>)\n      const { headers } = response\n      return new Response(response.buffer, { status: 206, headers })\n    }\n  }\n\n  return getfetch(url, opts)\n}\nexport function clearCache() {\n  globalRangeCache.reset()\n}\n\nexport function openUrl(url: string): GenericFilehandle {\n  return new RemoteFile(String(url), {\n    fetch: globalCacheFetch,\n  })\n}\n","import { LocalFile, BlobFile, GenericFilehandle } from 'generic-filehandle'\nimport ElectronLocalFile from './ElectronLocalFile'\nimport ElectronRemoteFile from './ElectronRemoteFile'\nimport { openUrl as rangeFetcherOpenUrl } from './rangeFetcher'\nimport {\n  FileLocation,\n  LocalPathLocation,\n  UriLocation,\n  BlobLocation,\n} from '../types'\n\ndeclare global {\n  interface Window {\n    electron?: import('electron').AllElectron\n  }\n}\n\n// this is recommended in a later comment in https://github.com/electron/electron/issues/2288\n// for detecting electron in a renderer process, which is the one that has node enabled for us\n// const isElectron = process.versions.electron\n// const i2 = process.versions.hasOwnProperty('electron')\nconst isElectron = /electron/i.test(navigator.userAgent)\n\nexport const openUrl = (arg: string) => {\n  return isElectron ? new ElectronRemoteFile(arg) : rangeFetcherOpenUrl(arg)\n}\n\nfunction isUriLocation(location: FileLocation): location is UriLocation {\n  return 'uri' in location\n}\n\nfunction isLocalPathLocation(\n  location: FileLocation,\n): location is LocalPathLocation {\n  return 'localPath' in location\n}\n\nfunction isBlobLocation(location: FileLocation): location is BlobLocation {\n  return 'blob' in location\n}\n\nexport function openLocation(location: FileLocation): GenericFilehandle {\n  if (!location) {\n    throw new Error('must provide a location to openLocation')\n  }\n  if (isElectron) {\n    if (isUriLocation(location)) {\n      return new ElectronRemoteFile(location.uri)\n    }\n    if (isLocalPathLocation(location)) {\n      return new ElectronLocalFile(location.localPath)\n    }\n  } else {\n    if (isUriLocation(location)) {\n      return openUrl(\n        location.baseUri\n          ? new URL(location.uri, location.baseUri).href\n          : location.uri,\n      )\n    }\n    if (isLocalPathLocation(location)) {\n      return new LocalFile(location.localPath)\n    }\n  }\n  if (isBlobLocation(location)) {\n    return new BlobFile(location.blob)\n  }\n  throw new Error('invalid fileLocation')\n}\n","import { Observable, merge } from 'rxjs'\nimport { takeUntil } from 'rxjs/operators'\nimport objectHash from 'object-hash'\nimport { isStateTreeNode, getSnapshot } from 'mobx-state-tree'\nimport { ObservableCreate } from '../util/rxjs'\nimport { checkAbortSignal, observeAbortSignal } from '../util'\nimport { Feature } from '../util/simpleFeature'\nimport { AnyConfigurationModel } from '../configuration/configurationSchema'\nimport { getSubAdapterType } from './dataAdapterCache'\nimport { Region, NoAssemblyRegion } from '../util/types'\n\nexport interface BaseOptions {\n  signal?: AbortSignal\n  bpPerPx?: number\n  sessionId?: string\n  statusCallback?: (message: string) => void\n  headers?: Record<string, string>\n  [key: string]: unknown\n}\n\nexport interface AdapterConstructor {\n  new (\n    config: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n  ): AnyDataAdapter\n}\n\nexport type AnyDataAdapter = BaseFeatureDataAdapter | BaseRefNameAliasAdapter\n\n/**\n * Base class for feature adapters to extend. Defines some methods that\n * subclasses must implement.\n */\nexport abstract class BaseFeatureDataAdapter {\n  public id: string\n\n  constructor(args: unknown = {}) {\n    // note: we use switch on jest here for more simple feature IDs\n    // in test environment\n    if (typeof jest === 'undefined') {\n      const data = isStateTreeNode(args) ? getSnapshot(args) : args\n      this.id = objectHash(data, { ignoreUnknown: true }).slice(0, 5)\n    } else {\n      this.id = 'test'\n    }\n  }\n\n  /**\n   * Get all reference sequence names used in the data source\n   *\n   * NOTE: If an adapter is unable to determine the reference sequence names,\n   * the array will be empty\n   * @param opts - Feature adapter options\n   */\n  public abstract async getRefNames(opts?: BaseOptions): Promise<string[]>\n  // public abstract async getRefNames(opts?: BaseOptions): Promise<string[]>\n  //   await this.setup()\n  //   const { refNames } = this.metadata\n  //   return refNames\n  // }\n\n  /**\n   * Get features from the data source that overlap a region\n   * @param region - Region\n   * @param options - Feature adapter options\n   * @returns Observable of Feature objects in the region\n   */\n  public abstract getFeatures(\n    region: Region,\n    opts?: BaseOptions,\n  ): Observable<Feature>\n  // public abstract getFeatures(\n  //   region: Region,\n  //   opts: BaseOptions,\n  // ): Observable<Feature> {\n  //   return ObservableCreate(observer => {\n  //     const records = getRecords(assembly, refName, start, end)\n  //     records.forEach(record => {\n  //       observer.next(this.recordToFeature(record))\n  //     })\n  //     observer.complete()\n  //   })\n  // }\n\n  /**\n   * Called to provide a hint that data tied to a certain region will not be\n   * needed for the forseeable future and can be purged from caches, etc\n   * @param region - Region\n   */\n  public abstract freeResources(region: Region): void\n\n  /**\n   * Return \"header info\" that is fetched from the data file, or other info\n   * that would not simply be in the config of the file. The return value can\n   * be `{tag:string, data: any}[]` e.g. list of tags with their values which\n   * is how VCF,BAM,CRAM return values for getInfo or it can be a nested JSON\n   * object\n   */\n  public async getHeader(_?: BaseOptions): Promise<unknown> {\n    return null\n  }\n\n  /**\n   * Return info that is primarily used for interpreting the data that is there,\n   * primarily in reference to being used for augmenting feature details panels\n   */\n  public async getMetadata(_?: BaseOptions): Promise<unknown> {\n    return null\n  }\n\n  /**\n   * Checks if the store has data for the given assembly and reference\n   * sequence, and then gets the features in the region if it does.\n   */\n  public getFeaturesInRegion(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const hasData = await this.hasDataForRefName(region.refName, opts)\n      checkAbortSignal(opts.signal)\n      if (!hasData) {\n        // console.warn(`no data for ${region.refName}`)\n        observer.complete()\n      } else {\n        this.getFeatures(region, opts)\n          .pipe(takeUntil(observeAbortSignal(opts.signal)))\n          .subscribe(observer)\n      }\n    })\n  }\n\n  /**\n   * Checks if the store has data for the given assembly and reference\n   * sequence, and then gets the features in the region if it does.\n   *\n   * Currently this just calls getFeatureInRegion for each region. Adapters\n   * that are frequently called on multiple regions simultaneously may\n   * want to implement a more efficient custom version of this method.\n   *\n   * Currently this just calls getFeatureInRegion for each region. Adapters that\n   * are frequently called on multiple regions simultaneously may want to\n   * implement a more efficient custom version of this method.\n   * @param regions - Regions\n   * @param opts - Feature adapter options\n   * @returns Observable of Feature objects in the regions\n   */\n  public getFeaturesInMultipleRegions(\n    regions: Region[],\n    opts: BaseOptions = {},\n  ) {\n    const obs = merge(\n      ...regions.map(region => {\n        return ObservableCreate<Feature>(async observer => {\n          const hasData = await this.hasDataForRefName(region.refName, opts)\n          checkAbortSignal(opts.signal)\n          if (!hasData) {\n            // console.warn(`no data for ${region.refName}`)\n            observer.complete()\n          } else {\n            this.getFeatures(region, opts).subscribe(observer)\n          }\n        })\n      }),\n    )\n\n    if (opts.signal) {\n      return obs.pipe(takeUntil(observeAbortSignal(opts.signal)))\n    }\n    return obs\n  }\n\n  /**\n   * Check if the store has data for the given reference name.\n   * @param refName - Name of the reference sequence\n   * @returns Whether data source has data for the given reference name\n   */\n  public async hasDataForRefName(refName: string, opts: BaseOptions = {}) {\n    const refNames = await this.getRefNames(opts)\n    return refNames.includes(refName)\n  }\n}\n\nexport interface RegionsAdapter extends BaseFeatureDataAdapter {\n  getRegions(opts: { signal?: AbortSignal }): Promise<NoAssemblyRegion[]>\n}\n\nexport function isRegionsAdapter(\n  thing: BaseFeatureDataAdapter,\n): thing is RegionsAdapter {\n  return 'getRegions' in thing\n}\n\nexport interface Alias {\n  refName: string\n  aliases: string[]\n}\nexport interface BaseRefNameAliasAdapter {\n  getRefNameAliases(opts: BaseOptions): Promise<Alias[]>\n\n  freeResources(): Promise<void>\n}\nexport function isRefNameAliasAdapter(\n  thing: object,\n): thing is BaseRefNameAliasAdapter {\n  return 'getRefNameAliases' in thing\n}\n","import { Observable, Observer } from 'rxjs'\nimport { takeUntil } from 'rxjs/operators'\nimport { observeAbortSignal } from '.'\n\n/**\n * Wrapper for rxjs Observable.create with improved error handling and\n * aborting support\n * @param func - observer function, could be async\n */\nexport function ObservableCreate<T>(\n  func: (arg: Observer<T>) => void | Promise<void>,\n  signal?: AbortSignal,\n): Observable<T> {\n  return Observable.create((observer: Observer<T>) => {\n    try {\n      const ret = func(observer)\n      // catch async errors\n      if (ret && ret.catch) {\n        ret.catch((error: Error) => observer.error(error))\n      }\n    } catch (error) {\n      // catch sync errors\n      observer.error(error)\n    }\n  }).pipe(takeUntil(observeAbortSignal(signal)))\n}\n","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAACWCAYAAACb3McZAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAB7CAAAewgBeCQdoQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAMUSURBVHic7dsxixRnAMbxd3anCZhGU4okkCOKhfU27uUTxAi3bYpY5Duk1cbGLyApUnog+A20kK2SxkawiWIKuayVVplz0mQhiD57566+c9nfr9tiXp7mzw4zTCkAAAAAAAAAAAAAAACcJE3tAdvk9NVrZ8uom6x1yJt2/vLu7ecbmsQKbe0BW2XUTZqm3FnniH7UzUop+xtaxAqj2gNgyAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQNDWHnAUn329e3Zc+kntHevqF692mi9OrXXG5I/Rzjfnftzb0KRq2sNmfvPP289r71jlRAQyLv2k6cud2jvW1T07KG1THozOnJp+yPWXn4zvf/Wy3Nj0rhq6cT8rpezX3rGKW6xPrHt6MH2zePXguNf9G8fuR5hEIJAKjhuJOOoRSCVHjUQcdQmkolWRiKM+gVT2vkjEMQwCGYC3IxHHcJyIx7zboHt6MG1HzcNv//q8+1Icg+EfZEB+ufzo7+uz32vP4D8EMhC//vDi/pVLr3cvXFxMr/3027Hfk/BxCGQAlnEsf4tkOARS2dtxLIlkGARS0fviWBJJfQKpZFUcSyKpSyAVHDWOJZHUI5BP7LhxLImkjhPxovCwNPNx089q71jXre8XO1cuvf7g7zkuXFxMr+49/vnu/vknm9xVQ3vYzGtvOIqm9oBt0t87t1dKv+aHX82s+e7Z4D80+r9wiwWBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAI2toDtkp3OC/teLb2GQAAAAAAAAAAAAAAAMA7/QMEwsCcxccm/QAAAABJRU5ErkJggg==\"","module.exports = __webpack_public_path__ + \"static/media/linearGenomeViewIcon.74c99836.png\";","module.exports = __webpack_public_path__ + \"static/media/svInspectorIcon.06d28298.png\";","/* eslint-disable no-underscore-dangle */\nimport uri2path from 'file-uri-to-path'\nimport {\n  Fetcher,\n  FilehandleOptions,\n  GenericFilehandle,\n  PolyfilledResponse,\n  Stats,\n} from 'generic-filehandle'\nimport ElectronLocalFile from './ElectronLocalFile'\nimport { isAbortException } from '../index'\n\ndeclare global {\n  interface Window {\n    electron?: import('electron').AllElectron\n  }\n}\nconst { electron } = window\n\nclass ElectronRemoteFileError extends Error {\n  public status: number | undefined\n}\n\ninterface SerializedResponse {\n  buffer: Buffer\n  url: string\n  status: number\n  statusText: string\n  headers: string[][]\n}\n\nexport default class ElectronRemoteFile implements GenericFilehandle {\n  protected url: string\n\n  protected _stat?: Stats\n\n  protected fetch?: Fetcher\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  protected baseOverrides: any = {}\n\n  private nodeFetchFallback = false\n\n  private ipcRenderer: import('electron').IpcRenderer\n\n  public constructor(source: string, opts: FilehandleOptions = {}) {\n    let ipcRenderer\n    if (electron) ipcRenderer = electron.ipcRenderer\n    if (!ipcRenderer)\n      throw new Error(\n        'Cannot use ElectronLocalFile without ipcRenderer from electron',\n      )\n    this.ipcRenderer = ipcRenderer\n\n    this.url = source\n\n    // if it is a file URL, monkey-patch ourselves to act like a LocalFile\n    if (source.startsWith('file://')) {\n      const path = uri2path(source)\n      if (!path) throw new TypeError('invalid file url')\n      const localFile = new ElectronLocalFile(path)\n      this.read = localFile.read.bind(localFile)\n      this.readFile = localFile.readFile.bind(localFile)\n      this.stat = localFile.stat.bind(localFile)\n      return\n    }\n\n    const fetcharg = opts.fetch || window.fetch\n    if (!fetch) {\n      throw new TypeError(\n        `no fetch function supplied, and none found in global environment`,\n      )\n    }\n    this.fetch = fetcharg\n\n    if (opts.overrides) {\n      this.baseOverrides = opts.overrides\n    }\n  }\n\n  private async getBufferFromResponse(\n    response: PolyfilledResponse,\n  ): Promise<Buffer> {\n    if (typeof response.buffer === 'function') {\n      return response.buffer()\n    }\n    if (typeof response.arrayBuffer === 'function') {\n      const resp = await response.arrayBuffer()\n      return Buffer.from(resp)\n    }\n    throw new TypeError(\n      'invalid HTTP response object, has no buffer method, and no arrayBuffer method',\n    )\n  }\n\n  private nodeFetch = async (\n    input: RequestInfo,\n    init?: RequestInit,\n  ): Promise<Response> => {\n    if (init) init.signal = undefined\n    const serializedResponse = (await this.ipcRenderer.invoke(\n      'fetch',\n      input,\n      init,\n    )) as SerializedResponse\n    const { buffer, headers, status, statusText } = serializedResponse\n    const response = new Response(buffer, { status, statusText, headers })\n    return response\n  }\n\n  protected async getFetch(\n    opts: FilehandleOptions,\n  ): Promise<PolyfilledResponse> {\n    if (!this.fetch)\n      throw new Error(\n        'a fetch function must be available unless using a file:// url',\n      )\n    if (!this.url) {\n      throw new Error('no URL specified')\n    }\n    const myfetch = this.nodeFetchFallback ? this.nodeFetch : this.fetch\n    const { headers = {}, signal, overrides = {} } = opts\n    const requestOptions = {\n      headers,\n      method: 'GET',\n      redirect: 'follow',\n      mode: 'cors',\n      signal,\n      ...this.baseOverrides,\n      ...overrides,\n    }\n    let response\n    try {\n      response = await myfetch(this.url, requestOptions)\n    } catch (error) {\n      if (!isAbortException(error)) {\n        if (this.nodeFetchFallback) {\n          throw error\n        }\n        console.warn('received error, falling back to node-fetch', error)\n        this.nodeFetchFallback = true\n        return this.getFetch(opts)\n      }\n      // rethrow abort\n      throw error\n    }\n\n    if (!this._stat) {\n      // try to parse out the size of the remote file\n      if (requestOptions.headers && requestOptions.headers.range) {\n        const contentRange = response.headers.get('content-range')\n        const sizeMatch = /\\/(\\d+)$/.exec(contentRange || '')\n        if (sizeMatch && sizeMatch[1])\n          this._stat = { size: parseInt(sizeMatch[1], 10) }\n      } else {\n        const contentLength = response.headers.get('content-length')\n        if (contentLength) this._stat = { size: parseInt(contentLength, 10) }\n      }\n    }\n    return response\n  }\n\n  protected async headFetch(): Promise<PolyfilledResponse> {\n    return this.getFetch({ overrides: { method: 'HEAD' } })\n  }\n\n  public async read(\n    buffer: Buffer,\n    offset = 0,\n    length: number,\n    position = 0,\n    opts: FilehandleOptions = {},\n  ): Promise<{ bytesRead: number; buffer: Buffer }> {\n    opts.headers = opts.headers || {}\n    if (length < Infinity) {\n      opts.headers.range = `bytes=${position}-${position + length}`\n    } else if (length === Infinity && position !== 0) {\n      opts.headers.range = `bytes=${position}-`\n    }\n\n    const response = await this.getFetch(opts)\n    if (\n      (response.status === 200 && position === 0) ||\n      response.status === 206\n    ) {\n      const responseData = await this.getBufferFromResponse(response)\n      const bytesCopied = responseData.copy(\n        buffer,\n        offset,\n        0,\n        Math.min(length, responseData.length),\n      )\n\n      return { bytesRead: bytesCopied, buffer }\n    }\n\n    // TODO: try harder here to gather more information about what the problem is\n    throw new Error(`HTTP ${response.status} fetching ${this.url}`)\n  }\n\n  public async readFile(\n    options: FilehandleOptions | string = {},\n  ): Promise<Buffer | string> {\n    let encoding\n    let opts\n    if (typeof options === 'string') {\n      encoding = options\n      opts = {}\n    } else {\n      encoding = options.encoding\n      opts = options\n      delete opts.encoding\n    }\n    const response = await this.getFetch(opts)\n    if (response.status !== 200) {\n      const err = new ElectronRemoteFileError(\n        `HTTP ${response.status} fetching ${this.url}`,\n      )\n      err.status = response.status\n      throw err\n    }\n    if (encoding === 'utf8') {\n      return response.text()\n    }\n    if (encoding) {\n      throw new Error(`unsupported encoding: ${encoding}`)\n    }\n    return this.getBufferFromResponse(response)\n  }\n\n  public async stat(): Promise<Stats> {\n    if (!this._stat) await this.headFetch()\n    if (!this._stat) await this.read(Buffer.allocUnsafe(10), 0, 10, 0)\n    if (!this._stat)\n      throw new Error(`unable to determine size of file at ${this.url}`)\n    return this._stat\n  }\n}\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region, FileLocation } from '@jbrowse/core/util/types'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport type { GenericFilehandle } from 'generic-filehandle'\nimport HicStraw from 'hic-straw'\nimport MyConfigSchema from './configSchema'\n\ninterface ContactRecord {\n  bin1: number\n  bin2: number\n  counts: number\n}\n\ninterface HicMetadata {\n  chromosomes: {\n    name: string\n    length: number\n    id: number\n  }[]\n  resolutions: number[]\n}\ninterface Ref {\n  chr: string\n  start: number\n  end: number\n}\n\n// wraps generic-filehandle so the read function only takes a position and length\n// in some ways, generic-filehandle wishes it was just this but it has\n// to adapt to the node.js fs promises API\nclass GenericFilehandleWrapper {\n  private filehandle: GenericFilehandle\n\n  constructor(filehandle: GenericFilehandle) {\n    this.filehandle = filehandle\n  }\n\n  async read(position: number, length: number) {\n    const { buffer, bytesRead } = await this.filehandle.read(\n      Buffer.allocUnsafe(length),\n      0,\n      length,\n      position,\n    )\n    return buffer.buffer.slice(0, bytesRead)\n  }\n}\nexport function openFilehandleWrapper(location: FileLocation) {\n  return new GenericFilehandleWrapper(openLocation(location))\n}\n\nexport default class HicAdapter extends BaseFeatureDataAdapter {\n  private hic: {\n    getContactRecords: (\n      normalize: string,\n      ref: Ref,\n      ref2: Ref,\n      units: string,\n      binsize: number,\n    ) => Promise<ContactRecord[]>\n    getMetaData: () => Promise<HicMetadata>\n  }\n\n  public constructor(config: Instance<typeof MyConfigSchema>) {\n    super(config)\n    const hicLocation = readConfObject(config, 'hicLocation')\n    this.hic = new HicStraw({\n      file: openFilehandleWrapper(hicLocation),\n    })\n  }\n\n  async getRefNames() {\n    const metadata = await this.hic.getMetaData()\n    return metadata.chromosomes.map(chr => chr.name)\n  }\n\n  async getResolution(bpPerPx: number) {\n    const metadata = await this.hic.getMetaData()\n    const { resolutions } = metadata\n    let chosenResolution = resolutions[resolutions.length - 1]\n\n    for (let i = resolutions.length - 1; i >= 0; i -= 1) {\n      const r = resolutions[i]\n      if (r <= 2 * bpPerPx) {\n        chosenResolution = r\n      }\n    }\n    return chosenResolution\n  }\n\n  getFeatures(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<ContactRecord>(async observer => {\n      const { refName: chr, start, end } = region\n      const { bpPerPx } = opts\n      const res = await this.getResolution(bpPerPx || 1000)\n\n      const records = await this.hic.getContactRecords(\n        'KR',\n        { start, chr, end },\n        { start, chr, end },\n        'BP',\n        res,\n      )\n      records.forEach(record => {\n        observer.next(record)\n      })\n      observer.complete()\n    }, opts.signal) as any // eslint-disable-line @typescript-eslint/no-explicit-any\n  }\n\n  freeResources(/* { region } */): void {}\n}\n","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"91abc507c1c855a20cb5.worker.js\");\n};","export default abstract class PluggableElementBase {\n  [key: string]: unknown\n\n  name = ''\n\n  constructor({ name }: { name: string }) {\n    this.name = name\n  }\n}\n","import React from 'react'\nimport { getDefaultValue } from '../../util/mst-reflection'\nimport PluggableElementBase from '../PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../../configuration/configurationSchema'\nimport { AnyReactComponentType } from '../../util'\n\nexport default class RendererType extends PluggableElementBase {\n  ReactComponent: AnyReactComponentType\n\n  configSchema: AnyConfigurationSchemaType\n\n  constructor(stuff: {\n    name: string\n    ReactComponent: AnyReactComponentType\n    configSchema: AnyConfigurationSchemaType\n  }) {\n    super(stuff)\n    this.ReactComponent = stuff.ReactComponent\n    this.configSchema = stuff.configSchema\n\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for renderer ${this.name}`)\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      throw new Error(\n        `${this.name} config schema ${this.configSchema.name} is not explicitlyTyped`,\n      )\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  async render(props: Record<string, any>): Promise<Record<string, any>> {\n    return { element: React.createElement(this.ReactComponent, props, null) }\n  }\n\n  /**\n   * frees resources associated with the given range, session, etc.\n   * optionally returns the number of data items deleted\n   */\n  freeResources(/* specification: {} */): number {\n    return 0\n  }\n}\n","import PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport { AdapterConstructor } from '../data_adapters/BaseAdapter'\n\nexport default class AdapterType extends PluggableElementBase {\n  AdapterClass: AdapterConstructor\n\n  configSchema: AnyConfigurationSchemaType\n\n  constructor(stuff: {\n    name: string\n    AdapterClass: AdapterConstructor\n    configSchema: AnyConfigurationSchemaType\n  }) {\n    super(stuff)\n    this.AdapterClass = stuff.AdapterClass\n    this.configSchema = stuff.configSchema\n    if (!this.AdapterClass) {\n      throw new Error(`no AdapterClass defined for adapter type ${this.name}`)\n    }\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { getDefaultValue } from '../util/mst-reflection'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport DisplayType from './DisplayType'\n\nexport default class TrackType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  displayTypes: DisplayType[] = []\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    configSchema: AnyConfigurationSchemaType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for track ${this.name}`)\n    }\n    if (!this.configSchema) {\n      throw new Error(`no configSchema provided for track ${this.name}`)\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      const name = this.configSchema ? this.configSchema.name : 'UNKNOWN'\n      throw new Error(`${name} is not explicitlyTyped`)\n    }\n  }\n\n  addDisplayType(display: DisplayType) {\n    this.displayTypes.push(display)\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyReactComponentType } from '../util'\nimport { getDefaultValue } from '../util/mst-reflection'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\n\nexport default class DisplayType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  ReactComponent: AnyReactComponentType\n\n  trackType: string\n\n  viewType: string\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    trackType: string\n    viewType: string\n    configSchema: AnyConfigurationSchemaType\n    ReactComponent: AnyReactComponentType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    this.ReactComponent = stuff.ReactComponent\n    this.trackType = stuff.trackType\n    this.viewType = stuff.viewType\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for display ${this.name}`)\n    }\n    if (!this.configSchema) {\n      throw new Error(`no configSchema provided for display ${this.name}`)\n    }\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent provided for display ${this.name}`)\n    }\n    if (!this.trackType) {\n      throw new Error(`no trackType provided for display ${this.name}`)\n    }\n    if (!this.viewType) {\n      throw new Error(`no viewType provided for display ${this.name}`)\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      const name = this.configSchema ? this.configSchema.name : 'UNKNOWN'\n      throw new Error(`${name} is not explicitlyTyped`)\n    }\n  }\n}\n","import { IAnyModelType, IAnyStateTreeNode } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport DisplayType from './DisplayType'\n\ntype ViewReactComponent = React.ComponentType<{\n  // TODO: can we use AbstractViewModel here?\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  model: any\n  session?: IAnyStateTreeNode\n}>\n\nexport default class ViewType extends PluggableElementBase {\n  ReactComponent: ViewReactComponent\n\n  stateModel: IAnyModelType\n\n  displayTypes: DisplayType[] = []\n\n  constructor(stuff: {\n    name: string\n    ReactComponent: ViewReactComponent\n    stateModel: IAnyModelType\n  }) {\n    super(stuff)\n    this.ReactComponent = stuff.ReactComponent\n    this.stateModel = stuff.stateModel\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for view ${this.name}`)\n    }\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for view ${this.name}`)\n    }\n  }\n\n  addDisplayType(display: DisplayType) {\n    this.displayTypes.push(display)\n  }\n}\n","import { ComponentType } from 'react'\nimport { IAnyModelType, IAnyStateTreeNode } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\n\nexport default class WidgetType extends PluggableElementBase {\n  heading?: string\n\n  configSchema: AnyConfigurationSchemaType\n\n  HeadingComponent?: ComponentType<{ model: IAnyStateTreeNode }>\n\n  ReactComponent: ComponentType<{\n    model: IAnyStateTreeNode\n    session: IAnyStateTreeNode\n  }>\n\n  stateModel: IAnyModelType\n\n  constructor(stuff: {\n    name: string\n    heading?: string\n    HeadingComponent?: ComponentType<{ model: IAnyStateTreeNode }>\n    configSchema: AnyConfigurationSchemaType\n    stateModel: IAnyModelType\n    ReactComponent: ComponentType<{\n      model: IAnyStateTreeNode\n      session: IAnyStateTreeNode\n    }>\n  }) {\n    super(stuff)\n    this.heading = stuff.heading\n    this.HeadingComponent = stuff.HeadingComponent\n    this.configSchema = stuff.configSchema\n    this.stateModel = stuff.stateModel\n    this.ReactComponent = stuff.ReactComponent\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for widget ${this.name}`)\n    }\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for widget ${this.name}`)\n    }\n  }\n}\n","/* eslint-disable react/static-property-placement */\nimport { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport { AnyReactComponentType } from '../util'\n\nexport default class ConnectionType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  displayName: string\n\n  description: string\n\n  url: string\n\n  configEditorComponent?: AnyReactComponentType\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    configSchema: AnyConfigurationSchemaType\n    displayName: string\n    description: string\n    configEditorComponent?: AnyReactComponentType\n    url: string\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    this.displayName = stuff.displayName\n    this.description = stuff.description\n    this.url = stuff.url\n    this.configEditorComponent = stuff.configEditorComponent\n    if (!this.stateModel)\n      throw new Error(`no stateModel defined for connection ${this.name}`)\n    if (!this.configSchema)\n      throw new Error(`no configSchema defined for connection ${this.name}`)\n  }\n}\n","/* ---------------- for the RPC client ----------------- */\n\nlet abortSignalCounter = 0\nexport type RemoteAbortSignal = { abortSignalId: number }\nconst abortSignalIds: WeakMap<AbortSignal, number> = new WeakMap() // map of abortsignal => numerical ID\n\n/**\n * assign an ID to the given abort signal and return a plain object representation\n * @param signal - the signal to serialize\n * @param callfunc - function used to call\n *  a remote method, will be called like callfunc('signalAbort', signalId)\n */\nexport function serializeAbortSignal(\n  signal: AbortSignal,\n  callfunc: (name: string, abortSignalId: number) => void,\n): RemoteAbortSignal {\n  let abortSignalId = abortSignalIds.get(signal)\n  if (!abortSignalId) {\n    abortSignalCounter += 1\n    abortSignalIds.set(signal, abortSignalCounter)\n    abortSignalId = abortSignalCounter\n    signal.addEventListener('abort', () => {\n      const signalId = abortSignalIds.get(signal)\n      if (signalId !== undefined) {\n        callfunc('signalAbort', signalId)\n      }\n    })\n  }\n  return { abortSignalId }\n}\n\n/* ---------------- for the RPC server ----------------- */\n\n/**\n * test whether a given object\n * @param thing - the thing to test\n * @returns true if the thing is a remote abort signal\n */\nexport function isRemoteAbortSignal(\n  thing: unknown,\n): thing is RemoteAbortSignal {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'abortSignalId' in thing &&\n    // @ts-ignore\n    typeof thing.abortSignalId === 'number'\n  )\n}\n\n// the server side keeps a set of surrogate abort controllers that can be\n// aborted based on ID\nconst surrogateAbortControllers: Map<number, AbortController> = new Map() // numerical ID => surrogate abort controller\n\n/**\n * deserialize the result of serializeAbortSignal into an AbortSignal\n *\n * @param signal -\n * @returns an abort signal that corresponds to the given ID\n */\nexport function deserializeAbortSignal({\n  abortSignalId,\n}: RemoteAbortSignal): AbortSignal {\n  let surrogateAbortController = surrogateAbortControllers.get(abortSignalId)\n  if (!surrogateAbortController) {\n    surrogateAbortController = new AbortController()\n    surrogateAbortControllers.set(abortSignalId, surrogateAbortController)\n  }\n  return surrogateAbortController.signal\n}\n\n/**\n * fire an abort signal from a remote abort signal ID\n *\n * @param abortSignalId -\n */\nexport function remoteAbort(abortSignalId: number) {\n  const surrogateAbortController = surrogateAbortControllers.get(abortSignalId)\n  if (surrogateAbortController) surrogateAbortController.abort()\n}\n\nexport function remoteAbortRpcHandler() {\n  return {\n    signalAbort: remoteAbort,\n  }\n}\n","import PluginManager from '../PluginManager'\nimport PluggableElementBase from './PluggableElementBase'\n\nimport {\n  deserializeAbortSignal,\n  isRemoteAbortSignal,\n  RemoteAbortSignal,\n} from '../rpc/remoteAbortSignals'\n\nexport type RpcMethodConstructor = new (pm: PluginManager) => RpcMethodType\n\nexport default class RpcMethodType extends PluggableElementBase {\n  pluginManager: PluginManager\n\n  name = 'UNKNOWN'\n\n  constructor(pluginManager: PluginManager) {\n    super({ name: '' })\n    this.pluginManager = pluginManager\n  }\n\n  async serializeArguments(args: {}): Promise<{}> {\n    return args\n  }\n\n  async deserializeArguments<SERIALIZED extends { signal?: RemoteAbortSignal }>(\n    serializedArgs: SERIALIZED,\n  ) {\n    const { signal } = serializedArgs\n    if (signal && isRemoteAbortSignal(signal)) {\n      return { ...serializedArgs, signal: deserializeAbortSignal(signal) }\n    }\n    return { ...serializedArgs, signal: undefined }\n  }\n\n  async execute(_serializedArgs: unknown): Promise<unknown> {\n    throw new Error('execute method is abstract')\n  }\n\n  async serializeReturn(originalReturn: unknown) {\n    return originalReturn\n  }\n\n  async deserializeReturn(serializedReturn: unknown): Promise<unknown> {\n    return serializedReturn\n  }\n}\n","import React from 'react'\nimport escapeHTML from 'escape-html'\nimport dompurify from 'dompurify'\n\n// source https://github.com/sindresorhus/html-tags/blob/master/html-tags.json\n// with some random uncommon ones removed. note: we just use this to run the content\n// through dompurify without escaping if we see an htmlTag from this list\n// otherwise we escape angle brackets and things prematurely because it might be\n// something like <TRA> in VCF. Ref #657\nconst htmlTags = [\n  'a',\n  'b',\n  'br',\n  'code',\n  'div',\n  'em',\n  'h1',\n  'h2',\n  'h3',\n  'h4',\n  'h5',\n  'h6',\n  'i',\n  'img',\n  'li',\n  'p',\n  'pre',\n  'span',\n  'small',\n  'strong',\n  'table',\n  'tbody',\n  'td',\n  'tfoot',\n  'th',\n  'thead',\n  'tr',\n  'u',\n  'ul',\n]\n\n// adapted from is-html https://github.com/sindresorhus/is-html/blob/master/index.js\nconst full = new RegExp(htmlTags.map(tag => `<${tag}\\\\b[^>]*>`).join('|'), 'i')\nexport function isHTML(str: string) {\n  return full.test(str)\n}\n\nexport default function SanitizedHTML({ html }: { html: string }) {\n  const value = isHTML(html) ? html : escapeHTML(html)\n\n  // eslint-disable-next-line react/no-danger\n  return <div dangerouslySetInnerHTML={{ __html: dompurify.sanitize(value) }} />\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any,react/prop-types */\nimport Accordion from '@material-ui/core/Accordion'\nimport AccordionDetails from '@material-ui/core/AccordionDetails'\nimport AccordionSummary from '@material-ui/core/AccordionSummary'\nimport Typography from '@material-ui/core/Typography'\nimport ExpandMore from '@material-ui/icons/ExpandMore'\nimport Divider from '@material-ui/core/Divider'\nimport Paper from '@material-ui/core/Paper'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport React, { FunctionComponent } from 'react'\nimport isObject from 'is-object'\nimport SanitizedHTML from '../ui/SanitizedHTML'\n\nexport const useStyles = makeStyles(theme => ({\n  expansionPanelDetails: {\n    display: 'block',\n    padding: theme.spacing(1),\n  },\n  expandIcon: {\n    color: '#FFFFFF',\n  },\n  paperRoot: {\n    background: theme.palette.grey[100],\n  },\n  field: {\n    display: 'flex',\n  },\n  fieldName: {\n    wordBreak: 'break-all',\n    minWidth: '90px',\n    maxWidth: '150px',\n    borderBottom: '1px solid #0003',\n    backgroundColor: theme.palette.grey[200],\n    marginRight: theme.spacing(1),\n    padding: theme.spacing(0.5),\n  },\n  fieldValue: {\n    wordBreak: 'break-word',\n    maxHeight: 300,\n    padding: theme.spacing(0.5),\n    overflow: 'auto',\n  },\n  fieldSubvalue: {\n    wordBreak: 'break-word',\n    maxHeight: 300,\n    padding: theme.spacing(0.5),\n    backgroundColor: theme.palette.grey[100],\n    border: `1px solid ${theme.palette.grey[300]}`,\n    boxSizing: 'border-box',\n    overflow: 'auto',\n  },\n}))\nconst coreRenderedDetails = [\n  'Position',\n  'Description',\n  'Name',\n  'Length',\n  'Type',\n]\n\ninterface BaseCardProps {\n  title?: string\n}\n\nexport const BaseCard: FunctionComponent<BaseCardProps> = props => {\n  const classes = useStyles()\n  const { children, title } = props\n  return (\n    <Accordion style={{ marginTop: '4px' }} defaultExpanded>\n      <AccordionSummary\n        expandIcon={<ExpandMore className={classes.expandIcon} />}\n      >\n        <Typography variant=\"button\"> {title}</Typography>\n      </AccordionSummary>\n      <AccordionDetails className={classes.expansionPanelDetails}>\n        {children}\n      </AccordionDetails>\n    </Accordion>\n  )\n}\n\ninterface BaseProps extends BaseCardProps {\n  feature: Record<string, any>\n  descriptions?: Record<string, React.ReactNode>\n}\n\nexport const BaseCoreDetails = (props: BaseProps) => {\n  const classes = useStyles()\n  const { feature } = props\n  const { refName, start, end, strand } = feature\n  const strandMap: Record<number, string> = {\n    '-1': '-',\n    '0': '',\n    '1': '+',\n  }\n  const strandStr = strandMap[strand] ? `(${strandMap[strand]})` : ''\n  const displayedDetails: Record<string, any> = {\n    ...feature,\n    length: end - start,\n    position: `${refName}:${start + 1}..${end} ${strandStr}`,\n  }\n\n  return (\n    <BaseCard {...props} title=\"Primary data\">\n      {coreRenderedDetails.map(key => {\n        const value = displayedDetails[key.toLowerCase()]\n        const strValue = String(value)\n        return value !== null && value !== undefined ? (\n          <div className={classes.field} key={key}>\n            <div className={classes.fieldName}>{key}</div>\n            <div className={classes.fieldValue}>\n              <SanitizedHTML html={strValue} />\n            </div>\n          </div>\n        ) : null\n      })}\n    </BaseCard>\n  )\n}\n\nconst omit = [\n  'name',\n  'start',\n  'end',\n  'strand',\n  'refName',\n  'type',\n  'length',\n  'position',\n  'subfeatures',\n  'uniqueId',\n  'exonFrames',\n]\n\ninterface AttributeProps {\n  attributes: Record<string, any>\n  omit?: string[]\n  formatter?: (val: unknown) => JSX.Element\n  descriptions?: Record<string, React.ReactNode>\n}\n\nexport const Attributes: FunctionComponent<AttributeProps> = props => {\n  const classes = useStyles()\n  const {\n    attributes,\n    omit: propOmit = [],\n    formatter = (value: unknown) => (\n      <SanitizedHTML\n        html={isObject(value) ? JSON.stringify(value) : String(value)}\n      />\n    ),\n    descriptions,\n  } = props\n\n  const SimpleValue = ({ name, value }: { name: string; value: any }) => {\n    const description = descriptions && descriptions[name]\n    return value ? (\n      <div style={{ display: 'flex' }}>\n        {description ? (\n          <Tooltip title={description} placement=\"left\">\n            <div className={classes.fieldName}>{name}</div>\n          </Tooltip>\n        ) : (\n          <div className={classes.fieldName}>{name}</div>\n        )}\n        <div className={classes.fieldValue}>{formatter(value)}</div>\n      </div>\n    ) : null\n  }\n  const ArrayValue = ({ name, value }: { name: string; value: any[] }) => {\n    const description = descriptions && descriptions[name]\n    return (\n      <div style={{ display: 'flex' }}>\n        {description ? (\n          <Tooltip title={description} placement=\"left\">\n            <div className={classes.fieldName}>{name}</div>\n          </Tooltip>\n        ) : (\n          <div className={classes.fieldName}>{name}</div>\n        )}\n        {value.map((val, i) => (\n          <div key={`${name}-${i}`} className={classes.fieldSubvalue}>\n            <SanitizedHTML\n              html={isObject(val) ? JSON.stringify(val) : String(val)}\n            />\n          </div>\n        ))}\n      </div>\n    )\n  }\n\n  return (\n    <>\n      {Object.entries(attributes)\n        .filter(\n          ([k, v]) =>\n            v !== undefined && !omit.includes(k) && !propOmit.includes(k),\n        )\n        .map(([key, value]) => {\n          if (Array.isArray(value)) {\n            return value.length === 1 ? (\n              <SimpleValue key={key} name={key} value={value[0]} />\n            ) : (\n              <ArrayValue key={key} name={key} value={value} />\n            )\n          }\n          if (isObject(value)) {\n            return (\n              <Attributes\n                key={key}\n                attributes={value}\n                descriptions={descriptions}\n              />\n            )\n          }\n\n          return <SimpleValue key={key} name={key} value={value} />\n        })}\n    </>\n  )\n}\n\nexport const BaseAttributes = (props: BaseProps) => {\n  const { feature, descriptions } = props\n  return (\n    <BaseCard {...props} title=\"Attributes\">\n      <Attributes {...props} attributes={feature} descriptions={descriptions} />\n    </BaseCard>\n  )\n}\n\nexport interface BaseInputProps extends BaseCardProps {\n  omit?: string[]\n  model: any\n  formatter?: (val: unknown) => JSX.Element\n  descriptions?: Record<string, React.ReactNode>\n}\n\nexport const BaseFeatureDetails = observer((props: BaseInputProps) => {\n  const classes = useStyles()\n  const { model, descriptions } = props\n  const feat = JSON.parse(JSON.stringify(model.featureData))\n  return (\n    <Paper className={classes.paperRoot}>\n      <BaseCoreDetails feature={feat} {...props} />\n      <Divider />\n      <BaseAttributes feature={feat} {...props} descriptions={descriptions} />\n    </Paper>\n  )\n})\n","/**\n * fast low-level intersection of 2 coordinate ranges. assumes interbase coordinates.\n *\n * assumes `left <= right` for both ranges\n *\n * @returns array of [left, right], or [] if the ranges do not intersect. the choice of [] is because it allows destructuring array assignment without check for undefined return\n */\nexport function intersection2(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  // this code is verbose because \"if\" statements are faster than Math.min and Math.max\n  if (right1 > left2 && left1 < right2 && right2 - left2 && right1 - left1) {\n    if (left1 > left2) {\n      if (right1 < right2) {\n        // 1     |-------|\n        //     |------------|\n        return [left1, right1]\n      }\n      // 2         |----|\n      //      |------|\n      return [left1, right2]\n    }\n    if (right1 < right2) {\n      // 3  |-----|\n      //       |------|\n      return [left2, right1]\n    }\n    // 4     |------------|\n    //         |-------|\n    return [left2, right2]\n  }\n  return []\n}\n\n/**\n * Return whether 2 interbase coordinate ranges intersect.\n *\n * @param left1 -\n * @param right1 -\n * @param left2 -\n * @param right2 -\n *\n * @returns true if the two ranges intersect\n */\nexport function doesIntersect2(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  return right1 > left2 && left1 < right2\n}\n\n/**\n * Return whether the first region is completely contained within the second region\n *\n * @param left1 - candidate inner region left\n * @param right1 - candidate inner region right\n * @param left2 - candidate outer region left\n * @param right2 - candidate outer region right\n */\nexport function isContainedWithin(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  return left2 <= left1 && right2 >= right1\n}\n","type Func<T> = (value: BaseBlock, index: number, array: BaseBlock[]) => T\n\nexport class BlockSet {\n  blocks: BaseBlock[] = []\n\n  constructor(blocks: BaseBlock[] = []) {\n    this.blocks = blocks\n  }\n\n  push(block: BaseBlock) {\n    if (block instanceof ElidedBlock) {\n      if (this.blocks.length) {\n        const lastBlock = this.blocks[this.blocks.length - 1]\n        if (lastBlock instanceof ElidedBlock) {\n          lastBlock.push(block)\n          return\n        }\n      }\n    }\n\n    this.blocks.push(block)\n  }\n\n  getBlocks() {\n    return this.blocks\n  }\n\n  getRegions() {\n    return this.blocks.map(block => block.toRegion())\n  }\n\n  map<T, U = this>(func: Func<T>, thisarg?: U) {\n    return this.blocks.map(func, thisarg)\n  }\n\n  forEach<T, U = this>(func: Func<T>, thisarg?: U) {\n    return this.blocks.forEach(func, thisarg)\n  }\n\n  get length() {\n    return this.blocks.length\n  }\n\n  get totalWidthPx() {\n    return this.blocks.length\n      ? this.blocks.map(blocks => blocks.widthPx).reduce((a, b) => a + b)\n      : 0\n  }\n\n  get offsetPx() {\n    return this.blocks.length ? this.blocks[0].offsetPx : 0\n  }\n\n  get contentBlocks() {\n    return this.blocks.filter(block => block instanceof ContentBlock)\n  }\n\n  get totalBp() {\n    return this.contentBlocks\n      .map(block => block.end - block.start)\n      .reduce((a, b) => a + b, 0)\n  }\n}\n\nexport class BaseBlock {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any\n\n  public refName: string\n\n  public start: number\n\n  public end: number\n\n  public assemblyName: string\n\n  public key: string\n\n  /**\n   * a block that should be shown as filled with data\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(data: any) {\n    Object.assign(this, data)\n    this.assemblyName = data.assemblyName\n    this.refName = data.refName\n    this.start = data.start\n    this.end = data.end\n    this.key = data.key\n  }\n\n  /**\n   * rename the reference sequence of this block and return a new one\n   *\n   * @param refName -\n   * @returns either a new block with a renamed reference sequence,\n   * or the same block, if the ref name is not actually different\n   */\n  renameReference(refName: string) {\n    if (this.refName && refName !== this.refName) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return new (this.constructor as any)({ ...this, refName })\n    }\n    return this\n  }\n\n  toRegion() {\n    return {\n      refName: this.refName,\n      start: this.start,\n      end: this.end,\n      assemblyName: this.assemblyName,\n      reversed: this.reversed,\n    }\n  }\n}\n\nexport class ContentBlock extends BaseBlock {}\n\n/**\n * marker block representing one or more blocks that are\n * too small to be shown at the current zoom level\n */\nexport class ElidedBlock extends BaseBlock {\n  public widthPx: number\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(data: Record<string, any>) {\n    super(data)\n    this.widthPx = data.widthPx\n  }\n\n  push(otherBlock: BaseBlock) {\n    this.elidedBlockCount += 1\n\n    if (otherBlock) {\n      this.refName = ''\n      this.start = 0\n      this.end = 0\n      this.widthPx += otherBlock.widthPx\n    }\n  }\n}\n\n/**\n * marker block that sits between two different displayed regions\n * and provides a thick border between them\n */\nexport class InterRegionPaddingBlock extends BaseBlock {}\n","import { intersection2 } from './range'\nimport { assembleLocString } from '.'\nimport {\n  BlockSet,\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from './blockTypes'\nimport { Base1DViewModel } from './calculateStaticBlocks'\n\n/**\n * returns a BlockSet of which the `blocks` attribute is an array of 'dynamic\n * blocks', which are blocks representing only the regions that are visible in\n * the view right now. these are mostly used by tracks for which static blocks\n * are not feasible.\n *\n * each block is a plain JS object like:\n *   `{ refName, start, end, offsetPx, reversed? }`\n *\n * start and end are in bp, and start is always less than end, but if reversed\n * is true, startBp will be on the right side of the visible region.\n *\n * offsetPx is the number of pixels from the left edge of the view to the left\n * edge of the region\n *\n * NOTE: start, end, and offsetPx may all be fractional!\n *\n * @returns BlockSet of `{ refName, startBp, end, offset, reversed? }`\n */\nexport default function calculateDynamicBlocks(\n  model: Base1DViewModel,\n  padding = true,\n  elision = true,\n) {\n  const {\n    offsetPx,\n    displayedRegions,\n    bpPerPx,\n    width,\n    minimumBlockWidth,\n    interRegionPaddingWidth,\n  } = model\n\n  if (!width) {\n    throw new Error('view has no width, cannot calculate displayed blocks')\n  }\n  const blocks = new BlockSet()\n  let displayedRegionLeftPx = 0\n  const windowLeftPx = offsetPx\n  const windowRightPx = windowLeftPx + width\n  displayedRegions.forEach((region, regionNumber) => {\n    const {\n      assemblyName,\n      refName,\n      start: regionStart,\n      end: regionEnd,\n      reversed,\n    } = region\n    const displayedRegionRightPx =\n      displayedRegionLeftPx + (regionEnd - regionStart) / bpPerPx\n\n    const regionWidthPx = (regionEnd - regionStart) / bpPerPx\n\n    if (\n      displayedRegionLeftPx < windowRightPx &&\n      displayedRegionRightPx > windowLeftPx\n    ) {\n      // this displayed region overlaps the view, so make a record for it\n      const [leftPx, rightPx] = intersection2(\n        windowLeftPx,\n        windowRightPx,\n        displayedRegionLeftPx,\n        displayedRegionRightPx,\n      )\n      let start: number\n      let end: number\n      let isLeftEndOfDisplayedRegion: boolean\n      let isRightEndOfDisplayedRegion: boolean\n      let blockOffsetPx: number\n      if (reversed) {\n        start = Math.max(\n          regionStart,\n          regionEnd - (rightPx - displayedRegionLeftPx) * bpPerPx,\n        )\n        end = regionEnd - (leftPx - displayedRegionLeftPx) * bpPerPx\n        isLeftEndOfDisplayedRegion = end === regionEnd\n        isRightEndOfDisplayedRegion = start === regionStart\n        blockOffsetPx = displayedRegionLeftPx + (regionEnd - end) / bpPerPx\n      } else {\n        start = (leftPx - displayedRegionLeftPx) * bpPerPx + regionStart\n        end = Math.min(\n          regionEnd,\n          (rightPx - displayedRegionLeftPx) * bpPerPx + regionStart,\n        )\n        isLeftEndOfDisplayedRegion = start === regionStart\n        isRightEndOfDisplayedRegion = end === regionEnd\n        blockOffsetPx = displayedRegionLeftPx + (start - regionStart) / bpPerPx\n      }\n      const widthPx = (end - start) / bpPerPx\n      const blockData = {\n        assemblyName,\n        refName,\n        start,\n        end,\n        reversed,\n        offsetPx: blockOffsetPx,\n        parentRegion: region,\n        regionNumber,\n        widthPx,\n        isLeftEndOfDisplayedRegion,\n        isRightEndOfDisplayedRegion,\n        key: '',\n      }\n      blockData.key = `${assembleLocString(blockData)}-${regionNumber}${\n        reversed ? '-reversed' : ''\n      }`\n\n      if (padding && blocks.length === 0 && isLeftEndOfDisplayedRegion) {\n        blocks.push(\n          new InterRegionPaddingBlock({\n            key: `${blockData.key}-beforeFirstRegion`,\n            widthPx: -offsetPx,\n            offsetPx: blockData.offsetPx + offsetPx,\n            variant: 'boundary',\n          }),\n        )\n      }\n\n      if (elision && regionWidthPx < minimumBlockWidth) {\n        blocks.push(new ElidedBlock(blockData))\n      } else {\n        blocks.push(new ContentBlock(blockData))\n      }\n\n      if (padding) {\n        // insert a inter-region padding block if we are crossing a displayed region\n        if (\n          regionWidthPx >= minimumBlockWidth &&\n          blockData.isRightEndOfDisplayedRegion &&\n          regionNumber < displayedRegions.length - 1\n        ) {\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-rightpad`,\n              widthPx: interRegionPaddingWidth,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n            }),\n          )\n        }\n        if (\n          regionNumber === displayedRegions.length - 1 &&\n          blockData.isRightEndOfDisplayedRegion\n        ) {\n          blockOffsetPx = blockData.offsetPx + blockData.widthPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-afterLastRegion`,\n              widthPx: width - blockOffsetPx + offsetPx,\n              offsetPx: blockOffsetPx,\n              variant: 'boundary',\n            }),\n          )\n        }\n      }\n    }\n    displayedRegionLeftPx += interRegionPaddingWidth\n    displayedRegionLeftPx += (regionEnd - regionStart) / bpPerPx\n  })\n  return blocks\n}\n","import { assembleLocString } from '.'\nimport {\n  BlockSet,\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from './blockTypes'\nimport { Region } from './types'\n\nexport interface Base1DViewModel {\n  offsetPx: number\n  width: number\n  displayedRegions: Region[]\n  bpPerPx: number\n  minimumBlockWidth: number\n  interRegionPaddingWidth: number\n}\n\nexport default function calculateStaticBlocks(\n  model: Base1DViewModel,\n  padding = true,\n  elision = true,\n  extra = 0,\n\n  // on the main thread, window.innerWidth is used because this reduces\n  // recalculating the blocks, otherwise, model.width for cases such as\n  // off-main-thread\n  width = window.innerWidth || model.width,\n) {\n  const {\n    offsetPx,\n    displayedRegions,\n    bpPerPx,\n    minimumBlockWidth,\n    interRegionPaddingWidth,\n  } = model\n\n  const windowLeftBp = offsetPx * bpPerPx\n  const windowRightBp = (offsetPx + width) * bpPerPx\n  const blockSizePx = width\n  const blockSizeBp = Math.ceil(blockSizePx * bpPerPx)\n  // for each displayed region\n  let regionBpOffset = 0\n  const blocks = new BlockSet()\n  displayedRegions.forEach((region, regionNumber) => {\n    // find the block numbers of the left and right window sides,\n    // clamp those to the region range, and then make blocks for that range\n    const {\n      assemblyName,\n      refName,\n      start: regionStart,\n      end: regionEnd,\n      reversed,\n    } = region\n    const regionBlockCount = Math.ceil((regionEnd - regionStart) / blockSizeBp)\n\n    let windowRightBlockNum =\n      Math.floor((windowRightBp - regionBpOffset) / blockSizeBp) + extra\n    if (windowRightBlockNum >= regionBlockCount)\n      windowRightBlockNum = regionBlockCount - 1\n\n    let windowLeftBlockNum =\n      Math.floor((windowLeftBp - regionBpOffset) / blockSizeBp) - extra\n    if (windowLeftBlockNum < 0) windowLeftBlockNum = 0\n\n    const regionWidthPx = (regionEnd - regionStart) / bpPerPx\n\n    for (\n      let blockNum = windowLeftBlockNum;\n      blockNum <= windowRightBlockNum;\n      blockNum += 1\n    ) {\n      let start: number\n      let end: number\n      let isLeftEndOfDisplayedRegion: boolean\n      let isRightEndOfDisplayedRegion: boolean\n      if (reversed) {\n        start = Math.max(regionStart, regionEnd - (blockNum + 1) * blockSizeBp)\n        end = regionEnd - blockNum * blockSizeBp\n        isLeftEndOfDisplayedRegion = end === regionEnd\n        isRightEndOfDisplayedRegion = start === regionStart\n      } else {\n        start = regionStart + blockNum * blockSizeBp\n        end = Math.min(regionEnd, regionStart + (blockNum + 1) * blockSizeBp)\n        isLeftEndOfDisplayedRegion = start === regionStart\n        isRightEndOfDisplayedRegion = end === regionEnd\n      }\n      const widthPx = (end - start) / bpPerPx\n      const blockData = {\n        assemblyName,\n        refName,\n        start,\n        end,\n        reversed,\n        offsetPx: (regionBpOffset + blockNum * blockSizeBp) / bpPerPx,\n        parentRegion: region,\n        regionNumber,\n        widthPx,\n        isLeftEndOfDisplayedRegion,\n        isRightEndOfDisplayedRegion,\n        key: '',\n      }\n      blockData.key = `${assembleLocString(blockData)}-${regionNumber}${\n        reversed ? '-reversed' : ''\n      }`\n\n      if (padding && regionNumber === 0 && blockNum === 0) {\n        blocks.push(\n          new InterRegionPaddingBlock({\n            key: `${blockData.key}-beforeFirstRegion`,\n            widthPx: width,\n            offsetPx: blockData.offsetPx - width,\n            variant: 'boundary',\n          }),\n        )\n      }\n\n      if (elision && regionWidthPx < minimumBlockWidth) {\n        blocks.push(new ElidedBlock(blockData))\n      } else {\n        blocks.push(new ContentBlock(blockData))\n      }\n\n      if (padding) {\n        // insert a inter-region padding block if we are crossing a displayed region\n        if (\n          regionWidthPx >= minimumBlockWidth &&\n          blockData.isRightEndOfDisplayedRegion &&\n          regionNumber < displayedRegions.length - 1\n        ) {\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-rightpad`,\n              widthPx: interRegionPaddingWidth,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n            }),\n          )\n        }\n        if (\n          regionNumber === displayedRegions.length - 1 &&\n          blockData.isRightEndOfDisplayedRegion\n        ) {\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-afterLastRegion`,\n              widthPx: width,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n              variant: 'boundary',\n            }),\n          )\n        }\n      }\n    }\n    regionBpOffset += interRegionPaddingWidth * bpPerPx\n    regionBpOffset += regionEnd - regionStart\n  })\n  return blocks\n}\n","import { types, cast, getSnapshot, Instance } from 'mobx-state-tree'\nimport { clamp } from './index'\nimport { Feature } from './simpleFeature'\nimport { Region } from './types/mst'\nimport { Region as IRegion } from './types'\nimport calculateDynamicBlocks from './calculateDynamicBlocks'\nimport calculateStaticBlocks from './calculateStaticBlocks'\n\nexport interface BpOffset {\n  refName?: string\n  index: number\n  offset: number\n  start?: number\n  end?: number\n}\n\nconst Base1DView = types\n  .model('Base1DView', {\n    displayedRegions: types.array(Region),\n    bpPerPx: 0,\n    offsetPx: 0,\n  })\n  .volatile(() => ({\n    features: undefined as undefined | Feature[],\n    volatileWidth: 0,\n  }))\n  .actions(self => ({\n    setDisplayedRegions(regions: IRegion[]) {\n      self.displayedRegions = cast(regions)\n    },\n    setBpPerPx(val: number) {\n      self.bpPerPx = val\n    },\n    setVolatileWidth(width: number) {\n      self.volatileWidth = width\n    },\n  }))\n  .views(self => ({\n    get width() {\n      return self.volatileWidth\n    },\n\n    get displayedRegionsTotalPx() {\n      return this.totalBp / self.bpPerPx\n    },\n\n    get maxOffset() {\n      // objectively determined to keep the linear genome on the main screen\n      const leftPadding = 10\n      return this.displayedRegionsTotalPx - leftPadding\n    },\n\n    get minOffset() {\n      // objectively determined to keep the linear genome on the main screen\n      const rightPadding = 30\n      return -this.width + rightPadding\n    },\n    get totalBp() {\n      return self.displayedRegions\n        .map(a => a.end - a.start)\n        .reduce((a, b) => a + b, 0)\n    },\n    get interRegionPaddingWidth() {\n      return 2\n    },\n    get minimumBlockWidth() {\n      return 20\n    },\n    /**\n     * calculates the Px at which coord is found.\n     *\n     * @param refName - string, refName of region\n     * @param coord - number, bp to be translated to Px\n     * @param regionNumber - number, index of displayedRegion in displayedRegions array\n     */\n    bpToPx({\n      refName,\n      coord,\n      regionNumber,\n    }: {\n      refName: string\n      coord: number\n      regionNumber?: number\n    }) {\n      let offsetBp = 0\n\n      const index = self.displayedRegions.findIndex((r, idx) => {\n        if (refName === r.refName && coord >= r.start && coord <= r.end) {\n          // using optional parameter ,regionNumber, as additional requirement to find\n          // a specific displayedRegion when many exist with the same refName\n          if (regionNumber ? regionNumber === idx : true) {\n            offsetBp += r.reversed ? r.end - coord : coord - r.start\n            return true\n          }\n        }\n        offsetBp += r.end - r.start\n        return false\n      })\n      const foundRegion = self.displayedRegions[index]\n      if (foundRegion) {\n        return Math.round(offsetBp / self.bpPerPx)\n      }\n\n      return undefined\n    },\n\n    pxToBp(px: number) {\n      let bpSoFar = 0\n      const bp = (self.offsetPx + px) * self.bpPerPx\n      const n = self.displayedRegions.length\n      if (bp < 0) {\n        const region = self.displayedRegions[0]\n        const offset = bp\n        return {\n          ...getSnapshot(region),\n          oob: true,\n          coord: region.reversed\n            ? Math.floor(region.end - offset) + 1\n            : Math.floor(region.start + offset) + 1,\n          offset,\n          index: 0,\n        }\n      }\n      if (bp >= this.totalBp) {\n        const region = self.displayedRegions[n - 1]\n        const len = region.end - region.start\n        const offset = bp - this.totalBp + len\n        return {\n          ...getSnapshot(region),\n          oob: true,\n          offset,\n          coord: region.reversed\n            ? Math.floor(region.end - offset) + 1\n            : Math.floor(region.start + offset) + 1,\n          index: n - 1,\n        }\n      }\n      for (let index = 0; index < self.displayedRegions.length; index += 1) {\n        const region = self.displayedRegions[index]\n        const len = region.end - region.start\n        if (len + bpSoFar > bp && bpSoFar <= bp) {\n          const offset = bp - bpSoFar\n          return {\n            ...getSnapshot(region),\n            oob: false,\n            offset,\n            coord: region.reversed\n              ? Math.floor(region.end - offset) + 1\n              : Math.floor(region.start + offset) + 1,\n            index,\n          }\n        }\n        bpSoFar += len\n      }\n      throw new Error('pxToBp failed to map to a region')\n    },\n  }))\n  .views(self => ({\n    get dynamicBlocks() {\n      return calculateDynamicBlocks(self)\n    },\n    get staticBlocks() {\n      return calculateStaticBlocks(self)\n    },\n    get currBp() {\n      return this.dynamicBlocks\n        .map(a => a.end - a.start)\n        .reduce((a, b) => a + b, 0)\n    },\n  }))\n  .actions(self => ({\n    setFeatures(features: Feature[]) {\n      self.features = features\n    },\n\n    // this makes a zoomed out view that shows all displayedRegions\n    // that makes the overview bar square with the scale bar\n    showAllRegions() {\n      self.bpPerPx = self.totalBp / self.width\n      self.offsetPx = 0\n    },\n    /**\n     * offset is the base-pair-offset in the displayed region, index is the index of the\n     * displayed region in the linear genome view\n     *\n     * @param start - object as `{start, end, offset, index}`\n     * @param end - object as `{start, end, offset, index}`\n     */\n    moveTo(start: BpOffset, end: BpOffset) {\n      // find locations in the modellist\n      let bpSoFar = 0\n\n      if (start.index === end.index) {\n        bpSoFar += end.offset - start.offset\n      } else {\n        const s = self.displayedRegions[start.index]\n        bpSoFar += s.end - s.start - start.offset\n        if (end.index - start.index >= 2) {\n          for (let i = start.index + 1; i < end.index; i += 1) {\n            bpSoFar +=\n              self.displayedRegions[i].end - self.displayedRegions[i].start\n          }\n        }\n        bpSoFar += end.offset\n      }\n      this.zoomTo(\n        bpSoFar /\n          (self.width -\n            self.interRegionPaddingWidth * (end.index - start.index)),\n      )\n\n      let bpToStart = 0\n      for (let i = 0; i < self.displayedRegions.length; i += 1) {\n        const region = self.displayedRegions[i]\n        if (start.index === i) {\n          bpToStart += start.offset\n          break\n        } else {\n          bpToStart += region.end - region.start\n        }\n      }\n      self.offsetPx =\n        Math.round(bpToStart / self.bpPerPx) +\n        self.interRegionPaddingWidth * start.index\n    },\n\n    zoomOut() {\n      this.zoomTo(self.bpPerPx * 2)\n    },\n\n    zoomIn() {\n      this.zoomTo(self.bpPerPx / 2)\n    },\n\n    zoomTo(newBpPerPx: number, offset = self.width / 2) {\n      const bpPerPx = newBpPerPx\n      if (bpPerPx === self.bpPerPx) return\n      const oldBpPerPx = self.bpPerPx\n      self.bpPerPx = bpPerPx\n\n      // tweak the offset so that the center of the view remains at the same coordinate\n      self.offsetPx = clamp(\n        Math.round(((self.offsetPx + offset) * oldBpPerPx) / bpPerPx - offset),\n        self.minOffset,\n        self.maxOffset,\n      )\n    },\n\n    scroll(distance: number) {\n      const oldOffsetPx = self.offsetPx\n      // the scroll is clamped to keep the linear genome on the main screen\n      const newOffsetPx = clamp(\n        self.offsetPx + distance,\n        self.minOffset,\n        self.maxOffset,\n      )\n      self.offsetPx = newOffsetPx\n      return newOffsetPx - oldOffsetPx\n    },\n  }))\n\nexport type Base1DViewStateModel = typeof Base1DView\nexport type Base1DViewModel = Instance<Base1DViewStateModel>\n\nexport default Base1DView\n","import { ConfigurationSchema } from '../../configuration'\n\nexport default ConfigurationSchema(\n  'JBrowse1Connection',\n  {\n    name: {\n      type: 'string',\n      defaultValue: 'nameOfConnection',\n      description: 'a unique name for this connection',\n    },\n    assemblyName: {\n      description: 'name of the assembly the connection belongs to',\n      type: 'string',\n      defaultValue: 'assemblyName',\n    },\n  },\n  { explicitlyTyped: true, explicitIdentifier: 'connectionId' },\n)\n","import { types } from 'mobx-state-tree'\n\nexport default pluginManager => {\n  return types\n    .model('Connection', {\n      name: types.identifier,\n      tracks: types.array(pluginManager.pluggableConfigSchemaType('track')),\n    })\n    .actions(self => ({\n      afterAttach() {\n        self.connect(self.configuration)\n      },\n      addTrackConf(trackConf) {\n        const length = self.tracks.push(trackConf)\n        return self.tracks[length - 1]\n      },\n      setTrackConfs(trackConfs) {\n        self.tracks = trackConfs\n        return self.track\n      },\n      clear() {},\n    }))\n}\n","import { types, Instance } from 'mobx-state-tree'\nimport { ElementId } from '../../util/types/mst'\nimport { MenuItem } from '../../ui'\n\nconst BaseViewModel = types\n  .model('BaseView', {\n    id: ElementId,\n    displayName: types.maybe(types.string),\n  })\n  .volatile((/* self */) => ({\n    width: 800,\n  }))\n  .views((/* self */) => ({\n    get menuItems(): MenuItem[] {\n      return []\n    },\n  }))\n  .actions(self => ({\n    setDisplayName(name: string) {\n      self.displayName = name\n    },\n    setWidth(newWidth: number) {\n      self.width = newWidth\n    },\n  }))\n\nexport default BaseViewModel\n// eslint-disable-next-line @typescript-eslint/no-empty-interface,@typescript-eslint/interface-name-prefix\nexport interface IBaseViewModel extends Instance<typeof BaseViewModel> {}\n","import { getParent, isRoot, IAnyStateTreeNode } from 'mobx-state-tree'\nimport objectHash from 'object-hash'\nimport { AnyConfigurationModel } from '../configuration/configurationSchema'\nimport { UriLocation, LocalPathLocation } from './types'\nimport { readConfObject } from '../configuration'\n\n/* utility functions for use by track models and so forth */\n\nexport function getTrackAssemblyNames(\n  track: IAnyStateTreeNode & { configuration: AnyConfigurationModel },\n) {\n  const trackConf = track.configuration\n  const trackAssemblyNames = readConfObject(trackConf, 'assemblyNames')\n  if (!trackAssemblyNames) {\n    // Check if it's an assembly sequence track\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const parent = getParent<any>(track.configuration)\n    if ('sequence' in parent) {\n      return [readConfObject(parent, 'name')]\n    }\n  }\n  return trackAssemblyNames\n}\n\n/** return the rpcSessionId of the highest parent node in the tree that has an rpcSessionId */\n\nexport function getRpcSessionId(thisNode: IAnyStateTreeNode) {\n  interface NodeWithRpcSessionId extends IAnyStateTreeNode {\n    rpcSessionId: string\n  }\n  let highestRpcSessionId\n  for (let node = thisNode; !isRoot(node); node = getParent(node)) {\n    if ('rpcSessionId' in node) {\n      highestRpcSessionId = (node as NodeWithRpcSessionId).rpcSessionId\n    }\n  }\n  if (!highestRpcSessionId) {\n    throw new Error(\n      'getRpcSessionId failed, no parent node in the state tree has an `rpcSessionId` attribute',\n    )\n  }\n  return highestRpcSessionId\n}\n\n/**\n * given an MST node, get the renderprops of the first parent container that has\n * renderProps\n * @param node -\n * @returns renderprops, or empty object if none found\n */\nexport function getParentRenderProps(node: IAnyStateTreeNode) {\n  for (\n    let currentNode = getParent(node);\n    !isRoot(currentNode);\n    currentNode = getParent(currentNode)\n  ) {\n    if ('renderProps' in currentNode) {\n      return currentNode.renderProps\n    }\n  }\n\n  return {}\n}\n\nexport const UNKNOWN = 'UNKNOWN'\nexport const UNSUPPORTED = 'UNSUPPORTED'\n\nexport function guessAdapter(\n  fileName: string,\n  protocol: 'uri' | 'localPath',\n  index?: string,\n) {\n  function makeLocation(location: string): UriLocation | LocalPathLocation {\n    if (protocol === 'uri') {\n      return { uri: location }\n    }\n    if (protocol === 'localPath') {\n      return { localPath: location }\n    }\n    throw new Error(`invalid protocol ${protocol}`)\n  }\n  if (/\\.bam$/i.test(fileName)) {\n    return {\n      type: 'BamAdapter',\n      bamLocation: makeLocation(fileName),\n      index: {\n        location: makeLocation(index || `${fileName}.bai`),\n        indexType: index && index.toUpperCase().endsWith('CSI') ? 'CSI' : 'BAI',\n      },\n    }\n  }\n\n  if (/\\.cram$/i.test(fileName)) {\n    return {\n      type: 'CramAdapter',\n      cramLocation: makeLocation(fileName),\n      craiLocation: makeLocation(`${fileName}.crai`),\n    }\n  }\n\n  if (/\\.gff3?$/i.test(fileName)) {\n    return {\n      type: 'UNSUPPORTED',\n    }\n  }\n\n  if (/\\.gff3?\\.b?gz$/i.test(fileName)) {\n    return {\n      type: 'Gff3TabixAdapter',\n      gffGzLocation: makeLocation(fileName),\n      index: {\n        location: makeLocation(index || `${fileName}.tbi`),\n        indexType: index && index.toUpperCase().endsWith('CSI') ? 'CSI' : 'TBI',\n      },\n    }\n  }\n\n  if (/\\.gtf?$/i.test(fileName)) {\n    return {\n      type: 'UNSUPPORTED',\n    }\n  }\n\n  if (/\\.vcf$/i.test(fileName)) {\n    return {\n      type: 'UNSUPPORTED',\n    }\n  }\n\n  if (/\\.vcf\\.b?gz$/i.test(fileName)) {\n    return {\n      type: 'VcfTabixAdapter',\n      vcfGzLocation: makeLocation(fileName),\n      index: {\n        location: makeLocation(`${fileName}.tbi`),\n        indexType: index && index.toUpperCase().endsWith('CSI') ? 'CSI' : 'TBI',\n      },\n    }\n  }\n\n  if (/\\.vcf\\.idx$/i.test(fileName)) {\n    return {\n      type: 'UNSUPPORTED',\n    }\n  }\n\n  if (/\\.bed$/i.test(fileName)) {\n    return {\n      type: 'UNSUPPORTED',\n    }\n  }\n\n  if (/\\.bed\\.b?gz$/i.test(fileName)) {\n    return {\n      type: 'BedTabixAdapter',\n      bedGzLocation: makeLocation(fileName),\n      index: {\n        location: makeLocation(`${fileName}.tbi`),\n        indexType: index && index.toUpperCase().endsWith('CSI') ? 'CSI' : 'TBI',\n      },\n    }\n  }\n\n  if (/\\.(bb|bigbed)$/i.test(fileName)) {\n    return {\n      type: 'BigBedAdapter',\n      bigBedLocation: makeLocation(fileName),\n    }\n  }\n\n  if (/\\.(bw|bigwig)$/i.test(fileName)) {\n    return {\n      type: 'BigWigAdapter',\n      bigWigLocation: makeLocation(fileName),\n    }\n  }\n\n  if (/\\.(fa|fasta|fna|mfa)$/i.test(fileName)) {\n    return {\n      type: 'IndexedFastaAdapter',\n      fastaLocation: makeLocation(fileName),\n      faiLocation: makeLocation(index || `${fileName}.fai`),\n    }\n  }\n\n  if (/\\.(fa|fasta|fna|mfa)\\.b?gz$/i.test(fileName)) {\n    return {\n      type: 'BgzipFastaAdapter',\n      fastaLocation: makeLocation(fileName),\n      faiLocation: makeLocation(`${fileName}.fai`),\n      gziLocation: makeLocation(`${fileName}.gzi`),\n    }\n  }\n\n  if (/\\.2bit$/i.test(fileName)) {\n    return {\n      type: 'TwoBitAdapter',\n      twoBitLocation: makeLocation(fileName),\n    }\n  }\n\n  if (/\\.sizes$/i.test(fileName)) {\n    return {\n      type: 'UNSUPPORTED',\n    }\n  }\n\n  if (/\\/trackData.jsonz?$/i.test(fileName)) {\n    return {\n      type: 'NCListAdapter',\n      rootUrlTemplate: makeLocation(fileName),\n    }\n  }\n\n  if (/\\/sparql$/i.test(fileName)) {\n    return {\n      type: 'SPARQLAdapter',\n      endpoint: fileName,\n    }\n  }\n\n  if (/\\.hic/i.test(fileName)) {\n    return {\n      type: 'HicAdapter',\n      hicLocation: makeLocation(fileName),\n    }\n  }\n\n  if (/\\.paf/i.test(fileName)) {\n    return {\n      type: 'PAFAdapter',\n      pafLocation: makeLocation(fileName),\n    }\n  }\n\n  return {\n    type: UNKNOWN,\n  }\n}\n\nexport function guessTrackType(adapterType: string): string {\n  const known: { [key: string]: string | undefined } = {\n    BamAdapter: 'AlignmentsTrack',\n    CramAdapter: 'AlignmentsTrack',\n    BgzipFastaAdapter: 'ReferenceSequenceTrack',\n    BigWigAdapter: 'QuantitativeTrack',\n    IndexedFastaAdapter: 'ReferenceSequenceTrack',\n    TwoBitAdapter: 'ReferenceSequenceTrack',\n    VcfTabixAdapter: 'VariantTrack',\n    HicAdapter: 'HicTrack',\n    PAFAdapter: 'SyntenyTrack',\n  }\n  return known[adapterType] || 'FeatureTrack'\n}\n\nexport function generateUnsupportedTrackConf(\n  trackName: string,\n  trackUrl: string,\n  categories: string[] | undefined,\n) {\n  const conf = {\n    type: 'FeatureTrack',\n    name: `${trackName} (Unsupported)`,\n    description: `Support not yet implemented for \"${trackUrl}\"`,\n    category: categories,\n    trackId: '',\n  }\n  conf.trackId = objectHash(conf)\n  return conf\n}\n\nexport function generateUnknownTrackConf(\n  trackName: string,\n  trackUrl: string,\n  categories: string[] | undefined,\n) {\n  const conf = {\n    type: 'FeatureTrack',\n    name: `${trackName} (Unknown)`,\n    description: `Could not determine track type for \"${trackUrl}\"`,\n    category: categories,\n    trackId: '',\n  }\n  conf.trackId = objectHash(conf)\n  return conf\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { getParent, Instance, types, isRoot } from 'mobx-state-tree'\nimport React from 'react'\nimport { getConf } from '../../configuration'\nimport { MenuItem } from '../../ui'\nimport { getSession } from '../../util'\nimport { getParentRenderProps } from '../../util/tracks'\nimport { ElementId } from '../../util/types/mst'\n\nexport const BaseDisplay = types\n  .model('BaseDisplay', {\n    id: ElementId,\n    type: types.string,\n  })\n  .volatile(() => ({\n    rendererTypeName: '',\n    error: undefined as Error | string | undefined,\n  }))\n  .views(self => ({\n    get RenderingComponent(): React.FC<{\n      model: typeof self\n      onHorizontalScroll?: Function\n      blockState?: Record<string, any>\n    }> {\n      const { pluginManager } = getSession(self)\n      const displayType = pluginManager.getDisplayType(self.type)\n      return displayType.ReactComponent as React.FC<{\n        model: typeof self\n        onHorizontalScroll?: Function\n        blockState?: Record<string, any>\n      }>\n    },\n\n    get DisplayBlurb(): React.FC<{ model: typeof self }> | null {\n      return null\n    },\n\n    get adapterConfig() {\n      return getConf(this.parentTrack, 'adapter')\n    },\n\n    get parentTrack() {\n      let track = getParent(self)\n      while (!(track.configuration && getConf(track, 'trackId'))) {\n        if (isRoot(track)) {\n          throw new Error(`No parent track found for ${self.type} ${self.id}`)\n        }\n        track = getParent(track)\n      }\n      return track\n    },\n\n    /**\n     * the react props that are passed to the Renderer when data\n     * is rendered in this display\n     */\n    get renderProps() {\n      return {\n        ...getParentRenderProps(self),\n        displayModel: self,\n      }\n    },\n\n    /**\n     * the pluggable element type object for this display's\n     * renderer\n     */\n    get rendererType() {\n      const session = getSession(self)\n      const RendererType = session.pluginManager.getRendererType(\n        self.rendererTypeName,\n      )\n      if (!RendererType)\n        throw new Error(`renderer \"${self.rendererTypeName}\" not found`)\n      if (!RendererType.ReactComponent)\n        throw new Error(\n          `renderer ${self.rendererTypeName} has no ReactComponent, it may not be completely implemented yet`,\n        )\n      return RendererType\n    },\n\n    /**\n     * if a display-level message should be displayed instead,\n     * make this return a react component\n     */\n    get DisplayMessageComponent() {\n      return undefined as undefined | React.FC<any>\n    },\n\n    get trackMenuItems(): MenuItem[] {\n      return []\n    },\n\n    get viewMenuActions(): MenuItem[] {\n      return []\n    },\n    /**\n     * @param region -\n     * @returns falsy if the region is fine to try rendering. Otherwise,\n     *  return a react node + string of text.\n     *  string of text describes why it cannot be rendered\n     *  react node allows user to force load at current setting\n     */\n    regionCannotBeRendered(/* region */) {\n      return undefined\n    },\n  }))\n  .actions(self => ({\n    setError(e: string) {\n      self.error = e\n    },\n    // base display reload does nothing, see specialized displays for details\n    reload() {},\n  }))\n\nexport type BaseDisplayStateModel = typeof BaseDisplay\nexport type BaseDisplayModel = Instance<BaseDisplayStateModel>\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport InfoIcon from '@material-ui/icons/Info'\nimport { transaction } from 'mobx'\nimport { getRoot, Instance, resolveIdentifier, types } from 'mobx-state-tree'\nimport { getConf } from '../../configuration'\nimport {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '../../configuration/configurationSchema'\nimport PluginManager from '../../PluginManager'\nimport { MenuItem } from '../../ui'\nimport { getContainingView, getSession } from '../../util'\nimport { isSessionModelWithConfigEditing } from '../../util/types'\nimport { ElementId } from '../../util/types/mst'\n\n// these MST models only exist for tracks that are *shown*.\n// they should contain only UI state for the track, and have\n// a reference to a track configuration (stored under\n// session.configuration.assemblies.get(assemblyName).tracks).\n\n// note that multiple displayed tracks could use the same configuration.\nexport function createBaseTrackModel(\n  pluginManager: PluginManager,\n  trackType: string,\n  baseTrackConfig: AnyConfigurationSchemaType,\n) {\n  return types\n    .model(trackType, {\n      id: ElementId,\n      type: types.literal(trackType),\n      configuration: ConfigurationReference(baseTrackConfig),\n      displays: types.array(\n        pluginManager.pluggableMstType('display', 'stateModel'),\n      ),\n    })\n    .volatile(() => ({\n      showAbout: false,\n    }))\n    .actions(self => ({\n      setShowAbout(show: boolean) {\n        self.showAbout = show\n      },\n    }))\n    .views(self => ({\n      get rpcSessionId() {\n        return self.id\n      },\n\n      get name() {\n        return getConf(self, 'name')\n      },\n\n      /**\n       * the PluggableElementType for the currently defined adapter\n       */\n      get adapterType() {\n        const adapterConfig = getConf(self, 'adapter')\n        const session = getSession(self)\n        if (!adapterConfig)\n          throw new Error(`no adapter configuration provided for ${self.type}`)\n        const adapterType = session.pluginManager.getAdapterType(\n          adapterConfig.type,\n        )\n        if (!adapterType)\n          throw new Error(`unknown adapter type ${adapterConfig.type}`)\n        return adapterType\n      },\n\n      get viewMenuActions(): MenuItem[] {\n        const menuItems: MenuItem[] = []\n        self.displays.forEach(display => {\n          menuItems.push(...display.viewMenuActions)\n        })\n        return menuItems\n      },\n      get canConfigure() {\n        const session = getSession(self)\n        return (\n          isSessionModelWithConfigEditing(session) &&\n          // @ts-ignore\n          (session.adminMode ||\n            // @ts-ignore\n            session.sessionTracks.find(track => {\n              return track.trackId === self.configuration.trackId\n            }))\n        )\n      },\n      // distinct set of track items that are particular to this track type. for\n      // base, there are none\n      //\n      // note: this attribute is helpful when composing together multiple\n      // subtracks so that you don't repeat the \"about this track\" from each\n      // child track\n      get composedTrackMenuItems(): MenuItem[] {\n        return []\n      },\n    }))\n    .actions(self => ({\n      activateConfigurationUI() {\n        const session = getSession(self)\n        const view = getContainingView(self)\n        if (isSessionModelWithConfigEditing(session)) {\n          // @ts-ignore\n          const trackConf = session.editTrackConfiguration(self.configuration)\n          if (trackConf && trackConf !== self.configuration) {\n            // @ts-ignore\n            view.hideTrack(self.configuration)\n            // @ts-ignore\n            view.showTrack(trackConf)\n          }\n        }\n      },\n      showDisplay(displayId: string, initialSnapshot = {}) {\n        const displayTypeConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'display',\n        )\n        const configuration = resolveIdentifier(\n          displayTypeConfigSchema,\n          getRoot(self),\n          displayId,\n        )\n        const displayType = pluginManager.getDisplayType(configuration.type)\n        if (!displayType) {\n          throw new Error(`unknown display type ${configuration.type}`)\n        }\n        const display = displayType.stateModel.create({\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n        })\n        self.displays.push(display)\n      },\n\n      hideDisplay(displayId: string) {\n        const displayTypeConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'display',\n        )\n        const configuration = resolveIdentifier(\n          displayTypeConfigSchema,\n          getRoot(self),\n          displayId,\n        )\n        // if we have any displays with that configuration, turn them off\n        const shownDisplays = self.displays.filter(\n          d => d.configuration === configuration,\n        )\n        transaction(() => shownDisplays.forEach(d => self.displays.remove(d)))\n        return shownDisplays.length\n      },\n      replaceDisplay(\n        oldDisplayId: string,\n        newDisplayId: string,\n        initialSnapshot = {},\n      ) {\n        const displayIdx = self.displays.findIndex(\n          d => d.configuration.displayId === oldDisplayId,\n        )\n        if (displayIdx === -1) {\n          throw new Error(\n            `could not find display id ${oldDisplayId} to replace`,\n          )\n        }\n        const displayTypeConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'display',\n        )\n        const configuration = resolveIdentifier(\n          displayTypeConfigSchema,\n          getRoot(self),\n          newDisplayId,\n        )\n        const displayType = pluginManager.getDisplayType(configuration.type)\n        if (!displayType) {\n          throw new Error(`unknown display type ${configuration.type}`)\n        }\n        self.displays.splice(displayIdx, 1, {\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n        })\n      },\n    }))\n    .views(self => ({\n      get trackMenuItems(): MenuItem[] {\n        const menuItems: MenuItem[] = []\n        self.displays.forEach(display => {\n          menuItems.push(...display.trackMenuItems)\n        })\n        const displayChoices: MenuItem[] = []\n        const view = getContainingView(self)\n        const viewType = pluginManager.getViewType(view.type)\n        const compatibleDisplayTypes = viewType.displayTypes.map(\n          displayType => displayType.name,\n        )\n        const compatibleDisplays = self.configuration.displays.filter(\n          (displayConf: any) =>\n            compatibleDisplayTypes.includes(displayConf.type),\n        )\n        const shownId = self.displays[0].configuration.displayId\n        if (compatibleDisplays.length > 1) {\n          displayChoices.push(\n            { type: 'divider' },\n            { type: 'subHeader', label: 'Display types' },\n          )\n          compatibleDisplays.forEach((displayConf: any) => {\n            displayChoices.push({\n              type: 'radio',\n              label: `${displayConf.type}`,\n              onClick: () => {\n                self.replaceDisplay(shownId, displayConf.displayId)\n              },\n              checked: displayConf.displayId === shownId,\n            })\n          })\n        }\n        return [\n          {\n            label: 'About this track',\n            icon: InfoIcon,\n            priority: 10,\n            onClick: () => {\n              self.setShowAbout(true)\n            },\n          },\n          ...menuItems,\n          ...displayChoices,\n        ]\n      },\n    }))\n}\n\nexport type BaseTrackStateModel = ReturnType<typeof createBaseTrackModel>\nexport type BaseTrackModel = Instance<BaseTrackStateModel>\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types, Instance } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '../../configuration'\nimport PluginManager from '../../PluginManager'\n\nexport function createBaseTrackConfig(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'BaseTrack',\n    {\n      name: {\n        description: 'descriptive name of the track',\n        type: 'string',\n        defaultValue: 'Track',\n      },\n      assemblyNames: {\n        description: 'name of the assembly (or assemblies) track belongs to',\n        type: 'stringArray',\n        defaultValue: ['assemblyName'],\n      },\n      description: {\n        description: 'a description of the track',\n        type: 'string',\n        defaultValue: '',\n      },\n      category: {\n        description: 'the category and sub-categories of a track',\n        type: 'stringArray',\n        defaultValue: [],\n      },\n      metadata: {\n        type: 'frozen',\n        description: 'anything to add about this track',\n        defaultValue: {},\n      },\n      adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      displays: types.array(pluginManager.pluggableConfigSchemaType('display')),\n      // see corresponding entry in circular-view ChordTrack\n      // no config slot editor exists for this at the time being\n      // configRelationships: {\n      //   type: 'configRelationships',\n      //   model: types.array(\n      //     types.model('Relationship', {\n      //       type: types.string,\n      //       target: types.maybe(types.reference(base)),\n      //     }),\n      //   ),\n      //   defaultValue: [],\n      // },\n    },\n    {\n      preProcessSnapshot: s => {\n        const snap = JSON.parse(JSON.stringify(s))\n        const displayTypes = new Set()\n        const { displays = [] } = snap\n        if (snap.trackId !== 'placeholderId') {\n          // Gets the displays on the track snapshot and the possible displays\n          // from the track type and adds any missing possible displays to the\n          // snapshot\n          displays.forEach((d: any) => d && displayTypes.add(d.type))\n          const trackType = pluginManager.getTrackType(snap.type)\n          trackType.displayTypes.forEach(displayType => {\n            if (!displayTypes.has(displayType.name)) {\n              displays.push({\n                displayId: `${snap.trackId}-${displayType.name}`,\n                type: displayType.name,\n              })\n            }\n          })\n        }\n        return { ...snap, displays }\n      },\n      explicitIdentifier: 'trackId',\n      explicitlyTyped: true,\n      actions: (self: any) => ({\n        addDisplayConf(displayConf: { type: string; displayId: string }) {\n          const { type } = displayConf\n          if (!type) throw new Error(`unknown display type ${type}`)\n          const display = self.displays.find(\n            (d: any) => d && d.displayId === displayConf.displayId,\n          )\n          if (display) {\n            return display\n          }\n          const length = self.displays.push(displayConf)\n          return self.displays[length - 1]\n        },\n      }),\n    },\n  )\n}\n\nexport type BaseTrackConfigModel = ReturnType<typeof createBaseTrackConfig>\nexport type BaseTrackConfig = Instance<BaseTrackConfigModel>\n","/**\n * Abstract feature object\n */\nexport interface Feature {\n  /**\n   * Get a piece of data about the feature.  All features must have\n   * 'start' and 'end', but everything else is optional.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get(name: string): any\n\n  /**\n   * Set an item of data.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  set(name: string, val: any): void\n\n  /**\n   * Get an array listing which data keys are present in this feature.\n   */\n  tags(): string[]\n\n  /**\n   * Get the unique ID of this feature.\n   */\n  id(): string\n\n  /**\n   * Get this feature's parent feature, or undefined if none.\n   */\n  parent(): Feature | undefined\n\n  /**\n   * Get an array of child features, or undefined if none.\n   */\n  children(): Feature[] | undefined\n\n  /*\n   * Convert to JSON\n   */\n  toJSON(): SimpleFeatureSerialized\n}\n\nexport function isFeature(thing: unknown): thing is Feature {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    typeof (thing as Feature).get === 'function' &&\n    typeof (thing as Feature).id === 'function'\n  )\n}\n\nexport interface SimpleFeatureArgs {\n  /** key-value data, must include 'start' and 'end' */\n  data: {}\n  /** optional parent feature */\n  parent?: Feature\n  /** unique identifier. can also be in data.uniqueId */\n  id: string | number // thing that can be stringified easily\n}\n\n// subfeatures do not have to have uniqueId\ninterface SimpleFeatureSerializedNoId {\n  [key: string]: unknown\n  parentId?: string\n  subfeatures?: SimpleFeatureSerializedNoId[]\n}\n\n// base serialized feature has to have a uniqueId\nexport interface SimpleFeatureSerialized extends SimpleFeatureSerializedNoId {\n  subfeatures?: SimpleFeatureSerializedNoId[]\n  uniqueId: string\n}\n\nfunction isSimpleFeatureSerialized(\n  args: SimpleFeatureSerialized | SimpleFeatureArgs,\n): args is SimpleFeatureSerialized {\n  return 'uniqueId' in args && typeof args.data !== 'object'\n}\n\n/**\n * Simple implementation of a feature object.\n */\nexport default class SimpleFeature implements Feature {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private data: Record<string, any>\n\n  private parentHandle?: Feature\n\n  private uniqueId: string\n\n  /**\n   * @param args - SimpleFeature args\n   *\n   * Note: args.data.subfeatures can be an array of these same args,\n   * which will be inflated to more instances of this class.\n   */\n  public constructor(args: SimpleFeatureArgs | SimpleFeatureSerialized) {\n    if (isSimpleFeatureSerialized(args)) {\n      this.data = args\n    } else {\n      this.data = args.data || {}\n      // load handle from args.parent (not args.data.parent)\n      // this reason is because if args is an object, it likely isn't properly loaded with\n      // parent as a Feature reference (probably a raw parent ID or something instead)\n      this.parentHandle = args.parent\n    }\n\n    // the feature id comes from\n    // args.id, args.data.uniqueId, or args.uniqueId due to this initialization\n    const id = isSimpleFeatureSerialized(args) ? args.uniqueId : args.id\n    if (id === undefined || id === null) {\n      throw new Error(\n        'SimpleFeature requires a unique `id` or `data.uniqueId` attribute',\n      )\n    }\n    this.uniqueId = String(id)\n\n    if (!(this.data.aliases || this.data.end - this.data.start >= 0)) {\n      throw new Error(\n        `invalid feature data, end less than start. end: ${this.data.end} start: ${this.data.start}`,\n      )\n    }\n\n    // inflate any subfeatures that are not already feature objects\n    const { subfeatures } = this.data\n    if (subfeatures) {\n      for (let i = 0; i < subfeatures.length; i += 1) {\n        if (typeof subfeatures[i].get !== 'function') {\n          subfeatures[i].strand = subfeatures[i].strand || this.data.strand\n          subfeatures[i] = new SimpleFeature({\n            id: subfeatures[i].uniqueId || `${id}-${i}`,\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            data: subfeatures[i] as Record<string, any>,\n            parent: this,\n          })\n        }\n      }\n    }\n  }\n\n  /**\n   * Get a piece of data about the feature.  All features must have\n   * 'start' and 'end', but everything else is optional.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public get(name: string): any {\n    return this.data[name]\n  }\n\n  /**\n   * Set an item of data.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public set(name: string, val: any): void {\n    this.data[name] = val\n  }\n\n  /**\n   * Get an array listing which data keys are present in this feature.\n   */\n  public tags(): string[] {\n    return Object.keys(this.data)\n  }\n\n  /**\n   * Get the unique ID of this feature.\n   */\n  public id(): string {\n    return this.uniqueId\n  }\n\n  /**\n   * Get this feature's parent feature, or undefined if none.\n   */\n  public parent(): Feature | undefined {\n    return this.parentHandle\n  }\n\n  /**\n   * Get an array of child features, or undefined if none.\n   */\n  public children(): Feature[] | undefined {\n    return this.get('subfeatures')\n  }\n\n  public toJSON(): SimpleFeatureSerialized {\n    const d = { ...this.data, uniqueId: this.id() } as SimpleFeatureSerialized\n    const p = this.parent()\n    if (p) d.parentId = p.id()\n    const c = this.children()\n    if (c) d.subfeatures = c.map(child => child.toJSON())\n    return d\n  }\n\n  public static fromJSON(json: SimpleFeatureSerialized) {\n    return new SimpleFeature({ ...json })\n  }\n}\n","import { stringToFunction } from '../../../util/functionStrings'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype FilterFunction = (...args: any[]) => boolean\n\ninterface Filter {\n  string: string\n  func: FilterFunction\n}\n\nexport type SerializedFilterChain = string[]\n\nexport default class SerializableFilterChain {\n  filterChain: Filter[]\n\n  constructor({ filters = [] }: { filters: SerializedFilterChain }) {\n    this.filterChain = filters.map(inputFilter => {\n      if (typeof inputFilter === 'string') {\n        const func = stringToFunction(inputFilter) as FilterFunction\n        return { func, string: inputFilter }\n      }\n      throw new Error(`invalid inputFilter string \"${inputFilter}\"`)\n    })\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  passes(...args: any[]) {\n    for (let i = 0; i < this.filterChain.length; i += 1) {\n      if (!this.filterChain[i].func.apply(this, args)) return false\n    }\n    return true\n  }\n\n  toJSON() {\n    return { filters: this.filterChain.map(f => f.string) }\n  }\n\n  static fromJSON(json: { filters: SerializedFilterChain }) {\n    return new SerializableFilterChain(json)\n  }\n}\n","import { blue, green, red, amber } from '@material-ui/core/colors'\nimport { createMuiTheme, ThemeOptions } from '@material-ui/core/styles'\nimport { PaletteOptions } from '@material-ui/core/styles/createPalette'\nimport deepmerge from 'deepmerge'\n\nconst refTheme = createMuiTheme()\n\n// use this if we ever want to add some top-level thing to the theme\n// declare module '@material-ui/core/styles/createMuiTheme' {\n//   interface Theme {\n//     status: {\n//       topLevelThing: string\n//     }\n//   }\n//   interface ThemeOptions {\n//     status?: {\n//       topLevelThing?: string\n//     }\n//   }\n// }\n\ndeclare module '@material-ui/core/styles/createPalette' {\n  interface Palette {\n    tertiary: Palette['primary']\n    quaternary: Palette['primary']\n    bases: {\n      A: Palette['primary']\n      C: Palette['primary']\n      G: Palette['primary']\n      T: Palette['primary']\n    }\n  }\n  interface PaletteOptions {\n    tertiary?: PaletteOptions['primary']\n    quaternary?: PaletteOptions['primary']\n    bases?: {\n      A?: PaletteOptions['primary']\n      C?: PaletteOptions['primary']\n      G?: PaletteOptions['primary']\n      T?: PaletteOptions['primary']\n    }\n  }\n}\n\nconst midnight = '#0D233F'\nconst grape = '#721E63'\nconst forest = '#135560'\nconst mandarin = '#FFB11D'\n\nexport const jbrowseDefaultPalette = {\n  // type: 'dark',\n  primary: { main: midnight },\n  secondary: { main: grape },\n  tertiary: refTheme.palette.augmentColor({ main: forest }),\n  quaternary: refTheme.palette.augmentColor({ main: mandarin }),\n  stopCodon: '#e22',\n  startCodon: '#3e3',\n  bases: {\n    A: refTheme.palette.augmentColor(green),\n    C: refTheme.palette.augmentColor(blue),\n    G: refTheme.palette.augmentColor(amber),\n    T: refTheme.palette.augmentColor(red),\n  },\n}\n\nexport function createJBrowseDefaultProps(/* palette: PaletteOptions = {} */) {\n  return {\n    MuiButton: {\n      size: 'small' as 'small',\n    },\n    MuiFilledInput: {\n      margin: 'dense' as 'dense',\n    },\n    MuiFormControl: {\n      margin: 'dense' as 'dense',\n    },\n    MuiFormHelperText: {\n      margin: 'dense' as 'dense',\n    },\n    MuiIconButton: {\n      size: 'small' as 'small',\n    },\n    MuiInputBase: {\n      margin: 'dense' as 'dense',\n    },\n    MuiList: {\n      dense: true,\n    },\n    MuiListItem: {\n      dense: true,\n    },\n    MuiOutlinedInput: {\n      margin: 'dense' as 'dense',\n    },\n    MuiFab: {\n      size: 'small' as 'small',\n    },\n    MuiTable: {\n      size: 'small' as 'small',\n    },\n    MuiTextField: {\n      margin: 'dense' as 'dense',\n      size: 'small' as 'small',\n    },\n    MuiToolbar: {\n      variant: 'dense' as 'dense',\n    },\n    MuiSvgIcon: {\n      fontSize: 'small' as 'small',\n    },\n    MuiToggleButtonGroup: {\n      size: 'small' as 'small',\n    },\n    MuiCheckbox: {\n      size: 'small' as 'small',\n    },\n    MuiLink: {\n      underline: 'always' as 'always',\n    },\n  }\n}\n\nexport function createJBrowseDefaultOverrides(palette: PaletteOptions = {}) {\n  const generatedPalette = deepmerge(jbrowseDefaultPalette, palette)\n  return {\n    MuiIconButton: {\n      colorSecondary: {\n        color: generatedPalette.tertiary.main,\n      },\n    },\n    MuiButton: {\n      textSecondary: {\n        color: generatedPalette.tertiary.main,\n      },\n    },\n    MuiFab: {\n      secondary: {\n        backgroundColor: generatedPalette.quaternary.main,\n      },\n    },\n    MuiLink: {\n      root: {\n        color: generatedPalette.tertiary.main,\n      },\n    },\n    MuiAccordionSummary: {\n      root: {\n        background: generatedPalette.tertiary.main,\n        '&$expanded': {\n          // overrides the subclass e.g. .MuiAccordionSummary-root-311.MuiAccordionSummary-expanded-312\n          minHeight: 0,\n          margin: 0,\n          color: generatedPalette.tertiary.contrastText,\n        },\n        margin: 0,\n        minHeight: 0,\n        padding: '0px 24px',\n      },\n      content: {\n        '&$expanded': {\n          margin: '8px 0px',\n        },\n        margin: '8px 0px',\n        color: generatedPalette.tertiary.contrastText,\n      },\n      expanded: {\n        // empty block needed to keep small\n      },\n    },\n    // makes menus more compact\n    MuiMenuItem: {\n      root: {\n        paddingTop: 3,\n        paddingBottom: 3,\n      },\n    },\n\n    // the below two are linked to make menus more compact\n    MuiListItemIcon: {\n      root: {\n        minWidth: 32,\n      },\n    },\n    MuiListItemText: {\n      inset: {\n        paddingLeft: 32,\n      },\n    },\n  }\n}\n\nexport const jbrowseBaseTheme: ThemeOptions = {\n  palette: jbrowseDefaultPalette,\n  typography: { fontSize: 12 },\n  spacing: 4,\n  props: createJBrowseDefaultProps(),\n  overrides: createJBrowseDefaultOverrides(),\n}\n\nexport function createJBrowseTheme(theme?: ThemeOptions) {\n  if (!theme) {\n    return createMuiTheme(jbrowseBaseTheme)\n  }\n  if (theme.palette?.tertiary) {\n    theme = {\n      ...theme,\n      palette: {\n        ...theme.palette,\n        tertiary: refTheme.palette.augmentColor(theme.palette.tertiary),\n      },\n    }\n  }\n  if (theme.palette?.quaternary) {\n    theme = {\n      ...theme,\n      palette: {\n        ...theme.palette,\n        quaternary: refTheme.palette.augmentColor(theme.palette.quaternary),\n      },\n    }\n  }\n  theme = {\n    ...theme,\n    props: deepmerge(createJBrowseDefaultProps(), theme.props || {}),\n    overrides: deepmerge(\n      createJBrowseDefaultOverrides(theme.palette),\n      theme.overrides || {},\n    ),\n  }\n  return createMuiTheme(deepmerge(jbrowseBaseTheme, theme))\n}\n","import React from 'react'\n\ntype LogoVariant = 'color' | 'black' | 'white'\n\ninterface LogoProps {\n  variant?: LogoVariant\n}\n\nfunction getColors(variant?: LogoVariant) {\n  if (variant === 'black') {\n    return {\n      midnight: '#808080',\n      forrest: '#666666',\n      grape: '#4d4d4d',\n      mandarin: '#333333',\n      gray: '#1a1a1a',\n    }\n  }\n  if (variant === 'white') {\n    return {\n      midnight: '#ffffff',\n      forrest: '#e6e6e6',\n      grape: '#cccccc',\n      mandarin: '#b3b3b3',\n      gray: '#999999',\n    }\n  }\n  return {\n    midnight: '#0d233f',\n    forrest: '#135560',\n    grape: '#721e63',\n    mandarin: '#ffb11d',\n    gray: '#dadada',\n  }\n}\n\nexport function Logomark({ variant }: LogoProps) {\n  return (\n    <svg viewBox=\"0 0 175 175\">\n      <Icon variant={variant} />\n    </svg>\n  )\n}\n\nexport function LogoFull({ variant }: LogoProps) {\n  return (\n    <svg viewBox=\"0 0 641 175\">\n      <Text variant={variant} />\n      <Icon variant={variant} />\n    </svg>\n  )\n}\n\nfunction Icon({ variant }: LogoProps) {\n  const colors = getColors(variant)\n  return (\n    <>\n      <path\n        style={{ fill: colors.midnight }}\n        d=\"M120.5,57.5c.168,0,.333.012.5.013V40.506c-.167,0-.333-.006-.5-.006a98.325,98.325,0,0,0-77.4,37.565q-2.664,3.378-5.023,6.994l14.206,9.327Q54.043,91.709,56,89.179A81.363,81.363,0,0,1,120.5,57.5Z\"\n      />\n      <path\n        style={{ fill: colors.forrest }}\n        d=\"M148.668,86.223c.308.133.6.283.908.42l6.746-15.618c-.153-.067-.3-.143-.454-.21a81.36,81.36,0,0,0-71.777,3.5q-2.8,1.544-5.469,3.309l9.249,14.054A63.93,63.93,0,0,1,148.668,86.223Z\"\n      />\n      <path\n        style={{ fill: colors.grape }}\n        d=\"M170.894,109.37A63.929,63.929,0,0,0,113.4,88.861l2.336,15.474a48.456,48.456,0,0,1,44.322,15.42c.111.125.214.255.324.381l11.16-10C171.323,109.879,171.118,109.62,170.894,109.37Z\"\n      />\n      <path\n        style={{ fill: colors.mandarin }}\n        d=\"M150.921,150.314c.04.163.07.326.107.489l16.509-4.058c-.039-.163-.067-.326-.107-.489A48.457,48.457,0,0,0,135.575,111.8l-5.515,15.591A32.466,32.466,0,0,1,150.921,150.314Z\"\n      />\n      <path\n        style={{ fill: colors.gray }}\n        d=\"M134.1,138.129l-9.779,13.213a32.486,32.486,0,0,1,7.823,14.463l15.147.852c.012-.166.032-.331.041-.5A32.464,32.464,0,0,0,134.1,138.129Z\"\n      />\n    </>\n  )\n}\n\nfunction Text({ variant }: LogoProps) {\n  const colors = getColors(variant)\n  return (\n    <g\n      aria-label=\"JBrowse\"\n      transform=\"translate(213.084 144.241)\"\n      style={{ fill: colors.midnight }}\n    >\n      <path d=\"m 26.355,-71.505 v 54.075 2.835 q 0,6.825 -0.42,10.185 -0.735,5.67 -2.835,9.135 -3.255,5.355 -8.505,8.4 -4.83,2.73 -11.55,3.57 L 1.47,11.76 Q 7.35,10.185 9.24,4.2 10.605,-0.105 10.605,-9.975 v -5.565 -55.965 q 1.785,0 4.62,0.315 2.835,0.21 3.255,0.21 1.785,0 2.94,-0.105 4.515,-0.42 4.935,-0.42 z\" />\n      <path d=\"m 60.68836,-65.415 v 24.78 h 3.255 q 2.94,0 4.935,-0.525 2.1,-0.525 3.885,-2.1 2.31,-1.995 3.36,-4.83 1.155,-2.835 1.155,-6.09 0,-5.565 -2.94,-8.61 -2.94,-3.045 -8.295,-3.045 -2.52,0 -5.355,0.42 z m 0,30.87 V -6.09 h 5.25 q 4.725,0 8.505,-3.675 3.885,-3.78 3.885,-10.08 0,-8.19 -4.62,-11.655 -4.095,-3.045 -13.02,-3.045 z M 44.93836,0 v -71.505 h 27.09 q 9.135,0 14.385,3.255 6.51,3.99 6.51,12.6 0,7.035 -5.25,11.655 -4.62,4.095 -11.97,5.145 v 0.945 q 7.56,0.735 12.285,3.99 6.615,4.62 6.615,13.335 0,10.185 -7.98,15.75 -6.93,4.83 -17.43,4.83 z\" />\n      <path d=\"M 109.44281,0.525 V -50.4 q 1.785,0.21 3.99,0.42 2.31,0.105 3.255,0.105 2.31,0 4.2,-0.21 1.89,-0.21 3.045,-0.315 v 13.02 q 1.89,-6.51 5.46,-9.87 4.41,-4.095 11.655,-4.095 -0.315,2.73 -0.42,6.825 -0.105,3.99 -0.105,7.455 l -0.945,0.84 q -0.945,-0.735 -2.415,-1.05 -1.47,-0.315 -2.94,-0.315 -3.57,0 -6.195,1.89 -2.52,1.785 -3.465,5.04 -0.42,1.155 -0.525,3.15 -0.105,1.89 -0.105,4.515 v 4.515 19.005 q -1.785,-0.21 -2.625,-0.21 -3.675,-0.315 -4.62,-0.315 -2.31,0 -4.2,0.21 -1.89,0.21 -3.045,0.315 z\" />\n      <path d=\"m 173.77337,1.47 q -11.655,0 -18.585,-6.825 -6.93,-6.825 -6.93,-18.48 0,-12.6 6.72,-20.055 6.825,-7.455 18.9,-7.455 11.97,0 18.9,6.72 6.93,6.72 6.93,18.48 0,12.285 -6.72,19.74 -7.14,7.875 -19.215,7.875 z m 0.735,-48.09 q -5.88,0 -8.505,6.51 -2.205,5.565 -2.205,15.96 0,8.19 1.47,12.915 2.415,7.98 8.505,7.98 5.565,0 8.19,-7.875 2.205,-6.51 2.205,-16.695 0,-8.505 -2.1,-13.23 -2.52,-5.565 -7.56,-5.565 z\" />\n      <path d=\"m 222.03563,-50.4 10.5,36.015 q 3.675,-11.235 5.67,-17.85 2.415,-8.085 5.04,-18.165 1.05,0.105 3.045,0.315 2.1,0.21 2.835,0.21 1.995,0 3.15,-0.105 1.26,-0.21 2.73,-0.42 l 10.71,36.015 q 5.88,-17.43 10.71,-36.015 l 4.2,0.315 4.095,-0.315 q -5.145,13.125 -9.135,24.57 -5.04,14.28 -8.505,26.355 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.205,-0.105 -1.89,0 -3.36,0.21 -1.365,0.21 -2.31,0.315 l -10.605,-34.755 q -4.41,13.65 -6.72,21.105 -2.31,7.35 -4.095,13.65 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.31,-0.105 -1.995,0 -3.465,0.21 -1.365,0.21 -2.31,0.315 -3.78,-12.81 -5.04,-17.01 -2.205,-7.245 -5.46,-17.01 -2.835,-8.4 -5.88,-16.905 1.575,0 4.305,0.315 2.73,0.21 3.36,0.21 1.47,0 4.305,-0.21 2.835,-0.315 3.465,-0.315 z\" />\n      <path d=\"m 292.84172,-12.81 h 2.625 q 1.47,4.095 4.62,6.51 3.15,2.415 7.35,2.415 2.94,0 5.46,-1.785 2.625,-1.89 2.625,-4.62 0,-3.885 -6.195,-6.615 -10.395,-4.62 -11.655,-5.46 -6.405,-4.515 -6.405,-12.285 0,-7.77 5.25,-12.18 5.25,-4.515 12.81,-4.515 3.99,0 8.085,1.365 4.095,1.26 7.14,3.57 l -2.52,9.24 h -2.94 q -0.63,-3.57 -3.57,-6.195 -2.835,-2.625 -6.405,-2.625 -3.15,0 -5.46,1.575 -2.31,1.47 -2.31,4.515 0,3.885 6.405,6.51 10.185,4.095 11.865,5.25 6.405,4.41 6.405,12.81 0,7.455 -5.46,12.18 -5.355,4.62 -14.805,4.62 -8.19,0 -14.49,-4.305 z\" />\n      <path d=\"m 349.61228,-29.925 h 15.54 q 0,-6.51 -1.05,-10.395 -1.68,-6.3 -5.88,-6.3 -5.04,0 -7.14,6.195 -1.47,4.305 -1.47,10.5 z m 30.03,5.04 h -30.03 q 0,9.135 3.045,13.86 3.57,5.67 11.55,5.67 3.255,0 6.405,-1.26 3.15,-1.26 5.88,-3.465 l 1.26,0.945 -2.31,5.88 q -6.72,4.725 -15.015,4.725 -12.915,0 -19.635,-7.245 -6.72,-7.245 -6.72,-20.37 0,-11.235 6.405,-18.165 6.51,-7.035 17.64,-7.035 11.655,0 16.905,7.56 4.62,6.615 4.62,18.9 z\" />\n    </g>\n  )\n}\n","import { makeStyles } from '@material-ui/core/styles'\nimport clsx from 'clsx'\nimport React, { useEffect, useState, useRef } from 'react'\n\nconst useStyles = makeStyles({\n  horizontalHandle: {\n    cursor: 'row-resize',\n    width: '100%',\n  },\n  verticalHandle: {\n    cursor: 'col-resize',\n    height: '100%',\n  },\n  flexbox_verticalHandle: {\n    cursor: 'col-resize',\n    alignSelf: 'stretch', // the height: 100% is actually unable to function inside flexbox\n  },\n  flexbox_horizontalHandle: {\n    cursor: 'row-resize',\n    alignSelf: 'stretch', // similar to above\n  },\n})\n\ninterface ResizeHandleProps {\n  onDrag: (arg: number) => number\n  vertical?: boolean\n  flexbox?: boolean\n  className?: string\n  [props: string]: unknown\n}\n\nfunction ResizeHandle({\n  onDrag,\n  vertical = false,\n  flexbox = false,\n  className: originalClassName,\n  ...props\n}: ResizeHandleProps) {\n  const [mouseDragging, setMouseDragging] = useState(false)\n  const prevPos = useRef(0)\n  const classes = useStyles()\n\n  useEffect(() => {\n    function mouseMove(event: MouseEvent) {\n      event.preventDefault()\n      const pos = event[vertical ? 'clientX' : 'clientY']\n      const distance = pos - prevPos.current\n      if (distance) {\n        const actualDistance = onDrag(distance)\n        prevPos.current += actualDistance\n      }\n    }\n\n    function mouseUp() {\n      setMouseDragging(false)\n    }\n    if (mouseDragging) {\n      window.addEventListener('mousemove', mouseMove, true)\n      window.addEventListener('mouseup', mouseUp, true)\n      return () => {\n        window.removeEventListener('mousemove', mouseMove, true)\n        window.removeEventListener('mouseup', mouseUp, true)\n      }\n    }\n    return () => {}\n  }, [mouseDragging, onDrag, vertical])\n\n  let className\n  if (flexbox) {\n    if (vertical) {\n      className = classes.flexbox_verticalHandle\n    } else {\n      className = classes.flexbox_horizontalHandle\n    }\n  } else if (vertical) {\n    className = classes.verticalHandle\n  } else {\n    className = classes.horizontalHandle\n  }\n\n  return (\n    <div\n      data-resizer=\"true\"\n      onMouseDown={event => {\n        event.preventDefault()\n        const pos = event[vertical ? 'clientX' : 'clientY']\n        prevPos.current = pos\n        setMouseDragging(true)\n      }}\n      role=\"presentation\"\n      className={clsx(className, originalClassName)}\n      {...props}\n    />\n  )\n}\n\nexport default ResizeHandle\n","import Paper from '@material-ui/core/Paper'\nimport Slide from '@material-ui/core/Slide'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport ResizeHandle from './ResizeHandle'\n\nconst useStyles = makeStyles(theme => ({\n  paper: {\n    overflowY: 'auto',\n    height: '100%',\n    zIndex: theme.zIndex.drawer,\n    outline: 'none',\n    background: theme.palette.background.default,\n  },\n  resizeHandle: {\n    width: 4,\n    position: 'fixed',\n    top: 0,\n    zIndex: theme.zIndex.drawer + 1,\n  },\n}))\n\nfunction Drawer({ children, open, session }) {\n  const classes = useStyles()\n\n  return (\n    <Slide in={open} direction=\"left\">\n      <Paper className={classes.paper} elevation={16} square>\n        <ResizeHandle\n          onDrag={session.resizeDrawer}\n          className={classes.resizeHandle}\n          vertical\n        />\n        {children}\n      </Paper>\n    </Slide>\n  )\n}\n\nDrawer.propTypes = {\n  children: PropTypes.node,\n  open: PropTypes.bool.isRequired,\n  session: MobxPropTypes.observableObject.isRequired,\n}\n\nDrawer.defaultProps = {\n  children: null,\n}\n\nexport default observer(Drawer)\n","import Typography from '@material-ui/core/Typography'\nimport AppBar from '@material-ui/core/AppBar'\nimport IconButton from '@material-ui/core/IconButton'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport CloseIcon from '@material-ui/icons/Close'\nimport { observer, PropTypes } from 'mobx-react'\nimport React from 'react'\nimport Drawer from './Drawer'\n\nconst useStyles = makeStyles(theme => ({\n  defaultDrawer: {},\n  components: {\n    display: 'block',\n  },\n  drawerCloseButton: {\n    float: 'right',\n    '&:hover': {\n      backgroundColor: fade(\n        theme.palette.secondary.contrastText,\n        theme.palette.action.hoverOpacity,\n      ),\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n  drawerToolbar: {\n    paddingLeft: theme.spacing(2),\n  },\n  drawerToolbarCloseButton: {\n    flexGrow: 1,\n  },\n  drawerLoading: {\n    margin: theme.spacing(2),\n  },\n}))\nconst DrawerWidget = observer(props => {\n  const { session } = props\n  const { visibleWidget, pluginManager } = session\n  const {\n    ReactComponent,\n    HeadingComponent,\n    heading,\n  } = pluginManager.getWidgetType(visibleWidget.type)\n  const classes = useStyles()\n\n  return (\n    <Drawer session={session} open={Boolean(session.activeWidgets.size)}>\n      <div className={classes.defaultDrawer}>\n        <AppBar position=\"static\" color=\"secondary\">\n          <Toolbar disableGutters className={classes.drawerToolbar}>\n            <Typography variant=\"h6\" color=\"inherit\">\n              {HeadingComponent ? (\n                <HeadingComponent model={visibleWidget} />\n              ) : (\n                heading || undefined\n              )}\n            </Typography>\n            <div className={classes.drawerToolbarCloseButton} />\n            <IconButton\n              className={classes.drawerCloseButton}\n              data-testid=\"drawer-close\"\n              color=\"inherit\"\n              aria-label=\"Close\"\n              onClick={() => session.hideWidget(visibleWidget)}\n            >\n              <CloseIcon />\n            </IconButton>\n          </Toolbar>\n        </AppBar>\n        <ReactComponent model={visibleWidget} session={session} />\n      </div>\n    </Drawer>\n  )\n})\n\nDrawerWidget.propTypes = {\n  session: PropTypes.observableObject.isRequired,\n}\n\nexport default DrawerWidget\n","import Divider from '@material-ui/core/Divider'\nimport Grow from '@material-ui/core/Grow'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport ListSubheader from '@material-ui/core/ListSubheader'\nimport { MenuProps as MUIMenuProps } from '@material-ui/core/Menu'\nimport MenuItem, { MenuItemProps } from '@material-ui/core/MenuItem'\nimport MenuList from '@material-ui/core/MenuList'\nimport Paper from '@material-ui/core/Paper'\nimport Popover, { PopoverProps } from '@material-ui/core/Popover'\nimport { SvgIconProps } from '@material-ui/core/SvgIcon'\nimport { makeStyles } from '@material-ui/core/styles'\nimport ArrowRightIcon from '@material-ui/icons/ArrowRight'\nimport CheckBoxIcon from '@material-ui/icons/CheckBox'\nimport CheckBoxOutlineBlankIcon from '@material-ui/icons/CheckBoxOutlineBlank'\nimport RadioButtonCheckedIcon from '@material-ui/icons/RadioButtonChecked'\nimport RadioButtonUncheckedIcon from '@material-ui/icons/RadioButtonUnchecked'\nimport React, { useEffect, useRef, useState } from 'react'\nimport { findLastIndex } from '../util'\n\nconst useStyles = makeStyles({\n  paper: {\n    position: 'fixed',\n    overflowY: 'auto',\n    overflowX: 'hidden',\n    // So we see the popover when it's empty.\n    minWidth: 16,\n    minHeight: 16,\n    maxWidth: 'calc(100% - 32px)',\n    maxHeight: 'calc(100% - 32px)',\n    top: 0,\n    left: 0,\n    // We disable the focus ring for mouse, touch and keyboard users.\n    outline: 0,\n  },\n  menuItemEndDecoration: {\n    position: 'absolute',\n    right: 16,\n    top: '50%',\n    transform: 'translateY(-50%)',\n    padding: 2,\n    marginRight: -12,\n    display: 'inline-flex',\n  },\n})\n\ninterface MenuItemEndDecorationSubMenuProps {\n  type: 'subMenu'\n}\n\ninterface MenuItemEndDecorationSelectorProps {\n  type: 'checkbox' | 'radio'\n  checked: boolean\n  disabled?: boolean\n}\n\ntype MenuItemEndDecorationProps =\n  | MenuItemEndDecorationSubMenuProps\n  | MenuItemEndDecorationSelectorProps\n\nfunction MenuItemEndDecoration(props: MenuItemEndDecorationProps) {\n  const classes = useStyles()\n  const { type } = props\n  let checked\n  let disabled\n  if ('checked' in props) {\n    ;({ checked, disabled } = props)\n  }\n  let icon\n  if (type === 'subMenu') {\n    icon = <ArrowRightIcon color=\"action\" />\n  } else if (type === 'checkbox') {\n    if (checked) {\n      const color = disabled ? 'inherit' : 'secondary'\n      icon = <CheckBoxIcon color={color} />\n    } else {\n      icon = <CheckBoxOutlineBlankIcon color=\"action\" />\n    }\n  } else if (type === 'radio') {\n    if (checked) {\n      const color = disabled ? 'inherit' : 'secondary'\n      icon = <RadioButtonCheckedIcon color={color} />\n    } else {\n      icon = <RadioButtonUncheckedIcon color=\"action\" />\n    }\n  }\n  return <div className={classes.menuItemEndDecoration}>{icon}</div>\n}\n\nexport interface MenuDivider {\n  priority?: number\n  type: 'divider'\n}\n\nexport interface MenuSubHeader {\n  type: 'subHeader'\n  priority?: number\n  label: string\n}\n\nexport interface BaseMenuItem {\n  label: string\n  priority?: number\n  subLabel?: string\n  icon?: React.ComponentType<SvgIconProps>\n  disabled?: boolean\n}\n\nexport interface NormalMenuItem extends BaseMenuItem {\n  type?: 'normal'\n  onClick: Function\n}\n\nexport interface CheckboxMenuItem extends BaseMenuItem {\n  type: 'checkbox'\n  checked: boolean\n  onClick: Function\n}\n\nexport interface RadioMenuItem extends BaseMenuItem {\n  type: 'radio'\n  checked: boolean\n  onClick: Function\n}\n\nexport interface SubMenuItem extends BaseMenuItem {\n  type?: 'subMenu'\n  subMenu: MenuItem[]\n}\n\nexport type MenuItem =\n  | MenuDivider\n  | MenuSubHeader\n  | NormalMenuItem\n  | CheckboxMenuItem\n  | RadioMenuItem\n  | SubMenuItem\n\ntype AnchorElProp = MUIMenuProps['anchorEl']\ntype OpenProp = MUIMenuProps['open']\ntype OnCloseProp = MUIMenuProps['onClose']\n\ninterface MenuPageProps {\n  menuItems: MenuItem[]\n  onMenuItemClick: (\n    event: React.MouseEvent<HTMLLIElement, MouseEvent>,\n    callback: Function,\n  ) => void\n  anchorEl?: AnchorElProp\n  open: OpenProp\n  onClose: OnCloseProp\n  top?: boolean\n}\n\ntype MenuItemStyleProp = MenuItemProps['style']\n\nfunction findNextValidIdx(menuItems: MenuItem[], currentIdx: number) {\n  const idx = menuItems\n    .slice(currentIdx + 1)\n    .findIndex(\n      menuItem =>\n        menuItem.type !== 'divider' &&\n        menuItem.type !== 'subHeader' &&\n        !menuItem.disabled,\n    )\n  if (idx === -1) {\n    return idx\n  }\n  return currentIdx + 1 + idx\n}\n\nfunction findPreviousValidIdx(menuItems: MenuItem[], currentIdx: number) {\n  return findLastIndex(\n    menuItems.slice(0, currentIdx),\n    menuItem =>\n      menuItem.type !== 'divider' &&\n      menuItem.type !== 'subHeader' &&\n      !menuItem.disabled,\n  )\n}\n\nconst MenuPage = React.forwardRef((props: MenuPageProps, ref) => {\n  const [subMenuAnchorEl, setSubMenuAnchorEl] = useState<null | HTMLElement>(\n    null,\n  )\n  const [openSubMenuIdx, setOpenSubMenuIdx] = useState<null | number>(null)\n  const [isSubMenuOpen, setIsSubMenuOpen] = useState(false)\n  const [selectedMenuItemIdx, setSelectedMenuItemIdx] = useState<null | number>(\n    null,\n  )\n  const [position, setPosition] = useState<null | {\n    top?: number\n    left?: number\n  }>(null)\n  const paperRef = useRef<null | HTMLDivElement>(null)\n  const classes = useStyles()\n\n  const {\n    menuItems,\n    onMenuItemClick,\n    open,\n    onClose,\n    anchorEl,\n    top = false,\n  } = props\n\n  useEffect(() => {\n    if (!open) {\n      setSubMenuAnchorEl(null)\n      setOpenSubMenuIdx(null)\n    }\n  }, [open])\n\n  useEffect(() => {\n    const shouldSubMenuBeOpen = open && Boolean(subMenuAnchorEl)\n    let timer: NodeJS.Timeout\n    if (shouldSubMenuBeOpen && !isSubMenuOpen) {\n      timer = setTimeout(() => {\n        setIsSubMenuOpen(true)\n      }, 300)\n    } else if (!shouldSubMenuBeOpen && isSubMenuOpen) {\n      timer = setTimeout(() => {\n        setIsSubMenuOpen(false)\n      }, 300)\n    }\n    return () => {\n      clearTimeout(timer)\n    }\n  }, [isSubMenuOpen, open, subMenuAnchorEl])\n\n  useEffect(() => {\n    if (anchorEl) {\n      const rect = (anchorEl as HTMLElement).getBoundingClientRect()\n      if (position) {\n        if (\n          rect.top !== position.top ||\n          rect.left + rect.width !== position.left\n        ) {\n          setPosition({ top: rect.top, left: rect.left + rect.width })\n        }\n      } else {\n        setPosition({ top: rect.top, left: rect.left + rect.width })\n      }\n    } else if (!position) {\n      setPosition({})\n    }\n  }, [position, anchorEl])\n\n  const hasEndDecoration = menuItems.some(\n    menuItem =>\n      'subMenu' in menuItem ||\n      menuItem.type === 'checkbox' ||\n      menuItem.type === 'radio',\n  )\n  const hasIcon = menuItems.some(\n    menuItem => 'icon' in menuItem && menuItem.icon,\n  )\n  const menuItemStyle: MenuItemStyleProp = {}\n  if (hasEndDecoration) {\n    menuItemStyle.paddingRight = 48\n  }\n\n  function handleClick(callback: Function) {\n    return (event: React.MouseEvent<HTMLLIElement, MouseEvent>) => {\n      onMenuItemClick(event, callback)\n    }\n  }\n\n  const ListContents = (\n    <>\n      <MenuList autoFocusItem={open && !isSubMenuOpen}>\n        {menuItems\n          .sort((a, b) => (b.priority || 0) - (a.priority || 0))\n          .map((menuItem, idx) => {\n            if (menuItem.type === 'divider') {\n              return <Divider key={`divider-${idx}`} component=\"li\" />\n            }\n            if (menuItem.type === 'subHeader') {\n              return (\n                <ListSubheader key={`subHeader-${menuItem.label}-${idx}`}>\n                  {menuItem.label}\n                </ListSubheader>\n              )\n            }\n            let icon = null\n            let endDecoration = null\n            if (menuItem.icon) {\n              const Icon = menuItem.icon\n              icon = (\n                <ListItemIcon>\n                  <Icon />\n                </ListItemIcon>\n              )\n            }\n            if ('subMenu' in menuItem) {\n              endDecoration = <MenuItemEndDecoration type=\"subMenu\" />\n            } else if (\n              menuItem.type === 'checkbox' ||\n              menuItem.type === 'radio'\n            ) {\n              endDecoration = (\n                <MenuItemEndDecoration\n                  type={menuItem.type}\n                  checked={menuItem.checked}\n                  disabled={menuItem.disabled}\n                />\n              )\n            }\n            const onClick =\n              'onClick' in menuItem ? handleClick(menuItem.onClick) : undefined\n            return (\n              <MenuItem\n                key={menuItem.label}\n                style={menuItemStyle}\n                selected={idx === selectedMenuItemIdx}\n                onClick={onClick}\n                onMouseMove={e => {\n                  if (e.currentTarget !== document.activeElement) {\n                    e.currentTarget.focus()\n                    setSelectedMenuItemIdx(idx)\n                  }\n                  if ('subMenu' in menuItem) {\n                    if (openSubMenuIdx !== idx) {\n                      setSubMenuAnchorEl(e.currentTarget)\n                      setOpenSubMenuIdx(idx)\n                    }\n                  } else {\n                    setSubMenuAnchorEl(null)\n                    setOpenSubMenuIdx(null)\n                  }\n                }}\n                onKeyDown={e => {\n                  if (e.key === 'ArrowLeft' || e.key === 'Escape') {\n                    onClose && onClose(e, 'escapeKeyDown')\n                  } else if (e.key === 'ArrowUp') {\n                    setSelectedMenuItemIdx(findPreviousValidIdx(menuItems, idx))\n                  } else if (e.key === 'ArrowDown') {\n                    const a = findNextValidIdx(menuItems, idx)\n                    setSelectedMenuItemIdx(a)\n                  } else if ('subMenu' in menuItem) {\n                    if (e.key === 'ArrowRight' || e.key === 'Enter') {\n                      setSubMenuAnchorEl(e.currentTarget)\n                      setOpenSubMenuIdx(idx)\n                      setIsSubMenuOpen(true)\n                    }\n                  }\n                }}\n                disabled={Boolean(menuItem.disabled)}\n              >\n                {icon}\n                <ListItemText\n                  primary={menuItem.label}\n                  secondary={menuItem.subLabel}\n                  inset={hasIcon && !menuItem.icon}\n                />\n                {endDecoration}\n              </MenuItem>\n            )\n          })}\n      </MenuList>\n      {menuItems.map((menuItem, idx) => {\n        let subMenu = null\n        if ('subMenu' in menuItem) {\n          subMenu = (\n            <MenuPage\n              key={menuItem.label}\n              anchorEl={subMenuAnchorEl}\n              open={isSubMenuOpen && openSubMenuIdx === idx}\n              onClose={() => {\n                setIsSubMenuOpen(false)\n                setSubMenuAnchorEl(null)\n              }}\n              onMenuItemClick={onMenuItemClick}\n              menuItems={menuItem.subMenu}\n            />\n          )\n        }\n        return subMenu\n      })}\n    </>\n  )\n\n  if (top) {\n    return ListContents\n  }\n\n  return (\n    <Grow in={open} style={{ transformOrigin: '0 0 0' }} ref={ref}>\n      <Paper\n        elevation={8}\n        ref={paperRef}\n        className={classes.paper}\n        style={{ ...position }}\n      >\n        {ListContents}\n      </Paper>\n    </Grow>\n  )\n})\n\ninterface MenuProps extends PopoverProps {\n  menuItems: MenuItem[]\n  onMenuItemClick: (\n    event: React.MouseEvent<HTMLLIElement, MouseEvent>,\n    callback: Function,\n  ) => void\n}\n\nfunction Menu(props: MenuProps) {\n  const { open, onClose, menuItems, onMenuItemClick, ...other } = props\n  return (\n    <Popover\n      open={open}\n      onClose={onClose}\n      BackdropProps={{ invisible: true }}\n      {...other}\n    >\n      <MenuPage\n        open={open}\n        onClose={onClose}\n        menuItems={menuItems}\n        onMenuItemClick={onMenuItemClick}\n        top\n      />\n    </Popover>\n  )\n}\n\nexport default Menu\n","import Button from '@material-ui/core/Button'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport ArrowDropDown from '@material-ui/icons/ArrowDropDown'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React, { useRef, useState } from 'react'\nimport Menu, { MenuItem } from './Menu'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n  },\n  buttonRoot: {\n    '&:hover': {\n      backgroundColor: fade(\n        theme.palette.primary.contrastText,\n        theme.palette.action.hoverOpacity,\n      ),\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n}))\n\nfunction DropDownMenu({\n  menuTitle,\n  session,\n  menuItems,\n}: {\n  menuTitle: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  session: any\n  menuItems: MenuItem[]\n}) {\n  const [open, setOpen] = useState(false)\n  const anchorEl = useRef(null)\n  const classes = useStyles()\n\n  function handleToggle() {\n    setOpen(!open)\n  }\n\n  function handleMenuItemClick(_event: unknown, callback: Function) {\n    callback(session)\n    handleClose()\n  }\n\n  function handleClose() {\n    setOpen(false)\n  }\n\n  return (\n    <div className={classes.root}>\n      <Button\n        ref={anchorEl}\n        onClick={handleToggle}\n        color=\"inherit\"\n        data-testid=\"dropDownMenuButton\"\n        classes={{ root: classes.buttonRoot }}\n      >\n        {menuTitle}\n        <ArrowDropDown />\n      </Button>\n      <Menu\n        anchorEl={anchorEl.current}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'left' }}\n        onMenuItemClick={handleMenuItemClick}\n        open={open}\n        onClose={handleClose}\n        menuItems={menuItems}\n      />\n    </div>\n  )\n}\n\nDropDownMenu.propTypes = {\n  menuTitle: PropTypes.string.isRequired,\n  menuItems: MobxPropTypes.arrayOrObservableArray.isRequired,\n  session: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n\nexport default observer(DropDownMenu)\n","import InputBase from '@material-ui/core/InputBase'\nimport Typography, { TypographyProps } from '@material-ui/core/Typography'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport React, { useEffect, useState } from 'react'\n\ntype Variant = TypographyProps['variant']\n\ntype EditableTypographyClassKey =\n  | 'input'\n  | 'inputBase'\n  | 'inputRoot'\n  | 'inputFocused'\n\nconst useStyles = makeStyles(theme => ({\n  input: {},\n  inputBase: {},\n  typography: {\n    top: 6,\n    left: 2,\n    position: 'absolute',\n    whiteSpace: 'nowrap',\n    visibility: 'hidden',\n  },\n  inputRoot: {\n    padding: theme.spacing(0.5),\n  },\n  inputFocused: {\n    borderStyle: 'solid',\n    borderRadius: theme.shape.borderRadius,\n    borderWidth: 2,\n  },\n}))\n\ninterface EditableTypographyPropTypes {\n  value: string\n  setValue: (value: string) => void\n  variant: Variant\n  classes?: Partial<Record<EditableTypographyClassKey, string>>\n}\n\n// using forwardRef so that MUI Tooltip can wrap this component\nconst EditableTypography = React.forwardRef(\n  (props: EditableTypographyPropTypes, ref: React.Ref<HTMLDivElement>) => {\n    const { value, setValue, variant, ...other } = props\n    const [editedValue, setEditedValue] = useState<string | undefined>()\n    const [width, setWidth] = useState(0)\n    const [sizerNode, setSizerNode] = useState<HTMLSpanElement | null>(null)\n    const [inputNode, setInputNode] = useState<HTMLInputElement | null>(null)\n    const [blur, setBlur] = useState(false)\n\n    useEffect(() => {\n      if (blur) {\n        inputNode && inputNode.blur()\n        setBlur(false)\n      }\n    }, [blur, inputNode])\n\n    const classes = useStyles(props)\n    const theme = useTheme()\n\n    const clientWidth = sizerNode && sizerNode.clientWidth\n    if (clientWidth && clientWidth !== width) {\n      setWidth(clientWidth)\n    }\n\n    const sizerRef = (node: HTMLSpanElement) => {\n      setSizerNode(node)\n    }\n\n    const inputRef = (node: HTMLInputElement) => {\n      setInputNode(node)\n    }\n\n    function handleBlur() {\n      if (editedValue && editedValue !== value) {\n        setValue(editedValue)\n      }\n      setEditedValue(undefined)\n    }\n\n    function handleKeyDown(event: React.KeyboardEvent<HTMLInputElement>) {\n      if (event.key === 'Enter') {\n        inputNode && inputNode.blur()\n      } else if (event.key === 'Escape') {\n        setEditedValue(undefined)\n        setBlur(true)\n      }\n    }\n\n    function handleChange(event: React.ChangeEvent<HTMLInputElement>) {\n      setEditedValue(event.target.value)\n    }\n\n    return (\n      <div {...other} ref={ref}>\n        <div style={{ position: 'relative' }}>\n          <Typography\n            ref={sizerRef}\n            component=\"span\"\n            variant={variant}\n            className={classes.typography}\n          >\n            {editedValue === undefined ? value : editedValue}\n          </Typography>\n        </div>\n        <InputBase\n          inputRef={inputRef}\n          className={classes.inputBase}\n          inputProps={{\n            style: {\n              width,\n              ...(variant && variant !== 'inherit' && variant !== 'srOnly'\n                ? theme.typography[variant]\n                : {}),\n            },\n          }}\n          classes={{\n            input: classes.input,\n            root: classes.inputRoot,\n            focused: classes.inputFocused,\n          }}\n          value={editedValue === undefined ? value : editedValue}\n          onChange={handleChange}\n          onKeyDown={handleKeyDown}\n          onBlur={handleBlur}\n        />\n      </div>\n    )\n  },\n)\n\nexport default EditableTypography\n","import IconButton from '@material-ui/core/IconButton'\nimport Snackbar from '@material-ui/core/Snackbar'\nimport CloseIcon from '@material-ui/icons/Close'\nimport Alert from '@material-ui/lab/Alert'\nimport { observer } from 'mobx-react'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport React, { useEffect, useState } from 'react'\nimport { AbstractSessionModel, NotificationLevel } from '../util'\n\ntype SnackbarMessage = [string, NotificationLevel]\n\ninterface SnackbarSession extends AbstractSessionModel {\n  snackbarMessages: SnackbarMessage[]\n  popSnackbarMessage: () => unknown\n}\n\nfunction MessageSnackbar({\n  session,\n}: {\n  session: SnackbarSession & IAnyStateTreeNode\n}) {\n  const [open, setOpen] = useState(false)\n  const [snackbarMessage, setSnackbarMessage] = useState<\n    SnackbarMessage | undefined\n  >()\n\n  const { popSnackbarMessage, snackbarMessages } = session\n\n  const latestMessage = snackbarMessages.length\n    ? snackbarMessages[snackbarMessages.length - 1]\n    : null\n\n  useEffect(() => {\n    let timeoutId: NodeJS.Timer\n\n    if (snackbarMessage) {\n      if (!latestMessage) {\n        setSnackbarMessage(undefined)\n      } else if (snackbarMessage[0] !== latestMessage[0]) {\n        setOpen(false)\n        timeoutId = setTimeout(() => {\n          setSnackbarMessage(latestMessage)\n          setOpen(true)\n        }, 100)\n      }\n    } else if (latestMessage) {\n      setSnackbarMessage(latestMessage)\n      setOpen(true)\n    }\n\n    return () => {\n      clearTimeout(timeoutId)\n    }\n  }, [latestMessage, snackbarMessage])\n\n  const handleClose = (_event: unknown, reason?: string) => {\n    if (reason === 'clickaway') {\n      return\n    }\n    popSnackbarMessage()\n    setOpen(false)\n  }\n\n  const [message, level] = snackbarMessage || []\n  return (\n    <Snackbar\n      open={open && !!message}\n      onClose={handleClose}\n      action={\n        <IconButton aria-label=\"close\" color=\"inherit\" onClick={handleClose}>\n          <CloseIcon />\n        </IconButton>\n      }\n    >\n      <Alert onClose={handleClose} severity={level || 'warning'}>\n        {message}\n      </Alert>\n    </Snackbar>\n  )\n}\n\nexport default observer(MessageSnackbar)\n","import { SvgIconProps } from '@material-ui/core/SvgIcon'\nimport IconButton, {\n  IconButtonProps as IconButtonPropsType,\n} from '@material-ui/core/IconButton'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport { observer } from 'mobx-react'\nimport { isAlive } from 'mobx-state-tree'\nimport React, { useEffect, useRef, useState } from 'react'\nimport { ContentRect, withContentRect } from 'react-measure'\nimport CloseIcon from '@material-ui/icons/Close'\nimport MenuIcon from '@material-ui/icons/Menu'\nimport { IBaseViewModel } from '../pluggableElementTypes/models'\nimport EditableTypography from './EditableTypography'\nimport Menu from './Menu'\n\nconst useStyles = makeStyles(theme => ({\n  viewContainer: {\n    overflow: 'hidden',\n    background: theme.palette.secondary.main,\n    margin: theme.spacing(0.5),\n  },\n  icon: {\n    color: theme.palette.secondary.contrastText,\n  },\n  grow: {\n    flexGrow: 1,\n  },\n  iconRoot: {\n    '&:hover': {\n      backgroundColor: fade(\n        theme.palette.secondary.contrastText,\n        theme.palette.action.hoverOpacity,\n      ),\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n  listItemIconRoot: {\n    minWidth: 28,\n  },\n  listItemInset: {\n    paddingLeft: 28,\n  },\n  menuItemDense: {\n    paddingLeft: theme.spacing(1),\n    paddingRight: 26,\n    paddingTop: 0,\n    paddingBottom: 0,\n  },\n  secondaryActionRoot: {\n    right: theme.spacing(1),\n  },\n  input: {\n    paddingBottom: 0,\n    paddingTop: 2,\n  },\n  inputBase: {\n    color: theme.palette.secondary.contrastText,\n  },\n  inputRoot: {\n    '&:hover': {\n      backgroundColor: theme.palette.secondary.light,\n    },\n  },\n  inputFocused: {\n    borderColor: theme.palette.primary.main,\n    backgroundColor: theme.palette.secondary.light,\n  },\n}))\n\nconst ViewMenu = observer(\n  ({\n    model,\n    IconButtonProps,\n    IconProps,\n  }: {\n    model: IBaseViewModel\n    IconButtonProps: IconButtonPropsType\n    IconProps: SvgIconProps\n  }) => {\n    const [anchorEl, setAnchorEl] = useState<HTMLElement>()\n\n    if (!(model.menuItems && model.menuItems.length)) {\n      return null\n    }\n\n    return (\n      <>\n        <IconButton\n          {...IconButtonProps}\n          aria-label=\"more\"\n          aria-controls=\"view-menu\"\n          aria-haspopup=\"true\"\n          onClick={event => {\n            setAnchorEl(event.currentTarget)\n          }}\n          data-testid=\"view_menu_icon\"\n        >\n          <MenuIcon {...IconProps} />\n        </IconButton>\n        <Menu\n          anchorEl={anchorEl}\n          open={Boolean(anchorEl)}\n          onMenuItemClick={(_event, callback) => {\n            callback()\n            setAnchorEl(undefined)\n          }}\n          onClose={() => {\n            setAnchorEl(undefined)\n          }}\n          menuItems={model.menuItems}\n        />\n      </>\n    )\n  },\n)\n\nexport default withContentRect('bounds')(\n  observer(\n    ({\n      view,\n      onClose,\n      style,\n      children,\n      contentRect,\n      measureRef,\n    }: {\n      view: IBaseViewModel\n      onClose: () => void\n      style: React.CSSProperties\n      children: React.ReactNode\n      contentRect: ContentRect\n      measureRef: React.RefObject<HTMLDivElement>\n    }) => {\n      const classes = useStyles()\n      const theme = useTheme()\n      const padWidth = theme.spacing(1)\n\n      let width = 0\n      if (contentRect.bounds) {\n        ;({ width } = contentRect.bounds)\n      }\n      useEffect(() => {\n        if (width) {\n          if (isAlive(view)) {\n            view.setWidth(width - padWidth * 2)\n          }\n        }\n      }, [padWidth, view, width])\n\n      const scrollRef = useRef<HTMLDivElement>(null)\n      // scroll the view into view when first mounted\n      // note that this effect will run only once, because of\n      // the empty array second param\n      useEffect(() => {\n        if (scrollRef && scrollRef.current && scrollRef.current.scrollIntoView)\n          scrollRef.current.scrollIntoView({ block: 'center' })\n      }, [])\n\n      return (\n        <Paper\n          elevation={12}\n          ref={measureRef}\n          className={classes.viewContainer}\n          style={{ ...style, padding: `0px ${padWidth}px ${padWidth}px` }}\n        >\n          <div ref={scrollRef} style={{ display: 'flex' }}>\n            <ViewMenu\n              model={view}\n              IconButtonProps={{\n                classes: { root: classes.iconRoot },\n                edge: 'start',\n              }}\n              IconProps={{ className: classes.icon }}\n            />\n            <div className={classes.grow} />\n            <Tooltip title=\"Rename view\" arrow>\n              <EditableTypography\n                value={\n                  view.displayName ||\n                  // @ts-ignore\n                  (view.assemblyNames\n                    ? // @ts-ignore\n                      view.assemblyNames.join(',')\n                    : 'Untitled view')\n                }\n                setValue={val => {\n                  view.setDisplayName(val)\n                }}\n                variant=\"body2\"\n                classes={{\n                  input: classes.input,\n                  inputBase: classes.inputBase,\n                  inputRoot: classes.inputRoot,\n                  inputFocused: classes.inputFocused,\n                }}\n              />\n            </Tooltip>\n            <div className={classes.grow} />\n            <IconButton\n              data-testid=\"close_view\"\n              classes={{ root: classes.iconRoot }}\n              edge=\"end\"\n              onClick={onClose}\n            >\n              <CloseIcon className={classes.icon} />\n            </IconButton>\n          </div>\n          <Paper>{children}</Paper>\n        </Paper>\n      )\n    },\n  ),\n)\n","/* eslint-disable react/prop-types */\nimport React from 'react'\nimport AppBar from '@material-ui/core/AppBar'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport { observer } from 'mobx-react'\nimport DrawerWidget from './DrawerWidget'\nimport DropDownMenu from './DropDownMenu'\nimport EditableTypography from './EditableTypography'\nimport { LogoFull } from './Logo'\nimport Snackbar from './Snackbar'\nimport ViewContainer from './ViewContainer'\n\nconst useStyles = makeStyles(theme => ({\n  '@global': {\n    html: {\n      'font-family': 'Roboto',\n    },\n    /* Based on: https://www.digitalocean.com/community/tutorials/css-scrollbars */\n    /* The emerging W3C standard\n       that is currently Firefox-only */\n    '*': {\n      'scrollbar-width': 'auto',\n      'scrollbar-color': 'rgba(0,0,0,.5) rgba(128,128,128)',\n    },\n    /* Works on Chrome/Edge/Safari */\n    '*::-webkit-scrollbar': {\n      '-webkit-appearance': 'none',\n      width: '12px',\n    },\n    '*::-webkit-scrollbar-thumb': {\n      'background-color': 'rgba(0,0,0,.5)',\n      '-webkit-box-shadow': '0 0 1px rgba(255,255,255,.5)',\n    },\n  },\n  root: {\n    display: 'grid',\n    height: '100vh',\n    width: '100%',\n  },\n  menuBarAndComponents: {\n    gridColumn: 'main',\n    display: 'grid',\n    gridTemplateRows: '[menubar] min-content [components] auto',\n    height: '100vh',\n  },\n  menuBar: {\n    gridRow: 'menubar',\n  },\n  components: {\n    overflowY: 'auto',\n    gridRow: 'components',\n  },\n  appBar: {\n    flexGrow: 1,\n  },\n  grow: {\n    flexGrow: 1,\n  },\n  inputBase: {\n    color: theme.palette.primary.contrastText,\n  },\n  inputRoot: {\n    '&:hover': {\n      backgroundColor: theme.palette.primary.light,\n    },\n  },\n  inputFocused: {\n    borderColor: theme.palette.secondary.main,\n    backgroundColor: theme.palette.primary.light,\n  },\n}))\n\nfunction App({ session, HeaderButtons }) {\n  const classes = useStyles()\n  const { pluginManager } = session\n  const { visibleWidget, drawerWidth } = session\n\n  function handleNameChange(newName) {\n    if (\n      session.savedSessionNames &&\n      session.savedSessionNames.includes(newName)\n    ) {\n      session.notify(\n        `Cannot rename session to \"${newName}\", a saved session with that name already exists`,\n        'warning',\n      )\n    } else {\n      session.renameCurrentSession(newName)\n    }\n  }\n  return (\n    <div\n      className={classes.root}\n      style={{\n        gridTemplateColumns: `[main] 1fr${\n          visibleWidget ? ` [drawer] ${drawerWidth}px` : ''\n        }`,\n      }}\n    >\n      <div className={classes.menuBarAndComponents}>\n        <div className={classes.menuBar}>\n          <AppBar className={classes.appBar} position=\"static\">\n            <Toolbar>\n              {session.menus.map(menu => (\n                <DropDownMenu\n                  key={menu.label}\n                  menuTitle={menu.label}\n                  menuItems={menu.menuItems}\n                  session={session}\n                />\n              ))}\n              <div className={classes.grow} />\n              <Tooltip title=\"Rename Session\" arrow>\n                <EditableTypography\n                  value={session.name}\n                  setValue={handleNameChange}\n                  variant=\"body1\"\n                  classes={{\n                    inputBase: classes.inputBase,\n                    inputRoot: classes.inputRoot,\n                    inputFocused: classes.inputFocused,\n                  }}\n                />\n              </Tooltip>\n              {HeaderButtons}\n              <div className={classes.grow} />\n              <div style={{ width: 150, maxHeight: 48 }}>\n                <LogoFull variant=\"white\" />\n              </div>\n            </Toolbar>\n          </AppBar>\n        </div>\n        <div className={classes.components}>\n          {session.views.map(view => {\n            const viewType = pluginManager.getViewType(view.type)\n            if (!viewType) {\n              throw new Error(`unknown view type ${view.type}`)\n            }\n            const { ReactComponent } = viewType\n            return (\n              <ViewContainer\n                key={`view-${view.id}`}\n                view={view}\n                onClose={() => session.removeView(view)}\n              >\n                <ReactComponent\n                  model={view}\n                  session={session}\n                  getTrackType={pluginManager.getTrackType}\n                />\n              </ViewContainer>\n            )\n          })}\n          <div style={{ height: 300 }} />\n        </div>\n      </div>\n\n      {visibleWidget ? <DrawerWidget session={session} /> : null}\n      <Snackbar session={session} />\n    </div>\n  )\n}\n\nexport default observer(App)\n","import Button from '@material-ui/core/Button'\nimport FormHelperText from '@material-ui/core/FormHelperText'\nimport Grid from '@material-ui/core/Grid'\nimport InputLabel from '@material-ui/core/InputLabel'\nimport TextField from '@material-ui/core/TextField'\nimport Typography from '@material-ui/core/Typography'\nimport ToggleButton from '@material-ui/lab/ToggleButton'\nimport ToggleButtonGroup from '@material-ui/lab/ToggleButtonGroup'\nimport { observer } from 'mobx-react'\nimport React, { useState } from 'react'\nimport {\n  FileLocation,\n  UriLocation,\n  LocalPathLocation,\n  BlobLocation,\n} from '../util/types'\n\nconst isElectron = typeof window !== 'undefined' && Boolean(window.electron)\n\nfunction isUriLocation(location: FileLocation): location is UriLocation {\n  return 'uri' in location\n}\n\nfunction isLocalPathLocation(\n  location: FileLocation,\n): location is LocalPathLocation {\n  return 'localPath' in location\n}\n\nfunction isBlobLocation(location: FileLocation): location is BlobLocation {\n  return 'blob' in location\n}\n\nconst FileLocationEditor = observer(\n  (props: {\n    location?: FileLocation\n    setLocation: (param: FileLocation) => void\n    name?: string\n    description?: string\n    localFileAllowed?: boolean\n  }) => {\n    const { location, name, description, localFileAllowed = isElectron } = props\n    const fileOrUrl =\n      (location && isUriLocation(location)) || !localFileAllowed\n        ? 'url'\n        : 'file'\n    const [fileOrUrlState, setFileOrUrlState] = useState(fileOrUrl)\n\n    const handleFileOrUrlChange = (\n      _event: unknown,\n      newValue: string | null,\n    ) => {\n      if (newValue === 'url') {\n        setFileOrUrlState('url')\n      } else if (localFileAllowed) {\n        setFileOrUrlState('file')\n      }\n    }\n    return (\n      <>\n        <InputLabel shrink htmlFor=\"callback-editor\">\n          {name}\n        </InputLabel>\n        <Grid container spacing={1} direction=\"row\" alignItems=\"center\">\n          <Grid item>\n            <ToggleButtonGroup\n              value={fileOrUrlState}\n              exclusive\n              onChange={handleFileOrUrlChange}\n              aria-label=\"file or url picker\"\n            >\n              {localFileAllowed ? (\n                <ToggleButton value=\"file\" aria-label=\"local file\">\n                  File\n                </ToggleButton>\n              ) : null}\n              <ToggleButton value=\"url\" aria-label=\"url\">\n                Url\n              </ToggleButton>\n            </ToggleButtonGroup>\n          </Grid>\n          <Grid item>\n            {fileOrUrlState === 'url' ? (\n              <UrlChooser {...props} />\n            ) : (\n              <LocalFileChooser {...props} />\n            )}\n          </Grid>\n        </Grid>\n        <FormHelperText>{description}</FormHelperText>\n      </>\n    )\n  },\n)\n\nconst UrlChooser = (props: {\n  location?: FileLocation\n  setLocation: Function\n}) => {\n  const { location, setLocation } = props\n  const handleChange = (\n    event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>,\n  ) => {\n    setLocation({ uri: event.target.value })\n  }\n  return (\n    <TextField\n      fullWidth\n      defaultValue={location && isUriLocation(location) ? location.uri : ''}\n      onChange={handleChange}\n    />\n  )\n}\n\nconst LocalFileChooser = observer(\n  (props: { location?: FileLocation; setLocation: Function }) => {\n    const { location, setLocation } = props\n    const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n      const { target } = event\n      const file = target && target.files && target.files[0]\n      if (file) {\n        if (isElectron) {\n          setLocation({ localPath: file.path })\n        } else {\n          setLocation({ blob: file })\n        }\n      }\n    }\n\n    const filename =\n      location &&\n      ((isBlobLocation(location) && (location.blob as File).name) ||\n        (isLocalPathLocation(location) && location.localPath))\n\n    return (\n      <div style={{ position: 'relative' }}>\n        <Button variant=\"outlined\" component=\"label\">\n          Choose File\n          <input\n            type=\"file\"\n            style={{\n              position: 'absolute',\n              top: 0,\n              left: 0,\n              width: '100%',\n              opacity: 0,\n            }}\n            onChange={handleChange}\n          />\n        </Button>\n        {filename ? (\n          <Typography\n            style={{ marginLeft: '0.4rem' }}\n            variant=\"body1\"\n            component=\"span\"\n          >\n            {filename}\n          </Typography>\n        ) : null}\n      </div>\n    )\n  },\n)\n\nexport default FileLocationEditor\n","/* eslint-disable @typescript-eslint/camelcase */\n/* eslint-disable import/no-mutable-exports */\n/* eslint-disable no-restricted-globals */\n\n// This is a ponyfill for the HTML5 OffscreenCanvas API.\nexport let createCanvas\nexport let createImageBitmap\nexport let ImageBitmapType\n\n// sniff environments\nconst isElectron = typeof window !== 'undefined' && Boolean(window.electron)\n\nconst weHave = {\n  realOffscreenCanvas:\n    typeof __webpack_require__ === 'function' &&\n    typeof OffscreenCanvas === 'function',\n  node:\n    typeof __webpack_require__ === 'undefined' && typeof process === 'object',\n}\n\nclass PonyfillOffscreenContext {\n  constructor() {\n    this.commands = []\n    this.currentFont = '12px Courier New, monospace'\n  }\n\n  // setters (no getters working)\n  set strokeStyle(style) {\n    this.commands.push({ type: 'strokeStyle', style })\n  }\n\n  set fillStyle(style) {\n    this.commands.push({ type: 'fillStyle', style })\n  }\n\n  set font(style) {\n    this.currentFont = style\n    this.commands.push({ type: 'font', style })\n  }\n\n  // methods\n  arc(...args) {\n    this.commands.push({ type: 'arc', args })\n  }\n\n  arcTo(...args) {\n    this.commands.push({ type: 'arcTo', args })\n  }\n\n  beginPath(...args) {\n    this.commands.push({ type: 'beginPath', args })\n  }\n\n  clearRect(...args) {\n    this.commands.push({ type: 'clearRect', args })\n  }\n\n  clip(...args) {\n    this.commands.push({ type: 'clip', args })\n  }\n\n  closePath(...args) {\n    this.commands.push({ type: 'closePath', args })\n  }\n\n  createLinearGradient(...args) {\n    this.commands.push({ type: 'createLinearGradient', args })\n  }\n\n  createPattern(...args) {\n    this.commands.push({ type: 'createPattern', args })\n  }\n\n  createRadialGradient(...args) {\n    this.commands.push({ type: 'createRadialGradient', args })\n  }\n\n  drawFocusIfNeeded(...args) {\n    this.commands.push({ type: 'drawFocusIfNeeded', args })\n  }\n\n  drawImage(...args) {\n    this.commands.push({ type: 'drawImage', args })\n  }\n\n  ellipse(...args) {\n    this.commands.push({ type: 'ellipse', args })\n  }\n\n  fill(...args) {\n    this.commands.push({ type: 'fill', args })\n  }\n\n  fillRect(...args) {\n    this.commands.push({ type: 'fillRect', args })\n  }\n\n  fillText(...args) {\n    this.commands.push({ type: 'fillText', args })\n  }\n\n  lineTo(...args) {\n    this.commands.push({ type: 'lineTo', args })\n  }\n\n  measureText(text) {\n    const height = +this.currentFont.match(/\\d+/)[0]\n    return {\n      width: (height / 2) * text.length,\n      height,\n    }\n  }\n\n  moveTo(...args) {\n    this.commands.push({ type: 'moveTo', args })\n  }\n\n  quadraticCurveTo(...args) {\n    this.commands.push({ type: 'quadraticCurveTo', args })\n  }\n\n  rect(...args) {\n    this.commands.push({ type: 'rect', args })\n  }\n\n  restore(...args) {\n    this.commands.push({ type: 'restore', args })\n  }\n\n  rotate(...args) {\n    this.commands.push({ type: 'rotate', args })\n  }\n\n  save(...args) {\n    this.commands.push({ type: 'save', args })\n  }\n\n  setLineDash(...args) {\n    this.commands.push({ type: 'setLineDash', args })\n  }\n\n  setTransform(...args) {\n    this.commands.push({ type: 'setTransform', args })\n  }\n\n  scale(...args) {\n    this.commands.push({ type: 'scale', args })\n  }\n\n  stroke(...args) {\n    this.commands.push({ type: 'stroke', args })\n  }\n\n  strokeRect(...args) {\n    this.commands.push({ type: 'strokeRect', args })\n  }\n\n  strokeText(...args) {\n    this.commands.push({ type: 'strokeText', args })\n  }\n\n  transform(...args) {\n    this.commands.push({ type: 'transform', args })\n  }\n\n  translate(...args) {\n    this.commands.push({ type: 'translate', args })\n  }\n\n  // unsupported\n  //   putImageData(...args)\n  //   createImageData(...args)\n  //   getImageData(...args)\n  //   getLineDash(...args)\n  //   getTransform(...args)\n}\n\nclass PonyfillOffscreenCanvas {\n  constructor(width, height) {\n    this.width = width\n    this.height = height\n  }\n\n  getContext(type) {\n    if (type !== '2d') throw new Error(`unknown type ${type}`)\n    this.context = new PonyfillOffscreenContext()\n    return this.context\n  }\n}\n// Electron serializes everything to JSON through the IPC boundary, so we just\n// send the dataURL\nif (isElectron) {\n  createCanvas = (width, height) => {\n    const canvas = document.createElement('canvas')\n    canvas.width = width\n    canvas.height = height\n    return canvas\n  }\n  createImageBitmap = async (canvas, ...otherargs) => {\n    if (otherargs.length) {\n      throw new Error(\n        'only one-argument uses of createImageBitmap are supported by the node offscreencanvas ponyfill',\n      )\n    }\n    return { dataURL: canvas.toDataURL() }\n  }\n  ImageBitmapType = Image\n} else if (weHave.realOffscreenCanvas) {\n  createCanvas = (width, height) => new OffscreenCanvas(width, height)\n  createImageBitmap = window.createImageBitmap || self.createImageBitmap\n  ImageBitmapType = window.ImageBitmap || self.ImageBitmap\n} else if (weHave.node) {\n  // use node-canvas if we are running in node (i.e. automated tests)\n  const { createCanvas: nodeCreateCanvas, Image } = require('canvas')\n  createCanvas = nodeCreateCanvas\n  createImageBitmap = async (canvas, ...otherargs) => {\n    if (otherargs.length) {\n      throw new Error(\n        'only one-argument uses of createImageBitmap are supported by the node offscreencanvas ponyfill',\n      )\n    }\n    const dataUri = canvas.toDataURL()\n    const img = new Image()\n    return new Promise((resolve, reject) => {\n      img.onload = () => resolve(img)\n      img.onerror = reject\n      img.src = dataUri\n    })\n  }\n  ImageBitmapType = Image\n} else {\n  createCanvas = (width, height) => {\n    return new PonyfillOffscreenCanvas(width, height)\n  }\n  createImageBitmap = canvas => {\n    return canvas.context\n  }\n  ImageBitmapType = typeof 'StringArray'\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport ReactPropTypes from 'prop-types'\nimport React, { useRef, useEffect } from 'react'\nimport { ImageBitmapType } from '../util/offscreenCanvasPonyfill'\n\nfunction PrerenderedCanvas(props: {\n  width: number\n  height: number\n  highResolutionScaling: number\n  style: any\n  imageData: any\n  showSoftClip?: boolean\n}) {\n  const {\n    width,\n    height,\n    highResolutionScaling,\n    style,\n    imageData,\n    showSoftClip,\n  } = props\n  const featureCanvas = useRef<HTMLCanvasElement>(null)\n\n  useEffect(() => {\n    if (!imageData) return\n    const canvas = featureCanvas.current\n    if (!canvas) return\n    const context = canvas.getContext('2d')\n    if (!context) return\n    if (imageData.commands) {\n      imageData.commands.forEach((command: any) => {\n        if (command.type === 'strokeStyle') {\n          context.strokeStyle = command.style\n        } else if (command.type === 'fillStyle') {\n          context.fillStyle = command.style\n        } else if (command.type === 'font') {\n          context.font = command.style\n        } else {\n          // @ts-ignore\n          context[command.type](...command.args)\n        }\n      })\n    } else if (imageData instanceof ImageBitmapType) {\n      context.drawImage(imageData, 0, 0)\n    } else if (imageData.dataURL) {\n      const img = new Image()\n      img.onload = () => context.drawImage(img, 0, 0)\n      img.src = imageData.dataURL\n    }\n  }, [imageData])\n\n  const softClipString = showSoftClip ? '_softclipped' : ''\n  return (\n    <canvas\n      data-testid={`prerendered_canvas${softClipString}`}\n      ref={featureCanvas}\n      width={width * highResolutionScaling}\n      height={height * highResolutionScaling}\n      style={{ width, height, ...style }}\n    />\n  )\n}\n\nPrerenderedCanvas.propTypes = {\n  height: ReactPropTypes.number.isRequired,\n  width: ReactPropTypes.number.isRequired,\n  highResolutionScaling: ReactPropTypes.number,\n  style: ReactPropTypes.objectOf(ReactPropTypes.any),\n  imageData: ReactPropTypes.any,\n  // config: ReactPropTypes.objectOf(ReactPropTypes.any),\n}\nPrerenderedCanvas.defaultProps = {\n  imageData: undefined,\n  highResolutionScaling: 1,\n  style: {},\n  // config: {},\n}\n\nexport default PrerenderedCanvas\n","import Card from '@material-ui/core/Card'\nimport CardMedia from '@material-ui/core/CardMedia'\nimport Container from '@material-ui/core/Container'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Typography from '@material-ui/core/Typography'\nimport { PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React, { useState } from 'react'\nimport emptyIcon from './emptyIcon.png'\nimport linearGenomeViewIcon from './linearGenomeViewIcon.png'\nimport svInspectorIcon from './svInspectorIcon.png'\n\nconst useStyles = makeStyles(theme => ({\n  card: {\n    width: 200,\n    height: 150,\n    cursor: 'pointer',\n  },\n  name: {\n    marginTop: theme.spacing(),\n    textAlign: 'center',\n    maxWidth: 200,\n  },\n  media: {\n    height: 150,\n  },\n}))\n\nfunction NewSessionCard({ name, onClick, image }) {\n  const classes = useStyles()\n  const [hovered, setHovered] = useState(false)\n  return (\n    <Container>\n      <Card\n        className={classes.card}\n        onMouseOver={() => setHovered(true)}\n        onMouseOut={() => setHovered(false)}\n        onClick={onClick}\n        raised={Boolean(hovered)}\n      >\n        <CardMedia className={classes.media} image={image} />\n      </Card>\n      <Typography variant=\"subtitle2\" className={classes.name}>\n        {name}\n      </Typography>\n    </Container>\n  )\n}\n\nNewSessionCard.propTypes = {\n  name: PropTypes.string.isRequired,\n  onClick: PropTypes.func,\n  image: PropTypes.string.isRequired,\n  style: PropTypes.shape({}),\n}\n\nNewSessionCard.defaultProps = {\n  onClick: () => {},\n  style: {},\n}\n\nconst emptySessionSnapshot = {\n  name: `New session ${new Date().toLocaleString()}`,\n  connections: {},\n}\n\nexport function NewEmptySession({ root }) {\n  function onClick() {\n    root.activateSession(emptySessionSnapshot)\n  }\n  return <NewSessionCard name=\"Empty\" onClick={onClick} image={emptyIcon} />\n}\n\nNewEmptySession.propTypes = {\n  root: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n\nexport function ProceedEmptySession({ root }) {\n  function onClick() {\n    const snapshot = {\n      ...emptySessionSnapshot,\n      name: `New session ${new Date().toLocaleString()}`,\n      views: [],\n    }\n    root.setSession(snapshot)\n  }\n  return <NewSessionCard name=\"Empty\" onClick={onClick} image={emptyIcon} />\n}\nProceedEmptySession.propTypes = {\n  root: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n\nexport function AddLinearGenomeViewToSession({ root }) {\n  const launchLGV = () => {\n    const snapshot = {\n      ...emptySessionSnapshot,\n      name: `New session ${new Date().toLocaleString()}`,\n      views: [{ type: 'LinearGenomeView' }],\n    }\n    root.setSession(snapshot)\n  }\n\n  return (\n    <NewSessionCard\n      name=\"Linear Genome View\"\n      onClick={launchLGV}\n      image={linearGenomeViewIcon}\n    />\n  )\n}\nAddLinearGenomeViewToSession.propTypes = {\n  root: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n\nexport function NewLinearGenomeViewSession({ root }) {\n  const launchLGVSession = () => {\n    const snapshot = {\n      ...emptySessionSnapshot,\n      name: `New session ${new Date().toLocaleString()}`,\n      views: [{ type: 'LinearGenomeView' }],\n    }\n    root.activateSession(snapshot)\n  }\n\n  return (\n    <NewSessionCard\n      name=\"Linear Genome View\"\n      onClick={launchLGVSession}\n      image={linearGenomeViewIcon}\n    />\n  )\n}\n\nNewLinearGenomeViewSession.propTypes = {\n  root: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n\nexport function NewSVInspectorSession({ root }) {\n  const launchSVSession = () => {\n    const snapshot = {\n      ...emptySessionSnapshot,\n      name: `New session ${new Date().toLocaleString()}`,\n      views: [\n        {\n          type: 'SvInspectorView',\n        },\n      ],\n    }\n    root.activateSession(snapshot)\n  }\n  return (\n    <NewSessionCard\n      name=\"Structural Variant Inspector\"\n      onClick={launchSVSession}\n      style={{ padding: 0 }}\n      image={svInspectorIcon}\n    />\n  )\n}\n\nNewSVInspectorSession.propTypes = {\n  root: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n\nexport function AddSVInspectorToSession({ root }) {\n  const launchSVSession = () => {\n    const snapshot = {\n      ...emptySessionSnapshot,\n      name: `New session ${new Date().toLocaleString()}`,\n      views: [{ type: 'SvInspectorView' }],\n    }\n    root.setSession(snapshot)\n  }\n  return (\n    <NewSessionCard\n      name=\"Structural Variant Inspector\"\n      onClick={launchSVSession}\n      style={{ padding: 0 }}\n      image={svInspectorIcon}\n    />\n  )\n}\n\nAddSVInspectorToSession.propTypes = {\n  root: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n","import Card from '@material-ui/core/Card'\nimport CardHeader from '@material-ui/core/CardHeader'\nimport CardMedia from '@material-ui/core/CardMedia'\nimport IconButton from '@material-ui/core/IconButton'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport Menu from '@material-ui/core/Menu'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport Typography from '@material-ui/core/Typography'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport MoreVertIcon from '@material-ui/icons/MoreVert'\nimport TextFieldsIcon from '@material-ui/icons/TextFields'\nimport PropTypes from 'prop-types'\nimport React, { useState } from 'react'\n\nconst useStyles = makeStyles({\n  card: {\n    width: 250,\n    cursor: 'pointer',\n  },\n  cardHeader: {\n    width: 200,\n  },\n  media: {\n    height: 0,\n    paddingTop: '56.25%', // 16:9\n  },\n})\n\nfunction RecentSessionCard({\n  sessionName,\n  sessionStats,\n  sessionScreenshot,\n  onClick,\n  onDelete,\n  onRename,\n}) {\n  const classes = useStyles()\n  const [hovered, setHovered] = useState(false)\n  const [menuAnchorEl, setMenuAnchorEl] = useState(null)\n\n  function onMenuClick(event) {\n    event.stopPropagation()\n    setMenuAnchorEl(event.currentTarget)\n  }\n\n  const handleMenuClose = action => {\n    setMenuAnchorEl(null)\n    if (action === 'delete') return onDelete(sessionName)\n    if (action === 'rename') return onRename(sessionName)\n    return undefined\n  }\n\n  return (\n    <>\n      <Card\n        className={classes.card}\n        onMouseOver={() => setHovered(true)}\n        onMouseOut={() => setHovered(false)}\n        onClick={() => onClick(sessionName)}\n        raised={Boolean(hovered)}\n      >\n        <CardMedia className={classes.media} image={sessionScreenshot} />\n        <CardHeader\n          action={\n            <IconButton onClick={onMenuClick}>\n              <MoreVertIcon color=\"secondary\" />\n            </IconButton>\n          }\n          disableTypography\n          title={\n            <Tooltip title={sessionName} enterDelay={300}>\n              <Typography variant=\"body2\" noWrap style={{ width: 178 }}>\n                {sessionName}\n              </Typography>\n            </Tooltip>\n          }\n          subheader={\n            <Typography\n              variant=\"body2\"\n              color=\"textSecondary\"\n              noWrap\n              style={{ width: 178 }}\n            >\n              Last modified{' '}\n              {new Date(sessionStats.mtimeMs).toLocaleDateString(undefined, {\n                dateStyle: 'medium',\n              })}\n            </Typography>\n          }\n        />\n      </Card>\n      <Menu\n        id=\"simple-menu\"\n        anchorEl={menuAnchorEl}\n        keepMounted\n        open={Boolean(menuAnchorEl)}\n        onClose={handleMenuClose}\n      >\n        <MenuItem onClick={() => handleMenuClose('rename')}>\n          <ListItemIcon>\n            <TextFieldsIcon color=\"secondary\" />\n          </ListItemIcon>\n          <Typography variant=\"inherit\">Rename</Typography>\n        </MenuItem>\n        <MenuItem onClick={() => handleMenuClose('delete')}>\n          <ListItemIcon>\n            <DeleteIcon color=\"secondary\" />\n          </ListItemIcon>\n          <Typography variant=\"inherit\">Delete</Typography>\n        </MenuItem>\n      </Menu>\n    </>\n  )\n}\n\nRecentSessionCard.propTypes = {\n  sessionName: PropTypes.string.isRequired,\n  sessionStats: PropTypes.shape({ mtimeMs: PropTypes.number }).isRequired,\n  sessionScreenshot: PropTypes.string,\n  onClick: PropTypes.func.isRequired,\n  onDelete: PropTypes.func.isRequired,\n  onRename: PropTypes.func.isRequired,\n}\n\nRecentSessionCard.defaultProps = {\n  sessionScreenshot:\n    'data:image/png;base64,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',\n}\n\nexport default RecentSessionCard\n","import Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport React from 'react'\n\nexport default ({\n  onClose,\n  open,\n  onFactoryReset,\n}: {\n  onClose: Function\n  open: boolean\n  onFactoryReset: Function\n}) => {\n  function handleDialogClose(action?: string) {\n    if (action === 'reset') {\n      onFactoryReset()\n    }\n    onClose()\n  }\n\n  return (\n    <Dialog open={open} onClose={() => handleDialogClose()}>\n      <DialogTitle id=\"alert-dialog-title\">Reset</DialogTitle>\n      <DialogContent>\n        <DialogContentText id=\"alert-dialog-description\">\n          Are you sure you want to reset? This will restore the default\n          configuration.\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => handleDialogClose()} color=\"primary\">\n          Cancel\n        </Button>\n        <Button\n          onClick={() => handleDialogClose('reset')}\n          color=\"primary\"\n          variant=\"contained\"\n        >\n          OK\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport Button from '@material-ui/core/Button'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport Container from '@material-ui/core/Container'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Grid from '@material-ui/core/Grid'\nimport WarningIcon from '@material-ui/icons/Warning'\nimport SettingsIcon from '@material-ui/icons/Settings'\nimport IconButton from '@material-ui/core/IconButton'\nimport Input from '@material-ui/core/Input'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport ListSubheader from '@material-ui/core/ListSubheader'\nimport Menu from '@material-ui/core/Menu'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Typography from '@material-ui/core/Typography'\nimport { PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React, { useEffect, useState } from 'react'\nimport { LogoFull } from './Logo'\nimport { inDevelopment } from '../util'\nimport {\n  NewEmptySession,\n  NewLinearGenomeViewSession,\n  NewSVInspectorSession,\n} from './NewSessionCards'\nimport RecentSessionCard from './RecentSessionCard'\nimport FactoryResetDialog from './FactoryResetDialog'\n\nconst blankIpc = { invoke: () => {} }\nconst useStyles = makeStyles(theme => ({\n  newSession: {\n    backgroundColor: theme.palette.grey['300'],\n    padding: theme.spacing(2),\n    marginTop: theme.spacing(6),\n  },\n  header: {\n    margin: theme.spacing(2),\n  },\n  settings: {\n    float: 'right',\n  },\n}))\n\nconst DeleteSessionDialog = ({\n  sessionToDelete,\n  onClose,\n}: {\n  sessionToDelete?: string\n  onClose: (arg0: boolean) => void\n}) => {\n  const ipcRenderer = window.electronBetterIpc.ipcRenderer || blankIpc\n  const [deleteSession, setDeleteSession] = useState(false)\n  useEffect(() => {\n    ;(async () => {\n      try {\n        if (deleteSession) {\n          setDeleteSession(false)\n          await ipcRenderer.invoke('deleteSession', sessionToDelete)\n          onClose(true)\n        }\n      } catch (e) {\n        setDeleteSession(() => {\n          throw e\n        })\n      }\n    })()\n  }, [deleteSession, ipcRenderer, onClose, sessionToDelete])\n\n  return (\n    <Dialog open={!!sessionToDelete} onClose={() => onClose(false)}>\n      <DialogTitle id=\"alert-dialog-title\">\n        {`Delete session \"${sessionToDelete}\"?`}\n      </DialogTitle>\n      <DialogContent>\n        <DialogContentText id=\"alert-dialog-description\">\n          This action cannot be undone\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => onClose(false)} color=\"primary\">\n          Cancel\n        </Button>\n        <Button\n          onClick={() => {\n            setDeleteSession(true)\n          }}\n          color=\"primary\"\n          variant=\"contained\"\n          autoFocus\n        >\n          Delete\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nconst RenameSessionDialog = ({\n  sessionNames,\n  sessionToRename,\n  onClose,\n}: {\n  sessionNames: string[]\n  sessionToRename?: string\n  onClose: (arg0: boolean) => void\n}) => {\n  const ipcRenderer = window.electronBetterIpc.ipcRenderer || blankIpc\n  const [newSessionName, setNewSessionName] = useState('')\n  const [renameSession, setRenameSession] = useState(false)\n  useEffect(() => {\n    ;(async () => {\n      try {\n        if (renameSession) {\n          setRenameSession(false)\n          await ipcRenderer.invoke(\n            'renameSession',\n            sessionToRename,\n            newSessionName,\n          )\n          onClose(true)\n        }\n      } catch (e) {\n        setRenameSession(() => {\n          throw e\n        })\n      }\n    })()\n  }, [ipcRenderer, newSessionName, onClose, renameSession, sessionToRename])\n\n  return (\n    <Dialog open={!!sessionToRename} onClose={() => onClose(false)}>\n      <DialogTitle id=\"alert-dialog-title\">Rename</DialogTitle>\n      <DialogContent>\n        <DialogContentText id=\"alert-dialog-description\">\n          Please enter a new name for the session:\n        </DialogContentText>\n        {sessionNames.includes(newSessionName) ? (\n          <DialogContentText color=\"error\">\n            There is already a session named &quot;{newSessionName}&quot;\n          </DialogContentText>\n        ) : null}\n        <Input\n          autoFocus\n          defaultValue={sessionToRename}\n          onChange={event => {\n            setNewSessionName(event.target.value)\n          }}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => onClose(false)} color=\"primary\">\n          Cancel\n        </Button>\n        <Button\n          onClick={() => {\n            setRenameSession(true)\n          }}\n          color=\"primary\"\n          variant=\"contained\"\n          disabled={!newSessionName || sessionNames.includes(newSessionName)}\n        >\n          OK\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nexport default function StartScreen({\n  root,\n  bypass,\n  onFactoryReset,\n}: {\n  root: any\n  bypass: boolean\n  onFactoryReset: Function\n}) {\n  const ipcRenderer = window.electronBetterIpc.ipcRenderer || blankIpc\n  const [sessions, setSessions] = useState<Record<string, any> | undefined>()\n  const [sessionToDelete, setSessionToDelete] = useState<string | undefined>()\n  const [sessionToRename, setSessionToRename] = useState<string | undefined>()\n  const [sessionToLoad, setSessionToLoad] = useState<string | undefined>()\n  const [updateSessionsList, setUpdateSessionsList] = useState(true)\n  const [menuAnchorEl, setMenuAnchorEl] = useState<null | HTMLElement>(null)\n  const [reset, setReset] = useState(false)\n  const classes = useStyles()\n\n  const sessionNames = sessions !== undefined ? Object.keys(sessions) : []\n  root.setSavedSessionNames(sessionNames)\n\n  const sortedSessions = sessions\n    ? Object.entries(sessions)\n        .filter(([, sessionData]: [unknown, any]) => sessionData.stats)\n        .sort((a: any, b: any) => b[1].stats.mtimeMs - a[1].stats.mtimeMs)\n    : []\n\n  useEffect(() => {\n    ;(async () => {\n      try {\n        const load =\n          bypass && inDevelopment && sortedSessions.length\n            ? sortedSessions[0][0]\n            : sessionToLoad\n        if (load) {\n          root.activateSession(\n            JSON.parse(await ipcRenderer.invoke('loadSession', load)),\n          )\n        }\n      } catch (e) {\n        setSessions(() => {\n          throw e\n        })\n      }\n    })()\n  }, [bypass, ipcRenderer, root, sessionToLoad, sortedSessions])\n\n  useEffect(() => {\n    ;(async () => {\n      try {\n        if (updateSessionsList) {\n          setUpdateSessionsList(false)\n          setSessions(await ipcRenderer.invoke('listSessions'))\n        }\n      } catch (e) {\n        setSessions(() => {\n          throw e\n        })\n      }\n    })()\n  }, [ipcRenderer, updateSessionsList])\n\n  if (!sessions)\n    return (\n      <CircularProgress\n        style={{\n          position: 'fixed',\n          top: '50%',\n          left: '50%',\n          marginTop: -25,\n          marginLeft: -25,\n        }}\n        size={50}\n      />\n    )\n\n  return (\n    <>\n      <FactoryResetDialog\n        open={reset}\n        onFactoryReset={onFactoryReset}\n        onClose={() => {\n          setReset(false)\n        }}\n      />\n      <RenameSessionDialog\n        sessionToRename={sessionToRename}\n        sessionNames={sessionNames}\n        onClose={(update: boolean) => {\n          setSessionToRename(undefined)\n          setUpdateSessionsList(update)\n        }}\n      />\n      <DeleteSessionDialog\n        sessionToDelete={sessionToDelete}\n        onClose={update => {\n          setSessionToDelete(undefined)\n          setUpdateSessionsList(update)\n        }}\n      />\n      <IconButton\n        className={classes.settings}\n        onClick={event => {\n          event.stopPropagation()\n          setMenuAnchorEl(event.currentTarget)\n        }}\n      >\n        <SettingsIcon />\n      </IconButton>\n      <Container maxWidth=\"md\">\n        <LogoFull />\n        <div className={classes.newSession}>\n          <Typography variant=\"h5\" className={classes.header}>\n            Start a new session\n          </Typography>\n          <Grid container spacing={4}>\n            <Grid item>\n              <NewEmptySession root={root} />\n            </Grid>\n            <Grid item>\n              <NewLinearGenomeViewSession root={root} />\n            </Grid>\n            <Grid item>\n              <NewSVInspectorSession root={root} />\n            </Grid>\n          </Grid>\n        </div>\n        <Typography variant=\"h5\" className={classes.header}>\n          Recent sessions\n        </Typography>\n        <Grid container spacing={4}>\n          {sortedSessions\n            ? sortedSessions.map(\n                ([sessionName, sessionData]: [string, any]) => (\n                  <Grid item key={sessionName}>\n                    <RecentSessionCard\n                      sessionName={sessionName}\n                      sessionStats={sessionData.stats}\n                      sessionScreenshot={sessionData.screenshot}\n                      onClick={() => {\n                        setSessionToLoad(sessionName)\n                      }}\n                      onDelete={() => {\n                        setSessionToDelete(sessionName)\n                      }}\n                      onRename={() => {\n                        setSessionToRename(sessionName)\n                      }}\n                    />\n                  </Grid>\n                ),\n              )\n            : null}\n        </Grid>\n      </Container>\n\n      <Menu\n        id=\"simple-menu\"\n        anchorEl={menuAnchorEl}\n        keepMounted\n        open={Boolean(menuAnchorEl)}\n        onClose={() => {\n          setMenuAnchorEl(null)\n        }}\n      >\n        <ListSubheader>Advanced Settings</ListSubheader>\n        <MenuItem\n          onClick={() => {\n            setReset(true)\n            setMenuAnchorEl(null)\n          }}\n        >\n          <ListItemIcon>\n            <WarningIcon />\n          </ListItemIcon>\n          <Typography variant=\"inherit\">Factory Reset</Typography>\n        </MenuItem>\n      </Menu>\n    </>\n  )\n}\n\nStartScreen.propTypes = {\n  root: MobxPropTypes.objectOrObservableObject.isRequired,\n  bypass: PropTypes.bool.isRequired,\n}\n","/* eslint-disable react/require-default-props */\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport React, { useEffect, useState } from 'react'\nimport ReactPropTypes from 'prop-types'\nimport { Feature } from '../util/simpleFeature'\nimport { readConfObject } from '../configuration'\nimport { AnyConfigurationModel } from '../configuration/configurationSchema'\n\nconst useStyles = makeStyles({\n  hoverLabel: {\n    border: '1px solid black',\n    position: 'absolute',\n    background: '#fffa',\n    pointerEvents: 'none',\n    zIndex: 10000,\n  },\n})\n\nconst Tooltip = ({\n  offsetX,\n  offsetY,\n  configuration,\n  feature,\n  timeout = 300,\n}: {\n  offsetX: number\n  offsetY: number\n  configuration: AnyConfigurationModel\n  feature?: Feature\n  timeout?: number\n}) => {\n  const classes = useStyles()\n  // only show the loading message after 400ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  useEffect(() => {\n    const handle = setTimeout(() => setShown(true), timeout)\n    return () => clearTimeout(handle)\n  })\n  if (feature && shown) {\n    const text = readConfObject(configuration, 'mouseover', [feature])\n    return (\n      <div\n        className={classes.hoverLabel}\n        style={{ left: offsetX, top: offsetY }}\n      >\n        {text}\n      </div>\n    )\n  }\n  return null\n}\n\nTooltip.propTypes = {\n  configuration: ReactPropTypes.shape({}).isRequired,\n  offsetX: ReactPropTypes.number.isRequired,\n  offsetY: ReactPropTypes.number.isRequired,\n  feature: ReactPropTypes.shape({}),\n  timeout: ReactPropTypes.number,\n}\n\nTooltip.defaultProps = {\n  feature: undefined,\n}\n\nexport default observer(Tooltip)\n","import Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport PropTypes from 'prop-types'\nimport React, { useState } from 'react'\nimport FactoryResetDialog from './FactoryResetDialog'\n\nconst ResetComponent = ({\n  onFactoryReset,\n  resetButtonText,\n}: {\n  onFactoryReset: Function\n  resetButtonText: string\n}) => {\n  const [dialogOpen, setDialogOpen] = useState(false)\n\n  return (\n    <>\n      <Button\n        data-testid=\"fatal-error\"\n        color=\"primary\"\n        variant=\"contained\"\n        onClick={() => setDialogOpen(true)}\n      >\n        {resetButtonText}\n      </Button>\n      <FactoryResetDialog\n        onClose={() => setDialogOpen(false)}\n        open={dialogOpen}\n        onFactoryReset={onFactoryReset}\n      />\n    </>\n  )\n}\nResetComponent.propTypes = {\n  onFactoryReset: PropTypes.func.isRequired,\n  resetButtonText: PropTypes.string.isRequired,\n}\n\nconst FatalErrorDialog = ({\n  componentStack,\n  error,\n  onFactoryReset,\n  resetButtonText,\n}: {\n  componentStack: string\n  error: Error\n  onFactoryReset: Function\n  resetButtonText: string\n}) => {\n  return (\n    <Dialog open>\n      <DialogTitle style={{ backgroundColor: '#e88' }}>Fatal error</DialogTitle>\n      <DialogContent>\n        <pre>\n          {error.toString()}\n          {componentStack}\n        </pre>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          color=\"secondary\"\n          variant=\"contained\"\n          onClick={() => window.location.reload()}\n        >\n          Refresh\n        </Button>\n        <ResetComponent\n          onFactoryReset={onFactoryReset}\n          resetButtonText={resetButtonText}\n        />\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nFatalErrorDialog.propTypes = {\n  componentStack: PropTypes.string,\n  error: PropTypes.shape({}),\n  onFactoryReset: PropTypes.func.isRequired,\n  resetButtonText: PropTypes.string,\n}\n\nFatalErrorDialog.defaultProps = {\n  error: { message: 'No error message provided' },\n  componentStack: '',\n  resetButtonText: 'Factory Reset',\n}\n\nexport default FatalErrorDialog\n","import { ThemeProvider } from '@material-ui/core/styles'\nimport { renderToString } from 'react-dom/server'\nimport React from 'react'\nimport { filter, ignoreElements, tap } from 'rxjs/operators'\nimport {\n  SnapshotOrInstance,\n  SnapshotIn,\n  getSnapshot,\n  isStateTreeNode,\n} from 'mobx-state-tree'\nimport { BaseFeatureDataAdapter } from '../../data_adapters/BaseAdapter'\nimport { Region } from '../../util/types'\nimport { checkAbortSignal, iterMap } from '../../util'\nimport SimpleFeature, {\n  Feature,\n  SimpleFeatureSerialized,\n} from '../../util/simpleFeature'\nimport RendererType from './RendererType'\nimport SerializableFilterChain, {\n  SerializedFilterChain,\n} from './util/serializableFilterChain'\nimport { AnyConfigurationModel } from '../../configuration/configurationSchema'\nimport RpcManager from '../../rpc/RpcManager'\nimport { createJBrowseTheme } from '../../ui'\n\ninterface BaseRenderArgs {\n  blockKey: string\n  sessionId: string\n  signal?: AbortSignal\n  dataAdapter: BaseFeatureDataAdapter\n  sortObject?: {\n    position: number\n    by: string\n  }\n  bpPerPx: number\n  renderProps: {\n    displayModel: { id: string; selectedFeatureId?: string }\n    blockKey: string\n  }\n  regions: Region[]\n}\n\nexport interface RenderArgs extends BaseRenderArgs {\n  config: SnapshotOrInstance<AnyConfigurationModel>\n  filters: SerializableFilterChain\n}\n\nexport interface RenderArgsSerialized extends BaseRenderArgs {\n  statusCallback?: Function\n  config: SnapshotIn<AnyConfigurationModel>\n  filters: SerializedFilterChain\n}\nexport interface RenderArgsDeserialized extends BaseRenderArgs {\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n}\n\nexport interface RenderResults {\n  html: string\n}\nexport interface ResultsSerialized extends RenderResults {\n  features: SimpleFeatureSerialized[]\n}\n\nexport interface ResultsDeserialized {\n  html: string\n  blockKey: string\n  features: Map<string, Feature>\n}\n\nexport default class ServerSideRenderer extends RendererType {\n  /**\n   * directly modifies the render arguments to prepare\n   * them to be serialized and sent to the worker.\n   *\n   * the base class replaces the `renderProps.displayModel` param\n   * (which on the client is a MST model) with a stub\n   * that only contains the `selectedFeature`, since\n   * this is the only part of the track model that most\n   * renderers read.\n   *\n   * @param args - the arguments passed to render\n   * @returns the same object\n   */\n  serializeArgsInClient(args: RenderArgs): RenderArgsSerialized {\n    const { displayModel } = args.renderProps\n    if (displayModel) {\n      args.renderProps = {\n        ...args.renderProps,\n        blockKey: args.blockKey,\n        displayModel: {\n          id: displayModel.id,\n          selectedFeatureId: displayModel.selectedFeatureId,\n        },\n      }\n    }\n    return {\n      ...args,\n      config: isStateTreeNode(args.config)\n        ? getSnapshot(args.config)\n        : args.config,\n      regions: JSON.parse(JSON.stringify(args.regions)),\n      filters: args.filters ? args.filters.toJSON().filters : [],\n    }\n  }\n\n  deserializeResultsInClient(\n    result: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    // deserialize some of the results that came back from the worker\n    const deserialized = ({ ...result } as unknown) as ResultsDeserialized\n    const featuresMap = new Map<string, SimpleFeature>()\n    result.features.forEach(j => {\n      const f = SimpleFeature.fromJSON(j)\n      featuresMap.set(String(f.id()), f)\n    })\n    deserialized.features = featuresMap\n    deserialized.blockKey = args.blockKey\n    return deserialized\n  }\n\n  /**\n   * modifies the passed arguments object to\n   * inflate arguments as necessary. called in the worker process.\n   * @param args - the converted arguments to modify\n   */\n  deserializeArgsInWorker(args: RenderArgsSerialized): RenderArgsDeserialized {\n    const deserialized = ({ ...args } as unknown) as RenderArgsDeserialized\n    const config = this.configSchema.create(args.config || {})\n    deserialized.config = config\n    deserialized.filters = new SerializableFilterChain({\n      filters: args.filters,\n    })\n\n    return deserialized\n  }\n\n  /**\n   *\n   * @param result - object containing the results of calling the `render` method\n   * @param features - Map of `feature.id() -> feature`\n   * @param args - deserialized render args. unused here, but may be used in\n   * deriving class methods\n   */\n  serializeResultsInWorker(\n    result: { html: string },\n    features: Map<string, Feature>,\n    _args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const serialized = ({ ...result } as unknown) as ResultsSerialized\n    serialized.features = iterMap(features.values(), f => f.toJSON())\n    return serialized\n  }\n\n  /**\n   * Render method called on the client. Serializes args, then\n   * calls `render` with the RPC manager.\n   */\n  async renderInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const serializedArgs = this.serializeArgsInClient(args)\n    const result = await rpcManager.call(\n      args.sessionId,\n      'CoreRender',\n      serializedArgs,\n    )\n    // const result = await renderRegionWithWorker(session, serializedArgs)\n\n    // @ts-ignore\n    const deserialized = this.deserializeResultsInClient(result, args)\n    return deserialized\n  }\n\n  // will expand if soft clipping or feature glyphs are shown\n  getExpandedRegion(region: Region, _renderArgs: RenderArgsDeserialized) {\n    return region\n  }\n\n  /**\n   * use the dataAdapter to fetch the features to be rendered\n   *\n   * @param renderArgs -\n   * @returns Map of features as `{ id => feature, ... }`\n   */\n  async getFeatures(renderArgs: RenderArgsDeserialized) {\n    const { dataAdapter, signal, regions } = renderArgs\n    const features = new Map()\n\n    if (!regions || regions.length === 0) {\n      return features\n    }\n\n    const requestRegions = regions.map((r: Region) => {\n      // make sure the requested region's start and end are integers, if\n      // there is a region specification.\n      const requestRegion = { ...r }\n      if (requestRegion.start) {\n        requestRegion.start = Math.floor(requestRegion.start)\n      }\n      if (requestRegion.end) {\n        requestRegion.end = Math.ceil(requestRegion.end)\n      }\n      return requestRegion\n    })\n\n    const region = requestRegions[0]\n\n    const featureObservable =\n      requestRegions.length === 1\n        ? dataAdapter.getFeatures(\n            this.getExpandedRegion(region, renderArgs),\n            // @ts-ignore\n            renderArgs,\n          )\n        : // @ts-ignore\n          dataAdapter.getFeaturesInMultipleRegions(requestRegions, renderArgs)\n\n    await featureObservable\n      .pipe(\n        tap(() => checkAbortSignal(signal)),\n        filter(feature => this.featurePassesFilters(renderArgs, feature)),\n        tap(feature => {\n          const id = feature.id()\n          if (!id) throw new Error(`invalid feature id \"${id}\"`)\n          features.set(id, feature)\n        }),\n        ignoreElements(),\n      )\n      .toPromise()\n\n    return features\n  }\n\n  /**\n   * @param renderArgs -\n   * @param feature -\n   * @returns true if this feature passes all configured filters\n   */\n  featurePassesFilters(renderArgs: RenderArgsDeserialized, feature: Feature) {\n    if (!renderArgs.filters) return true\n    return renderArgs.filters.passes(feature, renderArgs)\n  }\n\n  // render method called on the worker\n  async renderInWorker(args: RenderArgsSerialized): Promise<ResultsSerialized> {\n    const { signal, statusCallback = () => {} } = args\n    checkAbortSignal(signal)\n    const deserializedArgs = this.deserializeArgsInWorker(args)\n\n    const features = await this.getFeatures(deserializedArgs)\n    checkAbortSignal(signal)\n    statusCallback('Rendering plot')\n    const results = await this.render({ ...deserializedArgs, features })\n    checkAbortSignal(signal)\n    const html = renderToString(\n      React.createElement(\n        ThemeProvider,\n        // @ts-ignore\n        { theme: createJBrowseTheme(args.theme) },\n        results.element,\n      ),\n    )\n    delete results.element\n\n    // serialize the results for passing back to the main thread.\n    // these will be transmitted to the main process, and will come out\n    // as the result of renderRegionWithWorker.\n    statusCallback('Serializing results')\n    const serialized = this.serializeResultsInWorker(\n      { ...results, html },\n      features,\n      deserializedArgs,\n    )\n    statusCallback('')\n    return serialized\n  }\n\n  freeResourcesInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const serializedArgs = this.serializeArgsInClient(args)\n\n    return rpcManager.call(args.sessionId, 'CoreFreeResources', serializedArgs)\n  }\n\n  freeResources(/* args: {} */) {\n    return 0\n  }\n}\n","import ServerSideRenderer from './ServerSideRendererType'\n\nexport default class CircularChordRendererType extends ServerSideRenderer {}\n","import { objectFromEntries } from '../index'\nimport {\n  RectTuple,\n  SerializedLayout,\n  Rectangle,\n  BaseLayout,\n} from './BaseLayout'\n\n/**\n * Rectangle-layout manager that lays out rectangles using bitmaps at\n * resolution that, for efficiency, may be somewhat lower than that of\n * the coordinate system for the rectangles being laid out.  `pitchX`\n * and `pitchY` are the ratios of input scale resolution to internal\n * bitmap resolution.\n */\n\n// minimum excess size of the array at which we garbage collect\nconst minSizeToBotherWith = 10000\nconst maxFeaturePitchWidth = 20000\n\nfunction segmentsIntersect(\n  x1: number,\n  x2: number,\n  y1: number,\n  y2: number,\n): boolean {\n  return x2 >= y1 && y2 >= x1\n}\n\ninterface RowState<T> {\n  min: number\n  max: number\n  offset: number\n  bits: (Record<string, T> | boolean | undefined)[]\n}\n// a single row in the layout\nclass LayoutRow<T> {\n  private padding: number\n\n  private allFilled?: Record<string, T> | boolean\n\n  private widthLimit: number\n\n  private rowState?: RowState<T>\n\n  constructor() {\n    this.padding = 1\n    this.widthLimit = 1000000\n\n    // this.rowState.offset is the offset of the bits array relative to the genomic coordinates\n    //      (modified by pitchX, but we don't know that in this class)\n    // this.rowState.bits is the array of items in the layout row, indexed by (x - this.offset)\n    // this.rowState.min is the leftmost edge of all the rectangles we have in the layout\n    // this.rowState.max is the rightmost edge of all the rectangles we have in the layout\n  }\n\n  // log(msg: string): void {\n  //   // if (this.rowNumber === 0)\n  //   // eslint-disable-next-line no-console\n  //   console.log(`r${this.rowNumber}: ${msg}`)\n  // }\n\n  setAllFilled(data: Record<string, T> | boolean): void {\n    this.allFilled = data\n  }\n\n  getItemAt(x: number): Record<string, T> | boolean | undefined {\n    if (this.allFilled) return this.allFilled\n    if (!this.rowState) return undefined\n\n    if (this.rowState.min === undefined) return undefined\n    if (x < this.rowState.min) return undefined\n    if (x >= this.rowState.max) return undefined\n    const offset = x - this.rowState.offset\n    // if (offset < 0)\n    //     debugger\n    // if (offset >= this.rowState.bits.length)\n    //     debugger\n    return this.rowState.bits[offset]\n  }\n\n  isRangeClear(left: number, right: number): boolean {\n    if (this.allFilled) return false\n\n    if (!this.rowState) return true\n\n    const { min, max } = this.rowState\n\n    if (right <= min || left >= max) return true\n\n    // TODO: check right and middle before looping\n    const maxX = Math.min(max, right)\n    let x = Math.max(min, left)\n    for (; x < right && x < maxX; x += 1) {\n      if (this.getItemAt(x)) {\n        return false\n      }\n    }\n\n    return true\n  }\n\n  initialize(left: number, right: number): RowState<T> {\n    // NOTE: this.rowState.min, this.rowState.max, and this.rowState.offset are interbase coordinates\n    const rectWidth = right - left\n    return {\n      offset: left - rectWidth,\n      min: left,\n      max: right,\n      bits: new Array(3 * rectWidth),\n    }\n    // this.log(`initialize ${this.rowState.min} - ${this.rowState.max} (${this.rowState.bits.length})`)\n  }\n\n  addRect(rect: Rectangle<T>, data: Record<string, T> | boolean): void {\n    const left = rect.l\n    const right = rect.r + this.padding // only padding on the right\n    if (!this.rowState) {\n      this.rowState = this.initialize(left, right)\n    }\n\n    // or check if we need to expand to the left and/or to the right\n\n    let oLeft = left - this.rowState.offset\n    let oRight = right - this.rowState.offset\n    const currLength = this.rowState.bits.length\n    // console.log(oRight, this.rowState.bits.length)\n\n    // expand rightward if necessary\n    if (oRight >= this.rowState.bits.length) {\n      const additionalLength = oRight + 1\n      if (this.rowState.bits.length + additionalLength > this.widthLimit) {\n        console.warn(\n          'Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks.',\n        )\n        this.rowState = this.initialize(left, right)\n      } else if (additionalLength > 0) {\n        this.rowState.bits = this.rowState.bits.concat(\n          new Array(additionalLength),\n        )\n      }\n    }\n\n    // expand leftward if necessary\n    if (left < this.rowState.offset) {\n      // use math.min to avoid negative lengths\n      const additionalLength = Math.min(\n        currLength - oLeft,\n        this.rowState.offset,\n      )\n      if (this.rowState.bits.length + additionalLength > this.widthLimit) {\n        console.warn(\n          'Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks.',\n        )\n\n        this.rowState = this.initialize(left, right)\n      } else {\n        this.rowState.bits = new Array(additionalLength).concat(\n          this.rowState.bits,\n        )\n        this.rowState.offset -= additionalLength\n      }\n    }\n    oRight = right - this.rowState.offset\n    oLeft = left - this.rowState.offset\n\n    // set the bits in the bitmask\n    // if (oLeft < 0) debugger\n    // if (oRight < 0) debugger\n    // if (oRight <= oLeft) debugger\n    // if (oRight > this.rowState.bits.length) debugger\n    if (oRight - oLeft > maxFeaturePitchWidth) {\n      console.warn(\n        `Layout X pitch set too low, feature spans ${\n          oRight - oLeft\n        } bits in a single row.`,\n        rect,\n        data,\n      )\n    }\n\n    for (let x = oLeft; x < oRight; x += 1) {\n      // if (this.rowState.bits[x] && this.rowState.bits[x].get('name') !== data.get('name')) debugger\n      this.rowState.bits[x] = data\n    }\n\n    if (left < this.rowState.min) this.rowState.min = left\n    if (right > this.rowState.max) this.rowState.max = right\n    // // this.log(`added ${leftX} - ${rightX}`)\n  }\n\n  /**\n   *  Given a range of interbase coordinates, deletes all data dealing with that range\n   */\n  discardRange(left: number, right: number): void {\n    if (this.allFilled) return // allFilled is irrevocable currently\n\n    // if we have no data, do nothing\n    if (!this.rowState) return\n\n    // if doesn't overlap at all, do nothing\n    if (right <= this.rowState.min || left >= this.rowState.max) return\n\n    // if completely encloses range, discard everything\n    if (left <= this.rowState.min && right >= this.rowState.max) {\n      this.rowState = undefined\n      return\n    }\n\n    // if overlaps left edge, adjust the min\n    if (right > this.rowState.min && left <= this.rowState.min) {\n      this.rowState.min = right\n    }\n\n    // if overlaps right edge, adjust the max\n    if (left < this.rowState.max && right >= this.rowState.max) {\n      this.rowState.max = left\n    }\n\n    // now trim the left, right, or both sides of the array\n    if (\n      this.rowState.offset < this.rowState.min - minSizeToBotherWith &&\n      this.rowState.bits.length >\n        this.rowState.max + minSizeToBotherWith - this.rowState.offset\n    ) {\n      // trim both sides\n      const leftTrimAmount = this.rowState.min - this.rowState.offset\n      const rightTrimAmount =\n        this.rowState.bits.length -\n        1 -\n        (this.rowState.max - this.rowState.offset)\n      // if (rightTrimAmount <= 0) debugger\n      // if (leftTrimAmount <= 0) debugger\n      // this.log(`trim both sides, ${leftTrimAmount} from left, ${rightTrimAmount} from right`)\n      this.rowState.bits = this.rowState.bits.slice(\n        leftTrimAmount,\n        this.rowState.bits.length - rightTrimAmount,\n      )\n      this.rowState.offset += leftTrimAmount\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    } else if (this.rowState.offset < this.rowState.min - minSizeToBotherWith) {\n      // trim left side\n      const desiredOffset =\n        this.rowState.min - Math.floor(minSizeToBotherWith / 2)\n      const trimAmount = desiredOffset - this.rowState.offset\n      // this.log(`trim left side by ${trimAmount}`)\n      this.rowState.bits.splice(0, trimAmount)\n      this.rowState.offset += trimAmount\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    } else if (\n      this.rowState.bits.length >\n      this.rowState.max - this.rowState.offset + minSizeToBotherWith\n    ) {\n      // trim right side\n      const desiredLength =\n        this.rowState.max -\n        this.rowState.offset +\n        1 +\n        Math.floor(minSizeToBotherWith / 2)\n      // this.log(`trim right side by ${this.rowState.bits.length-desiredLength}`)\n      // if (desiredLength > this.rowState.bits.length) debugger\n      this.rowState.bits.length = desiredLength\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    }\n\n    // if (this.rowState.offset > this.rowState.min) debugger\n    // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n\n    // if range now enclosed in the new bounds, loop through and clear the bits\n    const oLeft = Math.max(this.rowState.min, left) - this.rowState.offset\n    // if (oLeft < 0) debugger\n    // if (oLeft >= this.rowState.bits.length) debugger\n    // if (oRight < 0) debugger\n    // if (oRight >= this.rowState.bits.length) debugger\n\n    const oRight = Math.min(right, this.rowState.max) - this.rowState.offset\n    for (let x = oLeft; x >= 0 && x < oRight; x += 1) {\n      this.rowState.bits[x] = undefined\n    }\n  }\n}\n\nexport default class GranularRectLayout<T> implements BaseLayout<T> {\n  private pitchX: number\n\n  private pitchY: number\n\n  private hardRowLimit: number\n\n  private bitmap: LayoutRow<T>[]\n\n  private rectangles: Map<string, Rectangle<T>>\n\n  public maxHeightReached: boolean\n\n  private maxHeight: number\n\n  private displayMode: string\n\n  private pTotalHeight: number\n\n  constructor({\n    pitchX = 10,\n    pitchY = 10,\n    maxHeight = 10000,\n    hardRowLimit = 3000,\n    displayMode = 'normal',\n  }: {\n    /** layout grid pitch in the X direction */\n    pitchX?: number\n    /** layout grid pitch in the Y direction */\n    pitchY?: number\n    /** maximum layout height, default Infinity (no max) */\n    maxHeight?: number\n    displayMode?: string\n    hardRowLimit?: number\n  } = {}) {\n    this.pitchX = pitchX\n    this.pitchY = pitchY\n    this.hardRowLimit = hardRowLimit\n    this.maxHeightReached = false\n    this.displayMode = displayMode\n\n    // reduce the pitchY to try and pack the features tighter\n    if (this.displayMode === 'compact') {\n      this.pitchY = Math.round(this.pitchY / 4) || 1\n      this.pitchX = Math.round(this.pitchX / 4) || 1\n    }\n\n    this.bitmap = []\n    this.rectangles = new Map()\n    this.maxHeight = Math.ceil(maxHeight / this.pitchY)\n    this.pTotalHeight = 0 // total height, in units of bitmap squares (px/pitchY)\n  }\n\n  /**\n   * @returns top position for the rect, or Null if laying\n   *  out the rect would exceed maxHeight\n   */\n  addRect(\n    id: string,\n    left: number,\n    right: number,\n    height: number,\n    data?: Record<string, T>,\n  ): number | null {\n    // if we have already laid it out, return its layout\n    // console.log(`${this.id} add ${id}`)\n    const storedRec = this.rectangles.get(id)\n    if (storedRec) {\n      if (storedRec.top === null) return null\n\n      // add it to the bitmap again, since that bitmap range may have been discarded\n      this.addRectToBitmap(storedRec)\n      return storedRec.top * this.pitchY\n    }\n\n    const pLeft = Math.floor(left / this.pitchX)\n    const pRight = Math.floor(right / this.pitchX)\n    const pHeight = Math.ceil(height / this.pitchY)\n\n    // const midX = Math.floor((pLeft + pRight) / 2)\n    const rectangle: Rectangle<T> = {\n      id,\n      l: pLeft,\n      r: pRight,\n      top: null,\n      // mX: midX,\n      h: pHeight,\n      originalHeight: height,\n      data,\n    }\n\n    const maxTop = this.maxHeight - pHeight\n    let top = 0\n    if (this.displayMode !== 'collapse') {\n      for (; top <= maxTop; top += 1) {\n        if (!this.collides(rectangle, top)) break\n      }\n\n      if (top > maxTop) {\n        rectangle.top = null\n        this.rectangles.set(id, rectangle)\n        this.maxHeightReached = true\n        return null\n      }\n    }\n    rectangle.top = top\n    this.addRectToBitmap(rectangle)\n    this.rectangles.set(id, rectangle)\n    this.pTotalHeight = Math.max(this.pTotalHeight || 0, top + pHeight)\n    // console.log(`G2 ${data.get('name')} ${top}`)\n    return top * this.pitchY\n  }\n\n  collides(rect: Rectangle<T>, top: number): boolean {\n    const { bitmap } = this\n    // var mY = top + rect.h/2; // Y midpoint: ( top+height  + top ) / 2\n\n    // test exhaustively\n    const maxY = top + rect.h\n    for (let y = top; y < maxY; y += 1) {\n      const row = bitmap[y]\n      if (row && !row.isRangeClear(rect.l, rect.r)) {\n        return true\n      }\n    }\n\n    return false\n  }\n\n  /**\n   * make a subarray if it does not exist\n   */\n  private autovivifyRow(bitmap: LayoutRow<T>[], y: number): LayoutRow<T> {\n    let row = bitmap[y]\n    if (!row) {\n      if (y > this.hardRowLimit) {\n        throw new Error(\n          `layout hard limit (${\n            this.hardRowLimit * this.pitchY\n          }px) exceeded, aborting layout`,\n        )\n      }\n      row = new LayoutRow()\n      bitmap[y] = row\n    }\n    return row\n  }\n\n  addRectToBitmap(rect: Rectangle<T>): void {\n    if (rect.top === null) return\n\n    const data = rect.data || true\n    const { bitmap } = this\n    const yEnd = rect.top + rect.h\n    if (rect.r - rect.l > maxFeaturePitchWidth) {\n      // the rect is very big in relation to the view size, just\n      // pretend, for the purposes of layout, that it extends\n      // infinitely.  this will cause weird layout if a user\n      // scrolls manually for a very, very long time along the\n      // genome at the same zoom level.  but most users will not\n      // do that.  hopefully.\n      for (let y = rect.top; y < yEnd; y += 1) {\n        this.autovivifyRow(bitmap, y).setAllFilled(data)\n      }\n    } else {\n      for (let y = rect.top; y < yEnd; y += 1) {\n        this.autovivifyRow(bitmap, y).addRect(rect, data)\n      }\n    }\n  }\n\n  /**\n   *  Given a range of X coordinates, deletes all data dealing with\n   *  the features.\n   */\n  discardRange(left: number, right: number): void {\n    // console.log( 'discard', left, right );\n    const pLeft = Math.floor(left / this.pitchX)\n    const pRight = Math.floor(right / this.pitchX)\n    const { bitmap } = this\n    for (let y = 0; y < bitmap.length; y += 1) {\n      const row = bitmap[y]\n      if (row) row.discardRange(pLeft, pRight)\n    }\n  }\n\n  hasSeen(id: string): boolean {\n    return this.rectangles.has(id)\n  }\n\n  getByCoord(x: number, y: number): Record<string, T> | boolean | undefined {\n    const pY = Math.floor(y / this.pitchY)\n    const row = this.bitmap[pY]\n    if (!row) return undefined\n    const pX = Math.floor(x / this.pitchX)\n    return row.getItemAt(pX)\n  }\n\n  getByID(id: string): (Record<string, T> | boolean) | undefined {\n    const r = this.rectangles.get(id)\n    if (r) {\n      return r.data || true\n    }\n    return undefined\n  }\n\n  cleanup(): void {}\n\n  getTotalHeight(): number {\n    return this.pTotalHeight * this.pitchY\n  }\n\n  getRectangles(): Map<string, RectTuple> {\n    return new Map(\n      Array.from(this.rectangles.entries()).map(([id, rect]) => {\n        const { l, r, originalHeight, top } = rect\n        const t = (top || 0) * this.pitchY\n        const b = t + originalHeight\n        return [id, [l * this.pitchX, t, r * this.pitchX, b]] // left, top, right, bottom\n      }),\n    )\n  }\n\n  serializeRegion(region: { start: number; end: number }): SerializedLayout {\n    const regionRectangles: { [key: string]: RectTuple } = {}\n    let maxHeightReached = false\n    for (const [id, rect] of this.rectangles.entries()) {\n      const { l, r, originalHeight, top } = rect\n      if (rect.top === null) {\n        maxHeightReached = true\n      } else {\n        const t = (top || 0) * this.pitchY\n        const b = t + originalHeight\n        const y1 = l * this.pitchX\n        const y2 = r * this.pitchX\n        const x1 = region.start\n        const x2 = region.end\n        // add +/- pitchX to avoid resolution causing errors\n        if (segmentsIntersect(x1, x2, y1 - this.pitchX, y2 + this.pitchX)) {\n          regionRectangles[id] = [y1, t, y2, b]\n        }\n      }\n    }\n    return {\n      rectangles: regionRectangles,\n      totalHeight: this.getTotalHeight(),\n      maxHeightReached,\n    }\n  }\n\n  toJSON(): SerializedLayout {\n    const rectangles = objectFromEntries(this.getRectangles())\n    return {\n      rectangles,\n      totalHeight: this.getTotalHeight(),\n      maxHeightReached: this.maxHeightReached,\n    }\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { BaseLayout, SerializedLayout } from './BaseLayout'\n\nexport default class MultiLayout<SUB_LAYOUT_CLASS extends BaseLayout<T>, T> {\n  subLayouts: Map<string, SUB_LAYOUT_CLASS> = new Map()\n\n  SubLayoutClass: new (...args: any[]) => SUB_LAYOUT_CLASS\n\n  subLayoutConstructorArgs: Record<string, any> = {}\n\n  /**\n   * layout class that just keeps a number of named sub-layouts.\n   * basically just a fancier\n   * `{ layout1: new GranularRectLayout(), layout2: new GranularRectLayout() ...}`\n   */\n  constructor(\n    SubLayoutClass: new (...args: any[]) => SUB_LAYOUT_CLASS,\n    layoutArgs: Record<string, any> = {},\n  ) {\n    this.subLayouts = new Map()\n    this.SubLayoutClass = SubLayoutClass\n    this.subLayoutConstructorArgs = layoutArgs\n  }\n\n  getSublayout(layoutName: string): SUB_LAYOUT_CLASS {\n    let subLayout = this.subLayouts.get(layoutName)\n    if (subLayout === undefined) {\n      subLayout = new this.SubLayoutClass(this.subLayoutConstructorArgs)\n      this.subLayouts.set(layoutName, subLayout)\n      return subLayout\n    }\n\n    return subLayout\n  }\n\n  addRect(\n    layoutName: string,\n    id: string,\n    left: number,\n    right: number,\n    height: number,\n    data: Record<string, T> = {},\n  ) {\n    return this.getSublayout(layoutName).addRect(id, left, right, height, data)\n  }\n\n  discardRange(layoutName: string, left: number, right: number) {\n    const layout = this.subLayouts.get(layoutName)\n    return layout && layout.discardRange(left, right)\n  }\n\n  toJSON() {\n    const data: Record<string, SerializedLayout> = {}\n    for (const [layoutName, sublayout] of this.subLayouts.entries()) {\n      data[layoutName] = sublayout.toJSON()\n    }\n    return data\n  }\n}\n","import { objectFromEntries } from '..'\nimport {\n  RectTuple,\n  SerializedLayout,\n  BaseLayout,\n  Rectangle,\n} from './BaseLayout'\n\nexport default class PrecomputedLayout<T> implements BaseLayout<T> {\n  private rectangles: Map<string, RectTuple>\n\n  private totalHeight: number\n\n  public maxHeightReached: boolean\n\n  constructor({ rectangles, totalHeight, maxHeightReached }: SerializedLayout) {\n    this.rectangles = new Map(Object.entries(rectangles))\n    // rectangles is of the form \"featureId\": [leftPx, topPx, rightPx, bottomPx]\n    this.totalHeight = totalHeight\n    this.maxHeightReached = maxHeightReached\n  }\n\n  addRect(id: string) {\n    const rect = this.rectangles.get(id)\n    if (!rect) {\n      throw new Error(`id ${id} not found in precomputed feature layout`)\n    }\n    // left, top, right, bottom\n    return rect[1]\n  }\n\n  /**\n   * returns a Map of `feature id -> rectangle`\n   */\n  getRectangles(): Map<string, RectTuple> {\n    return this.rectangles\n  }\n\n  getTotalHeight(): number {\n    return this.totalHeight\n  }\n\n  collides(_rect: Rectangle<T>, _top: number): boolean {\n    throw new Error('Method not implemented.')\n  }\n\n  addRectToBitmap(_rect: Rectangle<T>, _data: Record<string, T>): void {\n    throw new Error('Method not implemented.')\n  }\n\n  discardRange(_left: number, _right: number): void {\n    throw new Error('Method not implemented.')\n  }\n\n  serializeRegion(_region: { start: number; end: number }): SerializedLayout {\n    throw new Error('Method not implemented.')\n  }\n\n  toJSON(): SerializedLayout {\n    return {\n      rectangles: objectFromEntries(this.rectangles),\n      totalHeight: this.totalHeight,\n      maxHeightReached: false,\n    }\n  }\n}\n","import deepEqual from 'deep-equal'\nimport { AnyConfigurationModel } from '../../configuration/configurationSchema'\nimport GranularRectLayout from '../../util/layouts/GranularRectLayout'\nimport MultiLayout from '../../util/layouts/MultiLayout'\nimport PrecomputedLayout from '../../util/layouts/PrecomputedLayout'\nimport { Feature } from '../../util/simpleFeature'\nimport ServerSideRendererType, {\n  ResultsSerialized as BaseResultsSerialized,\n  RenderArgs,\n  RenderArgsSerialized,\n  ResultsDeserialized as BaseResultsDeserialized,\n  RenderArgsDeserialized as BaseRenderArgsDeserialized,\n  RenderResults,\n} from './ServerSideRendererType'\nimport { Region } from '../../util/types'\nimport { SerializedLayout, BaseLayout } from '../../util/layouts/BaseLayout'\nimport { readConfObject, isConfigurationModel } from '../../configuration'\nimport SerializableFilterChain from './util/serializableFilterChain'\n\ninterface LayoutSessionProps {\n  config: AnyConfigurationModel\n  bpPerPx: number\n  filters: SerializableFilterChain\n}\n\ntype MyMultiLayout = MultiLayout<GranularRectLayout<unknown>, unknown>\ninterface CachedLayout {\n  layout: MyMultiLayout\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n}\n\nexport class LayoutSession implements LayoutSessionProps {\n  config: AnyConfigurationModel\n\n  bpPerPx: number\n\n  filters: SerializableFilterChain\n\n  constructor(args: LayoutSessionProps) {\n    this.config = args.config\n    if (!isConfigurationModel(this.config)) {\n      throw new Error('configuration required')\n    }\n    this.bpPerPx = args.bpPerPx\n    this.filters = args.filters\n    this.update(args)\n  }\n\n  update(props: LayoutSessionProps) {\n    Object.assign(this, props)\n  }\n\n  makeLayout() {\n    return new MultiLayout(GranularRectLayout, {\n      maxHeight: readConfObject(this.config, 'maxHeight'),\n      displayMode: readConfObject(this.config, 'displayMode'),\n      pitchX: this.bpPerPx,\n      pitchY: 3,\n    })\n  }\n\n  /**\n   * @param layout -\n   * @returns true if the given layout is a valid one to use for this session\n   */\n  cachedLayoutIsValid(cachedLayout: CachedLayout) {\n    return (\n      cachedLayout &&\n      cachedLayout.layout.subLayoutConstructorArgs.pitchX === this.bpPerPx &&\n      deepEqual(readConfObject(this.config), cachedLayout.config) &&\n      deepEqual(this.filters, cachedLayout.filters)\n    )\n  }\n\n  cachedLayout: CachedLayout | undefined\n\n  get layout(): MyMultiLayout {\n    if (!this.cachedLayout || !this.cachedLayoutIsValid(this.cachedLayout)) {\n      this.cachedLayout = {\n        layout: this.makeLayout(),\n        config: readConfObject(this.config),\n        filters: this.filters,\n      }\n    }\n    return this.cachedLayout.layout\n  }\n}\n\n/// *****************************************************************************\n/// *****************************************************************************\n/// *****************************************************************************\n\ntype ResultsDeserialized = BaseResultsDeserialized & {\n  layout: PrecomputedLayout<string>\n}\n\ntype RenderArgsDeserialized = BaseRenderArgsDeserialized & {\n  layout: BaseLayout<unknown>\n}\n\ntype ResultsSerialized = BaseResultsSerialized & {\n  maxHeightReached: boolean\n  layout: SerializedLayout\n}\n\nexport default class BoxRendererType extends ServerSideRendererType {\n  sessions: { [sessionId: string]: LayoutSession } = {}\n\n  getWorkerSession(props: LayoutSessionProps & { sessionId: string }) {\n    const { sessionId } = props\n    if (!this.sessions[sessionId])\n      this.sessions[sessionId] = this.createSession(props)\n    const session = this.sessions[sessionId]\n    session.update(props)\n    return session\n  }\n\n  // expands region for glyphs to use\n  getExpandedRegion(region: Region, renderArgs: RenderArgsDeserialized) {\n    if (!region) return region\n    const { bpPerPx, config } = renderArgs\n    const maxFeatureGlyphExpansion =\n      config === undefined\n        ? 0\n        : readConfObject(config, 'maxFeatureGlyphExpansion')\n    if (!maxFeatureGlyphExpansion) return region\n    const bpExpansion = Math.round(maxFeatureGlyphExpansion * bpPerPx)\n    return {\n      ...region,\n      start: Math.floor(Math.max(region.start - bpExpansion, 0)),\n      end: Math.ceil(region.end + bpExpansion),\n    }\n  }\n\n  createSession(props: LayoutSessionProps) {\n    return new LayoutSession(props)\n  }\n\n  freeResourcesInWorker(args: {\n    sessionId: string\n    regions: Region[] | undefined\n  }) {\n    const { sessionId, regions } = args\n    const session = this.sessions[sessionId]\n    if (!regions && session) {\n      delete this.sessions[sessionId]\n      return 1\n    }\n    if (session && regions) {\n      session.layout.discardRange(\n        regions[0].refName,\n        regions[0].start,\n        regions[0].end,\n      )\n    }\n    return 0\n  }\n\n  deserializeLayoutInClient(json: SerializedLayout) {\n    return new PrecomputedLayout(json)\n  }\n\n  deserializeResultsInClient(\n    result: ResultsSerialized & { layout: SerializedLayout },\n    args: RenderArgs,\n  ) {\n    const deserialized = super.deserializeResultsInClient(\n      result,\n      args,\n    ) as ResultsDeserialized\n    deserialized.layout = this.deserializeLayoutInClient(result.layout)\n\n    // // debugging aid: check if there are features in `features` that are not in the layout\n    // const featureIds1 = iterMap(deserialized.features.values(), f =>\n    //   f.id(),\n    // ).sort()\n    // const featureIds2 = Object.keys(\n    //   deserialized.layout.toJSON().rectangles,\n    // ).sort()\n    // if (\n    //   featureIds1.length > featureIds2.length &&\n    //   !deserialized.layout.maxHeightReached\n    // )\n    //   debugger\n\n    return deserialized\n  }\n\n  deserializeLayoutInWorker(args: RenderArgsDeserialized & LayoutSessionProps) {\n    const { regions } = args\n    const session = this.getWorkerSession(args)\n    const subLayout = session.layout.getSublayout(regions[0].refName)\n    return subLayout\n  }\n\n  deserializeArgsInWorker(\n    args: RenderArgsSerialized & LayoutSessionProps,\n  ): RenderArgsDeserialized {\n    const deserialized = super.deserializeArgsInWorker(\n      args,\n    ) as RenderArgsDeserialized\n    deserialized.layout = this.deserializeLayoutInWorker(deserialized)\n    return deserialized\n  }\n\n  serializeResultsInWorker(\n    results: RenderResults,\n    features: Map<string, Feature>,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const serialized = super.serializeResultsInWorker(\n      results,\n      features,\n      args,\n    ) as ResultsSerialized\n\n    const [region] = args.regions\n    serialized.layout = args.layout.serializeRegion(\n      this.getExpandedRegion(region, args),\n    )\n    if (serialized.layout.rectangles) {\n      serialized.features = serialized.features.filter(f => {\n        return Boolean(serialized.layout.rectangles[f.uniqueId])\n      })\n    }\n\n    serialized.maxHeightReached = serialized.layout.maxHeightReached\n    return serialized\n  }\n}\n","import PluginManager from './PluginManager'\n\n/**\n * base class for a JBrowse plugin\n */\nexport default abstract class Plugin {\n  abstract name: string\n\n  install(_pluginManager: PluginManager): void {}\n\n  configure(_pluginManager: PluginManager): void {}\n}\n\nexport type PluginConstructor = new (...args: unknown[]) => Plugin\n","// from https://www.w3.org/TR/css-color-4/#named-colors\n\nconst colors: Record<string, string> = {\n  aliceblue: '#F0F8FF',\n  antiquewhite: '#FAEBD7',\n  aqua: '#00FFFF',\n  aquamarine: '#7FFFD4',\n  azure: '#F0FFFF',\n  beige: '#F5F5DC',\n  bisque: '#FFE4C4',\n  black: '#000000',\n  blanchedalmond: '#FFEBCD',\n  blue: '#0000FF',\n  blueviolet: '#8A2BE2',\n  brown: '#A52A2A',\n  burlywood: '#DEB887',\n  cadetblue: '#5F9EA0',\n  chartreuse: '#7FFF00',\n  chocolate: '#D2691E',\n  coral: '#FF7F50',\n  cornflowerblue: '#6495ED',\n  cornsilk: '#FFF8DC',\n  crimson: '#DC143C',\n  cyan: '#00FFFF',\n  darkblue: '#00008B',\n  darkcyan: '#008B8B',\n  darkgoldenrod: '#B8860B',\n  darkgray: '#A9A9A9',\n  darkgreen: '#006400',\n  darkgrey: '#A9A9A9',\n  darkkhaki: '#BDB76B',\n  darkmagenta: '#8B008B',\n  darkolivegreen: '#556B2F',\n  darkorange: '#FF8C00',\n  darkorchid: '#9932CC',\n  darkred: '#8B0000',\n  darksalmon: '#E9967A',\n  darkseagreen: '#8FBC8F',\n  darkslateblue: '#483D8B',\n  darkslategray: '#2F4F4F',\n  darkslategrey: '#2F4F4F',\n  darkturquoise: '#00CED1',\n  darkviolet: '#9400D3',\n  deeppink: '#FF1493',\n  deepskyblue: '#00BFFF',\n  dimgray: '#696969',\n  dimgrey: '#696969',\n  dodgerblue: '#1E90FF',\n  firebrick: '#B22222',\n  floralwhite: '#FFFAF0',\n  forestgreen: '#228B22',\n  fuchsia: '#FF00FF',\n  gainsboro: '#DCDCDC',\n  ghostwhite: '#F8F8FF',\n  gold: '#FFD700',\n  goldenrod: '#DAA520',\n  gray: '#808080',\n  green: '#008000',\n  greenyellow: '#ADFF2F',\n  grey: '#808080',\n  honeydew: '#F0FFF0',\n  hotpink: '#FF69B4',\n  indianred: '#CD5C5C',\n  indigo: '#4B0082',\n  ivory: '#FFFFF0',\n  khaki: '#F0E68C',\n  lavender: '#E6E6FA',\n  lavenderblush: '#FFF0F5',\n  lawngreen: '#7CFC00',\n  lemonchiffon: '#FFFACD',\n  lightblue: '#ADD8E6',\n  lightcoral: '#F08080',\n  lightcyan: '#E0FFFF',\n  lightgoldenrodyellow: '#FAFAD2',\n  lightgray: '#D3D3D3',\n  lightgreen: '#90EE90',\n  lightgrey: '#D3D3D3',\n  lightpink: '#FFB6C1',\n  lightsalmon: '#FFA07A',\n  lightseagreen: '#20B2AA',\n  lightskyblue: '#87CEFA',\n  lightslategray: '#778899',\n  lightslategrey: '#778899',\n  lightsteelblue: '#B0C4DE',\n  lightyellow: '#FFFFE0',\n  lime: '#00FF00',\n  limegreen: '#32CD32',\n  linen: '#FAF0E6',\n  magenta: '#FF00FF',\n  maroon: '#800000',\n  mediumaquamarine: '#66CDAA',\n  mediumblue: '#0000CD',\n  mediumorchid: '#BA55D3',\n  mediumpurple: '#9370DB',\n  mediumseagreen: '#3CB371',\n  mediumslateblue: '#7B68EE',\n  mediumspringgreen: '#00FA9A',\n  mediumturquoise: '#48D1CC',\n  mediumvioletred: '#C71585',\n  midnightblue: '#191970',\n  mintcream: '#F5FFFA',\n  mistyrose: '#FFE4E1',\n  moccasin: '#FFE4B5',\n  navajowhite: '#FFDEAD',\n  navy: '#000080',\n  oldlace: '#FDF5E6',\n  olive: '#808000',\n  olivedrab: '#6B8E23',\n  orange: '#FFA500',\n  orangered: '#FF4500',\n  orchid: '#DA70D6',\n  palegoldenrod: '#EEE8AA',\n  palegreen: '#98FB98',\n  paleturquoise: '#AFEEEE',\n  palevioletred: '#DB7093',\n  papayawhip: '#FFEFD5',\n  peachpuff: '#FFDAB9',\n  peru: '#CD853F',\n  pink: '#FFC0CB',\n  plum: '#DDA0DD',\n  powderblue: '#B0E0E6',\n  purple: '#800080',\n  rebeccapurple: '#663399',\n  red: '#FF0000',\n  rosybrown: '#BC8F8F',\n  royalblue: '#4169E1',\n  saddlebrown: '#8B4513',\n  salmon: '#FA8072',\n  sandybrown: '#F4A460',\n  seagreen: '#2E8B57',\n  seashell: '#FFF5EE',\n  sienna: '#A0522D',\n  silver: '#C0C0C0',\n  skyblue: '#87CEEB',\n  slateblue: '#6A5ACD',\n  slategray: '#708090',\n  slategrey: '#708090',\n  snow: '#FFFAFA',\n  springgreen: '#00FF7F',\n  steelblue: '#4682B4',\n  tan: '#D2B48C',\n  teal: '#008080',\n  thistle: '#D8BFD8',\n  tomato: '#FF6347',\n  turquoise: '#40E0D0',\n  violet: '#EE82EE',\n  wheat: '#F5DEB3',\n  white: '#FFFFFF',\n  whitesmoke: '#F5F5F5',\n  yellow: '#FFFF00',\n  yellowgreen: '#9ACD32',\n}\n\nexport function namedColorToHex(name: string): string | undefined {\n  return colors[name]\n}\n\nexport function isNamedColor(name: string): boolean {\n  return !!colors[name]\n}\n","import {\n  darken,\n  emphasize as muiEmphasize,\n  getContrastRatio,\n  getLuminance as muiGetLuminance,\n  lighten,\n} from '@material-ui/core/styles/colorManipulator'\nimport { namedColorToHex, isNamedColor } from './cssColorsLevel4'\n\nexport { namedColorToHex, isNamedColor }\n\n/**\n * Algorithmically pick a contrasting text color that will\n * be visible on top of the given background color. Either\n * black or white.\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n *  hsl(), hsla(), or named color\n * @returns 'black' or 'white'\n */\nexport function contrastingTextColor(color: string): string {\n  const luminance = getLuminance(color)\n  return luminance > 0.5 ? 'black' : 'white'\n}\n\n/**\n * The relative brightness of any point in a color space,\n * normalized to 0 for darkest black and 1 for lightest white.\n * Uses MUI's `getLuminance`, but adds support for named colors\n *\n * Formula: https://www.w3.org/TR/WCAG20-TECHS/G17.html#G17-tests\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n *  hsl(), hsla(), or named color\n * @returns The relative brightness of the color in the range 0 - 1\n */\nfunction getLuminance(color: string): number {\n  const convertedColor = namedColorToHex(color)\n  return muiGetLuminance(convertedColor || color)\n}\n\n/**\n * Darken or lighten a color, depending on its luminance.\n * Light colors are darkened, dark colors are lightened.\n * Uses MUI's `emphasize`, but adds support for named colors\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n * hsl(), hsla(), or named color\n * @param coefficient - multiplier in the range 0 - 1, defaults to 0.15\n * @returns A CSS color string. Hex input values are returned as rgb\n */\nexport function emphasize(color: string, coefficient = 0.15): string {\n  const convertedColor = namedColorToHex(color)\n  return muiEmphasize(convertedColor || color, coefficient)\n}\n\nexport function makeContrasting(\n  foreground: string,\n  background = 'white',\n  minContrastRatio = 3,\n) {\n  let convertedForeground = namedColorToHex(foreground) || foreground\n  const convertedBackground = namedColorToHex(background) || background\n  const backgroundLuminance = getLuminance(convertedBackground)\n  let contrastRatio = getContrastRatio(convertedForeground, convertedBackground)\n  const originalColor = convertedForeground\n  let coefficient = 0.05\n  while (contrastRatio < minContrastRatio) {\n    convertedForeground =\n      backgroundLuminance > 0.5\n        ? darken(originalColor, coefficient)\n        : lighten(originalColor, coefficient)\n    coefficient += 0.05\n    contrastRatio = getContrastRatio(convertedForeground, convertedBackground)\n  }\n  return convertedForeground\n}\n","// this is all the stuff that the pluginManager re-exports for plugins to use\nimport React from 'react'\nimport * as ReactDom from 'react-dom'\nimport * as mobx from 'mobx'\nimport * as mst from 'mobx-state-tree'\nimport * as mxreact from 'mobx-react'\nimport PropTypes from 'prop-types'\n\nimport * as MUIStyles from '@material-ui/core/styles'\n\n// @material-ui components\nimport * as MUICore from '@material-ui/core'\nimport * as MUILab from '@material-ui/lab'\nimport MUIBox from '@material-ui/core/Box'\nimport MUIButton from '@material-ui/core/Button'\nimport MUIButtonGroup from '@material-ui/core/ButtonGroup'\nimport MUICard from '@material-ui/core/Card'\nimport MUICardContent from '@material-ui/core/CardContent'\nimport MUICheckbox from '@material-ui/core/Checkbox'\nimport MUIContainer from '@material-ui/core/Container'\nimport MUIDialog from '@material-ui/core/Dialog'\nimport MUIFormLabel from '@material-ui/core/FormLabel'\nimport MUIFormControl from '@material-ui/core/FormControl'\nimport MUIFormControlLabel from '@material-ui/core/FormControlLabel'\nimport MUIFormGroup from '@material-ui/core/FormGroup'\nimport MUIGrid from '@material-ui/core/Grid'\nimport MUIIcon from '@material-ui/core/Icon'\nimport MUIIconButton from '@material-ui/core/IconButton'\nimport MUIInputAdornment from '@material-ui/core/InputAdornment'\nimport MUILinearProgress from '@material-ui/core/LinearProgress'\nimport MUIListItemIcon from '@material-ui/core/ListItemIcon'\nimport MUIListItemText from '@material-ui/core/ListItemText'\nimport MUIMenu from '@material-ui/core/Menu'\nimport MUIMenuItem from '@material-ui/core/MenuItem'\nimport MUIRadio from '@material-ui/core/Radio'\nimport MUIRadioGroup from '@material-ui/core/RadioGroup'\nimport MUISelect from '@material-ui/core/Select'\nimport MUISnackbar from '@material-ui/core/Snackbar'\nimport MUISnackbarContent from '@material-ui/core/SnackbarContent'\nimport MUITextField from '@material-ui/core/TextField'\nimport MUITooltip from '@material-ui/core/Tooltip'\nimport MUITypography from '@material-ui/core/Typography'\n\n// material-ui lab\nimport ToggleButton from '@material-ui/lab/ToggleButton'\nimport ToggleButtonGroup from '@material-ui/lab/ToggleButtonGroup'\n\nimport * as BaseAdapterExports from '../data_adapters/BaseAdapter'\n\nimport * as BaseFeatureDetail from '../BaseFeatureWidget/BaseFeatureDetail'\n\nimport Base1DView from '../util/Base1DViewModel'\nimport ViewType from '../pluggableElementTypes/ViewType'\nimport AdapterType from '../pluggableElementTypes/AdapterType'\nimport DisplayType from '../pluggableElementTypes/DisplayType'\nimport TrackType from '../pluggableElementTypes/TrackType'\nimport WidgetType from '../pluggableElementTypes/WidgetType'\n\nimport * as pluggableElementTypeModels from '../pluggableElementTypes/models'\nimport ServerSideRendererType from '../pluggableElementTypes/renderers/ServerSideRendererType'\nimport CircularChordRendererType from '../pluggableElementTypes/renderers/CircularChordRendererType'\nimport BoxRendererType from '../pluggableElementTypes/renderers/BoxRendererType'\n\nimport * as Configuration from '../configuration'\nimport Plugin from '../Plugin'\nimport * as coreUi from '../ui'\nimport * as coreUtil from '../util'\nimport * as coreColor from '../util/color'\nimport * as trackUtils from '../util/tracks'\nimport * as coreIo from '../util/io'\nimport * as coreMstReflection from '../util/mst-reflection'\nimport * as MUIColors from './material-ui-colors'\nimport * as mstTypes from '../util/types/mst'\n\nimport ReExportsList from './list'\n\nconst libs = {\n  mobx,\n  'mobx-state-tree': mst,\n  react: React,\n  'react-dom': ReactDom,\n  'mobx-react': mxreact,\n  'prop-types': PropTypes,\n\n  // material-ui 1st-level components\n  '@material-ui/core': MUICore,\n  '@material-ui/lab': MUILab,\n\n  // material-ui subcomponents, should get rid of these\n  '@material-ui/core/colors': MUIColors,\n  '@material-ui/core/styles': MUIStyles,\n  '@material-ui/core/Box': MUIBox,\n  '@material-ui/core/Button': MUIButton,\n  '@material-ui/core/ButtonGroup': MUIButtonGroup,\n  '@material-ui/core/Card': MUICard,\n  '@material-ui/core/CardContent': MUICardContent,\n  '@material-ui/core/Container': MUIContainer,\n  '@material-ui/core/Checkbox': MUICheckbox,\n  '@material-ui/core/Dialog': MUIDialog,\n  '@material-ui/core/FormGroup': MUIFormGroup,\n  '@material-ui/core/FormLabel': MUIFormLabel,\n  '@material-ui/core/FormControl': MUIFormControl,\n  '@material-ui/core/FormControlLabel': MUIFormControlLabel,\n  '@material-ui/core/Grid': MUIGrid,\n  '@material-ui/core/Icon': MUIIcon,\n  '@material-ui/core/IconButton': MUIIconButton,\n  '@material-ui/core/InputAdornment': MUIInputAdornment,\n  '@material-ui/core/LinearProgress': MUILinearProgress,\n  '@material-ui/core/ListItemIcon': MUIListItemIcon,\n  '@material-ui/core/ListItemText': MUIListItemText,\n  '@material-ui/core/Menu': MUIMenu,\n  '@material-ui/core/MenuItem': MUIMenuItem,\n  '@material-ui/core/RadioGroup': MUIRadioGroup,\n  '@material-ui/core/Radio': MUIRadio,\n  '@material-ui/core/Select': MUISelect,\n  '@material-ui/core/Snackbar': MUISnackbar,\n  '@material-ui/core/SnackbarContent': MUISnackbarContent,\n  '@material-ui/core/TextField': MUITextField,\n  '@material-ui/core/Tooltip': MUITooltip,\n  '@material-ui/core/Typography': MUITypography,\n\n  // @material-ui lab\n  '@material-ui/lab/ToggleButton': ToggleButton,\n  '@material-ui/lab/ToggleButtonGroup': ToggleButtonGroup,\n\n  '@jbrowse/core/Plugin': Plugin,\n  '@jbrowse/core/pluggableElementTypes/ViewType': ViewType,\n  '@jbrowse/core/pluggableElementTypes/AdapterType': AdapterType,\n  '@jbrowse/core/pluggableElementTypes/DisplayType': DisplayType,\n  '@jbrowse/core/pluggableElementTypes/TrackType': TrackType,\n  '@jbrowse/core/pluggableElementTypes/WidgetType': WidgetType,\n\n  '@jbrowse/core/pluggableElementTypes/models': pluggableElementTypeModels,\n  '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType': ServerSideRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType': CircularChordRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType': BoxRendererType,\n  '@jbrowse/core/configuration': Configuration,\n  '@jbrowse/core/util/types/mst': mstTypes,\n  '@jbrowse/core/ui': coreUi,\n  '@jbrowse/core/util': coreUtil,\n  '@jbrowse/core/util/color': coreColor,\n  '@jbrowse/core/util/tracks': trackUtils,\n  '@jbrowse/core/util/Base1DViewModel': Base1DView,\n  '@jbrowse/core/util/io': coreIo,\n  '@jbrowse/core/util/mst-reflection': coreMstReflection,\n  '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail': BaseFeatureDetail,\n\n  '@jbrowse/core/data_adapters/BaseAdapter': BaseAdapterExports,\n}\n\n// make sure that all the items in the ReExports/list array (used by build systems and such)\n// are included here. it's OK if there are some additional ones that are not in the list\nReExportsList.forEach(name => {\n  if (!(name in libs)) {\n    throw new Error(`ReExports/modules is missing ${name}`)\n  }\n})\n\nexport default libs\n","export default [\n  'mobx',\n  'mobx-state-tree',\n  'react',\n  'react-dom',\n  'mobx-react',\n  'prop-types',\n\n  '@material-ui/core',\n  '@material-ui/lab',\n\n  '@jbrowse/core/Plugin',\n  '@jbrowse/core/pluggableElementTypes/ViewType',\n  '@jbrowse/core/pluggableElementTypes/AdapterType',\n  '@jbrowse/core/pluggableElementTypes/DisplayType',\n  '@jbrowse/core/pluggableElementTypes/TrackType',\n  '@jbrowse/core/pluggableElementTypes/WidgetType',\n\n  '@jbrowse/core/pluggableElementTypes/models',\n  '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType',\n  '@jbrowse/core/configuration',\n  '@jbrowse/core/util/types/mst',\n  '@jbrowse/core/ui',\n  '@jbrowse/core/util',\n  '@jbrowse/core/util/color',\n  '@jbrowse/core/util/tracks',\n  '@jbrowse/core/util/Base1DViewModel',\n  '@jbrowse/core/util/io',\n  '@jbrowse/core/util/mst-reflection',\n  '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail',\n\n  '@jbrowse/core/data_adapters/BaseAdapter',\n]\n","import modules from './modules'\n\nexport default modules\n","import jsonStableStringify from 'json-stable-stringify'\nimport { SnapshotIn } from 'mobx-state-tree'\nimport PluginManager from '../PluginManager'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport { AnyDataAdapter } from './BaseAdapter'\nimport { Region } from '../util/types'\n\nfunction adapterConfigCacheKey(\n  adapterConfig: SnapshotIn<AnyConfigurationSchemaType>,\n) {\n  return `${jsonStableStringify(adapterConfig)}`\n}\n\ninterface AdapterCacheEntry {\n  dataAdapter: AnyDataAdapter\n  sessionIds: Set<string>\n}\n\nlet adapterCache: Record<string, AdapterCacheEntry> = {}\n\n/**\n * instantiate a data adapter, or return an already-instantiated one if we have one with the same\n * configuration\n *\n * @param pluginManager -\n * @param sessionId - session ID of the associated worker session.\n *   used for reference counting\n * @param adapterConfigSnapshot - plain-JS configuration snapshot for the adapter\n */\nexport function getAdapter(\n  pluginManager: PluginManager,\n  sessionId: string,\n  adapterConfigSnapshot: SnapshotIn<AnyConfigurationSchemaType>,\n) {\n  // cache the adapter object\n  const cacheKey = adapterConfigCacheKey(adapterConfigSnapshot)\n  if (!adapterCache[cacheKey]) {\n    const adapterType = (adapterConfigSnapshot || {}).type\n    if (!adapterType)\n      throw new Error(\n        'could not determine adapter type from adapter config snapshot',\n      )\n    const dataAdapterType = pluginManager.getAdapterType(adapterType)\n    if (!dataAdapterType) {\n      throw new Error(`unknown data adapter type ${adapterType}`)\n    }\n\n    // instantiate the data adapter's config schema so it gets its defaults,\n    // callbacks, etc\n    const adapterConfig = dataAdapterType.configSchema.create(\n      adapterConfigSnapshot,\n    )\n\n    const getSubAdapter: getSubAdapterType = getAdapter.bind(\n      null,\n      pluginManager,\n      sessionId,\n    )\n    // instantiate the adapter itself with its config schema, and a bound\n    // func that it can use to get any inner adapters\n    // (such as sequence adapters or wrapped subadapters) that it needs\n    const dataAdapter = new dataAdapterType.AdapterClass(\n      adapterConfig,\n      getSubAdapter,\n    )\n\n    // store it in our cache\n    adapterCache[cacheKey] = {\n      dataAdapter,\n      sessionIds: new Set([sessionId]),\n    }\n  }\n\n  const cacheEntry = adapterCache[cacheKey]\n  cacheEntry.sessionIds.add(sessionId)\n\n  return cacheEntry\n}\n\n/**\n * this is a callback that is passed to adapters that\n * allows them to get any sub-adapters that they need\n * internally, staying with the same worker session ID\n */\nexport type getSubAdapterType = (\n  adapterConfigSnapshot: SnapshotIn<AnyConfigurationSchemaType>,\n) => ReturnType<typeof getAdapter>\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function freeAdapterResources(specification: Record<string, any>) {\n  let deleteCount = 0\n\n  const specKeys = Object.keys(specification)\n\n  // if we don't specify a range, delete any adapters that are\n  // only associated with that session\n  if (specKeys.length === 1 && specKeys[0] === 'sessionId') {\n    const { sessionId } = specification\n    Object.entries(adapterCache).forEach(([cacheKey, cacheEntry]) => {\n      cacheEntry.sessionIds.delete(sessionId)\n      if (cacheEntry.sessionIds.size === 0) {\n        deleteCount += 1\n        delete adapterCache[cacheKey]\n      }\n    })\n  } else {\n    // otherwise call freeResources on all the cached data adapters\n    Object.values(adapterCache).forEach(cacheEntry => {\n      if (!cacheEntry.dataAdapter.freeResources) {\n        console.warn(cacheEntry.dataAdapter, 'does not implement freeResources')\n      } else {\n        const regions =\n          specification.regions ||\n          (specification.region ? [specification.region] : [])\n        regions.forEach((region: Region) => {\n          if (region.refName !== undefined)\n            cacheEntry.dataAdapter.freeResources(region)\n        })\n      }\n    })\n  }\n\n  return deleteCount\n}\n\nexport function clearAdapterCache() {\n  adapterCache = {}\n}\n","import {\n  freeAdapterResources,\n  getAdapter,\n} from '../data_adapters/dataAdapterCache'\nimport RpcMethodType from '../pluggableElementTypes/RpcMethodType'\nimport ServerSideRendererType, {\n  RenderArgsSerialized as RendererTypeRenderArgsSerialized,\n} from '../pluggableElementTypes/renderers/ServerSideRendererType'\nimport { RemoteAbortSignal } from './remoteAbortSignals'\nimport {\n  BaseFeatureDataAdapter,\n  isRefNameAliasAdapter,\n} from '../data_adapters/BaseAdapter'\nimport { Region } from '../util/types'\nimport { checkAbortSignal, renameRegionsIfNeeded } from '../util'\n\nexport class CoreGetRefNames extends RpcMethodType {\n  name = 'CoreGetRefNames'\n\n  async execute(args: {\n    sessionId: string\n    signal: RemoteAbortSignal\n    adapterConfig: {}\n  }) {\n    const deserializedArgs = await this.deserializeArguments(args)\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    if (dataAdapter instanceof BaseFeatureDataAdapter) {\n      return dataAdapter.getRefNames(deserializedArgs)\n    }\n    return []\n  }\n}\n\nexport class CoreGetFileInfo extends RpcMethodType {\n  name = 'CoreGetInfo'\n\n  async execute(args: {\n    sessionId: string\n    signal: RemoteAbortSignal\n    adapterConfig: {}\n  }) {\n    const deserializedArgs = await this.deserializeArguments(args)\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    return !isRefNameAliasAdapter(dataAdapter)\n      ? dataAdapter.getHeader(deserializedArgs)\n      : null\n  }\n}\n\n/**\n * free up any resources (e.g. cached adapter objects)\n * that are only associated with the given track ID.\n *\n * returns number of objects deleted\n */\nexport class CoreFreeResources extends RpcMethodType {\n  name = 'CoreFreeResources'\n\n  async execute(specification: {}) {\n    let deleteCount = 0\n\n    deleteCount += freeAdapterResources(specification)\n\n    // pass the freeResources hint along to all the renderers as well\n    this.pluginManager.getRendererTypes().forEach(renderer => {\n      const count = renderer.freeResources(/* specification */)\n      if (count) deleteCount += count\n    })\n\n    return deleteCount\n  }\n}\n\nexport interface RenderArgs {\n  assemblyName: string\n  regions: Region[]\n  sessionId: string\n  adapterConfig: {}\n  rendererType: string\n  renderProps: RendererTypeRenderArgsSerialized\n}\n\n/**\n * fetches features from an adapter and call a renderer with them\n */\nexport class CoreRender extends RpcMethodType {\n  name = 'CoreRender'\n\n  async serializeArguments(\n    args: RenderArgs & { signal?: AbortSignal; statusCallback: Function },\n  ) {\n    const assemblyManager = this.pluginManager.rootModel?.session\n      ?.assemblyManager\n    if (!assemblyManager) {\n      return args\n    }\n\n    return renameRegionsIfNeeded(assemblyManager, args)\n  }\n\n  async execute(args: RenderArgs & { signal?: RemoteAbortSignal }) {\n    const deserializedArgs = await this.deserializeArguments(args)\n    const {\n      sessionId,\n      adapterConfig,\n      rendererType,\n      renderProps,\n      signal,\n    } = deserializedArgs\n    if (!sessionId) {\n      throw new Error('must pass a unique session id')\n    }\n\n    checkAbortSignal(signal)\n\n    const { dataAdapter } = getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    if (!(dataAdapter instanceof BaseFeatureDataAdapter))\n      throw new Error(\n        `CoreRender cannot handle this type of data adapter ${dataAdapter}`,\n      )\n\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    const result = await RendererType.renderInWorker({\n      ...deserializedArgs,\n      ...renderProps,\n      dataAdapter,\n    })\n\n    checkAbortSignal(signal)\n    return result\n  }\n}\n\nfunction validateRendererType<T>(rendererType: string, RendererType: T) {\n  if (!RendererType) {\n    throw new Error(`renderer \"${rendererType}\" not found`)\n  }\n  // @ts-ignore\n  if (!RendererType.ReactComponent) {\n    throw new Error(\n      `renderer ${rendererType} has no ReactComponent, it may not be completely implemented yet`,\n    )\n  }\n\n  if (!(RendererType instanceof ServerSideRendererType)) {\n    throw new Error(\n      'CoreRender requires a renderer that is a subclass of ServerSideRendererType',\n    )\n  }\n  return RendererType\n}\n","import Plugin from './Plugin'\nimport PluginManager from './PluginManager'\nimport * as coreRpcMethods from './rpc/coreRpcMethods'\n\n/** the core plugin, which registers types that ALL JBrowse applications are expected to need. */\nexport default class CorePlugin extends Plugin {\n  name = 'CorePlugin'\n\n  install(pluginManager: PluginManager) {\n    // register all our core rpc methods\n    Object.values(coreRpcMethods).forEach(RpcMethod => {\n      pluginManager.addRpcMethod(() => new RpcMethod(pluginManager))\n    })\n  }\n}\n","import {\n  types,\n  IAnyType,\n  IAnyModelType,\n  isModelType,\n  isType,\n} from 'mobx-state-tree'\n\nimport PluggableElementBase from './pluggableElementTypes/PluggableElementBase'\nimport RendererType from './pluggableElementTypes/renderers/RendererType'\nimport AdapterType from './pluggableElementTypes/AdapterType'\nimport TrackType from './pluggableElementTypes/TrackType'\nimport DisplayType from './pluggableElementTypes/DisplayType'\nimport ViewType from './pluggableElementTypes/ViewType'\nimport WidgetType from './pluggableElementTypes/WidgetType'\nimport ConnectionType from './pluggableElementTypes/ConnectionType'\nimport RpcMethodType from './pluggableElementTypes/RpcMethodType'\n\nimport {\n  ConfigurationSchema,\n  isBareConfigurationSchemaType,\n} from './configuration'\n\nimport Plugin from './Plugin'\nimport ReExports from './ReExports'\n\nimport {\n  PluggableElementType,\n  PluggableElementMember,\n} from './pluggableElementTypes'\nimport { AnyConfigurationSchemaType } from './configuration/configurationSchema'\nimport { AbstractRootModel } from './util'\nimport CorePlugin from './CorePlugin'\n\n/** little helper class that keeps groups of callbacks that are\nthen run in a specified order by group */\nclass PhasedScheduler<PhaseName extends string> {\n  phaseCallbacks = new Map<PhaseName, Function[]>()\n\n  phaseOrder: PhaseName[] = []\n\n  constructor(...phaseOrder: PhaseName[]) {\n    this.phaseOrder = phaseOrder\n  }\n\n  add(phase: PhaseName, callback: Function) {\n    if (!this.phaseOrder.includes(phase)) {\n      throw new Error(`unknown phase ${phase}`)\n    }\n    let phaseCallbacks = this.phaseCallbacks.get(phase)\n    if (!phaseCallbacks) {\n      phaseCallbacks = []\n      this.phaseCallbacks.set(phase, phaseCallbacks)\n    }\n    phaseCallbacks.push(callback)\n  }\n\n  run() {\n    this.phaseOrder.forEach(phaseName => {\n      const phaseCallbacks = this.phaseCallbacks.get(phaseName)\n      if (phaseCallbacks) {\n        phaseCallbacks.forEach(callback => callback())\n      }\n    })\n  }\n}\n\ntype PluggableElementTypeGroup =\n  | 'renderer'\n  | 'adapter'\n  | 'display'\n  | 'track'\n  | 'connection'\n  | 'view'\n  | 'widget'\n  | 'rpc method'\n\n/** internal class that holds the info for a certain element type */\nclass TypeRecord<ElementClass extends PluggableElementBase> {\n  registeredTypes: { [name: string]: ElementClass } = {}\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  baseClass: { new (...args: any[]): ElementClass }\n\n  typeName: string\n\n  constructor(\n    typeName: string,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    elementType: { new (...args: any[]): ElementClass },\n  ) {\n    this.typeName = typeName\n    this.baseClass = elementType\n  }\n\n  add(name: string, t: ElementClass) {\n    this.registeredTypes[name] = t\n  }\n\n  has(name: string) {\n    return name in this.registeredTypes\n  }\n\n  get(name: string) {\n    if (!this.has(name))\n      throw new Error(\n        `${this.typeName} '${name}' not found, perhaps its plugin is not loaded or its plugin has not added it.`,\n      )\n    return this.registeredTypes[name]\n  }\n\n  all() {\n    return Object.values(this.registeredTypes)\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype AnyFunction = (...args: any) => any\n\nexport default class PluginManager {\n  plugins: Plugin[] = []\n\n  elementCreationSchedule = new PhasedScheduler<PluggableElementTypeGroup>(\n    'renderer',\n    'adapter',\n    'display',\n    'track',\n    'connection',\n    'view',\n    'widget',\n    'rpc method',\n  )\n\n  rendererTypes = new TypeRecord('RendererType', RendererType)\n\n  adapterTypes = new TypeRecord('AdapterType', AdapterType)\n\n  trackTypes = new TypeRecord('TrackType', TrackType)\n\n  displayTypes = new TypeRecord('DisplayType', DisplayType)\n\n  connectionTypes = new TypeRecord('ConnectionType', ConnectionType)\n\n  viewTypes = new TypeRecord('ViewType', ViewType)\n\n  widgetTypes = new TypeRecord('WidgetType', WidgetType)\n\n  rpcMethods = new TypeRecord('RpcMethodType', RpcMethodType)\n\n  configured = false\n\n  rootModel?: AbstractRootModel\n\n  constructor(initialPlugins: Plugin[] = []) {\n    // add the core plugin\n    this.addPlugin(new CorePlugin())\n\n    // add all the initial plugins\n    initialPlugins.forEach(plugin => {\n      this.addPlugin(plugin)\n    })\n  }\n\n  addPlugin(plugin: Plugin) {\n    if (this.configured) {\n      throw new Error('JBrowse already configured, cannot add plugins')\n    }\n    if (this.plugins.includes(plugin)) {\n      throw new Error('plugin already installed')\n    }\n    plugin.install(this)\n    this.plugins.push(plugin)\n    return this\n  }\n\n  getPlugin(name: string) {\n    return this.plugins.find(p => p.name === name)\n  }\n\n  hasPlugin(name: string) {\n    return this.getPlugin(name) !== undefined\n  }\n\n  createPluggableElements() {\n    // run the creation callbacks for each element type in order.\n    // see elementCreationSchedule above for the creation order\n    this.elementCreationSchedule.run()\n    delete this.elementCreationSchedule\n    return this\n  }\n\n  setRootModel(rootModel: AbstractRootModel) {\n    this.rootModel = rootModel\n  }\n\n  configure() {\n    if (this.configured) throw new Error('already configured')\n\n    this.plugins.forEach(plugin => plugin.configure(this))\n\n    this.configured = true\n\n    // console.log(JSON.stringify(getSnapshot(model)))\n\n    return this\n  }\n\n  getElementTypeRecord(\n    groupName: PluggableElementTypeGroup,\n  ): TypeRecord<PluggableElementBase> {\n    switch (groupName) {\n      case 'adapter':\n        return this.adapterTypes\n      case 'connection':\n        return this.connectionTypes\n      case 'widget':\n        return this.widgetTypes\n      case 'renderer':\n        return this.rendererTypes\n      case 'display':\n        return this.displayTypes\n      case 'track':\n        return this.trackTypes\n      case 'view':\n        return this.viewTypes\n      case 'rpc method':\n        return this.rpcMethods\n      default:\n        throw new Error(`invalid element type '${groupName}'`)\n    }\n  }\n\n  addElementType(\n    groupName: PluggableElementTypeGroup,\n    creationCallback: (pluginManager: PluginManager) => PluggableElementType,\n  ) {\n    if (typeof creationCallback !== 'function') {\n      throw new Error(\n        'must provide a callback function that returns the new type object',\n      )\n    }\n    const typeRecord = this.getElementTypeRecord(groupName)\n\n    this.elementCreationSchedule.add(groupName, () => {\n      const newElement = creationCallback(this)\n      if (!newElement.name)\n        throw new Error(`cannot add a ${groupName} with no name`)\n\n      if (typeRecord.has(newElement.name)) {\n        throw new Error(\n          `${groupName} ${newElement.name} already registered, cannot register it again`,\n        )\n      }\n\n      typeRecord.add(newElement.name, newElement)\n    })\n\n    return this\n  }\n\n  getElementType(groupName: PluggableElementTypeGroup, typeName: string) {\n    const typeRecord = this.getElementTypeRecord(groupName)\n    return typeRecord.get(typeName)\n  }\n\n  getElementTypesInGroup(groupName: PluggableElementTypeGroup) {\n    const typeRecord = this.getElementTypeRecord(groupName)\n    return typeRecord.all()\n  }\n\n  /** get a MST type for the union of all specified pluggable MST types */\n  pluggableMstType(\n    typeGroup: PluggableElementTypeGroup,\n    fieldName: PluggableElementMember,\n    fallback: IAnyType = types.maybe(types.null),\n  ) {\n    const pluggableTypes: IAnyModelType[] = []\n    this.getElementTypeRecord(typeGroup)\n      .all()\n      .forEach(t => {\n        const thing = t[fieldName]\n        if (isType(thing) && isModelType(thing)) {\n          pluggableTypes.push(thing)\n        }\n      })\n    // try to smooth over the case when no types are registered, mostly encountered in tests\n    if (pluggableTypes.length === 0) {\n      console.warn(\n        `No JBrowse pluggable types found matching ('${typeGroup}','${fieldName}')`,\n      )\n      return fallback\n    }\n    return types.union(...pluggableTypes)\n  }\n\n  /** get a MST type for the union of all specified pluggable config schemas */\n  pluggableConfigSchemaType(\n    typeGroup: PluggableElementTypeGroup,\n    fieldName: PluggableElementMember = 'configSchema',\n  ) {\n    const pluggableTypes: AnyConfigurationSchemaType[] = []\n    this.getElementTypeRecord(typeGroup)\n      .all()\n      .forEach(t => {\n        const thing = t[fieldName]\n        if (isBareConfigurationSchemaType(thing)) {\n          pluggableTypes.push(thing)\n        }\n      })\n    if (pluggableTypes.length === 0)\n      pluggableTypes.push(ConfigurationSchema('Null', {}))\n    return types.union(...pluggableTypes)\n  }\n\n  jbrequireCache = new Map()\n\n  lib = ReExports\n\n  load = <FTYPE extends AnyFunction>(lib: FTYPE): ReturnType<FTYPE> => {\n    if (!this.jbrequireCache.has(lib)) this.jbrequireCache.set(lib, lib(this))\n    return this.jbrequireCache.get(lib)\n  }\n\n  /**\n   * Get the re-exported version of the given package name.\n   * Throws an error if the package is not re-exported by the plugin manager.\n   *\n   * @returns the library's default export\n   */\n  jbrequire = (\n    lib: keyof typeof ReExports | AnyFunction | { default: AnyFunction },\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ): any => {\n    if (typeof lib === 'string') {\n      const pack = this.lib[lib]\n      if (!pack) {\n        throw new TypeError(\n          `No jbrequire re-export defined for package '${lib}'. If this package must be shared between plugins, add it to ReExports.js. If it does not need to be shared, just import it normally.`,\n        )\n      }\n      return pack\n    }\n\n    if (typeof lib === 'function') {\n      return this.load(lib)\n    }\n\n    if (lib.default) return this.jbrequire(lib.default)\n\n    throw new TypeError(\n      'lib passed to jbrequire must be either a string or a function',\n    )\n  }\n\n  getRendererType(typeName: string): RendererType {\n    return this.rendererTypes.get(typeName)\n  }\n\n  getRendererTypes(): RendererType[] {\n    return this.rendererTypes.all()\n  }\n\n  getAdapterType(typeName: string): AdapterType {\n    return this.adapterTypes.get(typeName)\n  }\n\n  getTrackType(typeName: string): TrackType {\n    return this.trackTypes.get(typeName)\n  }\n\n  getDisplayType(typeName: string): DisplayType {\n    return this.displayTypes.get(typeName)\n  }\n\n  getViewType(typeName: string): ViewType {\n    return this.viewTypes.get(typeName)\n  }\n\n  getWidgetType(typeName: string): WidgetType {\n    return this.widgetTypes.get(typeName)\n  }\n\n  getConnectionType(typeName: string): ConnectionType {\n    return this.connectionTypes.get(typeName)\n  }\n\n  getRpcMethodType(methodName: string): RpcMethodType {\n    return this.rpcMethods.get(methodName)\n  }\n\n  addRendererType(\n    creationCallback: (pluginManager: PluginManager) => RendererType,\n  ): this {\n    return this.addElementType('renderer', creationCallback)\n  }\n\n  addAdapterType(\n    creationCallback: (pluginManager: PluginManager) => AdapterType,\n  ): this {\n    return this.addElementType('adapter', creationCallback)\n  }\n\n  addTrackType(\n    creationCallback: (pluginManager: PluginManager) => TrackType,\n  ): this {\n    // Goes through the already-created displays and registers the ones that\n    // specify this track type\n    const callback = () => {\n      const track = creationCallback(this)\n      ;(this.getElementTypesInGroup('display') as DisplayType[]).forEach(\n        display => {\n          if (\n            display.trackType === track.name &&\n            // track may have already added the displayType in its creationCallback\n            !track.displayTypes.includes(display)\n          ) {\n            track.addDisplayType(display)\n          }\n        },\n      )\n      return track\n    }\n    return this.addElementType('track', callback)\n  }\n\n  addDisplayType(\n    creationCallback: (pluginManager: PluginManager) => DisplayType,\n  ): this {\n    return this.addElementType('display', creationCallback)\n  }\n\n  addViewType(\n    creationCallback: (pluginManager: PluginManager) => ViewType,\n  ): this {\n    const callback = () => {\n      const newView = creationCallback(this)\n      ;(this.getElementTypesInGroup('display') as DisplayType[]).forEach(\n        display => {\n          if (\n            display.viewType === newView.name &&\n            // view may have already added the displayType in its creationCallback\n            !newView.displayTypes.includes(display)\n          ) {\n            newView.addDisplayType(display)\n          }\n        },\n      )\n      return newView\n    }\n    return this.addElementType('view', callback)\n  }\n\n  addWidgetType(\n    creationCallback: (pluginManager: PluginManager) => WidgetType,\n  ): this {\n    return this.addElementType('widget', creationCallback)\n  }\n\n  addConnectionType(\n    creationCallback: (pluginManager: PluginManager) => ConnectionType,\n  ): this {\n    return this.addElementType('connection', creationCallback)\n  }\n\n  addRpcMethod(\n    creationCallback: (pluginManager: PluginManager) => RpcMethodType,\n  ): this {\n    return this.addElementType('rpc method', creationCallback)\n  }\n}\n","/* eslint-disable no-restricted-globals */\nimport url from 'url'\nimport domLoadScript from 'load-script2'\n\nimport { PluginConstructor } from './Plugin'\nimport { ConfigurationSchema } from './configuration'\n\nimport ReExports from './ReExports'\n\nexport const PluginSourceConfigurationSchema = ConfigurationSchema(\n  'PluginSource',\n  {\n    name: {\n      type: 'string',\n      defaultValue: '',\n    },\n    url: {\n      type: 'string',\n      defaultValue: '',\n    },\n  },\n)\n\nexport interface PluginDefinition {\n  name?: string\n  url: string\n}\n\nexport default class PluginLoader {\n  definitions: PluginDefinition[] = []\n\n  constructor(pluginDefinitions: PluginDefinition[] = []) {\n    this.definitions = JSON.parse(JSON.stringify(pluginDefinitions))\n  }\n\n  loadScript(scriptUrl: string): Promise<void> {\n    if (document && document.getElementsByTagName) {\n      return domLoadScript(scriptUrl)\n    }\n    // @ts-ignore\n    if (self && self.importScripts) {\n      return new Promise((resolve, reject) => {\n        try {\n          // @ts-ignore\n          self.importScripts(scriptUrl)\n        } catch (error) {\n          reject(error || new Error(`failed to load ${scriptUrl}`))\n          return\n        }\n        resolve()\n      })\n    }\n    throw new Error(\n      'cannot figure out how to load external JS scripts in this environment',\n    )\n  }\n\n  async loadPlugin(definition: PluginDefinition): Promise<PluginConstructor> {\n    const parsedUrl = url.parse(definition.url)\n    if (\n      !parsedUrl.protocol ||\n      parsedUrl.protocol === 'http:' ||\n      parsedUrl.protocol === 'https:'\n    ) {\n      await this.loadScript(definition.url)\n      const moduleName = definition.name\n      const umdName = `JBrowsePlugin${moduleName}`\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const plugin = (window as any)[umdName] as { default: PluginConstructor }\n      if (!plugin)\n        throw new Error(\n          `plugin ${moduleName} failed to load, window.${umdName} is undefined`,\n        )\n\n      return plugin.default\n    }\n    throw new Error(\n      `cannot load plugins using protocol \"${parsedUrl.protocol}\"`,\n    )\n  }\n\n  installGlobalReExports(target: WindowOrWorkerGlobalScope | NodeJS.Global) {\n    // @ts-ignore\n    target.JBrowseExports = {}\n    Object.entries(ReExports).forEach(([moduleName, module]) => {\n      // @ts-ignore\n      target.JBrowseExports[moduleName] = module\n    })\n  }\n\n  async load(): Promise<PluginConstructor[]> {\n    return Promise.all(\n      this.definitions.map(definition => this.loadPlugin(definition)),\n    )\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { getSnapshot } from 'mobx-state-tree'\nimport { readConfObject } from '../configuration'\n\ninterface AnalyticsObj {\n  [key: string]: any\n}\n\ninterface Track {\n  [key: string]: any\n}\n\nexport async function writeAWSAnalytics(\n  rootModel: any,\n  initialTimeStamp: number,\n  sessionQuery?: string | null,\n) {\n  const url =\n    'https://mdvkjocq3e.execute-api.us-east-1.amazonaws.com/default/jbrowse-analytics'\n\n  const multiAssemblyTracks = rootModel.jbrowse.tracks.filter(\n    (track: any) => (readConfObject(track, 'assemblyNames') || []).length > 1,\n  ).length\n\n  // stats to be recorded in db\n  const stats: AnalyticsObj = {\n    ver: rootModel.version,\n    'assemblies-count': rootModel.jbrowse.assemblies.length,\n    'tracks-count': rootModel.jbrowse.tracks.length,\n    'session-tracks-count': rootModel?.session?.sessionTracks.length,\n    plugins: rootModel.jbrowse.plugins\n      ? getSnapshot(rootModel.jbrowse.plugins)\n      : '',\n    'open-views': rootModel?.session?.views.length || undefined,\n    'synteny-tracks-count': multiAssemblyTracks,\n    'saved-sessions-count': Object.keys(localStorage).filter(name =>\n      name.includes('localSaved-'),\n    ).length,\n\n    // field if existing session param in query before autogenerated param\n    'existing-session-param-type': sessionQuery?.split('-')[0],\n\n    // screen geometry\n    'scn-h': window.screen.height,\n    'scn-w': window.screen.width,\n\n    // window geometry\n    'win-h': window.innerHeight,\n    'win-w': window.innerWidth,\n\n    electron: typeof window !== 'undefined' && Boolean(window.electron),\n    loadTime: (Date.now() - initialTimeStamp) / 1000,\n    jb2: true,\n  }\n\n  // stringifies the track type counts, gets processed in lambda\n  rootModel.jbrowse.tracks.forEach((track: Track) => {\n    stats[`track-types-${track.type}`] =\n      stats[`track-types-${track.type}`] + 1 || 1\n  })\n\n  // stringifies the session track type counts, gets processed in lambda\n  rootModel?.session?.sessionTracks.forEach((track: Track) => {\n    stats[`sessionTrack-types-${track.type}`] =\n      stats[`sessionTrack-types-${track.type}`] + 1 || 1\n  })\n\n  // put stats into a query string for get request\n  const qs = Object.keys(stats)\n    .map(key => `${key}=${stats[key]}`)\n    .join('&')\n\n  await fetch(`${url}?${qs}`, {\n    method: 'GET',\n    mode: 'cors',\n  })\n}\n\nexport async function writeGAAnalytics(\n  rootModel: any,\n  initialTimeStamp: number,\n) {\n  const jbrowseUser = 'UA-7115575-5'\n  const stats: AnalyticsObj = {\n    'tracks-count': rootModel.jbrowse.tracks.length, // this is all possible tracks\n    ver: rootModel.version,\n    electron: typeof window !== 'undefined' && Boolean(window.electron),\n    loadTime: Date.now() - initialTimeStamp,\n    plugins: rootModel.jbrowse.plugins\n      ? getSnapshot(rootModel.jbrowse.plugins)\n      : undefined,\n  }\n\n  // create script\n  let analyticsScript =\n    \"(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\"\n  analyticsScript +=\n    '(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),'\n  analyticsScript +=\n    'm=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)'\n  analyticsScript +=\n    \"})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\"\n  analyticsScript += `ga('create', '${jbrowseUser}', 'auto', 'jbrowseTracker');`\n\n  const gaData: AnalyticsObj = {}\n  const googleDimensions = 'tracks-count ver electron loadTime plugins'\n\n  googleDimensions.split(/\\s+/).forEach((key, index) => {\n    gaData[`dimension${index + 1}`] = stats[key]\n  })\n\n  gaData.metric1 = Math.round(stats.loadTime)\n\n  analyticsScript += `ga('jbrowseTracker.send', 'pageview',${JSON.stringify(\n    gaData,\n  )});`\n\n  const analyticsScriptNode = document.createElement('script')\n  analyticsScriptNode.innerHTML = analyticsScript\n\n  document.getElementsByTagName('head')[0].appendChild(analyticsScriptNode)\n}\n","import { toUrlSafeB64 } from '@jbrowse/core/util'\n\nimport AES from 'crypto-js/aes'\nimport Utf8 from 'crypto-js/enc-utf8'\n\n// from https://stackoverflow.com/questions/1349404/\nfunction generateUID(length: number) {\n  return window\n    .btoa(\n      Array.from(window.crypto.getRandomValues(new Uint8Array(length * 2)))\n        .map(b => String.fromCharCode(b))\n        .join(''),\n    )\n    .replace(/[+/]/g, '')\n    .substring(0, length)\n}\n\nconst encrypt = (text: string, password: string) => {\n  return AES.encrypt(text, password).toString()\n}\n\nconst decrypt = (text: string, password: string) => {\n  const bytes = AES.decrypt(text, password)\n  return bytes.toString(Utf8)\n}\n// writes the encrypted session, current datetime, and referer to DynamoDB\nexport async function shareSessionToDynamo(\n  session: Record<string, unknown>,\n  url: string,\n  referer: string,\n) {\n  const sess = `${toUrlSafeB64(JSON.stringify(session))}`\n  const password = generateUID(5)\n  const encryptedSession = encrypt(sess, password)\n\n  const data = new FormData()\n  data.append('session', encryptedSession)\n  data.append('dateShared', `${Date.now()}`)\n  data.append('referer', referer)\n\n  const response = await fetch(`${url}share`, {\n    method: 'POST',\n    mode: 'cors',\n    body: data,\n  })\n\n  if (!response.ok) {\n    throw new Error(`Error sharing session ${response.statusText}`)\n  }\n  const json = await response.json()\n  return {\n    json,\n    encryptedSession,\n    password,\n  }\n}\n\nexport async function readSessionFromDynamo(\n  baseUrl: string,\n  sessionQueryParam: string,\n  password: string,\n  signal?: AbortSignal,\n) {\n  const sessionId = sessionQueryParam.split('share-')[1]\n  const url = `${baseUrl}?sessionId=${sessionId}`\n\n  const response = await fetch(url, {\n    signal,\n  })\n\n  if (!response.ok) {\n    console.error({ response, url })\n    throw new Error(\n      `Unable to fetch session ${sessionId}\\n${response.statusText}`,\n    )\n  }\n\n  // TODO: shouldn't get a 200 back for this\n  const text = await response.text()\n  if (!text) {\n    throw new Error(`Unable to fetch session ${sessionId}`)\n  }\n  const json = JSON.parse(text)\n  return decrypt(json.session, password)\n}\n","import { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '../configuration'\nimport { ElementId } from '../util/types/mst'\n\nconst configSchema = ConfigurationSchema('BaseFeatureWidget', {})\n\nconst stateModel = types\n  .model('BaseFeatureWidget', {\n    id: ElementId,\n    type: types.literal('BaseFeatureWidget'),\n    featureData: types.frozen({}),\n  })\n  .actions(self => ({\n    setFeatureData(data: Record<string, unknown>) {\n      self.featureData = data\n    },\n    clearFeatureData() {\n      self.featureData = {}\n    },\n  }))\n\nexport { configSchema, stateModel }\nexport { BaseFeatureDetails as ReactComponent } from './BaseFeatureDetail'\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport const baseLinearDisplayConfigSchema = ConfigurationSchema(\n  'BaseLinearDisplay',\n  {\n    mouseover: {\n      type: 'string',\n      description: 'what to display in a given mouseover',\n      defaultValue: `function(feature) {\n  return feature.get('name')\n}`,\n      functionSignature: ['feature'],\n    },\n    maxDisplayedBpPerPx: {\n      type: 'number',\n      description: 'maximum bpPerPx that is displayed in the view',\n      defaultValue: Number.MAX_VALUE,\n    },\n  },\n  { explicitIdentifier: 'displayId' },\n)\n","// takes an array or Map or Set (anything iterable with values()) of Maps\n// and lets you query them as one Map\nexport default class CompositeMap<T, U> {\n  private submaps: Map<T, U>[]\n\n  constructor(submaps: Map<T, U>[]) {\n    this.submaps = submaps\n  }\n\n  has(id: T) {\n    for (const submap of this.submaps.values()) {\n      if (submap.has(id)) return true\n    }\n    return false\n  }\n\n  get(id: T) {\n    for (const submap of this.submaps.values()) {\n      if (submap.has(id)) return submap.get(id)\n    }\n    return undefined\n  }\n\n  *values() {\n    for (const key of this.keys()) {\n      yield this.get(key) as U\n    }\n  }\n\n  *keys() {\n    const keys = new Set<T>()\n    for (const submap of this.submaps.values()) {\n      for (const key of submap.keys()) {\n        keys.add(key)\n      }\n    }\n    for (const key of keys) {\n      yield key\n    }\n  }\n\n  find<V>(f: (arg0: U) => V) {\n    for (const submap of this.submaps.values()) {\n      for (const value of submap.values()) {\n        const found = f(value)\n        if (found) {\n          return value\n        }\n      }\n    }\n    return undefined\n  }\n\n  *[Symbol.iterator]() {\n    for (const key of this.keys()) {\n      yield [key, this.get(key)]\n    }\n  }\n\n  *entries() {\n    for (const k of this.keys()) {\n      yield [k, this.get(k)]\n    }\n  }\n}\n","import { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport React from 'react'\n\nconst useStyles = makeStyles(theme => ({\n  contentBlock: {\n    position: 'relative',\n    minHeight: '100%',\n    boxSizing: 'border-box',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden',\n  },\n  elidedBlock: {\n    minHeight: '100%',\n    boxSizing: 'border-box',\n    backgroundColor: '#999',\n    backgroundImage:\n      'repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)',\n  },\n  interRegionPaddingBlock: {\n    minHeight: '100%',\n    backgroundColor: theme.palette.text.primary,\n  },\n  boundaryPaddingBlock: {\n    minHeight: '100%',\n    backgroundColor: theme.palette.action.disabledBackground,\n  },\n}))\n\ninterface ContentBlockProps {\n  block: BaseBlock\n  children: React.ReactNode\n}\n\ninterface ElidedBlockProps {\n  width: number\n}\n\ninterface InterRegionPaddingBlockProps {\n  boundary: boolean\n  width: number\n  style?: React.CSSProperties\n}\n\nconst ContentBlock = observer(({ block, children }: ContentBlockProps) => {\n  const classes = useStyles()\n  return (\n    <div\n      style={{\n        width: `${block.widthPx}px`,\n      }}\n      className={classes.contentBlock}\n    >\n      {children}\n    </div>\n  )\n})\n\nfunction ElidedBlock({ width }: ElidedBlockProps) {\n  const classes = useStyles()\n  return <div className={classes.elidedBlock} style={{ width: `${width}px` }} />\n}\n\nfunction InterRegionPaddingBlock({\n  boundary,\n  width,\n  style = {},\n}: InterRegionPaddingBlockProps) {\n  const classes = useStyles()\n  return (\n    <div\n      style={{\n        ...style,\n        width: `${width}px`,\n      }}\n      className={\n        boundary\n          ? classes.boundaryPaddingBlock\n          : classes.interRegionPaddingBlock\n      }\n    />\n  )\n}\n\nexport { ContentBlock, ElidedBlock, InterRegionPaddingBlock }\n","import { makeStyles } from '@material-ui/core/styles'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { observer, PropTypes } from 'mobx-react'\nimport React from 'react'\nimport {\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from '@jbrowse/core/util/blockTypes'\nimport { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from './Block'\n\nconst useStyles = makeStyles({\n  linearBlocks: {\n    whiteSpace: 'nowrap',\n    textAlign: 'left',\n    position: 'absolute',\n    display: 'flex',\n    minHeight: '100%',\n  },\n  heightOverflowed: {\n    position: 'absolute',\n    color: 'rgb(77,77,77)',\n    borderBottom: '2px solid rgb(77,77,77)',\n    textShadow: 'white 0px 0px 1px',\n    whiteSpace: 'nowrap',\n    width: '100%',\n    fontWeight: 'bold',\n    textAlign: 'center',\n    zIndex: 2000,\n    boxSizing: 'border-box',\n  },\n})\nconst RenderedBlocks = observer((props: { model: BaseLinearDisplayModel }) => {\n  const { model } = props\n  const classes = useStyles()\n  const { blockDefinitions, blockState } = model\n  return (\n    <>\n      {blockDefinitions.map(block => {\n        if (block instanceof ContentBlock) {\n          const state = blockState.get(block.key)\n          return (\n            <ContentBlockComponent\n              block={block}\n              key={`${model.id}-${block.key}`}\n            >\n              {state && state.ReactComponent ? (\n                <state.ReactComponent model={state} />\n              ) : null}\n              {state && state.maxHeightReached ? (\n                <div\n                  className={classes.heightOverflowed}\n                  style={{\n                    top: state.data.layout.totalHeight - 16,\n                    pointerEvents: 'none',\n                    height: 16,\n                  }}\n                >\n                  Max height reached\n                </div>\n              ) : null}\n            </ContentBlockComponent>\n          )\n        }\n        if (block instanceof ElidedBlock) {\n          return (\n            <ElidedBlockComponent\n              key={`${model.id}-${block.key}`}\n              width={block.widthPx}\n            />\n          )\n        }\n        if (block instanceof InterRegionPaddingBlock) {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={block.key}\n              width={block.widthPx}\n              style={{ background: 'none' }}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        throw new Error(`invalid block type ${typeof block}`)\n      })}\n    </>\n  )\n})\nfunction LinearBlocks({ model }: { model: BaseLinearDisplayModel }) {\n  const classes = useStyles()\n  const { blockDefinitions } = model\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const viewModel = getContainingView(model) as any\n  return (\n    <div\n      data-testid=\"Blockset\"\n      className={classes.linearBlocks}\n      style={{\n        left: blockDefinitions.offsetPx - viewModel.offsetPx,\n      }}\n    >\n      <RenderedBlocks model={model} />\n    </div>\n  )\n}\n\nLinearBlocks.propTypes = {\n  model: PropTypes.observableObject.isRequired,\n}\n\nexport { RenderedBlocks, useStyles }\nexport default observer(LinearBlocks)\n","import { getConf } from '@jbrowse/core/configuration'\nimport { Menu } from '@jbrowse/core/ui'\nimport { useTheme, makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport React, { useState, useRef } from 'react'\nimport MUITooltip from '@material-ui/core/Tooltip'\nimport LinearBlocks from './LinearBlocks'\nimport { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nconst useStyles = makeStyles({\n  display: {\n    position: 'relative',\n    whiteSpace: 'nowrap',\n    textAlign: 'left',\n    width: '100%',\n    minHeight: '100%',\n  },\n})\nconst Tooltip = observer(\n  (props: { model: BaseLinearDisplayModel; mouseCoord: [number, number] }) => {\n    const { model, mouseCoord } = props\n    const { featureUnderMouse } = model\n    const mouseover = featureUnderMouse\n      ? getConf(model, 'mouseover', [featureUnderMouse])\n      : undefined\n    return mouseover ? (\n      <MUITooltip title={mouseover} open placement=\"right\">\n        <div\n          style={{\n            position: 'absolute',\n            left: mouseCoord[0],\n            top: mouseCoord[1],\n          }}\n        >\n          {' '}\n        </div>\n      </MUITooltip>\n    ) : null\n  },\n)\n\n// I think I need to register the display's react component the same way a view's\n// or renderer's component gets registered\n\ntype Coord = [number, number]\nconst BaseLinearDisplay = observer(\n  (props: { model: BaseLinearDisplayModel; children: React.ReactNode }) => {\n    const classes = useStyles()\n    const theme = useTheme()\n\n    const [mouseCoord, setMouseCoord] = useState<Coord>([0, 0])\n    const [contextCoord, setContextCoord] = useState<Coord>()\n    const ref = useRef<HTMLDivElement>(null)\n    const { model, children } = props\n    const {\n      TooltipComponent,\n      DisplayMessageComponent,\n      contextMenuItems,\n      height,\n      setContextMenuFeature,\n    } = model\n\n    return (\n      <div\n        ref={ref}\n        data-testid={`display-${getConf(model, 'displayId')}`}\n        className={classes.display}\n        onContextMenu={event => {\n          event.preventDefault()\n          if (contextCoord) {\n            // There's already a context menu open, so close it\n            setContextCoord(undefined)\n          } else if (ref.current) {\n            setContextCoord([event.clientX, event.clientY])\n          }\n        }}\n        onMouseMove={event => {\n          if (ref.current) {\n            const rect = ref.current.getBoundingClientRect()\n            setMouseCoord([event.clientX - rect.left, event.clientY - rect.top])\n          }\n        }}\n        role=\"presentation\"\n      >\n        {DisplayMessageComponent ? (\n          <DisplayMessageComponent model={model} />\n        ) : (\n          <LinearBlocks {...props} />\n        )}\n        {children}\n        <TooltipComponent\n          model={model}\n          height={height}\n          mouseCoord={mouseCoord}\n        />\n\n        <Menu\n          open={Boolean(contextCoord) && Boolean(contextMenuItems.length)}\n          onMenuItemClick={(_, callback) => {\n            callback()\n            setContextCoord(undefined)\n          }}\n          onClose={() => {\n            setContextCoord(undefined)\n            setContextMenuFeature(undefined)\n          }}\n          onExit={() => {\n            setContextCoord(undefined)\n            setContextMenuFeature(undefined)\n          }}\n          anchorReference=\"anchorPosition\"\n          anchorPosition={\n            contextCoord\n              ? { top: contextCoord[1], left: contextCoord[0] }\n              : undefined\n          }\n          style={{ zIndex: theme.zIndex.tooltip }}\n          menuItems={contextMenuItems}\n          data-testid=\"base_linear_display_context_menu\"\n        />\n      </div>\n    )\n  },\n)\n\nexport default BaseLinearDisplay\nexport { Tooltip }\n","import { getConf } from '@jbrowse/core/configuration'\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { getSession } from '@jbrowse/core/util'\nimport { ThemeProvider } from '@material-ui/core/styles'\nimport { observer, PropTypes } from 'mobx-react'\nimport { getSnapshot, isAlive, isStateTreeNode } from 'mobx-state-tree'\nimport React, { useEffect, useRef } from 'react'\nimport { hydrate, unmountComponentAtNode } from 'react-dom'\nimport type { BlockModel } from '../models/serverSideRenderedBlock'\n\nfunction ServerSideRenderedContent(props: { model: BlockModel }) {\n  const ssrContainerNode = useRef<HTMLDivElement>(null)\n  const hydrated = useRef(false)\n\n  const { model } = props\n  const session = getSession(model)\n  const theme = createJBrowseTheme(getConf(session, 'theme'))\n\n  useEffect(() => {\n    const domNode = ssrContainerNode.current\n    const isHydrated = hydrated.current\n    function doHydrate() {\n      const {\n        data,\n        html,\n        filled,\n        renderProps,\n        renderingComponent: RenderingComponent,\n      } = model\n      if (domNode && filled) {\n        if (isHydrated && domNode) {\n          unmountComponentAtNode(domNode)\n        }\n        domNode.innerHTML = html\n\n        // defer main-thread rendering and hydration for when\n        // we have some free time. helps keep the framerate up.\n        //\n        // note: the timeout param to rIC below helps when you are doing\n        // a long continuous scroll, it forces it to evaluate because\n        // otherwise the continuous scroll would never give it time to do\n        // so\n        requestIdleCallback(\n          () => {\n            if (!isAlive(model)) {\n              return\n            }\n\n            const { region } = model\n            if (!isAlive(region)) {\n              return\n            }\n\n            const serializedRegion = isStateTreeNode(region)\n              ? getSnapshot(region)\n              : region\n            hydrate(\n              <ThemeProvider theme={theme}>\n                <RenderingComponent\n                  {...data}\n                  regions={[serializedRegion]}\n                  {...renderProps}\n                />\n              </ThemeProvider>,\n              domNode,\n            )\n            hydrated.current = true\n          },\n          { timeout: 300 },\n        )\n      }\n    }\n\n    doHydrate()\n\n    return () => {\n      if (domNode && isHydrated) {\n        unmountComponentAtNode(domNode)\n      }\n    }\n  }, [model, theme])\n\n  return (\n    <div\n      ref={ssrContainerNode}\n      data-html-size={model.html.length}\n      className=\"ssr-container\"\n    />\n  )\n}\n\nServerSideRenderedContent.propTypes = {\n  model: PropTypes.observableObject.isRequired,\n}\n\nexport default observer(ServerSideRenderedContent)\n","import { makeStyles } from '@material-ui/core/styles'\nimport Typography from '@material-ui/core/Typography'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport { getParent } from 'mobx-state-tree'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport PropTypes from 'prop-types'\nimport React, { useEffect, useState } from 'react'\nimport Button from '@material-ui/core/Button'\nimport RefreshIcon from '@material-ui/icons/Refresh'\nimport ServerSideRenderedContent from './ServerSideRenderedContent'\n\nconst useStyles = makeStyles(theme => ({\n  loading: {\n    paddingLeft: '0.6em',\n    backgroundColor: theme.palette.action.disabledBackground,\n    backgroundImage:\n      'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n    height: '100%',\n    width: '100%',\n    pointerEvents: 'none',\n  },\n  blockMessage: {\n    width: '100%',\n    background: theme.palette.action.disabledBackground,\n    padding: theme.spacing(2),\n    pointerEvents: 'none',\n    textAlign: 'center',\n  },\n  blockError: {\n    padding: theme.spacing(2),\n    width: '100%',\n    whiteSpace: 'normal',\n    color: theme.palette.error.main,\n    overflowY: 'auto',\n  },\n  blockReactNodeMessage: {\n    width: '100%',\n    background: theme.palette.action.disabledBackground,\n    padding: theme.spacing(2),\n    textAlign: 'center',\n  },\n  dots: {\n    '&::after': {\n      display: 'inline-block',\n      animation: '$ellipsis 1.5s infinite',\n      content: '\".\"',\n      width: '1em',\n      textAlign: 'left',\n    },\n  },\n  '@keyframes ellipsis': {\n    '0%': {\n      content: '\".\"',\n    },\n    '33%': {\n      content: '\"..\"',\n    },\n    '66%': {\n      content: '\"...\"',\n    },\n  },\n}))\n\nfunction Repeater({ children }: { children: React.ReactNode }) {\n  return (\n    <div style={{ display: 'flex' }}>\n      {children}\n      {children}\n    </div>\n  )\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst LoadingMessage = observer(({ model }: { model: any }) => {\n  // only show the loading message after 300ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  const classes = useStyles()\n  useEffect(() => {\n    const timeout = setTimeout(() => setShown(true), 300)\n    return () => clearTimeout(timeout)\n  }, [])\n\n  const { status: blockStatus } = model\n  const { message: displayStatus } = getParent(model, 2)\n  const status = displayStatus || blockStatus\n  return shown ? (\n    <div className={classes.loading}>\n      <div className={classes.dots}>{status ? `${status}` : 'Loading'}</div>\n    </div>\n  ) : null\n})\n\nfunction BlockMessage({\n  messageContent,\n}: {\n  messageContent: string | React.ReactNode\n}) {\n  const classes = useStyles()\n\n  return typeof messageContent === 'string' ? (\n    <Typography variant=\"body2\" className={classes.blockMessage}>\n      {messageContent}\n    </Typography>\n  ) : (\n    <div className={classes.blockReactNodeMessage}>{messageContent}</div>\n  )\n}\nBlockMessage.propTypes = {\n  messageContent: PropTypes.oneOfType([PropTypes.string, PropTypes.node])\n    .isRequired,\n}\n\nfunction BlockError({\n  error,\n  reload,\n  displayHeight,\n}: {\n  error: Error | string\n  reload: () => void\n  displayHeight: number\n}) {\n  const classes = useStyles()\n  const errorMessage = typeof error === 'string' ? error : error.message\n  return (\n    <div className={classes.blockError} style={{ height: displayHeight }}>\n      {reload ? (\n        <>\n          <Button\n            data-testid=\"reload_button\"\n            onClick={reload}\n            startIcon={<RefreshIcon />}\n          >\n            Reload\n          </Button>\n          {errorMessage}\n        </>\n      ) : (\n        <Typography color=\"error\" variant=\"body2\">\n          {errorMessage}\n        </Typography>\n      )}\n    </div>\n  )\n}\nBlockError.propTypes = {\n  error: MobxPropTypes.objectOrObservableObject.isRequired,\n  reload: PropTypes.func,\n}\nBlockError.defaultProps = {\n  reload: undefined,\n}\n\nconst ServerSideRenderedBlockContent = observer(\n  ({\n    model,\n  }: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    model: any\n  }) => {\n    if (model.error) {\n      return (\n        <Repeater>\n          <BlockError\n            error={model.error}\n            reload={model.reload}\n            displayHeight={getParentRenderProps(model).displayModel.height}\n          />\n        </Repeater>\n      )\n    }\n    if (model.message) {\n      return (\n        <Repeater>\n          <BlockMessage messageContent={model.message} />\n        </Repeater>\n      )\n    }\n    if (!model.filled) {\n      return (\n        <Repeater>\n          <LoadingMessage model={model} />\n        </Repeater>\n      )\n    }\n\n    return <ServerSideRenderedContent model={model} />\n  },\n)\n\nexport default ServerSideRenderedBlockContent\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types, getParent, isAlive, cast, Instance } from 'mobx-state-tree'\nimport { Component } from 'react'\nimport { getConf, readConfObject } from '@jbrowse/core/configuration'\nimport { Region } from '@jbrowse/core/util/types/mst'\n\nimport {\n  assembleLocString,\n  makeAbortableReaction,\n  getSession,\n} from '@jbrowse/core/util'\nimport {\n  getTrackAssemblyNames,\n  getRpcSessionId,\n} from '@jbrowse/core/util/tracks'\n\nimport ServerSideRenderedBlockContent from '../components/ServerSideRenderedBlockContent'\n\n// the MST state of a single server-side-rendered block in a display\nconst blockState = types\n  .model('BlockState', {\n    key: types.string,\n    region: Region,\n    isLeftEndOfDisplayedRegion: false,\n    isRightEndOfDisplayedRegion: false,\n  })\n  // NOTE: all this volatile stuff has to be filled in at once, so that it stays consistent\n  .volatile(() => ({\n    renderInProgress: undefined as AbortController | undefined,\n    filled: false,\n    data: undefined as any,\n    html: '',\n    status: '',\n    error: undefined as Error | undefined,\n    message: undefined as string | undefined,\n    maxHeightReached: false,\n    ReactComponent: ServerSideRenderedBlockContent,\n    renderingComponent: undefined as any,\n    renderProps: undefined as any,\n  }))\n  .actions(self => {\n    let renderInProgress: undefined | AbortController\n    return {\n      afterAttach() {\n        const display = getParent<any>(self, 2)\n        makeAbortableReaction(\n          self as any,\n          renderBlockData,\n          renderBlockEffect as any, // reaction doesn't expect async here\n          {\n            name: `${display.id}/${assembleLocString(self.region)} rendering`,\n            delay: display.renderDelay,\n            fireImmediately: true,\n          },\n          this.setLoading,\n          this.setRendered,\n          this.setError,\n        )\n      },\n      setStatus(message: string) {\n        self.status = message\n      },\n      setLoading(abortController: AbortController) {\n        if (renderInProgress !== undefined) {\n          if (!renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n        }\n        self.filled = false\n        self.message = undefined\n        self.html = ''\n        self.data = undefined\n        self.error = undefined\n        self.maxHeightReached = false\n        self.renderingComponent = undefined\n        self.renderProps = undefined\n        renderInProgress = abortController\n      },\n      setMessage(messageText: string) {\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        self.filled = false\n        self.message = messageText\n        self.html = ''\n        self.data = undefined\n        self.error = undefined\n        self.maxHeightReached = false\n        self.renderingComponent = undefined\n        self.renderProps = undefined\n        renderInProgress = undefined\n      },\n      setRendered(\n        props:\n          | {\n              data: any\n              html: any\n              maxHeightReached: boolean\n              renderingComponent: Component\n              renderProps: any\n            }\n          | undefined,\n      ) {\n        if (!props) {\n          return\n        }\n        const {\n          data,\n          html,\n          maxHeightReached,\n          renderingComponent,\n          renderProps,\n        } = props\n        self.filled = true\n        self.message = undefined\n        self.html = html\n        self.data = data\n        self.error = undefined\n        self.maxHeightReached = maxHeightReached\n        self.renderingComponent = renderingComponent\n        self.renderProps = renderProps\n        renderInProgress = undefined\n      },\n      setError(error: Error) {\n        console.error(error)\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        // the rendering failed for some reason\n        self.filled = false\n        self.message = undefined\n        self.html = ''\n        self.data = undefined\n        self.maxHeightReached = false\n        self.error = error\n        self.renderingComponent = undefined\n        self.renderProps = undefined\n        renderInProgress = undefined\n      },\n      reload() {\n        self.renderInProgress = undefined\n        self.filled = false\n        self.data = undefined\n        self.html = ''\n        self.error = undefined\n        self.message = undefined\n        self.maxHeightReached = false\n        self.ReactComponent = ServerSideRenderedBlockContent\n        self.renderingComponent = undefined\n        self.renderProps = undefined\n        getParent(self, 2).reload()\n      },\n      beforeDestroy() {\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        const display = getParent(self, 2)\n        const { rpcManager } = getSession(self)\n        const { rendererType } = display\n        const { renderArgs } = renderBlockData(cast(self))\n        rendererType\n          .freeResourcesInClient(\n            rpcManager,\n            JSON.parse(JSON.stringify(renderArgs)),\n          )\n          .catch((e: Error) => {\n            // just console.error if it's something while it's being destroyed\n            console.warn('Error while destroying block', e)\n          })\n      },\n    }\n  })\n\nexport default blockState\nexport type BlockStateModel = typeof blockState\nexport type BlockModel = Instance<BlockStateModel>\n// calls the render worker to render the block content\n// not using a flow for this, because the flow doesn't\n// work with autorun\nfunction renderBlockData(self: Instance<BlockStateModel>) {\n  try {\n    const { assemblyManager, rpcManager } = getSession(self)\n    let display = getParent(self)\n    while (!(display.configuration && getConf(display, 'displayId'))) {\n      display = getParent(display)\n    }\n    const assemblyNames = getTrackAssemblyNames(display.parentTrack)\n    let cannotBeRenderedReason\n    if (!assemblyNames.includes(self.region.assemblyName)) {\n      let matchFound = false\n      assemblyNames.forEach((assemblyName: string) => {\n        const assembly = assemblyManager.get(assemblyName)\n        if (assembly && assembly.aliases.includes(self.region.assemblyName))\n          matchFound = true\n      })\n      if (!matchFound) {\n        cannotBeRenderedReason = `region assembly (${self.region.assemblyName}) does not match track assemblies (${assemblyNames})`\n      }\n    }\n    if (!cannotBeRenderedReason) {\n      cannotBeRenderedReason = display.regionCannotBeRendered(self.region)\n    }\n    const { renderProps } = display\n    const { rendererType } = display\n    const { config } = renderProps\n    // This line is to trigger the mobx reaction when the config changes\n    // It won't trigger the reaction if it doesn't think we're accessing it\n    readConfObject(config)\n\n    const { adapterConfig } = display\n\n    const sessionId = getRpcSessionId(display)\n\n    return {\n      rendererType,\n      rpcManager,\n      renderProps,\n      cannotBeRenderedReason,\n      displayError: display.error,\n      renderArgs: {\n        statusCallback: (message: string) => {\n          if (isAlive(self)) {\n            self.setStatus(message)\n          }\n        },\n        assemblyName: self.region.assemblyName,\n        regions: [self.region],\n        adapterConfig,\n        rendererType: rendererType.name,\n        renderProps,\n        sessionId,\n        blockKey: self.key,\n        timeout: 1000000, // 10000,\n      },\n    }\n  } catch (error) {\n    return {\n      displayError: error,\n    }\n  }\n}\n\ninterface RenderProps {\n  displayError: Error\n  rendererType: any\n  renderProps: { [key: string]: any }\n  rpcManager: { call: Function }\n  cannotBeRenderedReason: string\n  renderArgs: { [key: string]: any }\n}\n\ninterface ErrorProps {\n  displayError: string\n}\n\nasync function renderBlockEffect(\n  props: RenderProps | ErrorProps,\n  _: unknown,\n  self: Instance<BlockStateModel>,\n) {\n  const {\n    rendererType,\n    renderProps,\n    rpcManager,\n    renderArgs,\n    cannotBeRenderedReason,\n    displayError,\n  } = props as RenderProps\n  if (!isAlive(self)) {\n    return undefined\n  }\n\n  if (displayError) {\n    self.setError(displayError)\n    return undefined\n  }\n  if (cannotBeRenderedReason) {\n    self.setMessage(cannotBeRenderedReason)\n    return undefined\n  }\n\n  if (renderProps.notReady) {\n    return undefined\n  }\n\n  const { html, maxHeightReached, ...data } = await rendererType.renderInClient(\n    rpcManager,\n    renderArgs,\n  )\n  return {\n    data,\n    html,\n    maxHeightReached,\n    renderingComponent: rendererType.ReactComponent,\n    renderProps,\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport {\n  getContainingView,\n  getSession,\n  isSelectionContainer,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport CompositeMap from '@jbrowse/core/util/compositeMap'\nimport { Feature, isFeature } from '@jbrowse/core/util/simpleFeature'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport Button from '@material-ui/core/Button'\nimport Typography from '@material-ui/core/Typography'\nimport MenuOpenIcon from '@material-ui/icons/MenuOpen'\nimport { autorun } from 'mobx'\nimport { addDisposer, Instance, isAlive, types } from 'mobx-state-tree'\nimport RBush from 'rbush'\nimport React from 'react'\nimport { Tooltip } from '../components/BaseLinearDisplay'\nimport BlockState from './serverSideRenderedBlock'\nimport { LinearGenomeViewModel } from '../../LinearGenomeView'\n\nexport interface Layout {\n  minX: number\n  minY: number\n  maxX: number\n  maxY: number\n  name: string\n}\ntype LayoutRecord = [number, number, number, number]\n\nconst minDisplayHeight = 20\nconst defaultDisplayHeight = 100\nexport const BaseLinearDisplay = types\n  .compose(\n    'BaseLinearDisplay',\n    BaseDisplay,\n    types.model({\n      height: types.optional(\n        types.refinement(\n          'displayHeight',\n          types.number,\n          n => n >= minDisplayHeight,\n        ),\n        defaultDisplayHeight,\n      ),\n      blockState: types.map(BlockState),\n    }),\n  )\n  .volatile(() => ({\n    message: '',\n    featureIdUnderMouse: undefined as undefined | string,\n    contextMenuFeature: undefined as undefined | Feature,\n    additionalContextMenuItemCallbacks: [] as Function[],\n\n    scrollTop: 0,\n    userBpPerPxLimit: undefined as undefined | number,\n  }))\n  .views(self => ({\n    /**\n     * set limit to config amount, or user amount if they force load,\n     */\n    get maxViewBpPerPx() {\n      return self.userBpPerPxLimit || getConf(self, 'maxDisplayedBpPerPx')\n    },\n    get blockType(): 'staticBlocks' | 'dynamicBlocks' {\n      return 'staticBlocks'\n    },\n\n    /**\n     * how many milliseconds to wait for the display to\n     * \"settle\" before re-rendering a block\n     */\n    get renderDelay() {\n      return 50\n    },\n\n    get TooltipComponent(): React.FC<any> {\n      return (Tooltip as unknown) as React.FC\n    },\n\n    get blockDefinitions() {\n      const { blockType } = this\n      const view = getContainingView(self) as LinearGenomeViewModel\n      if (!view.initialized) {\n        throw new Error('view not initialized yet')\n      }\n      return view[blockType]\n    },\n\n    /**\n     * returns a string feature ID if the globally-selected object\n     * is probably a feature\n     */\n    get selectedFeatureId() {\n      if (isAlive(self)) {\n        const session = getSession(self)\n        const { selection } = session\n        // does it quack like a feature?\n        if (isFeature(selection)) {\n          return selection.id()\n        }\n      }\n      return undefined\n    },\n    /**\n     * if a display-level message should be displayed instead of the blocks,\n     * make this return a react component\n     */\n    get DisplayMessageComponent() {\n      return undefined as undefined | React.FC<any>\n    },\n  }))\n  .views(self => {\n    let stale = false // used to make rtree refresh, the mobx reactivity fails for some reason\n    let rbush: Record<string, RBush<Layout>> = {}\n    return {\n      /**\n       * a CompositeMap of `featureId -> feature obj` that\n       * just looks in all the block data for that feature\n       */\n      get features() {\n        const featureMaps = []\n        for (const block of self.blockState.values()) {\n          if (block.data && block.data.features)\n            featureMaps.push(block.data.features)\n        }\n        stale = true\n        return new CompositeMap<string, Feature>(featureMaps)\n      },\n\n      get featureUnderMouse() {\n        return self.featureIdUnderMouse\n          ? this.features.get(self.featureIdUnderMouse)\n          : undefined\n      },\n\n      /**\n       * returns per-base block layouts as the data structure\n       * `Map<blockKey, Map<featureId, LayoutRecord>>`\n       *\n       * this per-block is needed to avoid cross-contamination of\n       * layouts across blocks especially when building the rtree\n       */\n      get blockLayoutFeatures() {\n        const layoutMaps = new Map<string, Map<string, LayoutRecord>>()\n        for (const block of self.blockState.values()) {\n          if (block.data && block.data.layout && block.data.layout.rectangles) {\n            layoutMaps.set(block.key, block.data.layout.rectangles)\n          }\n        }\n        stale = true\n        return layoutMaps\n      },\n      /**\n       * a CompositeMap of `featureId -> feature obj` that\n       * just looks in all the block data for that feature\n       *\n       * when you are not using the rtree you can use this\n       * method because it still provides a stable reference\n       * of a featureId to a layout record (when using the\n       * rtree, you cross contaminate the coordinates)\n       */\n      get layoutFeatures() {\n        const layoutMaps = []\n        for (const block of self.blockState.values()) {\n          if (block.data && block.data.layout && block.data.layout.rectangles) {\n            layoutMaps.push(block.data.layout.rectangles)\n          }\n        }\n        stale = true // make rtree refresh\n        return new CompositeMap<string, LayoutRecord>(layoutMaps)\n      },\n\n      get rtree() {\n        if (stale) {\n          rbush = {} as Record<string, RBush<Layout>>\n          for (const [blockKey, layoutFeatures] of this.blockLayoutFeatures) {\n            rbush[blockKey] = new RBush()\n            const r = rbush[blockKey]\n            for (const [key, layout] of layoutFeatures) {\n              r.insert({\n                minX: layout[0],\n                minY: layout[1],\n                maxX: layout[2],\n                maxY: layout[3],\n                name: key,\n              })\n            }\n          }\n          stale = false\n        }\n        return rbush\n      },\n      getFeatureOverlapping(blockKey: string, x: number, y: number) {\n        const rect = { minX: x, minY: y, maxX: x + 1, maxY: y + 1 }\n        const rtree = this.rtree[blockKey]\n        return rtree && rtree.collides(rect) ? rtree.search(rect) : []\n      },\n    }\n  })\n  .actions(self => ({\n    afterAttach() {\n      // watch the parent's blocks to update our block state when they change\n      const blockWatchDisposer = autorun(() => {\n        // create any blocks that we need to create\n        const blocksPresent: { [key: string]: boolean } = {}\n        const view = getContainingView(self) as LinearGenomeViewModel\n        if (view.initialized) {\n          self.blockDefinitions.contentBlocks.forEach(block => {\n            blocksPresent[block.key] = true\n            if (!self.blockState.has(block.key)) {\n              this.addBlock(block.key, block)\n            }\n          })\n          // delete any blocks we need go delete\n          self.blockState.forEach((_, key) => {\n            if (!blocksPresent[key]) this.deleteBlock(key)\n          })\n        }\n      })\n\n      addDisposer(self, blockWatchDisposer)\n    },\n    setHeight(displayHeight: number) {\n      if (displayHeight > minDisplayHeight) self.height = displayHeight\n      else self.height = minDisplayHeight\n      return self.height\n    },\n    resizeHeight(distance: number) {\n      const oldHeight = self.height\n      const newHeight = this.setHeight(self.height + distance)\n      return newHeight - oldHeight\n    },\n    setScrollTop(scrollTop: number) {\n      self.scrollTop = scrollTop\n    },\n    // sets the new bpPerPxLimit if user chooses to force load\n    setUserBpPerPxLimit(limit: number) {\n      self.userBpPerPxLimit = limit\n    },\n    // base display reload does nothing, see specialized displays for details\n    setMessage(message: string) {\n      self.message = message\n    },\n    addBlock(key: string, block: BaseBlock) {\n      self.blockState.set(\n        key,\n        BlockState.create({\n          key,\n          region: block.toRegion(),\n        }),\n      )\n    },\n    deleteBlock(key: string) {\n      self.blockState.delete(key)\n    },\n    selectFeature(feature: Feature) {\n      const session = getSession(self)\n      if (isSessionModelWithWidgets(session)) {\n        const featureWidget = session.addWidget(\n          'BaseFeatureWidget',\n          'baseFeature',\n          { featureData: feature.toJSON() },\n        )\n        session.showWidget(featureWidget)\n      }\n      if (isSelectionContainer(session)) {\n        session.setSelection(feature)\n      }\n    },\n    clearFeatureSelection() {\n      const session = getSession(self)\n      session.clearSelection()\n    },\n    setFeatureIdUnderMouse(feature: string | undefined) {\n      self.featureIdUnderMouse = feature\n    },\n    reload() {\n      const temp = JSON.parse(JSON.stringify(self.blockState))\n      Object.keys(temp).forEach(blockState => {\n        temp[blockState].key += '-reload'\n      })\n      self.blockState = temp\n    },\n    addAdditionalContextMenuItemCallback(callback: Function) {\n      self.additionalContextMenuItemCallbacks.push(callback)\n    },\n    setContextMenuFeature(feature?: Feature) {\n      self.contextMenuFeature = feature\n    },\n  }))\n  .views(self => ({\n    /**\n     * @param region -\n     * @returns falsy if the region is fine to try rendering. Otherwise,\n     *  return a react node + string of text.\n     *  string of text describes why it cannot be rendered\n     *  react node allows user to force load at current setting\n     */\n    regionCannotBeRendered(/* region */) {\n      const view = getContainingView(self) as LinearGenomeViewModel\n      if (view && view.bpPerPx > self.maxViewBpPerPx) {\n        return (\n          <>\n            <Typography component=\"span\" variant=\"body2\">\n              Zoom in to see features or{' '}\n            </Typography>\n            <Button\n              data-testid=\"reload_button\"\n              onClick={() => {\n                self.setUserBpPerPxLimit(view.bpPerPx)\n                self.reload()\n              }}\n              variant=\"outlined\"\n            >\n              Force Load\n            </Button>\n            <Typography component=\"span\" variant=\"body2\">\n              (force load may be slow)\n            </Typography>\n          </>\n        )\n      }\n      return undefined\n    },\n\n    get trackMenuItems(): MenuItem[] {\n      return []\n    },\n    // distinct set of display items that are particular to this display type. for\n    // base, there are none\n    //\n    // note: this attribute is helpful when composing together multiple\n    // subdisplays so that you don't repeat the \"about this track\" from each\n    // child display\n    get composedTrackMenuItems(): MenuItem[] {\n      return []\n    },\n    get contextMenuItems() {\n      const { pluginManager } = getSession(self)\n      const contextMenuItems = self.contextMenuFeature\n        ? [\n            {\n              label: 'Open feature details',\n              icon: MenuOpenIcon,\n              onClick: () => {\n                if (self.contextMenuFeature) {\n                  self.selectFeature(self.contextMenuFeature)\n                }\n              },\n            },\n          ]\n        : []\n\n      self.additionalContextMenuItemCallbacks.forEach(callback => {\n        const menuItems = callback(self.contextMenuFeature, self, pluginManager)\n        contextMenuItems.push(...menuItems)\n      })\n      return contextMenuItems\n    },\n    get composedRenderProps() {\n      return {\n        ...getParentRenderProps(self),\n        displayModel: self,\n        onFeatureClick(_: unknown, featureId: string | undefined) {\n          const f = featureId || self.featureIdUnderMouse\n          if (!f) {\n            self.clearFeatureSelection()\n          } else {\n            const feature = self.features.get(f)\n            self.selectFeature(feature as Feature)\n          }\n        },\n        onClick() {\n          self.clearFeatureSelection()\n        },\n        // similar to click but opens a menu with further options\n        onFeatureContextMenu(_: unknown, featureId: string | undefined) {\n          const f = featureId || self.featureIdUnderMouse\n          if (!f) {\n            self.clearFeatureSelection()\n          } else {\n            // feature id under mouse passed to context menu\n            self.setContextMenuFeature(self.features.get(f))\n          }\n        },\n\n        onMouseMove(_: unknown, featureId: string | undefined) {\n          self.setFeatureIdUnderMouse(featureId)\n        },\n\n        onMouseLeave(_: unknown) {\n          self.setFeatureIdUnderMouse(undefined)\n        },\n\n        onContextMenu() {\n          self.setContextMenuFeature(undefined)\n          self.clearFeatureSelection()\n        },\n      }\n    },\n    get renderProps() {\n      return this.composedRenderProps\n    },\n  }))\n  .postProcessSnapshot(self => {\n    const { blockState, ...rest } = self\n    return rest\n  })\n\nexport type BaseLinearDisplayStateModel = typeof BaseLinearDisplay\nexport type BaseLinearDisplayModel = Instance<BaseLinearDisplayStateModel>\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '../BaseLinearDisplay'\n\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearBasicDisplay',\n    { renderer: pluginManager.pluggableConfigSchemaType('renderer') },\n    {\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration/configurationSchema'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { types } from 'mobx-state-tree'\nimport { BaseLinearDisplay } from '../BaseLinearDisplay'\n\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearBasicDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearBasicDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => ({\n      get renderProps() {\n        return {\n          ...self.composedRenderProps,\n          ...getParentRenderProps(self),\n          config: self.configuration.renderer,\n        }\n      },\n\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n    }))\n}\n","import SvgIcon, { SvgIconProps } from '@material-ui/core/SvgIcon'\nimport React from 'react'\n\n// Icons below come from https://material.io/resources/icons/?icon=line_style&style=baseline\nexport function ContentCopy(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\" />\n    </SvgIcon>\n  )\n}\n\nexport function ContentCut(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19,3L13,9L15,11L22,4V3M12,12.5A0.5,0.5 0 0,1 11.5,12A0.5,0.5 0 0,1 12,11.5A0.5,0.5 0 0,1 12.5,12A0.5,0.5 0 0,1 12,12.5M6,20A2,2 0 0,1 4,18C4,16.89 4.9,16 6,16A2,2 0 0,1 8,18C8,19.11 7.1,20 6,20M6,8A2,2 0 0,1 4,6C4,4.89 4.9,4 6,4A2,2 0 0,1 8,6C8,7.11 7.1,8 6,8M9.64,7.64C9.87,7.14 10,6.59 10,6A4,4 0 0,0 6,2A4,4 0 0,0 2,6A4,4 0 0,0 6,10C6.59,10 7.14,9.87 7.64,9.64L10,12L7.64,14.36C7.14,14.13 6.59,14 6,14A4,4 0 0,0 2,18A4,4 0 0,0 6,22A4,4 0 0,0 10,18C10,17.41 9.87,16.86 9.64,16.36L12,14L19,21H22V20L9.64,7.64Z\" />\n    </SvgIcon>\n  )\n}\n\nexport function ContentPaste(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z\" />\n    </SvgIcon>\n  )\n}\n\n//  format-list-checkbox from https://materialdesignicons.com/\nexport function TrackSelector(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M21 19v-2H8v2h13m0-6v-2H8v2h13M8 7h13V5H8v2M4 5v2h2V5H4M3 5a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V5m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z\" />\n    </SvgIcon>\n  )\n}\n","/**\n * Based on https://material-ui.com/components/autocomplete/#Virtualize.tsx\n */\nimport { Region } from '@jbrowse/core/util/types'\nimport { getSession } from '@jbrowse/core/util'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport ListSubheader from '@material-ui/core/ListSubheader'\nimport TextField, { TextFieldProps as TFP } from '@material-ui/core/TextField'\nimport Typography from '@material-ui/core/Typography'\nimport Autocomplete from '@material-ui/lab/Autocomplete'\nimport { observer } from 'mobx-react'\nimport { getSnapshot } from 'mobx-state-tree'\nimport React from 'react'\nimport { ListChildComponentProps, VariableSizeList } from 'react-window'\nimport { LinearGenomeViewModel } from '..'\n\nfunction renderRow(props: ListChildComponentProps) {\n  const { data, index, style } = props\n  return React.cloneElement(data[index], {\n    style: {\n      ...style,\n    },\n  })\n}\n\nconst OuterElementContext = React.createContext({})\n\nconst OuterElementType = React.forwardRef<HTMLDivElement>((props, ref) => {\n  const outerProps = React.useContext(OuterElementContext)\n  return <div ref={ref} {...props} {...outerProps} />\n})\n\n// Adapter for react-window\nconst ListboxComponent = React.forwardRef<HTMLDivElement>(\n  function ListboxComponent(props, ref) {\n    // eslint-disable-next-line react/prop-types\n    const { children, ...other } = props\n    const itemData = React.Children.toArray(children)\n    const itemCount = itemData.length\n    const itemSize = 36\n\n    const getChildSize = (child: React.ReactNode) => {\n      if (React.isValidElement(child) && child.type === ListSubheader) {\n        return 48\n      }\n\n      return itemSize\n    }\n\n    const getHeight = () => {\n      if (itemCount > 8) {\n        return 8 * itemSize\n      }\n      return itemData.map(getChildSize).reduce((a, b) => a + b, 0)\n    }\n\n    return (\n      <div ref={ref}>\n        <OuterElementContext.Provider value={other}>\n          <VariableSizeList\n            itemData={itemData}\n            height={getHeight()}\n            width=\"100%\"\n            key={itemCount}\n            outerElementType={OuterElementType}\n            innerElementType=\"ul\"\n            itemSize={(index: number) => getChildSize(itemData[index])}\n            overscanCount={5}\n            itemCount={itemCount}\n          >\n            {renderRow}\n          </VariableSizeList>\n        </OuterElementContext.Provider>\n      </div>\n    )\n  },\n)\n\nfunction RefNameAutocomplete({\n  model,\n  onSelect,\n  assemblyName,\n  value,\n  style,\n  TextFieldProps = {},\n}: {\n  model: LinearGenomeViewModel\n  onSelect: (region: Region | undefined) => void\n  assemblyName?: string\n  value?: string\n  style?: React.CSSProperties\n  TextFieldProps?: TFP\n}) {\n  const { assemblyManager } = getSession(model)\n  const assembly = assemblyName && assemblyManager.get(assemblyName)\n  const regions: Region[] = (assembly && assembly.regions) || []\n  const loading = !regions.length\n  const current = value || (regions.length ? regions[0].refName : undefined)\n\n  function onChange(_: unknown, newRegionName: string | null) {\n    if (newRegionName) {\n      const newRegion = regions.find(region => region.refName === newRegionName)\n      if (newRegion) {\n        // @ts-ignore\n        onSelect(getSnapshot(newRegion))\n      }\n    }\n  }\n\n  return (\n    <Autocomplete\n      id={`refNameAutocomplete-${model.id}`}\n      disableListWrap\n      disableClearable\n      ListboxComponent={\n        ListboxComponent as React.ComponentType<\n          React.HTMLAttributes<HTMLElement>\n        >\n      }\n      options={regions.map(region => region.refName)}\n      loading={loading}\n      value={current || ''}\n      disabled={!assemblyName || loading}\n      style={style}\n      onChange={onChange}\n      renderInput={params => {\n        const { helperText, InputProps = {} } = TextFieldProps\n        const TextFieldInputProps = {\n          ...params.InputProps,\n          ...InputProps,\n          endAdornment: (\n            <>\n              {loading ? <CircularProgress color=\"inherit\" size={20} /> : null}\n              {params.InputProps.endAdornment}\n            </>\n          ),\n        }\n        return (\n          <TextField\n            {...params}\n            {...TextFieldProps}\n            helperText={helperText}\n            InputProps={TextFieldInputProps}\n          />\n        )\n      }}\n      renderOption={regionName => <Typography noWrap>{regionName}</Typography>}\n    />\n  )\n}\n\nexport default observer(RefNameAutocomplete)\n","/**\n * Given a scale ( bp/px ) and minimum distances (px) between major and minor\n * gridlines, return an object like `{ majorPitch: bp, minorPitch: bp }` giving\n * the gridline pitches to use.\n */\nexport function chooseGridPitch(\n  scale: number,\n  minMajorPitchPx: number,\n  minMinorPitchPx: number,\n) {\n  scale = Math.abs(scale)\n  const minMajorPitchBp = minMajorPitchPx * scale\n  const majorMagnitude = parseInt(\n    Number(minMajorPitchBp).toExponential().split(/e/i)[1],\n    10,\n  )\n\n  let majorPitch = 10 ** majorMagnitude\n  while (majorPitch < minMajorPitchBp) {\n    majorPitch *= 2\n    if (majorPitch >= minMajorPitchBp) break\n    majorPitch *= 2.5\n  }\n\n  majorPitch = Math.max(majorPitch, 5)\n\n  const majorPitchPx = majorPitch / scale\n\n  let minorPitch = 0\n  if (!(majorPitch % 10) && majorPitchPx / 10 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 10\n  } else if (!(majorPitch % 5) && majorPitchPx / 5 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 5\n  } else if (!(majorPitch % 2) && majorPitchPx / 2 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 2\n  }\n\n  return { majorPitch, minorPitch }\n}\n\nexport function makeTicks(\n  start: number,\n  end: number,\n  bpPerPx: number,\n  emitMajor = true,\n  emitMinor = true,\n) {\n  const gridPitch = chooseGridPitch(bpPerPx, 60, 15)\n\n  let minBase = start\n  let maxBase = end\n  if (minBase === null || maxBase === null) return []\n\n  if (bpPerPx < 0) {\n    ;[minBase, maxBase] = [maxBase, minBase]\n  }\n\n  // add 20px additional on the right and left to allow us to draw the ends\n  // of labels that lie a little outside our region\n  minBase -= Math.abs(20 * bpPerPx) - 1\n  maxBase += Math.abs(20 * bpPerPx) + 1\n\n  const iterPitch = gridPitch.minorPitch || gridPitch.majorPitch\n  let index = 0\n  const ticks = []\n  for (\n    let base = Math.ceil(minBase / iterPitch) * iterPitch;\n    base < maxBase;\n    base += iterPitch\n  ) {\n    if (emitMinor && base % gridPitch.majorPitch) {\n      ticks.push({ type: 'minor', base: base - 1, index })\n      index += 1\n    } else if (emitMajor && !(base % (gridPitch.majorPitch * 2))) {\n      ticks.push({ type: 'labeledMajor', base: base - 1, index })\n      index += 1\n    } else if (emitMajor) {\n      ticks.push({ type: 'major', base: base - 1, index })\n      index += 1\n    }\n  }\n  return ticks\n}\n","import Popover from '@material-ui/core/Popover'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport Typography from '@material-ui/core/Typography'\nimport { stringify } from '@jbrowse/core/util'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport ReactPropTypes from 'prop-types'\nimport React, { useRef, useEffect, useState } from 'react'\nimport { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport { LinearGenomeViewStateModel, HEADER_OVERVIEW_HEIGHT } from '..'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => {\n  const background = theme.palette.tertiary\n    ? fade(theme.palette.tertiary.main, 0.7)\n    : fade(theme.palette.primary.main, 0.7)\n  return {\n    rubberBand: {\n      height: '100%',\n      background,\n      position: 'absolute',\n      zIndex: 10,\n      textAlign: 'center',\n      overflow: 'hidden',\n    },\n    rubberBandControl: {\n      cursor: 'crosshair',\n      width: '100%',\n      minHeight: 8,\n    },\n    rubberBandText: {\n      color: theme.palette.tertiary\n        ? theme.palette.tertiary.contrastText\n        : theme.palette.primary.contrastText,\n    },\n    popover: {\n      mouseEvents: 'none',\n      cursor: 'crosshair',\n    },\n    paper: {\n      paddingLeft: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n    },\n    guide: {\n      pointerEvents: 'none',\n      height: '100%',\n      width: 1,\n      position: 'absolute',\n      zIndex: 10,\n    },\n  }\n})\n\nfunction OverviewRubberBand({\n  model,\n  overview,\n  ControlComponent = <div />,\n}: {\n  model: LGV\n  overview: Base1DViewModel\n  ControlComponent?: React.ReactElement\n}) {\n  const [startX, setStartX] = useState<number>()\n  const [currentX, setCurrentX] = useState<number>()\n  const [guideX, setGuideX] = useState<number | undefined>()\n  const controlsRef = useRef<HTMLDivElement>(null)\n  const rubberBandRef = useRef(null)\n  const classes = useStyles()\n  const mouseDragging = startX !== undefined\n\n  useEffect(() => {\n    function globalMouseMove(event: MouseEvent) {\n      if (controlsRef.current && mouseDragging) {\n        const relativeX =\n          event.clientX - controlsRef.current.getBoundingClientRect().left\n        setCurrentX(relativeX)\n      }\n    }\n\n    function globalMouseUp() {\n      if (\n        controlsRef.current &&\n        startX !== undefined &&\n        currentX !== undefined\n      ) {\n        if (Math.abs(currentX - startX) > 3) {\n          model.zoomToDisplayedRegions(\n            overview.pxToBp(startX),\n            overview.pxToBp(currentX),\n          )\n        }\n      }\n      /* handling clicking and centering at a specific Bp */\n      if (\n        controlsRef.current &&\n        startX !== undefined &&\n        currentX === undefined\n      ) {\n        const clickedAt = overview.pxToBp(startX)\n        model.centerAt(\n          Math.round(clickedAt.coord),\n          clickedAt.refName,\n          clickedAt.index,\n        )\n      }\n      setStartX(undefined)\n      setCurrentX(undefined)\n\n      if (startX !== undefined) {\n        setGuideX(undefined)\n      }\n    }\n\n    function globalKeyDown(event: KeyboardEvent) {\n      if (event.key === 'Escape') {\n        setStartX(undefined)\n        setCurrentX(undefined)\n      }\n    }\n\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove, true)\n      window.addEventListener('mouseup', globalMouseUp, true)\n      window.addEventListener('keydown', globalKeyDown, true)\n      return () => {\n        window.removeEventListener('mousemove', globalMouseMove, true)\n        window.removeEventListener('mouseup', globalMouseUp, true)\n        window.removeEventListener('keydown', globalKeyDown, true)\n      }\n    }\n    return () => {}\n  }, [mouseDragging, currentX, startX, model, overview])\n\n  function mouseDown(event: React.MouseEvent<HTMLDivElement>) {\n    event.preventDefault()\n    event.stopPropagation()\n    if (controlsRef.current) {\n      setStartX(\n        event.clientX - controlsRef.current.getBoundingClientRect().left,\n      )\n    }\n  }\n\n  function mouseMove(event: React.MouseEvent<HTMLDivElement>) {\n    if (controlsRef.current) {\n      setGuideX(\n        event.clientX - controlsRef.current.getBoundingClientRect().left,\n      )\n    }\n  }\n\n  function mouseOut() {\n    setGuideX(undefined)\n  }\n\n  if (startX === undefined) {\n    return (\n      <div style={{ position: 'relative' }}>\n        {guideX !== undefined ? (\n          <Tooltip\n            open={!mouseDragging}\n            placement=\"top\"\n            title={stringify(overview.pxToBp(guideX))}\n            arrow\n          >\n            <div\n              className={classes.guide}\n              style={{\n                left: guideX,\n              }}\n            />\n          </Tooltip>\n        ) : null}\n        <div\n          className={classes.rubberBandControl}\n          role=\"presentation\"\n          ref={controlsRef}\n          onMouseDown={mouseDown}\n          onMouseOut={mouseOut}\n          onMouseMove={mouseMove}\n        >\n          {ControlComponent}\n        </div>\n      </div>\n    )\n  }\n\n  let left = startX || 0\n  let width = 0\n  if (startX !== undefined && currentX !== undefined) {\n    left = currentX < startX ? currentX : startX\n    width = currentX - startX\n  }\n  // calculate the start and end bp of drag\n  let leftBpOffset\n  let rightBpOffset\n  if (startX) {\n    leftBpOffset = overview.pxToBp(startX)\n    rightBpOffset = overview.pxToBp(startX + width)\n    if (currentX && currentX < startX) {\n      ;[leftBpOffset, rightBpOffset] = [rightBpOffset, leftBpOffset]\n    }\n  }\n\n  return (\n    <div style={{ position: 'relative' }}>\n      {rubberBandRef.current ? (\n        <>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'left',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'right',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>\n              {leftBpOffset ? stringify(leftBpOffset) : ''}\n            </Typography>\n          </Popover>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'right',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'left',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>\n              {rightBpOffset ? stringify(rightBpOffset) : ''}\n            </Typography>\n          </Popover>\n        </>\n      ) : null}\n      <div\n        ref={rubberBandRef}\n        className={classes.rubberBand}\n        style={{\n          left,\n          width: Math.abs(width),\n          height: HEADER_OVERVIEW_HEIGHT,\n        }}\n      />\n      <div\n        data-testid=\"rubberBand_controls\"\n        className={classes.rubberBandControl}\n        role=\"presentation\"\n        ref={controlsRef}\n        onMouseDown={mouseDown}\n        onMouseOut={mouseOut}\n        onMouseMove={mouseMove}\n      >\n        {ControlComponent}\n      </div>\n    </div>\n  )\n}\n\nOverviewRubberBand.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n  overview: MobxPropTypes.objectOrObservableObject.isRequired,\n  ControlComponent: ReactPropTypes.node,\n}\n\nOverviewRubberBand.defaultProps = {\n  ControlComponent: <div />,\n}\n\nexport default observer(OverviewRubberBand)\n","// import { Region } from '@jbrowse/core/util/types'\n// import { Region as MSTRegion } from '@jbrowse/core/util/types/mst'\nimport Base1DView, { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport { getSession } from '@jbrowse/core/util'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport Paper from '@material-ui/core/Paper'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React from 'react'\nimport clsx from 'clsx'\nimport { Typography } from '@material-ui/core'\nimport {\n  LinearGenomeViewStateModel,\n  HEADER_BAR_HEIGHT,\n  HEADER_OVERVIEW_HEIGHT,\n} from '..'\nimport { chooseGridPitch } from '../util'\nimport OverviewRubberBand from './OverviewRubberBand'\n\nconst useStyles = makeStyles(theme => {\n  const scaleBarColor = theme.palette.tertiary\n    ? theme.palette.tertiary.light\n    : theme.palette.primary.light\n  return {\n    scaleBar: {\n      display: 'flex',\n      width: '100%',\n      height: HEADER_OVERVIEW_HEIGHT,\n      overflow: 'hidden',\n    },\n    scaleBarContig: {\n      backgroundColor: theme.palette.background.default,\n      position: 'relative',\n      borderColor: theme.palette.text.primary,\n      borderBottomColor: 'black',\n    },\n    scaleBarContigForward: {\n      backgroundImage: `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")`,\n      backgroundRepeat: 'repeat',\n    },\n    scaleBarContigReverse: {\n      backgroundImage: `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")`,\n      backgroundRepeat: 'repeat',\n    },\n    scaleBarRegionIncompleteLeft: {\n      width: 10,\n      height: 17.5,\n      background: `linear-gradient(-225deg,black 3px, transparent 1px),\n      linear-gradient(45deg, black 3px, transparent 1px)`,\n      backgroundRepeat: 'repeat-y',\n      backgroundSize: '10px 8px',\n      borderTopLeftRadius: '2px',\n      borderBottomLeftRadius: '2px',\n      float: 'left',\n    },\n    scaleBarRegionIncompleteRight: {\n      width: 10,\n      height: 17.5,\n      background: `linear-gradient(225deg, black 3px, transparent 1px),\n      linear-gradient(-45deg, black 3px, transparent 1px)`,\n      backgroundRepeat: 'repeat-y',\n      backgroundSize: '10px 8px',\n      borderTopRightRadius: '2px',\n      borderBottomRightRadius: '2px',\n      float: 'right',\n    },\n    scaleBarRefName: {\n      position: 'absolute',\n      fontWeight: 'bold',\n      lineHeight: 'normal',\n      pointerEvents: 'none',\n      left: 5,\n    },\n    scaleBarLabel: {\n      height: HEADER_OVERVIEW_HEIGHT,\n      width: 1,\n      position: 'absolute',\n      display: 'flex',\n      justifyContent: 'center',\n      pointerEvents: 'none',\n    },\n    scaleBarVisibleRegion: {\n      height: '100%',\n      background: fade(scaleBarColor, 0.3),\n      position: 'absolute',\n      top: -1,\n      borderWidth: 1,\n      borderStyle: 'solid',\n      borderColor: fade(scaleBarColor, 0.8),\n      boxSizing: 'content-box',\n    },\n    overview: {\n      height: HEADER_BAR_HEIGHT,\n      position: 'relative',\n    },\n    overviewSvg: { display: 'block', position: 'absolute' },\n  }\n})\n\nconst wholeSeqSpacer = 2\nconst Polygon = observer(\n  ({\n    model,\n    overview,\n  }: {\n    model: LGV\n    overview: Instance<Base1DViewModel>\n  }) => {\n    const theme = useTheme()\n    const classes = useStyles()\n    const { offsetPx, width, bpPerPx, dynamicBlocks: visibleRegions } = model\n\n    const blocks = visibleRegions\n      .getBlocks()\n      .filter(block => block.refName !== undefined)\n    overview.setVolatileWidth(width)\n    overview.showAllRegions()\n    const polygonColor = theme.palette.tertiary\n      ? theme.palette.tertiary.light\n      : theme.palette.primary.light\n\n    let bottomLeft: number | undefined\n    let newTopLeft: number | undefined\n    let points: (number | undefined)[][] = []\n    // Iterating over blocks to find the rightmost (endPx and topRight)\n    // and leftmost (startPx and topLeft) points in order to draw a single polygon\n    blocks.forEach((region, index) => {\n      const startPx = region.offsetPx - offsetPx\n      const endPx = startPx + (region.end - region.start) / bpPerPx\n      let topLeft = overview.bpToPx({\n        refName: region.refName,\n        coord: region.start,\n        regionNumber: region.regionNumber,\n      })\n      let topRight = overview.bpToPx({\n        refName: region.refName,\n        coord: region.end,\n        regionNumber: region.regionNumber,\n      })\n      //  p1 right to -> p2  up to -> p3  left to -> p4 and back down to p1\n      if (region.reversed) {\n        ;[topLeft, topRight] = [topRight, topLeft]\n      }\n      if (index === 0) {\n        // leftmost bottom and top points\n        bottomLeft = startPx\n        newTopLeft = topLeft\n      }\n      points = [\n        [startPx, HEADER_BAR_HEIGHT],\n        [endPx, HEADER_BAR_HEIGHT],\n        [topRight, 0],\n        [topLeft, 0],\n      ]\n      if (index === blocks.length - 1) {\n        points = [\n          [bottomLeft, HEADER_BAR_HEIGHT],\n          [endPx, HEADER_BAR_HEIGHT],\n          [topRight, 0],\n          [newTopLeft, 0],\n        ]\n      }\n    })\n    return (\n      <svg\n        height={HEADER_BAR_HEIGHT}\n        width=\"100%\"\n        className={classes.overviewSvg}\n      >\n        {points && (\n          <polygon\n            points={points.toString()}\n            fill={fade(polygonColor, 0.3)}\n            stroke={fade(polygonColor, 0.8)}\n          />\n        )}\n      </svg>\n    )\n  },\n)\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst ScaleBar = observer(({ model, scale }: { model: LGV; scale: number }) => {\n  const classes = useStyles()\n  const { displayedRegions, dynamicBlocks: visibleRegions } = model\n  const { assemblyManager } = getSession(model)\n  const gridPitch = chooseGridPitch(scale, 120, 15)\n\n  return (\n    <div className={classes.scaleBar}>\n      {/* this is the entire scale bar */}\n      {displayedRegions.map((seq, idx) => {\n        const assembly = assemblyManager.get(seq.assemblyName)\n        let refNameColor: string | undefined\n        if (assembly) {\n          refNameColor = assembly.getRefNameColor(seq.refName)\n        }\n        const regionLength = seq.end - seq.start\n        // boolean if displayed region length is smaller than its parent's\n        const parent = model.parentRegion(seq.assemblyName, seq.refName)\n        const incompleteRegion = parent\n          ? parent.end - parent.start > seq.end - seq.start\n          : false\n        // number of labels to draw in the overview scale bar\n        const numLabels = Math.floor(regionLength / gridPitch.majorPitch)\n        // calculating the number labels\n        const tickLabels = []\n        for (let index = 0; index < numLabels; index++) {\n          const offsetLabel = (index + 1) * gridPitch.majorPitch\n          tickLabels.push(\n            seq.reversed ? seq.end - offsetLabel : seq.start + offsetLabel,\n          )\n        }\n        return (\n          <Paper\n            key={`${JSON.stringify(seq)}-${idx.toLocaleString('en-US')}`}\n            variant=\"outlined\"\n            className={clsx(\n              classes.scaleBarContig,\n              seq.reversed\n                ? classes.scaleBarContigReverse\n                : classes.scaleBarContigForward,\n            )}\n            style={{\n              minWidth: regionLength / scale,\n              marginRight:\n                idx === displayedRegions.length - 1\n                  ? undefined\n                  : wholeSeqSpacer,\n              borderColor: refNameColor,\n            }}\n          >\n            {incompleteRegion && (\n              <div\n                className={classes.scaleBarRegionIncompleteLeft}\n                style={{\n                  backgroundImage: `linear-gradient(-225deg, ${refNameColor} 3px, transparent 1px),\n                linear-gradient(45deg, ${refNameColor} 3px, transparent 1px)`,\n                  backgroundSize: '10px 8px',\n                  backgroundRepeat: 'repeat-y',\n                }}\n              />\n            )}\n            {/* name of sequence */}\n            <Typography\n              style={{ color: refNameColor }}\n              className={classes.scaleBarRefName}\n            >\n              {seq.refName}\n            </Typography>\n\n            {/* where the rubberband selection boxes actually get drawn */}\n            {visibleRegions.map((r, visibleRegionIdx) => {\n              if (\n                seq.assemblyName === r.assemblyName &&\n                seq.refName === r.refName &&\n                r.regionNumber === idx\n              ) {\n                const leftStyle = r.reversed\n                  ? (seq.end - r.end) / scale - 1\n                  : (r.start - seq.start) / scale - 1\n                return (\n                  <div\n                    key={`${r.key}-${visibleRegionIdx}`}\n                    className={classes.scaleBarVisibleRegion}\n                    style={{\n                      width: Math.max((r.end - r.start) / scale, 1),\n                      left: leftStyle,\n                      pointerEvents: 'none',\n                    }}\n                  />\n                )\n              }\n              return null\n            })}\n            {/* the number labels drawn in overview scale bar*/}\n            {tickLabels.map((tickLabel, labelIdx) => (\n              <div\n                key={`${JSON.stringify(seq)}-${tickLabel}-${labelIdx}`}\n                className={classes.scaleBarLabel}\n                style={{\n                  left: ((labelIdx + 1) * gridPitch.majorPitch) / scale,\n                  pointerEvents: 'none',\n                  color: refNameColor,\n                }}\n              >\n                {tickLabel.toLocaleString('en-US')}\n              </div>\n            ))}\n            {incompleteRegion && (\n              <div\n                className={classes.scaleBarRegionIncompleteRight}\n                style={{\n                  backgroundImage: `linear-gradient(225deg, ${refNameColor} 3px, transparent 1px),\n              linear-gradient(-45deg, ${refNameColor} 3px, transparent 1px)`,\n                  backgroundSize: '10px 8px',\n                  backgroundRepeat: 'repeat-y',\n                }}\n              />\n            )}\n          </Paper>\n        )\n      })}\n    </div>\n  )\n})\n\nfunction OverviewScaleBar({\n  model,\n  children,\n}: {\n  model: LGV\n  children: React.ReactNode\n}) {\n  const classes = useStyles()\n  const { width, displayedRegions } = model\n\n  const overview = Base1DView.create({\n    displayedRegions: JSON.parse(JSON.stringify(displayedRegions)),\n  })\n\n  const scale =\n    model.totalBp / (width - (displayedRegions.length - 1) * wholeSeqSpacer)\n\n  if (!displayedRegions.length) {\n    return (\n      <>\n        <div className={classes.scaleBar}>\n          <LinearProgress\n            variant=\"indeterminate\"\n            style={{ marginTop: 4, width: '100%' }}\n          />\n        </div>\n        <div>{children}</div>\n      </>\n    )\n  }\n\n  return (\n    <div>\n      <OverviewRubberBand\n        model={model}\n        overview={overview}\n        ControlComponent={<ScaleBar model={model} scale={scale} />}\n      />\n      <div className={classes.overview}>\n        <Polygon model={model} overview={overview} />\n        {children}\n      </div>\n    </div>\n  )\n}\n\nexport default observer(OverviewScaleBar)\n","import React, { useState, useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport IconButton from '@material-ui/core/IconButton'\nimport Slider from '@material-ui/core/Slider'\nimport { makeStyles } from '@material-ui/core/styles'\nimport ZoomIn from '@material-ui/icons/ZoomIn'\nimport ZoomOut from '@material-ui/icons/ZoomOut'\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles({\n  container: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n  },\n  slider: {\n    width: 70,\n  },\n})\n\nfunction ZoomControls({ model }: { model: LinearGenomeViewModel }) {\n  const classes = useStyles()\n  const { maxBpPerPx, minBpPerPx, bpPerPx, scaleFactor } = model\n  const [value, setValue] = useState(-Math.log2(bpPerPx) * 100)\n  useEffect(() => {\n    setValue(-Math.log2(bpPerPx) * 100)\n  }, [setValue, bpPerPx])\n  return (\n    <div className={classes.container}>\n      <IconButton\n        data-testid=\"zoom_out\"\n        onClick={() => {\n          model.zoom(bpPerPx * 2)\n        }}\n        disabled={bpPerPx >= maxBpPerPx - 0.0001 || scaleFactor !== 1}\n        color=\"secondary\"\n      >\n        <ZoomOut />\n      </IconButton>\n\n      <Slider\n        className={classes.slider}\n        value={value}\n        min={-Math.log2(maxBpPerPx) * 100}\n        max={-Math.log2(minBpPerPx) * 100}\n        onChange={(_, val) => setValue(val as number)}\n        onChangeCommitted={() => model.zoomTo(2 ** (-value / 100))}\n        disabled={scaleFactor !== 1}\n      />\n      <IconButton\n        data-testid=\"zoom_in\"\n        onClick={() => {\n          model.zoom(model.bpPerPx / 2)\n        }}\n        disabled={bpPerPx <= minBpPerPx + 0.0001 || scaleFactor !== 1}\n        color=\"secondary\"\n      >\n        <ZoomIn />\n      </IconButton>\n    </div>\n  )\n}\n\nexport default observer(ZoomControls)\n","import { Region } from '@jbrowse/core/util/types'\nimport { getSession } from '@jbrowse/core/util'\nimport Button from '@material-ui/core/Button'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport FormGroup from '@material-ui/core/FormGroup'\nimport TextField from '@material-ui/core/TextField'\nimport Typography from '@material-ui/core/Typography'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React, { useCallback, useRef, useState } from 'react'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport SearchIcon from '@material-ui/icons/Search'\nimport ArrowForwardIcon from '@material-ui/icons/ArrowForward'\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack'\nimport { LinearGenomeViewStateModel, HEADER_BAR_HEIGHT } from '..'\nimport RefNameAutocomplete from './RefNameAutocomplete'\nimport OverviewScaleBar from './OverviewScaleBar'\nimport ZoomControls from './ZoomControls'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst WIDGET_HEIGHT = 32\nconst SPACING = 7\n\nconst useStyles = makeStyles(theme => ({\n  headerBar: {\n    height: HEADER_BAR_HEIGHT,\n    display: 'flex',\n  },\n  spacer: {\n    flexGrow: 1,\n  },\n  input: {},\n  headerRefName: {\n    minWidth: 100,\n  },\n  panButton: {\n    background: fade(theme.palette.background.paper, 0.8),\n    height: WIDGET_HEIGHT,\n    margin: SPACING,\n  },\n  bp: {\n    display: 'flex',\n    alignItems: 'center',\n    marginLeft: 5,\n  },\n  toggleButton: {\n    height: 44,\n    border: 'none',\n    margin: theme.spacing(0.5),\n  },\n  buttonSpacer: {\n    marginRight: theme.spacing(2),\n  },\n}))\n\nconst Controls = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  return (\n    <Button\n      onClick={model.activateTrackSelector}\n      className={classes.toggleButton}\n      title=\"Open track selector\"\n      value=\"track_select\"\n      color=\"secondary\"\n    >\n      <TrackSelectorIcon className={classes.buttonSpacer} />\n    </Button>\n  )\n})\n\nconst Search = observer(({ model }: { model: LGV }) => {\n  const [value, setValue] = useState<string | undefined>()\n  const inputRef = useRef<HTMLInputElement>(null)\n  const theme = useTheme()\n  const {\n    coarseVisibleLocStrings,\n    visibleLocStrings: nonCoarseVisibleLocStrings,\n  } = model\n\n  // use regular visibleLocStrings if coarseVisibleLocStrings is undefined\n  const visibleLocStrings =\n    coarseVisibleLocStrings || nonCoarseVisibleLocStrings\n\n  const session = getSession(model)\n\n  function navTo(locString: string) {\n    try {\n      model.navToLocString(locString)\n    } catch (e) {\n      console.warn(e)\n      session.notify(`${e}`, 'warning')\n    }\n  }\n\n  return (\n    <form\n      data-testid=\"search-form\"\n      onSubmit={event => {\n        event.preventDefault()\n        inputRef && inputRef.current && inputRef.current.blur()\n        value && navTo(value)\n\n        // need to manually call the action of blur here for\n        // react-testing-library\n        setValue(undefined)\n      }}\n    >\n      <TextField\n        inputRef={inputRef}\n        onFocus={() => setValue(visibleLocStrings)}\n        onBlur={() => setValue(undefined)}\n        onChange={event => setValue(event.target.value)}\n        variant=\"outlined\"\n        value={value === undefined ? visibleLocStrings : value}\n        style={{ margin: SPACING, marginLeft: SPACING * 3 }}\n        inputProps={{\n          'data-testid': 'search-input',\n        }}\n        // eslint-disable-next-line react/jsx-no-duplicate-props\n        InputProps={{\n          startAdornment: <SearchIcon />,\n          style: {\n            background: fade(theme.palette.background.paper, 0.8),\n            height: WIDGET_HEIGHT,\n          },\n        }}\n      />\n    </form>\n  )\n})\n\nfunction PanControls({ model }: { model: LGV }) {\n  const classes = useStyles()\n  return (\n    <>\n      <Button\n        variant=\"outlined\"\n        className={classes.panButton}\n        onClick={() => model.slide(-0.9)}\n      >\n        <ArrowBackIcon />\n      </Button>\n      <Button\n        variant=\"outlined\"\n        className={classes.panButton}\n        onClick={() => model.slide(0.9)}\n      >\n        <ArrowForwardIcon />\n      </Button>\n    </>\n  )\n}\n\nexport default observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  const theme = useTheme()\n  const { coarseDynamicBlocks: contentBlocks, displayedRegions } = model\n\n  const setDisplayedRegion = useCallback(\n    (region: Region | undefined) => {\n      if (region) {\n        model.setDisplayedRegions([region])\n        model.showAllRegions()\n      }\n    },\n    [model],\n  )\n\n  const { assemblyName, refName } = contentBlocks[0] || { refName: '' }\n\n  const controls = (\n    <div className={classes.headerBar}>\n      <Controls model={model} />\n      <div className={classes.spacer} />\n      <FormGroup row style={{ flexWrap: 'nowrap' }}>\n        <PanControls model={model} />\n        <RefNameAutocomplete\n          onSelect={setDisplayedRegion}\n          assemblyName={assemblyName}\n          value={displayedRegions.length > 1 ? '' : refName}\n          model={model}\n          TextFieldProps={{\n            variant: 'outlined',\n            className: classes.headerRefName,\n            style: { margin: SPACING },\n            InputProps: {\n              style: {\n                padding: 0,\n                height: WIDGET_HEIGHT,\n                background: fade(theme.palette.background.paper, 0.8),\n              },\n            },\n          }}\n        />\n        <Search model={model} />\n      </FormGroup>\n      <RegionWidth model={model} />\n      <ZoomControls model={model} />\n      <div className={classes.spacer} />\n    </div>\n  )\n\n  if (model.hideHeaderOverview) {\n    return controls\n  }\n\n  return <OverviewScaleBar model={model}>{controls}</OverviewScaleBar>\n})\n\nconst RegionWidth = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  const { coarseTotalBp } = model\n  return (\n    <Typography variant=\"body2\" color=\"textSecondary\" className={classes.bp}>\n      {`${Math.round(coarseTotalBp).toLocaleString('en-US')} bp`}\n    </Typography>\n  )\n})\n","import { getConf, readConfObject } from '@jbrowse/core/configuration'\nimport { Menu } from '@jbrowse/core/ui'\nimport { getSession, getContainingView } from '@jbrowse/core/util'\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport IconButton from '@material-ui/core/IconButton'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport Typography from '@material-ui/core/Typography'\nimport MoreVertIcon from '@material-ui/icons/MoreVert'\nimport DragIcon from '@material-ui/icons/DragIndicator'\nimport CloseIcon from '@material-ui/icons/Close'\n\nimport clsx from 'clsx'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React from 'react'\nimport { LinearGenomeViewStateModel } from '..'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    background: fade(theme.palette.background.paper, 0.8),\n    '&:hover': {\n      background: theme.palette.background.paper,\n    },\n    transition: theme.transitions.create(['background'], {\n      duration: theme.transitions.duration.shortest,\n    }),\n  },\n  trackName: {\n    margin: '0 auto',\n    width: '90%',\n    fontSize: '0.8rem',\n    pointerEvents: 'none',\n  },\n  dragHandle: {\n    cursor: 'grab',\n    color: '#135560',\n  },\n  dragHandleIcon: {\n    display: 'inline-block',\n    verticalAlign: 'middle',\n    pointerEvents: 'none',\n  },\n  iconButton: {\n    padding: theme.spacing(1),\n  },\n}))\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst TrackLabel = React.forwardRef(\n  (props: { track: BaseTrackModel; className?: string }, ref) => {\n    const classes = useStyles()\n    const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null)\n    const { track, className } = props\n    const view = getContainingView(track) as LGV\n    const session = getSession(track)\n    const trackConf = track.configuration\n    const trackId = getConf(track, 'trackId')\n\n    const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n      setAnchorEl(event.currentTarget)\n    }\n\n    const handleClose = () => {\n      setAnchorEl(null)\n    }\n\n    const onDragStart = (event: React.DragEvent<HTMLSpanElement>) => {\n      const target = event.target as HTMLElement\n      if (target.parentNode) {\n        event.dataTransfer.setDragImage(\n          target.parentNode as HTMLElement,\n          20,\n          20,\n        )\n        view.setDraggingTrackId(track.id)\n      }\n    }\n\n    const onDragEnd = () => {\n      view.setDraggingTrackId(undefined)\n    }\n\n    let trackName = getConf(track, 'name')\n    if (getConf(track, 'type') === 'ReferenceSequenceTrack') {\n      trackName = 'Reference Sequence'\n      session.assemblies.forEach(assembly => {\n        if (assembly.sequence === trackConf) {\n          trackName = `Reference Sequence (${readConfObject(assembly, 'name')})`\n        }\n      })\n    }\n\n    function handleMenuItemClick(_: unknown, callback: Function) {\n      callback()\n      handleClose()\n    }\n\n    return (\n      <>\n        <Paper ref={ref} className={clsx(className, classes.root)}>\n          <span\n            draggable\n            className={classes.dragHandle}\n            onDragStart={onDragStart}\n            onDragEnd={onDragEnd}\n            data-testid={`dragHandle-${view.id}-${trackId}`}\n          >\n            <DragIcon className={classes.dragHandleIcon} />\n          </span>\n          <IconButton\n            onClick={() => view.hideTrack(trackId)}\n            className={classes.iconButton}\n            title=\"close this track\"\n            color=\"secondary\"\n          >\n            <CloseIcon />\n          </IconButton>\n          <Typography\n            variant=\"body1\"\n            component=\"span\"\n            className={classes.trackName}\n          >\n            {trackName}\n          </Typography>\n          <IconButton\n            aria-controls=\"simple-menu\"\n            aria-haspopup=\"true\"\n            onClick={handleClick}\n            className={classes.iconButton}\n            color=\"secondary\"\n            data-testid=\"track_menu_icon\"\n            disabled={!track.trackMenuItems.length}\n          >\n            <MoreVertIcon />\n          </IconButton>\n        </Paper>\n        <Menu\n          anchorEl={anchorEl}\n          onMenuItemClick={handleMenuItemClick}\n          open={Boolean(anchorEl)}\n          onClose={handleClose}\n          menuItems={[\n            ...(session.getTrackActionMenuItems\n              ? session.getTrackActionMenuItems(trackConf)\n              : []),\n            ...track.trackMenuItems,\n          ].sort((a, b) => (b.priority || 0) - (a.priority || 0))}\n        />\n      </>\n    )\n  },\n)\n\nexport default observer(TrackLabel)\n","import React, { useEffect, useRef } from 'react'\nimport { observer } from 'mobx-react'\nimport { isAlive } from 'mobx-state-tree'\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { ResizeHandle } from '@jbrowse/core/ui'\nimport { useDebouncedCallback, getContainingView } from '@jbrowse/core/util'\nimport clsx from 'clsx'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport { LinearGenomeViewModel, RESIZE_HANDLE_HEIGHT } from '..'\nimport TrackLabel from './TrackLabel'\n\nconst useStyles = makeStyles(theme => ({\n  root: {},\n  resizeHandle: {\n    height: RESIZE_HANDLE_HEIGHT,\n    boxSizing: 'border-box',\n    position: 'relative',\n    zIndex: 2,\n  },\n  overlay: {\n    pointerEvents: 'none',\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: '100%',\n    zIndex: 3,\n    borderRadius: theme.shape.borderRadius,\n  },\n  renderingComponentContainer: {\n    position: 'absolute',\n    // -1 offset because of the 1px border of the Paper\n    left: -1,\n    height: '100%',\n    width: '100%',\n  },\n  trackLabel: {\n    zIndex: 3,\n    margin: theme.spacing(1),\n  },\n  trackLabelInline: {\n    position: 'relative',\n    display: 'inline-block',\n  },\n  trackLabelOverlap: {\n    position: 'absolute',\n  },\n  trackRenderingContainer: {\n    overflowY: 'auto',\n    overflowX: 'hidden',\n    whiteSpace: 'nowrap',\n    position: 'relative',\n    background: 'none',\n    zIndex: 2,\n    boxSizing: 'content-box',\n  },\n}))\n\ntype LGV = LinearGenomeViewModel\n\nfunction TrackContainer(props: {\n  model: LinearGenomeViewModel\n  track: BaseTrackModel\n}) {\n  const classes = useStyles()\n  const { model, track } = props\n  const display = track.displays[0]\n  const { horizontalScroll, draggingTrackId, moveTrack } = model\n  const { height } = display\n  const view = getContainingView(display) as LGV\n  const trackId = getConf(track, 'trackId')\n  const ref = useRef(null)\n\n  useEffect(() => {\n    if (ref.current) {\n      model.trackRefs[trackId] = ref.current\n    }\n    return () => {\n      delete model.trackRefs[trackId]\n    }\n  }, [model.trackRefs, trackId])\n  function onDragEnter() {\n    if (\n      draggingTrackId !== undefined &&\n      isAlive(display) &&\n      draggingTrackId !== display.id\n    ) {\n      moveTrack(draggingTrackId, track.id)\n    }\n  }\n  const debouncedOnDragEnter = useDebouncedCallback(onDragEnter, 100)\n  const { RenderingComponent, DisplayBlurb } = display\n  const dimmed = draggingTrackId !== undefined && draggingTrackId !== display.id\n\n  return (\n    <div className={classes.root}>\n      {view.trackLabels !== 'hidden' ? (\n        <TrackLabel\n          track={track}\n          className={clsx(\n            classes.trackLabel,\n            view.trackLabels === 'overlapping'\n              ? classes.trackLabelOverlap\n              : classes.trackLabelInline,\n          )}\n        />\n      ) : null}\n\n      <Paper\n        variant=\"outlined\"\n        className={classes.trackRenderingContainer}\n        style={{ height }}\n        onScroll={event => {\n          const target = event.target as HTMLDivElement\n          display.setScrollTop(target.scrollTop)\n        }}\n        onDragEnter={debouncedOnDragEnter}\n        data-testid={`trackRenderingContainer-${view.id}-${trackId}`}\n        role=\"presentation\"\n      >\n        <div\n          ref={ref}\n          className={classes.renderingComponentContainer}\n          style={{ transform: `scaleX(${model.scaleFactor})` }}\n        >\n          <RenderingComponent\n            model={display}\n            blockState={{}}\n            onHorizontalScroll={horizontalScroll}\n          />\n        </div>\n\n        {DisplayBlurb ? (\n          <div\n            style={{\n              position: 'absolute',\n              left: 0,\n              top: display.height - 20,\n            }}\n          >\n            {' '}\n            <DisplayBlurb model={display} />\n          </div>\n        ) : null}\n      </Paper>\n      <div\n        className={classes.overlay}\n        style={{\n          height: display.height,\n          background: dimmed ? 'rgba(0, 0, 0, 0.4)' : undefined,\n        }}\n        onDragEnter={debouncedOnDragEnter}\n      />\n      <ResizeHandle\n        onDrag={display.resizeHeight}\n        className={classes.resizeHandle}\n      />\n    </div>\n  )\n}\n\nexport default observer(TrackContainer)\n","import { Menu } from '@jbrowse/core/ui'\nimport { stringify } from '@jbrowse/core/util'\nimport Popover from '@material-ui/core/Popover'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport Typography from '@material-ui/core/Typography'\nimport ZoomInIcon from '@material-ui/icons/ZoomIn'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport ReactPropTypes from 'prop-types'\nimport React, { useRef, useEffect, useState } from 'react'\nimport { LinearGenomeViewStateModel } from '..'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => {\n  const background = theme.palette.tertiary\n    ? fade(theme.palette.tertiary.main, 0.7)\n    : fade(theme.palette.primary.main, 0.7)\n  return {\n    rubberBand: {\n      height: '100%',\n      background,\n      position: 'absolute',\n      zIndex: 10,\n      textAlign: 'center',\n      overflow: 'hidden',\n    },\n    rubberBandControl: {\n      cursor: 'crosshair',\n      width: '100%',\n      minHeight: 8,\n    },\n    rubberBandText: {\n      color: theme.palette.tertiary\n        ? theme.palette.tertiary.contrastText\n        : theme.palette.primary.contrastText,\n    },\n    popover: {\n      mouseEvents: 'none',\n      cursor: 'crosshair',\n    },\n    paper: {\n      paddingLeft: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n    },\n    guide: {\n      pointerEvents: 'none',\n      height: '100%',\n      width: 1,\n      position: 'absolute',\n      zIndex: 10,\n    },\n  }\n})\n\nconst VerticalGuide = observer(\n  ({ model, coordX }: { model: LGV; coordX: number }) => {\n    const classes = useStyles()\n    return (\n      <Tooltip\n        open\n        placement=\"top\"\n        title={stringify(model.pxToBp(coordX))}\n        arrow\n      >\n        <div\n          className={classes.guide}\n          style={{\n            left: coordX,\n            background: 'red',\n          }}\n        />\n      </Tooltip>\n    )\n  },\n)\n\ninterface Coord {\n  left: number\n  top: number\n}\n\nfunction RubberBand({\n  model,\n  ControlComponent = <div />,\n}: {\n  model: LGV\n  ControlComponent?: React.ReactElement\n}) {\n  const [startX, setStartX] = useState<number>()\n  const [currentX, setCurrentX] = useState<number>()\n  const [anchorPosition, setAnchorPosition] = useState<Coord>()\n  const [guideX, setGuideX] = useState<number | undefined>()\n  const controlsRef = useRef<HTMLDivElement>(null)\n  const rubberBandRef = useRef(null)\n  const classes = useStyles()\n  const mouseDragging = startX !== undefined && anchorPosition === undefined\n\n  useEffect(() => {\n    function globalMouseMove(event: MouseEvent) {\n      if (controlsRef.current && mouseDragging) {\n        const relativeX =\n          event.clientX - controlsRef.current.getBoundingClientRect().left\n        setCurrentX(relativeX)\n      }\n    }\n\n    function globalMouseUp(event: MouseEvent) {\n      if (startX !== undefined) {\n        setAnchorPosition({ left: event.clientX, top: event.clientY })\n        setGuideX(undefined)\n      }\n    }\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove)\n      window.addEventListener('mouseup', globalMouseUp)\n      return () => {\n        window.removeEventListener('mousemove', globalMouseMove)\n        window.removeEventListener('mouseup', globalMouseUp)\n      }\n    }\n    return () => {}\n  }, [startX, mouseDragging, anchorPosition])\n\n  useEffect(() => {\n    if (\n      !mouseDragging &&\n      currentX !== undefined &&\n      startX !== undefined &&\n      Math.abs(currentX - startX) <= 3\n    ) {\n      handleClose()\n    }\n  })\n\n  function mouseDown(event: React.MouseEvent<HTMLDivElement>) {\n    event.preventDefault()\n    event.stopPropagation()\n    const relativeX =\n      event.clientX -\n      (event.target as HTMLDivElement).getBoundingClientRect().left\n    setStartX(relativeX)\n    setCurrentX(relativeX)\n  }\n\n  function mouseMove(event: React.MouseEvent<HTMLDivElement>) {\n    const target = event.target as HTMLDivElement\n    setGuideX(event.clientX - target.getBoundingClientRect().left)\n  }\n\n  function mouseOut() {\n    setGuideX(undefined)\n  }\n\n  function zoomToRegion() {\n    if (startX === undefined || anchorPosition === undefined) {\n      return\n    }\n    let leftPx = startX\n    let rightPx = anchorPosition.left\n    if (rightPx < leftPx) {\n      ;[leftPx, rightPx] = [rightPx, leftPx]\n    }\n    const leftOffset = model.pxToBp(leftPx)\n    const rightOffset = model.pxToBp(rightPx)\n    model.moveTo(leftOffset, rightOffset)\n  }\n\n  function handleClose() {\n    setAnchorPosition(undefined)\n    setStartX(undefined)\n    setCurrentX(undefined)\n  }\n\n  const open = Boolean(anchorPosition)\n\n  function handleMenuItemClick(_: unknown, callback: Function) {\n    callback()\n    handleClose()\n  }\n\n  const menuItems = [\n    {\n      label: 'Zoom to region',\n      icon: ZoomInIcon,\n      onClick: () => {\n        zoomToRegion()\n        handleClose()\n      },\n    },\n  ]\n\n  if (startX === undefined) {\n    return (\n      <>\n        {guideX !== undefined ? (\n          <VerticalGuide model={model} coordX={guideX} />\n        ) : null}\n        <div\n          data-testid=\"rubberBand_controls\"\n          className={classes.rubberBandControl}\n          role=\"presentation\"\n          ref={controlsRef}\n          onMouseDown={mouseDown}\n          onMouseOut={mouseOut}\n          onMouseMove={mouseMove}\n        >\n          {ControlComponent}\n        </div>\n      </>\n    )\n  }\n\n  /* Calculating Pixels for Mouse Dragging */\n  const right = anchorPosition ? anchorPosition.left : currentX || 0\n  const left = right < startX ? right : startX\n  const width = Math.abs(right - startX)\n  const leftBpOffset = model.pxToBp(left)\n  const rightBpOffset = model.pxToBp(left + width)\n  const numOfBpSelected = Math.round(width * model.bpPerPx)\n\n  return (\n    <>\n      {rubberBandRef.current ? (\n        <>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'left',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'right',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>{stringify(leftBpOffset)}</Typography>\n          </Popover>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'right',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'left',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>{stringify(rightBpOffset)}</Typography>\n          </Popover>\n        </>\n      ) : null}\n      <div\n        ref={rubberBandRef}\n        className={classes.rubberBand}\n        style={{ left, width }}\n      >\n        <Typography variant=\"h6\" className={classes.rubberBandText}>\n          {numOfBpSelected.toLocaleString('en-US')} bp\n        </Typography>\n      </div>\n      <div\n        data-testid=\"rubberBand_controls\"\n        className={classes.rubberBandControl}\n        role=\"presentation\"\n        ref={controlsRef}\n        onMouseDown={mouseDown}\n        onMouseOut={mouseOut}\n        onMouseMove={mouseMove}\n      >\n        {ControlComponent}\n      </div>\n      {anchorPosition ? (\n        <Menu\n          anchorReference=\"anchorPosition\"\n          anchorPosition={anchorPosition}\n          onMenuItemClick={handleMenuItemClick}\n          open={open}\n          onClose={handleClose}\n          menuItems={menuItems}\n        />\n      ) : null}\n    </>\n  )\n}\n\nRubberBand.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n  ControlComponent: ReactPropTypes.node,\n}\n\nRubberBand.defaultProps = {\n  ControlComponent: <div />,\n}\n\nexport default observer(RubberBand)\n","import {\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from '@jbrowse/core/util/blockTypes'\nimport Paper from '@material-ui/core/Paper'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\nimport clsx from 'clsx'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React from 'react'\nimport { LinearGenomeViewStateModel } from '..'\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from '../../BaseLinearDisplay/components/Block'\nimport { makeTicks } from '../util'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => ({\n  scaleBarContainer: {\n    overflow: 'hidden',\n    position: 'relative',\n  },\n  scaleBarZoomContainer: {\n    position: 'relative',\n    zIndex: 1,\n  },\n  scaleBar: {\n    position: 'absolute',\n    display: 'flex',\n    pointerEvents: 'none',\n  },\n  majorTickLabel: {\n    fontSize: '11px',\n    zIndex: 1,\n    background: theme.palette.background.paper,\n    lineHeight: 'normal',\n    pointerEvents: 'none',\n  },\n  tick: {\n    position: 'absolute',\n    width: 0,\n    display: 'flex',\n    justifyContent: 'center',\n    pointerEvents: 'none',\n  },\n  refLabel: {\n    fontSize: '11px',\n    position: 'absolute',\n    left: '2px',\n    top: '-1px',\n    fontWeight: 'bold',\n    lineHeight: 'normal',\n    zIndex: 1,\n    pointerEvents: 'none',\n    background: theme.palette.background.paper,\n  },\n}))\n\nconst RenderedRefNameLabels = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n\n  // find the block that needs pinning to the left side for context\n  let lastLeftBlock = 0\n  model.staticBlocks.forEach((block, i) => {\n    if (block.offsetPx - model.offsetPx < 0) {\n      lastLeftBlock = i\n    }\n  })\n  return (\n    <>\n      {model.staticBlocks.map((block, index) => {\n        return block instanceof ContentBlock &&\n          (block.isLeftEndOfDisplayedRegion || index === lastLeftBlock) ? (\n          <Typography\n            key={`refLabel-${block.key}-${index}`}\n            style={{\n              left:\n                index === lastLeftBlock\n                  ? Math.max(0, -model.offsetPx)\n                  : block.offsetPx - model.offsetPx - 1,\n              paddingLeft: index === lastLeftBlock ? 0 : 1,\n            }}\n            className={classes.refLabel}\n            data-testid={`refLabel-${block.refName}`}\n          >\n            {block.refName}\n          </Typography>\n        ) : null\n      })}\n    </>\n  )\n})\n\nconst RenderedScaleBarLabels = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n\n  return (\n    <>\n      {model.staticBlocks.map((block, index) => {\n        if (block instanceof ContentBlock) {\n          const ticks = makeTicks(\n            block.start,\n            block.end,\n            model.bpPerPx,\n            true,\n            false,\n          )\n\n          return (\n            <ContentBlockComponent key={`${block.key}-${index}`} block={block}>\n              {ticks.map(tick => {\n                if (tick.type === 'labeledMajor') {\n                  const x =\n                    (block.reversed\n                      ? block.end - tick.base\n                      : tick.base - block.start) / model.bpPerPx\n                  const baseNumber = (tick.base + 1).toLocaleString('en-US')\n                  return (\n                    <div\n                      key={tick.base}\n                      className={classes.tick}\n                      style={{ left: x }}\n                    >\n                      {baseNumber ? (\n                        <Typography className={classes.majorTickLabel}>\n                          {baseNumber}\n                        </Typography>\n                      ) : null}\n                    </div>\n                  )\n                }\n                return null\n              })}\n            </ContentBlockComponent>\n          )\n        }\n        if (block instanceof ElidedBlock) {\n          return <ElidedBlockComponent key={block.key} width={block.widthPx} />\n        }\n        if (block instanceof InterRegionPaddingBlock) {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={block.key}\n              width={block.widthPx}\n              style={{ background: 'none' }}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        return null\n      })}\n    </>\n  )\n})\n\nconst ScaleBar = React.forwardRef(\n  (\n    {\n      model,\n      style,\n      className,\n      ...other\n    }: { model: LGV; style?: React.CSSProperties; className?: string },\n    ref,\n  ) => {\n    const classes = useStyles()\n\n    const offsetLeft = model.staticBlocks.offsetPx - model.offsetPx\n    return (\n      <Paper\n        data-resizer=\"true\" // used to avoid click-and-drag scrolls on trackscontainer\n        className={clsx(classes.scaleBarContainer, className)}\n        variant=\"outlined\"\n        ref={ref}\n        style={style}\n        {...other}\n      >\n        <div\n          className={classes.scaleBarZoomContainer}\n          style={{\n            transform:\n              model.scaleFactor !== 1\n                ? `scaleX(${model.scaleFactor})`\n                : undefined,\n          }}\n        >\n          <div\n            className={classes.scaleBar}\n            style={{\n              left: offsetLeft - 1,\n              width: model.staticBlocks.totalWidthPx,\n              ...style,\n            }}\n          >\n            <RenderedScaleBarLabels model={model} />\n          </div>\n        </div>\n        <RenderedRefNameLabels model={model} />\n      </Paper>\n    )\n  },\n)\n\nexport default observer(ScaleBar)\n","import {\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from '@jbrowse/core/util/blockTypes'\nimport { makeStyles } from '@material-ui/core/styles'\nimport clsx from 'clsx'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React from 'react'\nimport { LinearGenomeViewStateModel } from '..'\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from '../../BaseLinearDisplay/components/Block'\n\nimport { makeTicks } from '../util'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => ({\n  verticalGuidesZoomContainer: {\n    position: 'absolute',\n    height: '100%',\n    width: '100%',\n    zIndex: 1,\n    pointerEvents: 'none',\n  },\n  verticalGuidesContainer: {\n    position: 'absolute',\n    height: '100%',\n    zIndex: 1,\n    pointerEvents: 'none',\n    display: 'flex',\n  },\n  tick: {\n    position: 'absolute',\n    height: '100%',\n    width: 1,\n  },\n  majorTick: {\n    background: theme.palette.text.hint,\n  },\n  minorTick: {\n    background: theme.palette.divider,\n  },\n}))\nconst RenderedVerticalGuides = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  return (\n    <>\n      {model.staticBlocks.map((block, index) => {\n        if (block instanceof ContentBlock) {\n          const ticks = makeTicks(block.start, block.end, model.bpPerPx)\n          return (\n            <ContentBlockComponent key={`${block.key}-${index}`} block={block}>\n              {ticks.map(tick => {\n                const x =\n                  (block.reversed\n                    ? block.end - tick.base\n                    : tick.base - block.start) / model.bpPerPx\n                return (\n                  <div\n                    key={tick.base}\n                    className={clsx(\n                      classes.tick,\n                      tick.type === 'major' || tick.type === 'labeledMajor'\n                        ? classes.majorTick\n                        : classes.minorTick,\n                    )}\n                    style={{ left: x }}\n                  />\n                )\n              })}\n            </ContentBlockComponent>\n          )\n        }\n        if (block instanceof ElidedBlock) {\n          return <ElidedBlockComponent key={block.key} width={block.widthPx} />\n        }\n        if (block instanceof InterRegionPaddingBlock) {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={block.key}\n              width={block.widthPx}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        return null\n      })}\n    </>\n  )\n})\nfunction VerticalGuides({ model }: { model: LGV }) {\n  const classes = useStyles()\n  // find the block that needs pinning to the left side for context\n  const offsetLeft = model.staticBlocks.offsetPx - model.offsetPx\n  return (\n    <div\n      className={classes.verticalGuidesZoomContainer}\n      style={{\n        transform:\n          model.scaleFactor !== 1 ? `scaleX(${model.scaleFactor})` : undefined,\n      }}\n    >\n      <div\n        className={classes.verticalGuidesContainer}\n        style={{\n          left: offsetLeft,\n          width: model.staticBlocks.totalWidthPx,\n        }}\n      >\n        <RenderedVerticalGuides model={model} />\n      </div>\n    </div>\n  )\n}\n\nexport default observer(VerticalGuides)\n","import { makeStyles } from '@material-ui/core/styles'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport React, { useRef } from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport { LinearGenomeViewStateModel } from '..'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(() => ({\n  centerLineContainer: {\n    background: 'transparent',\n    height: '100%',\n    zIndex: 5, // above the track but under menu\n    position: 'absolute',\n    border: '1px black dashed',\n    borderTop: 'none',\n    borderBottom: 'none',\n    pointerEvents: 'none',\n  },\n  centerLineText: {\n    position: 'absolute',\n    pointerEvents: 'none',\n    whiteSpace: 'nowrap',\n    fontWeight: 'bold',\n  },\n}))\n\nfunction CenterLine({ model }: { model: LGV }) {\n  const { bpPerPx, centerLineInfo, trackHeights, tracks, width } = model\n  const ref = useRef<HTMLDivElement>(null)\n  const classes = useStyles()\n  const startingPosition = width / 2\n\n  return tracks.length ? (\n    <div\n      data-testid=\"centerline_container\"\n      className={classes.centerLineContainer}\n      role=\"presentation\"\n      ref={ref}\n      style={{\n        left: `${startingPosition}px`,\n        width: Math.max(1 / bpPerPx, 1),\n      }}\n    >\n      {centerLineInfo && (\n        <div\n          // text that indicates what bp is center, positioned\n          // at the bottom right of the center line\n          data-testid=\"centerline_text\"\n          className={classes.centerLineText}\n          role=\"presentation\"\n          style={{\n            left: Math.max(1 / bpPerPx, 1) + 5,\n            top: trackHeights,\n          }}\n        >\n          {/* change bp to refName */}\n          {centerLineInfo.refName}:{' '}\n          {Math.max(Math.round(centerLineInfo.offset) + 1, 0)}\n        </div>\n      )}\n    </div>\n  ) : null\n}\n\nCenterLine.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n\nexport default observer(CenterLine)\n","import { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React, { useEffect, useRef, useState } from 'react'\nimport normalizeWheel from 'normalize-wheel'\n\nimport {\n  LinearGenomeViewStateModel,\n  RESIZE_HANDLE_HEIGHT,\n  SCALE_BAR_HEIGHT,\n} from '..'\nimport RubberBand from './RubberBand'\nimport ScaleBar from './ScaleBar'\nimport VerticalGuides from './VerticalGuides'\nimport CenterLine from './CenterLine'\n\nconst useStyles = makeStyles(theme => ({\n  tracksContainer: {\n    position: 'relative',\n    borderRadius: theme.shape.borderRadius,\n    overflow: 'hidden',\n  },\n  spacer: {\n    position: 'relative',\n    height: RESIZE_HANDLE_HEIGHT,\n  },\n}))\n\ntype LGV = Instance<LinearGenomeViewStateModel>\ntype Timer = ReturnType<typeof setTimeout>\n\nfunction TracksContainer({\n  children,\n  model,\n}: {\n  children: React.ReactNode\n  model: LGV\n}) {\n  const classes = useStyles()\n  // refs are to store these variables to avoid repeated rerenders associated\n  // with useState/setState\n  const delta = useRef(0)\n  const scheduled = useRef(false)\n  const timeout = useRef<Timer>()\n  const ref = useRef<HTMLDivElement>(null)\n  const prevX = useRef<number>(0)\n\n  const [mouseDragging, setMouseDragging] = useState(false)\n\n  useEffect(() => {\n    let cleanup = () => {}\n\n    function globalMouseMove(event: MouseEvent) {\n      event.preventDefault()\n      const currX = event.clientX\n      const distance = currX - prevX.current\n      if (distance) {\n        // use rAF to make it so multiple event handlers aren't fired per-frame\n        // see https://calendar.perfplanet.com/2013/the-runtime-performance-checklist/\n        if (!scheduled.current) {\n          scheduled.current = true\n          window.requestAnimationFrame(() => {\n            model.horizontalScroll(-distance)\n            scheduled.current = false\n            prevX.current = event.clientX\n          })\n        }\n      }\n    }\n\n    function globalMouseUp() {\n      prevX.current = 0\n      if (mouseDragging) {\n        setMouseDragging(false)\n      }\n    }\n\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove, true)\n      window.addEventListener('mouseup', globalMouseUp, true)\n      cleanup = () => {\n        window.removeEventListener('mousemove', globalMouseMove, true)\n        window.removeEventListener('mouseup', globalMouseUp, true)\n      }\n    }\n    return cleanup\n  }, [model, mouseDragging, prevX])\n\n  function mouseDown(event: React.MouseEvent) {\n    // check if clicking a draggable element or a resize handle\n    const target = event.target as HTMLElement\n    if (target.draggable || target.dataset.resizer) {\n      return\n    }\n\n    // otherwise do click and drag scroll\n    if (event.button === 0) {\n      event.preventDefault()\n      prevX.current = event.clientX\n      setMouseDragging(true)\n    }\n  }\n\n  // this local mouseup is used in addition to the global because sometimes\n  // the global add/remove are not called in time, resulting in issue #533\n  function mouseUp(event: React.MouseEvent) {\n    event.preventDefault()\n    setMouseDragging(false)\n  }\n\n  function mouseLeave(event: React.MouseEvent) {\n    event.preventDefault()\n  }\n\n  useEffect(() => {\n    const curr = ref.current\n    // if ctrl is held down, zoom in with y-scroll\n    // else scroll horizontally with x-scroll\n    function onWheel(origEvent: WheelEvent) {\n      const event = normalizeWheel(origEvent)\n      if (origEvent.ctrlKey === true) {\n        origEvent.preventDefault()\n        delta.current += event.pixelY / 500\n        model.setScaleFactor(\n          delta.current < 0 ? 1 - delta.current : 1 / (1 + delta.current),\n        )\n        if (timeout.current) {\n          clearTimeout(timeout.current)\n        }\n        timeout.current = setTimeout(() => {\n          model.setScaleFactor(1)\n          model.zoomTo(\n            delta.current > 0\n              ? model.bpPerPx * (1 + delta.current)\n              : model.bpPerPx / (1 - delta.current),\n          )\n          delta.current = 0\n        }, 300)\n      } else {\n        // this is needed to stop the event from triggering \"back button\n        // action\" on MacOSX etc.  but is a heuristic to avoid preventing the\n        // inner-track scroll behavior\n        if (Math.abs(event.pixelX) > Math.abs(2 * event.pixelY)) {\n          origEvent.preventDefault()\n        }\n        delta.current += event.pixelX\n        if (!scheduled.current) {\n          // use rAF to make it so multiple event handlers aren't fired per-frame\n          // see https://calendar.perfplanet.com/2013/the-runtime-performance-checklist/\n          scheduled.current = true\n          window.requestAnimationFrame(() => {\n            model.horizontalScroll(delta.current)\n            delta.current = 0\n            scheduled.current = false\n          })\n        }\n      }\n    }\n    if (curr) {\n      curr.addEventListener('wheel', onWheel)\n      return () => {\n        curr.removeEventListener('wheel', onWheel)\n      }\n    }\n    return () => {}\n  }, [model])\n\n  return (\n    <div\n      ref={ref}\n      role=\"presentation\"\n      className={classes.tracksContainer}\n      onMouseDown={mouseDown}\n      onMouseUp={mouseUp}\n      onMouseLeave={mouseLeave}\n    >\n      <VerticalGuides model={model} />\n      {model.showCenterLine ? <CenterLine model={model} /> : null}\n\n      <RubberBand\n        model={model}\n        ControlComponent={\n          <ScaleBar\n            model={model}\n            style={{ height: SCALE_BAR_HEIGHT, boxSizing: 'border-box' }}\n          />\n        }\n      />\n      <div className={classes.spacer} />\n      {children}\n    </div>\n  )\n}\n\nexport default observer(TracksContainer)\n","import React, { useState, useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport { getSnapshot } from 'mobx-state-tree'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { getSession } from '@jbrowse/core/util'\nimport Button from '@material-ui/core/Button'\nimport TextField from '@material-ui/core/TextField'\nimport Container from '@material-ui/core/Container'\nimport Grid from '@material-ui/core/Grid'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport { Region } from '@jbrowse/core/util/types'\nimport RefNameAutocomplete from './RefNameAutocomplete'\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles(theme => ({\n  importFormContainer: {\n    padding: theme.spacing(2),\n  },\n  importFormEntry: {\n    minWidth: 180,\n  },\n}))\n\nconst ImportForm = observer(({ model }: { model: LinearGenomeViewModel }) => {\n  const classes = useStyles()\n  const [selectedAssemblyIdx, setSelectedAssemblyIdx] = useState(0)\n  const [selectedRegion, setSelectedRegion] = useState<Region | undefined>()\n  const { assemblyNames, assemblyManager } = getSession(model)\n  const error = !assemblyNames.length ? 'No configured assemblies' : ''\n  const assemblyName = assemblyNames[selectedAssemblyIdx]\n  const displayName = assemblyName && !error ? selectedAssemblyIdx : ''\n  useEffect(() => {\n    let done = false\n    ;(async () => {\n      const assembly = await assemblyManager.waitForAssembly(assemblyName)\n\n      if (!done && assembly && assembly.regions) {\n        setSelectedRegion(getSnapshot(assembly.regions[0]))\n      }\n    })()\n    return () => {\n      done = true\n    }\n  }, [assemblyManager, assemblyName])\n\n  function onAssemblyChange(\n    event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>,\n  ) {\n    setSelectedAssemblyIdx(Number(event.target.value))\n  }\n\n  function onOpenClick() {\n    if (selectedRegion) {\n      model.setDisplayedRegions([selectedRegion])\n    }\n  }\n\n  return (\n    <Container className={classes.importFormContainer}>\n      <Grid container spacing={1} justify=\"center\" alignItems=\"center\">\n        <Grid item>\n          <TextField\n            select\n            variant=\"outlined\"\n            value={displayName}\n            onChange={onAssemblyChange}\n            label=\"Assembly\"\n            helperText={error || 'Select assembly to view'}\n            error={!!error}\n            disabled={!!error}\n            margin=\"normal\"\n            className={classes.importFormEntry}\n          >\n            {assemblyNames.map((name, idx) => (\n              <MenuItem key={name} value={idx}>\n                {name}\n              </MenuItem>\n            ))}\n          </TextField>\n        </Grid>\n        <Grid item>\n          <RefNameAutocomplete\n            model={model}\n            assemblyName={\n              error ? undefined : assemblyNames[selectedAssemblyIdx]\n            }\n            onSelect={setSelectedRegion}\n            value={selectedRegion && selectedRegion.refName}\n            TextFieldProps={{\n              margin: 'normal',\n              variant: 'outlined',\n              label: 'Sequence',\n              className: classes.importFormEntry,\n              helperText: 'Select sequence to view',\n            }}\n          />\n        </Grid>\n        <Grid item>\n          <Button\n            disabled={!selectedRegion}\n            onClick={onOpenClick}\n            variant=\"contained\"\n            color=\"primary\"\n          >\n            Open\n          </Button>\n        </Grid>\n      </Grid>\n    </Container>\n  )\n})\n\nexport default ImportForm\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport IconButton from '@material-ui/core/IconButton'\nimport ZoomIn from '@material-ui/icons/ZoomIn'\nimport ZoomOut from '@material-ui/icons/ZoomOut'\nimport ArrowDown from '@material-ui/icons/KeyboardArrowDown'\nimport Paper from '@material-ui/core/Paper'\nimport Menu from '@jbrowse/core/ui/Menu'\nimport { LinearGenomeViewModel } from '..'\n\nconst MiniControls = observer((props: { model: LinearGenomeViewModel }) => {\n  const { model } = props\n  const { bpPerPx, maxBpPerPx, minBpPerPx, scaleFactor } = model\n  const [anchorEl, setAnchorEl] = useState<HTMLElement>()\n\n  return (\n    <>\n      <Paper style={{ background: '#aaa7' }}>\n        <IconButton\n          color=\"secondary\"\n          onClick={event => {\n            setAnchorEl(event.currentTarget)\n          }}\n        >\n          <ArrowDown />\n        </IconButton>\n\n        <IconButton\n          data-testid=\"zoom_out\"\n          onClick={() => {\n            model.zoom(bpPerPx * 2)\n          }}\n          disabled={bpPerPx >= maxBpPerPx - 0.0001 || scaleFactor !== 1}\n          color=\"secondary\"\n        >\n          <ZoomOut />\n        </IconButton>\n        <IconButton\n          data-testid=\"zoom_in\"\n          onClick={() => {\n            model.zoom(model.bpPerPx / 2)\n          }}\n          disabled={bpPerPx <= minBpPerPx + 0.0001 || scaleFactor !== 1}\n          color=\"secondary\"\n        >\n          <ZoomIn />\n        </IconButton>\n      </Paper>\n      <Menu\n        anchorEl={anchorEl}\n        open={Boolean(anchorEl)}\n        onMenuItemClick={(_, callback) => {\n          callback()\n          setAnchorEl(undefined)\n        }}\n        onClose={() => {\n          setAnchorEl(undefined)\n        }}\n        menuItems={model.menuItems}\n      />\n    </>\n  )\n})\n\nexport default MiniControls\n","/* eslint-disable react/prop-types,@typescript-eslint/no-explicit-any,no-nested-ternary */\nimport React, { useState, useEffect } from 'react'\nimport { readConfObject, getConf } from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport Accordion from '@material-ui/core/Accordion'\nimport AccordionDetails from '@material-ui/core/AccordionDetails'\nimport AccordionSummary from '@material-ui/core/AccordionSummary'\nimport Typography from '@material-ui/core/Typography'\nimport ExpandMore from '@material-ui/icons/ExpandMore'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport SanitizedHTML from '@jbrowse/core/ui/SanitizedHTML'\nimport isObject from 'is-object'\n\nexport const useStyles = makeStyles(theme => ({\n  expansionPanelDetails: {\n    display: 'block',\n    padding: theme.spacing(1),\n  },\n  expandIcon: {\n    color: '#FFFFFF',\n  },\n  field: {\n    display: 'flex',\n  },\n  fieldName: {\n    wordBreak: 'break-all',\n    minWidth: 100,\n    maxWidth: 350,\n    borderBottom: '1px solid #0003',\n    backgroundColor: theme.palette.grey[200],\n    marginRight: theme.spacing(1),\n    padding: theme.spacing(0.5),\n  },\n  fieldValue: {\n    wordBreak: 'break-word',\n    maxHeight: 300,\n    padding: theme.spacing(0.5),\n    overflow: 'auto',\n  },\n  fieldSubvalue: {\n    wordBreak: 'break-word',\n    maxHeight: 300,\n    padding: theme.spacing(0.5),\n    backgroundColor: theme.palette.grey[100],\n    border: `1px solid ${theme.palette.grey[300]}`,\n    boxSizing: 'border-box',\n    overflow: 'auto',\n  },\n}))\n\ninterface BaseCardProps {\n  title: string\n}\n\nexport const BaseCard: React.FunctionComponent<BaseCardProps> = props => {\n  const classes = useStyles()\n  const { children, title } = props\n  return (\n    <Accordion style={{ marginTop: '4px' }} defaultExpanded>\n      <AccordionSummary\n        expandIcon={<ExpandMore className={classes.expandIcon} />}\n      >\n        <Typography variant=\"button\"> {title}</Typography>\n      </AccordionSummary>\n      <AccordionDetails className={classes.expansionPanelDetails}>\n        {children}\n      </AccordionDetails>\n    </Accordion>\n  )\n}\n\nconst omit = ['refNames', 'displays']\ninterface AttributeProps {\n  attributes: Record<string, any>\n  omit?: string[]\n  prepend?: string\n  formatter?: (val: unknown) => JSX.Element\n  descriptions?: Record<string, React.ReactNode>\n}\n\nexport const Attributes: React.FunctionComponent<AttributeProps> = props => {\n  const classes = useStyles()\n  const {\n    attributes,\n    prepend = '',\n    omit: propOmit = [],\n    formatter = (value: unknown) => (\n      <SanitizedHTML\n        html={isObject(value) ? JSON.stringify(value) : String(value)}\n      />\n    ),\n    descriptions,\n  } = props\n\n  const tags: string[] = Object.values(attributes)\n    .filter(val => val !== undefined)\n    .map(val => {\n      return val.tag\n    })\n    .filter(val => !!val)\n\n  const counts = tags.reduce((accum, entry) => {\n    if (!accum[entry]) accum[entry] = 1\n    else accum[entry]++\n    return accum\n  }, {} as { [key: string]: number })\n  const hidden = Object.entries(counts)\n    .filter(([_, value]) => {\n      return value > 50\n    })\n    .map(entry => entry[0])\n  const [currHidden, setCurrHidden] = useState(hidden)\n\n  const SimpleValue = ({ name, value }: { name: string; value: any }) => {\n    const description = descriptions && descriptions[name]\n    return (\n      <div style={{ display: 'flex' }}>\n        {description ? (\n          <Tooltip title={description} placement=\"left\">\n            <div className={classes.fieldName}>{name}</div>\n          </Tooltip>\n        ) : (\n          <div className={classes.fieldName}>{name}</div>\n        )}\n        <div className={classes.fieldValue}>{formatter(value)}</div>\n      </div>\n    )\n  }\n  const ArrayValue = ({ name, value }: { name: string; value: any[] }) => {\n    const description = descriptions && descriptions[name]\n\n    return (\n      <div style={{ display: 'flex' }}>\n        {description ? (\n          <Tooltip title={description} placement=\"left\">\n            <div className={classes.fieldName}>{name}</div>\n          </Tooltip>\n        ) : (\n          <div className={classes.fieldName}>{name}</div>\n        )}\n        {value.map((val, i) => (\n          <div key={`${name}-${i}`} className={classes.fieldSubvalue}>\n            {formatter(val)}\n          </div>\n        ))}\n      </div>\n    )\n  }\n\n  return (\n    <>\n      {Object.entries(attributes)\n        .filter(\n          ([k, v]) =>\n            v !== undefined && !omit.includes(k) && !propOmit.includes(k),\n        )\n\n        .map(([key, value], index) => {\n          if (value.tag && value.data) {\n            return currHidden.includes(value.tag) ? null : (\n              <SimpleValue\n                key={`${value.tag}_${index}`}\n                name={value.tag}\n                value={value.data}\n              />\n            )\n          }\n          if (Array.isArray(value)) {\n            return value.length === 1 ? (\n              <SimpleValue\n                key={key}\n                name={`${prepend ? `${prepend}.` : ''}${key}`}\n                value={value[0]}\n              />\n            ) : (\n              <ArrayValue\n                key={key}\n                name={`${prepend ? `${prepend}.` : ''}${key}`}\n                value={value}\n              />\n            )\n          }\n          if (isObject(value)) {\n            return (\n              <Attributes\n                key={key}\n                attributes={value}\n                descriptions={descriptions}\n                prepend={`${prepend ? `${prepend}.` : ''}${key}`}\n              />\n            )\n          }\n\n          return (\n            <SimpleValue\n              key={key}\n              name={`${prepend ? `${prepend}.` : ''}${key}`}\n              value={value}\n            />\n          )\n        })}\n      {hidden.length ? (\n        <>\n          {currHidden.length ? (\n            <>\n              <Typography color=\"textSecondary\">\n                {`Note: Some entries were hidden (${currHidden}), click button below to reveal`}\n              </Typography>\n              <Button\n                variant=\"contained\"\n                color=\"primary\"\n                onClick={() => setCurrHidden([])}\n              >\n                {`Show ${currHidden}`}\n              </Button>\n            </>\n          ) : (\n            <Button\n              color=\"primary\"\n              variant=\"contained\"\n              onClick={() => setCurrHidden(hidden)}\n            >{`Hide ${hidden}`}</Button>\n          )}\n        </>\n      ) : null}\n    </>\n  )\n}\n\ntype FileInfo = Record<string, unknown>\n\nexport default function AboutDialog({\n  model,\n  handleClose,\n}: {\n  model: BaseTrackModel\n  handleClose: () => void\n}) {\n  const [info, setInfo] = useState<FileInfo>()\n  const [error, setError] = useState<Error>()\n  const conf = getConf(model)\n  const session = getSession(model)\n  const { rpcManager } = session\n  const sessionId = getRpcSessionId(model)\n\n  useEffect(() => {\n    const aborter = new AbortController()\n    const { signal } = aborter\n    ;(async () => {\n      try {\n        const adapterConfig = getConf(model, 'adapter')\n        const result = await rpcManager.call(sessionId, 'CoreGetInfo', {\n          adapterConfig,\n          signal,\n        })\n        setInfo(result as FileInfo)\n      } catch (e) {\n        setError(e)\n      }\n    })()\n\n    return () => {\n      aborter.abort()\n    }\n  }, [model, rpcManager, sessionId])\n\n  let trackName = getConf(model, 'name')\n  if (getConf(model, 'type') === 'ReferenceSequenceTrack') {\n    trackName = 'Reference Sequence'\n    session.assemblies.forEach(assembly => {\n      if (assembly.sequence === model.configuration) {\n        trackName = `Reference Sequence (${readConfObject(assembly, 'name')})`\n      }\n    })\n  }\n  return (\n    <Dialog\n      open\n      onClose={handleClose}\n      aria-labelledby=\"alert-dialog-title\"\n      aria-describedby=\"alert-dialog-description\"\n    >\n      <DialogTitle id=\"alert-dialog-title\">{trackName}</DialogTitle>\n      <DialogContent>\n        <BaseCard title=\"Configuration\">\n          <Attributes attributes={conf} />\n        </BaseCard>\n        {info !== null ? (\n          <BaseCard title=\"File info\">\n            {error ? (\n              <Typography color=\"error\">{`${error}`}</Typography>\n            ) : info === undefined ? (\n              'Loading file data...'\n            ) : (\n              <Attributes attributes={info} />\n            )}\n          </BaseCard>\n        ) : null}\n      </DialogContent>\n    </Dialog>\n  )\n}\n","// material ui things\nimport Button from '@material-ui/core/Button'\nimport Paper from '@material-ui/core/Paper'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\n\n// misc\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React from 'react'\n\n// locals\nimport { LinearGenomeViewStateModel } from '..'\nimport Header from './Header'\nimport TrackContainer from './TrackContainer'\nimport TracksContainer from './TracksContainer'\nimport ImportForm from './ImportForm'\nimport MiniControls from './MiniControls'\nimport AboutDialog from './AboutDialog'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => ({\n  errorMessage: {\n    textAlign: 'center',\n    paddingTop: theme.spacing(1),\n    paddingBottom: theme.spacing(1),\n  },\n  spacer: {\n    marginRight: theme.spacing(2),\n  },\n}))\n\nconst LinearGenomeView = observer((props: { model: LGV }) => {\n  const { model } = props\n  const { tracks, error, hideHeader, initialized } = model\n  const classes = useStyles()\n\n  // the AboutDialog is shown at this level because if it is\n  // rendered as a child of the TracksContainer, then clicking on\n  // the dialog scrolls the LGV\n  const aboutTrack = model.tracks.find(t => t.showAbout)\n  const handleClose = () => {\n    aboutTrack.setShowAbout(false)\n  }\n  return !initialized ? (\n    <ImportForm model={model} />\n  ) : (\n    <div style={{ position: 'relative' }}>\n      {aboutTrack ? (\n        <AboutDialog model={aboutTrack} handleClose={handleClose} />\n      ) : null}\n      {!hideHeader ? (\n        <Header model={model} />\n      ) : (\n        <div\n          style={{\n            position: 'absolute',\n            right: 0,\n            zIndex: 1001,\n          }}\n        >\n          <MiniControls model={model} />\n        </div>\n      )}\n      {error ? (\n        <Paper variant=\"outlined\" className={classes.errorMessage}>\n          <Typography color=\"error\">{error.message}</Typography>\n        </Paper>\n      ) : (\n        <>\n          <TracksContainer model={model}>\n            {!tracks.length ? (\n              <Paper variant=\"outlined\" className={classes.errorMessage}>\n                <Typography>No tracks active.</Typography>\n                <Button\n                  variant=\"contained\"\n                  color=\"primary\"\n                  onClick={model.activateTrackSelector}\n                >\n                  <TrackSelectorIcon className={classes.spacer} />\n                  Open track selector\n                </Button>\n              </Paper>\n            ) : (\n              tracks.map(track => (\n                <TrackContainer key={track.id} model={model} track={track} />\n              ))\n            )}\n          </TracksContainer>\n        </>\n      )}\n    </div>\n  )\n})\n\nexport default LinearGenomeView\n","import { getConf } from '@jbrowse/core/configuration'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { Region } from '@jbrowse/core/util/types'\nimport { ElementId, Region as MUIRegion } from '@jbrowse/core/util/types/mst'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport {\n  assembleLocString,\n  clamp,\n  findLastIndex,\n  getContainingView,\n  getSession,\n  isViewContainer,\n  parseLocString,\n  springAnimate,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { BlockSet, BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport calculateDynamicBlocks from '@jbrowse/core/util/calculateDynamicBlocks'\nimport calculateStaticBlocks from '@jbrowse/core/util/calculateStaticBlocks'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { transaction, autorun } from 'mobx'\nimport {\n  getSnapshot,\n  types,\n  cast,\n  Instance,\n  getRoot,\n  resolveIdentifier,\n  addDisposer,\n} from 'mobx-state-tree'\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport SyncAltIcon from '@material-ui/icons/SyncAlt'\nimport VisibilityIcon from '@material-ui/icons/Visibility'\nimport LabelIcon from '@material-ui/icons/Label'\nimport clone from 'clone'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\nexport { default as ReactComponent } from './components/LinearGenomeView'\n\nexport interface BpOffset {\n  refName?: string\n  index: number\n  offset: number\n  start?: number\n  end?: number\n  coord?: number\n  reversed?: boolean\n}\n\nfunction calculateVisibleLocStrings(contentBlocks: BaseBlock[]) {\n  if (!contentBlocks.length) {\n    return ''\n  }\n  const isSingleAssemblyName = contentBlocks.every(\n    block => block.assemblyName === contentBlocks[0].assemblyName,\n  )\n  const locs = contentBlocks.map(block =>\n    assembleLocString({\n      ...block,\n      start: Math.round(block.start),\n      end: Math.round(block.end),\n      assemblyName: isSingleAssemblyName ? undefined : block.assemblyName,\n    }),\n  )\n  return locs.join(';')\n}\n\nexport interface NavLocation {\n  refName: string\n  start?: number\n  end?: number\n  assemblyName?: string\n}\n\nexport const HEADER_BAR_HEIGHT = 48\nexport const HEADER_OVERVIEW_HEIGHT = 20\nexport const SCALE_BAR_HEIGHT = 17\nexport const RESIZE_HANDLE_HEIGHT = 3\nexport const INTER_REGION_PADDING_WIDTH = 2\n\nexport function stateModelFactory(pluginManager: PluginManager) {\n  const model = types\n    .model('LinearGenomeView', {\n      id: ElementId,\n      type: types.literal('LinearGenomeView'),\n      offsetPx: 0,\n      bpPerPx: 1,\n      displayedRegions: types.array(MUIRegion),\n      // we use an array for the tracks because the tracks are displayed in a specific\n      // order that we need to keep.\n      tracks: types.array(\n        pluginManager.pluggableMstType('track', 'stateModel'),\n      ),\n      hideHeader: false,\n      hideHeaderOverview: false,\n      trackSelectorType: types.optional(\n        types.enumeration(['hierarchical']),\n        'hierarchical',\n      ),\n      trackLabels: 'overlapping' as 'overlapping' | 'hidden' | 'offset',\n      showCenterLine: false,\n    })\n    .volatile(() => ({\n      volatileWidth: undefined as number | undefined,\n      minimumBlockWidth: 20,\n      draggingTrackId: undefined as undefined | string,\n      error: undefined as undefined | Error,\n\n      // array of callbacks to run after the next set of the displayedRegions,\n      // which is basically like an onLoad\n      afterDisplayedRegionsSetCallbacks: [] as Function[],\n      scaleFactor: 1,\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      trackRefs: {} as { [key: string]: any },\n      coarseDynamicBlocks: [] as BaseBlock[],\n      coarseTotalBp: 0,\n    }))\n    .views(self => ({\n      get width(): number {\n        if (self.volatileWidth === undefined) {\n          throw new Error(\n            'width undefined, make sure to check for model.initialized',\n          )\n        }\n        return self.volatileWidth\n      },\n    }))\n    .views(self => ({\n      get initialized() {\n        const { assemblyManager } = getSession(self)\n\n        // if the assemblyManager is tracking a given assembly name, wait for\n        // it to be loaded. this is done by looking in the assemblyManager's\n        // assembly list, and then waiting on it's initialized state which is\n        // updated later\n        const assembliesInitialized = this.assemblyNames.every(assemblyName => {\n          if (\n            assemblyManager.assemblyList\n              .map((asm: { name: string }) => asm.name)\n              .includes(assemblyName)\n          ) {\n            return (assemblyManager.get(assemblyName) || {}).initialized\n          }\n          return true\n        })\n\n        return (\n          self.volatileWidth !== undefined &&\n          self.displayedRegions.length > 0 &&\n          assembliesInitialized\n        )\n      },\n      get scaleBarHeight() {\n        return SCALE_BAR_HEIGHT + RESIZE_HANDLE_HEIGHT\n      },\n      get headerHeight() {\n        if (self.hideHeader) {\n          return 0\n        }\n        if (self.hideHeaderOverview) {\n          return HEADER_BAR_HEIGHT\n        }\n        return HEADER_BAR_HEIGHT + HEADER_OVERVIEW_HEIGHT\n      },\n      get trackHeights() {\n        return self.tracks\n          .map(t => t.displays[0].height)\n          .reduce((a, b) => a + b, 0)\n      },\n      get trackHeightsWithResizeHandles() {\n        return this.trackHeights + self.tracks.length * RESIZE_HANDLE_HEIGHT\n      },\n      get height() {\n        return (\n          this.trackHeightsWithResizeHandles +\n          this.headerHeight +\n          this.scaleBarHeight\n        )\n      },\n      get interRegionPaddingWidth() {\n        return INTER_REGION_PADDING_WIDTH\n      },\n      get totalBp() {\n        let totalbp = 0\n        self.displayedRegions.forEach(region => {\n          totalbp += region.end - region.start\n        })\n        return totalbp\n      },\n\n      get maxBpPerPx() {\n        return this.totalBp / 1000\n      },\n\n      get minBpPerPx() {\n        return 1 / 50\n      },\n\n      get maxOffset() {\n        // objectively determined to keep the linear genome on the main screen\n        const leftPadding = 10\n        return this.displayedRegionsTotalPx - leftPadding\n      },\n\n      get displayedParentRegions() {\n        const wholeRefSeqs = [] as Region[]\n        const { assemblyManager } = getSession(self)\n        self.displayedRegions.forEach(({ refName, assemblyName }) => {\n          const assembly = assemblyManager.get(assemblyName)\n          const r = assembly && (assembly.regions as Region[])\n          if (r) {\n            const wholeSequence = r.find(\n              sequence => sequence.refName === refName,\n            )\n            const alreadyExists = wholeRefSeqs.find(\n              sequence => sequence.refName === refName,\n            )\n            if (wholeSequence && !alreadyExists) {\n              wholeRefSeqs.push(wholeSequence)\n            }\n          }\n        })\n        return wholeRefSeqs\n      },\n\n      get displayedParentRegionsLength() {\n        return this.displayedParentRegions\n          .map(a => a.end - a.start)\n          .reduce((a, b) => a + b, 0)\n      },\n      get minOffset() {\n        // objectively determined to keep the linear genome on the main screen\n        const rightPadding = 30\n        return -self.width + rightPadding\n      },\n\n      get displayedRegionsTotalPx() {\n        return this.totalBp / self.bpPerPx\n      },\n\n      get renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          bpPerPx: self.bpPerPx,\n          highResolutionScaling: getConf(\n            getSession(self),\n            'highResolutionScaling',\n          ),\n        }\n      },\n      get assemblyNames() {\n        return [\n          ...new Set(self.displayedRegions.map(region => region.assemblyName)),\n        ]\n      },\n      parentRegion(assemblyName: string, refName: string) {\n        return this.displayedParentRegions.find(\n          parentRegion =>\n            parentRegion.assemblyName === assemblyName &&\n            parentRegion.refName === refName,\n        )\n      },\n      /**\n       * @param refName - refName of the displayedRegion\n       * @param coord - coordinate at the displayed Region\n       * @param regionNumber - optional param used as identifier when\n       * there are multiple displayedRegions with the same refName\n       * @returns offsetPx of the displayed region that it lands in\n       */\n      bpToPx({\n        refName,\n        coord,\n        regionNumber,\n      }: {\n        refName: string\n        coord: number\n        regionNumber?: number\n      }) {\n        let offsetBp = 0\n\n        const index = self.displayedRegions.findIndex((r, idx) => {\n          if (refName === r.refName && coord >= r.start && coord <= r.end) {\n            if (regionNumber ? regionNumber === idx : true) {\n              offsetBp += r.reversed ? r.end - coord : coord - r.start\n              return true\n            }\n          }\n          offsetBp += r.end - r.start\n          return false\n        })\n        const foundRegion = self.displayedRegions[index]\n        if (foundRegion) {\n          return {\n            index,\n            offsetPx: Math.round(offsetBp / self.bpPerPx),\n          }\n        }\n\n        return undefined\n      },\n      /**\n       *\n       * @param px - px in the view area, return value is the displayed regions\n       * @returns BpOffset of the displayed region that it lands in\n       */\n      pxToBp(px: number) {\n        let bpSoFar = 0\n        const bp = (self.offsetPx + px) * self.bpPerPx\n        const n = self.displayedRegions.length\n        if (bp < 0) {\n          const region = self.displayedRegions[0]\n          const offset = bp\n          return {\n            ...getSnapshot(region),\n            oob: true,\n            coord: region.reversed\n              ? Math.floor(region.end - offset) + 1\n              : Math.floor(region.start + offset) + 1,\n            offset,\n            index: 0,\n          }\n        }\n        if (bp >= this.totalBp) {\n          const region = self.displayedRegions[n - 1]\n          const len = region.end - region.start\n          const offset = bp - this.totalBp + len\n          return {\n            ...getSnapshot(region),\n            oob: true,\n            offset,\n            coord: region.reversed\n              ? Math.floor(region.end - offset) + 1\n              : Math.floor(region.start + offset) + 1,\n            index: n - 1,\n          }\n        }\n        for (let index = 0; index < self.displayedRegions.length; index += 1) {\n          const region = self.displayedRegions[index]\n          const len = region.end - region.start\n          if (len + bpSoFar > bp && bpSoFar <= bp) {\n            const offset = bp - bpSoFar\n            return {\n              ...getSnapshot(region),\n              oob: false,\n              offset,\n              coord: region.reversed\n                ? Math.floor(region.end - offset) + 1\n                : Math.floor(region.start + offset) + 1,\n              index,\n            }\n          }\n          bpSoFar += len\n        }\n        throw new Error('pxToBp failed to map to a region')\n      },\n      getTrack(id: string) {\n        return self.tracks.find(t => t.configuration.trackId === id)\n      },\n\n      // modifies view menu action onClick to apply to all tracks of same type\n      rewriteOnClicks(trackType: string, viewMenuActions: MenuItem[]) {\n        viewMenuActions.forEach((action: MenuItem) => {\n          // go to lowest level menu\n          if ('subMenu' in action) {\n            this.rewriteOnClicks(trackType, action.subMenu)\n          }\n          if ('onClick' in action) {\n            const holdOnClick = action.onClick\n            action.onClick = (...args: unknown[]) => {\n              self.tracks.forEach(track => {\n                if (track.type === trackType) {\n                  holdOnClick.apply(track, [track, ...args])\n                }\n              })\n            }\n          }\n        })\n      },\n\n      get trackTypeActions() {\n        const allActions: Map<string, MenuItem[]> = new Map()\n        self.tracks.forEach(track => {\n          const trackInMap = allActions.get(track.type)\n          if (!trackInMap) {\n            const viewMenuActions = clone(track.viewMenuActions)\n            this.rewriteOnClicks(track.type, viewMenuActions)\n            allActions.set(track.type, viewMenuActions)\n          }\n        })\n\n        return allActions\n      },\n\n      get centerLineInfo() {\n        const centerLineInfo = self.displayedRegions.length\n          ? this.pxToBp(self.width / 2)\n          : undefined\n        return centerLineInfo\n      },\n    }))\n    .actions(self => ({\n      setWidth(newWidth: number) {\n        self.volatileWidth = newWidth\n      },\n\n      setError(error: Error | undefined) {\n        self.error = error\n      },\n\n      toggleHeader() {\n        self.hideHeader = !self.hideHeader\n      },\n\n      toggleHeaderOverview() {\n        self.hideHeaderOverview = !self.hideHeaderOverview\n      },\n\n      scrollTo(offsetPx: number) {\n        const newOffsetPx = clamp(offsetPx, self.minOffset, self.maxOffset)\n        self.offsetPx = newOffsetPx\n        return newOffsetPx\n      },\n\n      zoomTo(bpPerPx: number) {\n        const newBpPerPx = clamp(bpPerPx, self.minBpPerPx, self.maxBpPerPx)\n        if (newBpPerPx === self.bpPerPx) {\n          return newBpPerPx\n        }\n        const oldBpPerPx = self.bpPerPx\n        self.bpPerPx = newBpPerPx\n\n        if (Math.abs(oldBpPerPx - newBpPerPx) < 0.000001) {\n          console.warn('zoomTo bpPerPx rounding error')\n          return oldBpPerPx\n        }\n\n        // tweak the offset so that the center of the view remains at the same coordinate\n        const viewWidth = self.width\n        this.scrollTo(\n          Math.round(\n            ((self.offsetPx + viewWidth / 2) * oldBpPerPx) / newBpPerPx -\n              viewWidth / 2,\n          ),\n        )\n        return newBpPerPx\n      },\n\n      setNewView(bpPerPx: number, offsetPx: number) {\n        this.zoomTo(bpPerPx)\n        this.scrollTo(offsetPx)\n      },\n\n      horizontallyFlip() {\n        self.displayedRegions = cast(\n          self.displayedRegions\n            .slice()\n            .reverse()\n            .map(region => ({ ...region, reversed: !region.reversed })),\n        )\n        this.scrollTo(self.totalBp / self.bpPerPx - self.offsetPx - self.width)\n      },\n\n      showTrack(trackId: string, initialSnapshot = {}) {\n        const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'track',\n        )\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        const trackType = pluginManager.getTrackType(configuration.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${configuration.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const supportedDisplays = viewType.displayTypes.map(\n          displayType => displayType.name,\n        )\n        const displayConf = configuration.displays.find(\n          (d: AnyConfigurationModel) => supportedDisplays.includes(d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `could not find a compatible display for view type ${self.type}`,\n          )\n        }\n        const track = trackType.stateModel.create({\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n          displays: [{ type: displayConf.type, configuration: displayConf }],\n        })\n        self.tracks.push(track)\n      },\n\n      hideTrack(trackId: string) {\n        const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'track',\n        )\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        // if we have any tracks with that configuration, turn them off\n        const shownTracks = self.tracks.filter(\n          t => t.configuration === configuration,\n        )\n        transaction(() => shownTracks.forEach(t => self.tracks.remove(t)))\n        return shownTracks.length\n      },\n    }))\n    .actions(self => ({\n      moveTrack(movingTrackId: string, targetTrackId: string) {\n        const oldIndex = self.tracks.findIndex(\n          track => track.id === movingTrackId,\n        )\n        if (oldIndex === -1)\n          throw new Error(`Track ID ${movingTrackId} not found`)\n        const newIndex = self.tracks.findIndex(\n          track => track.id === targetTrackId,\n        )\n        if (newIndex === -1)\n          throw new Error(`Track ID ${targetTrackId} not found`)\n        const track = getSnapshot(self.tracks[oldIndex])\n        self.tracks.splice(oldIndex, 1)\n        self.tracks.splice(newIndex, 0, track)\n      },\n\n      closeView() {\n        const parent = getContainingView(self)\n        if (parent) {\n          // I am embedded in a some other view\n          if (isViewContainer(parent)) parent.removeView(self)\n        } else {\n          // I am part of a session\n          getSession(self).removeView(self)\n        }\n      },\n\n      toggleTrack(trackId: string) {\n        // if we have any tracks with that configuration, turn them off\n        const hiddenCount = self.hideTrack(trackId)\n        // if none had that configuration, turn one on\n        if (!hiddenCount) {\n          self.showTrack(trackId)\n        }\n      },\n\n      setTrackLabels(setting: 'overlapping' | 'offset' | 'hidden') {\n        self.trackLabels = setting\n      },\n\n      toggleCenterLine() {\n        self.showCenterLine = !self.showCenterLine\n      },\n\n      setDisplayedRegions(regions: Region[]) {\n        self.displayedRegions = cast(regions)\n        self.zoomTo(self.bpPerPx)\n      },\n\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      navToLocString(locString: string) {\n        const { assemblyManager } = getSession(self)\n        const { isValidRefName } = assemblyManager\n        const locStrings = locString.split(';')\n        if (self.displayedRegions.length > 1) {\n          const locations = locStrings.map(ls =>\n            parseLocString(ls, isValidRefName),\n          )\n          this.navToMultiple(locations)\n          return\n        }\n        const displayedRegion = self.displayedRegions[0]\n        const { assemblyName } = displayedRegion\n        let assembly = assemblyManager.get(assemblyName)\n        if (!assembly) {\n          throw new Error(\n            `Could not find assembly ${displayedRegion.assemblyName}`,\n          )\n        }\n        const { regions } = assembly\n        if (!regions) {\n          throw new Error(\n            `Regions for assembly ${displayedRegion.assemblyName} not yet loaded`,\n          )\n        }\n        const matchedRegion = regions.find(\n          region =>\n            region.refName === displayedRegion.refName &&\n            region.start === displayedRegion.start &&\n            region.end === displayedRegion.end,\n        )\n        if (matchedRegion) {\n          if (locStrings.length > 1) {\n            throw new Error(\n              'Navigating to multiple locations is not allowed when viewing a whole chromosome',\n            )\n          }\n          const parsedLocString = parseLocString(locStrings[0], refName =>\n            isValidRefName(refName, assemblyName),\n          )\n          let changedAssembly = false\n          if (\n            parsedLocString.assemblyName &&\n            parsedLocString.assemblyName !== displayedRegion.assemblyName\n          ) {\n            const newAssembly = assemblyManager.get(\n              parsedLocString.assemblyName,\n            )\n            if (!newAssembly) {\n              throw new Error(\n                `Could not find assembly ${parsedLocString.assemblyName}`,\n              )\n            }\n            assembly = newAssembly\n            changedAssembly = true\n          }\n          const canonicalRefName = assembly.getCanonicalRefName(\n            parsedLocString.refName,\n          )\n          if (!canonicalRefName) {\n            throw new Error(\n              `Could not find refName ${parsedLocString.refName} in ${assembly.name}`,\n            )\n          }\n          if (changedAssembly || canonicalRefName !== displayedRegion.refName) {\n            const newDisplayedRegion = regions.find(\n              region => region.refName === canonicalRefName,\n            )\n            if (newDisplayedRegion) {\n              this.setDisplayedRegions([getSnapshot(newDisplayedRegion)])\n            } else {\n              throw new Error(\n                `Could not find refName ${parsedLocString.refName} in ${assembly.name}`,\n              )\n            }\n          }\n          this.navTo(parsedLocString)\n        }\n      },\n\n      /**\n       * Navigate to a location based on its refName and optionally start, end,\n       * and assemblyName. Can handle if there are multiple displayedRegions\n       * from same refName. Only navigates to a location if it is entirely\n       * within a displayedRegion. Navigates to the first matching location\n       * encountered.\n       *\n       * Throws an error if navigation was unsuccessful\n       *\n       * @param location - a proposed location to navigate to\n       */\n      navTo(query: NavLocation) {\n        this.navToMultiple([query])\n      },\n\n      navToMultiple(locations: NavLocation[]) {\n        const firstLocation = locations[0]\n        let { refName } = firstLocation\n        const {\n          start,\n          end,\n          assemblyName = self.assemblyNames[0],\n        } = firstLocation\n\n        if (start !== undefined && end !== undefined && start > end) {\n          throw new Error(`start \"${start + 1}\" is greater than end \"${end}\"`)\n        }\n        const session = getSession(self)\n        const { assemblyManager } = session\n        const assembly = assemblyManager.get(assemblyName)\n        if (assembly) {\n          const canonicalRefName = assembly.getCanonicalRefName(refName)\n          if (canonicalRefName) {\n            refName = canonicalRefName\n          }\n        }\n        let s = start\n        let e = end\n        let refNameMatched = false\n\n        const predicate = (r: Region) => {\n          if (refName === r.refName) {\n            refNameMatched = true\n            if (s === undefined) {\n              s = r.start\n            }\n            if (e === undefined) {\n              e = r.end\n            }\n            if (s >= r.start && s <= r.end && e <= r.end && e >= r.start) {\n              return true\n            }\n            s = start\n            e = end\n          }\n          return false\n        }\n\n        const lastIndex = findLastIndex(self.displayedRegions, predicate)\n        let index\n        while (index !== lastIndex) {\n          try {\n            const previousIndex: number | undefined = index\n            index = self.displayedRegions\n              .slice(previousIndex === undefined ? 0 : previousIndex + 1)\n              .findIndex(predicate)\n            if (previousIndex !== undefined) {\n              index += previousIndex + 1\n            }\n            if (!refNameMatched) {\n              throw new Error(\n                `could not find a region with refName \"${refName}\"`,\n              )\n            }\n            if (s === undefined) {\n              throw new Error(\n                `could not find a region with refName \"${refName}\" that contained an end position ${e}`,\n              )\n            }\n            if (e === undefined) {\n              throw new Error(\n                `could not find a region with refName \"${refName}\" that contained a start position ${\n                  s + 1\n                }`,\n              )\n            }\n            if (index === -1) {\n              throw new Error(\n                `could not find a region that completely contained \"${assembleLocString(\n                  firstLocation,\n                )}\"`,\n              )\n            }\n            if (locations.length === 1) {\n              const f = self.displayedRegions[index]\n              this.moveTo(\n                { index, offset: f.reversed ? f.end - e : s - f.start },\n                { index, offset: f.reversed ? f.end - s : e - f.start },\n              )\n              return\n            }\n            let locationIndex = 0\n            let locationStart = 0\n            let locationEnd = 0\n            for (\n              locationIndex;\n              locationIndex < locations.length;\n              locationIndex++\n            ) {\n              const location = locations[locationIndex]\n              const region = self.displayedRegions[index + locationIndex]\n              locationStart = location.start || region.start\n              locationEnd = location.end || region.end\n              if (location.refName !== region.refName) {\n                throw new Error(\n                  `Entered location ${assembleLocString(\n                    location,\n                  )} does not match with displayed regions`,\n                )\n              }\n              if (locationIndex > 0) {\n                // does it reach the left side?\n                const matchesLeft = region.reversed\n                  ? locationEnd === region.end\n                  : locationStart === region.start\n                if (!matchesLeft) {\n                  throw new Error(\n                    `${\n                      region.reversed ? 'End' : 'Start'\n                    } of region ${assembleLocString(\n                      location,\n                    )} should be ${(region.reversed\n                      ? region.end\n                      : region.start + 1\n                    ).toLocaleString('en-US')}, but it is not`,\n                  )\n                }\n              }\n              const isLast = locationIndex === locations.length - 1\n              if (!isLast) {\n                // does it reach the right side?\n                const matchesRight = region.reversed\n                  ? locationStart === region.start\n                  : locationEnd === region.end\n                if (!matchesRight) {\n                  throw new Error(\n                    `${\n                      region.reversed ? 'Start' : 'End'\n                    } of region ${assembleLocString(\n                      location,\n                    )} should be ${(region.reversed\n                      ? region.start + 1\n                      : region.end\n                    ).toLocaleString('en-US')}, but it is not`,\n                  )\n                }\n              }\n            }\n            locationIndex -= 1\n            const startDisplayedRegion = self.displayedRegions[index]\n            const endDisplayedRegion =\n              self.displayedRegions[index + locationIndex]\n            this.moveTo(\n              {\n                index,\n                offset: startDisplayedRegion.reversed\n                  ? startDisplayedRegion.end - e\n                  : s - startDisplayedRegion.start,\n              },\n              {\n                index: index + locationIndex,\n                offset: endDisplayedRegion.reversed\n                  ? endDisplayedRegion.end - locationStart\n                  : locationEnd - endDisplayedRegion.start,\n              },\n            )\n            return\n          } catch (error) {\n            if (index === lastIndex) {\n              throw error\n            }\n          }\n        }\n      },\n\n      /**\n       * Navigate to a location based on user clicking and dragging on the\n       * overview scale bar to select a region to zoom into.\n       * Can handle if there are multiple displayedRegions from same refName.\n       * Only navigates to a location if it is entirely within a displayedRegion.\n       *\n       * @param leftPx- `object as {start, end, index, offset}`, offset = start of user drag\n       * @param rightPx- `object as {start, end, index, offset}`, offset = end of user drag\n       */\n      zoomToDisplayedRegions(leftPx: BpOffset, rightPx: BpOffset) {\n        if (leftPx === undefined || rightPx === undefined) return\n\n        const singleRefSeq =\n          leftPx.refName === rightPx.refName && leftPx.index === rightPx.index\n        // zooming into one displayed Region\n        if (\n          (singleRefSeq && rightPx.offset < leftPx.offset) ||\n          leftPx.index > rightPx.index\n        ) {\n          ;[leftPx, rightPx] = [rightPx, leftPx]\n        }\n        const startOffset = {\n          start: leftPx.start,\n          end: leftPx.end,\n          index: leftPx.index,\n          offset: leftPx.offset,\n        }\n        const endOffset = {\n          start: rightPx.start,\n          end: rightPx.end,\n          index: rightPx.index,\n          offset: rightPx.offset,\n        }\n        if (startOffset && endOffset) {\n          this.moveTo(startOffset, endOffset)\n        } else {\n          const session = getSession(self)\n          session.notify('No regions found to navigate to', 'warning')\n        }\n      },\n\n      // schedule something to be run after the next time displayedRegions is set\n      afterDisplayedRegionsSet(cb: Function) {\n        self.afterDisplayedRegionsSetCallbacks.push(cb)\n      },\n\n      /**\n       * offset is the base-pair-offset in the displayed region, index is the index of the\n       * displayed region in the linear genome view\n       *\n       * @param start - object as `{start, end, offset, index}`\n       * @param end - object as `{start, end, offset, index}`\n       */\n      moveTo(start: BpOffset, end: BpOffset) {\n        // find locations in the modellist\n        let bpSoFar = 0\n\n        if (start.index === end.index) {\n          bpSoFar += end.offset - start.offset\n        } else {\n          const s = self.displayedRegions[start.index]\n          bpSoFar += s.end - s.start - start.offset\n          if (end.index - start.index >= 2) {\n            for (let i = start.index + 1; i < end.index; i += 1) {\n              bpSoFar +=\n                self.displayedRegions[i].end - self.displayedRegions[i].start\n            }\n          }\n          bpSoFar += end.offset\n        }\n        const targetBpPerPx =\n          bpSoFar /\n          (self.width -\n            self.interRegionPaddingWidth * (end.index - start.index))\n        const newBpPerPx = self.zoomTo(targetBpPerPx)\n        // If our target bpPerPx was smaller than the allowed minBpPerPx, adjust\n        // the scroll so the requested range is in the middle of the screen\n        let extraBp = 0\n        if (targetBpPerPx < newBpPerPx) {\n          extraBp = ((newBpPerPx - targetBpPerPx) * self.width) / 2\n        }\n\n        let bpToStart = -extraBp\n        for (let i = 0; i < self.displayedRegions.length; i += 1) {\n          const region = self.displayedRegions[i]\n          if (start.index === i) {\n            bpToStart += start.offset\n            break\n          } else {\n            bpToStart += region.end - region.start\n          }\n        }\n        self.scrollTo(\n          Math.round(bpToStart / self.bpPerPx) +\n            self.interRegionPaddingWidth * start.index,\n        )\n      },\n\n      horizontalScroll(distance: number) {\n        const oldOffsetPx = self.offsetPx\n        // newOffsetPx is the actual offset after the scroll is clamped\n        const newOffsetPx = self.scrollTo(self.offsetPx + distance)\n        return newOffsetPx - oldOffsetPx\n      },\n\n      /**\n       * scrolls the view to center on the given bp. if that is not in any\n       * of the displayed regions, does nothing\n       * @param bp-basepair at which you want to center the view\n       * @param refName-refName of the displayedRegion you are centering at\n       * @param regionIndex-index of the displayedRegion\n       */\n      centerAt(bp: number, refName: string, regionIndex: number) {\n        const centerPx = self.bpToPx({\n          refName,\n          coord: bp,\n          regionNumber: regionIndex,\n        })\n        if (centerPx) {\n          self.scrollTo(Math.round(centerPx.offsetPx - self.width / 2))\n        }\n      },\n\n      center() {\n        const centerBp = self.totalBp / 2\n        self.scrollTo(Math.round(centerBp / self.bpPerPx - self.width / 2))\n      },\n\n      showAllRegions() {\n        self.zoomTo(self.maxBpPerPx)\n        this.center()\n      },\n\n      setDraggingTrackId(idx?: string) {\n        self.draggingTrackId = idx\n      },\n\n      setScaleFactor(factor: number) {\n        self.scaleFactor = factor\n      },\n    }))\n    .actions(self => {\n      let cancelLastAnimation = () => {}\n\n      function slide(viewWidths: number) {\n        const [animate, cancelAnimation] = springAnimate(\n          self.offsetPx,\n          self.offsetPx + self.width * viewWidths,\n          self.scrollTo,\n        )\n        cancelLastAnimation()\n        cancelLastAnimation = cancelAnimation\n        animate()\n      }\n\n      return { slide }\n    })\n    .actions(self => {\n      let cancelLastAnimation = () => {}\n\n      function zoom(targetBpPerPx: number) {\n        self.zoomTo(self.bpPerPx)\n        if (\n          // already zoomed all the way in\n          (targetBpPerPx < self.bpPerPx && self.bpPerPx === self.minBpPerPx) ||\n          // already zoomed all the way out\n          (targetBpPerPx > self.bpPerPx && self.bpPerPx === self.maxBpPerPx)\n        ) {\n          return\n        }\n        const factor = self.bpPerPx / targetBpPerPx\n        const [animate, cancelAnimation] = springAnimate(\n          1,\n          factor,\n          self.setScaleFactor,\n          () => {\n            self.zoomTo(targetBpPerPx)\n            self.setScaleFactor(1)\n          },\n        )\n        cancelLastAnimation()\n        cancelLastAnimation = cancelAnimation\n        animate()\n      }\n\n      return { zoom }\n    })\n    .views(self => {\n      let currentlyCalculatedStaticBlocks: BlockSet | undefined\n      let stringifiedCurrentlyCalculatedStaticBlocks = ''\n      return {\n        get menuItems(): MenuItem[] {\n          const menuItems: MenuItem[] = [\n            {\n              label: 'Open track selector',\n              onClick: self.activateTrackSelector,\n              icon: TrackSelectorIcon,\n            },\n            {\n              label: 'Horizontally flip',\n              icon: SyncAltIcon,\n              onClick: self.horizontallyFlip,\n            },\n            {\n              label: 'Show all regions',\n              icon: VisibilityIcon,\n              onClick: self.showAllRegions,\n            },\n            {\n              label: 'Show center line',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showCenterLine,\n              onClick: self.toggleCenterLine,\n            },\n            { type: 'divider' },\n            {\n              label: 'Show header',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: !self.hideHeader,\n              onClick: self.toggleHeader,\n            },\n            {\n              label: 'Show header overview',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: !self.hideHeaderOverview,\n              onClick: self.toggleHeaderOverview,\n              disabled: self.hideHeader,\n            },\n            {\n              label: 'Track labels',\n              icon: LabelIcon,\n              subMenu: [\n                {\n                  label: 'Overlapping',\n                  icon: VisibilityIcon,\n                  type: 'radio',\n                  checked: self.trackLabels === 'overlapping',\n                  onClick: () => self.setTrackLabels('overlapping'),\n                },\n                {\n                  label: 'Offset',\n                  icon: VisibilityIcon,\n                  type: 'radio',\n                  checked: self.trackLabels === 'offset',\n                  onClick: () => self.setTrackLabels('offset'),\n                },\n                {\n                  label: 'Hidden',\n                  icon: VisibilityIcon,\n                  type: 'radio',\n                  checked: self.trackLabels === 'hidden',\n                  onClick: () => self.setTrackLabels('hidden'),\n                },\n              ],\n            },\n          ]\n\n          // add track's view level menu options\n          for (const [key, value] of self.trackTypeActions.entries()) {\n            if (value.length) {\n              menuItems.push(\n                { type: 'divider' },\n                { type: 'subHeader', label: key },\n              )\n              value.forEach(action => {\n                menuItems.push(action)\n              })\n            }\n          }\n\n          return menuItems\n        },\n\n        get staticBlocks() {\n          const ret = calculateStaticBlocks(self)\n          const sret = JSON.stringify(ret)\n          if (stringifiedCurrentlyCalculatedStaticBlocks !== sret) {\n            currentlyCalculatedStaticBlocks = ret\n            stringifiedCurrentlyCalculatedStaticBlocks = sret\n          }\n          return currentlyCalculatedStaticBlocks as BlockSet\n        },\n\n        get dynamicBlocks() {\n          return calculateDynamicBlocks(self)\n        },\n        get visibleLocStrings() {\n          return calculateVisibleLocStrings(this.dynamicBlocks.contentBlocks)\n        },\n        get coarseVisibleLocStrings() {\n          return calculateVisibleLocStrings(self.coarseDynamicBlocks)\n        },\n      }\n    })\n    .actions(self => ({\n      setCoarseDynamicBlocks(blocks: BlockSet) {\n        self.coarseDynamicBlocks = blocks.contentBlocks\n        self.coarseTotalBp = blocks.totalBp\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              if (self.initialized) {\n                this.setCoarseDynamicBlocks(self.dynamicBlocks)\n              }\n            },\n            { delay: 150 },\n          ),\n        )\n      },\n    }))\n\n  return types.compose(BaseViewModel, model)\n}\nexport type LinearGenomeViewStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearGenomeViewModel = Instance<LinearGenomeViewStateModel>\n","import {\n  configSchema as baseFeatureWidgetConfigSchema,\n  ReactComponent as BaseFeatureWidgetReactComponent,\n  stateModel as baseFeatureWidgetStateModel,\n} from '@jbrowse/core/BaseFeatureWidget'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\nimport LineStyleIcon from '@material-ui/icons/LineStyle'\nimport {\n  BaseLinearDisplay,\n  BaseLinearDisplayComponent,\n  baseLinearDisplayConfigSchema,\n  BlockModel,\n} from './BaseLinearDisplay'\nimport {\n  configSchemaFactory as linearBasicDisplayConfigSchemaFactory,\n  stateModelFactory as LinearBasicDisplayStateModelFactory,\n} from './LinearBasicDisplay'\nimport {\n  LinearGenomeViewModel,\n  LinearGenomeViewStateModel,\n  ReactComponent as LinearGenomeViewReactComponent,\n  stateModelFactory as linearGenomeViewStateModelFactory,\n} from './LinearGenomeView'\n\nexport default class LinearGenomeViewPlugin extends Plugin {\n  name = 'LinearGenomeViewPlugin'\n\n  exports = {\n    BaseLinearDisplayComponent,\n    BaseLinearDisplay,\n    baseLinearDisplayConfigSchema,\n  }\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'FeatureTrack',\n        {},\n        {\n          baseConfiguration: createBaseTrackConfig(pluginManager),\n          explicitIdentifier: 'trackId',\n        },\n      )\n      return new TrackType({\n        name: 'FeatureTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'FeatureTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearBasicDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearBasicDisplay',\n        configSchema,\n        stateModel: LinearBasicDisplayStateModelFactory(configSchema),\n        trackType: 'FeatureTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n\n    pluginManager.addViewType(\n      () =>\n        new ViewType({\n          name: 'LinearGenomeView',\n          stateModel: linearGenomeViewStateModelFactory(pluginManager),\n          ReactComponent: LinearGenomeViewReactComponent,\n        }),\n    )\n    pluginManager.addWidgetType(\n      () =>\n        new WidgetType({\n          name: 'BaseFeatureWidget',\n          heading: 'Feature Details',\n          configSchema: baseFeatureWidgetConfigSchema,\n          stateModel: baseFeatureWidgetStateModel,\n          ReactComponent: BaseFeatureWidgetReactComponent,\n        }),\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['File', 'Add'], {\n        label: 'Linear genome view',\n        icon: LineStyleIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('LinearGenomeView', {})\n        },\n      })\n    }\n  }\n}\n\nexport {\n  BaseLinearDisplayComponent,\n  BaseLinearDisplay,\n  baseLinearDisplayConfigSchema,\n  linearBasicDisplayConfigSchemaFactory,\n}\nexport type { LinearGenomeViewModel, LinearGenomeViewStateModel, BlockModel }\nexport type { BaseLinearDisplayModel } from './BaseLinearDisplay'\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { NoAssemblyRegion, Region } from '@jbrowse/core/util/types'\nimport { Observable } from 'rxjs'\nimport { reduce } from 'rxjs/operators'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\n\nexport interface UnrectifiedFeatureStats {\n  scoreMin: number\n  scoreMax: number\n  scoreSum: number\n  scoreSumSquares: number\n  featureCount: number\n  basesCovered: number\n}\nexport interface FeatureStats extends UnrectifiedFeatureStats {\n  scoreMean: number\n  scoreStdDev: number\n  featureDensity: number\n}\n\n/*\n * calculate standard deviation using the 'shortcut method' that accepts\n * the sum and the sum squares of the elements\n *\n * @param sum - sum(i, 1..n)\n * @param sumSquares - sum(i^2, 1..n)\n * @param n - number of elements\n * @param population - boolean: use population instead of sample correction\n * @return the estimated std deviation\n */\n\nexport function calcStdFromSums(\n  sum: number,\n  sumSquares: number,\n  n: number,\n  population = false,\n): number {\n  if (n === 0) return 0\n  let variance\n  if (population) {\n    variance = sumSquares / n - (sum * sum) / (n * n)\n  } else {\n    // sample correction is n-1\n    variance = sumSquares - (sum * sum) / n\n    if (n > 1) {\n      variance /= n - 1\n    }\n  }\n\n  return variance < 0 ? 0 : Math.sqrt(variance)\n}\n\n/*\n * @param stats - a summary stats object with scoreSum, featureCount, scoreSumSquares, and basesCovered\n * @return - a summary stats object with scoreMean, scoreStdDev, and featureDensity added\n */\nexport function rectifyStats(s: UnrectifiedFeatureStats): FeatureStats {\n  return {\n    ...s,\n    scoreMean: (s.scoreSum || 0) / (s.featureCount || s.basesCovered || 1),\n    scoreStdDev: calcStdFromSums(\n      s.scoreSum,\n      s.scoreSumSquares,\n      s.featureCount || s.basesCovered,\n    ),\n    featureDensity: (s.featureCount || 1) / s.basesCovered,\n  }\n}\n\n/*\n * calculates per-base scores for variable width features over a region\n * @param region - object contains start, end\n * @param features - list of features with start, end, score\n * @return array of numeric scores\n */\nexport function calcPerBaseStats(\n  region: NoAssemblyRegion,\n  features: Feature[],\n): number[] {\n  const { start, end } = region\n  const scores = []\n  const feats = features.sort((a, b) => a.get('start') - b.get('start'))\n  let pos = start\n  let currentFeat = 0\n  let i = 0\n\n  while (pos < end) {\n    while (currentFeat < feats.length && pos >= feats[currentFeat].get('end')) {\n      currentFeat += 1\n    }\n    const f = feats[currentFeat]\n    if (!f) {\n      scores[i] = 0\n    } else if (pos >= f.get('start') && pos < f.get('end')) {\n      scores[i] = f.get('score')\n    } else {\n      scores[i] = 0\n    }\n    i += 1\n    pos += 1\n  }\n  return scores\n}\n\n/*\n * transform a list of scores to summary statistics\n * @param region - object with start, end\n * @param feats - array of features which are possibly summary features\n * @return - object with scoreMax, scoreMin, scoreSum, scoreSumSquares, etc\n */\nexport async function scoresToStats(\n  region: NoAssemblyRegion,\n  features: Observable<Feature>,\n): Promise<FeatureStats> {\n  const { start, end } = region\n\n  const {\n    scoreMin,\n    scoreMax,\n    scoreSum,\n    scoreSumSquares,\n    featureCount,\n  } = await features\n    .pipe(\n      reduce(\n        (\n          seed: {\n            scoreMin: number\n            scoreMax: number\n            scoreSum: number\n            scoreSumSquares: number\n            featureCount: number\n          },\n          f: Feature,\n        ) => {\n          const score = f.get('score')\n          seed.scoreMax = Math.max(\n            seed.scoreMax,\n            f.get('summary') ? f.get('maxScore') : score,\n          )\n          seed.scoreMin = Math.min(\n            seed.scoreMin,\n            f.get('summary') ? f.get('minScore') : score,\n          )\n          seed.scoreSum += score\n          seed.scoreSumSquares += score * score\n          seed.featureCount += 1\n\n          return seed\n        },\n        {\n          scoreMin: Number.MAX_VALUE,\n          scoreMax: Number.MIN_VALUE,\n          scoreSum: 0,\n          scoreSumSquares: 0,\n          featureCount: 0,\n        },\n      ),\n    )\n    .toPromise()\n\n  return rectifyStats({\n    scoreMax,\n    scoreMin,\n    scoreSum,\n    scoreSumSquares,\n    featureCount,\n    basesCovered: end - start + 1,\n  })\n}\n\nexport function blankStats(): FeatureStats {\n  return {\n    scoreMin: 0,\n    scoreMax: 0,\n    scoreMean: 0,\n    scoreStdDev: 0,\n    scoreSum: 0,\n    scoreSumSquares: 0,\n    featureCount: 0,\n    featureDensity: 0,\n    basesCovered: 0,\n  }\n}\n\nexport interface DataAdapterWithGlobalStats extends BaseFeatureDataAdapter {\n  getGlobalStats(args: {\n    signal?: AbortSignal\n    headers?: Record<string, string>\n  }): Promise<FeatureStats>\n}\n\nexport function dataAdapterSupportsGlobalStats(\n  adapter: BaseFeatureDataAdapter,\n): adapter is DataAdapterWithGlobalStats {\n  return 'getGlobalStats' in adapter\n}\n\nexport interface DataAdapterWithMultiRegionStats\n  extends BaseFeatureDataAdapter {\n  getMultiRegionStats(\n    regions: Region[],\n    args: {\n      signal?: AbortSignal\n      bpPerPx: number\n      headers?: Record<string, string>\n    },\n  ): Promise<FeatureStats>\n}\n\nexport function dataAdapterSupportsMultiRegionStats(\n  adapter: BaseFeatureDataAdapter,\n): adapter is DataAdapterWithMultiRegionStats {\n  return 'getMultiRegionStats' in adapter\n}\n","import { BigWig, Feature as BBIFeature } from '@gmod/bbi'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { map, mergeAll } from 'rxjs/operators'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport {\n  blankStats,\n  rectifyStats,\n  scoresToStats,\n  UnrectifiedFeatureStats,\n  DataAdapterWithGlobalStats,\n} from '../statsUtil'\n\nimport configSchema from './configSchema'\n\nexport default class BigWigAdapter\n  extends BaseFeatureDataAdapter\n  implements DataAdapterWithGlobalStats {\n  private bigwig: BigWig\n\n  public constructor(config: Instance<typeof configSchema>) {\n    super(config)\n    this.bigwig = new BigWig({\n      filehandle: openLocation(readConfObject(config, 'bigWigLocation')),\n    })\n  }\n\n  private setup(opts?: BaseOptions) {\n    const { statusCallback = () => {} } = opts || {}\n    statusCallback('Downloading bigwig header')\n    const result = this.bigwig.getHeader(opts)\n    statusCallback('')\n    return result\n  }\n\n  public async getRefNames(opts?: BaseOptions) {\n    const header = await this.setup(opts)\n    return Object.keys(header.refsByName)\n  }\n\n  public async refIdToName(refId: number) {\n    const h = await this.setup()\n    return (h.refsByNumber[refId] || { name: undefined }).name\n  }\n\n  public async getGlobalStats(opts?: BaseOptions) {\n    const header = await this.setup(opts)\n    return rectifyStats(header.totalSummary as UnrectifiedFeatureStats)\n  }\n\n  // todo: incorporate summary blocks\n  public getRegionStats(region: NoAssemblyRegion, opts?: BaseOptions) {\n    const feats = this.getFeatures(region, opts)\n    return scoresToStats(region, feats)\n  }\n\n  // todo: add caching\n  public async getMultiRegionStats(\n    regions: NoAssemblyRegion[] = [],\n    opts?: BaseOptions,\n  ) {\n    if (!regions.length) {\n      return blankStats()\n    }\n    const feats = await Promise.all(\n      regions.map(region => this.getRegionStats(region, opts)),\n    )\n\n    const scoreMax = feats\n      .map(s => s.scoreMax)\n      .reduce((acc, curr) => Math.max(acc, curr))\n    const scoreMin = feats\n      .map(s => s.scoreMin)\n      .reduce((acc, curr) => Math.min(acc, curr))\n    const scoreSum = feats.map(s => s.scoreSum).reduce((a, b) => a + b, 0)\n    const scoreSumSquares = feats\n      .map(s => s.scoreSumSquares)\n      .reduce((a, b) => a + b, 0)\n    const featureCount = feats\n      .map(s => s.featureCount)\n      .reduce((a, b) => a + b, 0)\n    const basesCovered = feats\n      .map(s => s.basesCovered)\n      .reduce((a, b) => a + b, 0)\n\n    return rectifyStats({\n      scoreMin,\n      scoreMax,\n      featureCount,\n      basesCovered,\n      scoreSumSquares,\n      scoreSum,\n    })\n  }\n\n  public getFeatures(region: NoAssemblyRegion, opts?: BaseOptions) {\n    const { refName, start, end } = region\n    const { bpPerPx, signal, statusCallback = () => {} } = opts || {}\n    return ObservableCreate<Feature>(async observer => {\n      statusCallback('Downloading bigwig data')\n      const ob = await this.bigwig.getFeatureStream(refName, start, end, {\n        ...opts,\n        basesPerSpan: bpPerPx,\n      })\n      ob.pipe(\n        mergeAll(),\n        map((record: BBIFeature) => {\n          return new SimpleFeature({\n            id: String(record.start + 1),\n            data: record,\n          })\n        }),\n      ).subscribe(observer)\n    }, signal)\n  }\n\n  public freeResources(): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'BigWigAdapter',\n  {\n    bigWigLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bw' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { scaleLinear, scaleLog, scaleQuantize } from 'd3-scale'\n\nexport interface ScaleOpts {\n  domain: number[]\n  range: number[]\n  scaleType: string\n  pivotValue?: number\n  inverted: boolean\n}\n/**\n * produces a d3-scale from arguments. applies a \"nice domain\" adjustment\n *\n * @param object - containing attributes\n *   - domain [min,max]\n *   - range [min,max]\n *   - bounds [min,max]\n *   - scaleType (linear or log)\n *   - pivotValue (number)\n *   - inverted (boolean)\n */\nexport function getScale({\n  domain = [],\n  range = [],\n  scaleType,\n  pivotValue,\n  inverted,\n}: ScaleOpts) {\n  let scale\n  const [min, max] = domain\n  if (min === undefined || max === undefined) throw new Error('invalid domain')\n  if (scaleType === 'linear') {\n    scale = scaleLinear()\n  } else if (scaleType === 'log') {\n    scale = scaleLog()\n  } else if (scaleType === 'quantize') {\n    scale = scaleQuantize()\n  } else {\n    throw new Error('undefined scaleType')\n  }\n  scale.domain(pivotValue !== undefined ? [min, pivotValue, max] : [min, max])\n  scale.nice()\n\n  const [rangeMin, rangeMax] = range\n  if (rangeMin === undefined || rangeMax === undefined) {\n    throw new Error('invalid range')\n  }\n  scale.range(inverted ? range.slice().reverse() : range)\n  return scale\n}\n/**\n * gets the origin for drawing the graph. for linear this is 0, for log this is arbitrarily set to log(1)==0\n *\n * @param scaleType -\n */\nexport function getOrigin(scaleType: string /* , pivot, stats */) {\n  // if (pivot) {\n  //   if (pivot === 'mean') {\n  //     return stats.scoreMean || 0\n  //   }\n  //   if (pivot === 'zero') {\n  //     return 0\n  //   }\n  //   return parseFloat()\n  // }\n  // if (scaleType === 'z_score') {\n  //   return stats.scoreMean || 0\n  // }\n  if (scaleType === 'log') {\n    return 1\n  }\n  return 0\n}\n\n/**\n * produces a \"nice\" domain that actually rounds down to 0 for the min\n * or 0 to the max depending on if all values are positive or negative\n *\n * @param object - containing attributes\n *   - domain [min,max]\n *   - bounds [min,max]\n *   - mean\n *   - stddev\n *   - scaleType (linear or log)\n */\nexport function getNiceDomain({\n  scaleType,\n  domain,\n  bounds,\n}: {\n  scaleType: string\n  domain: number[]\n  bounds: number[]\n}) {\n  const [minScore, maxScore] = bounds\n  let [min, max] = domain\n\n  if (scaleType === 'linear') {\n    if (max < 0) max = 0\n    if (min > 0) min = 0\n  }\n  if (scaleType === 'log') {\n    // if the min is 0, assume that it's just something\n    // with no read coverage and that we should ignore it in calculations\n    // if it's greater than 1 pin to 1 for the full range also\n    // otherwise, we may see bigwigs with fractional values\n    if (min === 0 || min > 1) {\n      min = 1\n    }\n  }\n  if (min === undefined || max === undefined) {\n    throw new Error('invalid domain')\n  }\n  if (minScore !== undefined && minScore !== Number.MIN_VALUE) {\n    min = minScore\n  }\n  if (maxScore !== undefined && maxScore !== Number.MAX_VALUE) {\n    max = maxScore\n  }\n  const getScaleType = (type: string) => {\n    if (type === 'linear') {\n      return scaleLinear()\n    }\n    if (type === 'log') {\n      return scaleLog()\n    }\n    if (type === 'quantize') {\n      return scaleQuantize()\n    }\n    throw new Error(`undefined scaleType ${type}`)\n  }\n  const scale = getScaleType(scaleType)\n\n  scale.domain([min, max])\n  scale.nice()\n  return scale.domain() as [number, number]\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'WiggleRenderer',\n  {\n    color: {\n      type: 'color',\n      description: 'the color of track, overrides posColor and negColor',\n      defaultValue: '#f0f',\n    },\n    posColor: {\n      type: 'color',\n      description: 'the color to use when the score is positive',\n      defaultValue: 'blue',\n    },\n    negColor: {\n      type: 'color',\n      description: 'the color to use when the score is negative',\n      defaultValue: 'red',\n    },\n    highlightColor: {\n      type: 'color',\n      description: 'the color of highlights over the wiggle track',\n      defaultValue: 'rgba(255,255,0,0.5)',\n    },\n    clipColor: {\n      type: 'color',\n      description: 'the color of the clipping marker',\n      defaultValue: 'red',\n    },\n    renderType: {\n      type: 'stringEnum',\n      model: types.enumeration('Rendering type', ['xyplot', 'density', 'line']),\n      description: 'The type of rendering for wiggle data to use',\n      defaultValue: 'xyplot',\n    },\n    filled: {\n      type: 'boolean',\n      description: 'fill in histogram',\n      defaultValue: true,\n    },\n    bicolorPivot: {\n      type: 'stringEnum',\n      model: types.enumeration('Scale type', [\n        'numeric',\n        'mean',\n        'z_score',\n        'none',\n      ]),\n      description: 'type of bicolor pivot',\n      defaultValue: 'numeric',\n    },\n    bicolorPivotValue: {\n      type: 'number',\n      defaultValue: 0,\n      description: 'value to use for bicolor pivot',\n    },\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'whiskers',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import {\n  createCanvas,\n  createImageBitmap,\n} from '@jbrowse/core/util/offscreenCanvasPonyfill'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { Region } from '@jbrowse/core/util/types'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport ServerSideRendererType from '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType'\nimport React from 'react'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { ScaleOpts } from './util'\n\nexport interface WiggleBaseRendererProps {\n  features: Map<string, Feature>\n  config: AnyConfigurationModel\n  regions: Region[]\n  bpPerPx: number\n  height: number\n  width: number\n  highResolutionScaling: number\n  blockKey: string\n  dataAdapter: BaseFeatureDataAdapter\n  notReady: boolean\n  scaleOpts: ScaleOpts\n  sessionId: string\n  signal: AbortSignal\n  displayModel: unknown\n}\n\nexport default abstract class extends ServerSideRendererType {\n  async makeImageData(props: WiggleBaseRendererProps) {\n    const { height, regions, bpPerPx, highResolutionScaling = 1 } = props\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n    if (!(width > 0) || !(height > 0)) {\n      return { height: 0, width: 0 }\n    }\n    const canvas = createCanvas(\n      Math.ceil(width * highResolutionScaling),\n      height * highResolutionScaling,\n    )\n    const ctx = canvas.getContext('2d')\n    ctx.scale(highResolutionScaling, highResolutionScaling)\n    this.draw(ctx, props)\n\n    const imageData = await createImageBitmap(canvas)\n    return { imageData, height, width }\n  }\n\n  /** draw features to context given props */\n  abstract draw(\n    ctx: CanvasRenderingContext2D,\n    props: WiggleBaseRendererProps,\n  ): void\n\n  async render(renderProps: WiggleBaseRendererProps) {\n    const { height, width, imageData } = await this.makeImageData(renderProps)\n    const element = React.createElement(\n      this.ReactComponent,\n      { ...renderProps, height, width, imageData },\n      null,\n    )\n    return { element, imageData, height, width }\n  }\n}\n","import { observer } from 'mobx-react'\nimport React, { useRef } from 'react'\n\nimport { Region } from '@jbrowse/core/util/types'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\n\nfunction WiggleRendering(props: {\n  regions: Region[]\n  features: Map<string, Feature>\n  bpPerPx: number\n  width: number\n  height: number\n  onMouseLeave: Function\n  onMouseMove: Function\n}) {\n  const {\n    regions,\n    features,\n    bpPerPx,\n    width,\n    height,\n    onMouseLeave = () => {},\n    onMouseMove = () => {},\n  } = props\n  const [region] = regions\n  const ref = useRef<HTMLDivElement>(null)\n\n  return (\n    <div\n      ref={ref}\n      onMouseMove={event => {\n        let offset = 0\n        if (ref.current) {\n          offset = ref.current.getBoundingClientRect().left\n        }\n        const offsetX = event.clientX - offset\n        const px = region.reversed ? width - offsetX : offsetX\n        const clientBp = region.start + bpPerPx * px\n        let featureUnderMouse\n        for (const feature of features.values()) {\n          if (\n            clientBp <= feature.get('end') &&\n            clientBp >= feature.get('start')\n          ) {\n            featureUnderMouse = feature\n            break\n          }\n        }\n\n        onMouseMove(\n          event,\n          featureUnderMouse ? featureUnderMouse.id() : undefined,\n        )\n      }}\n      onMouseLeave={event => onMouseLeave(event)}\n      role=\"presentation\"\n      className=\"WiggleRendering\"\n      style={{\n        overflow: 'visible',\n        position: 'relative',\n        height,\n      }}\n    >\n      <PrerenderedCanvas {...props} />\n    </div>\n  )\n}\n\nexport default observer(WiggleRendering)\n","import {\n  readConfObject,\n  ConfigurationSchema,\n} from '@jbrowse/core/configuration'\nimport { featureSpanPx } from '@jbrowse/core/util'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { getScale } from '../util'\n\nimport ConfigSchema from '../configSchema'\nimport WiggleBaseRenderer, {\n  WiggleBaseRendererProps,\n} from '../WiggleBaseRenderer'\n\nexport { default as ReactComponent } from '../WiggleRendering'\n\nexport default class extends WiggleBaseRenderer {\n  draw(ctx: CanvasRenderingContext2D, props: WiggleBaseRendererProps) {\n    const { features, regions, bpPerPx, scaleOpts, height, config } = props\n    const [region] = regions\n    const pivot = readConfObject(config, 'bicolorPivot')\n    const pivotValue = readConfObject(config, 'bicolorPivotValue')\n    const negColor = readConfObject(config, 'negColor')\n    const posColor = readConfObject(config, 'posColor')\n    let colorCallback\n    let colorScale: ReturnType<typeof getScale>\n    if (readConfObject(config, 'color') === '#f0f') {\n      // default color, use posColor/negColor instead\n      colorScale =\n        pivot !== 'none'\n          ? getScale({\n              ...scaleOpts,\n              pivotValue,\n              range: [negColor, 'white', posColor],\n            })\n          : getScale({ ...scaleOpts, range: ['white', posColor] })\n      colorCallback = (feature: Feature) => colorScale(feature.get('score'))\n    } else {\n      colorCallback = (feature: Feature) =>\n        readConfObject(config, 'color', [feature])\n    }\n\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const w = rightPx - leftPx + 0.3 // fudge factor for subpixel rendering\n      ctx.fillStyle = colorCallback(feature)\n      ctx.fillRect(leftPx, 0, w, height)\n    }\n  }\n}\nexport const configSchema = ConfigurationSchema(\n  'DensityRenderer',\n  {},\n  { baseConfiguration: ConfigSchema, explicitlyTyped: true },\n)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport MUITooltip from '@material-ui/core/Tooltip'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\n\nconst toP = (s: number) => parseFloat(s.toPrecision(6))\n\nconst useStyles = makeStyles(theme => ({\n  popper: {\n    fontSize: '0.8em',\n    zIndex: theme.zIndex.tooltip, // important to have a zIndex directly on the popper itself, material-ui Tooltip uses popper and has similar thing\n    pointerEvents: 'none', // needed to avoid rapid mouseLeave/mouseEnter on popper\n  },\n\n  hoverVertical: {\n    background: '#333',\n    border: 'none',\n    width: 1,\n    height: '100%',\n    top: 0,\n    cursor: 'default',\n    position: 'absolute',\n    pointerEvents: 'none',\n  },\n}))\n\nfunction TooltipContents(props: { feature: Feature }) {\n  const { feature } = props\n  return feature.get('summary') !== undefined ? (\n    <div>\n      Summary\n      <br />\n      Max: {toP(feature.get('maxScore'))}\n      <br />\n      Avg: {toP(feature.get('score'))}\n      <br />\n      Min: {toP(feature.get('minScore'))}\n    </div>\n  ) : (\n    <div>{toP(feature.get('score'))}</div>\n  )\n}\n\ntype Coord = [number, number]\nconst Tooltip = observer(\n  ({\n    model,\n    height,\n    mouseCoord,\n  }: {\n    model: any\n    height: number\n    mouseCoord: Coord\n  }) => {\n    const { featureUnderMouse } = model\n    const classes = useStyles()\n\n    return featureUnderMouse ? (\n      <>\n        <MUITooltip\n          placement=\"right-start\"\n          className={classes.popper}\n          open\n          title={<TooltipContents feature={featureUnderMouse} />}\n        >\n          <div\n            style={{\n              position: 'absolute',\n              left: mouseCoord[0],\n              top: 0,\n            }}\n          >\n            {' '}\n          </div>\n        </MUITooltip>\n        <div\n          className={classes.hoverVertical}\n          style={{ left: mouseCoord[0], height }}\n        />\n      </>\n    ) : null\n  },\n)\n\nexport default Tooltip\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport {\n  isAbortException,\n  getSession,\n  getContainingView,\n} from '@jbrowse/core/util'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n  getTrackAssemblyNames,\n} from '@jbrowse/core/util/tracks'\nimport {\n  BaseLinearDisplay,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { autorun, observable } from 'mobx'\nimport { addDisposer, isAlive, types, Instance } from 'mobx-state-tree'\nimport React from 'react'\n\nimport { getNiceDomain } from '../../util'\n\nimport Tooltip from '../components/Tooltip'\nimport { FeatureStats } from '../../statsUtil'\nimport ConfigSchemaF from './configSchema'\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['xyplot', 'XYPlotRenderer'],\n  ['density', 'DensityRenderer'],\n  ['line', 'LinePlotRenderer'],\n])\n\nfunction logb(x: number, y: number) {\n  return Math.log(y) / Math.log(x)\n}\nfunction round(v: number, b = 1.5) {\n  return (v >= 0 ? 1 : -1) * Math.pow(b, 1 + Math.floor(logb(b, Math.abs(v))))\n}\n\ntype LGV = LinearGenomeViewModel\n\nconst stateModelFactory = (configSchema: ReturnType<typeof ConfigSchemaF>) =>\n  types\n    .compose(\n      'LinearWiggleDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearWiggleDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        selectedRendering: types.optional(types.string, ''),\n      }),\n    )\n    .volatile(() => ({\n      ready: false,\n      message: undefined as undefined | string,\n      stats: observable({ scoreMin: 0, scoreMax: 50 }),\n      statsFetchInProgress: undefined as undefined | AbortController,\n    }))\n    .actions(self => ({\n      updateStats(stats: { scoreMin: number; scoreMax: number }) {\n        self.stats.scoreMin = stats.scoreMin\n        self.stats.scoreMax = stats.scoreMax\n        self.ready = true\n      },\n\n      setLoading(aborter: AbortController) {\n        if (\n          self.statsFetchInProgress !== undefined &&\n          !self.statsFetchInProgress.signal.aborted\n        ) {\n          self.statsFetchInProgress.abort()\n        }\n        self.statsFetchInProgress = aborter\n      },\n    }))\n    .views(self => {\n      let oldDomain: [number, number] = [0, 0]\n      return {\n        get TooltipComponent(): React.FC {\n          return (Tooltip as unknown) as React.FC\n        },\n\n        get rendererTypeName() {\n          const viewName = getConf(self, 'defaultRendering')\n          const rendererType = rendererTypes.get(viewName)\n          if (!rendererType)\n            throw new Error(`unknown alignments view name ${viewName}`)\n          return rendererType\n        },\n\n        get domain() {\n          const maxScore = getConf(self, 'maxScore')\n          const minScore = getConf(self, 'minScore')\n          const ret = getNiceDomain({\n            domain: [self.stats.scoreMin, self.stats.scoreMax],\n            scaleType: getConf(self, 'scaleType'),\n            bounds: [minScore, maxScore],\n          })\n\n          // uses a heuristic to just give some extra headroom on bigwig scores\n          if (maxScore !== Number.MIN_VALUE && ret[1] > 1.0) {\n            ret[1] = round(ret[1])\n          }\n          if (minScore !== Number.MAX_VALUE && ret[0] < -1.0) {\n            ret[0] = round(ret[0])\n          }\n          if (JSON.stringify(oldDomain) !== JSON.stringify(ret)) {\n            oldDomain = ret\n          }\n          return oldDomain\n        },\n\n        get needsScalebar() {\n          return (\n            self.rendererTypeName === 'XYPlotRenderer' ||\n            self.rendererTypeName === 'LinePlotRenderer'\n          )\n        },\n\n        get renderProps() {\n          const config = self.rendererType.configSchema.create(\n            getConf(self, ['renderers', this.rendererTypeName]) || {},\n          )\n\n          return {\n            ...self.composedRenderProps,\n            ...getParentRenderProps(self),\n            notReady: !self.ready,\n            displayModel: self,\n            config,\n            scaleOpts: {\n              domain: this.domain,\n              stats: self.stats,\n              autoscaleType: getConf(self, 'autoscale'),\n              scaleType: getConf(self, 'scaleType'),\n              inverted: getConf(self, 'inverted'),\n            },\n            height: self.height,\n          }\n        },\n      }\n    })\n    .actions(self => {\n      const superReload = self.reload\n\n      async function getStats(opts: {\n        headers?: Record<string, string>\n        signal?: AbortSignal\n      }): Promise<FeatureStats> {\n        const { rpcManager } = getSession(self)\n        const nd = getConf(self, 'numStdDev')\n        const autoscaleType = getConf(self, 'autoscale', [])\n        const { adapterConfig } = self\n        if (autoscaleType === 'global' || autoscaleType === 'globalsd') {\n          const results = (await rpcManager.call(\n            getRpcSessionId(self),\n            'WiggleGetGlobalStats',\n            {\n              adapterConfig,\n              statusCallback: (message: string) => {\n                if (isAlive(self)) {\n                  self.setMessage(message)\n                }\n              },\n              ...opts,\n            },\n          )) as FeatureStats\n          const { scoreMin, scoreMean, scoreStdDev } = results\n          // globalsd uses heuristic to avoid unnecessary scoreMin<0\n          // if the scoreMin is never less than 0\n          // helps with most coverage bigwigs just being >0\n          return autoscaleType === 'globalsd'\n            ? {\n                ...results,\n                scoreMin: scoreMin >= 0 ? 0 : scoreMean - nd * scoreStdDev,\n                scoreMax: scoreMean + nd * scoreStdDev,\n              }\n            : results\n        }\n        if (autoscaleType === 'local' || autoscaleType === 'localsd') {\n          const { dynamicBlocks, bpPerPx } = getContainingView(self) as LGV\n          const sessionId = getRpcSessionId(self)\n          const results = (await rpcManager.call(\n            sessionId,\n            'WiggleGetMultiRegionStats',\n            {\n              adapterConfig,\n              assemblyName: getTrackAssemblyNames(self.parentTrack)[0],\n              regions: JSON.parse(\n                JSON.stringify(\n                  dynamicBlocks.contentBlocks.map(region => {\n                    const { start, end } = region\n                    return {\n                      ...region,\n                      start: Math.floor(start),\n                      end: Math.ceil(end),\n                    }\n                  }),\n                ),\n              ),\n              sessionId,\n              statusCallback: (message: string) => {\n                if (isAlive(self)) {\n                  self.setMessage(message)\n                }\n              },\n              bpPerPx,\n              ...opts,\n            },\n          )) as FeatureStats\n          const { scoreMin, scoreMean, scoreStdDev } = results\n          // localsd uses heuristic to avoid unnecessary scoreMin<0\n          // if the scoreMin is never less than 0\n          // helps with most coverage bigwigs just being >0\n          return autoscaleType === 'localsd'\n            ? {\n                ...results,\n                scoreMin: scoreMin >= 0 ? 0 : scoreMean - nd * scoreStdDev,\n                scoreMax: scoreMean + nd * scoreStdDev,\n              }\n            : results\n        }\n        if (autoscaleType === 'zscale') {\n          return rpcManager.call(\n            getRpcSessionId(self),\n            'WiggleGetGlobalStats',\n            {\n              adapterConfig,\n              statusCallback: (message: string) => {\n                if (isAlive(self)) {\n                  self.setMessage(message)\n                }\n              },\n              ...opts,\n            },\n          ) as Promise<FeatureStats>\n        }\n        throw new Error(`invalid autoscaleType '${autoscaleType}'`)\n      }\n      return {\n        // re-runs stats and refresh whole display on reload\n        async reload() {\n          self.setError('')\n          const aborter = new AbortController()\n          const stats = await getStats({\n            signal: aborter.signal,\n            headers: { cache: 'no-store,no-cache' },\n          })\n          if (isAlive(self)) {\n            self.updateStats(stats)\n            superReload()\n          }\n        },\n        afterAttach() {\n          addDisposer(\n            self,\n            autorun(\n              async () => {\n                try {\n                  const aborter = new AbortController()\n                  self.setLoading(aborter)\n                  const view = getContainingView(self) as LGV\n                  if (\n                    (!view.initialized && !self.ready) ||\n                    view.bpPerPx > self.maxViewBpPerPx\n                  ) {\n                    return\n                  }\n\n                  const stats = await getStats({ signal: aborter.signal })\n\n                  if (isAlive(self)) {\n                    self.updateStats(stats)\n                  }\n                } catch (e) {\n                  if (!isAbortException(e) && isAlive(self)) {\n                    self.setError(e)\n                  }\n                }\n              },\n              { delay: 1000 },\n            ),\n          )\n        },\n      }\n    })\n\nexport type WiggleDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type WiggleDisplayModel = Instance<WiggleDisplayStateModel>\n\nexport default stateModelFactory\n","import { getConf } from '@jbrowse/core/configuration'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport React from 'react'\nimport { Axis, axisPropsFromTickScale, RIGHT } from 'react-d3-axis'\nimport { getScale } from '../../util'\nimport { WiggleDisplayModel } from '../models/model'\n\nconst powersOfTen: number[] = []\nfor (let i = -20; i < 20; i += 1) {\n  powersOfTen.push(10 ** i)\n}\n\nexport const YScaleBar = observer(\n  ({ model }: { model: WiggleDisplayModel }) => {\n    const { domain, height } = model\n    const scaleType = getConf(model, 'scaleType')\n    const scale = getScale({\n      scaleType,\n      domain,\n      range: [height, 0],\n      inverted: getConf(model, 'inverted'),\n    })\n    const ticks = height < 50 ? 2 : 4\n    const axisProps = axisPropsFromTickScale(scale, ticks)\n    const values =\n      scaleType === 'log'\n        ? axisProps.values.filter((s: number) => powersOfTen.includes(s))\n        : axisProps.values\n\n    return (\n      <svg\n        style={{\n          position: 'absolute',\n          top: 0,\n          left: 300,\n          pointerEvents: 'none',\n          height,\n          width: 50,\n        }}\n      >\n        <Axis\n          {...axisProps}\n          values={values}\n          format={(n: number) => n}\n          style={{ orient: RIGHT }}\n        />\n      </svg>\n    )\n  },\n)\n\nfunction WiggleDisplayComponent(props: { model: WiggleDisplayModel }) {\n  const { model } = props\n  const { ready, stats, needsScalebar } = model\n  return (\n    <BaseLinearDisplayComponent {...props}>\n      {ready && stats && needsScalebar ? <YScaleBar model={model} /> : null}\n    </BaseLinearDisplayComponent>\n  )\n}\n\nWiggleDisplayComponent.propTypes = {\n  model: MobxPropTypes.observableObject.isRequired,\n}\n\nexport default observer(WiggleDisplayComponent)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { featureSpanPx } from '@jbrowse/core/util'\nimport Color from 'color'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { getOrigin, getScale } from '../util'\nimport WiggleBaseRenderer, {\n  WiggleBaseRendererProps,\n} from '../WiggleBaseRenderer'\n\nexport default class XYPlotRenderer extends WiggleBaseRenderer {\n  draw(ctx: CanvasRenderingContext2D, props: WiggleBaseRendererProps) {\n    const { features, bpPerPx, regions, scaleOpts, height, config } = props\n    const [region] = regions\n\n    const pivotValue = readConfObject(config, 'bicolorPivotValue')\n    const negColor = readConfObject(config, 'negColor')\n    const posColor = readConfObject(config, 'posColor')\n    const filled = readConfObject(config, 'filled')\n    const clipColor = readConfObject(config, 'clipColor')\n    const highlightColor = readConfObject(config, 'highlightColor')\n    const summaryScoreMode = readConfObject(config, 'summaryScoreMode')\n    const scale = getScale({ ...scaleOpts, range: [0, height] })\n    const originY = getOrigin(scaleOpts.scaleType)\n    const [niceMin, niceMax] = scale.domain()\n    const toY = (rawscore: number) => height - scale(rawscore)\n    const toHeight = (rawscore: number) => toY(originY) - toY(rawscore)\n    let colorCallback\n    if (readConfObject(config, 'color') === '#f0f') {\n      colorCallback = (feature: Feature) =>\n        feature.get('score') < pivotValue ? negColor : posColor\n    } else {\n      colorCallback = (feature: Feature) =>\n        readConfObject(config, 'color', [feature])\n    }\n\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      let score = feature.get('score')\n      const maxr = feature.get('maxScore')\n      const minr = feature.get('minScore')\n\n      const lowClipping = score < niceMin\n      const highClipping = score > niceMax\n      const w = rightPx - leftPx + 0.3 // fudge factor for subpixel rendering\n\n      const c = colorCallback(feature)\n      if (summaryScoreMode === 'max') {\n        score = maxr === undefined ? score : maxr\n        ctx.fillStyle = c\n        ctx.fillRect(leftPx, toY(score), w, filled ? toHeight(score) : 1)\n      } else if (summaryScoreMode === 'min') {\n        score = minr === undefined ? score : minr\n        ctx.fillStyle = c\n        ctx.fillRect(leftPx, toY(score), w, filled ? toHeight(score) : 1)\n      } else if (summaryScoreMode === 'whiskers') {\n        // max\n        if (maxr !== undefined) {\n          ctx.fillStyle = Color(c).lighten(0.6).toString()\n          ctx.fillRect(leftPx, toY(maxr), w, filled ? toHeight(maxr) : 1)\n        }\n\n        // normal\n        ctx.fillStyle = c\n        ctx.fillRect(leftPx, toY(score), w, filled ? toHeight(score) : 1)\n        // min\n        if (minr !== undefined) {\n          ctx.fillStyle = Color(c).darken(0.6).toString()\n          ctx.fillRect(leftPx, toY(minr), w, filled ? toHeight(minr) : 1)\n        }\n      } else {\n        ctx.fillStyle = c\n        ctx.fillRect(leftPx, toY(score), w, filled ? toHeight(score) : 1)\n      }\n\n      if (highClipping) {\n        ctx.fillStyle = clipColor\n        ctx.fillRect(leftPx, 0, w, 4)\n      } else if (lowClipping && scaleOpts.scaleType !== 'log') {\n        ctx.fillStyle = clipColor\n        ctx.fillRect(leftPx, height - 4, w, height)\n      }\n      if (feature.get('highlighted')) {\n        ctx.fillStyle = highlightColor\n        ctx.fillRect(leftPx, 0, w, height)\n      }\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport ConfigSchema from '../configSchema'\n\nexport { default as ReactComponent } from '../WiggleRendering'\nexport { default } from './XYPlotRenderer'\n\nexport const configSchema = ConfigurationSchema(\n  'XYPlotRenderer',\n  {},\n  { baseConfiguration: ConfigSchema, explicitlyTyped: true },\n)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { featureSpanPx } from '@jbrowse/core/util'\nimport { getScale } from '../util'\nimport WiggleBaseRenderer from '../WiggleBaseRenderer'\n\nexport default class extends WiggleBaseRenderer {\n  draw(ctx, props) {\n    const { features, regions, bpPerPx, scaleOpts, height, config } = props\n    const [region] = regions\n    const pivotValue = readConfObject(config, 'bicolorPivotValue')\n    const negColor = readConfObject(config, 'negColor')\n    const posColor = readConfObject(config, 'posColor')\n    const clipColor = readConfObject(config, 'clipColor')\n    const highlightColor = readConfObject(config, 'highlightColor')\n    const scale = getScale({ ...scaleOpts, range: [0, height] })\n    const [niceMin, niceMax] = scale.domain()\n    const toY = rawscore => height - scale(rawscore)\n    let colorCallback\n    if (readConfObject(config, 'color') === '#f0f') {\n      colorCallback = feature =>\n        feature.get('score') < pivotValue ? negColor : posColor\n    } else {\n      colorCallback = feature => readConfObject(config, 'color', [feature])\n    }\n    let lastVal\n\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const score = feature.get('score')\n      const lowClipping = score < niceMin\n      const highClipping = score > niceMax\n      const w = rightPx - leftPx + 0.3 // fudge factor for subpixel rendering\n\n      const c = colorCallback(feature)\n\n      ctx.strokeStyle = c\n      ctx.beginPath()\n      if (!region.reversed) {\n        ctx.moveTo(\n          leftPx,\n          toY(typeof lastVal !== 'undefined' ? lastVal : score),\n        )\n        ctx.lineTo(leftPx, toY(score))\n        ctx.lineTo(rightPx, toY(score))\n      } else {\n        ctx.moveTo(\n          rightPx,\n          toY(typeof lastVal !== 'undefined' ? lastVal : score),\n        )\n        ctx.lineTo(rightPx, toY(score))\n        ctx.lineTo(leftPx, toY(score))\n      }\n      ctx.stroke()\n      lastVal = score\n\n      if (highClipping) {\n        ctx.fillStyle = clipColor\n        ctx.fillRect(leftPx, 0, w, 4)\n      } else if (lowClipping && scaleOpts.scaleType !== 'log') {\n        ctx.fillStyle = clipColor\n        ctx.fillRect(leftPx, height - 4, w, height)\n      }\n      if (feature.get('highlighted')) {\n        ctx.fillStyle = highlightColor\n        ctx.fillRect(leftPx, 0, w, height)\n      }\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport ConfigSchema from '../configSchema'\n\nexport { default as ReactComponent } from '../WiggleRendering'\nexport { default } from './LinePlotRenderer'\n\nexport const configSchema = ConfigurationSchema(\n  'LinePlotRenderer',\n  {},\n  { baseConfiguration: ConfigSchema, explicitlyTyped: true },\n)\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport { RenderArgs } from '@jbrowse/core/rpc/coreRpcMethods'\nimport { renameRegionsIfNeeded } from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport {\n  FeatureStats,\n  blankStats,\n  dataAdapterSupportsMultiRegionStats,\n  dataAdapterSupportsGlobalStats,\n} from '../statsUtil'\n\nexport class WiggleGetGlobalStats extends RpcMethodType {\n  name = 'WiggleGetGlobalStats'\n\n  async execute(args: {\n    adapterConfig: {}\n    signal?: RemoteAbortSignal\n    headers?: Record<string, string>\n    sessionId: string\n  }): Promise<FeatureStats> {\n    const deserializedArgs = await this.deserializeArguments(args)\n    const { adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    if (\n      dataAdapter instanceof BaseFeatureDataAdapter &&\n      dataAdapterSupportsGlobalStats(dataAdapter)\n    ) {\n      return dataAdapter.getGlobalStats(deserializedArgs)\n    }\n    return blankStats()\n  }\n}\n\nexport class WiggleGetMultiRegionStats extends RpcMethodType {\n  name = 'WiggleGetMultiRegionStats'\n\n  async serializeArguments(\n    args: RenderArgs & { signal?: AbortSignal; statusCallback?: Function },\n  ) {\n    const assemblyManager = this.pluginManager.rootModel?.session\n      ?.assemblyManager\n    if (!assemblyManager) {\n      return args\n    }\n\n    return renameRegionsIfNeeded(assemblyManager, args)\n  }\n\n  async execute(args: {\n    adapterConfig: {}\n    signal?: RemoteAbortSignal\n    sessionId: string\n    headers?: Record<string, string>\n    regions: Region[]\n    bpPerPx: number\n  }) {\n    const deserializedArgs = await this.deserializeArguments(args)\n    const { regions, adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n\n    if (\n      dataAdapter instanceof BaseFeatureDataAdapter &&\n      dataAdapterSupportsMultiRegionStats(dataAdapter)\n    ) {\n      return dataAdapter.getMultiRegionStats(regions, deserializedArgs)\n    }\n    return blankStats()\n  }\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport {\n  AdapterClass as BigWigAdapterClass,\n  configSchema as bigWigAdapterConfigSchema,\n} from './BigWigAdapter'\nimport DensityRenderer, {\n  configSchema as densityRendererConfigSchema,\n  ReactComponent as DensityRendererReactComponent,\n} from './DensityRenderer'\nimport {\n  configSchemaFactory as linearWiggleDisplayConfigSchemaFactory,\n  modelFactory as linearWiggleDisplayModelFactory,\n  ReactComponent as LinearWiggleDisplayReactComponent,\n} from './LinearWiggleDisplay'\nimport XYPlotRenderer, {\n  configSchema as xyPlotRendererConfigSchema,\n  ReactComponent as XYPlotRendererReactComponent,\n} from './XYPlotRenderer'\nimport LinePlotRenderer, {\n  configSchema as linePlotRendererConfigSchema,\n  ReactComponent as LinePlotRendererReactComponent,\n} from './LinePlotRenderer'\nimport {\n  WiggleGetGlobalStats,\n  WiggleGetMultiRegionStats,\n} from './WiggleRPC/rpcMethods'\n\nexport default class extends Plugin {\n  name = 'WigglePlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'QuantitativeTrack',\n        {},\n        { baseConfiguration: createBaseTrackConfig(pluginManager) },\n      )\n      return new TrackType({\n        name: 'QuantitativeTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'QuantitativeTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearWiggleDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearWiggleDisplay',\n        configSchema,\n        stateModel: linearWiggleDisplayModelFactory(configSchema),\n        trackType: 'QuantitativeTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: LinearWiggleDisplayReactComponent,\n      })\n    })\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BigWigAdapter',\n          configSchema: bigWigAdapterConfigSchema,\n          AdapterClass: BigWigAdapterClass,\n        }),\n    )\n\n    pluginManager.addRendererType(\n      () =>\n        new DensityRenderer({\n          name: 'DensityRenderer',\n          ReactComponent: DensityRendererReactComponent,\n          configSchema: densityRendererConfigSchema,\n        }),\n    )\n\n    pluginManager.addRendererType(\n      () =>\n        new LinePlotRenderer({\n          name: 'LinePlotRenderer',\n          ReactComponent: LinePlotRendererReactComponent,\n          configSchema: linePlotRendererConfigSchema,\n        }),\n    )\n\n    pluginManager.addRendererType(\n      () =>\n        new XYPlotRenderer({\n          name: 'XYPlotRenderer',\n          ReactComponent: XYPlotRendererReactComponent,\n          configSchema: xyPlotRendererConfigSchema,\n        }),\n    )\n\n    pluginManager.addRpcMethod(() => new WiggleGetGlobalStats(pluginManager))\n    pluginManager.addRpcMethod(\n      () => new WiggleGetMultiRegionStats(pluginManager),\n    )\n  }\n}\n\nexport * from './statsUtil'\nexport * from './util'\n\nexport { default as WiggleRendering } from './WiggleRendering'\nexport { default as WiggleBaseRenderer } from './WiggleBaseRenderer'\nexport { LinearWiggleDisplayReactComponent, linearWiggleDisplayModelFactory }\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function WiggleConfigFactory(pluginManager: PluginManager) {\n  const XYPlotRendererConfigSchema = pluginManager.getRendererType(\n    'XYPlotRenderer',\n  ).configSchema\n  const DensityRendererConfigSchema = pluginManager.getRendererType(\n    'DensityRenderer',\n  ).configSchema\n  const LinePlotRendererConfigSchema = pluginManager.getRendererType(\n    'LinePlotRenderer',\n  ).configSchema\n\n  return ConfigurationSchema(\n    'LinearWiggleDisplay',\n    {\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', [\n          'global',\n          'local',\n          'globalsd',\n          'localsd',\n          'zscore',\n        ]),\n        description:\n          'global/local using their min/max values or w/ standard deviations (globalsd/localsd)',\n      },\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the y-scale',\n      },\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      numStdDev: {\n        type: 'number',\n        description:\n          'number of standard deviations to use for autoscale types globalsd or localsd',\n        defaultValue: 3,\n      },\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']), // todo zscale\n        description: 'The type of scale to use',\n        defaultValue: 'linear',\n      },\n      inverted: {\n        type: 'boolean',\n        description: 'draw upside down',\n        defaultValue: false,\n      },\n\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['density', 'xyplot', 'line']),\n        defaultValue: 'xyplot',\n      },\n\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        DensityRenderer: DensityRendererConfigSchema,\n        XYPlotRenderer: XYPlotRendererConfigSchema,\n        LinePlotRenderer: LinePlotRendererConfigSchema,\n      }),\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n","import Paper from '@material-ui/core/Paper'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React, { useState, FunctionComponent } from 'react'\nimport copy from 'copy-to-clipboard'\nimport {\n  BaseFeatureDetails,\n  BaseCard,\n  useStyles,\n} from '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail'\n\ninterface AlnCardProps {\n  title?: string\n}\n\ninterface AlnProps extends AlnCardProps {\n  feature: Record<string, any> // eslint-disable-line @typescript-eslint/no-explicit-any\n}\n\nconst featureFlags = [\n  'unmapped',\n  'qc_failed',\n  'duplicate',\n  'secondary_alignment',\n  'supplementary_alignment',\n]\n\nconst omit = ['length_on_ref', 'clipPos', 'template_length']\n\nconst AlignmentFlags: FunctionComponent<AlnProps> = props => {\n  const classes = useStyles()\n  const { feature } = props\n  const flagNames = [\n    'read paired',\n    'read mapped in proper pair',\n    'read unmapped',\n    'mate unmapped',\n    'read reverse strand',\n    'mate reverse strand',\n    'first in pair',\n    'second in pair',\n    'not primary alignment',\n    'read fails platform/vendor quality checks',\n    'read is PCR or optical duplicate',\n    'supplementary alignment',\n  ]\n  const { flags } = feature\n  return (\n    <BaseCard {...props} title=\"Flags\">\n      <div style={{ display: 'flex' }}>\n        <div className={classes.fieldName}>Flag</div>\n        <div className={classes.fieldValue}>{flags}</div>\n      </div>\n      {flagNames.map((name, index) => {\n        // eslint-disable-next-line no-bitwise\n        const val = flags & (1 << index)\n        const key = `${name}_${val}`\n        return (\n          <div key={key}>\n            <input type=\"checkbox\" checked={Boolean(val)} id={key} readOnly />\n            <label htmlFor={key}>{name}</label>\n          </div>\n        )\n      })}\n    </BaseCard>\n  )\n}\nAlignmentFlags.propTypes = {\n  feature: PropTypes.objectOf(PropTypes.any).isRequired,\n}\n\ninterface AlnInputProps {\n  model: any // eslint-disable-line @typescript-eslint/no-explicit-any\n}\n\nfunction Formatter({ value }: { value: unknown }) {\n  const [show, setShow] = useState(false)\n  const display = String(value)\n  if (display.length > 100) {\n    return (\n      <>\n        <button type=\"button\" onClick={() => copy(display)}>\n          Copy\n        </button>\n        <button type=\"button\" onClick={() => setShow(val => !val)}>\n          {show ? 'Show less' : 'Show more'}\n        </button>\n        <div>{show ? display : `${display.slice(0, 100)}...`}</div>\n      </>\n    )\n  }\n  return <div>{display}</div>\n}\n\nconst AlignmentFeatureDetails: FunctionComponent<AlnInputProps> = props => {\n  const { model } = props\n  const feat = JSON.parse(JSON.stringify(model.featureData))\n  return (\n    <Paper data-testid=\"alignment-side-drawer\">\n      <BaseFeatureDetails\n        {...props}\n        omit={featureFlags.concat(omit)}\n        formatter={(value: unknown) => <Formatter value={value} />}\n      />\n      <AlignmentFlags feature={feat} {...props} />\n    </Paper>\n  )\n}\nAlignmentFeatureDetails.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n\nexport default observer(AlignmentFeatureDetails)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nconst configSchema = ConfigurationSchema('AlignmentsFeatureWidget', {})\n\nconst stateModel = types\n  .model('AlignmentsFeatureWidget', {\n    id: ElementId,\n    type: types.literal('AlignmentsFeatureWidget'),\n    featureData: types.frozen({}),\n  })\n  .actions(self => ({\n    setFeatureData(data) {\n      self.featureData = data\n    },\n    clearFeatureData() {\n      self.featureData = {}\n    },\n  }))\n\nexport { configSchema, stateModel }\nexport { default as ReactComponent } from './AlignmentsFeatureDetail'\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default types.late(() =>\n  ConfigurationSchema(\n    'BamAdapter',\n    {\n      bamLocation: {\n        type: 'fileLocation',\n        defaultValue: { uri: '/path/to/my.bam' },\n      },\n      index: ConfigurationSchema('BamIndex', {\n        indexType: {\n          model: types.enumeration('IndexType', ['BAI', 'CSI']),\n          type: 'stringEnum',\n          defaultValue: 'BAI',\n        },\n        location: {\n          type: 'fileLocation',\n          defaultValue: { uri: '/path/to/my.bam.bai' },\n        },\n      }),\n      chunkSizeLimit: {\n        type: 'number',\n        defaultValue: 100000000,\n      },\n      fetchSizeLimit: {\n        type: 'number',\n        defaultValue: 500000000,\n      },\n      sequenceAdapter: {\n        type: 'frozen',\n        defaultValue: null,\n      },\n    },\n    { explicitlyTyped: true },\n  ),\n)\n","export interface Mismatch {\n  start: number\n  length: number\n  type: string\n  base: string\n  altbase?: string\n  seq?: string\n  cliplen?: number\n}\n\nexport function parseCigar(cigar: string) {\n  return (cigar || '').split(/([MIDNSHPX=])/)\n}\nexport function cigarToMismatches(ops: string[], seq: string): Mismatch[] {\n  let currOffset = 0\n  let seqOffset = 0\n  const mismatches: Mismatch[] = []\n  for (let i = 0; i < ops.length - 1; i += 2) {\n    const len = +ops[i]\n    const op = ops[i + 1]\n    if (op === 'M' || op === '=' || op === 'E') {\n      seqOffset += len\n    }\n    if (op === 'I') {\n      mismatches.push({\n        start: currOffset,\n        type: 'insertion',\n        base: `${len}`,\n        length: 0,\n      })\n      seqOffset += len\n    } else if (op === 'D') {\n      mismatches.push({\n        start: currOffset,\n        type: 'deletion',\n        base: '*',\n        length: len,\n      })\n    } else if (op === 'N') {\n      mismatches.push({\n        start: currOffset,\n        type: 'skip',\n        base: 'N',\n        length: len,\n      })\n    } else if (op === 'X') {\n      const r = seq.slice(seqOffset, seqOffset + len)\n      for (let j = 0; j < len; j++) {\n        mismatches.push({\n          start: currOffset + j,\n          type: 'mismatch',\n          base: r[j],\n          length: 1,\n        })\n      }\n      seqOffset += len\n    } else if (op === 'H') {\n      mismatches.push({\n        start: currOffset,\n        type: 'hardclip',\n        base: `H${len}`,\n        cliplen: len,\n        length: 1,\n      })\n    } else if (op === 'S') {\n      mismatches.push({\n        start: currOffset,\n        type: 'softclip',\n        base: `S${len}`,\n        cliplen: len,\n        length: 1,\n      })\n      seqOffset += len\n    }\n\n    if (op !== 'I' && op !== 'S' && op !== 'H') {\n      currOffset += len\n    }\n  }\n  return mismatches\n}\n\n/**\n * parse a SAM MD tag to find mismatching bases of the template versus the reference\n * @returns array of mismatches and their positions\n */\nexport function mdToMismatches(\n  mdstring: string,\n  cigarOps: string[],\n  cigarMismatches: Mismatch[],\n  seq: string,\n): Mismatch[] {\n  const mismatchRecords: Mismatch[] = []\n  let curr: Mismatch = { start: 0, base: '', length: 0, type: 'mismatch' }\n  const skips = cigarMismatches.filter(cigar => cigar.type === 'skip')\n  let lastCigar = 0\n  let lastTemplateOffset = 0\n  let lastRefOffset = 0\n  let lastSkipPos = 0\n\n  // convert a position on the reference sequence to a position\n  // on the template sequence, taking into account hard and soft\n  // clipping of reads\n\n  function nextRecord(): void {\n    mismatchRecords.push(curr)\n\n    // get a new mismatch record ready\n    curr = {\n      start: curr.start + curr.length,\n      length: 0,\n      base: '',\n      type: 'mismatch',\n    }\n  }\n\n  function getTemplateCoordLocal(refCoord: number): number {\n    let templateOffset = lastTemplateOffset\n    let refOffset = lastRefOffset\n    for (\n      let i = lastCigar;\n      i < cigarOps.length && refOffset <= refCoord;\n      i += 2, lastCigar = i\n    ) {\n      const len = +cigarOps[i]\n      const op = cigarOps[i + 1]\n      if (op === 'S' || op === 'I') {\n        templateOffset += len\n      } else if (op === 'D' || op === 'P' || op === 'N') {\n        refOffset += len\n      } else if (op !== 'H') {\n        templateOffset += len\n        refOffset += len\n      }\n    }\n    lastTemplateOffset = templateOffset\n    lastRefOffset = refOffset\n\n    return templateOffset - (refOffset - refCoord)\n  }\n\n  // now actually parse the MD string\n  const md = mdstring.match(/(\\d+|\\^[a-z]+|[a-z])/gi) || []\n  for (let i = 0; i < md.length; i++) {\n    const token = md[i]\n    if (token.match(/^\\d/)) {\n      curr.start += parseInt(token, 10)\n    } else if (token.match(/^\\^/)) {\n      curr.length = token.length - 1\n      curr.base = '*'\n      curr.type = 'deletion'\n      curr.seq = token.substring(1)\n      nextRecord()\n    } else if (token.match(/^[a-z]/i)) {\n      // mismatch\n      for (let j = 0; j < token.length; j += 1) {\n        curr.length = 1\n\n        while (lastSkipPos < skips.length) {\n          const mismatch = skips[lastSkipPos]\n          if (curr.start >= mismatch.start) {\n            curr.start += mismatch.length\n            lastSkipPos++\n          } else {\n            break\n          }\n        }\n        curr.base = seq\n          ? seq.substr(\n              cigarOps ? getTemplateCoordLocal(curr.start) : curr.start,\n              1,\n            )\n          : 'X'\n        curr.altbase = token\n        nextRecord()\n      }\n    }\n  }\n  return mismatchRecords\n}\n\nexport function getTemplateCoord(refCoord: number, cigarOps: string[]): number {\n  let templateOffset = 0\n  let refOffset = 0\n  for (let i = 0; i < cigarOps.length && refOffset <= refCoord; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op === 'S' || op === 'I') {\n      templateOffset += len\n    } else if (op === 'D' || op === 'P') {\n      refOffset += len\n    } else if (op !== 'H') {\n      templateOffset += len\n      refOffset += len\n    }\n  }\n  return templateOffset - (refOffset - refCoord)\n}\n\nexport function getMismatches(\n  cigarString: string,\n  mdString: string,\n  seq: string,\n): Mismatch[] {\n  let mismatches: Mismatch[] = []\n  let cigarOps: string[] = []\n\n  // parse the CIGAR tag if it has one\n  if (cigarString) {\n    cigarOps = parseCigar(cigarString)\n    mismatches = mismatches.concat(cigarToMismatches(cigarOps, seq))\n  }\n\n  // now let's look for CRAM or MD mismatches\n  if (mdString) {\n    mismatches = mismatches.concat(\n      mdToMismatches(mdString, cigarOps, mismatches, seq),\n    )\n  }\n\n  // uniqify the mismatches\n  const seen: { [index: string]: boolean } = {}\n  return mismatches.filter(m => {\n    const key = `${m.type},${m.start},${m.length}`\n    const s = seen[key]\n    seen[key] = true\n    return !s\n  })\n}\n\n// adapted from minimap2 code static void write_MD_core function\nexport function generateMD(target: string, query: string, cigar: string) {\n  let queryOffset = 0\n  let targetOffset = 0\n  let lengthMD = 0\n  if (!target) {\n    console.warn('no ref supplied to generateMD')\n    return ''\n  }\n  const cigarOps = parseCigar(cigar)\n  let str = ''\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op === 'M' || op === 'X' || op === '=') {\n      for (let j = 0; j < len; j++) {\n        if (\n          query[queryOffset + j].toLowerCase() !==\n          target[targetOffset + j].toLowerCase()\n        ) {\n          str += `${lengthMD}${target[targetOffset + j].toUpperCase()}`\n          lengthMD = 0\n        } else {\n          lengthMD++\n        }\n      }\n      queryOffset += len\n      targetOffset += len\n    } else if (op === 'I') {\n      queryOffset += len\n    } else if (op === 'D') {\n      let tmp = ''\n      for (let j = 0; j < len; j++) {\n        tmp += target[targetOffset + j].toUpperCase()\n      }\n      str += `${lengthMD}^${tmp}`\n      lengthMD = 0\n      targetOffset += len\n    } else if (op === 'N') {\n      targetOffset += len\n    } else if (op === 'S') {\n      queryOffset += len\n    }\n  }\n  if (lengthMD > 0) {\n    str += lengthMD\n  }\n  return str\n}\n","/* eslint-disable @typescript-eslint/camelcase,no-underscore-dangle */\nimport {\n  Feature,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util/simpleFeature'\nimport { BamRecord } from '@gmod/bam'\nimport {\n  parseCigar,\n  generateMD,\n  cigarToMismatches,\n  mdToMismatches,\n  Mismatch,\n} from './MismatchParser'\n\nimport BamAdapter from './BamAdapter'\n\nexport default class BamSlightlyLazyFeature implements Feature {\n  private record: BamRecord\n\n  private adapter: BamAdapter\n\n  private ref?: string\n\n  constructor(record: BamRecord, adapter: BamAdapter, ref?: string) {\n    this.record = record\n    this.adapter = adapter\n    this.ref = ref\n  }\n\n  _get_name() {\n    return this.record.get('name')\n  }\n\n  _get_type(): string {\n    return 'match'\n  }\n\n  _get_score(): number {\n    return this.record.get('mq')\n  }\n\n  _get_flags(): string {\n    // @ts-ignore\n    return this.record.flags\n  }\n\n  _get_strand(): number {\n    return this.record.isReverseComplemented() ? -1 : 1\n  }\n\n  _get_read_group_id(): number {\n    // @ts-ignore\n    return this.record.readGroupId\n  }\n\n  _get_pair_orientation() {\n    return this.record.isPaired() ? this.record.getPairOrientation() : undefined\n  }\n\n  _get_next_seq_id() {\n    return this.record._next_refid()\n  }\n\n  _get_seq_id() {\n    // @ts-ignore\n    return this.record._refID\n  }\n\n  _get_next_refName(): string | undefined {\n    return this.adapter.refIdToName(this.record._next_refid())\n  }\n\n  _get_next_segment_position(): string | undefined {\n    return this.record.isPaired()\n      ? `${this.adapter.refIdToName(this.record._next_refid())}:${\n          this.record._next_pos() + 1\n        }`\n      : undefined\n  }\n\n  _get_tags(): string[] {\n    return this.record._tags()\n  }\n\n  _get_seq(): string {\n    return this.record.getReadBases()\n  }\n\n  _get_MD(): string | undefined {\n    const md = this.record.get('MD')\n    const seq = this.get('seq')\n    if (!md && seq && this.ref) {\n      return generateMD(this.ref, this.record.getReadBases(), this.get('CIGAR'))\n    }\n    return md\n  }\n\n  set(): void {}\n\n  tags() {\n    const properties = Object.getOwnPropertyNames(\n      BamSlightlyLazyFeature.prototype,\n    )\n\n    return [\n      ...new Set(\n        properties\n          .filter(\n            prop =>\n              prop.startsWith('_get_') &&\n              prop !== '_get_mismatches' &&\n              prop !== '_get_skips_and_dels' &&\n              prop !== '_get_cram_read_features' &&\n              prop !== '_get_tags' &&\n              prop !== '_get_next_seq_id' &&\n              prop !== '_get_seq_id',\n          )\n          .map(methodName => methodName.replace('_get_', ''))\n          .concat(this._get_tags()),\n      ),\n    ]\n  }\n\n  id(): string {\n    return `${this.adapter.id}-${this.record.id()}`\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get(field: string): any {\n    const methodName = `_get_${field}`\n    // @ts-ignore\n    if (this[methodName]) {\n      // @ts-ignore\n      return this[methodName]()\n    }\n    return this.record.get(field)\n  }\n\n  _get_refName(): string | undefined {\n    return this.adapter.refIdToName(this.record.seq_id())\n  }\n\n  parent(): undefined {\n    return undefined\n  }\n\n  children(): undefined {\n    return undefined\n  }\n\n  pairedFeature(): boolean {\n    return false\n  }\n\n  toJSON(): SimpleFeatureSerialized {\n    const tags = Object.fromEntries(\n      this.tags()\n        .map(t => {\n          return [t, this.get(t)]\n        })\n        .filter(elt => elt[1] !== undefined),\n    )\n\n    return {\n      ...tags,\n      uniqueId: this.id(),\n    }\n  }\n\n  _get_skips_and_dels(\n    opts: {\n      cigarAttributeName: string\n    } = {\n      cigarAttributeName: 'CIGAR',\n    },\n  ): Mismatch[] {\n    const { cigarAttributeName } = opts\n    let mismatches: Mismatch[] = []\n    let cigarOps: string[] = []\n\n    // parse the CIGAR tag if it has one\n    const cigarString = this.get(cigarAttributeName)\n    if (cigarString) {\n      cigarOps = parseCigar(cigarString)\n      mismatches = mismatches.concat(\n        cigarToMismatches(cigarOps, this.get('seq')),\n      )\n    }\n    return mismatches\n  }\n\n  _get_mismatches({\n    cigarAttributeName = 'CIGAR',\n    mdAttributeName = 'MD',\n  }: {\n    cigarAttributeName?: string\n    mdAttributeName?: string\n  } = {}): Mismatch[] {\n    let mismatches: Mismatch[] = []\n    let cigarOps: string[] = []\n\n    // parse the CIGAR tag if it has one\n    const cigarString = this.get(cigarAttributeName)\n    if (cigarString) {\n      cigarOps = parseCigar(cigarString)\n      mismatches = mismatches.concat(\n        cigarToMismatches(cigarOps, this.get('seq')),\n      )\n    }\n\n    // now let's look for CRAM or MD mismatches\n    const mdString = this.get(mdAttributeName)\n    if (mdString) {\n      mismatches = mismatches.concat(\n        mdToMismatches(mdString, cigarOps, mismatches, this.get('seq')),\n      )\n    }\n\n    // uniqify the mismatches\n    const seen: { [index: string]: boolean } = {}\n    return mismatches.filter(m => {\n      const key = `${m.type},${m.start},${m.length}`\n      const s = seen[key]\n      seen[key] = true\n      return !s\n    })\n  }\n\n  _get_clipPos() {\n    const cigar = this.get('CIGAR') || ''\n    return this.get('strand') === -1\n      ? +(cigar.match(/(\\d+)[SH]$/) || [])[1] || 0\n      : +(cigar.match(/^(\\d+)([SH])/) || [])[1] || 0\n  }\n}\n","import { BamFile } from '@gmod/bam'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region } from '@jbrowse/core/util/types'\nimport { checkAbortSignal } from '@jbrowse/core/util'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { toArray } from 'rxjs/operators'\n\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport BamSlightlyLazyFeature from './BamSlightlyLazyFeature'\n\ninterface HeaderLine {\n  tag: string\n  value: string\n}\ninterface Header {\n  idToName?: string[]\n  nameToId?: Record<string, number>\n}\n\nexport default class BamAdapter extends BaseFeatureDataAdapter {\n  // @ts-ignore  -- the configure method assigns this essentially via the constructor\n  protected bam: BamFile\n\n  protected sequenceAdapter?: BaseFeatureDataAdapter\n\n  private samHeader: Header = {}\n\n  public constructor(\n    config: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n  ) {\n    super(config)\n\n    // note that derived classes may not provide a BAM directly\n    // so this is conditional\n    this.configure(config, getSubAdapter)\n  }\n\n  // derived classes may not use the same configuration so a custom\n  // configure method allows derived classes to override this behavior\n  protected configure(\n    config: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n  ) {\n    const bamLocation = readConfObject(config, 'bamLocation')\n    const location = readConfObject(config, ['index', 'location'])\n    const indexType = readConfObject(config, ['index', 'indexType'])\n    const chunkSizeLimit = readConfObject(config, 'chunkSizeLimit')\n    const fetchSizeLimit = readConfObject(config, 'fetchSizeLimit')\n    this.bam = new BamFile({\n      bamFilehandle: openLocation(bamLocation),\n      csiFilehandle: indexType === 'CSI' ? openLocation(location) : undefined,\n      baiFilehandle: indexType !== 'CSI' ? openLocation(location) : undefined,\n      chunkSizeLimit,\n      fetchSizeLimit,\n    })\n\n    const adapterConfig = readConfObject(config, 'sequenceAdapter')\n    if (adapterConfig && getSubAdapter) {\n      const { dataAdapter } = getSubAdapter(adapterConfig)\n      this.sequenceAdapter = dataAdapter as BaseFeatureDataAdapter\n    }\n  }\n\n  async getHeader(opts?: BaseOptions) {\n    return this.bam.getHeader(opts)\n  }\n\n  private async setup(opts?: BaseOptions) {\n    const { statusCallback = () => {} } = opts || {}\n    if (Object.keys(this.samHeader).length === 0) {\n      statusCallback('Downloading index')\n      const samHeader = await this.bam.getHeader(opts)\n\n      // use the @SQ lines in the header to figure out the\n      // mapping between ref ref ID numbers and names\n      const idToName: string[] = []\n      const nameToId: Record<string, number> = {}\n      const sqLines = samHeader.filter((l: { tag: string }) => l.tag === 'SQ')\n      sqLines.forEach((sqLine: { data: HeaderLine[] }, refId: number) => {\n        sqLine.data.forEach((item: HeaderLine) => {\n          if (item.tag === 'SN') {\n            // this is the ref name\n            const refName = item.value\n            nameToId[refName] = refId\n            idToName[refId] = refName\n          }\n        })\n      })\n      if (idToName.length) {\n        this.samHeader = { idToName, nameToId }\n      }\n      statusCallback('')\n    }\n  }\n\n  async getRefNames(opts?: BaseOptions) {\n    await this.setup(opts)\n    if (this.samHeader.idToName) {\n      return this.samHeader.idToName\n    }\n    throw new Error('unable to get refnames')\n  }\n\n  private async seqFetch(refName: string, start: number, end: number) {\n    const refSeqStore = this.sequenceAdapter\n    if (!refSeqStore) return undefined\n    if (!refName) return undefined\n\n    const features = refSeqStore.getFeatures({\n      refName,\n      start,\n      end,\n      assemblyName: '',\n    })\n\n    const seqChunks = await features.pipe(toArray()).toPromise()\n\n    const trimmed: string[] = []\n    seqChunks\n      .sort((a: Feature, b: Feature) => a.get('start') - b.get('start'))\n      .forEach((chunk: Feature) => {\n        const chunkStart = chunk.get('start')\n        const chunkEnd = chunk.get('end')\n        const trimStart = Math.max(start - chunkStart, 0)\n        const trimEnd = Math.min(end - chunkStart, chunkEnd - chunkStart)\n        const trimLength = trimEnd - trimStart\n        const chunkSeq = chunk.get('seq') || chunk.get('residues')\n        trimmed.push(chunkSeq.substr(trimStart, trimLength))\n      })\n\n    const sequence = trimmed.join('')\n    if (sequence.length !== end - start) {\n      throw new Error(\n        `sequence fetch failed: fetching ${refName}:${(\n          start - 1\n        ).toLocaleString()}-${end.toLocaleString()} returned ${sequence.length.toLocaleString()} bases, but should have returned ${(\n          end - start\n        ).toLocaleString()}`,\n      )\n    }\n    return sequence\n  }\n\n  getFeatures(\n    region: Region & { originalRefName?: string },\n    opts?: BaseOptions,\n  ) {\n    const { refName, start, end, originalRefName } = region\n    const { signal, statusCallback = () => {} } = opts || {}\n    return ObservableCreate<Feature>(async observer => {\n      await this.setup(opts)\n      statusCallback('Downloading alignments')\n      const records = await this.bam.getRecordsForRange(\n        refName,\n        start,\n        end,\n        opts,\n      )\n      checkAbortSignal(signal)\n\n      for (const record of records) {\n        let ref: string | undefined\n        if (!record.get('md')) {\n          // eslint-disable-next-line no-await-in-loop\n          ref = await this.seqFetch(\n            originalRefName || refName,\n            record.get('start'),\n            record.get('end'),\n          )\n        }\n        observer.next(new BamSlightlyLazyFeature(record, this, ref))\n      }\n      statusCallback('')\n      observer.complete()\n    }, signal)\n  }\n\n  freeResources(/* { region } */): void {}\n\n  // depends on setup being called before the BAM constructor\n  refIdToName(refId: number): string | undefined {\n    if (this.samHeader.idToName) {\n      return this.samHeader.idToName[refId]\n    }\n    return undefined\n  }\n}\n","// import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchema from './configSchema'\nimport AdapterClass from './BamAdapter'\n\nexport default (/* pluginManager: PluginManager */) => {\n  return {\n    configSchema,\n    AdapterClass,\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default (pluginManager: PluginManager) => {\n  const { types } = pluginManager.lib['mobx-state-tree']\n  return types.late(() =>\n    ConfigurationSchema(\n      'CramAdapter',\n      {\n        cramLocation: {\n          type: 'fileLocation',\n          defaultValue: { uri: '/path/to/my.cram' },\n        },\n        craiLocation: {\n          type: 'fileLocation',\n          defaultValue: { uri: '/path/to/my.cram.crai' },\n        },\n        sequenceAdapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      },\n      { explicitlyTyped: true },\n    ),\n  )\n}\n","/* eslint-disable @typescript-eslint/camelcase,no-underscore-dangle */\nimport {\n  Feature,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util/simpleFeature'\n\nimport { ClassReturnedBy } from '@jbrowse/core/util'\nimport CramAdapterF from './CramAdapter'\n\ntype CramAdapter = ClassReturnedBy<typeof CramAdapterF>\n\nexport interface Mismatch {\n  start: number\n  length: number\n  type: string\n  base: string\n  altbase?: string\n  seq?: string\n  cliplen?: number\n}\n\nexport default class CramSlightlyLazyFeature implements Feature {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private record: any\n\n  private _store: CramAdapter\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(record: any, store: CramAdapter) {\n    this.record = record\n    this._store = store\n  }\n\n  _get_id() {\n    return this.id()\n  }\n\n  _get_name() {\n    return this.record.readName\n  }\n\n  _get_start() {\n    return this.record.alignmentStart - 1\n  }\n\n  _get_end() {\n    return this.record.alignmentStart + this.record.lengthOnRef - 1\n  }\n\n  _get_cram_read_features() {\n    return this.record.readFeatures\n  }\n\n  _get_type() {\n    return 'match'\n  }\n\n  _get_score() {\n    return this.record.mappingQuality\n  }\n\n  _get_flags() {\n    return this.record.flags\n  }\n\n  _get_strand() {\n    return this.record.isReverseComplemented() ? -1 : 1\n  }\n\n  _get_read_group_id() {\n    return this.record.readGroupId\n  }\n\n  _get_qual() {\n    return (this.record.qualityScores || [])\n      .map((q: number) => q + 33)\n      .join(' ')\n  }\n\n  _get_seq_id() {\n    return this._store.refIdToName(this.record.sequenceId)\n  }\n\n  _get_refName() {\n    return this._get_seq_id()\n  }\n\n  _get_is_paired() {\n    return !!this.record.mate\n  }\n\n  _get_template_length() {\n    return this.record.templateLength || this.record.templateSize\n  }\n\n  _get_next_seq_id() {\n    return this.record.mate\n      ? this._store.refIdToName(this.record.mate.sequenceId)\n      : undefined\n  }\n\n  _get_next_pos() {\n    return this.record.mate ? this.record.mate.alignmentStart : undefined\n  }\n\n  _get_next_segment_position() {\n    return this.record.mate\n      ? `${this._store.refIdToName(this.record.mate.sequenceId)}:${\n          this.record.mate.alignmentStart\n        }`\n      : undefined\n  }\n\n  _get_tags() {\n    return this.record.tags\n  }\n\n  _get_seq() {\n    return this.record.getReadBases()\n  }\n\n  // generate a CIGAR, based on code from jkbonfield\n  _get_CIGAR() {\n    let seq = ''\n    let cigar = ''\n    let op = 'M'\n    let oplen = 0\n\n    // not sure I should access these, but...\n    const ref = this.record._refRegion.seq\n    const refStart = this.record._refRegion.start\n    let last_pos = this.record.alignmentStart\n    let sublen = 0\n    if (typeof this.record.readFeatures !== 'undefined') {\n      // @ts-ignore\n      this.record.readFeatures.forEach(({ code, refPos, sub, data }) => {\n        sublen = refPos - last_pos\n        seq += ref.substring(last_pos - refStart, refPos - refStart)\n        last_pos = refPos\n\n        if (oplen && op !== 'M') {\n          cigar += oplen + op\n          oplen = 0\n        }\n        if (sublen) {\n          op = 'M'\n          oplen += sublen\n        }\n\n        if (code === 'b') {\n          // An array of bases stored verbatim\n          const ret = data.split(',')\n          const added = String.fromCharCode(...ret)\n          seq += added\n          last_pos += added.length\n          oplen += added.length\n        } else if (code === 'B') {\n          // Single base (+ qual score)\n          seq += sub\n          last_pos++\n          oplen++\n        } else if (code === 'X') {\n          // Substitution\n          seq += sub\n          last_pos++\n          oplen++\n        } else if (code === 'D' || code === 'N') {\n          // Deletion or Ref Skip\n          last_pos += data\n          if (oplen) cigar += oplen + op\n          cigar += data + code\n          oplen = 0\n        } else if (code === 'I' || code === 'S') {\n          // Insertion or soft-clip\n          seq += data\n          if (oplen) cigar += oplen + op\n          cigar += data.length + code\n          oplen = 0\n        } else if (code === 'i') {\n          // Single base insertion\n          seq += data\n          if (oplen) cigar += oplen + op\n          cigar += `${1}I`\n          oplen = 0\n        } else if (code === 'P') {\n          // Padding\n          if (oplen) cigar += oplen + op\n          cigar += `${data}P`\n        } else if (code === 'H') {\n          // Hard clip\n          if (oplen) cigar += oplen + op\n          cigar += `${data}H`\n          oplen = 0\n        } // else q or Q\n      })\n    } else {\n      sublen = this.record.readLength - seq.length\n    }\n    if (seq.length !== this.record.readLength) {\n      sublen = this.record.readLength - seq.length\n      seq += ref.substring(last_pos - refStart, last_pos - refStart + sublen)\n\n      if (oplen && op !== 'M') {\n        cigar += oplen + op\n        oplen = 0\n      }\n      op = 'M'\n      oplen += sublen\n    }\n    if (oplen) {\n      cigar += oplen + op\n    }\n    return cigar\n  }\n\n  tags() {\n    const properties = Object.getOwnPropertyNames(\n      CramSlightlyLazyFeature.prototype,\n    )\n    return properties\n      .filter(\n        prop =>\n          prop.startsWith('_get_') &&\n          prop !== '_get_mismatches' &&\n          prop !== '_get_skips_and_dels' &&\n          prop !== '_get_cram_read_features',\n      )\n      .map(methodName => methodName.replace('_get_', ''))\n  }\n\n  id() {\n    return this.record.uniqueId + 1\n  }\n\n  get(field: string) {\n    const methodName = `_get_${field}`\n    // @ts-ignore\n    if (this[methodName]) return this[methodName]()\n    return undefined\n  }\n\n  parent(): undefined | Feature {\n    return undefined\n  }\n\n  children(): undefined | Feature[] {\n    return undefined\n  }\n\n  set(): void {}\n\n  pairedFeature() {\n    return false\n  }\n\n  _get_clipPos() {\n    const mismatches = this.get('mismatches')\n    if (mismatches.length) {\n      const record =\n        this.get('strand') === -1\n          ? mismatches[mismatches.length - 1]\n          : mismatches[0]\n      const { type, cliplen } = record\n      if (type === 'softclip' || type === 'hardclip') {\n        return cliplen\n      }\n    }\n    return 0\n  }\n\n  toJSON(): SimpleFeatureSerialized {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const tags: Record<string, any> = {}\n    this.tags().forEach((t: string) => {\n      tags[t] = this.get(t)\n    })\n\n    return {\n      ...tags,\n      name: this.get('name'),\n      type: this.get('type'),\n      uniqueId: this.id(),\n    }\n  }\n\n  _get_mismatches(): Mismatch[] {\n    const readFeatures = this.get('cram_read_features')\n    if (!readFeatures) return []\n    const start = this.get('start')\n    const mismatches: Mismatch[] = []\n    readFeatures.forEach(\n      ({\n        code,\n        refPos,\n        data,\n        sub,\n        ref,\n      }: {\n        code: string\n        refPos: number\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        data: any\n        sub: string\n        ref: string\n      }) => {\n        refPos = refPos - 1 - start\n        if (code === 'X') {\n          // substitution\n          mismatches.push({\n            start: refPos,\n            length: 1,\n            base: sub,\n            altbase: ref,\n            type: 'mismatch',\n          })\n        } else if (code === 'I') {\n          // insertion\n          mismatches.push({\n            start: refPos,\n            type: 'insertion',\n            base: `${data.length}`,\n            length: 0,\n          })\n        } else if (code === 'N') {\n          // reference skip\n          mismatches.push({\n            type: 'skip',\n            length: data,\n            start: refPos,\n            base: 'N',\n          })\n        } else if (code === 'S') {\n          // soft clip\n          const len = data.length\n          mismatches.push({\n            start: refPos,\n            type: 'softclip',\n            base: `S${len}`,\n            cliplen: len,\n            length: 1,\n          })\n        } else if (code === 'P') {\n          // padding\n        } else if (code === 'H') {\n          // hard clip\n          const len = data\n          mismatches.push({\n            start: refPos,\n            type: 'hardclip',\n            base: `H${len}`,\n            cliplen: len,\n            length: 1,\n          })\n        } else if (code === 'D') {\n          // deletion\n          mismatches.push({\n            type: 'deletion',\n            length: data,\n            start: refPos,\n            base: '*',\n          })\n        } else if (code === 'b') {\n          // stretch of bases\n        } else if (code === 'q') {\n          // stretch of qual scores\n        } else if (code === 'B') {\n          // a pair of [base, qual]\n        } else if (code === 'i') {\n          // single-base insertion\n          // insertion\n          mismatches.push({\n            start: refPos,\n            type: 'insertion',\n            base: data,\n            length: 1,\n          })\n        } else if (code === 'Q') {\n          // single quality value\n        }\n      },\n    )\n    return mismatches\n  }\n\n  _get_skips_and_dels(): Mismatch[] {\n    return this._get_mismatches()\n  }\n}\n","import { CraiIndex, IndexedCramFile } from '@gmod/cram'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region } from '@jbrowse/core/util/types'\nimport { checkAbortSignal } from '@jbrowse/core/util'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { toArray } from 'rxjs/operators'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport CramSlightlyLazyFeature from './CramSlightlyLazyFeature'\n\ninterface HeaderLine {\n  tag: string\n  value: string\n}\n\ninterface Header {\n  idToName?: string[]\n  nameToId?: Record<string, number>\n}\n\nexport class CramAdapter extends BaseFeatureDataAdapter {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private cram: any\n\n  private sequenceAdapter: BaseFeatureDataAdapter\n\n  private samHeader: Header = {}\n\n  // maps a refname to an id\n  private seqIdToRefName: string[] | undefined\n\n  // maps a seqId to original refname, passed specially to render args, to a seqid\n  private seqIdToOriginalRefName: string[] = []\n\n  public constructor(\n    config: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n  ) {\n    super(config)\n\n    const cramLocation = readConfObject(config, 'cramLocation')\n    const craiLocation = readConfObject(config, 'craiLocation')\n    if (!cramLocation) {\n      throw new Error('missing cramLocation argument')\n    }\n    if (!craiLocation) {\n      throw new Error('missing craiLocation argument')\n    }\n    this.cram = new IndexedCramFile({\n      cramFilehandle: openLocation(cramLocation),\n      index: new CraiIndex({ filehandle: openLocation(craiLocation) }),\n      seqFetch: this.seqFetch.bind(this),\n      checkSequenceMD5: false,\n      fetchSizeLimit: config.fetchSizeLimit || 600000000,\n    })\n    // instantiate the sequence adapter\n    const sequenceAdapterType = readConfObject(config, [\n      'sequenceAdapter',\n      'type',\n    ])\n\n    const dataAdapter = getSubAdapter?.(\n      readConfObject(config, 'sequenceAdapter'),\n    ).dataAdapter\n    // TODO: BaseFeatureDataAdapter is different inside of the plugin build, needs to be gotten from pluginManager.lib\n    if (dataAdapter instanceof BaseFeatureDataAdapter) {\n      this.sequenceAdapter = dataAdapter\n    } else {\n      throw new Error(\n        `CRAM feature adapters cannot use sequence adapters of type '${sequenceAdapterType}'`,\n      )\n    }\n  }\n\n  async getHeader(opts?: BaseOptions) {\n    return this.cram.cram.getSamHeader(opts)\n  }\n\n  private async seqFetch(seqId: number, start: number, end: number) {\n    start -= 1 // convert from 1-based closed to interbase\n\n    const refSeqStore = this.sequenceAdapter\n    if (!refSeqStore) return undefined\n    const refName = this.refIdToOriginalName(seqId) || this.refIdToName(seqId)\n    // console.log(`CRAM seq ID ${seqId} -> ${refName}`)\n    if (!refName) return undefined\n\n    const features = refSeqStore.getFeatures(\n      {\n        refName,\n        start,\n        end,\n        assemblyName: '',\n      },\n      {},\n    )\n\n    const seqChunks = await features.pipe(toArray()).toPromise()\n\n    const trimmed: string[] = []\n    seqChunks\n      .sort((a: Feature, b: Feature) => a.get('start') - b.get('start'))\n      .forEach((chunk: Feature) => {\n        const chunkStart = chunk.get('start')\n        const chunkEnd = chunk.get('end')\n        const trimStart = Math.max(start - chunkStart, 0)\n        const trimEnd = Math.min(end - chunkStart, chunkEnd - chunkStart)\n        const trimLength = trimEnd - trimStart\n        const chunkSeq = chunk.get('seq') || chunk.get('residues')\n        trimmed.push(chunkSeq.substr(trimStart, trimLength))\n      })\n\n    const sequence = trimmed.join('')\n    if (sequence.length !== end - start) {\n      throw new Error(\n        `sequence fetch failed: fetching ${refName}:${(\n          start - 1\n        ).toLocaleString()}-${end.toLocaleString()} returned ${sequence.length.toLocaleString()} bases, but should have returned ${(\n          end - start\n        ).toLocaleString()}`,\n      )\n    }\n    return sequence\n  }\n\n  private async setup(opts?: BaseOptions) {\n    const { statusCallback = () => {} } = opts || {}\n    if (Object.keys(this.samHeader).length === 0) {\n      statusCallback('Downloading index')\n      const samHeader = await this.cram.cram.getSamHeader(opts?.signal)\n\n      // use the @SQ lines in the header to figure out the\n      // mapping between ref ref ID numbers and names\n      const idToName: string[] = []\n      const nameToId: Record<string, number> = {}\n      const sqLines = samHeader.filter((l: { tag: string }) => l.tag === 'SQ')\n      sqLines.forEach((sqLine: { data: HeaderLine[] }, refId: number) => {\n        sqLine.data.forEach((item: HeaderLine) => {\n          if (item.tag === 'SN') {\n            // this is the ref name\n            const refName = item.value\n            nameToId[refName] = refId\n            idToName[refId] = refName\n          }\n        })\n      })\n      if (idToName.length) {\n        this.samHeader = { idToName, nameToId }\n      }\n      statusCallback('')\n    }\n  }\n\n  async getRefNames(opts?: BaseOptions) {\n    await this.setup(opts)\n    if (this.samHeader.idToName) {\n      return this.samHeader.idToName\n    }\n    if (this.sequenceAdapter) {\n      return this.sequenceAdapter.getRefNames()\n    }\n    throw new Error('unable to get refnames')\n  }\n\n  // use info from the SAM header if possible, but fall back to using\n  // the ref seq order from when the browser's refseqs were loaded\n  refNameToId(refName: string) {\n    if (this.samHeader.nameToId) {\n      return this.samHeader.nameToId[refName]\n    }\n    if (this.seqIdToRefName) {\n      return this.seqIdToRefName.indexOf(refName)\n    }\n    return undefined\n  }\n\n  // use info from the SAM header if possible, but fall back to using\n  // the ref seq order from when the browser's refseqs were loaded\n  refIdToName(refId: number) {\n    if (this.samHeader.idToName) {\n      return this.samHeader.idToName[refId]\n    }\n    if (this.seqIdToRefName) {\n      return this.seqIdToRefName[refId]\n    }\n    return undefined\n  }\n\n  refIdToOriginalName(refId: number) {\n    return this.seqIdToOriginalRefName[refId]\n  }\n\n  getFeatures(\n    region: Region & { originalRefName?: string },\n    opts?: BaseOptions,\n  ) {\n    const { signal, statusCallback = () => {} } = opts || {}\n    const { refName, start, end, originalRefName } = region\n\n    return ObservableCreate<Feature>(async observer => {\n      await this.setup(opts)\n      if (this.sequenceAdapter && !this.seqIdToRefName) {\n        this.seqIdToRefName = await this.sequenceAdapter.getRefNames(opts)\n      }\n      const refId = this.refNameToId(refName)\n      if (refId !== undefined) {\n        if (originalRefName) {\n          this.seqIdToOriginalRefName[refId] = originalRefName\n        }\n        statusCallback('Downloading alignments')\n        const records = await this.cram.getRecordsForRange(\n          refId,\n          start,\n          end,\n          opts,\n        )\n        checkAbortSignal(signal)\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        records.forEach((record: any) => {\n          observer.next(this.cramRecordToFeature(record))\n        })\n      }\n      statusCallback('')\n      observer.complete()\n    }, signal)\n  }\n\n  freeResources(/* { region } */): void {}\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  cramRecordToFeature(record: any): Feature {\n    return new CramSlightlyLazyFeature(record, this)\n  }\n}\n\nexport default () => {\n  return CramAdapter\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaF from './configSchema'\nimport AdapterF from './CramAdapter'\n\nexport default (pluginManager: PluginManager) => {\n  return {\n    configSchema: pluginManager.load(configSchemaF),\n    AdapterClass: pluginManager.load(AdapterF),\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default types.late(() =>\n  ConfigurationSchema(\n    'HtsgetBamAdapter',\n    {\n      htsgetBase: {\n        type: 'string',\n        defaultValue: '',\n      },\n      htsgetTrackId: {\n        type: 'string',\n        defaultValue: '',\n      },\n      sequenceAdapter: {\n        type: 'frozen',\n        defaultValue: null,\n      },\n    },\n    { explicitlyTyped: true },\n  ),\n)\n","import { HtsgetFile } from '@gmod/bam'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport BamAdapter from '../BamAdapter/BamAdapter'\n\nexport default class HtsgetBamAdapter extends BamAdapter {\n  configure(config: AnyConfigurationModel, getSubAdapter?: getSubAdapterType) {\n    const htsgetBase = readConfObject(config, 'htsgetBase')\n    const htsgetTrackId = readConfObject(config, 'htsgetTrackId')\n    this.bam = new HtsgetFile({\n      baseUrl: htsgetBase,\n      trackId: htsgetTrackId,\n    })\n\n    const adapterConfig = readConfObject(config, 'sequenceAdapter')\n    if (adapterConfig && getSubAdapter) {\n      const { dataAdapter } = getSubAdapter(adapterConfig)\n      this.sequenceAdapter = dataAdapter as BaseFeatureDataAdapter\n    }\n  }\n}\n","// import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchema from './configSchema'\nimport AdapterClass from './HtsgetBamAdapter'\n\nexport default (/* pluginManager: PluginManager */) => {\n  return {\n    configSchema,\n    AdapterClass,\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nconst configModelFactory = (pluginManager: PluginManager) => {\n  const PileupRendererConfigSchema = pluginManager.getRendererType(\n    'PileupRenderer',\n  ).configSchema\n  const SvgFeatureRendererConfigSchema = pluginManager.getRendererType(\n    'SvgFeatureRenderer',\n  ).configSchema\n  const SNPCoverageRendererConfigSchema = pluginManager.getRendererType(\n    'SNPCoverageRenderer',\n  ).configSchema\n\n  return ConfigurationSchema(\n    'LinearAlignmentsDisplay',\n    {\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', ['local']),\n        description: 'performs SNP Coverage local autoscaling',\n      },\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the SNP coverage y-scale',\n      },\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the SNP coverage y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']),\n        description: 'The type of scale to use for SNP coverage',\n        defaultValue: 'linear',\n      },\n      headroom: {\n        type: 'number',\n        description:\n          'round the upper value of the SNP coverage domain scale to the nearest N',\n        defaultValue: 20,\n      },\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['pileup', 'svg']),\n        defaultValue: 'pileup',\n      },\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        PileupRenderer: PileupRendererConfigSchema,\n        SvgFeatureRenderer: SvgFeatureRendererConfigSchema,\n        SNPCoverageRenderer: SNPCoverageRendererConfigSchema,\n      }),\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n\nexport type AlignmentsConfigModel = ReturnType<typeof configModelFactory>\nexport default configModelFactory\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport deepEqual from 'deep-equal'\nimport { autorun } from 'mobx'\nimport {\n  addDisposer,\n  getParent,\n  getSnapshot,\n  Instance,\n  types,\n} from 'mobx-state-tree'\nimport { AlignmentsConfigModel } from './configSchema'\n\nconst minDisplayHeight = 20\nconst stateModelFactory = (\n  pluginManager: PluginManager,\n  configSchema: AlignmentsConfigModel,\n) => {\n  return types\n    .compose(\n      'LinearAlignmentsDisplay',\n      BaseDisplay,\n      types.model({\n        PileupDisplay: types.maybe(\n          pluginManager.getDisplayType('LinearPileupDisplay').stateModel,\n        ),\n        SNPCoverageDisplay: types.maybe(\n          pluginManager.getDisplayType('LinearSNPCoverageDisplay').stateModel,\n        ),\n        type: types.literal('LinearAlignmentsDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        height: 250,\n        showCoverage: true,\n        showPileup: true,\n      }),\n    )\n    .volatile(() => ({\n      scrollTop: 0,\n    }))\n    .actions(self => ({\n      toggleCoverage() {\n        self.showCoverage = !self.showCoverage\n      },\n      togglePileup() {\n        self.showPileup = !self.showPileup\n      },\n      setScrollTop(scrollTop: number) {\n        self.scrollTop = scrollTop\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems } = self\n      return {\n        get pileupDisplayConfig() {\n          const conf = getConf(self)\n          const { SNPCoverageRenderer, ...rest } = conf.renderers\n          return {\n            ...conf,\n            renderers: {\n              ...rest,\n            },\n            type: 'LinearPileupDisplay',\n            name: `${getConf(getParent(self, 2), 'name')} pileup`,\n            displayId: `${self.configuration.displayId}_pileup_xyz`, // xyz to avoid someone accidentally naming the displayId similar to this\n          }\n        },\n\n        get layoutFeatures() {\n          return self.PileupDisplay.layoutFeatures\n        },\n\n        get features() {\n          return self.PileupDisplay.features\n        },\n\n        get DisplayBlurb() {\n          return self.PileupDisplay?.DisplayBlurb\n        },\n\n        get sortedBy() {\n          return self.PileupDisplay.sortedBy\n        },\n        get sortedByPosition() {\n          return self.PileupDisplay.sortedByPosition\n        },\n        get sortedByRefName() {\n          return self.PileupDisplay.sortedByRefName\n        },\n\n        get snpCoverageDisplayConfig() {\n          const conf = getConf(self)\n          const { SNPCoverageRenderer } = conf.renderers\n          return {\n            ...conf,\n            renderers: {\n              SNPCoverageRenderer,\n            },\n            type: 'LinearSNPCoverageDisplay',\n            name: `${getConf(getParent(self, 2), 'name')} pileup`,\n            displayId: `${self.configuration.displayId}_snpcoverage_xyz`, // xyz to avoid someone accidentally naming the displayId similar to this\n          }\n        },\n\n        get trackMenuItems(): MenuItem[] {\n          return [\n            ...trackMenuItems,\n            ...self.PileupDisplay.composedTrackMenuItems,\n            ...self.SNPCoverageDisplay.composedTrackMenuItems,\n          ]\n        },\n      }\n    })\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            if (!self.SNPCoverageDisplay) {\n              // @ts-ignore\n              self.setSNPCoverageDisplay(self.snpCoverageDisplayConfig)\n            } else if (\n              !deepEqual(\n                self.snpCoverageDisplayConfig,\n                getSnapshot(self.SNPCoverageDisplay.configuration),\n              )\n            ) {\n              self.SNPCoverageDisplay.setConfig(self.snpCoverageDisplayConfig)\n            }\n\n            if (!self.PileupDisplay) {\n              // @ts-ignore\n              self.setPileupDisplay(self.pileupDisplayConfig)\n            } else if (\n              !deepEqual(\n                self.pileupDisplayConfig,\n                getSnapshot(self.PileupDisplay.configuration),\n              )\n            ) {\n              self.PileupDisplay.setConfig(self.pileupDisplayConfig)\n            }\n          }),\n        )\n      },\n      setSNPCoverageDisplay(displayConfig: AnyConfigurationModel) {\n        self.SNPCoverageDisplay = {\n          type: 'LinearSNPCoverageDisplay',\n          configuration: displayConfig,\n          height: 40,\n        }\n      },\n      setPileupDisplay(displayConfig: AnyConfigurationModel) {\n        self.PileupDisplay = {\n          type: 'LinearPileupDisplay',\n          configuration: displayConfig,\n        }\n      },\n      setHeight(displayHeight: number) {\n        if (displayHeight > minDisplayHeight) self.height = displayHeight\n        else self.height = minDisplayHeight\n        return self.height\n      },\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = this.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type AlignmentsDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type AlignmentsDisplayModel = Instance<AlignmentsDisplayStateModel>\n","import { observer } from 'mobx-react'\nimport { getConf } from '@jbrowse/core/configuration'\nimport React, { useEffect } from 'react'\nimport { ResizeHandle } from '@jbrowse/core/ui'\nimport { AlignmentsDisplayModel } from '../models/model'\n\nfunction AlignmentsDisplayComponent({\n  model,\n}: {\n  model: AlignmentsDisplayModel\n}) {\n  const { PileupDisplay, SNPCoverageDisplay, showPileup, showCoverage } = model\n\n  // determine height of the model when toggling pileupdisplay\n  useEffect(() => {\n    SNPCoverageDisplay.setHeight(!showPileup ? model.height : 40)\n  }, [SNPCoverageDisplay, model, showPileup])\n\n  return (\n    <div\n      data-testid={`display-${getConf(model, 'displayId')}`}\n      style={{ position: 'relative' }}\n    >\n      <div data-testid=\"Blockset-snpcoverage\">\n        {showCoverage ? (\n          <SNPCoverageDisplay.RenderingComponent model={SNPCoverageDisplay} />\n        ) : null}\n      </div>\n      <ResizeHandle\n        onDrag={delta => {\n          if (SNPCoverageDisplay) {\n            SNPCoverageDisplay.setHeight(SNPCoverageDisplay.height + delta)\n            return delta\n          }\n          return 0\n        }}\n        style={{\n          position: 'absolute',\n          top: showCoverage ? SNPCoverageDisplay.height + 2 : 0,\n          height: 3,\n        }}\n      />\n\n      <div\n        data-testid=\"Blockset-pileup\"\n        style={{\n          position: 'absolute',\n          top: showCoverage ? SNPCoverageDisplay.height + 5 : 0,\n          height: 3,\n        }}\n      >\n        {showPileup ? (\n          <PileupDisplay.RenderingComponent model={PileupDisplay} />\n        ) : null}\n      </div>\n    </div>\n  )\n}\n\nexport default observer(AlignmentsDisplayComponent)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nfunction PileupConfigFactory(pluginManager: PluginManager) {\n  const PileupRendererConfigSchema = pluginManager.getRendererType(\n    'PileupRenderer',\n  ).configSchema\n  const SvgFeatureRendererConfigSchema = pluginManager.getRendererType(\n    'SvgFeatureRenderer',\n  ).configSchema\n\n  // modify config schema to take in a sub coverage display\n  return ConfigurationSchema(\n    'LinearPileupDisplay',\n    {\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['pileup', 'svg']),\n        defaultValue: 'pileup',\n      },\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        PileupRenderer: PileupRendererConfigSchema,\n        SvgFeatureRenderer: SvgFeatureRendererConfigSchema,\n      }),\n      maxDisplayedBpPerPx: {\n        type: 'number',\n        description: 'maximum bpPerPx that is displayed in the view',\n        defaultValue: 100,\n      },\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n\nexport type LinearPileupDisplayConfigModel = ReturnType<\n  typeof PileupConfigFactory\n>\nexport type LinearPileupDisplayConfig = Instance<LinearPileupDisplayConfigModel>\nexport default PileupConfigFactory\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport Typography from '@material-ui/core/Typography'\n\nexport interface LinearPileupDisplayBlurbProps {\n  model: {\n    sortedBy?: {\n      pos: number\n      refName: number\n      type: string\n    }\n  }\n}\n\nfunction LinearPileupDisplayBlurb(props: LinearPileupDisplayBlurbProps) {\n  const { model } = props\n  const { sortedBy } = model\n  return sortedBy ? (\n    <div\n      data-testid={`blurb-${model.sortedBy}`}\n      style={{ backgroundColor: 'white' }}\n    >\n      <Typography color=\"secondary\" variant=\"caption\">\n        {model.sortedBy\n          ? `Sorted by ${sortedBy.type.toLowerCase()} at ${sortedBy.refName}:${\n              sortedBy.pos\n            }`\n          : null}\n      </Typography>\n    </div>\n  ) : null\n}\nexport default observer(LinearPileupDisplayBlurb)\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n} from '@jbrowse/core/util/tracks'\nimport {\n  getSession,\n  isSessionModelWithWidgets,\n  getContainingView,\n} from '@jbrowse/core/util'\n\nimport VisibilityIcon from '@material-ui/icons/Visibility'\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\nimport {\n  LinearGenomeViewModel,\n  BaseLinearDisplay,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { types, addDisposer, Instance } from 'mobx-state-tree'\nimport copy from 'copy-to-clipboard'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport MenuOpenIcon from '@material-ui/icons/MenuOpen'\nimport SortIcon from '@material-ui/icons/Sort'\nimport { autorun } from 'mobx'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { LinearPileupDisplayConfigModel } from './configSchema'\nimport LinearPileupDisplayBlurb from './components/LinearPileupDisplayBlurb'\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['pileup', 'PileupRenderer'],\n  ['svg', 'SvgFeatureRenderer'],\n])\n\ntype LGV = LinearGenomeViewModel\n\nconst stateModelFactory = (\n  pluginManager: PluginManager,\n  configSchema: LinearPileupDisplayConfigModel,\n) =>\n  types\n    .compose(\n      'LinearPileupDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearPileupDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        showSoftClipping: false,\n        sortedBy: types.maybe(\n          types.model({\n            type: types.string,\n            pos: types.number,\n            refName: types.string,\n            assemblyName: types.string,\n          }),\n        ),\n      }),\n    )\n    .volatile(() => ({\n      ready: false,\n      currBpPerPx: 0,\n    }))\n\n    .actions(self => ({\n      setReady(flag: boolean) {\n        self.ready = flag\n      },\n      setCurrBpPerPx(n: number) {\n        self.currBpPerPx = n\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            async () => {\n              try {\n                const { rpcManager } = getSession(self)\n                const { sortedBy, renderProps } = self\n                const view = getContainingView(self) as LGV\n                if (sortedBy) {\n                  const { pos, refName, assemblyName } = sortedBy\n                  const region = {\n                    start: pos,\n                    end: pos + 1,\n                    refName,\n                    assemblyName,\n                  }\n\n                  // render just the sorted region first\n                  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                  await (self.rendererType as any).renderInClient(rpcManager, {\n                    assemblyName,\n                    regions: [region],\n                    adapterConfig: self.adapterConfig,\n                    rendererType: self.rendererType.name,\n                    renderProps,\n                    sessionId: getRpcSessionId(self),\n                    timeout: 1000000,\n                  })\n                  self.setReady(true)\n                  self.setCurrBpPerPx(view.bpPerPx)\n                } else {\n                  self.setReady(true)\n                }\n              } catch (error) {\n                self.setError(error.message)\n              }\n            },\n            { delay: 1000 },\n          ),\n        )\n      },\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const featureWidget = session.addWidget(\n            'AlignmentsFeatureWidget',\n            'alignmentFeature',\n            { featureData: feature.toJSON() },\n          )\n          session.showWidget(featureWidget)\n        }\n        session.setSelection(feature)\n      },\n\n      clearSelected() {\n        self.sortedBy = undefined\n      },\n\n      // uses copy-to-clipboard and generates notification\n      copyFeatureToClipboard(feature: Feature) {\n        const copiedFeature = feature.toJSON()\n        delete copiedFeature.uniqueId\n        const session = getSession(self)\n        copy(JSON.stringify(copiedFeature, null, 4))\n        session.notify('Copied to clipboard', 'success')\n      },\n\n      toggleSoftClipping() {\n        self.showSoftClipping = !self.showSoftClipping\n      },\n\n      setConfig(configuration: AnyConfigurationModel) {\n        self.configuration = configuration\n      },\n\n      sortSelected(type: string) {\n        const { centerLineInfo } = getContainingView(self) as LGV\n        if (!centerLineInfo) {\n          return\n        }\n        const { refName, assemblyName, offset } = centerLineInfo\n        const centerBp = Math.round(offset) + 1\n        const centerRefName = refName\n\n        if (centerBp < 0) {\n          return\n        }\n\n        this.setSortedBy({\n          type,\n          pos: centerBp,\n          refName: centerRefName,\n          assemblyName,\n        })\n      },\n      setSortedBy(sort: {\n        type: string\n        pos: number\n        refName: string\n        assemblyName: string\n      }) {\n        self.sortedBy = sort\n        self.ready = false\n      },\n    }))\n    .actions(self => {\n      // reset the sort object and refresh whole display on reload\n      const superReload = self.reload\n      return {\n        reload() {\n          self.clearSelected()\n          superReload()\n        },\n      }\n    })\n    .views(self => {\n      const { trackMenuItems } = self\n      return {\n        get rendererTypeName() {\n          const viewName = getConf(self, 'defaultRendering')\n          const rendererType = rendererTypes.get(viewName)\n          if (!rendererType) {\n            throw new Error(`unknown alignments view name ${viewName}`)\n          }\n          return rendererType\n        },\n\n        get contextMenuItems() {\n          const feat = self.contextMenuFeature\n          const contextMenuItems = feat\n            ? [\n                {\n                  label: 'Open feature details',\n                  icon: MenuOpenIcon,\n                  onClick: () => {\n                    self.clearFeatureSelection()\n                    if (feat) {\n                      self.selectFeature(feat)\n                    }\n                  },\n                },\n                {\n                  label: 'Copy info to clipboard',\n                  icon: ContentCopyIcon,\n                  onClick: () => {\n                    if (feat) {\n                      self.copyFeatureToClipboard(feat)\n                    }\n                  },\n                },\n              ]\n            : []\n          self.additionalContextMenuItemCallbacks.forEach(\n            (callback: Function) => {\n              const menuItems = callback(feat, self, pluginManager)\n              contextMenuItems.push(...menuItems)\n            },\n          )\n          return contextMenuItems\n        },\n\n        get sortOptions() {\n          return ['Start location', 'Read strand', 'Base pair', 'Clear sort']\n        },\n\n        get DisplayBlurb() {\n          return LinearPileupDisplayBlurb\n        },\n\n        get renderProps() {\n          const view = getContainingView(self) as LGV\n          const config = self.rendererType.configSchema.create(\n            getConf(self, ['renderers', self.rendererTypeName]) || {},\n          )\n          return {\n            ...self.composedRenderProps,\n            ...getParentRenderProps(self),\n            notReady:\n              !self.ready ||\n              (self.sortedBy && self.currBpPerPx !== view.bpPerPx),\n            displayModel: self,\n            sortedBy: self.sortedBy,\n            showSoftClip: self.showSoftClipping,\n            config,\n          }\n        },\n\n        get composedTrackMenuItems() {\n          return [\n            {\n              label: 'Show soft clipping',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showSoftClipping,\n              onClick: () => {\n                self.toggleSoftClipping()\n                // if toggling from off to on, will break sort for this track\n                // so clear it\n                if (self.showSoftClipping) {\n                  self.clearSelected()\n                }\n              },\n            },\n            {\n              label: 'Sort by',\n              icon: SortIcon,\n              disabled: self.showSoftClipping,\n              subMenu: this.sortOptions.map((option: string) => {\n                return {\n                  label: option,\n                  onClick() {\n                    option === 'Clear sort'\n                      ? self.clearSelected()\n                      : self.sortSelected(option)\n                  },\n                }\n              }),\n            },\n          ]\n        },\n\n        get trackMenuItems() {\n          return [...trackMenuItems, ...this.composedTrackMenuItems]\n        },\n      }\n    })\n\nexport type LinearPileupDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearPileupDisplayModel = Instance<LinearPileupDisplayStateModel>\n\nexport default stateModelFactory\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport MUITooltip from '@material-ui/core/Tooltip'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\n\nconst useStyles = makeStyles(theme => ({\n  popper: {\n    fontSize: '0.8em',\n    zIndex: theme.zIndex.tooltip, // important to have a zIndex directly on the popper itself, material-ui Tooltip uses popper and has similar thing\n    pointerEvents: 'none', // needed to avoid rapid mouseLeave/mouseEnter on popper\n  },\n\n  hoverVertical: {\n    background: '#333',\n    border: 'none',\n    width: 1,\n    height: '100%',\n    top: 0,\n    cursor: 'default',\n    position: 'absolute',\n    pointerEvents: 'none',\n  },\n}))\n\nfunction TooltipContents({ feature }: { feature: Feature }) {\n  const info = feature.get('snpinfo')\n  const total = info\n    ? info[info.map((e: any) => e.base).indexOf('total')].score\n    : 0\n  const condId = info && info.length >= 5 ? 'smallInfo' : 'info' // readjust table size to fit all\n  return (\n    <table>\n      <thead>\n        <tr>\n          <th id={condId}>Base</th>\n          <th id={condId}>Count</th>\n          <th id={condId}>% of Total</th>\n          <th id={condId}>Strands</th>\n        </tr>\n      </thead>\n      <tbody>\n        {(info || []).map((mismatch: any) => {\n          const { base, score, strands } = mismatch\n          return (\n            <tr key={base}>\n              <td id={condId}>{base.toUpperCase()}</td>\n              <td id={condId}>{score}</td>\n              <td id={condId}>\n                {base === 'total'\n                  ? '---'\n                  : `${Math.floor((score / total) * 100)}%`}\n              </td>\n              <td id={condId}>\n                {base === 'total'\n                  ? '---'\n                  : (strands['+']\n                      ? `+:${strands['+']} ${strands['-'] ? `,\\t` : `\\t`} `\n                      : ``) + (strands['-'] ? `-:${strands['-']}` : ``)}\n              </td>\n            </tr>\n          )\n        })}\n      </tbody>\n    </table>\n  )\n}\n\ntype Coord = [number, number]\nconst Tooltip = observer(\n  ({\n    model,\n    height,\n    mouseCoord,\n  }: {\n    model: any\n    height: number\n    mouseCoord: Coord\n  }) => {\n    const { featureUnderMouse } = model\n    const classes = useStyles()\n\n    return featureUnderMouse ? (\n      <>\n        <MUITooltip\n          placement=\"right-start\"\n          className={classes.popper}\n          open\n          title={<TooltipContents feature={featureUnderMouse} />}\n        >\n          <div\n            style={{\n              position: 'absolute',\n              left: mouseCoord[0],\n              top: 0,\n            }}\n          >\n            {' '}\n          </div>\n        </MUITooltip>\n        <div\n          className={classes.hoverVertical}\n          style={{ left: mouseCoord[0], height }}\n        />\n      </>\n    ) : null\n  },\n)\n\nexport default Tooltip\n","import { types } from 'mobx-state-tree'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { linearWiggleDisplayModelFactory } from '@jbrowse/plugin-wiggle'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport Tooltip from '../components/Tooltip'\n\n// using a map because it preserves order\nconst rendererTypes = new Map([['snpcoverage', 'SNPCoverageRenderer']])\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst stateModelFactory = (configSchema: any) =>\n  types\n    .compose(\n      'LinearSNPCoverageDisplay',\n      linearWiggleDisplayModelFactory(configSchema),\n      types.model({ type: types.literal('LinearSNPCoverageDisplay') }),\n    )\n    .actions(self => ({\n      setConfig(configuration: AnyConfigurationModel) {\n        self.configuration = configuration\n      },\n    }))\n    .views(self => ({\n      get TooltipComponent() {\n        return Tooltip\n      },\n\n      get adapterConfig() {\n        const subadapter = getConf(self.parentTrack, 'adapter')\n        return {\n          type: 'SNPCoverageAdapter',\n          subadapter,\n        }\n      },\n\n      get rendererTypeName() {\n        return rendererTypes.get('snpcoverage')\n      },\n\n      get needsScalebar() {\n        return true\n      },\n\n      get contextMenuItems() {\n        return []\n      },\n    }))\n\nexport type SNPCoverageDisplayModel = ReturnType<typeof stateModelFactory>\n\nexport default stateModelFactory\n","import { Region } from '@jbrowse/core/util/types'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { bpSpanPx } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport React, { MouseEvent, useRef, useState, useEffect } from 'react'\nimport type { BaseLinearDisplayModel } from '@jbrowse/plugin-linear-genome-view'\n\nfunction PileupRendering(props: {\n  blockKey: string\n  displayModel: BaseLinearDisplayModel\n  width: number\n  height: number\n  regions: Region[]\n  bpPerPx: number\n  sortedBy?: { type: string; pos: number; refName: string }\n  onMouseMove?: (event: React.MouseEvent, featureId: string | undefined) => void\n}) {\n  const {\n    onMouseMove,\n    blockKey,\n    displayModel,\n    width,\n    height,\n    regions,\n    bpPerPx,\n    sortedBy,\n  } = props\n  const {\n    selectedFeatureId,\n    featureIdUnderMouse,\n    contextMenuFeature,\n    blockLayoutFeatures,\n  } = displayModel || {}\n  const [region] = regions\n  const highlightOverlayCanvas = useRef<HTMLCanvasElement>(null)\n  const [mouseIsDown, setMouseIsDown] = useState(false)\n  const [movedDuringLastMouseDown, setMovedDuringLastMouseDown] = useState(\n    false,\n  )\n  useEffect(() => {\n    const canvas = highlightOverlayCanvas.current\n    if (!canvas) return\n    const ctx = canvas.getContext('2d')\n    if (!ctx) return\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    let rect\n    let blockLayout\n\n    if (\n      selectedFeatureId &&\n      (blockLayout = blockLayoutFeatures.get(blockKey)) &&\n      (rect = blockLayout.get(selectedFeatureId))\n    ) {\n      const [leftBp, topPx, rightBp, bottomPx] = rect\n      const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n      const rectTop = Math.round(topPx)\n      const rectHeight = Math.round(bottomPx - topPx)\n      ctx.shadowColor = '#222266'\n      ctx.shadowBlur = 10\n      ctx.lineJoin = 'bevel'\n      ctx.lineWidth = 2\n      ctx.strokeStyle = '#00b8ff'\n      ctx.strokeRect(\n        leftPx - 2,\n        rectTop - 2,\n        rightPx - leftPx + 4,\n        rectHeight + 4,\n      )\n      ctx.clearRect(leftPx, rectTop, rightPx - leftPx, rectHeight)\n    }\n    const highlightedFeature = featureIdUnderMouse || contextMenuFeature?.id()\n    if (\n      highlightedFeature &&\n      (blockLayout = blockLayoutFeatures.get(blockKey)) &&\n      (rect = blockLayout.get(highlightedFeature))\n    ) {\n      const [leftBp, topPx, rightBp, bottomPx] = rect\n      const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n      const rectTop = Math.round(topPx)\n      const rectHeight = Math.round(bottomPx - topPx)\n      ctx.fillStyle = '#0003'\n      ctx.fillRect(leftPx, rectTop, rightPx - leftPx, rectHeight)\n    }\n  }, [\n    bpPerPx,\n    region,\n    selectedFeatureId,\n    featureIdUnderMouse,\n    contextMenuFeature,\n    blockKey,\n    blockLayoutFeatures,\n  ])\n\n  function onMouseDown(event: MouseEvent) {\n    setMouseIsDown(true)\n    setMovedDuringLastMouseDown(false)\n    callMouseHandler('MouseDown', event)\n  }\n\n  function onMouseEnter(event: MouseEvent) {\n    callMouseHandler('MouseEnter', event)\n  }\n\n  function onMouseOut(event: MouseEvent) {\n    callMouseHandler('MouseOut', event)\n    callMouseHandler('MouseLeave', event)\n  }\n\n  function onMouseOver(event: MouseEvent) {\n    callMouseHandler('MouseOver', event)\n  }\n\n  function onMouseUp(event: MouseEvent) {\n    setMouseIsDown(false)\n    callMouseHandler('MouseUp', event)\n  }\n\n  function onClick(event: MouseEvent) {\n    if (!movedDuringLastMouseDown) {\n      callMouseHandler('Click', event)\n    }\n  }\n\n  function onMouseLeave(event: MouseEvent) {\n    callMouseHandler('MouseOut', event)\n    callMouseHandler('MouseLeave', event)\n  }\n\n  function onContextMenu(event: MouseEvent) {\n    callMouseHandler('ContextMenu', event)\n  }\n\n  function mouseMove(event: MouseEvent) {\n    if (mouseIsDown) {\n      setMovedDuringLastMouseDown(true)\n    }\n    let offsetX = 0\n    let offsetY = 0\n    if (highlightOverlayCanvas.current) {\n      offsetX = highlightOverlayCanvas.current.getBoundingClientRect().left\n      offsetY = highlightOverlayCanvas.current.getBoundingClientRect().top\n    }\n    offsetX = event.clientX - offsetX\n    offsetY = event.clientY - offsetY\n    const px = region.reversed ? width - offsetX : offsetX\n    const clientBp = region.start + bpPerPx * px\n\n    const feats = displayModel.getFeatureOverlapping(\n      blockKey,\n      clientBp,\n      offsetY,\n    )\n    const featIdUnderMouse = feats.length ? feats[0].name : undefined\n\n    if (onMouseMove) {\n      onMouseMove(event, featIdUnderMouse)\n    }\n  }\n\n  function callMouseHandler(handlerName: string, event: MouseEvent) {\n    // @ts-ignore\n    const featureHandler = props[`onFeature${handlerName}`]\n    // @ts-ignore\n    const canvasHandler = props[`on${handlerName}`]\n    if (featureHandler && featureIdUnderMouse) {\n      featureHandler(event, featureIdUnderMouse)\n    } else if (canvasHandler) {\n      canvasHandler(event, featureIdUnderMouse)\n    }\n  }\n\n  const canvasWidth = Math.ceil(width)\n  // need to call this in render so we get the right observer behavior\n  return (\n    <div\n      className=\"PileupRendering\"\n      data-testid={`pileup-${sortedBy ? sortedBy.type : 'normal'}`}\n      style={{ position: 'relative', width: canvasWidth, height }}\n    >\n      <PrerenderedCanvas\n        {...props}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n      />\n      <canvas\n        data-testid=\"pileup_overlay_canvas\"\n        width={canvasWidth}\n        height={height}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n        className=\"highlightOverlayCanvas\"\n        ref={highlightOverlayCanvas}\n        onMouseDown={event => onMouseDown(event)}\n        onMouseEnter={event => onMouseEnter(event)}\n        onMouseOut={event => onMouseOut(event)}\n        onMouseOver={event => onMouseOver(event)}\n        onMouseUp={event => onMouseUp(event)}\n        onMouseLeave={event => onMouseLeave(event)}\n        onMouseMove={event => mouseMove(event)}\n        onClick={event => onClick(event)}\n        onContextMenu={event => onContextMenu(event)}\n        onFocus={() => {}}\n        onBlur={() => {}}\n      />\n    </div>\n  )\n}\n\nexport default observer(PileupRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'PileupRenderer',\n  {\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a pileup alignment',\n      defaultValue: `function(feature) {\n  var s = feature.get('strand');\n  return s === -1 ? '#8F8FD8': '#EC8B8B'\n}`,\n      functionSignature: ['feature'],\n    },\n    displayMode: {\n      type: 'stringEnum',\n      model: types.enumeration('displayMode', [\n        'normal',\n        'compact',\n        'collapse',\n      ]),\n      description: 'Alternative display modes',\n      defaultValue: 'normal',\n    },\n    minSubfeatureWidth: {\n      type: 'number',\n      description:\n        'the minimum width in px for a pileup mismatch feature. use for increasing mismatch marker widths when zoomed out to e.g. 1px or 0.5px',\n      defaultValue: 0,\n    },\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a pileup rendering',\n      defaultValue: 600,\n    },\n    maxClippingSize: {\n      type: 'integer',\n      description: 'the max clip size to be used in a pileup rendering',\n      defaultValue: 10000,\n    },\n    height: {\n      type: 'integer',\n      description: 'the height of each feature in a pileup alignment',\n      defaultValue: 7,\n      functionSignature: ['feature'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { doesIntersect2 } from '@jbrowse/core/util/range'\nimport { Mismatch } from '../BamAdapter/MismatchParser'\n\ninterface SortObject {\n  pos: number\n  type: string\n}\nexport const sortFeature = (\n  features: Map<string, Feature>,\n  sortedBy: SortObject,\n) => {\n  const featureArray = Array.from(features.values())\n  const featuresInCenterLine: Feature[] = []\n  const featuresOutsideCenter: Feature[] = []\n  const { pos, type } = sortedBy\n\n  // only sort on features that intersect center line, append those outside post-sort\n  featureArray.forEach(innerArray => {\n    const feature = innerArray\n    const start = feature.get('start')\n    const end = feature.get('end')\n    if (doesIntersect2(pos - 1, pos, start, end)) {\n      featuresInCenterLine.push(innerArray)\n    } else {\n      featuresOutsideCenter.push(innerArray)\n    }\n  })\n\n  switch (type) {\n    case 'Start location': {\n      featuresInCenterLine.sort((a, b) => a.get('start') - b.get('start'))\n      break\n    }\n\n    // first sort all mismatches, then all reference bases at the end\n    case 'Base pair': {\n      const baseSortArray: [string, Mismatch][] = []\n      featuresInCenterLine.forEach(feature => {\n        const mismatches: Mismatch[] = feature.get('mismatches')\n        mismatches.forEach(mismatch => {\n          const start = feature.get('start')\n          const offset = start + mismatch.start + 1\n          const consuming =\n            mismatch.type === 'insertion' || mismatch.type === 'softclip'\n          const len = consuming ? 0 : mismatch.length\n          if (pos >= offset && pos < offset + len) {\n            baseSortArray.push([feature.id(), mismatch])\n          }\n        })\n      })\n\n      const baseMap = new Map(baseSortArray)\n      featuresInCenterLine.sort((a, b) => {\n        const aMismatch = baseMap.get(a.id())\n        const bMismatch = baseMap.get(b.id())\n        const acode = bMismatch && bMismatch.base.toUpperCase()\n        const bcode = aMismatch && aMismatch.base.toUpperCase()\n        if (acode === bcode && acode === '*') {\n          // @ts-ignore\n          return aMismatch.length - bMismatch.length\n        }\n        return (\n          (acode ? acode.charCodeAt(0) : 0) - (bcode ? bcode.charCodeAt(0) : 0)\n        )\n      })\n\n      break\n    }\n\n    // sorts positive strands then negative strands\n    case 'Read strand': {\n      featuresInCenterLine.sort((a, b) =>\n        a.get('strand') <= b.get('strand') ? 1 : -1,\n      )\n      break\n    }\n  }\n\n  const sortedMap = new Map(\n    featuresInCenterLine\n      .concat(featuresOutsideCenter)\n      .map(feature => [feature.id(), feature]),\n  )\n\n  return sortedMap\n}\n","import deepEqual from 'deep-equal'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport BoxRendererType, {\n  LayoutSession,\n} from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport GranularRectLayout from '@jbrowse/core/util/layouts/GranularRectLayout'\nimport MultiLayout from '@jbrowse/core/util/layouts/MultiLayout'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { bpSpanPx, iterMap } from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types'\nimport {\n  createCanvas,\n  createImageBitmap,\n} from '@jbrowse/core/util/offscreenCanvasPonyfill'\nimport React from 'react'\nimport { BaseLayout } from '@jbrowse/core/util/layouts/BaseLayout'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { RenderArgsDeserialized } from '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType'\nimport { ThemeOptions } from '@material-ui/core'\nimport { lighten } from '@material-ui/core/styles/colorManipulator'\nimport { Mismatch } from '../BamAdapter/MismatchParser'\nimport { sortFeature } from './sortUtil'\n\nexport interface PileupRenderProps {\n  features: Map<string, Feature>\n  layout: BaseLayout<Feature>\n  config: AnyConfigurationModel\n  regions: Region[]\n  bpPerPx: number\n  height: number\n  width: number\n  highResolutionScaling: number\n  showSoftClip: boolean\n  sortedBy: {\n    type: string\n    pos: number\n    refName: string\n  }\n  theme: ThemeOptions\n}\n\ninterface LayoutRecord {\n  feature: Feature\n  leftPx: number\n  rightPx: number\n  topPx: number\n  heightPx: number\n}\n\ninterface RenderArgsSoftClip extends RenderArgsDeserialized {\n  showSoftClip?: boolean\n}\n\ninterface PileupLayoutSessionProps {\n  config: AnyConfigurationModel\n  bpPerPx: number\n  filters: SerializableFilterChain\n  sortedBy: unknown\n  showSoftClip: unknown\n}\n\ntype MyMultiLayout = MultiLayout<GranularRectLayout<unknown>, unknown>\ninterface CachedPileupLayout {\n  layout: MyMultiLayout\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n  sortedBy: unknown\n  showSoftClip: unknown\n}\n\n// Sorting and revealing soft clip changes the layout of Pileup renderer\n// Adds extra conditions to see if cached layout is valid\nclass PileupLayoutSession extends LayoutSession {\n  sortedBy: unknown\n\n  showSoftClip: unknown\n\n  constructor(args: PileupLayoutSessionProps) {\n    super(args)\n    this.config = args.config\n  }\n\n  cachedLayoutIsValid(cachedLayout: CachedPileupLayout) {\n    return (\n      super.cachedLayoutIsValid(cachedLayout) &&\n      deepEqual(this.sortedBy, cachedLayout.sortedBy) &&\n      deepEqual(this.showSoftClip, cachedLayout.showSoftClip)\n    )\n  }\n\n  cachedLayout: CachedPileupLayout | undefined\n\n  get layout(): MyMultiLayout {\n    if (!this.cachedLayout || !this.cachedLayoutIsValid(this.cachedLayout)) {\n      this.cachedLayout = {\n        layout: this.makeLayout(),\n        config: readConfObject(this.config),\n        filters: this.filters,\n        sortedBy: this.sortedBy,\n        showSoftClip: this.showSoftClip,\n      }\n    }\n    return this.cachedLayout.layout\n  }\n}\nexport default class PileupRenderer extends BoxRendererType {\n  layoutFeature(\n    feature: Feature,\n    layout: BaseLayout<Feature>,\n    config: AnyConfigurationModel,\n    bpPerPx: number,\n    region: Region,\n    showSoftClip?: boolean,\n  ): LayoutRecord | null {\n    let expansionBefore = 0\n    let expansionAfter = 0\n    const mismatches: Mismatch[] = feature.get('mismatches')\n\n    // Expand the start and end of feature when softclipping enabled\n    if (showSoftClip && feature.get('seq')) {\n      for (let i = 0; i < mismatches.length; i += 1) {\n        const mismatch = mismatches[i]\n        if (mismatch.type === 'softclip') {\n          mismatch.start === 0\n            ? (expansionBefore = mismatch.cliplen || 0)\n            : (expansionAfter = mismatch.cliplen || 0)\n        }\n      }\n    }\n\n    const [leftPx, rightPx] = bpSpanPx(\n      feature.get('start') - expansionBefore,\n      feature.get('end') + expansionAfter,\n      region,\n      bpPerPx,\n    )\n\n    let heightPx = readConfObject(config, 'height', [feature])\n    const displayMode = readConfObject(config, 'displayMode', [feature])\n    if (displayMode === 'compact') heightPx /= 3\n    if (feature.get('refName') !== region.refName) {\n      throw new Error(\n        `feature ${feature.id()} is not on the current region's reference sequence ${\n          region.refName\n        }`,\n      )\n    }\n    const topPx = layout.addRect(\n      feature.id(),\n      feature.get('start') - expansionBefore,\n      feature.get('end') + expansionAfter,\n      heightPx,\n    )\n    if (topPx === null) {\n      return null\n    }\n\n    return {\n      feature,\n      leftPx,\n      rightPx,\n      topPx: displayMode === 'collapse' ? 0 : topPx,\n      heightPx,\n    }\n  }\n\n  // expands region for clipping to use\n  // In future when stats are improved, look for average read size in renderArg stats\n  // and set that as the maxClippingSize/expand region by average read size\n  getExpandedRegion(region: Region, renderArgs: RenderArgsSoftClip) {\n    if (!region) return region\n    const { config, showSoftClip } = renderArgs\n    const maxClippingSize =\n      config === undefined ? 0 : readConfObject(config, 'maxClippingSize')\n    if (!maxClippingSize || !showSoftClip) return region\n    const bpExpansion = Math.round(maxClippingSize)\n    return {\n      ...region,\n      start: Math.floor(Math.max(region.start - bpExpansion, 0)),\n      end: Math.ceil(region.end + bpExpansion),\n    }\n  }\n\n  async makeImageData(props: PileupRenderProps) {\n    const {\n      features,\n      layout,\n      config,\n      regions,\n      bpPerPx,\n      sortedBy,\n      highResolutionScaling = 1,\n      showSoftClip,\n      theme: configTheme,\n    } = props\n    const theme = createJBrowseTheme(configTheme)\n    const [region] = regions\n    if (!layout) {\n      throw new Error(`layout required`)\n    }\n    if (!layout.addRect) {\n      throw new Error('invalid layout object')\n    }\n    const pxPerBp = Math.min(1 / bpPerPx, 2)\n    const minFeatWidth = readConfObject(config, 'minSubfeatureWidth')\n    const w = Math.max(minFeatWidth, pxPerBp)\n\n    const sortedFeatures =\n      sortedBy && sortedBy.type && region.start === sortedBy.pos\n        ? sortFeature(features, sortedBy)\n        : null\n\n    const featureMap = sortedFeatures || features\n    const layoutRecords = iterMap(\n      featureMap.values(),\n      feature =>\n        this.layoutFeature(\n          feature,\n          layout,\n          config,\n          bpPerPx,\n          region,\n          showSoftClip,\n        ),\n      featureMap.size,\n    )\n\n    const width = (region.end - region.start) / bpPerPx\n    const height = Math.max(layout.getTotalHeight(), 1)\n\n    const canvas = createCanvas(\n      Math.ceil(width * highResolutionScaling),\n      height * highResolutionScaling,\n    )\n    const ctx = canvas.getContext('2d')\n    ctx.scale(highResolutionScaling, highResolutionScaling)\n    ctx.font = 'bold 10px Courier New,monospace'\n    const charSize = ctx.measureText('A')\n    charSize.height = 7\n\n    layoutRecords.forEach(feat => {\n      if (feat === null) {\n        return\n      }\n\n      const { feature, leftPx, rightPx, topPx, heightPx } = feat\n      ctx.fillStyle = readConfObject(config, 'color', [feature])\n      ctx.fillRect(leftPx, topPx, Math.max(rightPx - leftPx, 1.5), heightPx)\n      const mismatches: Mismatch[] = feature.get('mismatches')\n\n      if (mismatches) {\n        const colorForBase: { [key: string]: string } = {\n          A: theme.palette.bases.A.main,\n          C: theme.palette.bases.C.main,\n          G: theme.palette.bases.G.main,\n          T: theme.palette.bases.T.main,\n          deletion: '#808080', // gray\n        }\n        for (let i = 0; i < mismatches.length; i += 1) {\n          const mismatch = mismatches[i]\n          const [mismatchLeftPx, mismatchRightPx] = bpSpanPx(\n            feature.get('start') + mismatch.start,\n            feature.get('start') + mismatch.start + mismatch.length,\n            region,\n            bpPerPx,\n          )\n\n          const mismatchWidthPx = Math.max(\n            minFeatWidth,\n            Math.abs(mismatchLeftPx - mismatchRightPx),\n          )\n\n          if (mismatch.type === 'mismatch' || mismatch.type === 'deletion') {\n            const baseColor =\n              colorForBase[\n                mismatch.type === 'deletion' ? 'deletion' : mismatch.base\n              ] || '#888'\n            ctx.fillStyle = baseColor\n            ctx.fillRect(mismatchLeftPx, topPx, mismatchWidthPx, heightPx)\n\n            if (\n              mismatchWidthPx >= charSize.width &&\n              heightPx >= charSize.height - 5\n            ) {\n              ctx.fillStyle = theme.palette.getContrastText(baseColor)\n              ctx.fillText(\n                mismatch.base,\n                mismatchLeftPx + (mismatchWidthPx - charSize.width) / 2 + 1,\n                topPx + heightPx,\n              )\n            }\n          } else if (mismatch.type === 'insertion') {\n            ctx.fillStyle = 'purple'\n            const pos = mismatchLeftPx - 1\n            ctx.fillRect(pos, topPx + 1, w, heightPx - 2)\n            ctx.fillRect(pos - w, topPx, w * 3, 1)\n            ctx.fillRect(pos - w, topPx + heightPx - 1, w * 3, 1)\n            if (\n              1 / bpPerPx >= charSize.width &&\n              heightPx >= charSize.height - 2\n            ) {\n              ctx.fillText(\n                `(${mismatch.base})`,\n                mismatchLeftPx + 2,\n                topPx + heightPx,\n              )\n            }\n          } else if (\n            mismatch.type === 'hardclip' ||\n            (!showSoftClip && mismatch.type === 'softclip')\n          ) {\n            ctx.fillStyle = mismatch.type === 'hardclip' ? 'red' : 'blue'\n            const pos = mismatchLeftPx - 1\n            ctx.fillRect(pos, topPx + 1, w, heightPx - 2)\n            ctx.fillRect(pos - w, topPx, w * 3, 1)\n            ctx.fillRect(pos - w, topPx + heightPx - 1, w * 3, 1)\n            if (\n              mismatchWidthPx >= charSize.width &&\n              heightPx >= charSize.height - 2\n            ) {\n              ctx.fillText(\n                `(${mismatch.base})`,\n                mismatchLeftPx + 2,\n                topPx + heightPx,\n              )\n            }\n          } else if (mismatch.type === 'skip') {\n            // fix to avoid bad rendering\n            // note that this was also related to chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1131528\n            // ref #1236\n            if (mismatchLeftPx + mismatchWidthPx > 0) {\n              ctx.clearRect(mismatchLeftPx, topPx, mismatchWidthPx, heightPx)\n            }\n            ctx.fillStyle = '#333'\n            ctx.fillRect(\n              mismatchLeftPx,\n              topPx + heightPx / 2,\n              mismatchWidthPx,\n              2,\n            )\n          }\n        }\n        // Display all bases softclipped off in lightened colors\n        if (showSoftClip) {\n          const seq = feature.get('seq')\n          if (!seq) return\n          for (let j = 0; j < mismatches.length; j += 1) {\n            const mismatch = mismatches[j]\n            if (mismatch.type === 'softclip') {\n              const softClipLength = mismatch.cliplen || 0\n              const softClipStart =\n                mismatch.start === 0\n                  ? feature.get('start') - softClipLength\n                  : feature.get('start') + mismatch.start\n              for (let k = 0; k < softClipLength; k += 1) {\n                const base = seq.charAt(k + mismatch.start)\n                // If softclip length+start is longer than sequence, no need to continue showing base\n                if (!base) return\n\n                const [softClipLeftPx, softClipRightPx] = bpSpanPx(\n                  softClipStart + k,\n                  softClipStart + k + 1,\n                  region,\n                  bpPerPx,\n                )\n                const softClipWidthPx = Math.max(\n                  minFeatWidth,\n                  Math.abs(softClipLeftPx - softClipRightPx),\n                )\n\n                // Black accounts for IUPAC ambiguity code bases such as N that show in soft clipping\n                ctx.fillStyle = lighten(colorForBase[base] || '#000000', 0.3)\n                ctx.fillRect(softClipLeftPx, topPx, softClipWidthPx, heightPx)\n\n                if (\n                  softClipWidthPx >= charSize.width &&\n                  heightPx >= charSize.height - 5\n                ) {\n                  ctx.fillStyle = 'black'\n                  ctx.fillText(\n                    base,\n                    softClipLeftPx + (softClipWidthPx - charSize.width) / 2 + 1,\n                    topPx + heightPx,\n                  )\n                }\n              }\n            }\n          }\n        }\n      }\n    })\n\n    const imageData = await createImageBitmap(canvas)\n    return {\n      imageData,\n      height,\n      width,\n      maxHeightReached: layout.maxHeightReached,\n    }\n  }\n\n  async render(renderProps: PileupRenderProps) {\n    const {\n      height,\n      width,\n      imageData,\n      maxHeightReached,\n    } = await this.makeImageData(renderProps)\n    const element = React.createElement(\n      this.ReactComponent,\n      {\n        ...renderProps,\n        region: renderProps.regions[0],\n        height,\n        width,\n        imageData,\n      },\n      null,\n    )\n\n    return {\n      element,\n      imageData,\n      height,\n      width,\n      maxHeightReached,\n      layout: renderProps.layout,\n    }\n  }\n\n  createSession(args: PileupLayoutSessionProps) {\n    return new PileupLayoutSession(args)\n  }\n}\n","/* eslint-disable guard-for-in,@typescript-eslint/no-explicit-any */\n// see perf results on object.keys vs for-in loop\n// https://jsperf.com/object-keys-vs-hasownproperty/55\nexport default class NestedFrequencyTable {\n  public categories: { [key: string]: any }\n\n  constructor(initialData = {}) {\n    this.categories = { ...initialData }\n  }\n\n  // get the sum of all the category counts\n  total() {\n    // calculate total if necessary\n    let t = 0\n\n    for (const k in this.categories) {\n      const v = this.categories[k]\n      t += v.total ? v.total() : v\n    }\n\n    return t\n  }\n\n  // decrement the count for the given category\n  decrement(slotName: string, amount: number) {\n    if (!amount) {\n      amount = 1\n    }\n\n    if (!slotName) {\n      slotName = 'default'\n    } else {\n      slotName = slotName.toString()\n    }\n\n    if (this.categories[slotName]) {\n      this.categories[slotName] = Math.max(\n        0,\n        this.categories[slotName] - amount,\n      )\n      return this.categories[slotName]\n    }\n    return 0\n  }\n\n  // increment the count for the given category\n  increment(slotName: string, amount: number) {\n    if (!amount) {\n      amount = 1\n    }\n\n    if (!slotName) {\n      slotName = 'default'\n    } else {\n      slotName = slotName.toString()\n    }\n\n    this.categories[slotName] = (this.categories[slotName] || 0) + amount\n    return this.categories[slotName]\n  }\n\n  // get the value of the given category.  may be a number or a\n  // frequency table.\n  get(slotName: string) {\n    return this.categories[slotName] || 0\n  }\n\n  // get a given category as a frequency table\n  getNested(path: string | string[]) {\n    if (typeof path === 'string') {\n      path = path.split('/')\n    }\n\n    if (!path.length) {\n      return this\n    }\n\n    const slotName = path[0].toString()\n    let slot = this.categories[slotName]\n    if (!slot || !slot.categories) {\n      this.categories[slotName] = new NestedFrequencyTable(\n        slot ? { default: slot + 0 } : {},\n      )\n    }\n    slot = this.categories[slotName]\n\n    if (path.length > 1) {\n      return slot.getNested(path.slice(1))\n    }\n    return slot\n  }\n\n  toString() {\n    return this.total()\n      .toPrecision(6)\n      .toString()\n      .replace(/\\.?0+$/, '')\n  }\n\n  valueOf() {\n    return this.total()\n  }\n\n  // iterate through the categories and counts, call like:\n  //\n  //   tbl.forEach( function( count, categoryName ) {\n  //      // do something\n  //   }, this );\n  //\n  forEach(func: Function, ctx: any) {\n    if (ctx) {\n      for (const slotName in this.categories) {\n        func.call(ctx, this.categories[slotName], slotName)\n      }\n    } else {\n      for (const slotName in this.categories) {\n        func(this.categories[slotName], slotName)\n      }\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { types } from 'mobx-state-tree'\n\nexport default (pluginManager: PluginManager) =>\n  types.late(() =>\n    ConfigurationSchema(\n      'SNPCoverageAdapter',\n      {\n        subadapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      },\n      { explicitlyTyped: true },\n    ),\n  )\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region } from '@jbrowse/core/util/types'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { toArray } from 'rxjs/operators'\nimport { blankStats, rectifyStats, scoresToStats } from '@jbrowse/plugin-wiggle'\nimport { Instance, getSnapshot } from 'mobx-state-tree'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport NestedFrequencyTable from '../NestedFrequencyTable'\n\nimport MyConfigSchemaF from './configSchema'\n\ninterface Mismatch {\n  start: number\n  length: number\n  type: string\n  base: string\n  altbase?: string\n  seq?: string\n  cliplen?: number\n}\n\nexport interface StatsRegion {\n  refName: string\n  start: number\n  end: number\n  bpPerPx?: number\n}\n\nexport default (pluginManager: PluginManager) => {\n  const MyConfigSchema = MyConfigSchemaF(pluginManager)\n\n  function generateInfoList(table: NestedFrequencyTable) {\n    const infoList = []\n    const overallScore = table.total()\n\n    // log info w/ base name, total score, and strand breakdown\n    // eslint-disable-next-line guard-for-in\n    for (const base in table.categories) {\n      const strands = table.categories[base].categories as {\n        [key: string]: number\n      }\n      const score = Object.values(strands).reduce((a, b) => a + b, 0)\n      infoList.push({\n        base,\n        score,\n        strands,\n      })\n    }\n\n    // sort so higher scores get drawn last, reference always first\n    infoList.sort((a, b) =>\n      a.score < b.score || b.base === 'reference' ? 1 : -1,\n    )\n\n    // add overall total to end\n    infoList.push({\n      base: 'total',\n      score: overallScore,\n    })\n    return infoList\n  }\n\n  return class SNPCoverageAdapter extends BaseFeatureDataAdapter {\n    private subadapter: BaseFeatureDataAdapter\n\n    public constructor(\n      config: Instance<typeof MyConfigSchema>,\n      getSubAdapter?: getSubAdapterType,\n    ) {\n      super(config)\n\n      const dataAdapter = getSubAdapter?.(getSnapshot(config.subadapter))\n        .dataAdapter\n\n      if (dataAdapter instanceof BaseFeatureDataAdapter) {\n        this.subadapter = dataAdapter\n      } else {\n        throw new Error(`invalid subadapter type '${config.subadapter.type}'`)\n      }\n    }\n\n    public getRegionStats(region: Region, opts: BaseOptions = {}) {\n      const feats = this.getFeatures(region, opts)\n      return scoresToStats(region, feats)\n    }\n\n    public async getMultiRegionStats(\n      regions: Region[] = [],\n      opts: BaseOptions = {},\n    ) {\n      if (!regions.length) {\n        return blankStats()\n      }\n\n      const feats = await Promise.all(\n        regions.map(region => this.getRegionStats(region, opts)),\n      )\n\n      const scoreMax = feats\n        .map(s => s.scoreMax)\n        .reduce((acc, curr) => Math.max(acc, curr))\n      const scoreMin = feats\n        .map(s => s.scoreMin)\n        .reduce((acc, curr) => Math.min(acc, curr))\n      const scoreSum = feats.map(s => s.scoreSum).reduce((a, b) => a + b, 0)\n      const scoreSumSquares = feats\n        .map(s => s.scoreSumSquares)\n        .reduce((a, b) => a + b, 0)\n      const featureCount = feats\n        .map(s => s.featureCount)\n        .reduce((a, b) => a + b, 0)\n      const basesCovered = feats\n        .map(s => s.basesCovered)\n        .reduce((a, b) => a + b, 0)\n\n      return rectifyStats({\n        scoreMin,\n        scoreMax,\n        featureCount,\n        basesCovered,\n        scoreSumSquares,\n        scoreSum,\n      })\n    }\n\n    getFeatures(region: Region, opts: BaseOptions = {}) {\n      return ObservableCreate<Feature>(async observer => {\n        const features = await this.subadapter\n          .getFeatures(region, opts)\n          .pipe(toArray())\n          .toPromise()\n\n        const coverageBins = this.generateCoverageBins(\n          features,\n          region,\n          opts.bpPerPx || 1,\n        )\n        coverageBins.forEach((bin, index) => {\n          if (bin.total()) {\n            observer.next(\n              new SimpleFeature({\n                id: `pos_${region.start}${index}`,\n                data: {\n                  score: bin.total(),\n                  snpinfo: generateInfoList(bin), // info needed to draw snps\n                  start: region.start + index,\n                  end: region.start + index + 1,\n                  refName: region.refName,\n                },\n              }),\n            )\n          }\n        })\n\n        observer.complete()\n      }, opts.signal)\n    }\n\n    async getRefNames(opts: BaseOptions = {}) {\n      return this.subadapter.getRefNames(opts)\n    }\n\n    freeResources(/* { region } */): void {}\n\n    /**\n     * Generates coverage bins from features which details\n     * the reference, mismatches, strands, and coverage info\n     * @param features - Features of region to be passed in\n     * @param region - Region\n     * @param bpPerPx - base pairs per pixel\n     * @returns Array of nested frequency tables\n     */\n    generateCoverageBins(\n      features: Feature[],\n      region: StatsRegion,\n      bpPerPx: number,\n    ): NestedFrequencyTable[] {\n      const leftBase = region.start\n      const rightBase = region.end\n      const scale = 1 / bpPerPx\n      const binWidth = bpPerPx <= 10 ? 1 : Math.ceil(scale)\n      const binMax = Math.ceil((rightBase - leftBase) / binWidth)\n\n      const coverageBins = new Array(binMax).fill(0)\n\n      for (let i = 0; i < binMax; i++) {\n        coverageBins[i] = new NestedFrequencyTable()\n        if (binWidth === 1) {\n          coverageBins[i].snpsCounted = true\n        }\n      }\n\n      const forEachBin = function forEachBin(\n        start: number,\n        end: number,\n        callback: (bin: number, overlap: number) => void,\n      ) {\n        let s = (start - leftBase) / binWidth\n        let e = (end - 1 - leftBase) / binWidth\n        let sb = Math.floor(s)\n        let eb = Math.floor(e)\n\n        if (sb >= binMax || eb < 0) return // does not overlap this block\n\n        // enforce 0 <= bin < binMax\n        if (sb < 0) {\n          s = 0\n          sb = 0\n        }\n        if (eb >= binMax) {\n          eb = binMax - 1\n          e = binMax\n        }\n        // now iterate\n        if (sb === eb) {\n          // if in the same bin, just one call\n          callback(sb, e - s)\n        } else {\n          // if in different bins, two or more calls\n          callback(sb, sb + 1 - s)\n          for (let i = sb + 1; i < eb; i++) {\n            callback(i, 1)\n          }\n          callback(eb, e - eb)\n        }\n      }\n\n      function getStrand(feature: Feature) {\n        const result = feature.get('strand')\n        let strand = ''\n        switch (result) {\n          case -1:\n            strand = '-'\n            break\n          case 1:\n            strand = '+'\n            break\n          default:\n            strand = 'unstranded'\n            break\n        }\n        return strand\n      }\n\n      for (const feature of features.values()) {\n        const strand = getStrand(feature)\n        const start = feature.get('start')\n        const end = feature.get('end')\n        // increment start and end partial-overlap bins by proportion of overlap\n        forEachBin(start, end, (bin, overlap) => {\n          coverageBins[bin].getNested('reference').increment(strand, overlap)\n        })\n\n        // Calculate SNP coverage\n        if (binWidth === 1) {\n          const mismatches: Mismatch[] = feature.get('mismatches')\n          // bpPerPx < 10 ? feature.get('mismatches') : feature.get('skips_and_dels')\n\n          // loops through mismatches and updates coverage variables accordingly.\n          if (mismatches) {\n            for (let i = 0; i < mismatches.length; i++) {\n              const mismatch = mismatches[i]\n              if (mismatch.type !== 'insertion') {\n                forEachBin(\n                  start + mismatch.start,\n                  start + mismatch.start + mismatch.length,\n                  (binNum, overlap) => {\n                    // Note: we decrement 'reference' so that total of the score is the total coverage\n                    const bin = coverageBins[binNum]\n                    bin.getNested('reference').decrement(strand, overlap)\n                    let { base } = mismatch\n\n                    if (mismatch.type === 'insertion') {\n                      base = `ins ${base}`\n                    } else if (mismatch.type === 'skip') {\n                      base = 'skip'\n                    }\n\n                    if (base === 'skip') {\n                      bin.getNested(base).decrement('reference', overlap)\n                    }\n\n                    if (base && base !== '*' && base !== 'skip') {\n                      bin.getNested(base).increment(strand, overlap)\n                    }\n                  },\n                )\n              }\n            }\n          }\n        }\n      }\n      return coverageBins\n    }\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterClassF from './SNPCoverageAdapter'\nimport configSchemaF from './configSchema'\n\nexport default (pm: PluginManager) => {\n  return {\n    AdapterClass: AdapterClassF(pm),\n    configSchema: configSchemaF(pm),\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'SNPCoverageRenderer',\n  {\n    clipColor: {\n      type: 'color',\n      description: 'the color of the clipping marker',\n      defaultValue: 'red',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { featureSpanPx } from '@jbrowse/core/util'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { Region } from '@jbrowse/core/util/types'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport {\n  getOrigin,\n  getScale,\n  ScaleOpts,\n  WiggleBaseRenderer,\n} from '@jbrowse/plugin-wiggle'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { ThemeOptions } from '@material-ui/core'\n\ninterface SNPCoverageRendererProps {\n  features: Map<string, Feature>\n  layout: any // eslint-disable-line @typescript-eslint/no-explicit-any\n  config: AnyConfigurationModel\n  regions: Region[]\n  bpPerPx: number\n  height: number\n  width: number\n  highResolutionScaling: number\n  blockKey: string\n  dataAdapter: BaseFeatureDataAdapter\n  notReady: boolean\n  scaleOpts: ScaleOpts\n  sessionId: string\n  signal: AbortSignal\n  displayModel: unknown\n  theme: ThemeOptions\n}\n\ninterface BaseInfo {\n  base: string\n  score: number\n  strands?: {\n    [key: string]: number\n  }\n}\n\nexport default class SNPCoverageRenderer extends WiggleBaseRenderer {\n  draw(ctx: CanvasRenderingContext2D, props: SNPCoverageRendererProps) {\n    const {\n      features,\n      regions,\n      bpPerPx,\n      scaleOpts,\n      height,\n      theme: configTheme,\n    } = props\n    const theme = createJBrowseTheme(configTheme)\n\n    const [region] = regions\n    const viewScale = getScale({ ...scaleOpts, range: [0, height] })\n    const originY = getOrigin(scaleOpts.scaleType)\n    const toY = (rawscore: number, curr = 0) =>\n      height - viewScale(rawscore) - curr\n    const toHeight = (rawscore: number, curr = 0) =>\n      toY(originY) - toY(rawscore, curr)\n\n    const insRegex = /^ins.[A-Za-z0-9]/\n    const colorForBase: { [key: string]: string } = {\n      A: theme.palette.bases.A.main,\n      C: theme.palette.bases.C.main,\n      G: theme.palette.bases.G.main,\n      T: theme.palette.bases.T.main,\n      total: 'lightgrey',\n    }\n\n    // Use two pass rendering, which helps in visualizing the SNPs at higher bpPerPx\n    // First pass: draw the gray background\n    // Second pass: draw the SNP data, and add a minimum feature width of 1px which can be wider than the actual bpPerPx\n    // This reduces overdrawing of the grey background over the SNPs\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const score = feature.get('score') as number\n      // console.log(score, toHeight(score))\n\n      // draw total\n      ctx.fillStyle = colorForBase.total\n      const w = rightPx - leftPx + 0.3\n      ctx.fillRect(leftPx, toY(score), w, toHeight(score))\n    }\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const w = Math.max(rightPx - leftPx + 0.3, 1)\n      // grab array with nestedtable's info, draw mismatches\n      const infoArray = feature.get('snpinfo') || []\n      let curr = 0\n      infoArray.forEach(function iterate(info: BaseInfo) {\n        if (!info || info.base === 'reference' || info.base === 'total') {\n          return\n        }\n        ctx.fillStyle = info.base.match(insRegex)\n          ? 'darkgrey'\n          : colorForBase[info.base]\n        ctx.fillRect(leftPx, toY(info.score + curr), w, toHeight(info.score))\n        curr += info.score\n      })\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport ConfigSchema from './configSchema'\n\nexport { WiggleRendering as ReactComponent } from '@jbrowse/plugin-wiggle'\nexport { default } from './SNPCoverageRenderer'\n\nexport const configSchema = ConfigurationSchema(\n  'SNPCoverageRenderer',\n  {},\n  { baseConfiguration: ConfigSchema, explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport { LinearWiggleDisplayReactComponent } from '@jbrowse/plugin-wiggle'\nimport {\n  configSchema as alignmentsFeatureDetailConfigSchema,\n  ReactComponent as AlignmentsFeatureDetailReactComponent,\n  stateModel as alignmentsFeatureDetailStateModel,\n} from './AlignmentsFeatureDetail'\nimport BamAdapterF from './BamAdapter'\nimport * as MismatchParser from './BamAdapter/MismatchParser'\nimport CramAdapterF from './CramAdapter'\nimport HtsgetBamAdapterF from './HtsgetBamAdapter'\nimport {\n  configSchemaFactory as linearAligmentsDisplayConfigSchemaFactory,\n  modelFactory as linearAlignmentsDisplayModelFactory,\n  ReactComponent as LinearAlignmentsDisplayReactComponent,\n} from './LinearAlignmentsDisplay'\nimport {\n  configSchemaFactory as linearPileupDisplayConfigSchemaFactory,\n  modelFactory as linearPileupDisplayModelFactory,\n} from './LinearPileupDisplay'\nimport {\n  configSchemaFactory as linearSNPCoverageDisplayConfigSchemaFactory,\n  modelFactory as linearSNPCoverageDisplayModelFactory,\n} from './LinearSNPCoverageDisplay'\nimport PileupRenderer, {\n  configSchema as pileupRendererConfigSchema,\n  ReactComponent as PileupRendererReactComponent,\n} from './PileupRenderer'\nimport SNPCoverageAdapterF from './SNPCoverageAdapter'\nimport SNPCoverageRenderer, {\n  configSchema as SNPCoverageRendererConfigSchema,\n  ReactComponent as SNPCoverageRendererReactComponent,\n} from './SNPCoverageRenderer'\n\nexport { MismatchParser }\n\nexport default class AlignmentsPlugin extends Plugin {\n  name = 'AlignmentsPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'AlignmentsTrack',\n        {},\n        { baseConfiguration: createBaseTrackConfig(pluginManager) },\n      )\n      const track = new TrackType({\n        name: 'AlignmentsTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'AlignmentsTrack',\n          configSchema,\n        ),\n      })\n      const linearAlignmentsDisplay = pluginManager.getDisplayType(\n        'LinearAlignmentsDisplay',\n      )\n      // Add LinearAlignmentsDisplay here so that it has priority over the other\n      // linear displays (defaults to order the displays are added, but we have\n      // to add the Pileup and SNPCoverage displays first).\n      track.addDisplayType(linearAlignmentsDisplay)\n      return track\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearPileupDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearPileupDisplay',\n        configSchema,\n        stateModel: linearPileupDisplayModelFactory(\n          pluginManager,\n          configSchema,\n        ),\n        trackType: 'AlignmentsTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearSNPCoverageDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearSNPCoverageDisplay',\n        configSchema,\n        stateModel: linearSNPCoverageDisplayModelFactory(configSchema),\n        trackType: 'AlignmentsTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: LinearWiggleDisplayReactComponent,\n      })\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearAligmentsDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearAlignmentsDisplay',\n        configSchema,\n        stateModel: linearAlignmentsDisplayModelFactory(\n          pluginManager,\n          configSchema,\n        ),\n        trackType: 'AlignmentsTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: LinearAlignmentsDisplayReactComponent,\n      })\n    })\n    pluginManager.addWidgetType(\n      () =>\n        new WidgetType({\n          name: 'AlignmentsFeatureWidget',\n          heading: 'Feature Details',\n          configSchema: alignmentsFeatureDetailConfigSchema,\n          stateModel: alignmentsFeatureDetailStateModel,\n          ReactComponent: AlignmentsFeatureDetailReactComponent,\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BamAdapter',\n          ...pluginManager.load(BamAdapterF),\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'SNPCoverageAdapter',\n          ...pluginManager.load(SNPCoverageAdapterF),\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'CramAdapter',\n          ...pluginManager.load(CramAdapterF),\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'HtsgetBamAdapter',\n          ...pluginManager.load(HtsgetBamAdapterF),\n        }),\n    )\n    pluginManager.addRendererType(\n      () =>\n        // @ts-ignore error \"expected 0 arguments, but got 1\"?\n        new PileupRenderer({\n          name: 'PileupRenderer',\n          ReactComponent: PileupRendererReactComponent,\n          configSchema: pileupRendererConfigSchema,\n        }),\n    )\n    pluginManager.addRendererType(\n      () =>\n        new SNPCoverageRenderer({\n          name: 'SNPCoverageRenderer',\n          ReactComponent: SNPCoverageRendererReactComponent,\n          configSchema: SNPCoverageRendererConfigSchema,\n        }),\n    )\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function SNPCoverageConfigFactory(pluginManager: PluginManager) {\n  const SNPCoverageRendererConfigSchema = pluginManager.getRendererType(\n    'SNPCoverageRenderer',\n  ).configSchema\n\n  return ConfigurationSchema(\n    'LinearSNPCoverageDisplay',\n    {\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', ['local']),\n        description:\n          'performs local autoscaling (no other options for SNP Coverage available)',\n      },\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the y-scale',\n      },\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']), // todo zscale\n        description: 'The type of scale to use',\n        defaultValue: 'linear',\n      },\n      inverted: {\n        type: 'boolean',\n        description: 'draw upside down',\n        defaultValue: false,\n      },\n      maxDisplayedBpPerPx: {\n        type: 'number',\n        description: 'maximum bpPerPx that is displayed in the view',\n        defaultValue: 100,\n      },\n      headroom: {\n        type: 'number',\n        description:\n          'round the upper value of the domain scale to the nearest N',\n        defaultValue: 20,\n      },\n\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        SNPCoverageRenderer: SNPCoverageRendererConfigSchema,\n      }),\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n","import SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\n\nexport function ucscProcessedTranscript(feature: Feature) {\n  const children = feature.children()\n  // split the blocks into UTR, CDS, and exons\n  const thickStart = feature.get('thickStart')\n  const thickEnd = feature.get('thickEnd')\n\n  if (!thickStart && !thickEnd) {\n    return feature\n  }\n\n  const blocks: Feature[] = children\n    ? children\n        .filter(child => child.get('type') === 'block')\n        .sort((a, b) => a.get('start') - b.get('start'))\n    : []\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const newChildren: Record<string, any> = []\n  blocks.forEach(block => {\n    const start = block.get('start')\n    const end = block.get('end')\n    if (thickStart >= end) {\n      // left-side UTR\n      const prime = feature.get('strand') > 0 ? 'five' : 'three'\n      newChildren.push({\n        type: `${prime}_prime_UTR`,\n        start,\n        end,\n      })\n    } else if (thickStart > start && thickStart < end && thickEnd >= end) {\n      // UTR | CDS\n      const prime = feature.get('strand') > 0 ? 'five' : 'three'\n      newChildren.push(\n        {\n          type: `${prime}_prime_UTR`,\n          start,\n          end: thickStart,\n        },\n        {\n          type: 'CDS',\n          start: thickStart,\n          end,\n        },\n      )\n    } else if (thickStart <= start && thickEnd >= end) {\n      // CDS\n      newChildren.push({\n        type: 'CDS',\n        start,\n        end,\n      })\n    } else if (thickStart > start && thickStart < end && thickEnd < end) {\n      // UTR | CDS | UTR\n      const leftPrime = feature.get('strand') > 0 ? 'five' : 'three'\n      const rightPrime = feature.get('strand') > 0 ? 'three' : 'five'\n      newChildren.push(\n        {\n          type: `${leftPrime}_prime_UTR`,\n          start,\n          end: thickStart,\n        },\n        {\n          type: `CDS`,\n          start: thickStart,\n          end: thickEnd,\n        },\n        {\n          type: `${rightPrime}_prime_UTR`,\n          start: thickEnd,\n          end,\n        },\n      )\n    } else if (thickStart <= start && thickEnd > start && thickEnd < end) {\n      // CDS | UTR\n      const prime = feature.get('strand') > 0 ? 'three' : 'five'\n      newChildren.push(\n        {\n          type: `CDS`,\n          start,\n          end: thickEnd,\n        },\n        {\n          type: `${prime}_prime_UTR`,\n          start: thickEnd,\n          end,\n        },\n      )\n    } else if (thickEnd <= start) {\n      // right-side UTR\n      const prime = feature.get('strand') > 0 ? 'three' : 'five'\n      newChildren.push({\n        type: `${prime}_prime_UTR`,\n        start,\n        end,\n      })\n    }\n  })\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const newData: Record<string, any> = {}\n  feature.tags().forEach(tag => {\n    newData[tag] = feature.get(tag)\n  })\n  newData.subfeatures = newChildren\n  newData.type = 'mRNA'\n  newData.uniqueId = feature.id()\n  delete newData.chromStarts\n  delete newData.chromStart\n  delete newData.chromEnd\n  delete newData.chrom\n  delete newData.blockSizes\n  delete newData.blockCount\n  delete newData.thickStart\n  delete newData.thickEnd\n  const newFeature = new SimpleFeature({\n    data: newData,\n    id: feature.id(),\n  })\n  return newFeature\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { BigBed } from '@gmod/bbi'\nimport BED from '@gmod/bed'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region, FileLocation } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { map, mergeAll } from 'rxjs/operators'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport configSchema from './configSchema'\nimport { ucscProcessedTranscript } from '../util'\n\ninterface BEDFeature {\n  chrom: string\n  chromStart: number\n  chromEnd: number\n  [key: string]: any\n}\n\ninterface Parser {\n  parseLine: (line: string, opts: { uniqueId: string | number }) => BEDFeature\n}\n\nexport default class BigBedAdapter extends BaseFeatureDataAdapter {\n  private bigbed: BigBed\n\n  private parser: Promise<Parser>\n\n  public constructor(config: Instance<typeof configSchema>) {\n    super(config)\n    const bigBedLocation = readConfObject(\n      config,\n      'bigBedLocation',\n    ) as FileLocation\n    this.bigbed = new BigBed({\n      filehandle: openLocation(bigBedLocation),\n    })\n\n    this.parser = this.bigbed\n      .getHeader()\n      .then(({ autoSql }: { autoSql: string }) => new BED({ autoSql }))\n  }\n\n  public async getRefNames() {\n    return Object.keys((await this.bigbed.getHeader()).refsByName)\n  }\n\n  public async refIdToName(refId: number) {\n    return ((await this.bigbed.getHeader()).refsByNumber[refId] || {}).name\n  }\n\n  public getFeatures(region: Region, opts: BaseOptions = {}) {\n    const { refName, start, end } = region\n    const { signal } = opts\n    return ObservableCreate<Feature>(async observer => {\n      try {\n        const parser = await this.parser\n        const ob = await this.bigbed.getFeatureStream(refName, start, end, {\n          signal,\n          basesPerSpan: end - start,\n        })\n        ob.pipe(\n          mergeAll(),\n          map(\n            (r: {\n              start: number\n              end: number\n              rest?: string\n              uniqueId?: string\n            }) => {\n              const data = parser.parseLine(\n                `${refName}\\t${r.start}\\t${r.end}\\t${r.rest}`,\n                {\n                  uniqueId: r.uniqueId as string,\n                },\n              )\n\n              const { blockCount, blockSizes, blockStarts, chromStarts } = data\n              if (blockCount) {\n                const starts = chromStarts || blockStarts || []\n                const sizes = blockSizes\n                const blocksOffset = r.start\n                data.subfeatures = []\n\n                for (let b = 0; b < blockCount; b += 1) {\n                  const bmin = (starts[b] || 0) + blocksOffset\n                  const bmax = bmin + (sizes[b] || 0)\n                  data.subfeatures.push({\n                    uniqueId: `${r.uniqueId}-${b}`,\n                    start: bmin,\n                    end: bmax,\n                    type: 'block',\n                  })\n                }\n              }\n              if (r.uniqueId === undefined) {\n                throw new Error('invalid bbi feature')\n              }\n\n              const f = new SimpleFeature({\n                id: `${this.id}-${r.uniqueId}`,\n                data: {\n                  ...data,\n                  start: r.start,\n                  end: r.end,\n                  refName,\n                },\n              })\n              return f.get('thickStart') && f.get('blockCount')\n                ? ucscProcessedTranscript(f)\n                : f\n            },\n          ),\n        ).subscribe(observer)\n      } catch (e) {\n        observer.error(e)\n      }\n    }, opts.signal)\n  }\n\n  public freeResources(): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'BigBedAdapter',\n  {\n    bigBedLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bb' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport BED from '@gmod/bed'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { FileLocation, Region } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { TabixIndexedFile } from '@gmod/tabix'\nimport { Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { ucscProcessedTranscript } from '../util'\nimport MyConfigSchema from './configSchema'\n\nexport default class BedTabixAdapter extends BaseFeatureDataAdapter {\n  private parser: any\n\n  protected bed: TabixIndexedFile\n\n  public static capabilities = ['getFeatures', 'getRefNames']\n\n  public constructor(config: Instance<typeof MyConfigSchema>) {\n    super(config)\n    const bedGzLocation = readConfObject(\n      config,\n      'bedGzLocation',\n    ) as FileLocation\n    const index = readConfObject(config, 'index') as {\n      indexType?: string\n      location: FileLocation\n    }\n    const autoSql = readConfObject(config, 'autoSql') as string\n    const { location, indexType } = index\n\n    this.bed = new TabixIndexedFile({\n      filehandle: openLocation(bedGzLocation),\n      csiFilehandle: indexType === 'CSI' ? openLocation(location) : undefined,\n      tbiFilehandle: indexType !== 'CSI' ? openLocation(location) : undefined,\n      chunkCacheSize: 50 * 2 ** 20,\n    })\n\n    this.parser = new BED({ autoSql })\n  }\n\n  public async getRefNames(opts: BaseOptions = {}) {\n    return this.bed.getReferenceSequenceNames(opts)\n  }\n\n  public getFeatures(query: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      await this.bed.getLines(query.refName, query.start, query.end, {\n        lineCallback: (line: string, fileOffset: number) => {\n          const l = line.split('\\t')\n          const refName = l[0]\n          const start = +l[1]\n          const end = +l[2]\n          const uniqueId = `bed-${fileOffset}`\n          const data = this.parser.parseLine(line, {\n            uniqueId,\n          })\n\n          const { blockCount, blockSizes, blockStarts, chromStarts } = data\n\n          if (blockCount) {\n            const starts = chromStarts || blockStarts || []\n            const sizes = blockSizes\n            const blocksOffset = start\n            data.subfeatures = []\n\n            for (let b = 0; b < blockCount; b += 1) {\n              const bmin = (starts[b] || 0) + blocksOffset\n              const bmax = bmin + (sizes[b] || 0)\n              data.subfeatures.push({\n                uniqueId: `${uniqueId}-${b}`,\n                start: bmin,\n                end: bmax,\n                type: 'block',\n              })\n            }\n          }\n          delete data.chrom\n          delete data.chromStart\n          delete data.chromEnd\n          const f = new SimpleFeature({\n            ...data,\n            start,\n            end,\n            refName,\n          })\n          const r = f.get('thickStart') ? ucscProcessedTranscript(f) : f\n          observer.next(r)\n        },\n        signal: opts.signal,\n      })\n      observer.complete()\n    }, opts.signal)\n  }\n\n  public freeResources(): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'BedTabixAdapter',\n  {\n    bedGzLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bed.gz' },\n    },\n\n    index: ConfigurationSchema('TabixIndex', {\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      location: {\n        type: 'fileLocation',\n        defaultValue: { uri: '/path/to/my.bed.gz.tbi' },\n      },\n    }),\n\n    autoSql: {\n      type: 'string',\n      description: 'The autoSql definition for the data fields in the file',\n      defaultValue: '',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AdapterClass as BigBedAdapterClass,\n  configSchema as bigBedAdapterConfigSchema,\n} from './BigBedAdapter'\nimport {\n  AdapterClass as BedTabixAdapterClass,\n  configSchema as bedTabixAdapterConfigSchema,\n} from './BedTabixAdapter'\n\nexport default class BedPlugin extends Plugin {\n  name = 'BedPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BigBedAdapter',\n          configSchema: bigBedAdapterConfigSchema,\n          AdapterClass: BigBedAdapterClass,\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BedTabixAdapter',\n          configSchema: bedTabixAdapterConfigSchema,\n          AdapterClass: BedTabixAdapterClass,\n        }),\n    )\n  }\n}\n","import Paper from '@material-ui/core/Paper'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport React, { FunctionComponent } from 'react'\nimport {\n  BaseCoreDetails,\n  BaseAttributes,\n} from '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail'\n\ninterface AlnCardProps {\n  title?: string\n}\n\ninterface AlnInputProps extends AlnCardProps {\n  model: any // eslint-disable-line @typescript-eslint/no-explicit-any\n}\n\nconst AlignmentFeatureDetails: FunctionComponent<AlnInputProps> = props => {\n  const { model } = props\n  const { feature1, feature2 } = JSON.parse(JSON.stringify(model.featureData))\n  return (\n    <Paper data-testid=\"alignment-side-drawer\">\n      <BaseCoreDetails title=\"Feature 1\" feature={feature1} />\n      <BaseCoreDetails title=\"Feature 2\" feature={feature2} />\n      <BaseAttributes title=\"Feature 1 attributes\" feature={feature1} />\n      <BaseAttributes title=\"Feature 2 attributes\" feature={feature2} />\n    </Paper>\n  )\n}\nAlignmentFeatureDetails.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n\nexport default observer(AlignmentFeatureDetails)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nconst configSchema = ConfigurationSchema('BreakpointAlignmentsWidget', {})\n\nconst stateModel = types\n  .model('BreakpointAlignmentsWidget', {\n    id: ElementId,\n    type: types.literal('BreakpointAlignmentsWidget'),\n    featureData: types.frozen({}),\n  })\n  .actions(self => ({\n    setFeatureData(data) {\n      self.featureData = data\n    },\n    clearFeatureData() {\n      self.featureData = {}\n    },\n  }))\n\nexport { configSchema, stateModel }\nexport { default as ReactComponent } from './BreakpointAlignmentsFeatureDetail'\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { MenuItem } from '@jbrowse/core/ui'\nimport CompositeMap from '@jbrowse/core/util/compositeMap'\nimport { LinearGenomeViewStateModel } from '@jbrowse/plugin-linear-genome-view'\nimport { types, Instance } from 'mobx-state-tree'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport intersection from 'array-intersection'\nimport isObject from 'is-object'\n\nexport const VIEW_DIVIDER_HEIGHT = 3\n\nexport interface Breakend {\n  MateDirection: string\n  Join: string\n  Replacement: string\n  MatePosition: string\n}\n\nexport type LayoutRecord = [number, number, number, number]\n\nexport default function stateModelFactory(pluginManager: any) {\n  const { jbrequire } = pluginManager\n  const {\n    types: jbrequiredTypes,\n    getParent,\n    onAction,\n    addDisposer,\n    getPath,\n  } = jbrequire('mobx-state-tree')\n  const { BaseViewModel } = jbrequire(\n    '@jbrowse/core/pluggableElementTypes/models',\n  )\n\n  const minHeight = 40\n  const defaultHeight = 400\n  const model = (jbrequiredTypes as Instance<typeof types>)\n    .model('BreakpointSplitView', {\n      type: types.literal('BreakpointSplitView'),\n      headerHeight: 0,\n      height: types.optional(\n        types.refinement(\n          'viewHeight',\n          types.number,\n          (n: number) => n >= minHeight,\n        ),\n        defaultHeight,\n      ),\n      trackSelectorType: 'hierarchical',\n      showIntraviewLinks: true,\n      linkViews: false,\n      interactToggled: false,\n      views: types.array(\n        pluginManager.getViewType('LinearGenomeView')\n          .stateModel as LinearGenomeViewStateModel,\n      ),\n    })\n    .volatile(() => ({\n      width: 800,\n    }))\n    .views(self => ({\n      // Find all track ids that match across multiple views\n      get matchedTracks(): string[] {\n        const viewTracks = self.views.map(view =>\n          view.tracks.map(t => t.configuration.trackId),\n        )\n        return intersection(...viewTracks)\n      },\n\n      get menuItems(): MenuItem[] {\n        const menuItems: MenuItem[] = []\n        self.views.forEach((view, idx) => {\n          if (view.menuItems) {\n            menuItems.push({\n              label: `View ${idx + 1} Menu`,\n              subMenu: view.menuItems,\n            })\n          }\n        })\n        return menuItems\n      },\n\n      get viewDividerHeight() {\n        return VIEW_DIVIDER_HEIGHT\n      },\n\n      // Get tracks with a given trackId across multiple views\n      getMatchedTracks(trackConfigId: string) {\n        return self.views\n          .map(view => view.getTrack(trackConfigId))\n          .filter(f => !!f)\n      },\n\n      // Paired reads are handled slightly differently than split reads\n      hasPairedReads(trackConfigId: string) {\n        return this.getTrackFeatures(trackConfigId).find(f =>\n          f.get('multi_segment_first'),\n        )\n      },\n\n      // Translocation features are handled differently\n      // since they do not have a mate e.g. they are one sided\n      hasTranslocations(trackConfigId: string) {\n        return this.getTrackFeatures(trackConfigId).find(\n          f => f.get('type') === 'translocation',\n        )\n      },\n\n      // Get a composite map of featureId->feature map for a track\n      // across multiple views\n      getTrackFeatures(trackConfigId: string) {\n        const tracks = this.getMatchedTracks(trackConfigId)\n        return new CompositeMap<string, Feature>(\n          (tracks || []).map(t => t.displays[0].features),\n        )\n      },\n\n      // Getting \"matched\" TRA means just return all TRA\n      getMatchedTranslocationFeatures(trackId: string) {\n        const features = this.getTrackFeatures(trackId)\n        const feats: Feature[][] = []\n        const alreadySeen = new Set<string>()\n\n        for (const f of features.values()) {\n          if (!alreadySeen.has(f.id())) {\n            if (f.get('ALT')[0] === '<TRA>') {\n              feats.push([f])\n            }\n          }\n          alreadySeen.add(f.id())\n        }\n\n        return feats\n      },\n\n      // Returns paired BND features across multiple views by inspecting\n      // the ALT field to get exact coordinate matches\n      getMatchedBreakendFeatures(trackId: string) {\n        const features = this.getTrackFeatures(trackId)\n        const candidates: Record<string, Feature[]> = {}\n        const alreadySeen = new Set<string>()\n\n        for (const f of features.values()) {\n          if (!alreadySeen.has(f.id())) {\n            if (f.get('type') === 'breakend') {\n              f.get('ALT').forEach((a: Breakend | string) => {\n                const cur = `${f.get('refName')}:${f.get('start') + 1}`\n                if (isObject(a)) {\n                  const alt = a as Breakend\n                  if (!candidates[cur]) {\n                    candidates[alt.MatePosition] = [f]\n                  } else {\n                    candidates[cur].push(f)\n                  }\n                }\n              })\n            }\n          }\n          alreadySeen.add(f.id())\n        }\n\n        return Object.values(candidates).filter(v => v.length > 1)\n      },\n\n      // this finds candidate alignment features, aimed at plotting split reads\n      // from BAM/CRAM files\n      getMatchedAlignmentFeatures(trackId: string) {\n        const features = this.getTrackFeatures(trackId)\n        const candidates: Record<string, Feature[]> = {}\n        const alreadySeen = new Set<string>()\n\n        // this finds candidate features that share the same name\n        for (const feature of features.values()) {\n          if (!alreadySeen.has(feature.id()) && !feature.get('unmapped')) {\n            const n = feature.get('name')\n            if (!candidates[n]) {\n              candidates[n] = []\n            }\n            candidates[n].push(feature)\n          }\n          alreadySeen.add(feature.id())\n        }\n\n        return Object.values(candidates).filter(v => v.length > 1)\n      },\n\n      // this finds candidate alignment features, aimed at plotting split reads\n      // from BAM/CRAM files\n      getBadlyPairedAlignments(trackId: string) {\n        const features = this.getTrackFeatures(trackId)\n        const candidates: Record<string, Feature[]> = {}\n        const alreadySeen = new Set<string>()\n\n        // this finds candidate features that share the same name\n        for (const feature of features.values()) {\n          if (\n            !alreadySeen.has(feature.id()) &&\n            !feature.get('multi_segment_all_correctly_aligned') &&\n            !feature.get('unmapped')\n          ) {\n            const n = feature.get('name')\n            if (!candidates[n]) {\n              candidates[n] = []\n            }\n            candidates[n].push(feature)\n          }\n          alreadySeen.add(feature.id())\n        }\n\n        return Object.values(candidates).filter(v => v.length > 1)\n      },\n\n      getMatchedFeaturesInLayout(trackConfigId: string, features: Feature[][]) {\n        const tracks = this.getMatchedTracks(trackConfigId)\n        return features.map(c =>\n          c.map((feature: Feature) => {\n            let layout: LayoutRecord | undefined\n            const level = tracks.findIndex(track => {\n              layout = track.displays[0].layoutFeatures.get(feature.id())\n              return layout\n            })\n            return {\n              feature,\n              layout,\n              level,\n            }\n          }),\n        )\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          onAction(\n            self,\n            ({\n              name,\n              path,\n              args,\n            }: {\n              name: string\n              path: string\n              args: any[]\n            }) => {\n              if (self.linkViews) {\n                const actions = [\n                  'horizontalScroll',\n                  'zoomTo',\n                  'setScaleFactor',\n                  'showTrack',\n                  'toggleTrack',\n                  'hideTrack',\n                  'setTrackLabels',\n                  'toggleCenterLine',\n                ]\n                if (actions.includes(name) && path) {\n                  this.onSubviewAction(name, path, args)\n                }\n              }\n            },\n          ),\n        )\n      },\n\n      onSubviewAction(actionName: string, path: string, args: any[]) {\n        self.views.forEach(view => {\n          const ret = getPath(view)\n          if (ret.lastIndexOf(path) !== ret.length - path.length) {\n            // @ts-ignore\n            view[actionName](args[0])\n          }\n        })\n      },\n\n      setWidth(newWidth: number) {\n        self.width = newWidth\n        self.views.forEach(v => v.setWidth(newWidth))\n      },\n\n      removeView(view: Instance<LinearGenomeViewStateModel>) {\n        self.views.remove(view)\n      },\n\n      closeView() {\n        getParent(self, 2).removeView(self)\n      },\n\n      setHeaderHeight(height: number) {\n        self.headerHeight = height\n      },\n\n      toggleInteract() {\n        self.interactToggled = !self.interactToggled\n      },\n      toggleIntraviewLinks() {\n        self.showIntraviewLinks = !self.showIntraviewLinks\n      },\n      toggleLinkViews() {\n        self.linkViews = !self.linkViews\n      },\n    }))\n\n  const stateModel = (jbrequiredTypes as typeof types).compose(\n    BaseViewModel,\n    model,\n  )\n\n  return { stateModel }\n}\n\nexport type BreakpointView = ReturnType<typeof stateModelFactory>\nexport type BreakpointViewStateModel = BreakpointView['stateModel']\nexport type BreakpointViewModel = Instance<BreakpointViewStateModel>\n","import { useState, useEffect } from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport { LinearGenomeViewStateModel } from '@jbrowse/plugin-linear-genome-view'\nimport { clamp } from '@jbrowse/core/util'\nimport { LayoutRecord } from './model'\n\nconst [, TOP, , BOTTOM] = [0, 1, 2, 3]\n\nfunction cheight(chunk: LayoutRecord) {\n  return chunk[BOTTOM] - chunk[TOP]\n}\nfunction heightFromSpecificLevel(\n  views: Instance<LinearGenomeViewStateModel>[],\n  trackConfigId: string,\n  level: number,\n) {\n  return views[level].trackRefs[trackConfigId].getBoundingClientRect().top\n}\n\nexport function getPxFromCoordinate(\n  view: Instance<LinearGenomeViewStateModel>,\n  refName: string,\n  coord: number,\n) {\n  return ((view.bpToPx({ refName, coord }) || {}).offsetPx || 0) - view.offsetPx\n}\n\n// get's the yposition of a layout record in a track\nexport function yPos(\n  trackConfigId: string,\n  level: number,\n  views: Instance<LinearGenomeViewStateModel>[],\n  tracks: {\n    displays: [\n      {\n        height: number\n        scrollTop: number\n        SNPCoverageDisplay?: { height: number }\n        showCoverage?: boolean\n      },\n    ]\n  }[], // basic track requirements\n  c: LayoutRecord,\n) {\n  const display = tracks[level].displays[0]\n  const min = 0\n  const max = display.height\n  let offset = 0\n  const { showCoverage, SNPCoverageDisplay } = display\n  if (SNPCoverageDisplay && showCoverage) {\n    offset = SNPCoverageDisplay.height + 5\n  }\n  return (\n    clamp(c[TOP] - display.scrollTop + cheight(c) / 2 + offset, min, max) +\n    heightFromSpecificLevel(views, trackConfigId, level) +\n    display.scrollTop\n  )\n}\n\n// we combo a useEffect and useState combo to force rerender on snap\n// changing. the setup of this being a useEffect+useState makes it\n// re-render once the useEffect is called, which is generally the\n// \"next frame\". If we removed the below use\nexport const useNextFrame = (variable: unknown) => {\n  const [, setNextFrameState] = useState()\n  useEffect(() => {\n    setNextFrameState(variable)\n  }, [variable])\n}\n","import Path from 'svg-path-generator'\nimport { BreakpointViewModel } from '../model'\nimport { yPos, useNextFrame, getPxFromCoordinate } from '../util'\n\nconst [LEFT, , RIGHT] = [0, 1, 2, 3]\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport default (pluginManager: any) => {\n  const { jbrequire } = pluginManager\n  const { getSession } = jbrequire('@jbrowse/core/util')\n  const { observer } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n  const { useState } = jbrequire('react')\n  const { getSnapshot } = jbrequire('mobx-state-tree')\n\n  return observer(\n    ({\n      model,\n      trackConfigId,\n      parentRef: ref,\n    }: {\n      model: BreakpointViewModel\n      height: number\n      trackConfigId: string\n      parentRef: React.RefObject<SVGSVGElement>\n    }) => {\n      const { views, showIntraviewLinks } = model\n      const session = getSession(model)\n      const snap = getSnapshot(model)\n      useNextFrame(snap)\n\n      const totalFeatures = model.getTrackFeatures(trackConfigId)\n      const features = model.hasPairedReads(trackConfigId)\n        ? model.getBadlyPairedAlignments(trackConfigId)\n        : model.getMatchedAlignmentFeatures(trackConfigId)\n      const layoutMatches = model.getMatchedFeaturesInLayout(\n        trackConfigId,\n        features,\n      )\n      layoutMatches.forEach(m => {\n        m.sort((a, b) => a.feature.get('clipPos') - b.feature.get('clipPos'))\n      })\n      const [mouseoverElt, setMouseoverElt] = useState()\n\n      let yOffset = 0\n      if (ref.current) {\n        const rect = ref.current.getBoundingClientRect()\n        yOffset = rect.top\n      }\n      return (\n        <g\n          stroke=\"#333\"\n          fill=\"none\"\n          data-testid={\n            layoutMatches.length ? `${trackConfigId}-loaded` : trackConfigId\n          }\n        >\n          {layoutMatches.map(chunk => {\n            const ret = []\n            // we follow a path in the list of chunks, not from top to bottom, just in series\n            // following x1,y1 -> x2,y2\n            for (let i = 0; i < chunk.length - 1; i += 1) {\n              const { layout: c1, feature: f1, level: level1 } = chunk[i]\n              const { layout: c2, feature: f2, level: level2 } = chunk[i + 1]\n\n              if (!c1 || !c2) {\n                console.warn('received null layout for a overlay feature')\n                return null\n              }\n\n              // disable rendering connections in a single level\n              if (!showIntraviewLinks && level1 === level2) {\n                return null\n              }\n\n              const x1 = getPxFromCoordinate(\n                views[level1],\n                f1.get('refName'),\n                c1[f1.get('strand') === -1 ? LEFT : RIGHT],\n              )\n              const x2 = getPxFromCoordinate(\n                views[level2],\n                f2.get('refName'),\n                c2[f2.get('strand') === -1 ? RIGHT : LEFT],\n              )\n              const reversed1 = views[level1].pxToBp(x1).reversed\n              const reversed2 = views[level2].pxToBp(x2).reversed\n\n              const tracks = views.map(v => v.getTrack(trackConfigId))\n\n              const y1 =\n                yPos(trackConfigId, level1, views, tracks, c1) - yOffset\n              const y2 =\n                yPos(trackConfigId, level2, views, tracks, c2) - yOffset\n\n              // possible todo: use totalCurveHeight to possibly make alternative squiggle if the S is too small\n              const path = Path()\n                .moveTo(x1, y1)\n                .curveTo(\n                  x1 + 200 * f1.get('strand') * (reversed1 ? -1 : 1),\n                  y1,\n                  x2 - 200 * f2.get('strand') * (reversed2 ? -1 : 1),\n                  y2,\n                  x2,\n                  y2,\n                )\n                .end()\n              const id = `${f1.id()}-${f2.id()}`\n              ret.push(\n                <path\n                  d={path}\n                  key={id}\n                  data-testid=\"r1\"\n                  strokeWidth={mouseoverElt === id ? 5 : 1}\n                  onClick={() => {\n                    const featureWidget = session.addWidget(\n                      'BreakpointAlignmentsWidget',\n                      'breakpointAlignments',\n                      {\n                        featureData: {\n                          feature1: (\n                            totalFeatures.get(f1.id()) || { toJSON: () => {} }\n                          ).toJSON(),\n                          feature2: (\n                            totalFeatures.get(f2.id()) || { toJSON: () => {} }\n                          ).toJSON(),\n                        },\n                      },\n                    )\n                    session.showWidget(featureWidget)\n                  }}\n                  onMouseOver={() => setMouseoverElt(id)}\n                  onMouseOut={() => setMouseoverElt(undefined)}\n                />,\n              )\n            }\n            return ret\n          })}\n        </g>\n      )\n    },\n  )\n}\n","import Path from 'svg-path-generator'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { BreakpointViewModel, Breakend } from '../model'\nimport { yPos, getPxFromCoordinate, useNextFrame } from '../util'\n\nconst [LEFT] = [0, 1, 2, 3]\n\nfunction findMatchingAlt(feat1: Feature, feat2: Feature) {\n  const candidates: Record<string, Breakend> = {}\n  feat1.get('ALT').forEach((alt: Breakend) => {\n    candidates[alt.MatePosition] = alt\n  })\n  return candidates[`${feat2.get('refName')}:${feat2.get('start') + 1}`]\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport default (pluginManager: any) => {\n  const { jbrequire } = pluginManager\n  const { observer } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n  const { useState } = jbrequire('react')\n  const { getSnapshot } = jbrequire('mobx-state-tree')\n\n  return observer(\n    ({\n      model,\n      trackConfigId,\n      parentRef: ref,\n    }: {\n      model: BreakpointViewModel\n      height: number\n      trackConfigId: string\n      parentRef: React.RefObject<SVGSVGElement>\n    }) => {\n      const { views } = model\n      const features = model.getMatchedBreakendFeatures(trackConfigId)\n      const layoutMatches = model.getMatchedFeaturesInLayout(\n        trackConfigId,\n        features,\n      )\n      const [mouseoverElt, setMouseoverElt] = useState()\n      const snap = getSnapshot(model)\n      useNextFrame(snap)\n\n      let yOffset = 0\n      if (ref.current) {\n        const rect = ref.current.getBoundingClientRect()\n        yOffset = rect.top\n      }\n      return (\n        <g\n          stroke=\"green\"\n          strokeWidth={5}\n          fill=\"none\"\n          data-testid={\n            layoutMatches.length ? `${trackConfigId}-loaded` : trackConfigId\n          }\n        >\n          {layoutMatches.map(chunk => {\n            const ret = []\n            // we follow a path in the list of chunks, not from top to bottom, just in series\n            // following x1,y1 -> x2,y2\n            for (let i = 0; i < chunk.length - 1; i += 1) {\n              const { layout: c1, feature: f1, level: level1 } = chunk[i]\n              const { layout: c2, feature: f2, level: level2 } = chunk[i + 1]\n              const id = `${f1.id()}-${f2.id()}`\n              const relevantAlt = findMatchingAlt(f1, f2)\n              if (!c1 || !c2) return null\n              const x1 = getPxFromCoordinate(\n                views[level1],\n                f1.get('refName'),\n                c1[LEFT],\n              )\n              const x2 = getPxFromCoordinate(\n                views[level2],\n                f2.get('refName'),\n                c2[LEFT],\n              )\n              const reversed1 = views[level1].pxToBp(x1).reversed\n              const reversed2 = views[level2].pxToBp(x2).reversed\n\n              const tracks = views.map(v => v.getTrack(trackConfigId))\n              const y1 =\n                yPos(trackConfigId, level1, views, tracks, c1) - yOffset\n              const y2 =\n                yPos(trackConfigId, level2, views, tracks, c2) - yOffset\n              if (!relevantAlt) {\n                console.warn(\n                  'the relevant ALT allele was not found, cannot render',\n                )\n              } else {\n                const path = Path()\n                  .moveTo(\n                    x1 -\n                      20 *\n                        (relevantAlt.Join === 'left' ? -1 : 1) *\n                        (reversed1 ? -1 : 1),\n                    y1,\n                  )\n                  .lineTo(x1, y1)\n                  .lineTo(x2, y2)\n                  .lineTo(\n                    x2 -\n                      20 *\n                        (relevantAlt.MateDirection === 'left' ? 1 : -1) *\n                        (reversed2 ? -1 : 1),\n                    y2,\n                  )\n                  .end()\n                ret.push(\n                  <path\n                    d={path}\n                    key={JSON.stringify(path)}\n                    strokeWidth={id === mouseoverElt ? 10 : 5}\n                    onMouseOver={() => setMouseoverElt(id)}\n                    onMouseOut={() => setMouseoverElt(undefined)}\n                  />,\n                )\n              }\n            }\n            return ret\n          })}\n        </g>\n      )\n    },\n  )\n}\n","import { withSize } from 'react-sizeme'\nimport LocationSearching from '@material-ui/icons/LocationSearching'\nimport LocationDisabled from '@material-ui/icons/LocationDisabled'\nimport LeakAdd from '@material-ui/icons/LeakAdd'\nimport LeakRemove from '@material-ui/icons/LeakRemove'\nimport LinkIcon from '@material-ui/icons/Link'\nimport LinkOffIcon from '@material-ui/icons/LinkOff'\nimport { BreakpointViewModel } from '../model'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport default ({ jbrequire }: { jbrequire: any }) => {\n  const { observer, PropTypes } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n  const IconButton = jbrequire('@material-ui/core/IconButton')\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const useStyles = makeStyles((theme: any) => ({\n    headerBar: {\n      gridArea: '1/1/auto/span 2',\n      display: 'flex',\n    },\n    spacer: {\n      flexGrow: 1,\n    },\n    emphasis: {\n      background: theme.palette.secondary.main,\n      padding: theme.spacing(1),\n    },\n    hovered: {\n      background: theme.palette.secondary.light,\n    },\n    displayName: {\n      background: theme.palette.secondary.main,\n      paddingTop: 3,\n      paddingLeft: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n    },\n    inputBase: {\n      color: theme.palette.secondary.contrastText,\n    },\n    inputRoot: {\n      '&:hover': {\n        backgroundColor: theme.palette.secondary.light,\n      },\n    },\n    inputFocused: {\n      borderColor: theme.palette.primary.main,\n      backgroundColor: theme.palette.secondary.light,\n    },\n  }))\n\n  const InteractWithSquiggles = observer(\n    ({ model }: { model: BreakpointViewModel }) => {\n      const classes = useStyles()\n      return (\n        <IconButton\n          onClick={() => model.toggleInteract()}\n          className={classes.iconButton}\n          title=\"Toggle interacting with the overlay\"\n        >\n          {model.interactToggled ? <LocationSearching /> : <LocationDisabled />}\n        </IconButton>\n      )\n    },\n  )\n  InteractWithSquiggles.propTypes = {\n    model: PropTypes.objectOrObservableObject.isRequired,\n  }\n  const LinkViews = observer(({ model }: { model: BreakpointViewModel }) => {\n    const classes = useStyles()\n    return (\n      <IconButton\n        onClick={() => model.toggleLinkViews()}\n        className={classes.iconButton}\n        title=\"Toggle linked scrolls and behavior across views\"\n      >\n        {model.linkViews ? (\n          <LinkIcon color=\"secondary\" />\n        ) : (\n          <LinkOffIcon color=\"secondary\" />\n        )}\n      </IconButton>\n    )\n  })\n  LinkViews.propTypes = {\n    model: PropTypes.objectOrObservableObject.isRequired,\n  }\n  const Sync = observer(({ model }: { model: BreakpointViewModel }) => {\n    const classes = useStyles()\n    return (\n      <IconButton\n        onClick={model.toggleIntraviewLinks}\n        className={classes.iconButton}\n        title=\"Toggle rendering intraview links\"\n      >\n        {model.showIntraviewLinks ? (\n          <LeakAdd color=\"secondary\" />\n        ) : (\n          <LeakRemove color=\"secondary\" />\n        )}\n      </IconButton>\n    )\n  })\n  Sync.propTypes = {\n    model: PropTypes.objectOrObservableObject.isRequired,\n  }\n  const Header = observer(\n    ({\n      model,\n      size,\n    }: {\n      model: BreakpointViewModel\n      size: { height: number }\n    }) => {\n      const classes = useStyles()\n\n      model.setHeaderHeight(size.height)\n      return (\n        <div className={classes.headerBar}>\n          <LinkViews model={model} />\n          <InteractWithSquiggles model={model} />\n          <Sync model={model} />\n\n          <div className={classes.spacer} />\n        </div>\n      )\n    },\n  )\n\n  Header.propTypes = {\n    model: PropTypes.objectOrObservableObject.isRequired,\n  }\n\n  return withSize({ monitorHeight: true })(Header)\n}\n","import Path from 'svg-path-generator'\nimport { BreakpointViewModel, LayoutRecord } from '../model'\nimport { yPos, getPxFromCoordinate, useNextFrame } from '../util'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport default (pluginManager: any) => {\n  const { jbrequire } = pluginManager\n  const { getSession } = jbrequire('@jbrowse/core/util')\n  const { observer } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n  const { useState } = jbrequire('react')\n  const { getSnapshot } = jbrequire('mobx-state-tree')\n\n  const [LEFT] = [0, 1, 2, 3]\n\n  return observer(\n    ({\n      model,\n      trackConfigId,\n      parentRef: ref,\n    }: {\n      model: BreakpointViewModel\n      height: number\n      trackConfigId: string\n      parentRef: React.RefObject<SVGSVGElement>\n    }) => {\n      const { views } = model\n      const session = getSession(model)\n      const features = model.getMatchedTranslocationFeatures(trackConfigId)\n      const totalFeatures = model.getTrackFeatures(trackConfigId)\n      const layoutMatches = model.getMatchedFeaturesInLayout(\n        trackConfigId,\n        features,\n      )\n      const [mouseoverElt, setMouseoverElt] = useState()\n      const snap = getSnapshot(model)\n      useNextFrame(snap)\n\n      let yOffset = 0\n      if (ref.current) {\n        const rect = ref.current.getBoundingClientRect()\n        yOffset = rect.top\n      }\n\n      // we hardcode the TRA to go to the \"other view\" and\n      // if there is none, we just return null here\n      // note: would need to do processing of the INFO CHR2/END\n      // and see which view could contain those coordinates\n      // to really do it properly\n      if (views.length < 2) {\n        return null\n      }\n      return (\n        <g\n          fill=\"none\"\n          stroke=\"green\"\n          strokeWidth={5}\n          data-testid={\n            layoutMatches.length ? `${trackConfigId}-loaded` : trackConfigId\n          }\n        >\n          {layoutMatches.map(chunk => {\n            // we follow a path in the list of chunks, not from top to bottom, just in series\n            // following x1,y1 -> x2,y2\n            const ret = []\n            for (let i = 0; i < chunk.length; i += 1) {\n              const { layout: c1, feature: f1, level: level1 } = chunk[i]\n              const level2 = level1 === 0 ? 1 : 0\n              const id = f1.id()\n              if (!c1) return null\n\n              const info = f1.get('INFO')\n              const chr2 = info.CHR2[0]\n              const end2 = info.END[0]\n              const [myDirection, mateDirection] = info.STRANDS[0].split('')\n\n              const r = getPxFromCoordinate(views[level2], chr2, end2)\n              if (r) {\n                const c2: LayoutRecord = [r, 0, r + 1, 0]\n\n                const x1 = getPxFromCoordinate(\n                  views[level1],\n                  f1.get('refName'),\n                  c1[LEFT],\n                )\n                const x2 = r\n                const reversed1 = views[level1].pxToBp(x1).reversed\n                const reversed2 = views[level2].pxToBp(x2).reversed\n\n                const tracks = views.map(v => v.getTrack(trackConfigId))\n                const y1 =\n                  yPos(trackConfigId, level1, views, tracks, c1) - yOffset\n                const y2 =\n                  yPos(trackConfigId, level2, views, tracks, c2) - yOffset\n\n                const path = Path()\n                  .moveTo(\n                    x1 -\n                      20 *\n                        (myDirection === '+' ? 1 : -1) *\n                        (reversed1 ? -1 : 1),\n                    y1,\n                  )\n                  .lineTo(x1, y1)\n                  .lineTo(x2, y2)\n                  .lineTo(\n                    x2 -\n                      20 *\n                        (mateDirection === '+' ? 1 : -1) *\n                        (reversed2 ? -1 : 1),\n                    y2,\n                  )\n                  .end()\n                ret.push(\n                  <path\n                    d={path}\n                    key={JSON.stringify(path)}\n                    strokeWidth={id === mouseoverElt ? 10 : 5}\n                    onClick={() => {\n                      const featureWidget = session.addWidget(\n                        'VariantFeatureWidget',\n                        'variantFeature',\n                        {\n                          featureData: (\n                            totalFeatures.get(id) || { toJSON: () => {} }\n                          ).toJSON(),\n                        },\n                      )\n                      session.showWidget(featureWidget)\n                    }}\n                    onMouseOver={() => setMouseoverElt(id)}\n                    onMouseOut={() => setMouseoverElt(undefined)}\n                  />,\n                )\n              }\n            }\n            return ret\n          })}\n        </g>\n      )\n    },\n  )\n}\n","import { makeStyles } from '@material-ui/core/styles'\nimport { BreakpointViewModel, VIEW_DIVIDER_HEIGHT } from '../model'\nimport AlignmentConnectionsFactory from './AlignmentConnections'\nimport BreakendsFactory from './Breakends'\nimport HeaderFactory from './Header'\nimport TranslocationsFactory from './Translocations'\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport default (pluginManager: any) => {\n  const { jbrequire } = pluginManager\n  const { observer, PropTypes } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n  const { useRef } = React\n  const { makeStyles: jbrequiredMakeStyles } = jbrequire(\n    '@material-ui/core/styles',\n  )\n\n  const AlignmentConnections = jbrequire(AlignmentConnectionsFactory)\n  const Breakends = jbrequire(BreakendsFactory)\n  const Translocations = jbrequire(TranslocationsFactory)\n\n  const Header = jbrequire(HeaderFactory)\n\n  const useStyles = (jbrequiredMakeStyles as typeof makeStyles)(theme => {\n    return {\n      root: {\n        position: 'relative',\n        marginBottom: theme.spacing(1),\n        overflow: 'hidden',\n      },\n      breakpointMarker: {\n        position: 'absolute',\n        top: 0,\n        height: '100%',\n        width: '3px',\n        background: 'magenta',\n      },\n      viewDivider: {\n        background: theme.palette.secondary.main,\n        height: VIEW_DIVIDER_HEIGHT,\n      },\n      container: {\n        display: 'grid',\n      },\n      overlay: {\n        display: 'flex',\n        width: '100%',\n        gridArea: '1/1',\n        '& path': {\n          cursor: 'crosshair',\n          fill: 'none',\n        },\n      },\n      content: {\n        gridArea: '1/1',\n      },\n    }\n  })\n\n  const Overlay = observer(\n    (props: { model: BreakpointViewModel; trackConfigId: string }) => {\n      const { model, trackConfigId } = props\n      const tracks = model.getMatchedTracks(trackConfigId)\n      if (\n        tracks[0].type === 'PileupTrack' ||\n        tracks[0].type === 'AlignmentsTrack'\n      ) {\n        return <AlignmentConnections {...props} />\n      }\n      if (tracks[0].type === 'VariantTrack') {\n        return model.hasTranslocations(trackConfigId) ? (\n          <Translocations {...props} />\n        ) : (\n          <Breakends {...props} />\n        )\n      }\n      return null\n    },\n  )\n\n  const BreakpointSplitView = observer(\n    ({ model }: { model: BreakpointViewModel }) => {\n      const classes = useStyles()\n      const { views } = model\n      const ref = useRef(null)\n\n      return (\n        <div>\n          <Header model={model} />\n          <div className={classes.container}>\n            <div className={classes.content}>\n              <div style={{ position: 'relative' }}>\n                {views.map((view, idx) => {\n                  const { ReactComponent } = pluginManager.getViewType(\n                    view.type,\n                  )\n                  const viewComponent = (\n                    <ReactComponent key={view.id} model={view} />\n                  )\n                  if (idx === views.length - 1) {\n                    return viewComponent\n                  }\n                  return [\n                    viewComponent,\n                    <div\n                      key={`${view.id}-divider`}\n                      className={classes.viewDivider}\n                    />,\n                  ]\n                })}\n              </div>\n            </div>\n            <div className={classes.overlay}>\n              <svg\n                ref={ref}\n                style={{\n                  width: '100%',\n                  zIndex: 10,\n                  pointerEvents: model.interactToggled ? undefined : 'none',\n                }}\n              >\n                {model.matchedTracks.map(id => {\n                  // note: we must pass ref down, because the child component\n                  // needs to getBoundingClientRect on the this components SVG,\n                  // and we cannot rely on using getBoundingClientRect in this\n                  // component to make sure this works because if it gets\n                  // shifted around by another element, this will not re-render\n                  // necessarily\n                  return (\n                    <Overlay\n                      parentRef={ref}\n                      key={id}\n                      model={model}\n                      trackConfigId={id}\n                    />\n                  )\n                })}\n              </svg>\n            </div>\n          </div>\n        </div>\n      )\n    },\n  )\n  BreakpointSplitView.propTypes = {\n    model: PropTypes.objectOrObservableObject.isRequired,\n  }\n  return BreakpointSplitView\n}\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { getSession } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport { Assembly } from '@jbrowse/core/assemblyManager/assembly'\nimport BreakpointSplitViewComponent from './components/BreakpointSplitView'\nimport BreakpointSplitViewModel from './model'\n\nclass BreakpointSplitViewType extends ViewType {\n  snapshotFromBreakendFeature(feature: Feature, view: LinearGenomeViewModel) {\n    const breakendSpecification = (feature.get('ALT') || [])[0]\n    const startPos = feature.get('start')\n    let endPos\n    const bpPerPx = 10\n\n    // TODO: Figure this out for multiple assembly names\n    const { assemblyName } = view.displayedRegions[0]\n    const assembly = getSession(view).assemblyManager.get(assemblyName)\n    const { getCanonicalRefName } = assembly as Assembly\n    const featureRefName = getCanonicalRefName(feature.get('refName'))\n\n    const topRegion = view.displayedRegions.find(\n      f => f.refName === String(featureRefName),\n    )\n\n    let mateRefName: string | undefined\n    let startMod = 0\n    let endMod = 0\n\n    if (breakendSpecification) {\n      // a VCF breakend feature\n      if (breakendSpecification === '<TRA>') {\n        const INFO = feature.get('INFO') || []\n        endPos = INFO.END[0] - 1\n        mateRefName = getCanonicalRefName(INFO.CHR2[0])\n      } else {\n        const matePosition = breakendSpecification.MatePosition.split(':')\n        endPos = parseInt(matePosition[1], 10) - 1\n        mateRefName = getCanonicalRefName(matePosition[0])\n        if (breakendSpecification.Join === 'left') startMod = -1\n        if (breakendSpecification.MateDirection === 'left') endMod = -1\n      }\n\n      // if (breakendSpecification.Join === 'left') {\n      // marker -1, else 0\n\n      // if (breakendSpecification.MateDirection === 'left') {\n      // marker -1, else 0\n    } else if (feature.get('mate')) {\n      // a generic 'mate' feature\n      const mate = feature.get('mate')\n      mateRefName = getCanonicalRefName(mate.refName)\n      endPos = mate.start\n    }\n\n    if (!mateRefName) {\n      console.warn(\n        `unable to resolve mate refName ${mateRefName} in reference genome`,\n      )\n      return {}\n    }\n\n    const bottomRegion = view.displayedRegions.find(\n      f => f.refName === String(mateRefName),\n    )\n\n    if (!topRegion || !bottomRegion) {\n      console.warn(\n        `unable to find the refName for the top or bottom of the breakpoint view`,\n      )\n      return {}\n    }\n\n    const topMarkedRegion = [{ ...topRegion }, { ...topRegion }]\n    const bottomMarkedRegion = [{ ...bottomRegion }, { ...bottomRegion }]\n    topMarkedRegion[0].end = startPos + startMod\n    topMarkedRegion[1].start = startPos + startMod\n    bottomMarkedRegion[0].end = endPos + endMod\n    bottomMarkedRegion[1].start = endPos + endMod\n    const snapshot = {\n      type: 'BreakpointSplitView',\n      views: [\n        {\n          type: 'LinearGenomeView',\n          displayedRegions: topMarkedRegion,\n          hideHeader: true,\n          bpPerPx,\n          offsetPx: (topRegion.start + feature.get('start')) / bpPerPx,\n        },\n        {\n          type: 'LinearGenomeView',\n          displayedRegions: bottomMarkedRegion,\n          hideHeader: true,\n          bpPerPx,\n          offsetPx: (bottomRegion.start + endPos) / bpPerPx,\n        },\n      ],\n      displayName: `${\n        feature.get('name') || feature.get('id') || 'breakend'\n      } split detail`,\n    }\n    return snapshot\n  }\n}\n\nexport default (pluginManager: PluginManager) => {\n  const { load } = pluginManager\n\n  const ReactComponent = load(BreakpointSplitViewComponent)\n  const { stateModel } = load(BreakpointSplitViewModel)\n\n  return new BreakpointSplitViewType({\n    name: 'BreakpointSplitView',\n    stateModel,\n    ReactComponent,\n  })\n}\n","import WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport {\n  configSchema as alignmentsFeatureDetailConfigSchema,\n  ReactComponent as AlignmentsFeatureDetailReactComponent,\n  stateModel as alignmentsFeatureDetailStateModel,\n} from './BreakpointAlignmentsFeatureDetail'\nimport BreakpointSplitViewFactory from './BreakpointSplitView'\n\nexport default class BreakpointSplitViewPlugin extends Plugin {\n  name = 'BreakpointSplitViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() =>\n      pluginManager.jbrequire(BreakpointSplitViewFactory),\n    )\n    pluginManager.addWidgetType(\n      () =>\n        new WidgetType({\n          name: 'BreakpointAlignmentsWidget',\n          heading: 'Breakpoint Feature Details',\n          configSchema: alignmentsFeatureDetailConfigSchema,\n          stateModel: alignmentsFeatureDetailStateModel,\n          ReactComponent: AlignmentsFeatureDetailReactComponent,\n        }),\n    )\n  }\n\n  configure() {}\n}\n","export default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { observer } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n  const { getSession } = jbrequire('@jbrowse/core/util')\n  const { makeContrasting } = jbrequire('@jbrowse/core/util/color')\n  const { makeStyles, useTheme } = jbrequire('@material-ui/core/styles')\n  const { polarToCartesian, radToDeg, assembleLocString } = jbrequire(\n    '@jbrowse/core/util',\n  )\n\n  const useStyles = makeStyles({\n    rulerLabel: {\n      fontSize: '0.8rem',\n      fontWeight: 500,\n      lineHeight: 1.6,\n      letterSpacing: '0.0075em',\n    },\n  })\n\n  function sliceArcPath(slice, radiusPx, startBase, endBase) {\n    // A rx ry x-axis-rotation large-arc-flag sweep-flag x y\n    if (slice.flipped) [startBase, endBase] = [endBase, startBase]\n    const startXY = slice.bpToXY(startBase, radiusPx)\n    const endXY = slice.bpToXY(endBase, radiusPx)\n    const largeArc =\n      Math.abs(endBase - startBase) / slice.bpPerRadian > Math.PI ? '1' : '0'\n    const sweepFlag = '1'\n    return [\n      'M',\n      ...startXY,\n      'A',\n      radiusPx,\n      radiusPx,\n      '0',\n      largeArc,\n      sweepFlag,\n      ...endXY,\n    ].join(' ')\n  }\n\n  const ElisionRulerArc = observer(({ model, slice }) => {\n    const theme = useTheme()\n    const { radiusPx: modelRadiusPx } = model\n    const radiusPx = modelRadiusPx + 1\n    const { endRadians, startRadians, region } = slice\n    const startXY = polarToCartesian(radiusPx, startRadians)\n    const endXY = polarToCartesian(radiusPx, endRadians)\n    const widthPx = (endRadians - startRadians) * radiusPx\n    const largeArc = endRadians - startRadians > Math.PI ? '1' : '0'\n    // TODO: draw the elision\n    const centerRadians = (endRadians + startRadians) / 2\n    const regionCountString = `[${Number(\n      region.regions.length,\n    ).toLocaleString()}]`\n    return (\n      <>\n        <RulerLabel\n          text={regionCountString}\n          view={model}\n          maxWidthPx={widthPx}\n          radians={centerRadians}\n          radiusPx={radiusPx}\n          title={`${Number(\n            region.regions.length,\n          ).toLocaleString()} more regions`}\n          color={theme.palette.text.primary}\n        />\n        <path\n          d={[\n            'M',\n            ...startXY,\n            'A',\n            radiusPx,\n            radiusPx,\n            '0',\n            largeArc,\n            '1',\n            ...endXY,\n          ].join(' ')}\n          stroke={theme.palette.text.secondary}\n          strokeWidth={2}\n          strokeDasharray=\"2,2\"\n          fill=\"none\"\n        />\n      </>\n    )\n  })\n\n  const RulerLabel = observer(\n    ({ view, text, maxWidthPx, radians, radiusPx, title, color }) => {\n      const classes = useStyles()\n      const textXY = polarToCartesian(radiusPx + 5, radians)\n      if (!text) return null\n\n      if (text.length * 6.5 < maxWidthPx) {\n        // text is rotated parallel to the ruler arc\n        return (\n          <text\n            x={0}\n            y={0}\n            className={classes.rulerLabel}\n            textAnchor=\"middle\"\n            dominantBaseline=\"baseline\"\n            transform={`translate(${textXY}) rotate(${radToDeg(radians) + 90})`}\n            style={{ fill: color }}\n          >\n            {text}\n            <title>{title || text}</title>\n          </text>\n        )\n      }\n      if (maxWidthPx > 4) {\n        // text is rotated perpendicular to the ruler arc\n        const overallRotation = radToDeg(\n          radians + view.offsetRadians - Math.PI / 2,\n        )\n        if (overallRotation >= 180) {\n          return (\n            <text\n              x={0}\n              y={0}\n              className={classes.rulerLabel}\n              textAnchor=\"start\"\n              dominantBaseline=\"middle\"\n              transform={`translate(${textXY}) rotate(${radToDeg(radians)})`}\n              style={{ fill: color }}\n            >\n              {text}\n              <title>{title || text}</title>\n            </text>\n          )\n        }\n        return (\n          <text\n            x={0}\n            y={0}\n            className={classes.rulerLabel}\n            textAnchor=\"end\"\n            dominantBaseline=\"middle\"\n            transform={`translate(${textXY}) rotate(${\n              radToDeg(radians) + 180\n            })`}\n            style={{ fill: color }}\n          >\n            {text}\n            <title>{title || text}</title>\n          </text>\n        )\n      }\n\n      // if you get here there is no room for the text at all\n      return null\n    },\n  )\n\n  const RegionRulerArc = observer(({ model, slice }) => {\n    const theme = useTheme()\n    const { radiusPx } = model\n    const { region, endRadians, startRadians } = slice\n    const centerRadians = (endRadians + startRadians) / 2\n    const widthPx = (endRadians - startRadians) * radiusPx\n    const session = getSession(model)\n    let color\n    const assembly = session.assemblyManager.get(slice.region.assemblyName)\n    if (assembly) {\n      color = assembly.getRefNameColor(region.refName)\n    }\n    if (color) {\n      try {\n        color = makeContrasting(color, theme.palette.background.paper)\n      } catch (error) {\n        color = theme.palette.text.primary\n      }\n    } else {\n      color = theme.palette.text.primary\n    }\n\n    // TODO: slice flipping\n    return (\n      <>\n        <RulerLabel\n          text={region.refName}\n          view={model}\n          maxWidthPx={widthPx}\n          radians={centerRadians}\n          radiusPx={radiusPx}\n          color={color}\n        />\n        <path\n          d={sliceArcPath(slice, radiusPx + 1, region.start, region.end)}\n          stroke={color}\n          strokeWidth={2}\n          fill=\"none\"\n        >\n          <title>{region.refName}</title>\n        </path>\n      </>\n    )\n  })\n\n  const Ruler = observer(function Ruler({ model, slice }) {\n    if (slice.region.elided) {\n      return (\n        <ElisionRulerArc\n          key={assembleLocString(slice.region.regions[0])}\n          model={model}\n          slice={slice}\n        />\n      )\n    }\n    return (\n      <RegionRulerArc\n        key={assembleLocString(slice.region)}\n        model={model}\n        slice={slice}\n      />\n    )\n  })\n\n  return Ruler\n}\n","import ZoomOut from '@material-ui/icons/ZoomOut'\nimport ZoomIn from '@material-ui/icons/ZoomIn'\nimport RotateLeft from '@material-ui/icons/RotateLeft'\nimport RotateRight from '@material-ui/icons/RotateRight'\nimport LockOutline from '@material-ui/icons/LockOutlined'\nimport LockOpen from '@material-ui/icons/LockOpen'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport RulerFactory from './Ruler'\n\nconst dragHandleHeight = 3\n\nexport default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { observer, PropTypes } = jbrequire('mobx-react')\n  const { getSnapshot } = jbrequire('mobx-state-tree')\n  const React = jbrequire('react')\n  const { useState } = jbrequire('react')\n\n  // material-ui stuff\n  const Button = jbrequire('@material-ui/core/Button')\n  const Container = jbrequire('@material-ui/core/Container')\n  const Grid = jbrequire('@material-ui/core/Grid')\n  const IconButton = jbrequire('@material-ui/core/IconButton')\n  const MenuItem = jbrequire('@material-ui/core/MenuItem')\n  const TextField = jbrequire('@material-ui/core/TextField')\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const { grey } = jbrequire('@material-ui/core/colors')\n\n  const { ResizeHandle } = jbrequire('@jbrowse/core/ui')\n  const { assembleLocString, getSession } = jbrequire('@jbrowse/core/util')\n  const Ruler = jbrequire(RulerFactory)\n\n  const useStyles = makeStyles(theme => {\n    return {\n      root: {\n        position: 'relative',\n        marginBottom: theme.spacing(1),\n        overflow: 'hidden',\n        background: 'white',\n      },\n      scroller: {\n        overflow: 'auto',\n      },\n      sliceRoot: {\n        background: 'none',\n        // background: theme.palette.background.paper,\n        boxSizing: 'content-box',\n        display: 'block',\n      },\n      iconButton: {\n        padding: '4px',\n        margin: '0 2px 0 2px',\n      },\n      controls: {\n        overflow: 'hidden',\n        whiteSpace: 'nowrap',\n        position: 'absolute',\n        background: grey[200],\n        boxSizing: 'border-box',\n        borderRight: '1px solid #a2a2a2',\n        borderBottom: '1px solid #a2a2a2',\n        left: 0,\n        top: 0,\n      },\n      importFormContainer: {\n        marginBottom: theme.spacing(4),\n      },\n    }\n  })\n\n  const Slices = observer(({ model }) => {\n    return (\n      <>\n        <>\n          {model.staticSlices.map(slice => {\n            return (\n              <Ruler\n                key={assembleLocString(\n                  slice.region.elided ? slice.region.regions[0] : slice.region,\n                )}\n                model={model}\n                slice={slice}\n              />\n            )\n          })}\n        </>\n        <>\n          {model.tracks.map(track => {\n            const display = track.displays[0]\n            return (\n              <display.RenderingComponent\n                key={display.id}\n                display={display}\n                view={model}\n              />\n            )\n          })}\n        </>\n      </>\n    )\n  })\n\n  const Controls = observer(({ model, showingFigure }) => {\n    const classes = useStyles()\n    return (\n      <div className={classes.controls}>\n        <IconButton\n          onClick={model.zoomOutButton}\n          className={classes.iconButton}\n          title={model.lockedFitToWindow ? 'unlock to zoom out' : 'zoom out'}\n          disabled={\n            !showingFigure || model.atMaxBpPerPx || model.lockedFitToWindow\n          }\n          color=\"secondary\"\n        >\n          <ZoomOut />\n        </IconButton>\n\n        <IconButton\n          onClick={model.zoomInButton}\n          className={classes.iconButton}\n          title=\"zoom in\"\n          disabled={!showingFigure || model.atMinBpPerPx}\n          color=\"secondary\"\n        >\n          <ZoomIn />\n        </IconButton>\n\n        <IconButton\n          onClick={model.rotateCounterClockwiseButton}\n          className={classes.iconButton}\n          title=\"rotate counter-clockwise\"\n          disabled={!showingFigure}\n          color=\"secondary\"\n        >\n          <RotateLeft />\n        </IconButton>\n\n        <IconButton\n          onClick={model.rotateClockwiseButton}\n          className={classes.iconButton}\n          title=\"rotate clockwise\"\n          disabled={!showingFigure}\n          color=\"secondary\"\n        >\n          <RotateRight />\n        </IconButton>\n\n        <IconButton\n          onClick={model.toggleFitToWindowLock}\n          className={classes.iconButton}\n          title={\n            model.lockedFitToWindow\n              ? 'locked model to window size'\n              : 'unlocked model to zoom further'\n          }\n          disabled={model.tooSmallToLock}\n          color=\"secondary\"\n        >\n          {model.lockedFitToWindow ? <LockOutline /> : <LockOpen />}\n        </IconButton>\n\n        {model.hideTrackSelectorButton ? null : (\n          <IconButton\n            onClick={model.activateTrackSelector}\n            title=\"Open track selector\"\n            data-testid=\"circular_track_select\"\n            color=\"secondary\"\n          >\n            <TrackSelectorIcon />\n          </IconButton>\n        )}\n      </div>\n    )\n  })\n\n  const ImportForm = observer(({ model }) => {\n    const classes = useStyles()\n    const [selectedAssemblyIdx, setSelectedAssemblyIdx] = useState(0)\n    const { assemblyNames, assemblyManager } = getSession(model)\n    const [assemblyError, setAssemblyError] = useState('')\n    if (!assemblyNames.length) {\n      setAssemblyError('No configured assemblies')\n    }\n    const assembly = assemblyManager.get(assemblyNames[selectedAssemblyIdx])\n    const regions =\n      assembly && assembly.regions ? getSnapshot(assembly.regions) : []\n\n    function onAssemblyChange(event) {\n      setSelectedAssemblyIdx(Number(event.target.value))\n    }\n\n    function onOpenClick() {\n      model.setDisplayedRegions(regions)\n    }\n\n    return (\n      <>\n        <Container className={classes.importFormContainer}>\n          <Grid container spacing={1} justify=\"center\" alignItems=\"center\">\n            <Grid item>\n              <TextField\n                select\n                value={\n                  assemblyNames[selectedAssemblyIdx] && !assemblyError\n                    ? selectedAssemblyIdx\n                    : ''\n                }\n                onChange={onAssemblyChange}\n                helperText={assemblyError || 'Select assembly to view'}\n                error={!!assemblyError}\n                disabled={!!assemblyError}\n                margin=\"normal\"\n              >\n                {assemblyNames.map((name, idx) => (\n                  <MenuItem key={name} value={idx}>\n                    {name}\n                  </MenuItem>\n                ))}\n              </TextField>\n            </Grid>\n            <Grid item>\n              <Button\n                disabled={!(regions && regions.length)}\n                onClick={onOpenClick}\n                variant=\"contained\"\n                color=\"primary\"\n              >\n                {regions.length ? 'Open' : 'Loading'}\n              </Button>\n            </Grid>\n          </Grid>\n        </Container>\n      </>\n    )\n  })\n\n  function CircularView({ model }) {\n    const classes = useStyles()\n    const initialized =\n      !!model.displayedRegions.length && model.figureWidth && model.figureHeight\n\n    const showImportForm = !initialized && !model.disableImportForm\n    const showFigure = initialized && !showImportForm\n\n    return (\n      <div\n        className={classes.root}\n        style={{\n          width: model.width,\n          height: model.height,\n        }}\n        data-testid={model.id}\n      >\n        {model.error ? (\n          <p style={{ color: 'red' }}>{model.error.message}</p>\n        ) : (\n          <>\n            {showImportForm ? <ImportForm model={model} /> : null}\n            <>\n              {!showFigure ? null : (\n                <div\n                  className={classes.scroller}\n                  style={{\n                    width: model.width,\n                    height: model.height,\n                  }}\n                >\n                  <div\n                    className={classes.rotator}\n                    style={{\n                      transform: [`rotate(${model.offsetRadians}rad)`].join(\n                        ' ',\n                      ),\n                      transition: 'transform 0.5s',\n                      transformOrigin: model.centerXY\n                        .map(x => `${x}px`)\n                        .join(' '),\n                    }}\n                  >\n                    <svg\n                      style={{\n                        position: 'absolute',\n                        left: 0,\n                        top: 0,\n                      }}\n                      className={classes.sliceRoot}\n                      width={`${model.figureWidth}px`}\n                      height={`${model.figureHeight}px`}\n                      version=\"1.1\"\n                    >\n                      <g transform={`translate(${model.centerXY})`}>\n                        <Slices model={model} />\n                      </g>\n                    </svg>\n                  </div>\n                </div>\n              )}\n              <Controls model={model} showingFigure={showFigure} />\n              {model.hideVerticalResizeHandle ? null : (\n                <ResizeHandle\n                  onDrag={model.resizeHeight}\n                  style={{\n                    height: dragHandleHeight,\n                    position: 'absolute',\n                    bottom: 0,\n                    left: 0,\n                    background: '#ccc',\n                    boxSizing: 'border-box',\n                    borderTop: '1px solid #fafafa',\n                  }}\n                />\n              )}\n            </>\n          </>\n        )}\n      </div>\n    )\n  }\n  CircularView.propTypes = {\n    model: PropTypes.objectOrObservableObject.isRequired,\n  }\n  return observer(CircularView)\n}\n","function findCircleIntersectionX(\n  y: number,\n  cx: number,\n  cy: number,\n  r: number,\n  resultArray: [number, number][],\n) {\n  const d = Math.abs(y - cy)\n  if (d > r) return\n  if (d === r) {\n    resultArray.push([cx, y])\n  }\n  const solution = Math.sqrt(r * r - d * d)\n  resultArray.push([cx - solution, y])\n  resultArray.push([cx + solution, y])\n}\n\nfunction findCircleIntersectionY(\n  x: number,\n  cx: number,\n  cy: number,\n  r: number,\n  resultArray: [number, number][],\n) {\n  const d = Math.abs(x - cx)\n  if (d > r) return\n  if (d === r) {\n    resultArray.push([x, cy])\n  }\n  const solution = Math.sqrt(r * r - d * d)\n  resultArray.push([x, cy - solution])\n  resultArray.push([x, cy + solution])\n}\n\nfunction cartesianToTheta(x: number, y: number) {\n  let theta = (Math.atan(y / x) + 2 * Math.PI) % (2 * Math.PI)\n  if (x < 0) {\n    if (y <= 0) theta += Math.PI\n    else theta -= Math.PI\n  }\n  return theta\n}\n\nexport function cartesianToPolar(x: number, y: number) {\n  const rho = Math.sqrt(x * x + y * y)\n  if (rho === 0) return [0, 0]\n  const theta = cartesianToTheta(x, y)\n  return [rho, theta]\n}\n\nconst twoPi = 2 * Math.PI\nexport function thetaRangesOverlap(\n  r1start: number,\n  r1length: number,\n  r2start: number,\n  r2length: number,\n) {\n  if (r1length <= 0 || r2length <= 0) return false\n  if (r1length + 0.0001 >= twoPi || r2length + 0.0001 >= twoPi) return true\n\n  // put both range starts between 2 and 4\n  r1start = (((r1start % twoPi) + twoPi) % twoPi) + twoPi\n  r2start = (((r2start % twoPi) + twoPi) % twoPi) + twoPi\n\n  if (r1start < r2start + r2length && r1start + r1length > r2start) return true\n\n  // move r2 2 to the left and check\n  r2start -= twoPi\n  if (r1start < r2start + r2length && r1start + r1length > r2start) return true\n\n  // move it 2 to the right and check\n  r2start += twoPi + twoPi\n  return r1start < r2start + r2length && r1start + r1length > r2start\n}\n\n// return which arc range has any part of the circle visible in the viewport\nexport function viewportVisibleSection(\n  viewSides: [number, number, number, number],\n  circleCenter: [number, number],\n  circleRadius: number,\n) {\n  let [viewL, viewR, viewT, viewB] = viewSides\n  const [cx, cy] = circleCenter\n\n  // transform coordinate system to center of circle\n  viewL -= cx\n  viewR -= cx\n  viewT -= cy\n  viewB -= cy\n\n  const centerIsInsideViewport =\n    viewL < 0 && viewR > 0 && viewT < 0 && viewB > 0\n\n  if (centerIsInsideViewport) {\n    const vertices = [\n      [viewL, viewT],\n      [viewR, viewT],\n      [viewL, viewB],\n      [viewR, viewB],\n    ]\n    let maxRho = -Infinity\n    for (let i = 0; i < vertices.length; i += 1) {\n      const [x, y] = vertices[i]\n      const rho = Math.sqrt(x * x + y * y)\n      if (rho > maxRho) maxRho = rho\n    }\n    return {\n      rho: [0, Math.min(circleRadius, maxRho)],\n      theta: [0, 2 * Math.PI],\n    }\n  }\n  // const viewportCompletelyContainsCircle =\n  //   circleCenter[0] - viewL >= circleRadius &&\n  //   viewR - circleCenter[0] >= circleRadius &&\n  //   circleCenter[1] - viewT >= circleRadius &&\n  //   viewB - circleCenter[1] >= circleRadius\n\n  // if (viewportCompletelyContainsCircle) {\n  //   return [0, 2 * Math.PI]\n  // }\n\n  // const distToCenterSquared = ([x, y]) => {\n  //   const [cx, cy] = circleCenter\n  //   const sq = n => n * n\n  //   return sq(x - cx) + sq(y - cy)\n  // }\n  // const circleRadiusSquared = circleRadius * circleRadius\n\n  // const tlInside = distToCenterSquared([viewL, viewT]) <= circleRadiusSquared\n  // const trInside = distToCenterSquared([viewR, viewT]) <= circleRadiusSquared\n  // const blInside = distToCenterSquared([viewL, viewB]) <= circleRadiusSquared\n  // const brInside = distToCenterSquared([viewR, viewB]) <= circleRadiusSquared\n\n  // const noIntersection = !tlInside && !trInside && !blInside && !brInside\n  // if (noIntersection) return undefined\n\n  // const circleCompletelyContainsViewport =\n  //   tlInside && trInside && blInside && brInside\n  // if (circleCompletelyContainsViewport) {\n  //   // viewport is in the circle, but the center is not in it, so take max\n  //   // and min of thetas to the center\n  //   const thetas = [\n  //     Math.atan(viewT / viewL),\n  //     Math.atan(viewT / viewR),\n  //     Math.atan(viewB / viewL),\n  //     Math.atan(viewB / viewR),\n  //   ]\n\n  //   return [Math.min(...thetas), Math.max(...thetas)]\n  // }\n\n  // if we get here, the viewport is partly in, partly out of the circle\n\n  // const viewLIntersects = Math.abs(viewL - circleCenter[0]) <= circleRadius\n  // const viewRIntersects = Math.abs(viewR - circleCenter[0]) <= circleRadius\n  // const viewTIntersects = Math.abs(viewT - circleCenter[1]) <= circleRadius\n  // const viewBIntersects = Math.abs(viewB - circleCenter[1]) <= circleRadius\n\n  // const numIntersectingSides =\n  //   Number(viewLIntersects) +\n  //   Number(viewRIntersects) +\n  //   Number(viewTIntersects) +\n  //   Number(viewBIntersects)\n\n  // if (numIntersectingSides === 4) return [0, 2 * Math.PI]\n  // if (numIntersectingSides === 3) {\n  //   // TODO calculate the thetas of the\n  // } else if (numIntersectingSides === 2) {\n  //   // TODO calculate the thetas of the 2 intersection points\n  // } else if (numIntersectingSides === 1) {\n  //   // TODO calculate the thetas of the 1-2 intersection points of the line, and the angle between\n  // }\n\n  // make a list of vertices-of-interest that lie inside both shapes to examine\n  // to determine the range covered by their intersection\n\n  // transform coordinates to have the circle as the origin and find the intersections\n  // of the circle and the view rectangle\n  const vertices: [number, number][] = [\n    [viewL, viewT],\n    [viewR, viewT],\n    [viewL, viewB],\n    [viewR, viewB],\n  ]\n  findCircleIntersectionY(viewL, 0, 0, circleRadius, vertices)\n  findCircleIntersectionY(viewR, 0, 0, circleRadius, vertices)\n  findCircleIntersectionX(viewT, 0, 0, circleRadius, vertices)\n  findCircleIntersectionX(viewB, 0, 0, circleRadius, vertices)\n\n  // for each edge, also look at the closest point to center if it is inside the circle\n  if (-viewL < circleRadius) {\n    vertices.push([viewL, 0])\n  }\n  if (viewR < circleRadius) {\n    vertices.push([viewR, 0])\n  }\n  if (-viewT < circleRadius) {\n    vertices.push([0, viewT])\n  }\n  if (viewB < circleRadius) {\n    vertices.push([0, viewB])\n  }\n\n  // const verticesOriginal = vertices.map(([x, y]) => [x + cx, y + cy])\n\n  // now convert them all to polar and take the max and min of rho and theta\n\n  // const viewportCenterTheta = cartesianToTheta(viewR + viewL, viewT + viewB)\n  const reflect = viewL >= 0 ? -1 : 1\n  // viewportCenterTheta < Math.PI / 2 || viewportCenterTheta > 1.5 * Math.PI\n  //   ? -1\n  //   : 1\n  let rhoMin = Infinity\n  let rhoMax = -Infinity\n  let thetaMin = Infinity\n  let thetaMax = -Infinity\n  for (let i = 0; i < vertices.length; i += 1) {\n    // ignore vertex if outside the viewport\n    const [vx, vy] = vertices[i]\n    if (vx >= viewL && vx <= viewR && vy >= viewT && vy <= viewB) {\n      const [rho, theta] = cartesianToPolar(vx * reflect, vy * reflect)\n      // ignore vertex if outside the circle\n      if (rho <= circleRadius + 0.001) {\n        // ignore theta if rho is 0\n        if (theta < thetaMin && rho > 0.0001) thetaMin = theta\n        if (theta > thetaMax && rho > 0.0001) thetaMax = theta\n        if (rho < rhoMin) rhoMin = rho\n        if (rho > rhoMax) rhoMax = rho\n      }\n    }\n  }\n\n  if (reflect === -1) {\n    thetaMin += Math.PI\n    thetaMax += Math.PI\n  }\n\n  if (thetaMin > 2 * Math.PI && thetaMax > 2 * Math.PI) {\n    thetaMin -= 2 * Math.PI\n    thetaMax -= 2 * Math.PI\n  }\n\n  return {\n    rho: [rhoMin, Math.min(circleRadius, rhoMax)],\n    theta: [thetaMin, thetaMax],\n  }\n}\n","import {\n  polarToCartesian,\n  assembleLocString,\n  objectFromEntries,\n  Region,\n} from '@jbrowse/core/util'\nimport { thetaRangesOverlap } from './viewportVisibleRegion'\n\nexport class Slice {\n  key: string\n\n  region: Region & { widthBp: number; elided: boolean }\n\n  offsetRadians: number\n\n  startRadians: number\n\n  endRadians: number\n\n  bpPerRadian: number\n\n  radianWidth: number\n\n  flipped: boolean\n\n  constructor(\n    view: { bpPerRadian: number },\n    region: Region & { widthBp: number; elided: boolean },\n    currentRadianOffset: number,\n    radianWidth: number,\n  ) {\n    const { bpPerRadian } = view\n    this.key = assembleLocString(region)\n    this.region = region\n    this.offsetRadians = currentRadianOffset\n    this.bpPerRadian = bpPerRadian\n    this.radianWidth = radianWidth\n    this.flipped = false\n\n    this.startRadians = this.offsetRadians\n    this.endRadians = region.widthBp / this.bpPerRadian + this.offsetRadians\n    Object.freeze(this)\n  }\n\n  bpToXY(bp: number, radiusPx: number) {\n    let offsetBp\n    if (this.region.elided) {\n      offsetBp = this.region.widthBp / 2\n    } else if (this.flipped) {\n      offsetBp = this.region.end - bp\n    } else {\n      offsetBp = bp - this.region.start\n    }\n    const totalRadians = offsetBp / this.bpPerRadian + this.offsetRadians\n    return polarToCartesian(radiusPx, totalRadians)\n  }\n\n  toJSON() {\n    return objectFromEntries(Object.entries(this))\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction calculateStaticSlices(self: any) {\n  const slices = []\n  let currentRadianOffset = 0\n  for (const region of self.elidedRegions) {\n    const radianWidth =\n      region.widthBp / self.bpPerRadian + self.spacingPx / self.pxPerRadian\n    slices.push(new Slice(self, region, currentRadianOffset, radianWidth))\n    currentRadianOffset += radianWidth\n  }\n  return slices\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction sliceIsVisible(self: any, slice: Slice) {\n  const {\n    // rho: visibleRhoRange,\n    theta: [visibleThetaMin, visibleThetaMax],\n  } = self.visibleSection\n\n  return thetaRangesOverlap(\n    slice.offsetRadians + self.offsetRadians,\n    slice.radianWidth,\n    visibleThetaMin,\n    visibleThetaMax - visibleThetaMin,\n  )\n}\n\nexport { calculateStaticSlices, sliceIsVisible }\n","import { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { SnapshotOrInstance, Instance } from 'mobx-state-tree'\nimport { calculateStaticSlices, sliceIsVisible } from './slices'\n\nimport { viewportVisibleSection } from './viewportVisibleRegion'\n\nexport default function CircularView(pluginManager: PluginManager) {\n  const { lib } = pluginManager\n  const { transaction } = lib.mobx\n  const { types, getParent, resolveIdentifier, getRoot, cast } = lib[\n    'mobx-state-tree'\n  ]\n  const { Region } = lib['@jbrowse/core/util/types/mst']\n  const { readConfObject } = lib['@jbrowse/core/configuration']\n  const { clamp, getSession, isSessionModelWithWidgets } = lib[\n    '@jbrowse/core/util'\n  ]\n  const { BaseViewModel } = lib['@jbrowse/core/pluggableElementTypes/models']\n\n  const minHeight = 40\n  const minWidth = 100\n  const defaultHeight = 400\n  const model = types\n    .model('CircularView', {\n      type: types.literal('CircularView'),\n      offsetRadians: -Math.PI / 2,\n      bpPerPx: 2000000,\n      tracks: types.array(\n        pluginManager.pluggableMstType('track', 'stateModel'),\n      ),\n\n      hideVerticalResizeHandle: false,\n      hideTrackSelectorButton: false,\n      lockedFitToWindow: true,\n      disableImportForm: false,\n\n      height: types.optional(\n        types.refinement('trackHeight', types.number, n => n >= minHeight),\n        defaultHeight,\n      ),\n      minimumRadiusPx: 25,\n      spacingPx: 10,\n      paddingPx: 80,\n      lockedPaddingPx: 100,\n      minVisibleWidth: 6,\n      minimumBlockWidth: 20,\n      displayedRegions: types.array(Region),\n      scrollX: 0,\n      scrollY: 0,\n      trackSelectorType: 'hierarchical',\n    })\n    .volatile(() => ({\n      width: 800,\n    }))\n    .views(self => ({\n      get staticSlices() {\n        return calculateStaticSlices(self)\n      },\n      get visibleStaticSlices() {\n        return this.staticSlices.filter(sliceIsVisible.bind(this, self))\n      },\n      get visibleSection() {\n        return viewportVisibleSection(\n          [\n            self.scrollX,\n            self.scrollX + self.width,\n            self.scrollY,\n            self.scrollY + self.height,\n          ],\n          this.centerXY,\n          this.radiusPx,\n        )\n      },\n      get circumferencePx() {\n        let elidedBp = 0\n        for (const r of this.elidedRegions) {\n          elidedBp += r.widthBp\n        }\n        return (\n          elidedBp / self.bpPerPx + self.spacingPx * this.elidedRegions.length\n        )\n      },\n      get radiusPx() {\n        return this.circumferencePx / (2 * Math.PI)\n      },\n      get bpPerRadian() {\n        return self.bpPerPx * this.radiusPx\n      },\n      get pxPerRadian() {\n        return this.radiusPx\n      },\n      get centerXY(): [number, number] {\n        return [this.radiusPx + self.paddingPx, this.radiusPx + self.paddingPx]\n      },\n      get totalBp() {\n        let total = 0\n        for (const region of self.displayedRegions) {\n          total += region.end - region.start\n        }\n        return total\n      },\n      get maximumRadiusPx() {\n        return self.lockedFitToWindow\n          ? Math.min(self.width, self.height) / 2 - self.lockedPaddingPx\n          : 1000000\n      },\n      get maxBpPerPx() {\n        const minCircumferencePx = 2 * Math.PI * self.minimumRadiusPx\n        return this.totalBp / minCircumferencePx\n      },\n      get minBpPerPx() {\n        // min depends on window dimensions, clamp between old min(0.01) and max\n        const maxCircumferencePx = 2 * Math.PI * this.maximumRadiusPx\n        return clamp(\n          this.totalBp / maxCircumferencePx,\n          0.0000000001,\n          this.maxBpPerPx,\n        )\n      },\n      get atMaxBpPerPx() {\n        return self.bpPerPx >= this.maxBpPerPx\n      },\n      get atMinBpPerPx() {\n        return self.bpPerPx <= this.minBpPerPx\n      },\n      get tooSmallToLock() {\n        return this.minBpPerPx <= 0.0000000001\n      },\n      get figureDimensions() {\n        return [\n          this.radiusPx * 2 + 2 * self.paddingPx,\n          this.radiusPx * 2 + 2 * self.paddingPx,\n        ]\n      },\n      get figureWidth() {\n        return this.figureDimensions[0]\n      },\n      get figureHeight() {\n        return this.figureDimensions[1]\n      },\n      // this is displayedRegions, post-processed to\n      // elide regions that are too small to see reasonably\n      get elidedRegions() {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const visible: any[] = []\n        self.displayedRegions.forEach(region => {\n          const widthBp = region.end - region.start\n          const widthPx = widthBp / self.bpPerPx\n          if (widthPx < self.minVisibleWidth) {\n            // too small to see, collapse into a single elision region\n            const lastVisible = visible[visible.length - 1]\n            if (lastVisible && lastVisible.elided) {\n              lastVisible.regions.push({ ...region })\n              lastVisible.widthBp += widthBp\n            } else {\n              visible.push({\n                elided: true,\n                widthBp,\n                regions: [{ ...region }],\n              })\n            }\n          } else {\n            // big enough to see, display it\n            visible.push({ ...region, widthBp })\n          }\n        })\n\n        // remove any single-region elisions\n        for (let i = 0; i < visible.length; i += 1) {\n          const v = visible[i]\n          if (v.elided && v.regions.length === 1) {\n            delete v.elided\n            visible[i] = { ...v, ...v.regions[0] }\n          }\n        }\n        return visible\n      },\n\n      get assemblyNames() {\n        const assemblyNames: string[] = []\n        self.displayedRegions.forEach(displayedRegion => {\n          if (!assemblyNames.includes(displayedRegion.assemblyName))\n            assemblyNames.push(displayedRegion.assemblyName)\n        })\n        return assemblyNames\n      },\n    }))\n    .volatile(() => ({\n      error: undefined as Error | undefined,\n    }))\n    .actions(self => ({\n      // toggle action with a flag stating which mode it's in\n      setWidth(newWidth: number) {\n        self.width = Math.max(newWidth, minWidth)\n        return self.width\n      },\n      setHeight(newHeight: number) {\n        self.height = Math.max(newHeight, minHeight)\n        return self.height\n      },\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = this.setHeight(self.height + distance)\n        this.setModelViewWhenAdjust(!self.tooSmallToLock)\n        return newHeight - oldHeight\n      },\n      resizeWidth(distance: number) {\n        const oldWidth = self.width\n        const newWidth = this.setWidth(self.width + distance)\n        this.setModelViewWhenAdjust(!self.tooSmallToLock)\n        return newWidth - oldWidth\n      },\n      rotateClockwiseButton() {\n        this.rotateClockwise(Math.PI / 6)\n      },\n\n      rotateCounterClockwiseButton() {\n        this.rotateCounterClockwise(Math.PI / 6)\n      },\n\n      rotateClockwise(distance = 0.17) {\n        self.offsetRadians += distance\n      },\n\n      rotateCounterClockwise(distance = 0.17) {\n        self.offsetRadians -= distance\n      },\n\n      zoomInButton() {\n        this.setBpPerPx(self.bpPerPx / 1.4)\n      },\n\n      zoomOutButton() {\n        this.setBpPerPx(self.bpPerPx * 1.4)\n      },\n\n      setBpPerPx(newVal: number) {\n        self.bpPerPx = clamp(newVal, self.minBpPerPx, self.maxBpPerPx)\n      },\n\n      setModelViewWhenAdjust(secondCondition: boolean) {\n        if (self.lockedFitToWindow && secondCondition) {\n          this.setBpPerPx(self.minBpPerPx)\n        }\n      },\n\n      closeView() {\n        getParent(self, 2).removeView(self)\n      },\n\n      setDisplayedRegions(regions: SnapshotOrInstance<typeof Region>[]) {\n        const previouslyEmpty = self.displayedRegions.length === 0\n        self.displayedRegions = cast(regions)\n\n        if (previouslyEmpty) this.setBpPerPx(self.minBpPerPx)\n        else this.setBpPerPx(self.bpPerPx)\n      },\n\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      toggleTrack(trackId: string) {\n        // if we have any tracks with that configuration, turn them off\n        const hiddenCount = this.hideTrack(trackId)\n        // if none had that configuration, turn one on\n        if (!hiddenCount) {\n          this.showTrack(trackId)\n        }\n      },\n\n      setError(error: Error) {\n        self.error = error\n      },\n\n      showTrack(trackId: string, initialSnapshot = {}) {\n        const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'track',\n        )\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        const trackType = pluginManager.getTrackType(configuration.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${configuration.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const supportedDisplays = viewType.displayTypes.map(\n          displayType => displayType.name,\n        )\n        const displayConf = configuration.displays.find(\n          (d: AnyConfigurationModel) => supportedDisplays.includes(d.type),\n        )\n        const track = trackType.stateModel.create({\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n          displays: [{ type: displayConf.type, configuration: displayConf }],\n        })\n        self.tracks.push(track)\n      },\n\n      addTrackConf(configuration: AnyConfigurationModel, initialSnapshot = {}) {\n        const { type } = configuration\n        const name = readConfObject(configuration, 'name')\n        const trackType = pluginManager.getTrackType(type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${configuration.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const supportedDisplays = viewType.displayTypes.map(\n          displayType => displayType.name,\n        )\n        const displayConf = configuration.displays.find(\n          (d: AnyConfigurationModel) => supportedDisplays.includes(d.type),\n        )\n        const track = trackType.stateModel.create({\n          ...initialSnapshot,\n          name,\n          type,\n          configuration,\n          displays: [{ type: displayConf.type, configuration: displayConf }],\n        })\n        self.tracks.push(track)\n      },\n\n      hideTrack(trackId: string) {\n        const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'track',\n        )\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        // if we have any tracks with that configuration, turn them off\n        const shownTracks = self.tracks.filter(\n          t => t.configuration === configuration,\n        )\n        transaction(() => shownTracks.forEach(t => self.tracks.remove(t)))\n        return shownTracks.length\n      },\n\n      toggleFitToWindowLock() {\n        self.lockedFitToWindow = !self.lockedFitToWindow\n        // when going unlocked -> locked and circle is cut off, set to the locked minBpPerPx\n        this.setModelViewWhenAdjust(self.atMinBpPerPx)\n        return self.lockedFitToWindow\n      },\n    }))\n\n  const stateModel = types.compose(BaseViewModel, model)\n\n  return { stateModel }\n}\n\nexport type CircularViewStateModel = ReturnType<\n  typeof CircularView\n>['stateModel']\nexport type CircularViewModel = Instance<CircularViewStateModel>\n\n/*\nPLANS\n\n- tracks\n- ruler tick marks\n- set viewport scroll from state snapshot\n\n*/\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport ReactComponentF from './components/CircularView'\nimport ModelF from './models/CircularView'\n\nexport default ({ lib, load }: PluginManager) => {\n  const ViewType = lib['@jbrowse/core/pluggableElementTypes/ViewType']\n\n  const ReactComponent = load(ReactComponentF)\n  const { stateModel } = load(ModelF)\n\n  return new ViewType({ name: 'CircularView', stateModel, ReactComponent })\n}\n\nexport type { CircularViewModel } from './models/CircularView'\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nexport default (pluginManager: PluginManager) => {\n  const { lib } = pluginManager\n  const React = lib.react\n  const { useState, useEffect } = React\n  const { makeStyles } = lib['@material-ui/core/styles']\n  const { observer } = lib['mobx-react']\n\n  const useStyles = makeStyles(theme => {\n    const offset = 2\n    const duration = 1.4\n    return {\n      path: {\n        strokeDasharray: 187,\n        strokeDashoffset: 50,\n        animation: `$dash ${duration}s ease-in-out infinite, $colors ${\n          duration * 4\n        }s ease-in-out infinite`,\n      },\n      '@keyframes colors': {\n        '0%': {\n          stroke: theme.palette.primary.light,\n        },\n        '25%': {\n          stroke: theme.palette.secondary.light,\n        },\n        '50%': {\n          stroke: theme.palette.tertiary.light,\n        },\n        '75%': {\n          stroke: theme.palette.quaternary.light,\n        },\n        '100%': {\n          stroke: theme.palette.primary.light,\n        },\n      },\n      '@keyframes dash': {\n        '0%': {\n          strokeDashoffset: offset,\n        },\n        '50%': {\n          strokeDashoffset: offset / 4,\n          transform: 'rotate(135deg)',\n        },\n        '100%': {\n          strokeDashoffset: offset,\n          transform: 'rotate(720deg)',\n        },\n      },\n    }\n  })\n\n  // 'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n  const Loading = observer(\n    ({\n      model: {\n        renderProps: { radius },\n      },\n    }: {\n      model: { renderProps: { radius: number } }\n    }) => {\n      const classes = useStyles()\n\n      // only show the loading message after 400ms to prevent excessive flickering\n      const [shown, setShown] = useState(false)\n      useEffect(() => {\n        const timeout = setTimeout(() => setShown(true), 400)\n        return () => clearTimeout(timeout)\n      })\n\n      return !shown ? null : (\n        <g>\n          <defs>\n            <pattern\n              id=\"diagonalHatch\"\n              width=\"10\"\n              height=\"10\"\n              patternTransform=\"rotate(45 0 0)\"\n              patternUnits=\"userSpaceOnUse\"\n            >\n              <line\n                x1=\"0\"\n                y1=\"0\"\n                x2=\"0\"\n                y2=\"10\"\n                style={{ stroke: 'rgba(255,255,255,0.5)', strokeWidth: 10 }}\n              />\n            </pattern>\n          </defs>\n          <circle cx=\"0\" cy=\"0\" r={radius} fill=\"#f1f1f1\" />\n          <circle cx=\"0\" cy=\"0\" r={radius} fill=\"url(#diagonalHatch)\" />\n          <text\n            x=\"0\"\n            y=\"0\"\n            transform=\"rotate(90 0 0)\"\n            dominantBaseline=\"middle\"\n            textAnchor=\"middle\"\n          >\n            Loading&hellip;\n          </text>\n          <circle\n            className={classes.path}\n            fill=\"none\"\n            strokeWidth=\"4\"\n            strokeLinecap=\"round\"\n            cx=\"0\"\n            cy=\"0\"\n            r=\"60\"\n          />\n        </g>\n      )\n    },\n  )\n\n  return Loading\n}\n","export default ({ jbrequire }) => {\n  const React = jbrequire('react')\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const { observer } = jbrequire('mobx-react')\n\n  const useStyles = makeStyles({\n    errorMessage: {},\n    errorBackground: {},\n    errorText: {},\n  })\n\n  // 'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n  const DisplayError = observer(\n    ({\n      model: {\n        renderProps: { radius },\n        error,\n      },\n    }) => {\n      const classes = useStyles()\n      return (\n        <g className={classes.errorMessage}>\n          <defs>\n            <pattern\n              id=\"diagonalHatch\"\n              width=\"10\"\n              height=\"10\"\n              patternTransform=\"rotate(45 0 0)\"\n              patternUnits=\"userSpaceOnUse\"\n            >\n              <line\n                x1=\"0\"\n                y1=\"0\"\n                x2=\"0\"\n                y2=\"10\"\n                style={{ stroke: 'rgba(255,0,0,0.5)', strokeWidth: 10 }}\n              />\n            </pattern>\n          </defs>\n          <circle\n            className={classes.errorBackground}\n            cx=\"0\"\n            cy=\"0\"\n            r={radius}\n            fill=\"#ffb4b4\"\n          />\n          <circle\n            className={classes.errorPattern}\n            cx=\"0\"\n            cy=\"0\"\n            r={radius}\n            fill=\"url(#diagonalHatch)\"\n          />\n          <text\n            className={classes.errorText}\n            x=\"0\"\n            y=\"0\"\n            transform=\"rotate(90 0 0)\"\n            dominantBaseline=\"middle\"\n            textAnchor=\"middle\"\n          >\n            {String(error)}\n          </text>\n        </g>\n      )\n    },\n  )\n\n  return DisplayError\n}\n","export default ({ jbrequire }) => {\n  const React = jbrequire('react')\n  const { isAlive } = jbrequire('mobx-state-tree')\n  const { useEffect, useRef } = React\n  const { observer, PropTypes: MobxPropTypes } = jbrequire('mobx-react')\n  const { unmountComponentAtNode, hydrate } = jbrequire('react-dom')\n\n  function RpcRenderedSvgGroup({ model }) {\n    const { data, html, filled, renderProps, renderingComponent } = model\n\n    const ssrContainerNode = useRef(null)\n    const hydrated = useRef(false)\n\n    useEffect(() => {\n      const domNode = ssrContainerNode.current\n      const isHydrated = hydrated.current\n      function doHydrate() {\n        if (domNode && filled) {\n          if (domNode && domNode.innerHTML && isHydrated) {\n            domNode.style.display = 'none'\n            requestIdleCallback(() => unmountComponentAtNode(domNode))\n          }\n          domNode.style.display = 'inline'\n          domNode.innerHTML = html\n          // use requestIdleCallback to defer main-thread rendering\n          // and hydration for when we have some free time. helps\n          // keep the framerate up.\n          requestIdleCallback(() => {\n            if (!isAlive(model)) return\n            const mainThreadRendering = React.createElement(\n              renderingComponent,\n              { ...data, ...renderProps },\n              null,\n            )\n            requestIdleCallback(() => {\n              if (!isAlive(model)) return\n              hydrate(mainThreadRendering, domNode)\n            })\n          })\n        }\n      }\n      doHydrate()\n    })\n\n    return <g ref={ssrContainerNode} />\n  }\n\n  RpcRenderedSvgGroup.propTypes = {\n    model: MobxPropTypes.observableObject.isRequired,\n  }\n\n  return observer(RpcRenderedSvgGroup)\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport ChordDisplayLoadingFactory from './Loading'\nimport ChordDisplayErrorFactory from './DisplayError'\nimport RpcRenderedSvgGroupF from './RpcRenderedSvgGroup'\n\nexport default ({ lib, load }: PluginManager) => {\n  const React = lib.react\n  const { observer, PropTypes: MobxPropTypes } = lib['mobx-react']\n\n  const Loading = load(ChordDisplayLoadingFactory)\n  const DisplayError = load(ChordDisplayErrorFactory)\n  const RpcRenderedSvgGroup = load(RpcRenderedSvgGroupF)\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  function BaseChordDisplay({ display }: any) {\n    if (display.error) return <DisplayError model={display} />\n    if (!display.filled) return <Loading model={display} />\n    return <RpcRenderedSvgGroup model={display} />\n  }\n  BaseChordDisplay.propTypes = {\n    display: MobxPropTypes.observableObject.isRequired,\n  }\n  return observer(BaseChordDisplay)\n}\n","export default ({ jbrequire }) => {\n  const { getRpcSessionId } = jbrequire('@jbrowse/core/util/tracks')\n  const { getContainingView } = jbrequire('@jbrowse/core/util')\n  const { getSession } = jbrequire('@jbrowse/core/util')\n\n  function renderReactionData(self) {\n    const display = self\n    const view = getContainingView(display)\n    const { rendererType, renderProps } = display\n    const { rpcManager } = getSession(view)\n\n    const a = {\n      rendererType,\n      rpcManager,\n      renderProps,\n      renderArgs: {\n        // TODO: Figure this out for multiple assembly names\n        assemblyName: view.displayedRegions[0]?.assemblyName,\n        adapterConfig: JSON.parse(JSON.stringify(display.adapterConfig)),\n        rendererType: rendererType.name,\n        renderProps,\n        regions: JSON.parse(JSON.stringify(view.displayedRegions)),\n        blockDefinitions: view.blockDefinitions,\n        sessionId: getRpcSessionId(display),\n        timeout: 1000000, // 10000,\n      },\n    }\n    return a\n  }\n\n  async function renderReactionEffect(props, signal, self) {\n    if (!props) {\n      throw new Error('cannot render with no props')\n    }\n\n    const {\n      rendererType,\n      rpcManager,\n      cannotBeRenderedReason,\n      renderArgs,\n    } = props\n\n    if (cannotBeRenderedReason) {\n      return { message: cannotBeRenderedReason }\n    }\n\n    // don't try to render 0 or NaN radius or no regions\n    if (\n      !props.renderProps.radius ||\n      !props.renderArgs.regions ||\n      !props.renderArgs.regions.length\n    ) {\n      return { message: 'Skipping render' }\n    }\n\n    // check renderertype compatibility\n    if (!self.isCompatibleWithRenderer(rendererType))\n      throw new Error(\n        `renderer ${rendererType.name} is not compatible with this display type`,\n      )\n\n    const { html, ...data } = await rendererType.renderInClient(rpcManager, {\n      ...renderArgs,\n      signal,\n    })\n\n    return { html, data, renderingComponent: rendererType.ReactComponent }\n  }\n\n  return { renderReactionData, renderReactionEffect }\n}\n","import { getConf } from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport CircularChordRendererType from '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType'\nimport RendererType from '@jbrowse/core/pluggableElementTypes/renderers/RendererType'\nimport {\n  getContainingView,\n  getSession,\n  makeAbortableReaction,\n  AnyReactComponentType,\n} from '@jbrowse/core/util'\nimport { Feature, isFeature } from '@jbrowse/core/util/simpleFeature'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n  getTrackAssemblyNames,\n} from '@jbrowse/core/util/tracks'\nimport { Region } from '@jbrowse/core/util/types'\nimport { getParent, isAlive, types } from 'mobx-state-tree'\nimport renderReactionFactory from './renderReaction'\nimport { CircularViewModel } from '../../CircularView'\n\nexport const BaseChordDisplayModel = types\n  .compose(\n    'BaseChordDisplay',\n    BaseDisplay,\n    types.model({\n      bezierRadiusRatio: 0.1,\n      assemblyName: types.maybe(types.string),\n    }),\n  )\n  .volatile(() => {\n    return {\n      // NOTE: all this volatile stuff has to be filled in at once\n      // so that it stays consistent\n      filled: false,\n      html: '',\n      data: undefined,\n      message: '',\n      error: undefined as Error | undefined,\n      renderingComponent: undefined as undefined | AnyReactComponentType,\n      refNameMap: undefined as Record<string, string> | undefined,\n    }\n  })\n  .actions(self => {\n    const { pluginManager } = getSession(self)\n    return {\n      onChordClick(feature: Feature) {\n        getConf(self, 'onChordClick', [feature, self, pluginManager])\n      },\n    }\n  })\n  .views(self => ({\n    get blockDefinitions() {\n      const origSlices = (getContainingView(self) as CircularViewModel)\n        .staticSlices\n      if (!self.refNameMap) return origSlices\n\n      const slices = JSON.parse(JSON.stringify(origSlices))\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      slices.forEach((slice: any) => {\n        const regions = slice.region.elided\n          ? slice.region.regions\n          : [slice.region]\n        regions.forEach((region: Region) => {\n          const renamed = self.refNameMap?.[region.refName]\n          if (renamed && region.refName !== renamed) {\n            region.refName = renamed\n          }\n        })\n      })\n      return slices\n    },\n\n    get renderProps() {\n      const view = getContainingView(self) as CircularViewModel\n      return {\n        ...getParentRenderProps(self),\n        displayModel: self,\n        bezierRadius: view.radiusPx * self.bezierRadiusRatio,\n        radius: view.radiusPx,\n        blockDefinitions: this.blockDefinitions,\n        onChordClick: self.onChordClick,\n      }\n    },\n\n    /**\n     * the pluggable element type object for this diplay's\n     * renderer\n     */\n    get rendererType() {\n      const display = self\n      const { pluginManager } = getSession(self)\n      const ThisRendererType = pluginManager.getRendererType(\n        self.rendererTypeName,\n      )\n      if (!ThisRendererType)\n        throw new Error(`renderer \"${display.rendererTypeName}\" not found`)\n      if (!ThisRendererType.ReactComponent)\n        throw new Error(\n          `renderer ${display.rendererTypeName} has no ReactComponent, it may not be completely implemented yet`,\n        )\n      return ThisRendererType\n    },\n\n    isCompatibleWithRenderer(renderer: RendererType) {\n      return !!(renderer instanceof CircularChordRendererType)\n    },\n\n    /**\n     * returns a string feature ID if the globally-selected object\n     * is probably a feature\n     */\n    get selectedFeatureId() {\n      if (!isAlive(self)) return undefined\n      const session = getSession(self)\n      if (!session) return undefined\n      const { selection } = session\n      // does it quack like a feature?\n      if (isFeature(selection)) {\n        return selection.id()\n      }\n      return undefined\n    },\n  }))\n  .actions(self => ({\n    renderStarted() {\n      self.filled = false\n      self.message = ''\n      self.html = ''\n      self.data = undefined\n      self.error = undefined\n      self.renderingComponent = undefined\n    },\n    renderSuccess({\n      message,\n      data,\n      html,\n      renderingComponent,\n    }: {\n      message: string\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      data: any\n      html: string\n      renderingComponent: AnyReactComponentType\n    }) {\n      if (message) {\n        self.filled = false\n        self.message = message\n        self.html = ''\n        self.data = undefined\n        self.error = undefined\n        self.renderingComponent = undefined\n      } else {\n        self.filled = true\n        self.message = ''\n        self.html = html\n        self.data = data\n        self.error = undefined\n        self.renderingComponent = renderingComponent\n      }\n    },\n    renderError(error: Error) {\n      console.error(error)\n      // the rendering failed for some reason\n      self.filled = false\n      self.message = ''\n      self.html = ''\n      self.data = undefined\n      self.error = error\n      self.renderingComponent = undefined\n    },\n\n    setRefNameMap(refNameMap: Record<string, string>) {\n      self.refNameMap = refNameMap\n    },\n    setError(error: Error) {\n      self.error = error\n    },\n  }))\n  .actions(self => {\n    const { pluginManager } = getSession(self)\n    const {\n      renderReactionData,\n      renderReactionEffect,\n    } = pluginManager.jbrequire(renderReactionFactory)\n    return {\n      afterAttach() {\n        makeAbortableReaction(\n          self,\n          renderReactionData,\n          renderReactionEffect,\n          {\n            name: `${self.type} ${self.id} rendering`,\n            // delay: self.renderDelay || 300,\n            fireImmediately: true,\n          },\n          self.renderStarted,\n          self.renderSuccess,\n          self.renderError,\n        )\n        makeAbortableReaction(\n          self,\n          () => ({\n            assemblyNames: getTrackAssemblyNames(self.parentTrack) as string[],\n            adapter: getConf(getParent(self, 2), 'adapter'),\n            assemblyManager: getSession(self).assemblyManager,\n          }),\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          async ({ assemblyNames, adapter, assemblyManager }: any, signal) => {\n            return assemblyManager.getRefNameMapForAdapter(\n              adapter,\n              assemblyNames[0],\n              { signal, sessionId: getRpcSessionId(self) },\n            )\n          },\n          {\n            name: `${self.type} ${self.id} getting refNames`,\n            fireImmediately: true,\n          },\n          () => {},\n          refNameMap => {\n            self.setRefNameMap(refNameMap)\n          },\n          error => {\n            console.error(error)\n            self.setError(error)\n          },\n        )\n      },\n    }\n  })\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nconst baseChordDisplayConfig = ConfigurationSchema(\n  'BaseChordDisplay',\n  {\n    onChordClick: {\n      type: 'boolean',\n      description:\n        'callback that should be run when a chord in the track is clicked',\n      defaultValue: false,\n      functionSignature: ['feature', 'track', 'pluginManager'],\n    },\n  },\n  { explicitIdentifier: 'displayId' },\n)\n\nexport { baseChordDisplayConfig }\n","import { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport DataUsageIcon from '@material-ui/icons/DataUsage'\nimport CircularViewFactory from './CircularView'\n\nexport default class CircularViewPlugin extends Plugin {\n  name = 'CircularViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() =>\n      pluginManager.jbrequire(CircularViewFactory),\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['File', 'Add'], {\n        label: 'Circular view',\n        icon: DataUsageIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('CircularView', {})\n        },\n      })\n    }\n  }\n}\n\nexport {\n  BaseChordDisplayModel,\n  baseChordDisplayConfig,\n  BaseChordDisplayComponentFactory,\n} from './BaseChordDisplay'\n","import { useDebounce } from '@jbrowse/core/util'\nimport { stringToFunction } from '@jbrowse/core/util/functionStrings'\nimport FormControl from '@material-ui/core/FormControl'\nimport FormHelperText from '@material-ui/core/FormHelperText'\nimport InputLabel from '@material-ui/core/InputLabel'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport { observer, PropTypes } from 'mobx-react'\nimport React, { useEffect, useState } from 'react'\nimport Editor from 'react-simple-code-editor'\nimport { Light as SyntaxHighlighter } from 'react-syntax-highlighter'\nimport javascript from 'react-syntax-highlighter/dist/cjs/languages/hljs/javascript'\nimport a11yDark from 'react-syntax-highlighter/dist/cjs/styles/hljs/a11y-dark'\nimport a11yLight from 'react-syntax-highlighter/dist/cjs/styles/hljs/a11y-light'\n\nSyntaxHighlighter.registerLanguage('javascript', javascript)\n\n// fontSize and fontFamily have to match between Editor and SyntaxHighlighter\nconst fontSize = '12px'\n// Optimize by using system default fonts: https://css-tricks.com/snippets/css/font-stacks/\nconst fontFamily =\n  'Consolas, \"Andale Mono WT\", \"Andale Mono\", \"Lucida Console\", \"Lucida Sans Typewriter\", \"DejaVu Sans Mono\", \"Bitstream Vera Sans Mono\", \"Liberation Mono\", \"Nimbus Mono L\", Monaco, \"Courier New\", Courier, monospace'\n\nconst useStyles = makeStyles(theme => ({\n  callbackEditor: {\n    marginTop: '16px',\n    borderBottom: `1px solid ${theme.palette.divider}`,\n    fontFamily,\n    fontSize,\n  },\n  syntaxHighlighter: {\n    margin: 0,\n    fontFamily,\n    fontSize,\n  },\n}))\n\nfunction CallbackEditor({ slot }) {\n  const classes = useStyles()\n  const theme = useTheme()\n\n  const [code, setCode] = useState(slot.value)\n  const [error, setCodeError] = useState()\n  const debouncedCode = useDebounce(code, 400)\n\n  useEffect(() => {\n    try {\n      stringToFunction(debouncedCode)\n      slot.set(debouncedCode)\n      setCodeError(null)\n    } catch (e) {\n      setCodeError(e)\n    }\n  }, [debouncedCode, slot])\n\n  return (\n    <FormControl>\n      <InputLabel shrink htmlFor=\"callback-editor\">\n        {slot.name}\n      </InputLabel>\n      <Editor\n        className={classes.callbackEditor}\n        value={code}\n        onValueChange={newCode => {\n          setCode(newCode)\n        }}\n        highlight={newCode => (\n          <SyntaxHighlighter\n            language=\"javascript\"\n            style={theme.palette.type === 'dark' ? a11yDark : a11yLight}\n            className={classes.syntaxHighlighter}\n            // override some inline style stuff that's higher specificity\n            // than className\n            customStyle={{ background: 'none', padding: 0 }}\n          >\n            {newCode}\n          </SyntaxHighlighter>\n        )}\n        padding={10}\n        style={{ background: error ? '#fdd' : undefined }}\n      />\n      <FormHelperText>{slot.description}</FormHelperText>\n    </FormControl>\n  )\n}\nCallbackEditor.propTypes = {\n  slot: PropTypes.objectOrObservableObject.isRequired,\n}\nexport default observer(CallbackEditor)\n","import { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport TextField from '@material-ui/core/TextField'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { ChromePicker, Color, ColorResult, RGBColor } from 'react-color'\nimport React, { useState } from 'react'\n\n// this is needed because passing a entire color object into the react-color\n// for alpha, can't pass in an rgba string for example\nfunction serializeColor(color: Color) {\n  if (color instanceof Object) {\n    const { r, g, b, a } = color as RGBColor\n    return `rgb(${r},${g},${b},${a})`\n  }\n  return color\n}\nconst useStyles = makeStyles({\n  popover: {\n    position: 'absolute',\n    zIndex: 2,\n  },\n  cover: {\n    position: 'fixed',\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0,\n  },\n})\n\nexport function ColorPicker(props: {\n  color: Color\n  onChange: (color: ColorResult) => void\n}) {\n  const { color, onChange } = props\n  const classes = useStyles()\n  const [displayColorPicker, setDisplayColorPicker] = useState(true)\n\n  const handleClose = () => {\n    setDisplayColorPicker(false)\n  }\n  return (\n    <div>\n      {displayColorPicker ? (\n        <div className={classes.popover}>\n          <div\n            role=\"presentation\"\n            className={classes.cover}\n            onClick={handleClose}\n          />\n          <ChromePicker color={color} onChange={onChange} />\n        </div>\n      ) : null}\n    </div>\n  )\n}\n\nColorPicker.propTypes = {\n  color: ReactPropTypes.string.isRequired,\n  onChange: ReactPropTypes.func.isRequired,\n}\n\nexport const ColorSlot = (props: {\n  value: string\n  label: string\n  TextFieldProps: {\n    helperText: string\n    fullWidth: boolean\n  }\n  onChange: (arg: string) => void\n}) => {\n  const { value, label, TextFieldProps, onChange } = props\n  const [displayed, setDisplayed] = useState(false)\n\n  return (\n    <>\n      <TextField\n        value={value}\n        label={label}\n        InputProps={{\n          style: {\n            color: value,\n            borderRightWidth: '25px',\n            borderRightStyle: 'solid',\n            borderRightColor: value,\n          },\n        }}\n        onClick={() => setDisplayed(!displayed)}\n        onChange={event => {\n          onChange(event.target.value)\n        }}\n        {...TextFieldProps}\n      />\n      {displayed ? (\n        <ColorPicker\n          color={value}\n          onChange={(event: ColorResult) => {\n            onChange(serializeColor(event.rgb))\n          }}\n        />\n      ) : null}\n    </>\n  )\n}\nColorSlot.propTypes = {\n  onChange: ReactPropTypes.func.isRequired,\n  label: ReactPropTypes.string,\n  TextFieldProps: ReactPropTypes.shape({}),\n  value: ReactPropTypes.string,\n}\nColorSlot.defaultProps = {\n  label: '',\n  value: '#000',\n  TextFieldProps: {},\n}\n\nfunction ColorEditorSlot(props: {\n  slot: {\n    name: string\n    value: string\n    description: string\n    set: (arg: string) => void\n  }\n}) {\n  const { slot } = props\n  return (\n    <ColorSlot\n      label={slot.name}\n      value={slot.value}\n      onChange={(color: string) => {\n        slot.set(color)\n      }}\n      TextFieldProps={{\n        helperText: slot.description,\n        fullWidth: true,\n      }}\n    />\n  )\n}\nColorEditorSlot.propTypes = {\n  slot: ReactPropTypes.shape({\n    name: ReactPropTypes.string.isRequired,\n    description: ReactPropTypes.string,\n    value: ReactPropTypes.string.isRequired,\n    set: ReactPropTypes.func.isRequired,\n  }).isRequired,\n}\nexport default observer(ColorEditorSlot)\n","import { useDebounce } from '@jbrowse/core/util'\nimport FormControl from '@material-ui/core/FormControl'\nimport FormHelperText from '@material-ui/core/FormHelperText'\nimport InputLabel from '@material-ui/core/InputLabel'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport { observer, PropTypes } from 'mobx-react'\nimport React, { useEffect, useState } from 'react'\nimport Editor from 'react-simple-code-editor'\nimport { Light as SyntaxHighlighter } from 'react-syntax-highlighter'\nimport json from 'react-syntax-highlighter/dist/cjs/languages/hljs/json'\nimport a11yDark from 'react-syntax-highlighter/dist/cjs/styles/hljs/a11y-dark'\nimport a11yLight from 'react-syntax-highlighter/dist/cjs/styles/hljs/a11y-light'\n\nSyntaxHighlighter.registerLanguage('json', json)\n\n// fontSize and fontFamily have to match between Editor and SyntaxHighlighter\nconst fontSize = '12px'\n// Optimize by using system default fonts: https://css-tricks.com/snippets/css/font-stacks/\nconst fontFamily =\n  'Consolas, \"Andale Mono WT\", \"Andale Mono\", \"Lucida Console\", \"Lucida Sans Typewriter\", \"DejaVu Sans Mono\", \"Bitstream Vera Sans Mono\", \"Liberation Mono\", \"Nimbus Mono L\", Monaco, \"Courier New\", Courier, monospace'\n\nconst useStyles = makeStyles({\n  callbackEditor: {\n    fontFamily,\n    fontSize,\n    overflowX: 'auto',\n    marginTop: '16px',\n    borderBottom: '1px solid rgba(0,0,0,0.42)',\n  },\n  syntaxHighlighter: {\n    margin: 0,\n    fontFamily,\n    fontSize,\n  },\n  error: {\n    color: 'red',\n    fontSize: '0.8em',\n  },\n})\n\nfunction JsonEditor({ slot }) {\n  const classes = useStyles()\n  const theme = useTheme()\n  const [contents, setContents] = useState(\n    JSON.stringify(slot.value, null, '  '),\n  )\n  const [error, setError] = useState()\n  const debouncedJson = useDebounce(contents, 400)\n\n  useEffect(() => {\n    try {\n      slot.set(JSON.parse(debouncedJson))\n      setError(undefined)\n    } catch (e) {\n      setError(e.message)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [debouncedJson])\n\n  return (\n    <>\n      {error ? <p className={classes.error}>{error}</p> : null}\n      <FormControl error={error}>\n        <InputLabel shrink htmlFor=\"callback-editor\">\n          {slot.name}\n        </InputLabel>\n        <Editor\n          className={classes.callbackEditor}\n          value={contents}\n          onValueChange={setContents}\n          highlight={newCode => (\n            <SyntaxHighlighter\n              language=\"json\"\n              style={theme.palette.type === 'dark' ? a11yDark : a11yLight}\n              className={classes.syntaxHighlighter}\n              // override some inline style stuff that's higher specificity\n              // than className\n              customStyle={{ background: 'none', padding: 0 }}\n            >\n              {newCode}\n            </SyntaxHighlighter>\n          )}\n          padding={10}\n          style={{}}\n        />\n        <FormHelperText>{slot.description}</FormHelperText>\n      </FormControl>\n    </>\n  )\n}\n\nJsonEditor.propTypes = {\n  slot: PropTypes.objectOrObservableObject.isRequired,\n}\n\nexport default observer(JsonEditor)\n","import { FileSelector } from '@jbrowse/core/ui'\nimport {\n  getPropertyType,\n  getSubType,\n  getUnionSubTypes,\n} from '@jbrowse/core/util/mst-reflection'\nimport Card from '@material-ui/core/Card'\nimport CardContent from '@material-ui/core/CardContent'\nimport CardHeader from '@material-ui/core/CardHeader'\nimport Checkbox from '@material-ui/core/Checkbox'\nimport FormControl from '@material-ui/core/FormControl'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\nimport FormHelperText from '@material-ui/core/FormHelperText'\nimport IconButton from '@material-ui/core/IconButton'\nimport InputAdornment from '@material-ui/core/InputAdornment'\nimport InputLabel from '@material-ui/core/InputLabel'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/core/styles'\nimport SvgIcon from '@material-ui/core/SvgIcon'\nimport TextField from '@material-ui/core/TextField'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport AddIcon from '@material-ui/icons/Add'\nimport RadioButtonUncheckedIcon from '@material-ui/icons/RadioButtonUnchecked'\nimport { observer } from 'mobx-react'\nimport { getPropertyMembers } from 'mobx-state-tree'\nimport React, { useEffect, useState } from 'react'\nimport CallbackEditor from './CallbackEditor'\nimport ColorEditor from './ColorEditor'\nimport JsonEditor from './JsonEditor'\n\nconst StringEditor = observer(({ slot }) => (\n  <TextField\n    label={slot.name}\n    // error={filterError}\n    helperText={slot.description}\n    fullWidth\n    value={slot.value}\n    onChange={evt => slot.set(evt.target.value)}\n  />\n))\n\nconst TextEditor = observer(({ slot }) => (\n  <TextField\n    label={slot.name}\n    helperText={slot.description}\n    fullWidth\n    multiline\n    value={slot.value}\n    onChange={evt => slot.set(evt.target.value)}\n  />\n))\n\n// checked checkbox, looks like a styled (x)\nconst SvgCheckbox = () => (\n  <SvgIcon>\n    <path d=\"M20.41,3C21.8,5.71 22.35,8.84 22,12C21.8,15.16 20.7,18.29 18.83,21L17.3,20C18.91,17.57 19.85,14.8 20,12C20.34,9.2 19.89,6.43 18.7,4L20.41,3M5.17,3L6.7,4C5.09,6.43 4.15,9.2 4,12C3.66,14.8 4.12,17.57 5.3,20L3.61,21C2.21,18.29 1.65,15.17 2,12C2.2,8.84 3.3,5.71 5.17,3M12.08,10.68L14.4,7.45H16.93L13.15,12.45L15.35,17.37H13.09L11.71,14L9.28,17.33H6.76L10.66,12.21L8.53,7.45H10.8L12.08,10.68Z\" />\n  </SvgIcon>\n)\n\nconst StringArrayEditor = observer(({ slot }) => {\n  const [value, setValue] = useState('')\n  return (\n    <>\n      {slot.name ? <InputLabel>{slot.name}</InputLabel> : null}\n      <List disablePadding>\n        {slot.value.map((val, idx) => (\n          <ListItem key={idx} disableGutters>\n            <TextField\n              value={val}\n              onChange={evt => slot.setAtIndex(idx, evt.target.value)}\n              InputProps={{\n                endAdornment: (\n                  <InputAdornment>\n                    <IconButton\n                      color=\"secondary\"\n                      onClick={() => slot.removeAtIndex(idx)}\n                    >\n                      <DeleteIcon />\n                    </IconButton>\n                  </InputAdornment>\n                ),\n              }}\n            />\n          </ListItem>\n        ))}\n        <ListItem disableGutters>\n          <TextField\n            value={value}\n            placeholder=\"add new\"\n            onChange={event => setValue(event.target.value)}\n            InputProps={{\n              endAdornment: (\n                <InputAdornment>\n                  <IconButton\n                    onClick={() => {\n                      slot.add(value)\n                      setValue('')\n                    }}\n                    disabled={value === ''}\n                    color=\"secondary\"\n                  >\n                    <AddIcon />\n                  </IconButton>\n                </InputAdornment>\n              ),\n            }}\n          />\n        </ListItem>\n      </List>\n      <FormHelperText>{slot.description}</FormHelperText>\n    </>\n  )\n})\n\nconst useMapEditorStyles = makeStyles(theme => ({\n  card: {\n    marginTop: theme.spacing(1),\n  },\n}))\n\nconst StringArrayMapEditor = observer(({ slot }) => {\n  const classes = useMapEditorStyles()\n  const [value, setValue] = useState('')\n  return (\n    <>\n      <InputLabel>{slot.name}</InputLabel>\n      {Array.from(slot.value, ([key, val]) => (\n        <Card raised key={key} className={classes.card}>\n          <CardHeader\n            title={key}\n            action={\n              <IconButton color=\"secondary\" onClick={() => slot.remove(key)}>\n                <DeleteIcon />\n              </IconButton>\n            }\n          />\n          <CardContent>\n            <StringArrayEditor\n              slot={{\n                value: val,\n                description: `Values associated with entry ${key}`,\n                setAtIndex: (idx, strValue) => {\n                  slot.setAtKeyIndex(key, idx, strValue)\n                },\n                removeAtIndex: idx => {\n                  slot.removeAtKeyIndex(key, idx)\n                },\n                add: strValue => {\n                  slot.addToKey(key, strValue)\n                },\n              }}\n            />\n          </CardContent>\n        </Card>\n      ))}\n      <Card raised className={classes.card}>\n        <CardHeader\n          disableTypography\n          title={\n            <TextField\n              fullWidth\n              value={value}\n              placeholder=\"add new\"\n              onChange={event => setValue(event.target.value)}\n              InputProps={{\n                endAdornment: (\n                  <InputAdornment>\n                    <IconButton\n                      disabled={value === ''}\n                      onClick={() => {\n                        slot.add(value, [])\n                        setValue('')\n                      }}\n                      color=\"secondary\"\n                    >\n                      <AddIcon />\n                    </IconButton>\n                  </InputAdornment>\n                ),\n              }}\n            />\n          }\n        />\n      </Card>\n      <FormHelperText>{slot.description}</FormHelperText>\n    </>\n  )\n})\n\nconst NumberMapEditor = observer(({ slot }) => {\n  const classes = useMapEditorStyles()\n  const [value, setValue] = useState('')\n  return (\n    <>\n      <InputLabel>{slot.name}</InputLabel>\n      {Array.from(slot.value, ([key, val]) => (\n        <Card raised key={key} className={classes.card}>\n          <CardHeader\n            title={key}\n            action={\n              <IconButton color=\"secondary\" onClick={() => slot.remove(key)}>\n                <DeleteIcon />\n              </IconButton>\n            }\n          />\n          <CardContent>\n            <NumberEditor\n              slot={{\n                value: val,\n                set: numValue => slot.add(key, numValue),\n              }}\n            />\n          </CardContent>\n        </Card>\n      ))}\n      <Card raised className={classes.card}>\n        <CardHeader\n          disableTypography\n          title={\n            <TextField\n              fullWidth\n              value={value}\n              placeholder=\"add new\"\n              onChange={event => setValue(event.target.value)}\n              InputProps={{\n                endAdornment: (\n                  <InputAdornment>\n                    <IconButton\n                      disabled={value === ''}\n                      onClick={() => {\n                        slot.add(value, 0)\n                        setValue('')\n                      }}\n                      color=\"secondary\"\n                    >\n                      <AddIcon />\n                    </IconButton>\n                  </InputAdornment>\n                ),\n              }}\n            />\n          }\n        />\n      </Card>\n      <FormHelperText>{slot.description}</FormHelperText>\n    </>\n  )\n})\n\nconst NumberEditor = observer(({ slot }) => {\n  const [val, setVal] = useState(slot.value)\n  useEffect(() => {\n    const num = parseFloat(val, 10)\n    if (!Number.isNaN(num)) {\n      slot.set(num)\n    } else {\n      slot.reset()\n    }\n  }, [slot, val])\n  return (\n    <TextField\n      label={slot.name}\n      helperText={slot.description}\n      value={val}\n      type=\"number\"\n      onChange={evt => setVal(evt.target.value)}\n    />\n  )\n})\n\nconst IntegerEditor = observer(({ slot }) => {\n  const [val, setVal] = useState(slot.value)\n  useEffect(() => {\n    const num = parseInt(val, 10)\n    if (!Number.isNaN(num)) {\n      slot.set(num)\n    }\n  }, [slot, val])\n  return (\n    <TextField\n      label={slot.name}\n      helperText={slot.description}\n      value={val}\n      type=\"number\"\n      onChange={evt => setVal(evt.target.value)}\n    />\n  )\n})\n\nconst booleanEditor = observer(({ slot }) => (\n  <FormControl>\n    <FormControlLabel\n      label={slot.name}\n      control={\n        <Checkbox\n          checked={slot.value}\n          onChange={evt => slot.set(evt.target.checked)}\n        />\n      }\n    />\n    <FormHelperText>{slot.description}</FormHelperText>\n  </FormControl>\n))\n\nconst stringEnumEditor = observer(({ slot, slotSchema }) => {\n  const p = getPropertyMembers(getSubType(slotSchema))\n  const choices = getUnionSubTypes(\n    getUnionSubTypes(getSubType(getPropertyType(p, 'value')))[1],\n  ).map(t => t.value)\n\n  return (\n    <TextField\n      value={slot.value}\n      label={slot.name}\n      select\n      // error={filterError}\n      helperText={slot.description}\n      fullWidth\n      onChange={evt => slot.set(evt.target.value)}\n    >\n      {choices.map(str => (\n        <MenuItem key={str} value={str}>\n          {str}\n        </MenuItem>\n      ))}\n    </TextField>\n  )\n})\n\nfunction createSetLocation(slot) {\n  return location => {\n    slot.set({ ...slot.value, ...location })\n  }\n}\n\nconst FileSelectorWrapper = observer(({ slot }) => {\n  return (\n    <FileSelector\n      location={slot.value}\n      setLocation={createSetLocation(slot)}\n      name={slot.name}\n      description={slot.description}\n    />\n  )\n})\n\nconst valueComponents = {\n  string: StringEditor,\n  text: TextEditor,\n  fileLocation: FileSelectorWrapper,\n  stringArray: StringArrayEditor,\n  stringArrayMap: StringArrayMapEditor,\n  numberMap: NumberMapEditor,\n  number: NumberEditor,\n  integer: IntegerEditor,\n  color: ColorEditor,\n  stringEnum: stringEnumEditor,\n  boolean: booleanEditor,\n  frozen: JsonEditor,\n  configRelationships: JsonEditor,\n}\n\nexport const useSlotEditorStyles = makeStyles(theme => ({\n  paper: {\n    display: 'flex',\n    marginBottom: theme.spacing(2),\n    position: 'relative',\n    overflow: 'visible',\n  },\n  paperContent: {\n    flex: 'auto',\n    padding: theme.spacing(1),\n    overflow: 'auto',\n  },\n  slotModeSwitch: {\n    width: 24,\n    background: theme.palette.secondary.light,\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n}))\n\nconst SlotEditor = observer(({ slot, slotSchema }) => {\n  const classes = useSlotEditorStyles()\n  const { type } = slot\n  let ValueComponent = slot.isCallback ? CallbackEditor : valueComponents[type]\n  if (!ValueComponent) {\n    console.warn(`no slot editor defined for ${type}, editing as string`)\n    ValueComponent = StringEditor\n  }\n  if (!(type in valueComponents))\n    console.warn(`SlotEditor needs to implement ${type}`)\n  return (\n    <Paper className={classes.paper}>\n      <div className={classes.paperContent}>\n        <ValueComponent slot={slot} slotSchema={slotSchema} />\n      </div>\n      <div className={classes.slotModeSwitch}>\n        {slot.functionSignature.length ? (\n          <IconButton\n            className={classes.slotModeIcon}\n            onClick={() =>\n              slot.isCallback ? slot.convertToValue() : slot.convertToCallback()\n            }\n            title={`convert to ${\n              slot.isCallback ? 'regular value' : 'callback'\n            }`}\n            color=\"secondary\"\n          >\n            {!slot.isCallback ? <RadioButtonUncheckedIcon /> : <SvgCheckbox />}\n          </IconButton>\n        ) : null}\n      </div>\n    </Paper>\n  )\n})\n\nexport default SlotEditor\n","import MenuItem from '@material-ui/core/MenuItem'\nimport Paper from '@material-ui/core/Paper'\nimport TextField from '@material-ui/core/TextField'\nimport { observer } from 'mobx-react'\nimport React from 'react'\nimport { useSlotEditorStyles } from './SlotEditor'\n\nconst TypeSelector = observer(\n  ({ typeNameChoices, slot, slotName, onChange }) => {\n    const classes = useSlotEditorStyles()\n    return (\n      <Paper className={classes.paper}>\n        <div className={classes.paperContent}>\n          <TextField\n            value={slot.type}\n            label=\"Type\"\n            select\n            // error={filterError}\n            helperText={`Type of ${slotName} to use`}\n            fullWidth\n            onChange={onChange}\n          >\n            {typeNameChoices.map(str => (\n              <MenuItem key={str} value={str}>\n                {str}\n              </MenuItem>\n            ))}\n          </TextField>\n        </div>\n      </Paper>\n    )\n  },\n)\n\nexport default TypeSelector\n","import {\n  readConfObject,\n  getTypeNamesFromExplicitlyTypedUnion,\n  isConfigurationSchemaType,\n  isConfigurationSlotType,\n} from '@jbrowse/core/configuration'\n\nimport { iterMap } from '@jbrowse/core/util'\nimport FormGroup from '@material-ui/core/FormGroup'\nimport FormLabel from '@material-ui/core/FormLabel'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport { getMembers } from 'mobx-state-tree'\nimport { singular } from 'pluralize'\nimport React from 'react'\nimport SlotEditor from './SlotEditor'\nimport TypeSelector from './TypeSelector'\n\nconst useMemberStyles = makeStyles(theme => ({\n  subSchemaContainer: {\n    marginLeft: theme.spacing(1),\n    borderLeft: `1px solid ${theme.palette.secondary.main}`,\n    paddingLeft: theme.spacing(1),\n    marginBottom: theme.spacing(1),\n  },\n}))\n\nconst Member = observer(props => {\n  const classes = useMemberStyles()\n  const { slotName, slotSchema, schema, slot = schema[slotName] } = props\n  let typeSelector\n  if (isConfigurationSchemaType(slotSchema)) {\n    if (slot.length) {\n      return (\n        <>\n          {slot.map((subslot, slotIndex) => {\n            const key = `${singular(slotName)} ${slotIndex + 1}`\n            return <Member {...props} key={key} slot={subslot} slotName={key} />\n          })}\n        </>\n      )\n    }\n    // if this is an explicitly typed schema, make a type-selecting dropdown\n    // that can be used to change its type\n    const typeNameChoices = getTypeNamesFromExplicitlyTypedUnion(slotSchema)\n    if (typeNameChoices.length) {\n      typeSelector = (\n        <TypeSelector\n          typeNameChoices={typeNameChoices}\n          slotName={slotName}\n          slot={slot}\n          onChange={evt => {\n            if (evt.target.value !== slot.type)\n              schema.setSubschema(slotName, { type: evt.target.value })\n          }}\n        />\n      )\n    }\n    return (\n      <>\n        <FormLabel>{slotName}</FormLabel>\n        <div className={classes.subSchemaContainer}>\n          {typeSelector}\n          <FormGroup>\n            <Schema schema={slot} />\n          </FormGroup>\n        </div>\n      </>\n    )\n  }\n\n  if (isConfigurationSlotType(slotSchema)) {\n    // this is a regular config slot\n    return <SlotEditor key={slotName} slot={slot} slotSchema={slotSchema} />\n  }\n\n  return null\n})\n\nconst Schema = observer(({ schema }) => {\n  return iterMap(\n    Object.entries(getMembers(schema).properties),\n    ([slotName, slotSchema]) => (\n      <Member key={slotName} {...{ slotName, slotSchema, schema }} />\n    ),\n  )\n})\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    padding: theme.spacing(1, 3, 1, 1),\n    background: theme.palette.background.default,\n    overflowX: 'hidden',\n  },\n}))\n\nfunction ConfigurationEditor({ model }) {\n  const classes = useStyles()\n  // key forces a re-render, otherwise the same field can end up being used\n  // for different tracks since only the backing model changes for example\n  // see pr #804\n  const key = model.target && readConfObject(model.target, 'trackId')\n  return (\n    <div className={classes.root} key={key} data-testid=\"configEditor\">\n      {!model.target ? 'no target set' : <Schema schema={model.target} />}\n    </div>\n  )\n}\nConfigurationEditor.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n\nexport default observer(ConfigurationEditor)\n","import { types } from 'mobx-state-tree'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\nexport default pluginManager =>\n  types\n    .model('ConfigurationEditorWidget', {\n      id: ElementId,\n      type: types.literal('ConfigurationEditorWidget'),\n      // If you add different types of targets, don't forget to account for that\n      // in the key of ./components/ConfigurationEditor.js\n      target: types.safeReference(\n        pluginManager.pluggableConfigSchemaType('track'),\n      ),\n    })\n    // .volatile(() => ({\n    //   target: undefined,\n    // }))\n    .actions(self => ({\n      setTarget(newTarget) {\n        self.target = newTarget\n      },\n    }))\n//    .views(self => ({}))\n","import { observer } from 'mobx-react'\nimport { isStateTreeNode, getType } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as ReactComponent } from './components/ConfigurationEditor'\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema('ConfigurationEditorWidget', {})\nexport const HeadingComponent = observer(({ model }) => {\n  if (model && model.target) {\n    if (model.target.type) {\n      return `${model.target.type} Settings`\n    }\n    if (isStateTreeNode(model.target)) {\n      const type = getType(model.target)\n      if (type && type.name) {\n        return `${type.name.replace('ConfigurationSchema', '')} Settings`\n      }\n    }\n  }\n  return 'Settings'\n})\n","import {\n  BaseFeatureDataAdapter,\n  RegionsAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport SimpleFeature, {\n  Feature,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util/simpleFeature'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { ConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { configSchema as FromConfigAdapterConfigSchema } from './configSchema'\n\n/**\n * Adapter that just returns the features defined in its `features` configuration\n * key, like:\n *   `\"features\": [ { \"refName\": \"ctgA\", \"start\":1, \"end\":20 }, ... ]`\n */\n\nexport default class FromConfigAdapter\n  extends BaseFeatureDataAdapter\n  implements RegionsAdapter {\n  private features: Map<string, Feature[]>\n\n  constructor(\n    config: ConfigurationModel<typeof FromConfigAdapterConfigSchema>,\n  ) {\n    super(config)\n    const features = readConfObject(\n      config,\n      'features',\n    ) as SimpleFeatureSerialized[]\n    this.features = this.makeFeatures(features || [])\n  }\n\n  private makeFeatures(fdata: SimpleFeatureSerialized[]) {\n    const features = new Map<string, Feature[]>()\n    for (let i = 0; i < fdata.length; i += 1) {\n      if (fdata[i]) {\n        const f = this.makeFeature(fdata[i])\n        const refName = f.get('refName') as string\n        let bucket = features.get(refName)\n        if (!bucket) {\n          bucket = []\n          features.set(refName, bucket)\n        }\n\n        bucket.push(f)\n      }\n    }\n\n    // sort the features on each reference sequence by start coordinate\n    for (const refFeatures of features.values()) {\n      refFeatures.sort((a, b) => a.get('start') - b.get('start'))\n    }\n\n    return features\n  }\n\n  private makeFeature(data: SimpleFeatureSerialized): SimpleFeature {\n    return new SimpleFeature(data)\n  }\n\n  async getRefNames() {\n    const refNames: Set<string> = new Set()\n    for (const [refName, features] of this.features) {\n      // add the feature's primary refname\n      refNames.add(refName)\n\n      // also look in the features for mate or breakend specifications, and add\n      // the refName targets of those\n      features.forEach(feature => {\n        // get refNames of generic \"mate\" records\n        const mate = feature.get('mate')\n        if (mate && mate.refName) {\n          refNames.add(mate.refName)\n        }\n        // get refNames of VCF BND and TRA records\n        const svType = ((feature.get('INFO') || {}).SVTYPE || [])[0]\n        if (svType === 'BND') {\n          const breakendSpecification = (feature.get('ALT') || [])[0]\n          const matePosition = breakendSpecification.MatePosition.split(':')\n          refNames.add(matePosition[0])\n        } else if (svType === 'TRA') {\n          const chr2 = ((feature.get('INFO') || {}).CHR2 || [])[0]\n          refNames.add(chr2)\n        }\n      })\n    }\n    return Array.from(refNames)\n  }\n\n  /**\n   * Get refName, start, and end for all features after collapsing any overlaps\n   */\n  async getRegions() {\n    const regions = []\n\n    // recall: features are stored in this object sorted by start coordinate\n    for (const [refName, features] of this.features) {\n      let currentRegion\n      for (const feature of features) {\n        if (\n          currentRegion &&\n          currentRegion.end >= feature.get('start') &&\n          currentRegion.start <= feature.get('end')\n        ) {\n          currentRegion.end = feature.get('end')\n        } else {\n          if (currentRegion) regions.push(currentRegion)\n          currentRegion = {\n            refName,\n            start: feature.get('start'),\n            end: feature.get('end'),\n          }\n        }\n      }\n      if (currentRegion) regions.push(currentRegion)\n    }\n\n    // sort the regions by refName\n    regions.sort((a, b) => a.refName.localeCompare(b.refName))\n\n    return regions\n  }\n\n  async getRefNameAliases() {\n    return Array.from(this.features.values()).map(featureArray => ({\n      refName: featureArray[0].get('refName'),\n      aliases: featureArray[0].get('aliases'),\n    }))\n  }\n\n  getFeatures(region: NoAssemblyRegion) {\n    const { refName, start, end } = region\n\n    return ObservableCreate<Feature>(async observer => {\n      const features = this.features.get(refName) || []\n      for (let i = 0; i < features.length; i += 1) {\n        const f = features[i]\n        if (f.get('end') > start && f.get('start') < end) {\n          observer.next(f)\n        }\n      }\n      observer.complete()\n    })\n  }\n\n  freeResources(/* { region } */): void {}\n}\n","import SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { toArray } from 'rxjs/operators'\nimport FromConfigAdapter from './FromConfigAdapter'\n\nexport default class FromSequenceConfigAdapter extends FromConfigAdapter {\n  /**\n   * Fetch features for a certain region\n   * @param region - Region\n   * @returns Observable of Feature objects in the region\n   */\n  getFeatures(region: NoAssemblyRegion) {\n    const { start, end } = region\n    // TODO: restore commented version below once TSDX supports Rollup v2\n    // xref: https://github.com/rollup/rollup/blob/master/CHANGELOG.md#bug-fixes-45\n    const superGetFeatures = super.getFeatures\n    return ObservableCreate<Feature>(async observer => {\n      const feats = await superGetFeatures\n        .call(this, region)\n        .pipe(toArray())\n        .toPromise()\n      // return ObservableCreate<Feature>(async observer => {\n      //   const feats = await super.getFeatures(region).pipe(toArray()).toPromise()\n      const feat = feats[0]\n      observer.next(\n        new SimpleFeature({\n          ...feat.toJSON(),\n          seq: feat.get('seq').slice(start, end),\n          end,\n          start,\n        }),\n      )\n      observer.complete()\n    })\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the forseeable future and can be purged\n   * from caches, etc\n   */\n  freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport const configSchema = ConfigurationSchema(\n  'FromConfigAdapter',\n  {\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n    featureClass: {\n      type: 'string',\n      defaultValue: 'SimpleFeature',\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport const sequenceConfigSchema = ConfigurationSchema(\n  'FromConfigSequenceAdapter',\n  {\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n    featureClass: {\n      type: 'string',\n      defaultValue: 'SimpleFeature',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import {\n  BaseRefNameAliasAdapter,\n  Alias,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { GenericFilehandle } from 'generic-filehandle'\nimport { readConfObject } from '@jbrowse/core/configuration'\n\nimport { ConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport MyConfigAdapterSchema from './configSchema'\n\nexport default class RefNameAliasAdapter implements BaseRefNameAliasAdapter {\n  private location: GenericFilehandle\n\n  private promise: Promise<Alias[]>\n\n  constructor(config: ConfigurationModel<typeof MyConfigAdapterSchema>) {\n    this.location = openLocation(readConfObject(config, 'location'))\n    this.promise = this.downloadResults()\n  }\n\n  private async downloadResults() {\n    const results = (await this.location.readFile('utf8')) as string\n    return results\n      .trim()\n      .split('\\n')\n      .map((row: string) => {\n        const [refName, ...aliases] = row.split('\\t')\n        return { refName, aliases }\n      })\n  }\n\n  getRefNameAliases() {\n    return this.promise\n  }\n\n  async freeResources() {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'RefNameAliasAdapter',\n  {\n    location: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my/aliases.txt' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  configSchema as ConfigurationEditorConfigSchema,\n  HeadingComponent as ConfigurationEditorHeadingComponent,\n  ReactComponent as ConfigurationEditorReactComponent,\n  stateModelFactory as ConfigurationEditorStateModelFactory,\n} from './ConfigurationEditorWidget'\nimport {\n  AdapterClass as FromConfigAdapterClass,\n  SequenceAdapterClass as FromConfigSequenceAdapterClass,\n  configSchema as fromConfigAdapterConfigSchema,\n  sequenceConfigSchema as fromConfigSequenceAdapterConfigSchema,\n} from './FromConfigAdapter'\nimport {\n  AdapterClass as RefNameAliasAdapterClass,\n  configSchema as refNameAliasAdapterConfigSchema,\n} from './RefNameAliasAdapter'\n\nexport default class extends Plugin {\n  name = 'ConfigurationPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'FromConfigAdapter',\n          configSchema: fromConfigAdapterConfigSchema,\n          AdapterClass: FromConfigAdapterClass,\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'FromConfigSequenceAdapter',\n          configSchema: fromConfigSequenceAdapterConfigSchema,\n          AdapterClass: FromConfigSequenceAdapterClass,\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'RefNameAliasAdapter',\n          configSchema: refNameAliasAdapterConfigSchema,\n          AdapterClass: RefNameAliasAdapterClass,\n        }),\n    )\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'ConfigurationEditorWidget',\n        HeadingComponent: ConfigurationEditorHeadingComponent,\n        configSchema: ConfigurationEditorConfigSchema,\n        stateModel: ConfigurationEditorStateModelFactory(pluginManager),\n        ReactComponent: ConfigurationEditorReactComponent,\n      })\n    })\n  }\n}\n\nexport { default as ConfigurationEditor } from './ConfigurationEditorWidget/components/ConfigurationEditor'\nexport { default as JsonEditor } from './ConfigurationEditorWidget/components/JsonEditor'\n","import { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'UCSCTrackHubConnection',\n  {\n    hubTxtLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: 'http://mysite.com/path/to/hub.txt' },\n      description: 'location of the hub file (usually called hub.txt)',\n    },\n  },\n  { baseConfiguration: baseConnectionConfig },\n)\n","// These are the assemblies for which there is a sequence file located at\n// http://hgdownload.soe.ucsc.edu/goldenPath/${assemblyName}/bigZips/${assemblyName}.2bit\n// This list was generated by `getUcscAssemblies.js`\n\nexport default `ailMel1\nallMis1\nanoCar1\nanoCar2\nanoGam1\nanoGam3\napiMel1\napiMel2\naplCal1\naptMan1\naquChr2\nbalAcu1\nbisBis1\nbosTau2\nbosTau3\nbosTau4\nbosTau6\nbosTau7\nbosTau8\nbraFlo1\ncaeJap1\ncaePb1\ncaePb2\ncaeRem2\ncaeRem3\ncalJac1\ncalJac3\ncalMil1\ncanFam1\ncanFam3\ncavPor3\ncb3\nce10\nce11\nce2\nce4\nce6\ncerSim1\nchlSab2\nchoHof1\nchrPic1\nci1\nci2\nci3\ncriGri1\ncriGriChoV1\ndanRer10\ndanRer11\ndanRer3\ndanRer4\ndanRer5\ndanRer6\ndanRer7\ndasNov3\ndipOrd1\ndm1\ndm2\ndm3\ndm6\ndp2\ndp3\ndroAna1\ndroAna2\ndroEre1\ndroGri1\ndroMoj1\ndroMoj2\ndroPer1\ndroSec1\ndroSim1\ndroVir1\ndroVir2\ndroYak1\ndroYak2\neboVir3\nechTel1\nechTel2\nequCab1\nequCab2\neriEur1\neriEur2\nfelCat3\nfelCat4\nfelCat5\nfelCat8\nfr1\nfr2\nfr3\ngadMor1\ngalGal2\ngalGal3\ngalGal4\ngalGal5\ngalGal6\ngalVar1\ngasAcu1\ngeoFor1\ngorGor3\ngorGor4\ngorGor5\nhetGla1\nhetGla2\nhg16\nhg18\nhg19\nhg38\nlatCha1\nloxAfr3\nmacEug2\nmacFas5\nmanPen1\nmelGal1\nmelGal5\nmelUnd1\nmicMur1\nmicMur2\nmm10\nmm7\nmm8\nmm9\nmonDom2\nmonDom4\nmonDom5\nmusFur1\nmyoLuc2\nnanPar1\nnasLar1\nnomLeu1\nnomLeu2\nnomLeu3\nochPri2\nochPri3\noreNil2\nornAna1\nornAna2\noryCun2\noryLat2\notoGar3\noviAri1\noviAri3\noviAri4\npanPan1\npanPan2\npanTro1\npanTro2\npanTro3\npanTro4\npanTro5\npanTro6\npapAnu2\npapHam1\npetMar1\npetMar2\nponAbe2\nponAbe3\npriPac1\nproCap1\npteVam1\nrheMac2\nrheMac3\nrheMac8\nrhiRox1\nrn4\nrn5\nrn6\nsacCer1\nsacCer2\nsacCer3\nsaiBol1\nsarHar1\nsorAra1\nsorAra2\nspeTri2\nstrPur1\nstrPur2\nsusScr11\nsusScr2\nsusScr3\ntaeGut1\ntaeGut2\ntarSyr1\ntarSyr2\ntetNig1\ntetNig2\nthaSir1\ntriMan1\ntupBel1\nturTru2\nventer1\nvicPac1\nvicPac2\nxenLae2\nxenTro1\nxenTro2\nxenTro3\nxenTro7\nxenTro9`.split(/\\r?\\n/)\n","import objectHash from 'object-hash'\nimport { GenomesFile, HubFile, TrackDbFile } from '@gmod/ucsc-hub'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport {\n  generateUnsupportedTrackConf,\n  generateUnknownTrackConf,\n} from '@jbrowse/core/util/tracks'\nimport ucscAssemblies from './ucscAssemblies'\n\nexport { ucscAssemblies }\n\nexport async function fetchHubFile(hubFileLocation) {\n  try {\n    const hubFileText = await openLocation(hubFileLocation).readFile('utf8')\n    return new HubFile(hubFileText)\n  } catch (error) {\n    throw new Error(`Not a valid hub.txt file, got error: '${error}'`)\n  }\n}\n\nexport async function fetchGenomesFile(genomesFileLocation) {\n  const genomesFileText = await openLocation(genomesFileLocation).readFile(\n    'utf8',\n  )\n  return new GenomesFile(genomesFileText)\n}\n\nexport async function fetchTrackDbFile(trackDbFileLocation) {\n  const trackDbFileText = await openLocation(trackDbFileLocation).readFile(\n    'utf8',\n  )\n  return new TrackDbFile(trackDbFileText)\n}\n\nexport function generateTracks(\n  trackDb,\n  trackDbFileLocation,\n  assemblyName,\n  sequenceAdapter,\n) {\n  const tracks = []\n\n  trackDb.forEach((track, trackName) => {\n    const trackKeys = Array.from(track.keys())\n    const parentTrackKeys = [\n      'superTrack',\n      'compositeTrack',\n      'container',\n      'view',\n    ]\n    if (trackKeys.some(key => parentTrackKeys.includes(key))) return\n    const parentTracks = []\n    let currentTrackName = trackName\n    do {\n      currentTrackName = trackDb.get(currentTrackName).get('parent')\n      if (currentTrackName) {\n        ;[currentTrackName] = currentTrackName.split(' ')\n        parentTracks.push(trackDb.get(currentTrackName))\n      }\n    } while (currentTrackName)\n    parentTracks.reverse()\n    const categories = parentTracks.map(parentTrack =>\n      parentTrack.get('shortLabel'),\n    )\n    const res = makeTrackConfig(\n      track,\n      categories,\n      trackDbFileLocation,\n      trackDb,\n      sequenceAdapter,\n    )\n    res.trackId = `ucsc-trackhub-${objectHash(res)}`\n    res.assemblyNames = [assemblyName]\n    tracks.push(res)\n  })\n\n  return tracks\n}\n\nfunction makeTrackConfig(\n  track,\n  categories,\n  trackDbFileLocation,\n  trackDb,\n  sequenceAdapter,\n) {\n  let trackType = track.get('type')\n  if (!trackType) trackType = trackDb.get(track.get('parent')).get('type')\n  let baseTrackType = trackType.split(' ')[0]\n  if (\n    baseTrackType === 'bam' &&\n    track.get('bigDataUrl').toLowerCase().endsWith('cram')\n  )\n    baseTrackType = 'cram'\n  let bigDataLocation\n  if (trackDbFileLocation.uri)\n    bigDataLocation = {\n      uri: new URL(track.get('bigDataUrl'), trackDbFileLocation.uri).href,\n    }\n  else bigDataLocation = { localPath: track.get('bigDataUrl') }\n  let bigDataIndexLocation\n\n  switch (baseTrackType) {\n    case 'bam':\n      if (trackDbFileLocation.uri)\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              uri: new URL(track.get('bigDataIndex'), trackDbFileLocation.uri)\n                .href,\n            }\n          : {\n              uri: new URL(\n                `${track.get('bigDataUrl')}.bai`,\n                trackDbFileLocation.uri,\n              ).href,\n            }\n      else\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? { localPath: track.get('bigDataIndex') }\n          : { localPath: `${track.get('bigDataUrl')}.bai` }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BamAdapter',\n          bamLocation: bigDataLocation,\n          index: {\n            location: bigDataIndexLocation,\n          },\n        },\n      }\n    case 'bed':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bed5FloatScore':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bedGraph':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bedRnaElements':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bigBarChart':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigBed':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'bigGenePred':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'bigChain':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigInteract':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigMaf':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigPsl':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigWig':\n      return {\n        type: 'QuantitativeTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigWigAdapter',\n          bigWigLocation: bigDataLocation,\n        },\n      }\n    case 'broadPeak':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'coloredExon':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'cram':\n      if (trackDbFileLocation.uri)\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              uri: new URL(track.get('bigDataIndex'), trackDbFileLocation.uri)\n                .href,\n            }\n          : {\n              uri: new URL(\n                `${track.get('bigDataUrl')}.crai`,\n                trackDbFileLocation.uri,\n              ).href,\n            }\n      else\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? { localPath: track.get('bigDataIndex') }\n          : { localPath: `${track.get('bigDataUrl')}.crai` }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'CramAdapter',\n          cramLocation: bigDataLocation,\n          craiLocation: bigDataIndexLocation,\n          sequenceAdapter,\n        },\n      }\n    case 'gvf':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'ld2':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'narrowPeak':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bigNarrowPeak':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'peptideMapping':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'vcfTabix':\n      if (trackDbFileLocation.uri)\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              uri: new URL(track.get('bigDataIndex'), trackDbFileLocation.uri)\n                .href,\n            }\n          : {\n              uri: new URL(\n                `${track.get('bigDataUrl')}.tbi`,\n                trackDbFileLocation.uri,\n              ).href,\n            }\n      else\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? { localPath: track.get('bigDataIndex') }\n          : { localPath: `${track.get('bigDataUrl')}.tbi` }\n      return {\n        type: 'VariantTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'VcfTabixAdapter',\n          vcfGzLocation: bigDataLocation,\n          index: {\n            location: bigDataIndexLocation,\n          },\n        },\n      }\n    case 'wig':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'wigMaf':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'hic':\n      return {\n        type: 'HicTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'HicAdapter',\n          hicLocation: bigDataLocation,\n        },\n      }\n    case 'halSnake':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n\n    default:\n      return generateUnknownTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n  }\n}\n","import { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport {\n  ConfigurationReference,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { types } from 'mobx-state-tree'\nimport configSchema from './configSchema'\nimport {\n  fetchGenomesFile,\n  fetchHubFile,\n  fetchTrackDbFile,\n  generateTracks,\n} from './ucscTrackHub'\n\nexport default function (pluginManager) {\n  return types.compose(\n    'UCSCTrackHubConnection',\n    BaseConnectionModelFactory(pluginManager),\n    types\n      .model({\n        configuration: ConfigurationReference(configSchema),\n        type: types.literal('UCSCTrackHubConnection'),\n      })\n      .actions(self => ({\n        connect() {\n          const connectionName = readConfObject(self.configuration, 'name')\n          const hubFileLocation = readConfObject(\n            self.configuration,\n            'hubTxtLocation',\n          )\n          const assemblyName = readConfObject(\n            self.configuration,\n            'assemblyName',\n          )\n          const session = getSession(self)\n          const assemblyConf = session.assemblies.find(\n            assembly => readConfObject(assembly, 'name') === assemblyName,\n          )\n          fetchHubFile(hubFileLocation)\n            .then(hubFile => {\n              let genomesFileLocation\n              if (hubFileLocation.uri)\n                genomesFileLocation = {\n                  uri: new URL(hubFile.get('genomesFile'), hubFileLocation.uri)\n                    .href,\n                }\n              else\n                genomesFileLocation = { localPath: hubFile.get('genomesFile') }\n              return Promise.all([\n                hubFile,\n                fetchGenomesFile(genomesFileLocation),\n              ])\n            })\n            .then(([hubFile, genomesFile]) => {\n              if (!genomesFile.has(assemblyName))\n                throw new Error(\n                  `Assembly \"${assemblyName}\" not in genomes file from connection \"${connectionName}\"`,\n                )\n              // const twoBitPath = genomesFile.get(assemblyName).get('twoBitPath')\n              let trackDbFileLocation\n              if (hubFileLocation.uri)\n                trackDbFileLocation = {\n                  uri: new URL(\n                    genomesFile.get(assemblyName).get('trackDb'),\n                    new URL(hubFile.get('genomesFile'), hubFileLocation.uri),\n                  ).href,\n                }\n              else\n                trackDbFileLocation = {\n                  localPath: genomesFile.get(assemblyName).get('trackDb'),\n                }\n              return Promise.all([\n                trackDbFileLocation,\n                fetchTrackDbFile(trackDbFileLocation),\n              ])\n            })\n            .then(([trackDbFileLocation, trackDbFile]) => {\n              const sequenceAdapter = readConfObject(assemblyConf, [\n                'sequence',\n                'adapter',\n              ])\n              const tracks = generateTracks(\n                trackDbFile,\n                trackDbFileLocation,\n                assemblyName,\n                sequenceAdapter,\n              )\n              self.setTrackConfs(tracks)\n            })\n            .catch(error => {\n              console.error(error)\n              session.notify(\n                `There was a problem connecting to the UCSC Track Hub \"${self.name}\". Please make sure you have entered a valid hub.txt file. The error that was thrown is: \"${error}\"`,\n                'error',\n              )\n              session.breakConnection(self.configuration)\n            })\n        },\n      })),\n  )\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport {\n  guessAdapter,\n  guessTrackType,\n  UNKNOWN,\n  UNSUPPORTED,\n} from '@jbrowse/core/util/tracks'\nimport Link from '@material-ui/core/Link'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport { makeStyles } from '@material-ui/core/styles'\nimport TextField from '@material-ui/core/TextField'\nimport Typography from '@material-ui/core/Typography'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React, { useState, useEffect } from 'react'\n\nconst useStyles = makeStyles(theme => ({\n  spacing: {\n    marginBottom: theme.spacing(3),\n  },\n}))\n\n/**\n * check if a string looks like an abolute URL, e.g. a\n * full URL e.g. \"https://mysite.org/myfile.txt\",\n * implicit protocol URL e.g. \"//mysite.org/myfile.txt\", or\n * implicit domain name URL e.g. \"/myfile.txt\"\n * @param {String} url URL\n */\nfunction isAbsoluteUrl(url) {\n  try {\n    // eslint-disable-next-line no-new\n    new URL(url)\n    return true\n  } catch (error) {\n    return url.startsWith('/')\n  }\n}\n\nfunction ConfirmTrack({\n  trackData,\n  trackName,\n  fileName,\n  indexTrackData,\n  setTrackAdapter,\n  setTrackName,\n  trackType,\n  setTrackType,\n  trackAdapter,\n  assembly,\n  setAssembly,\n  session,\n}) {\n  const classes = useStyles()\n  const [error, setError] = useState()\n  useEffect(() => {\n    if (trackData.uri) {\n      const adapter = guessAdapter(trackData.uri, 'uri', indexTrackData.uri)\n      setTrackAdapter(adapter)\n      setTrackType(guessTrackType(adapter.type))\n\n      // check for ftp url inputs\n      if (\n        (indexTrackData.uri && indexTrackData.uri.startsWith('ftp://')) ||\n        trackData.uri.startsWith('ftp://')\n      ) {\n        setError(`Warning: JBrowse cannot access files using the ftp protocol`)\n      }\n\n      // check for whether the user entered an absolute URL\n      else if (\n        !(\n          (indexTrackData.uri && isAbsoluteUrl(indexTrackData.uri)) ||\n          isAbsoluteUrl(trackData.uri)\n        )\n      ) {\n        setError(\n          `Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.`,\n        )\n      }\n\n      // check for accessing an http url when we are running on https, which is\n      // disallowed\n      else if (\n        window.location.protocol === 'https:' &&\n        ((indexTrackData.uri && indexTrackData.uri.startsWith('http://')) ||\n          trackData.uri.startsWith('http://'))\n      ) {\n        setError(\n          `Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol`,\n        )\n      }\n    }\n    if (trackData.localPath) {\n      const adapter = guessAdapter(trackData.localPath, 'localPath')\n      setTrackAdapter(adapter)\n      setTrackType(guessTrackType(adapter.type))\n    }\n    if (trackData.config) setTrackAdapter({ type: 'FromConfigAdapter' })\n  }, [trackData, setTrackAdapter, indexTrackData, setTrackType])\n\n  function handleAssemblyChange(event) {\n    setAssembly(event.target.value)\n  }\n\n  if (trackAdapter.type === UNSUPPORTED)\n    return (\n      <Typography className={classes.spacing}>\n        This version of JBrowse cannot display data of this type. It is\n        possible, however, that there is a newer version that can display them.\n        You can{' '}\n        <Link\n          href=\"https://github.com/GMOD/jbrowse-components/releases\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          check for new releases\n        </Link>{' '}\n        of JBrowse or{' '}\n        <Link\n          href=\"https://github.com/GMOD/jbrowse-components/issues/new\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          file an issue\n        </Link>{' '}\n        and add a feature request for this data type.\n      </Typography>\n    )\n  if (trackAdapter.type === UNKNOWN)\n    return (\n      <>\n        <Typography className={classes.spacing}>\n          Was not able to guess the adapter type for this data, but it may be in\n          the list below. If not, you can{' '}\n          <Link\n            href=\"https://github.com/GMOD/jbrowse-components/releases\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            check for new releases\n          </Link>{' '}\n          of JBrowse to see if they support this data type or{' '}\n          <Link\n            href=\"https://github.com/GMOD/jbrowse-components/issues/new\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            file an issue\n          </Link>{' '}\n          and add a feature request for this data type.\n        </Typography>\n        <TextField\n          className={classes.spacing}\n          value={trackAdapter}\n          label=\"adapterType\"\n          helperText=\"An adapter type\"\n          select\n          fullWidth\n          onChange={event => {\n            setTrackAdapter({ type: event.target.value })\n            setTrackType(guessTrackType(event.target.value))\n          }}\n          SelectProps={{\n            SelectDisplayProps: { 'data-testid': 'adapterTypeSelect' },\n          }}\n        >\n          {session.pluginManager.getElementTypesInGroup('adapter').map(\n            installedAdapterType =>\n              // Exclude SNPCoverageAdapter from primary adapter user selection\n              installedAdapterType.name !== 'SNPCoverageAdapter' && (\n                <MenuItem\n                  key={installedAdapterType.name}\n                  value={installedAdapterType.name}\n                >\n                  {installedAdapterType.name}\n                </MenuItem>\n              ),\n          )}\n        </TextField>\n      </>\n    )\n  if (!trackAdapter.type)\n    // TODO: if file type is unrecognized, provide some way of specifying\n    // adapter and guessing reasonable default for it.\n    return <Typography>Could not recognize this data type.</Typography>\n  if (trackData.uri || trackData.localPath || trackData.config) {\n    let message = null\n    if (trackData.uri || trackData.localPath) {\n      message =\n        trackAdapter.type === 'SNPCoverageAdapter' ? (\n          <Typography className={classes.spacing}>\n            Selected <code>{trackType}</code>. Using adapter{' '}\n            <code>{trackAdapter.type}</code> with subadapter{' '}\n            <code>{trackAdapter.subadapter.type}</code>. Please enter a track\n            name and, if necessary, update the track type.\n          </Typography>\n        ) : (\n          <Typography className={classes.spacing}>\n            Using adapter <code>{trackAdapter.type}</code> and guessing track\n            type <code>{trackType}</code>. Please enter a track name and, if\n            necessary, update the track type.\n          </Typography>\n        )\n    } else {\n      message = (\n        <Typography className={classes.spacing}>\n          Please enter a track type and track name.\n        </Typography>\n      )\n    }\n    return (\n      <>\n        {message}\n        {error ? (\n          <Typography style={{ color: 'orange' }}>{error}</Typography>\n        ) : null}\n        <TextField\n          className={classes.spacing}\n          label=\"trackName\"\n          helperText=\"A name for this track\"\n          fullWidth\n          value={trackName || fileName}\n          onChange={event => setTrackName(event.target.value)}\n          inputProps={{ 'data-testid': 'trackNameInput' }}\n        />\n        <TextField\n          className={classes.spacing}\n          value={trackType}\n          label=\"trackType\"\n          helperText=\"A track type\"\n          select\n          fullWidth\n          onChange={event => {\n            setTrackType(event.target.value)\n          }}\n          SelectProps={{\n            SelectDisplayProps: { 'data-testid': 'trackTypeSelect' },\n          }}\n        >\n          {session.pluginManager\n            .getElementTypesInGroup('track')\n            .map(installedTrackType => (\n              <MenuItem\n                key={installedTrackType.name}\n                value={installedTrackType.name}\n              >\n                {installedTrackType.name}\n              </MenuItem>\n            ))}\n        </TextField>\n        <TextField\n          value={assembly}\n          label=\"assemblyName\"\n          helperText=\"Assembly to which the track will be added\"\n          select\n          fullWidth\n          onChange={handleAssemblyChange}\n          SelectProps={{\n            SelectDisplayProps: { 'data-testid': 'assemblyNameSelect' },\n          }}\n        >\n          {session.assemblies.map(assemblyConf => {\n            const assemblyName = readConfObject(assemblyConf, 'name')\n            return (\n              <MenuItem key={assemblyName} value={assemblyName}>\n                {assemblyName}\n              </MenuItem>\n            )\n          })}\n        </TextField>\n      </>\n    )\n  }\n  return <></>\n}\n\nConfirmTrack.propTypes = {\n  assembly: PropTypes.oneOfType([\n    PropTypes.string,\n    MobxPropTypes.observableObject,\n  ]),\n  setAssembly: PropTypes.func.isRequired,\n  trackData: PropTypes.shape({\n    uri: PropTypes.string,\n    localPath: PropTypes.string,\n    config: PropTypes.array,\n  }).isRequired,\n  indexTrackData: PropTypes.shape({\n    uri: PropTypes.string,\n    localPath: PropTypes.string,\n    config: PropTypes.array,\n  }).isRequired,\n  trackName: PropTypes.string.isRequired,\n  fileName: PropTypes.string,\n  setTrackName: PropTypes.func.isRequired,\n  trackType: PropTypes.string,\n  setTrackType: PropTypes.func.isRequired,\n  trackAdapter: PropTypes.shape({\n    type: PropTypes.string,\n    subadapter: PropTypes.shape({\n      type: PropTypes.string,\n    }),\n  }).isRequired,\n  setTrackAdapter: PropTypes.func.isRequired,\n  session: MobxPropTypes.observableObject.isRequired,\n}\n\nConfirmTrack.defaultProps = {\n  assembly: '',\n  trackType: '',\n  fileName: '',\n}\n\nexport default observer(ConfirmTrack)\n","import { FileSelector } from '@jbrowse/core/ui'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/core/styles'\nimport PropTypes from 'prop-types'\nimport React from 'react'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n  },\n  paper: {\n    padding: theme.spacing(1),\n  },\n}))\n\nfunction TrackSourceSelect({\n  indexTrackData,\n  setIndexTrackData,\n  trackData,\n  setTrackData,\n}) {\n  const classes = useStyles()\n  return (\n    <div className={classes.root}>\n      <Paper className={classes.paper}>\n        <FileSelector\n          name=\"URL\"\n          description=\"\"\n          location={trackData}\n          setLocation={setTrackData}\n        />\n        <FileSelector\n          name=\"Index URL (optional)\"\n          description=\"Automatically inferred from the URL if not supplied\"\n          location={indexTrackData}\n          setLocation={setIndexTrackData}\n        />\n      </Paper>\n    </div>\n  )\n}\n\nTrackSourceSelect.propTypes = {\n  trackData: PropTypes.objectOf(PropTypes.any).isRequired,\n  indexTrackData: PropTypes.objectOf(PropTypes.any).isRequired,\n  setTrackData: PropTypes.func.isRequired,\n  setIndexTrackData: PropTypes.func.isRequired,\n}\n\nexport default TrackSourceSelect\n","import { getSession } from '@jbrowse/core/util'\nimport { getConf } from '@jbrowse/core/configuration'\nimport Button from '@material-ui/core/Button'\nimport Step from '@material-ui/core/Step'\nimport StepContent from '@material-ui/core/StepContent'\nimport StepLabel from '@material-ui/core/StepLabel'\nimport Stepper from '@material-ui/core/Stepper'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Typography from '@material-ui/core/Typography'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport React, { useState } from 'react'\nimport ConfirmTrack from './ConfirmTrack'\nimport TrackSourceSelect from './TrackSourceSelect'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    marginTop: theme.spacing(1),\n  },\n  stepper: {\n    backgroundColor: theme.palette.background.default,\n  },\n  button: {\n    marginTop: theme.spacing(1),\n    marginRight: theme.spacing(1),\n  },\n  actionsContainer: {\n    marginBottom: theme.spacing(2),\n  },\n  stepContent: {\n    margin: theme.spacing(1),\n  },\n}))\n\nconst steps = ['Enter track data', 'Confirm track type']\n\nfunction AddTrackWidget({ model }) {\n  const [activeStep, setActiveStep] = useState(0)\n  const [trackSource, setTrackSource] = useState('fromFile')\n  const [trackData, setTrackData] = useState({ uri: '' })\n  const [indexTrackData, setIndexTrackData] = useState({ uri: '' })\n  const [trackName, setTrackName] = useState('')\n  const [trackType, setTrackType] = useState('')\n  const [trackAdapter, setTrackAdapter] = useState({})\n  const [assembly, setAssembly] = useState(\n    model.view.displayedRegions[0].assemblyName || '',\n  )\n  const classes = useStyles()\n  const fileName = trackData.uri\n    ? trackData.uri.slice(trackData.uri.lastIndexOf('/') + 1)\n    : null\n\n  const session = getSession(model)\n\n  function getStepContent(step) {\n    switch (step) {\n      case 0:\n        return (\n          <TrackSourceSelect\n            trackSource={trackSource}\n            setTrackSource={setTrackSource}\n            trackData={trackData}\n            setTrackData={setTrackData}\n            indexTrackData={indexTrackData}\n            setIndexTrackData={setIndexTrackData}\n          />\n        )\n      case 1:\n        return (\n          <ConfirmTrack\n            fileName={fileName}\n            session={session}\n            indexTrackData={indexTrackData}\n            trackData={trackData}\n            trackName={trackName}\n            setTrackName={setTrackName}\n            trackType={trackType}\n            setTrackType={setTrackType}\n            trackAdapter={trackAdapter}\n            setTrackAdapter={setTrackAdapter}\n            assembly={assembly}\n            setAssembly={setAssembly}\n          />\n        )\n      default:\n        return <Typography>Unknown step</Typography>\n    }\n  }\n\n  function handleNext() {\n    if (activeStep !== steps.length - 1) {\n      setActiveStep(activeStep + 1)\n      return\n    }\n    trackAdapter.features = trackData.config\n    const trackId = `${trackName\n      .toLowerCase()\n      .replace(/ /g, '_')}-${Date.now()}`\n\n    const assemblyInstance = session.assemblyManager.get(assembly)\n    session.addTrackConf({\n      trackId,\n      type: trackType,\n      name: trackName || fileName,\n      assemblyNames: [assembly],\n      adapter: {\n        ...trackAdapter,\n        sequenceAdapter: getConf(assemblyInstance, ['sequence', 'adapter']),\n      },\n    })\n    if (model.view) {\n      model.view.showTrack(trackId)\n    } else {\n      session.notify(\n        'Open a new view, or use the track selector in an existing view, to view this track',\n        'info',\n      )\n    }\n    session.hideWidget(model)\n  }\n\n  function handleBack() {\n    setActiveStep(activeStep - 1)\n  }\n\n  function isNextDisabled() {\n    switch (activeStep) {\n      case 0:\n        return !(\n          trackData.uri ||\n          trackData.localPath ||\n          trackData.blob ||\n          trackData.config\n        )\n      case 1:\n        return !(\n          (trackName || fileName) &&\n          trackType &&\n          trackAdapter.type &&\n          assembly\n        )\n      default:\n        return true\n    }\n  }\n\n  return (\n    <div className={classes.root}>\n      <Stepper\n        className={classes.stepper}\n        activeStep={activeStep}\n        orientation=\"vertical\"\n      >\n        {steps.map((label, idx) => (\n          <Step key={label}>\n            <StepLabel>{label}</StepLabel>\n            <StepContent>\n              {getStepContent(idx)}\n              <div className={classes.actionsContainer}>\n                <Button\n                  disabled={activeStep === 0}\n                  onClick={handleBack}\n                  className={classes.button}\n                >\n                  Back\n                </Button>\n                <Button\n                  disabled={isNextDisabled()}\n                  variant=\"contained\"\n                  color=\"primary\"\n                  onClick={handleNext}\n                  className={classes.button}\n                  data-testid=\"addTrackNextButton\"\n                >\n                  {activeStep === steps.length - 1 ? 'Add' : 'Next'}\n                </Button>\n              </div>\n            </StepContent>\n          </Step>\n        ))}\n      </Stepper>\n    </div>\n  )\n}\n\nAddTrackWidget.propTypes = {\n  model: MobxPropTypes.observableObject.isRequired,\n}\n\nexport default observer(AddTrackWidget)\n","import { types } from 'mobx-state-tree'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\nexport default pluginManager =>\n  types.model('AddTrackModel', {\n    id: ElementId,\n    type: types.literal('AddTrackWidget'),\n    view: types.safeReference(\n      pluginManager.pluggableMstType('view', 'stateModel'),\n    ),\n  })\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as ReactComponent } from './components/AddTrackWidget'\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema('AddTrackWidget', {})\n","import { ConfigurationEditor } from '@jbrowse/plugin-config'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React from 'react'\n\nfunction ConfigureConnection(props) {\n  const { connectionType, model, setModelReady } = props\n  const ConfigEditorComponent =\n    connectionType.configEditorComponent || ConfigurationEditor\n\n  return (\n    <ConfigEditorComponent\n      model={{ target: model }}\n      setModelReady={setModelReady}\n    />\n  )\n}\n\nConfigureConnection.propTypes = {\n  connectionType: PropTypes.shape().isRequired,\n  model: MobxPropTypes.observableObject.isRequired,\n  setModelReady: PropTypes.func.isRequired,\n}\n\nexport default observer(ConfigureConnection)\n","import IconButton from '@material-ui/core/IconButton'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport TextField from '@material-ui/core/TextField'\nimport React from 'react'\nimport OpenInNewIcon from '@material-ui/icons/OpenInNew'\n\nimport ConnectionType from '@jbrowse/core/pluggableElementTypes/ConnectionType'\n\nfunction ConnectionTypeSelect(props: {\n  connectionTypeChoices: ConnectionType[]\n  connectionType: ConnectionType\n  setConnectionType: Function\n  assemblyNameChoices: string[]\n  assemblyName: string\n  setAssemblyName: Function\n}): JSX.Element {\n  const {\n    connectionTypeChoices,\n    connectionType,\n    setConnectionType,\n    assemblyNameChoices,\n    assemblyName,\n    setAssemblyName,\n  } = props\n\n  function handleChange(\n    event: React.ChangeEvent<{ name?: string; value: unknown }>,\n  ): void {\n    setConnectionType(\n      connectionTypeChoices.find(\n        (connectionTypeChoice: ConnectionType) =>\n          connectionTypeChoice.name === event.target.value,\n      ),\n    )\n  }\n\n  return (\n    <form autoComplete=\"off\">\n      <TextField\n        value={assemblyName}\n        label=\"assemblyName\"\n        helperText=\"Assembly to which the track will be added\"\n        select\n        fullWidth\n        onChange={(event): void => setAssemblyName(event.target.value)}\n        inputProps={{ 'data-testid': 'assemblyNameSelect' }}\n      >\n        {assemblyNameChoices.map(assemblyNameChoice => (\n          <MenuItem key={assemblyNameChoice} value={assemblyNameChoice}>\n            {assemblyNameChoice}\n          </MenuItem>\n        ))}\n      </TextField>\n      <TextField\n        value={connectionType.name || ''}\n        label=\"connectionType\"\n        helperText={\n          connectionType.description ? (\n            <>\n              {connectionType.description}\n              {connectionType.url ? (\n                <IconButton\n                  href={connectionType.url}\n                  rel=\"noopener noreferrer\"\n                  target=\"_blank\"\n                  color=\"secondary\"\n                >\n                  <OpenInNewIcon />\n                </IconButton>\n              ) : null}\n            </>\n          ) : null\n        }\n        select\n        fullWidth\n        onChange={handleChange}\n      >\n        {connectionTypeChoices.map((connectionTypeChoice: ConnectionType) => (\n          <MenuItem\n            key={connectionTypeChoice.name}\n            value={connectionTypeChoice.name}\n          >\n            {connectionTypeChoice.displayName || connectionTypeChoice.name}\n          </MenuItem>\n        ))}\n      </TextField>\n    </form>\n  )\n}\n\nexport default ConnectionTypeSelect\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport Button from '@material-ui/core/Button'\nimport Step from '@material-ui/core/Step'\nimport StepContent from '@material-ui/core/StepContent'\nimport StepLabel from '@material-ui/core/StepLabel'\nimport Stepper from '@material-ui/core/Stepper'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Typography from '@material-ui/core/Typography'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport React, { useState } from 'react'\nimport ConfigureConnection from './ConfigureConnection'\nimport ConnectionTypeSelect from './ConnectionTypeSelect'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    marginTop: theme.spacing(1),\n  },\n  stepper: {\n    backgroundColor: theme.palette.background.default,\n  },\n  button: {\n    marginTop: theme.spacing(1),\n    marginRight: theme.spacing(1),\n  },\n  actionsContainer: {\n    marginBottom: theme.spacing(2),\n  },\n}))\n\nconst steps = ['Select a Connection Type', 'Configure Connection']\n\nfunction AddConnectionWidget({ model }) {\n  const [connectionType, setConnectionType] = useState({})\n  const [configModel, setConfigModel] = useState({})\n  const [configModelReady, setConfigModelReady] = useState(true)\n  const [assemblyName, setAssemblyName] = useState('')\n  const [activeStep, setActiveStep] = useState(0)\n  const classes = useStyles()\n\n  const session = getSession(model)\n\n  const { pluginManager } = session\n\n  function handleSetConnectionType(newConnectionType) {\n    setConnectionType(newConnectionType)\n    setConfigModel(\n      newConnectionType.configSchema.create({\n        connectionId: `${newConnectionType.name}-${assemblyName}-${Date.now()}`,\n        assemblyName,\n      }),\n    )\n  }\n\n  function stepContent() {\n    switch (activeStep) {\n      case 0:\n        return (\n          <ConnectionTypeSelect\n            connectionTypeChoices={pluginManager.getElementTypesInGroup(\n              'connection',\n            )}\n            connectionType={connectionType}\n            setConnectionType={handleSetConnectionType}\n            assemblyNameChoices={session.assemblies.map(assembly =>\n              readConfObject(assembly, 'name'),\n            )}\n            assemblyName={assemblyName}\n            setAssemblyName={setAssemblyName}\n          />\n        )\n      case 1:\n        return (\n          <ConfigureConnection\n            connectionType={connectionType}\n            model={configModel}\n            setModelReady={setConfigModelReady}\n          />\n        )\n\n      default:\n        return <Typography>Unknown step</Typography>\n    }\n  }\n\n  function handleNext() {\n    if (activeStep === steps.length - 1) handleFinish()\n    else setActiveStep(activeStep + 1)\n  }\n\n  function handleBack() {\n    setActiveStep(activeStep - 1)\n  }\n\n  function handleFinish() {\n    const connectionConf = session.addConnectionConf(configModel)\n    session.makeConnection(connectionConf)\n    session.hideWidget(model)\n  }\n\n  function checkNextEnabled() {\n    if (\n      (activeStep === 0 && connectionType.name) ||\n      (activeStep === 1 && configModel && configModelReady)\n    )\n      return true\n    return false\n  }\n\n  return (\n    <div className={classes.root}>\n      <Stepper\n        className={classes.stepper}\n        activeStep={activeStep}\n        orientation=\"vertical\"\n      >\n        {steps.map(label => (\n          <Step key={label}>\n            <StepLabel>{label}</StepLabel>\n            <StepContent>\n              {stepContent()}\n              <div className={classes.actionsContainer}>\n                <Button\n                  disabled={activeStep === 0}\n                  onClick={handleBack}\n                  className={classes.button}\n                >\n                  Back\n                </Button>\n                <Button\n                  disabled={!checkNextEnabled()}\n                  variant=\"contained\"\n                  color=\"primary\"\n                  onClick={handleNext}\n                  className={classes.button}\n                  data-testid=\"addConnectionNext\"\n                >\n                  {activeStep === steps.length - 1 ? 'Connect' : 'Next'}\n                </Button>\n              </div>\n            </StepContent>\n          </Step>\n        ))}\n      </Stepper>\n    </div>\n  )\n}\n\nAddConnectionWidget.propTypes = {\n  model: MobxPropTypes.observableObject.isRequired,\n}\n\nexport default observer(AddConnectionWidget)\n","import { types } from 'mobx-state-tree'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\nexport default types.model('AddConnectionModel', {\n  id: ElementId,\n  type: types.literal('AddConnectionWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as ReactComponent } from './components/AddConnectionWidget'\nexport { default as stateModel } from './model'\nexport const configSchema = ConfigurationSchema('AddConnectionWidget', {})\n","import Accordion from '@material-ui/core/Accordion'\nimport AccordionDetails from '@material-ui/core/AccordionDetails'\nimport AccordionSummary from '@material-ui/core/AccordionSummary'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport propTypes from 'prop-types'\nimport React from 'react'\nimport ExpandIcon from '@material-ui/icons/ExpandMore'\nimport Contents from './Contents'\n\nconst useStyles = makeStyles(theme => ({\n  expansionPanelDetails: {\n    display: 'block',\n    padding: theme.spacing(1),\n  },\n  expandIcon: {\n    color: '#FFFFFF',\n  },\n}))\n\nfunction Category({\n  model,\n  path,\n  filterPredicate,\n  disabled,\n  connection,\n  assemblyName,\n}) {\n  const classes = useStyles()\n  const pathName = path.join('|')\n  const name = path[path.length - 1]\n\n  const allTracks = model.allTracksInCategoryPath(\n    path,\n    connection,\n    assemblyName,\n  )\n\n  const count = Object.keys(allTracks).length\n  const filteredCount = Object.values(allTracks).filter(filterPredicate).length\n\n  // don't categories that have all of their members filtered out\n  if (filteredCount === 0 && count !== 0) return null\n\n  return (\n    <Accordion\n      style={{ marginTop: '4px' }}\n      expanded={!model.collapsed.get(pathName)}\n      onChange={() => model.toggleCategory(pathName)}\n    >\n      <AccordionSummary\n        expandIcon={<ExpandIcon className={classes.expandIcon} />}\n      >\n        <Typography variant=\"body2\">{`${name}${\n          filteredCount ? ` (${filteredCount})` : ''\n        }`}</Typography>\n      </AccordionSummary>\n      <AccordionDetails className={classes.expansionPanelDetails}>\n        <Contents\n          model={model}\n          path={path}\n          filterPredicate={filterPredicate}\n          disabled={disabled}\n          connection={connection}\n          assemblyName={assemblyName}\n        />\n      </AccordionDetails>\n    </Accordion>\n  )\n}\n\nCategory.propTypes = {\n  assemblyName: propTypes.string,\n  model: MobxPropTypes.observableObject.isRequired,\n  path: propTypes.arrayOf(propTypes.string),\n  filterPredicate: propTypes.func,\n  disabled: propTypes.bool,\n  connection: MobxPropTypes.observableObject,\n}\n\nCategory.defaultProps = {\n  assemblyName: undefined,\n  filterPredicate: () => true,\n  path: [],\n  disabled: false,\n  connection: undefined,\n}\n\nexport default observer(Category)\n","import React, { useState } from 'react'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { Menu } from '@jbrowse/core/ui'\nimport Checkbox from '@material-ui/core/Checkbox'\nimport Fade from '@material-ui/core/Fade'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\nimport IconButton from '@material-ui/core/IconButton'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport HorizontalDots from '@material-ui/icons/MoreHoriz'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport propTypes from 'prop-types'\n\nconst useStyles = makeStyles(theme => ({\n  formControlLabel: {\n    marginLeft: 0,\n    '&:hover': {\n      textDecoration: 'none',\n      backgroundColor: fade(\n        theme.palette.text.primary,\n        theme.palette.action.hoverOpacity,\n      ),\n      // Reset on touch devices, it doesn't add specificity\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n    flexGrow: 1,\n    wordBreak: 'break-all',\n  },\n  checkbox: {\n    padding: 0,\n  },\n  track: {\n    display: 'flex',\n    flexDirection: 'row',\n  },\n  configureButton: {\n    padding: 2,\n  },\n}))\n\nfunction TrackEntry({ model, disabled, trackConf, assemblyName }) {\n  const classes = useStyles()\n  const [anchorEl, setAnchorEl] = useState(null)\n  const session = getSession(model)\n  const titleText = assemblyName\n    ? `The reference sequence for ${assemblyName}`\n    : readConfObject(trackConf, 'description')\n  const trackName = readConfObject(trackConf, 'name')\n  const trackId = readConfObject(trackConf, 'trackId')\n  const unsupported =\n    trackName &&\n    (trackName.endsWith('(Unsupported)') || trackName.endsWith('(Unknown)'))\n  const menuItems = session.getTrackActionMenuItems\n    ? session.getTrackActionMenuItems(trackConf)\n    : []\n\n  return (\n    <Fade in>\n      <div className={classes.track}>\n        <Tooltip title={titleText} placement=\"left\" enterDelay={500}>\n          <FormControlLabel\n            className={classes.formControlLabel}\n            control={\n              <Checkbox\n                inputProps={{\n                  'data-testid': `htsTrackEntry-${trackId}`,\n                }}\n                className={classes.checkbox}\n              />\n            }\n            label={\n              assemblyName ? `Reference Sequence (${assemblyName})` : trackName\n            }\n            checked={model.view.tracks.some(t => t.configuration === trackConf)}\n            onChange={() => model.view.toggleTrack(trackConf.trackId)}\n            disabled={disabled || unsupported}\n          />\n        </Tooltip>\n        {menuItems.length ? (\n          <IconButton\n            className={classes.configureButton}\n            onClick={event => {\n              setAnchorEl(event.currentTarget)\n            }}\n            color=\"secondary\"\n            data-testid={`htsTrackEntryMenu-${trackId}`}\n          >\n            <HorizontalDots />\n          </IconButton>\n        ) : null}\n        <Menu\n          anchorEl={anchorEl}\n          onMenuItemClick={(_, callback) => {\n            callback()\n            setAnchorEl(null)\n          }}\n          open={Boolean(anchorEl)}\n          onClose={() => {\n            setAnchorEl(null)\n          }}\n          menuItems={menuItems}\n        />\n      </div>\n    </Fade>\n  )\n}\n\nTrackEntry.propTypes = {\n  model: MobxPropTypes.observableObject.isRequired,\n  disabled: propTypes.bool,\n  trackConf: MobxPropTypes.objectOrObservableObject.isRequired,\n  assemblyName: propTypes.string,\n}\n\nTrackEntry.defaultProps = {\n  disabled: false,\n  assemblyName: null,\n}\n\nexport default observer(TrackEntry)\n","import Divider from '@material-ui/core/Divider'\nimport FormGroup from '@material-ui/core/FormGroup'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport propTypes from 'prop-types'\nimport React from 'react'\nimport Category from './Category'\nimport TrackEntry from './TrackEntry'\n\nconst useStyles = makeStyles(theme => ({\n  divider: {\n    marginTop: theme.spacing(2),\n    marginBottom: theme.spacing(2),\n  },\n}))\n\nfunction Contents({\n  model,\n  path,\n  filterPredicate,\n  disabled,\n  connection,\n  top,\n  assemblyName,\n}) {\n  const classes = useStyles()\n\n  let hierarchy = connection\n    ? model.connectionHierarchy(connection, assemblyName)\n    : model.hierarchy(assemblyName)\n\n  path.forEach(pathEntry => {\n    hierarchy = hierarchy.get(pathEntry) || new Map()\n  })\n\n  const trackConfigurations = []\n  const categories = []\n  Array.from(hierarchy)\n    .slice(0)\n    .forEach(([name, contents]) => {\n      if (contents.trackId) {\n        trackConfigurations.push(contents)\n      } else {\n        categories.push([name, contents])\n      }\n    })\n\n  const refSeqTrackConf = model.getRefSeqTrackConf(assemblyName)\n  const showRefSeqTrack = top && !connection && refSeqTrackConf\n\n  return (\n    <>\n      {showRefSeqTrack ? (\n        <>\n          <FormGroup>\n            <TrackEntry\n              model={model}\n              trackConf={refSeqTrackConf}\n              assemblyName={assemblyName}\n            />\n          </FormGroup>\n          <Divider className={classes.divider} />\n        </>\n      ) : null}\n      <FormGroup>\n        {trackConfigurations.filter(filterPredicate).map(trackConf => {\n          return (\n            <TrackEntry\n              key={trackConf.trackId}\n              model={model}\n              trackConf={trackConf}\n              disabled={disabled}\n            />\n          )\n        })}\n      </FormGroup>\n      {categories.sort().map(([name]) => (\n        <Category\n          key={name}\n          model={model}\n          path={path.concat([name])}\n          filterPredicate={filterPredicate}\n          disabled={disabled}\n          connection={connection}\n          assemblyName={assemblyName}\n        />\n      ))}\n    </>\n  )\n}\n\nContents.propTypes = {\n  assemblyName: propTypes.string,\n  model: MobxPropTypes.observableObject.isRequired,\n  path: propTypes.arrayOf(propTypes.string),\n  filterPredicate: propTypes.func,\n  disabled: propTypes.bool,\n  connection: MobxPropTypes.observableObject,\n  top: propTypes.bool,\n}\n\nContents.defaultProps = {\n  assemblyName: undefined,\n  filterPredicate: () => true,\n  path: [],\n  disabled: false,\n  connection: undefined,\n  top: false,\n}\n\nexport default observer(Contents)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Fab from '@material-ui/core/Fab'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\nimport FormGroup from '@material-ui/core/FormGroup'\nimport IconButton from '@material-ui/core/IconButton'\nimport InputAdornment from '@material-ui/core/InputAdornment'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport Menu from '@material-ui/core/Menu'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Switch from '@material-ui/core/Switch'\nimport Tab from '@material-ui/core/Tab'\nimport Tabs from '@material-ui/core/Tabs'\nimport TextField from '@material-ui/core/TextField'\nimport Typography from '@material-ui/core/Typography'\nimport ClearIcon from '@material-ui/icons/Clear'\nimport AddIcon from '@material-ui/icons/Add'\nimport CloseIcon from '@material-ui/icons/Close'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport React, { useState } from 'react'\nimport Contents from './Contents'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    textAlign: 'left',\n    padding: theme.spacing(1),\n  },\n  searchBox: {\n    marginBottom: theme.spacing(2),\n  },\n  fab: {\n    float: 'right',\n    position: 'sticky',\n    marginTop: theme.spacing(2),\n    bottom: theme.spacing(2),\n    right: theme.spacing(2),\n  },\n  connectionsPaper: {\n    padding: theme.spacing(1),\n    marginTop: theme.spacing(1),\n  },\n  tabs: {\n    marginBottom: theme.spacing(1),\n  },\n}))\n\nconst CloseConnectionDlg = observer(props => {\n  const { open, modalInfo, setModalInfo } = props\n  const { name, dereferenceTypeCount, safelyBreakConnection } = modalInfo || {}\n  return (\n    <Dialog\n      aria-labelledby=\"connection-modal-title\"\n      aria-describedby=\"connection-modal-description\"\n      open={open}\n    >\n      <DialogTitle>Close connection &quot;{name}&quot;</DialogTitle>\n      <DialogContent>\n        <>\n          {dereferenceTypeCount ? (\n            <>\n              <DialogContentText>\n                Closing this connection will close:\n              </DialogContentText>\n              <List>\n                {Object.entries(dereferenceTypeCount).map(([key, value]) => (\n                  <ListItem key={key}>{`${value} ${key}`}</ListItem>\n                ))}\n              </List>\n            </>\n          ) : null}\n          <DialogContentText>\n            Are you sure you want to close this connection?\n          </DialogContentText>\n        </>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          onClick={() => {\n            setModalInfo()\n          }}\n          color=\"primary\"\n        >\n          Cancel\n        </Button>\n        <Button\n          variant=\"contained\"\n          onClick={\n            modalInfo\n              ? () => {\n                  if (safelyBreakConnection) safelyBreakConnection()\n                  setModalInfo()\n                }\n              : () => {}\n          }\n          color=\"primary\"\n        >\n          OK\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n})\n\nconst DeleteConnectionDlg = observer(props => {\n  const { open, modalInfo, session, setModalInfo } = props\n  const { connectionConf, name, dereferenceTypeCount, safelyBreakConnection } =\n    modalInfo || {}\n  return (\n    <Dialog\n      aria-labelledby=\"connection-modal-title\"\n      aria-describedby=\"connection-modal-description\"\n      open={open}\n    >\n      <DialogTitle>Delete connection &quot;{name}&quot;</DialogTitle>\n      <DialogContent>\n        {dereferenceTypeCount ? (\n          <>\n            Closing this connection will close\n            <List>\n              {Object.entries(dereferenceTypeCount).map(([key, value]) => (\n                <ListItem key={key}>{`${value} ${key}`}</ListItem>\n              ))}\n            </List>\n          </>\n        ) : null}\n        <DialogContentText>\n          Are you sure you want to delete this connection?\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          onClick={() => {\n            setModalInfo()\n          }}\n          color=\"primary\"\n        >\n          Cancel\n        </Button>\n        <Button\n          variant=\"contained\"\n          onClick={\n            modalInfo\n              ? () => {\n                  if (safelyBreakConnection) safelyBreakConnection()\n                  session.deleteConnection(connectionConf)\n                  setModalInfo()\n                }\n              : () => {}\n          }\n          color=\"primary\"\n        >\n          OK\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n})\n\nfunction HierarchicalTrackSelector({ model }) {\n  const [anchorEl, setAnchorEl] = useState(null)\n  const [assemblyIdx, setAssemblyIdx] = useState(0)\n  const [modalInfo, setModalInfo] = useState()\n  const classes = useStyles()\n\n  const session = getSession(model)\n\n  function handleTabChange(event, newIdx) {\n    setAssemblyIdx(newIdx)\n  }\n\n  function handleFabClick(event) {\n    setAnchorEl(event.currentTarget)\n  }\n\n  function handleFabClose() {\n    setAnchorEl(null)\n  }\n\n  function handleInputChange(event) {\n    model.setFilterText(event.target.value)\n  }\n\n  function addConnection() {\n    handleFabClose()\n    const widget = session.addWidget(\n      'AddConnectionWidget',\n      'addConnectionWidget',\n    )\n    session.showWidget(widget)\n  }\n\n  function addTrack() {\n    handleFabClose()\n    const widget = session.addWidget('AddTrackWidget', 'addTrackWidget', {\n      view: model.view.id,\n    })\n    session.showWidget(widget)\n  }\n\n  function filter(trackConfig) {\n    if (!model.filterText) return true\n    const name = readConfObject(trackConfig, 'name')\n    return name.toLowerCase().includes(model.filterText.toLowerCase())\n  }\n\n  function handleConnectionToggle(connectionConf) {\n    const assemblyConnections = session.connectionInstances.get(assemblyName)\n    const existingConnection =\n      assemblyConnections &&\n      !!assemblyConnections.find(\n        connection =>\n          connection.name === readConfObject(connectionConf, 'name'),\n      )\n    if (existingConnection) {\n      breakConnection(connectionConf)\n    } else {\n      session.makeConnection(connectionConf)\n    }\n  }\n\n  function breakConnection(connectionConf, deleting = false) {\n    const name = readConfObject(connectionConf, 'name')\n    const result = session.prepareToBreakConnection(connectionConf)\n    if (result) {\n      const [safelyBreakConnection, dereferenceTypeCount] = result\n      // always popup a warning if deleting or tracks are going to be removed\n      // from view\n      if (Object.keys(dereferenceTypeCount).length > 0 || deleting) {\n        setModalInfo({\n          connectionConf,\n          safelyBreakConnection,\n          dereferenceTypeCount,\n          name,\n          deleting,\n        })\n      } else {\n        safelyBreakConnection()\n      }\n    } else if (deleting) {\n      setModalInfo({ name, deleting, connectionConf })\n    }\n  }\n\n  const { assemblyNames } = model\n  const assemblyName = assemblyNames[assemblyIdx]\n  if (!assemblyName) {\n    return null\n  }\n\n  const filterError =\n    model.trackConfigurations(assemblyName, session.tracks) > 0 &&\n    model.trackConfigurations(assemblyName, session.tracks).filter(filter)\n      .length === 0\n\n  return (\n    <div\n      key={model.view.id}\n      className={classes.root}\n      data-testid=\"hierarchical_track_selector\"\n    >\n      {assemblyNames.length > 1 ? (\n        <Tabs\n          className={classes.tabs}\n          value={assemblyIdx}\n          onChange={handleTabChange}\n        >\n          {assemblyNames.map((name, index) => (\n            <Tab key={`${name}-${index}`} label={name} />\n          ))}\n        </Tabs>\n      ) : null}\n      <TextField\n        className={classes.searchBox}\n        label=\"Filter Tracks\"\n        value={model.filterText}\n        error={filterError}\n        helperText={filterError ? 'No matches' : ''}\n        onChange={handleInputChange}\n        fullWidth\n        InputProps={{\n          endAdornment: (\n            <InputAdornment position=\"end\">\n              <IconButton color=\"secondary\" onClick={model.clearFilterText}>\n                <ClearIcon />\n              </IconButton>\n            </InputAdornment>\n          ),\n        }}\n      />\n      <Contents\n        model={model}\n        filterPredicate={filter}\n        assemblyName={assemblyName}\n        top\n      />\n      <FormGroup>\n        {session.connections\n          .filter(\n            connectionConf =>\n              readConfObject(connectionConf, 'assemblyName') === assemblyName,\n          )\n          .map(connectionConf => {\n            const name = readConfObject(connectionConf, 'name')\n            const id = connectionConf.connectionId\n            return (\n              <FormGroup row key={id}>\n                <FormControlLabel\n                  control={\n                    <Switch\n                      checked={\n                        session.connectionInstances.has(assemblyName) &&\n                        !!session.connectionInstances\n                          .get(assemblyName)\n                          .find(connection => connection.name === name)\n                      }\n                      onChange={() => handleConnectionToggle(connectionConf)}\n                    />\n                  }\n                  label={name}\n                />\n                <IconButton\n                  data-testid=\"delete-connection\"\n                  onClick={() => {\n                    breakConnection(connectionConf, true)\n                  }}\n                >\n                  <CloseIcon />\n                </IconButton>\n              </FormGroup>\n            )\n          })}\n      </FormGroup>\n      {session.connectionInstances.has(assemblyName) ? (\n        <>\n          <Typography variant=\"h5\">Connections</Typography>\n          {session.connectionInstances.get(assemblyName).map(connection => (\n            <Paper\n              key={connection.name}\n              className={classes.connectionsPaper}\n              elevation={8}\n            >\n              <Typography variant=\"h6\">{connection.name}</Typography>\n              <Contents\n                model={model}\n                filterPredicate={filter}\n                connection={connection}\n                assemblyName={assemblyName}\n                top\n              />\n            </Paper>\n          ))}\n        </>\n      ) : null}\n\n      <Fab color=\"secondary\" className={classes.fab} onClick={handleFabClick}>\n        <AddIcon />\n      </Fab>\n      <Menu\n        id=\"simple-menu\"\n        anchorEl={anchorEl}\n        open={Boolean(anchorEl)}\n        onClose={handleFabClose}\n      >\n        <MenuItem onClick={addConnection}>Add connection</MenuItem>\n        <MenuItem onClick={addTrack}>Add track</MenuItem>\n      </Menu>\n      <CloseConnectionDlg\n        modalInfo={modalInfo}\n        setModalInfo={setModalInfo}\n        open={Boolean(modalInfo) && !modalInfo.deleting}\n        session={session}\n      />\n      <DeleteConnectionDlg\n        modalInfo={modalInfo}\n        setModalInfo={setModalInfo}\n        open={Boolean(modalInfo) && modalInfo.deleting}\n        session={session}\n      />\n    </div>\n  )\n}\n\nHierarchicalTrackSelector.propTypes = {\n  model: MobxPropTypes.observableObject.isRequired,\n}\n\nexport default observer(HierarchicalTrackSelector)\n","import { types } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\nexport function generateHierarchy(trackConfigurations) {\n  const hierarchy = new Map()\n\n  trackConfigurations.forEach(trackConf => {\n    const categories = [...(readConfObject(trackConf, 'category') || [])]\n    if (trackConf.trackId.endsWith('sessionTrack')) {\n      categories.unshift(' Session tracks')\n    }\n\n    let currLevel = hierarchy\n    for (let i = 0; i < categories.length; i++) {\n      const category = categories[i]\n      if (!currLevel.has(category)) {\n        currLevel.set(category, new Map())\n      }\n      currLevel = currLevel.get(category)\n    }\n    currLevel.set(trackConf.trackId, trackConf)\n  })\n  return hierarchy\n}\n\nexport default pluginManager =>\n  types\n    .model('HierarchicalTrackSelectorWidget', {\n      id: ElementId,\n      type: types.literal('HierarchicalTrackSelectorWidget'),\n      collapsed: types.map(types.boolean), // map of category path -> boolean of whether it is collapsed\n      filterText: '',\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .actions(self => ({\n      setView(view) {\n        self.view = view\n      },\n      toggleCategory(pathName) {\n        self.collapsed.set(pathName, !self.collapsed.get(pathName))\n      },\n      clearFilterText() {\n        self.filterText = ''\n      },\n      setFilterText(newText) {\n        self.filterText = newText\n      },\n    }))\n    .views(self => ({\n      trackConfigurations(assemblyName, trackConfigurations) {\n        if (!self.view) {\n          return []\n        }\n\n        const relevantTrackConfigurations = trackConfigurations.filter(\n          trackConf => {\n            const trackConfAssemblies = readConfObject(\n              trackConf,\n              'assemblyNames',\n            )\n            if (!trackConfAssemblies.includes(assemblyName)) {\n              return false\n            }\n            const viewType = pluginManager.getViewType(self.view.type)\n            const compatibleDisplays = viewType.displayTypes.map(\n              displayType => displayType.name,\n            )\n            for (const display of trackConf.displays) {\n              if (compatibleDisplays.includes(display.type)) {\n                return true\n              }\n            }\n            return false\n          },\n        )\n        return relevantTrackConfigurations\n      },\n\n      getRefSeqTrackConf(assemblyName) {\n        const { assemblyManager } = getSession(self)\n        const assembly = assemblyManager.get(assemblyName)\n        const trackConf = assembly?.configuration.sequence\n        const viewType = pluginManager.getViewType(self.view.type)\n        if (trackConf) {\n          for (const display of trackConf.displays) {\n            if (\n              viewType.displayTypes.find(\n                displayType => displayType.name === display.type,\n              )\n            ) {\n              return trackConf\n            }\n          }\n        }\n        return undefined\n      },\n\n      get assemblyNames() {\n        return self.view ? self.view.assemblyNames : []\n      },\n\n      connectionTrackConfigurations(connection) {\n        if (!self.view) {\n          return []\n        }\n        const trackConfigurations = connection.tracks\n\n        const relevantTrackConfigurations = trackConfigurations.filter(\n          trackConf => {\n            const viewType = pluginManager.getViewType(self.view.type)\n            const compatibleDisplays = viewType.displayTypes.map(\n              displayType => displayType.name,\n            )\n            for (const display of trackConf.displays) {\n              if (compatibleDisplays.includes(display.type)) {\n                return true\n              }\n            }\n            return false\n          },\n        )\n        return relevantTrackConfigurations\n      },\n\n      hierarchy(assemblyName) {\n        const session = getSession(self)\n        return generateHierarchy(\n          self.trackConfigurations(assemblyName, session.tracks),\n        )\n      },\n\n      connectionHierarchy(connection) {\n        return generateHierarchy(self.connectionTrackConfigurations(connection))\n      },\n\n      // This recursively gets tracks from lower paths\n      allTracksInCategoryPath(path, connection, assemblyName) {\n        let currentHier = connection\n          ? self.connectionHierarchy(connection)\n          : self.hierarchy(assemblyName)\n        path.forEach(pathItem => {\n          currentHier = currentHier.get(pathItem) || new Map()\n        })\n        let tracks = {}\n        currentHier.forEach((contents, name) => {\n          if (contents.trackId) {\n            tracks[contents.trackId] = contents\n          } else {\n            tracks = Object.assign(\n              tracks,\n              self.allTracksInCategoryPath(path.concat([name])),\n            )\n          }\n        })\n        return tracks\n      },\n    }))\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as ReactComponent } from './components/HierarchicalTrackSelector'\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema(\n  'HierarchicalTrackSelectorWidget',\n  {},\n)\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { IconButton } from '@material-ui/core'\nimport Table from '@material-ui/core/Table'\nimport TableBody from '@material-ui/core/TableBody'\nimport TableCell from '@material-ui/core/TableCell'\nimport TableContainer from '@material-ui/core/TableContainer'\nimport TableHead from '@material-ui/core/TableHead'\nimport TableRow from '@material-ui/core/TableRow'\nimport Paper from '@material-ui/core/Paper'\nimport CreateIcon from '@material-ui/icons/Create'\nimport DeleteIcon from '@material-ui/icons/Delete'\n\n// local\nimport { readConfObject } from '@jbrowse/core/configuration'\n\nconst useStyles = makeStyles(() => ({\n  table: {\n    minWidth: 650,\n  },\n  buttonCell: {\n    padding: 3,\n  },\n  button: {\n    display: 'inline-block',\n    padding: 3,\n    minHeight: 0,\n    minWidth: 0,\n  },\n}))\n\nconst AssemblyTable = observer(\n  ({\n    rootModel,\n    setIsAssemblyBeingEdited,\n    setAssemblyBeingEdited,\n  }: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    rootModel: any\n    setIsAssemblyBeingEdited(arg: boolean): void\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    setAssemblyBeingEdited(arg: any): void\n  }) => {\n    const classes = useStyles()\n\n    function removeAssembly(name: string) {\n      rootModel.jbrowse.removeAssemblyConf(name)\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const rows = rootModel.jbrowse.assemblies.map((assembly: any) => {\n      const name = readConfObject(assembly, 'name')\n      const aliases = readConfObject(assembly, 'aliases')\n      return (\n        <TableRow key={name}>\n          <TableCell>{name}</TableCell>\n          <TableCell>{aliases ? aliases.toString() : ''}</TableCell>\n          <TableCell className={classes.buttonCell}>\n            <IconButton\n              data-testid={`${name}-edit`}\n              className={classes.button}\n              onClick={() => {\n                setIsAssemblyBeingEdited(true)\n                setAssemblyBeingEdited(assembly)\n              }}\n            >\n              <CreateIcon color=\"primary\" />\n            </IconButton>\n            <IconButton\n              data-testid={`${name}-delete`}\n              className={classes.button}\n              onClick={() => {\n                removeAssembly(name)\n              }}\n            >\n              <DeleteIcon color=\"error\" />\n            </IconButton>\n          </TableCell>\n        </TableRow>\n      )\n    })\n\n    return (\n      <TableContainer component={Paper}>\n        <Table>\n          <TableHead>\n            <TableRow>\n              <TableCell>Name</TableCell>\n              <TableCell>Aliases</TableCell>\n              <TableCell>Actions</TableCell>\n            </TableRow>\n          </TableHead>\n          <TableBody>{rows}</TableBody>\n        </Table>\n      </TableContainer>\n    )\n  },\n)\n\nexport default AssemblyTable\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport TextField from '@material-ui/core/TextField'\nimport FileSelector from '@jbrowse/core/ui/FileSelector'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport { Grid, MenuItem, Paper } from '@material-ui/core'\nimport { makeStyles, createStyles, Theme } from '@material-ui/core/styles'\nimport Button from '@material-ui/core/Button'\nimport AddIcon from '@material-ui/icons/Add'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      flexGrow: 1,\n      overflow: 'hidden',\n      padding: theme.spacing(0, 3),\n    },\n    paper: {\n      maxWidth: 400,\n      margin: `${theme.spacing(1)}px auto`,\n      padding: theme.spacing(2),\n    },\n    createButton: {\n      margin: `5px 0px 5px 200px`,\n    },\n    paperContent: {\n      flex: 'auto',\n      margin: `${theme.spacing(1)}px auto`,\n      padding: theme.spacing(1),\n      overflow: 'auto',\n    },\n  }),\n)\n\nconst AdapterSelector = observer(\n  ({\n    adapterSelection,\n    setAdapterSelection,\n    adapterTypes,\n  }: {\n    adapterSelection: string\n    setAdapterSelection: Function\n    adapterTypes: Array<string>\n  }) => {\n    return (\n      <TextField\n        value={adapterSelection}\n        label=\"Type\"\n        select\n        helperText=\"Type of adapter to use\"\n        fullWidth\n        onChange={event => {\n          setAdapterSelection(event.target.value)\n        }}\n      >\n        {adapterTypes.map(str => (\n          <MenuItem key={str} value={str}>\n            {str}\n          </MenuItem>\n        ))}\n      </TextField>\n    )\n  },\n)\n\nconst AdapterInput = observer(\n  ({\n    adapterSelection,\n    fastaLocation,\n    setFastaLocation,\n    faiLocation,\n    setFaiLocation,\n    gziLocation,\n    setGziLocation,\n    twoBitLocation,\n    setTwoBitLocation,\n  }: {\n    adapterSelection: string\n    fastaLocation: FileLocation\n    setFastaLocation: Function\n    faiLocation: FileLocation\n    setFaiLocation: Function\n    gziLocation: FileLocation\n    setGziLocation: Function\n    twoBitLocation: FileLocation\n    setTwoBitLocation: Function\n  }) => {\n    if (\n      adapterSelection === 'IndexedFastaAdapter' ||\n      adapterSelection === 'BgzipFastaAdapter'\n    ) {\n      return (\n        <Grid container spacing={2}>\n          <Grid item>\n            <FileSelector\n              name=\"fastaLocation\"\n              location={fastaLocation}\n              setLocation={loc => setFastaLocation(loc)}\n            />\n          </Grid>\n          <Grid item>\n            <FileSelector\n              name=\"faiLocation\"\n              location={faiLocation}\n              setLocation={loc => setFaiLocation(loc)}\n            />\n          </Grid>\n          {adapterSelection === 'BgzipFastaAdapter' ? (\n            <Grid item>\n              <FileSelector\n                name=\"gziLocation\"\n                location={gziLocation}\n                setLocation={loc => setGziLocation(loc)}\n              />\n            </Grid>\n          ) : null}\n        </Grid>\n      )\n    }\n\n    if (adapterSelection === 'TwoBitAdapter') {\n      return (\n        <FileSelector\n          name=\"twoBitLocation\"\n          location={twoBitLocation}\n          setLocation={loc => setTwoBitLocation(loc)}\n        />\n      )\n    }\n\n    return null\n  },\n)\n\nconst AssemblyAddForm = observer(\n  ({\n    rootModel,\n    setFormOpen,\n  }: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    rootModel: any\n    setFormOpen: Function\n  }) => {\n    const classes = useStyles()\n\n    const adapterTypes = [\n      'IndexedFastaAdapter',\n      'BgzipFastaAdapter',\n      'TwoBitAdapter',\n    ]\n\n    const [assemblyName, setAssemblyName] = useState('')\n    const [adapterSelection, setAdapterSelection] = useState(adapterTypes[0])\n    const [fastaLocation, setFastaLocation] = useState({ uri: '' })\n    const [faiLocation, setFaiLocation] = useState({ uri: '' })\n    const [gziLocation, setGziLocation] = useState({ uri: '' })\n    const [twoBitLocation, setTwoBitLocation] = useState({ uri: '' })\n\n    function createAssembly() {\n      if (assemblyName === '') {\n        rootModel.session.notify(\"Can't create an assembly without a name\")\n      } else {\n        setFormOpen(false)\n        // setIsAssemblyBeingEdited(true)\n        let newAssembly\n        if (adapterSelection === 'IndexedFastaAdapter') {\n          newAssembly = {\n            name: assemblyName,\n            sequence: {\n              adapter: {\n                type: 'IndexedFastaAdapter',\n                fastaLocation,\n                faiLocation,\n              },\n            },\n          }\n        } else if (adapterSelection === 'BgzipFastaAdapter') {\n          newAssembly = {\n            name: assemblyName,\n            sequence: {\n              adapter: {\n                type: 'BgzipFastaAdapter',\n                fastaLocation,\n                faiLocation,\n                gziLocation,\n              },\n            },\n          }\n        } else if (adapterSelection === 'TwoBitAdapter') {\n          newAssembly = {\n            name: assemblyName,\n            sequence: {\n              adapter: {\n                type: 'TwoBitAdapter',\n                twoBitLocation,\n              },\n            },\n          }\n        }\n        rootModel.jbrowse.addAssemblyConf(newAssembly)\n        rootModel.session.notify(\n          `Successfully added ${assemblyName} assembly to JBrowse 2`,\n          'success',\n        )\n      }\n    }\n\n    return (\n      <div className={classes.root}>\n        <Paper className={classes.paper}>\n          <TextField\n            id=\"assembly-name\"\n            inputProps={{ 'data-testid': 'assembly-name' }}\n            label=\"Assembly Name\"\n            variant=\"outlined\"\n            value={assemblyName}\n            onChange={event => setAssemblyName(event.target.value)}\n          />\n          <AdapterSelector\n            adapterSelection={adapterSelection}\n            setAdapterSelection={setAdapterSelection}\n            adapterTypes={adapterTypes}\n          />\n          <div className={classes.paperContent}>\n            <AdapterInput\n              adapterSelection={adapterSelection}\n              fastaLocation={fastaLocation}\n              setFastaLocation={setFastaLocation}\n              faiLocation={faiLocation}\n              setFaiLocation={setFaiLocation}\n              gziLocation={gziLocation}\n              setGziLocation={setGziLocation}\n              twoBitLocation={twoBitLocation}\n              setTwoBitLocation={setTwoBitLocation}\n            />\n          </div>\n        </Paper>\n        <Button\n          className={classes.createButton}\n          variant=\"contained\"\n          color=\"secondary\"\n          startIcon={<AddIcon />}\n          onClick={createAssembly}\n        >\n          Create new assembly\n        </Button>\n      </div>\n    )\n  },\n)\n\nexport default AssemblyAddForm\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { ConfigurationEditor } from '@jbrowse/plugin-config'\n\nconst AssemblyEditor = observer(\n  ({\n    assembly,\n  }: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    assembly: any\n  }) => {\n    return <ConfigurationEditor model={{ target: assembly }} />\n  },\n)\n\nexport default AssemblyEditor\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport AddIcon from '@material-ui/icons/Add'\nimport ArrowBackIosIcon from '@material-ui/icons/ArrowBackIos'\nimport { IconButton } from '@material-ui/core/'\n\nimport AssemblyTable from './AssemblyTable'\nimport AssemblyAddForm from './AssemblyAddForm'\nimport AssemblyEditor from './AssemblyEditor'\n\nconst useStyles = makeStyles(theme => ({\n  titleBox: {\n    color: '#fff',\n    backgroundColor: theme.palette.primary.main,\n    textAlign: 'center',\n  },\n  dialogContent: {\n    width: 600,\n  },\n  backButton: {\n    color: '#fff',\n    position: 'absolute',\n    left: theme.spacing(4),\n    top: theme.spacing(4),\n  },\n}))\n\nconst AssemblyManager = observer(\n  ({\n    rootModel,\n    open,\n    onClose,\n  }: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    rootModel: any\n    open: boolean\n    onClose: Function\n  }) => {\n    const classes = useStyles()\n    const [isFormOpen, setFormOpen] = useState(false)\n    const [isAssemblyBeingEdited, setIsAssemblyBeingEdited] = useState(false)\n    const [assemblyBeingEdited, setAssemblyBeingEdited] = useState()\n\n    const showAssemblyTable = !isFormOpen && !isAssemblyBeingEdited\n\n    return (\n      <Dialog open={open}>\n        <DialogTitle className={classes.titleBox}>\n          {showAssemblyTable ? 'Assembly manager' : null}\n          {isFormOpen ? (\n            <>\n              <IconButton\n                aria-label=\"back\"\n                className={classes.backButton}\n                onClick={() => setFormOpen(false)}\n              >\n                <ArrowBackIosIcon />\n              </IconButton>\n              Add new assembly\n            </>\n          ) : null}\n          {isAssemblyBeingEdited ? (\n            <>\n              <IconButton\n                aria-label=\"back\"\n                className={classes.backButton}\n                onClick={() => setIsAssemblyBeingEdited(false)}\n              >\n                <ArrowBackIosIcon />\n              </IconButton>\n              {returnAssemblyName(assemblyBeingEdited)}\n            </>\n          ) : null}\n        </DialogTitle>\n        <DialogContent>\n          <div className={classes.dialogContent}>\n            {showAssemblyTable ? (\n              <AssemblyTable\n                rootModel={rootModel}\n                setIsAssemblyBeingEdited={setIsAssemblyBeingEdited}\n                setAssemblyBeingEdited={setAssemblyBeingEdited}\n              />\n            ) : null}\n            {isAssemblyBeingEdited ? (\n              <AssemblyEditor assembly={assemblyBeingEdited} />\n            ) : null}\n            {isFormOpen ? (\n              <AssemblyAddForm\n                rootModel={rootModel}\n                setFormOpen={setFormOpen}\n              />\n            ) : null}\n          </div>\n        </DialogContent>\n        <DialogActions>\n          {showAssemblyTable ? (\n            <>\n              <Button\n                color=\"secondary\"\n                variant=\"contained\"\n                onClick={() => {\n                  onClose(false)\n                }}\n              >\n                Return\n              </Button>\n              <Button\n                variant=\"contained\"\n                color=\"secondary\"\n                startIcon={<AddIcon />}\n                onClick={() => {\n                  setFormOpen(true)\n                }}\n              >\n                Add new assembly\n              </Button>\n            </>\n          ) : null}\n        </DialogActions>\n      </Dialog>\n    )\n  },\n)\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction returnAssemblyName(assembly: any) {\n  if (assembly !== undefined) {\n    return assembly.name\n  }\n  return null\n}\n\nexport default AssemblyManager\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport Dialog from '@material-ui/core/Dialog'\nimport { makeStyles } from '@material-ui/core/styles'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport Button from '@material-ui/core/Button'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport ListSubheader from '@material-ui/core/ListSubheader'\nimport Paper from '@material-ui/core/Paper'\nimport Typography from '@material-ui/core/Typography'\nimport Radio from '@material-ui/core/Radio'\nimport pluralize from 'pluralize'\nimport { Grid } from '@material-ui/core'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    margin: theme.spacing(1),\n  },\n  message: {\n    padding: theme.spacing(3),\n  },\n  titleBox: {\n    color: '#fff',\n    backgroundColor: theme.palette.primary.main,\n    textAlign: 'center',\n  },\n  dialogContent: {\n    width: 600,\n  },\n  resetButton: {\n    justifyContent: 'center',\n    marginBottom: '6px',\n  },\n}))\n\nconst CurrentSession = observer(\n  ({\n    session,\n    selectedDefault,\n    handleRadio,\n  }: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    session: any\n    selectedDefault: string\n    handleRadio: Function\n  }) => {\n    const classes = useStyles()\n\n    return (\n      <Paper className={classes.root}>\n        <List subheader={<ListSubheader>Currently open session</ListSubheader>}>\n          <ListItem>\n            <ListItemIcon>\n              <Radio\n                checked={session.name === selectedDefault}\n                onChange={() => handleRadio(session)}\n              />\n            </ListItemIcon>\n            <ListItemText primary={session.name} />\n          </ListItem>\n        </List>\n      </Paper>\n    )\n  },\n)\n\nconst SetDefaultSession = observer(\n  ({\n    rootModel,\n    open,\n    onClose,\n    currentDefault,\n  }: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    rootModel: any\n    open: boolean\n    onClose: Function\n    currentDefault: string\n  }) => {\n    const classes = useStyles()\n    const { session } = rootModel\n    const [selectedDefault, setSelectedDefault] = useState(currentDefault)\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    function handleRadio(sessionSnapshot: any) {\n      setSelectedDefault(sessionSnapshot.name)\n      rootModel.jbrowse.setDefaultSessionConf(sessionSnapshot)\n      session.notify(\n        `Set default session to ${sessionSnapshot.name}`,\n        'success',\n      )\n    }\n\n    return (\n      <Dialog open={open}>\n        <DialogTitle className={classes.titleBox}>\n          Set Default Session\n        </DialogTitle>\n        <DialogContent>\n          <Grid className={classes.resetButton} container>\n            <Grid item>\n              <Button\n                color=\"secondary\"\n                variant=\"contained\"\n                onClick={() => {\n                  setSelectedDefault('New session')\n                  rootModel.jbrowse.setDefaultSessionConf({\n                    name: `New session`,\n                  })\n                  session.notify('Reset default session', 'success')\n                }}\n              >\n                Clear default session\n              </Button>\n            </Grid>\n          </Grid>\n\n          <CurrentSession\n            session={session}\n            selectedDefault={selectedDefault}\n            handleRadio={handleRadio}\n          />\n          <Paper className={classes.root}>\n            <List subheader={<ListSubheader>Saved sessions</ListSubheader>}>\n              {session.savedSessions.length ? (\n                session.savedSessions.map(\n                  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                  (sessionSnapshot: any) => {\n                    const { views = [] } = sessionSnapshot\n                    const totalTracks = views\n                      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                      .map((view: any) => view.tracks.length)\n                      .reduce((a: number, b: number) => a + b, 0)\n                    if (sessionSnapshot.name !== session.name) {\n                      return (\n                        <ListItem key={sessionSnapshot.name}>\n                          <ListItemIcon>\n                            <Radio\n                              checked={sessionSnapshot.name === selectedDefault}\n                              onChange={() => handleRadio(sessionSnapshot)}\n                            />\n                          </ListItemIcon>\n                          <ListItemText\n                            primary={sessionSnapshot.name}\n                            secondary={`${views.length} ${pluralize(\n                              'view',\n                              views.length,\n                            )}; ${totalTracks}\n                             open ${pluralize('track', totalTracks)}`}\n                          />\n                        </ListItem>\n                      )\n                    }\n                    return null\n                  },\n                )\n              ) : (\n                <Typography className={classes.message}>\n                  No saved sessions found\n                </Typography>\n              )}\n            </List>\n          </Paper>\n        </DialogContent>\n        <DialogActions>\n          <Button\n            color=\"secondary\"\n            variant=\"contained\"\n            onClick={() => {\n              onClose(false)\n            }}\n          >\n            Return\n          </Button>\n        </DialogActions>\n      </Dialog>\n    )\n  },\n)\n\nexport default SetDefaultSession\n","import ConnectionType from '@jbrowse/core/pluggableElementTypes/ConnectionType'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { SessionWithWidgets, isAbstractMenuManager } from '@jbrowse/core/util'\nimport NoteAddIcon from '@material-ui/icons/NoteAdd'\nimport InputIcon from '@material-ui/icons/Input'\nimport {\n  configSchema as ucscConfigSchema,\n  modelFactory as ucscModelFactory,\n} from './ucsc-trackhub'\nimport {\n  ReactComponent as AddTrackReactComponent,\n  stateModelFactory as AddTrackStateModelFactory,\n  configSchema as AddTrackConfigSchema,\n} from './AddTrackWidget'\nimport {\n  ReactComponent as AddConnectionReactComponent,\n  stateModel as AddConnectionStateModel,\n  configSchema as AddConnectionConfigSchema,\n} from './AddConnectionWidget'\nimport {\n  ReactComponent as HierarchicalTrackSelectorReactComponent,\n  stateModelFactory as HierarchicalTrackSelectorStateModelFactory,\n  configSchema as HierarchicalTrackSelectorConfigSchema,\n} from './HierarchicalTrackSelectorWidget'\nimport AssemblyManager from './AssemblyManager'\nimport SetDefaultSession from './SetDefaultSession'\n\nexport default class extends Plugin {\n  name = 'DataManagementPlugin'\n\n  exports = {\n    AssemblyManager,\n    SetDefaultSession,\n  }\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addConnectionType(\n      () =>\n        new ConnectionType({\n          name: 'UCSCTrackHubConnection',\n          configSchema: ucscConfigSchema,\n          stateModel: ucscModelFactory(pluginManager),\n          displayName: 'UCSC Track Hub',\n          description: 'A track or assembly hub in the Track Hub format',\n          url: '//genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro',\n        }),\n    )\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'HierarchicalTrackSelectorWidget',\n        heading: 'Available Tracks',\n        configSchema: HierarchicalTrackSelectorConfigSchema,\n        stateModel: HierarchicalTrackSelectorStateModelFactory(pluginManager),\n        ReactComponent: HierarchicalTrackSelectorReactComponent,\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'AddTrackWidget',\n        heading: 'Add a track',\n        configSchema: AddTrackConfigSchema,\n        stateModel: AddTrackStateModelFactory(pluginManager),\n        ReactComponent: AddTrackReactComponent,\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'AddConnectionWidget',\n        heading: 'Add a connection',\n        configSchema: AddConnectionConfigSchema,\n        stateModel: AddConnectionStateModel,\n        ReactComponent: AddConnectionReactComponent,\n      })\n    })\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToMenu('File', {\n        label: 'Open track',\n        icon: NoteAddIcon,\n        onClick: (session: SessionWithWidgets) => {\n          if (session.views.length === 0) {\n            session.notify('Please open a view to add a track first')\n          } else if (session.views.length >= 1) {\n            const widget = session.addWidget(\n              'AddTrackWidget',\n              'addTrackWidget',\n              { view: session.views[0].id },\n            )\n            session.showWidget(widget)\n            if (session.views.length > 1) {\n              session.notify(\n                `This will add a track to the first view. Note: if you want to open a track in a specific view open the track selector for that view and use the add track (plus icon) in the bottom right`,\n              )\n            }\n          }\n        },\n      })\n      pluginManager.rootModel.appendToMenu('File', {\n        label: 'Open connection',\n        icon: InputIcon,\n        onClick: (session: SessionWithWidgets) => {\n          const widget = session.addWidget(\n            'AddConnectionWidget',\n            'addConnectionWidget',\n          )\n          session.showWidget(widget)\n        },\n      })\n    }\n  }\n}\n","import { getConf } from '@jbrowse/core/configuration'\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { getSession } from '@jbrowse/core/util'\nimport { BlockModel } from '@jbrowse/plugin-linear-genome-view'\nimport { ThemeProvider } from '@material-ui/core/styles'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport { isAlive } from 'mobx-state-tree'\nimport PropTypes from 'prop-types'\nimport React, { Component, useEffect, useRef } from 'react'\nimport { hydrate, unmountComponentAtNode } from 'react-dom'\n\n// This code is nearly identical to the server side renderer from linear-genome-view except it\n// doesn't have special handling for serializing region!\n//\ninterface ErrorBoundaryState {\n  hasError: boolean\n  error?: Error\n}\n\nclass RenderErrorBoundary extends Component<{}, ErrorBoundaryState> {\n  // eslint-disable-next-line react/static-property-placement\n  static propTypes = {\n    children: PropTypes.node.isRequired,\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(props: any) {\n    super(props)\n    this.state = { hasError: false }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  static getDerivedStateFromError(error: any) {\n    // Update state so the next render will show the fallback UI.\n    return { hasError: true, error }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  componentDidCatch(error: any, errorInfo: any) {\n    // You can also log the error to an error reporting service\n    console.error(error, errorInfo)\n  }\n\n  render() {\n    const { hasError, error } = this.state\n    if (hasError && error?.message) {\n      return <div style={{ color: 'red' }}>{error.message}</div>\n    }\n\n    const { children } = this.props\n    return children\n  }\n}\n\nfunction ServerSideRenderedContent(props: { model: BlockModel }) {\n  const ssrContainerNode = useRef<HTMLDivElement>(null)\n  const hydrated = useRef(false)\n\n  const { model } = props\n  const session = getSession(model)\n  const theme = createJBrowseTheme(getConf(session, 'theme'))\n\n  useEffect(() => {\n    const domNode = ssrContainerNode.current\n    const isHydrated = hydrated.current\n    function doHydrate() {\n      const {\n        data,\n        html,\n        renderProps,\n        renderingComponent: RenderingComponent,\n      } = model\n      if (domNode && model.filled) {\n        if (isHydrated && domNode) {\n          unmountComponentAtNode(domNode)\n        }\n        domNode.innerHTML = html\n\n        // defer main-thread rendering and hydration for when\n        // we have some free time. helps keep the framerate up.\n        //\n        // note: the timeout param to rIC below helps when you are doing\n        // a long continuous scroll, it forces it to evaluate because\n        // otherwise the continuous scroll would never give it time to do\n        // so\n        requestIdleCallback(\n          () => {\n            if (!isAlive(model)) {\n              return\n            }\n            hydrate(\n              <ThemeProvider theme={theme}>\n                <RenderErrorBoundary>\n                  <RenderingComponent {...data} {...renderProps} />\n                </RenderErrorBoundary>\n              </ThemeProvider>,\n              domNode,\n            )\n            hydrated.current = true\n          },\n          { timeout: 300 },\n        )\n      }\n    }\n\n    doHydrate()\n\n    return () => {\n      if (domNode && isHydrated) {\n        unmountComponentAtNode(domNode)\n      }\n    }\n  }, [model, theme])\n\n  return (\n    <div\n      ref={ssrContainerNode}\n      data-html-size={model.html.length}\n      className=\"ssr-container\"\n    />\n  )\n}\n\nServerSideRenderedContent.propTypes = {\n  model: MobxPropTypes.observableObject.isRequired,\n}\n\nexport default observer(ServerSideRenderedContent)\n","import { makeStyles } from '@material-ui/core/styles'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport { observer } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React, { useEffect, useState } from 'react'\nimport ServerSideRenderedContent from './ServerSideRenderedContent'\n\nconst useStyles = makeStyles({\n  loading: {\n    paddingLeft: '0.6em',\n    backgroundColor: '#f1f1f1',\n    backgroundImage:\n      'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n    height: '100%',\n    width: '100%',\n    textAlign: 'center',\n  },\n  error: {\n    display: 'block',\n    color: 'red',\n    width: '30em',\n    wordWrap: 'normal',\n    whiteSpace: 'normal',\n  },\n  blockMessage: {\n    background: '#f1f1f1',\n    padding: '10px',\n  },\n  blockError: {\n    background: '#f1f1f1',\n    padding: '10px',\n    color: 'red',\n  },\n})\n\nfunction LoadingMessage() {\n  // only show the loading message after 300ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  const classes = useStyles()\n  useEffect(() => {\n    const timeout = setTimeout(() => setShown(true), 300)\n    return () => clearTimeout(timeout)\n  }, [])\n\n  return shown ? (\n    <div data-testid=\"loading-synteny\" className={classes.loading}>\n      Loading &hellip;\n      <LinearProgress />\n    </div>\n  ) : null\n}\n\nfunction BlockMessage({ messageText }: { messageText: string }) {\n  const classes = useStyles()\n  return <div className={classes.blockMessage}>{messageText}</div>\n}\nBlockMessage.propTypes = {\n  messageText: PropTypes.string.isRequired,\n}\n\nfunction BlockError({ error }: { error: Error }) {\n  const classes = useStyles()\n  return <div className={classes.blockError}>{error.message}</div>\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst ServerSideRenderedBlockContent = observer(({ model }: { model: any }) => {\n  if (model.error) {\n    return <BlockError error={model.error} data-testid=\"reload_button\" />\n  }\n  if (model.message) {\n    return <BlockMessage messageText={model.message} />\n  }\n  if (!model.filled) {\n    return <LoadingMessage />\n  }\n\n  return <ServerSideRenderedContent model={model} />\n})\n\nexport default ServerSideRenderedBlockContent\n","import { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { DotplotDisplayModel } from '..'\n\nconst DotplotDisplay: React.FC<{\n  model: DotplotDisplayModel\n  children?: React.ReactNode\n}> = props => {\n  const { model, children } = props\n  const { offsetX = 0, offsetY = 0 } = model.data || {}\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const view = getContainingView(model) as any\n  const top = view.vview.offsetPx - offsetY\n  const left = -(view.hview.offsetPx - offsetX)\n  return (\n    <div style={{ position: 'relative' }}>\n      <div\n        style={{\n          position: 'absolute',\n          top,\n          left,\n        }}\n      >\n        <model.ReactComponent2 {...props} />\n        {children}\n      </div>\n    </div>\n  )\n}\nDotplotDisplay.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n  children: PropTypes.element,\n}\n\nDotplotDisplay.defaultProps = {\n  children: null,\n}\nexport default observer(DotplotDisplay)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  getConf,\n  readConfObject,\n  ConfigurationReference,\n  ConfigurationSchema,\n} from '@jbrowse/core/configuration'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n} from '@jbrowse/core/util/tracks'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport { types, getSnapshot, Instance } from 'mobx-state-tree'\nimport {\n  getContainingView,\n  getSession,\n  makeAbortableReaction,\n} from '@jbrowse/core/util'\n\nimport ServerSideRenderedBlockContent from '../ServerSideRenderedBlockContent'\nimport { DotplotViewModel } from '../DotplotView/model'\n\nexport { default as ReactComponent } from './components/DotplotDisplay'\n\nexport function configSchemaFactory(pluginManager: any) {\n  return ConfigurationSchema(\n    'DotplotDisplay',\n    {\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'DotplotRenderer' },\n      ),\n    },\n    { explicitIdentifier: 'displayId', explicitlyTyped: true },\n  )\n}\n\nexport function stateModelFactory(configSchema: any) {\n  return types\n    .compose(\n      'DotplotDisplay',\n      BaseDisplay,\n      types\n        .model({\n          type: types.literal('DotplotDisplay'),\n          configuration: ConfigurationReference(configSchema),\n        })\n        .volatile(() => ({\n          renderInProgress: undefined as AbortController | undefined,\n          filled: false,\n          data: undefined as any,\n          html: '',\n          message: undefined as string | undefined,\n          renderingComponent: undefined as any,\n          ReactComponent2: (ServerSideRenderedBlockContent as unknown) as React.FC,\n        })),\n    )\n    .views(self => ({\n      get rendererTypeName() {\n        return getConf(self, 'renderer').type\n      },\n      get renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          displayModel: self,\n        }\n      },\n    }))\n    .actions(self => {\n      let renderInProgress: undefined | AbortController\n\n      return {\n        afterAttach() {\n          makeAbortableReaction(\n            self as any,\n            renderBlockData,\n            renderBlockEffect as any,\n            {\n              name: `${self.type} ${self.id} rendering`,\n              delay: 1000,\n              fireImmediately: true,\n            },\n            this.setLoading,\n            this.setRendered,\n            this.setError,\n          )\n        },\n\n        setLoading(abortController: AbortController) {\n          self.filled = false\n          self.message = undefined\n          self.html = ''\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = abortController\n        },\n        setMessage(messageText: string) {\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          self.filled = false\n          self.message = messageText\n          self.html = ''\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n        setRendered(args: {\n          data: any\n          html: any\n          renderingComponent: React.Component\n        }) {\n          const { data, html, renderingComponent } = args\n          self.filled = true\n          self.message = undefined\n          self.html = html\n          self.data = data\n          self.error = undefined\n          self.renderingComponent = renderingComponent\n          renderInProgress = undefined\n        },\n        setError(error: Error) {\n          console.error(error)\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          // the rendering failed for some reason\n          self.filled = false\n          self.message = undefined\n          self.html = ''\n          self.data = undefined\n          self.error = error\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n      }\n    })\n}\n\nfunction renderBlockData(self: DotplotDisplayModel) {\n  const { rpcManager } = getSession(self)\n  const display = self\n\n  const { renderProps, rendererType } = display\n\n  // Alternative to readConfObject(config) is below\n  // used because renderProps is something under our control.\n  // Compare to serverSideRenderedBlock\n  readConfObject(self.configuration)\n\n  const { adapterConfig } = self\n  const parent = getContainingView(self) as DotplotViewModel\n  getSnapshot(parent)\n  const { viewWidth, viewHeight, borderSize, borderX, borderY } = parent\n\n  return {\n    rendererType,\n    rpcManager,\n    renderProps,\n    renderArgs: {\n      adapterConfig,\n      rendererType: rendererType.name,\n      renderProps: {\n        ...renderProps,\n        view: getSnapshot(parent),\n        width: viewWidth,\n        height: viewHeight,\n        borderSize,\n        borderX,\n        borderY,\n      },\n      sessionId: getRpcSessionId(self),\n      timeout: 1000000, // 10000,\n    },\n  }\n}\n\nasync function renderBlockEffect(\n  props: ReturnType<typeof renderBlockData> | undefined,\n) {\n  if (!props) {\n    throw new Error('cannot render with no props')\n  }\n\n  const { rendererType, rpcManager, renderArgs } = props\n\n  const { html, ...data } = await (rendererType as any).renderInClient(\n    rpcManager,\n    renderArgs,\n  )\n\n  return { html, data, renderingComponent: rendererType.ReactComponent }\n}\n\nexport type DotplotDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type DotplotDisplayModel = Instance<DotplotDisplayStateModel>\n","import { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport React from 'react'\nimport { DotplotRenderProps } from '../DotplotRenderer'\n\nfunction DotplotRendering(props: DotplotRenderProps) {\n  return <PrerenderedCanvas {...props} />\n}\n\nexport default observer(DotplotRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'DotplotRenderer',\n  {\n    drawMode: {\n      type: 'stringEnum',\n      description: 'drawing mode',\n      model: types.enumeration('Rendering', ['normal']),\n      defaultValue: 'normal',\n    },\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a synteny',\n      defaultValue: 'black',\n      functionSignature: ['feature'],\n    },\n    lineWidth: {\n      type: 'number',\n      description: 'width of the lines to be drawn',\n      defaultValue: 1.5,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { renderToString } from 'react-dom/server'\nimport { filter, toArray } from 'rxjs/operators'\nimport { Feature } from '../../util/simpleFeature'\nimport { BaseFeatureDataAdapter } from '../../data_adapters/BaseAdapter'\nimport { checkAbortSignal } from '../../util'\nimport { Region } from '../../util/types'\nimport RendererType from './RendererType'\nimport SerializableFilterChain from './util/serializableFilterChain'\n\nexport interface RenderArgs {\n  blockKey: string\n  sessionId: string\n  signal?: AbortSignal\n  filters?: any\n  dataAdapter: BaseFeatureDataAdapter\n  bpPerPx: number\n  regions?: any\n  config: Record<string, any>\n  renderProps: { displayModel: any }\n  width: number\n  height: number\n}\n\nexport default class ComparativeServerSideRenderer extends RendererType {\n  /**\n   * directly modifies the render arguments to prepare\n   * them to be serialized and sent to the worker.\n   *\n   * the base class replaces the `renderProps.displayModel` param\n   * (which on the client is a MST model) with a stub\n   * that only contains the `selectedFeature`, since\n   * this is the only part of the track model that most\n   * renderers read.\n   *\n   * @param args - the arguments passed to render\n   * @returns the same object\n   */\n  serializeArgsInClient(args: RenderArgs) {\n    args.renderProps = {\n      ...args.renderProps,\n      // @ts-ignore\n      blockKey: args.blockKey,\n\n      displayModel: {},\n    }\n\n    return args\n  }\n\n  // deserialize some of the results that came back from the worker\n  deserializeResultsInClient(result: { features: any }, args: RenderArgs) {\n    // @ts-ignore\n    result.blockKey = args.blockKey\n    return result\n  }\n\n  /**\n   * directly modifies the passed arguments object to\n   * inflate arguments as necessary. called in the worker process.\n   * @param args - the converted arguments to modify\n   */\n  deserializeArgsInWorker(args: Record<string, any>) {\n    if (this.configSchema) {\n      const config = this.configSchema.create(args.config || {})\n      args.config = config\n    }\n  }\n\n  /**\n   *\n   * @param result - object containing the results of calling the `render` method\n   * @param features - Map of `feature.id() -> feature`\n   */\n  serializeResultsInWorker(/* result: Record<string, any>, args: RenderArgs */) {\n    // does nothing currently\n  }\n\n  /**\n   * Render method called on the client. Serializes args, then\n   * calls `render` with the RPC manager.\n   */\n  async renderInClient(rpcManager: any, args: RenderArgs) {\n    const serializedArgs = this.serializeArgsInClient(args)\n\n    const result = await rpcManager.call(\n      args.sessionId,\n      'ComparativeRender',\n      serializedArgs,\n    )\n\n    this.deserializeResultsInClient(result, args)\n    return result\n  }\n\n  /**\n   * @param renderArgs -\n   * @param feature -\n   * @returns true if this feature passes all configured filters\n   */\n  featurePassesFilters(renderArgs: RenderArgs, feature: Feature) {\n    const filterChain = new SerializableFilterChain({\n      filters: renderArgs.filters,\n    })\n    return filterChain.passes(feature, renderArgs)\n  }\n\n  // render method called on the worker\n  async renderInWorker(args: RenderArgs) {\n    checkAbortSignal(args.signal)\n    this.deserializeArgsInWorker(args)\n    checkAbortSignal(args.signal)\n\n    const results = await this.render(args)\n    checkAbortSignal(args.signal)\n    results.html = renderToString(results.element)\n    delete results.element\n\n    // serialize the results for passing back to the main thread.\n    // these will be transmitted to the main process, and will come out\n    // as the result of renderRegionWithWorker.\n    this.serializeResultsInWorker(/* results, args */)\n    return results\n  }\n\n  async getFeatures(renderArgs: any) {\n    const { dataAdapter, signal } = renderArgs\n\n    let regions = [] as Region[]\n\n    // @ts-ignore this is instantiated by the getFeatures call\n    regions = renderArgs.regions\n\n    if (!regions || regions.length === 0) {\n      console.warn('no regions supplied to comparative renderer')\n      return []\n    }\n\n    const requestRegions = regions.map(r => {\n      // make sure the requested region's start and end are integers, if\n      // there is a region specification.\n      const requestRegion = { ...r }\n      if (requestRegion.start) {\n        requestRegion.start = Math.floor(requestRegion.start)\n      }\n      if (requestRegion.end) {\n        requestRegion.end = Math.floor(requestRegion.end)\n      }\n      return requestRegion\n    })\n\n    // note that getFeaturesInMultipleRegions does not do glyph expansion\n    const featureObservable = dataAdapter.getFeaturesInMultipleRegions(\n      requestRegions,\n      {\n        signal,\n      },\n    )\n\n    return featureObservable\n      .pipe(\n        // @ts-ignore\n        filter(feature => this.featurePassesFilters(renderArgs, feature)),\n        toArray(),\n      )\n      .toPromise()\n  }\n\n  freeResourcesInClient(rpcManager: any, args: RenderArgs) {\n    const serializedArgs = this.serializeArgsInClient(args)\n\n    return rpcManager.call(args.sessionId, 'freeResources', serializedArgs)\n  }\n\n  freeResourcesInWorker(/* args: RenderArgs */) {\n    /* stub method */\n  }\n}\n","import {\n  Instance,\n  SnapshotIn,\n  cast,\n  types,\n  getParent,\n  getSnapshot,\n  addDisposer,\n  resolveIdentifier,\n  getRoot,\n} from 'mobx-state-tree'\n\nimport BaseViewModel from '@jbrowse/core/pluggableElementTypes/models/BaseViewModel'\nimport { observable, autorun, transaction } from 'mobx'\nimport { BaseTrackStateModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport Base1DView, { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport calculateDynamicBlocks from '@jbrowse/core/util/calculateDynamicBlocks'\nimport {\n  getSession,\n  minmax,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { getConf } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\nfunction approxPixelStringLen(str: string) {\n  return str.length * 0.7 * 12\n}\n\ntype Coord = [number, number]\n\n// Used in the renderer\n// ref https://mobx-state-tree.js.org/concepts/volatiles on volatile state used here\nexport const Dotplot1DView = Base1DView.extend(self => {\n  const scaleFactor = observable.box(1)\n  return {\n    views: {\n      get interRegionPaddingWidth() {\n        return 0\n      },\n      get minimumBlockWidth() {\n        return 0\n      },\n      get dynamicBlocks() {\n        return calculateDynamicBlocks(self, false, false)\n      },\n      get scaleFactor() {\n        return scaleFactor.get()\n      },\n    },\n    actions: {\n      setScaleFactor(n: number) {\n        scaleFactor.set(n)\n      },\n    },\n  }\n})\n\nexport type Dotplot1DViewModel = Instance<typeof Dotplot1DView>\n\nconst DotplotHView = Dotplot1DView.extend(self => ({\n  views: {\n    get width() {\n      return getParent(self).viewWidth\n    },\n  },\n}))\n\nconst DotplotVView = Dotplot1DView.extend(self => ({\n  views: {\n    get width() {\n      return getParent(self).viewHeight\n    },\n  },\n}))\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types.compose(\n    BaseViewModel,\n    types\n      .model('DotplotView', {\n        id: ElementId,\n        type: types.literal('DotplotView'),\n        headerHeight: 0,\n        height: 600,\n        borderSize: 20,\n        tickSize: 5,\n        vtextRotation: 0,\n        htextRotation: -90,\n        fontSize: 15,\n        trackSelectorType: 'hierarchical',\n        assemblyNames: types.array(types.string),\n        hview: types.optional(DotplotHView, {}),\n        vview: types.optional(DotplotVView, {}),\n\n        tracks: types.array(\n          pluginManager.pluggableMstType(\n            'track',\n            'stateModel',\n          ) as BaseTrackStateModel,\n        ),\n\n        // this represents tracks specific to this view\n        // specifically used for read vs ref dotplots where\n        // this track would not really apply elsewhere\n        viewTrackConfigs: types.array(\n          pluginManager.pluggableConfigSchemaType('track'),\n        ),\n\n        // this represents assemblies in the specialized\n        // read vs ref dotplot view\n        viewAssemblyConfigs: types.array(types.frozen()),\n      })\n      .volatile(() => ({\n        volatileWidth: undefined as number | undefined,\n        error: undefined as Error | undefined,\n        borderX: 100,\n        borderY: 100,\n      }))\n      .views(self => ({\n        get width(): number {\n          if (!self.volatileWidth) {\n            throw new Error('width not initialized')\n          }\n          return self.volatileWidth\n        },\n      }))\n      .views(self => ({\n        get initialized() {\n          return (\n            self.volatileWidth !== undefined &&\n            self.hview.displayedRegions.length > 0 &&\n            self.vview.displayedRegions.length > 0\n          )\n        },\n        get loading() {\n          return self.assemblyNames.length > 0 && !this.initialized\n        },\n        get viewWidth() {\n          return self.width - self.borderX\n        },\n        get viewHeight() {\n          return self.height - self.borderY\n        },\n        get views() {\n          return [self.hview, self.vview]\n        },\n\n        get renderProps() {\n          return {\n            ...getParentRenderProps(self),\n            highResolutionScaling: getConf(\n              getSession(self),\n              'highResolutionScaling',\n            ),\n          }\n        },\n      }))\n      .actions(self => ({\n        afterAttach() {\n          const session = getSession(self)\n          addDisposer(\n            self,\n            autorun(\n              () => {\n                if (self.volatileWidth !== undefined) {\n                  const axis = [self.viewWidth, self.viewHeight]\n                  const views = [self.hview, self.vview]\n                  if (!self.initialized) {\n                    self.assemblyNames.forEach((name, index) => {\n                      const assembly = session.assemblyManager.get(name)\n                      if (assembly) {\n                        const { regions } = assembly\n                        if (regions && regions.length) {\n                          const regionsSnapshot = getSnapshot(regions)\n                          if (regionsSnapshot) {\n                            transaction(() => {\n                              views[index].setDisplayedRegions(regionsSnapshot)\n                              views[index].setBpPerPx(\n                                views[index].totalBp / axis[index],\n                              )\n                            })\n                          }\n                        }\n                      }\n                    })\n                  }\n                }\n              },\n              { delay: 1000 },\n            ),\n          )\n          addDisposer(\n            self,\n            autorun(() => {\n              // make sure we have a width on the view before trying to load\n              if (self.volatileWidth !== undefined) {\n                const padding = 10\n                // these are set via autorun to avoid dependency cycle\n                this.setBorderY(\n                  Math.max(\n                    self.hview.dynamicBlocks.contentBlocks.reduce(\n                      (a, b) =>\n                        Math.max(\n                          a,\n                          approxPixelStringLen(b.refName.slice(0, 30)),\n                        ),\n                      0,\n                    ) + padding,\n                    100,\n                  ),\n                )\n                this.setBorderX(\n                  Math.max(\n                    self.vview.dynamicBlocks.contentBlocks.reduce(\n                      (a, b) =>\n                        Math.max(\n                          a,\n                          approxPixelStringLen(b.refName.slice(0, 30)),\n                        ),\n                      0,\n                    ) + padding,\n                    100,\n                  ),\n                )\n              }\n            }),\n          )\n        },\n        setBorderX(n: number) {\n          self.borderX = n\n        },\n        setBorderY(n: number) {\n          self.borderY = n\n        },\n        setWidth(newWidth: number) {\n          self.volatileWidth = newWidth\n        },\n        setHeight(newHeight: number) {\n          self.height = newHeight\n        },\n\n        setError(e: Error) {\n          self.error = e\n        },\n\n        closeView() {\n          getParent(self, 2).removeView(self)\n        },\n\n        setHeaderHeight(height: number) {\n          self.headerHeight = height\n        },\n\n        zoomOutButton() {\n          self.hview.zoomOut()\n          self.vview.zoomOut()\n        },\n        zoomInButton() {\n          self.hview.zoomIn()\n          self.vview.zoomIn()\n        },\n        activateTrackSelector() {\n          if (self.trackSelectorType === 'hierarchical') {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            const session: any = getSession(self)\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n          throw new Error(\n            `invalid track selector type ${self.trackSelectorType}`,\n          )\n        },\n\n        showTrack(trackId: string, initialSnapshot = {}) {\n          const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n            'track',\n          )\n          const configuration = resolveIdentifier(\n            trackConfigSchema,\n            getRoot(self),\n            trackId,\n          )\n          const trackType = pluginManager.getTrackType(configuration.type)\n          if (!trackType) {\n            throw new Error(`unknown track type ${configuration.type}`)\n          }\n          const viewType = pluginManager.getViewType(self.type)\n          const displayConf = configuration.displays.find(\n            (d: AnyConfigurationModel) => {\n              if (\n                viewType.displayTypes.find(\n                  displayType => displayType.name === d.type,\n                )\n              ) {\n                return true\n              }\n              return false\n            },\n          )\n          if (!displayConf) {\n            throw new Error(\n              `could not find a compatible display for view type ${self.type}`,\n            )\n          }\n          const track = trackType.stateModel.create({\n            ...initialSnapshot,\n            type: configuration.type,\n            configuration,\n            displays: [{ type: displayConf.type, configuration: displayConf }],\n          })\n          self.tracks.push(track)\n        },\n\n        hideTrack(trackId: string) {\n          const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n            'track',\n          )\n          const configuration = resolveIdentifier(\n            trackConfigSchema,\n            getRoot(self),\n            trackId,\n          )\n          // if we have any tracks with that configuration, turn them off\n          const shownTracks = self.tracks.filter(\n            t => t.configuration === configuration,\n          )\n          transaction(() => shownTracks.forEach(t => self.tracks.remove(t)))\n          return shownTracks.length\n        },\n\n        toggleTrack(trackId: string) {\n          // if we have any tracks with that configuration, turn them off\n          const hiddenCount = this.hideTrack(trackId)\n          // if none had that configuration, turn one on\n          if (!hiddenCount) {\n            this.showTrack(trackId)\n          }\n        },\n        setAssemblyNames(assemblyNames: string[]) {\n          self.assemblyNames = cast(assemblyNames)\n        },\n        setViews(arr: SnapshotIn<Base1DViewModel>[]) {\n          self.hview = cast(arr[0])\n          self.vview = cast(arr[1])\n        },\n\n        getCoords(mousedown: Coord, mouseup: Coord) {\n          const [xmin, xmax] = minmax(mouseup[0], mousedown[0])\n          const [ymin, ymax] = minmax(mouseup[1], mousedown[1])\n          return Math.abs(xmax - xmin) > 3 && Math.abs(ymax - ymin) > 3\n            ? [\n                self.hview.pxToBp(xmin),\n                self.hview.pxToBp(xmax),\n                self.vview.pxToBp(self.viewHeight - ymin),\n                self.vview.pxToBp(self.viewHeight - ymax),\n              ]\n            : undefined\n        },\n\n        zoomIn(mousedown: Coord, mouseup: Coord) {\n          const result = this.getCoords(mousedown, mouseup)\n          if (result) {\n            const [x1, x2, y1, y2] = result\n            self.hview.moveTo(x1, x2)\n            self.vview.moveTo(y2, y1)\n          }\n        },\n        onDotplotView(mousedown: Coord, mouseup: Coord) {\n          const result = this.getCoords(mousedown, mouseup)\n          if (result) {\n            const [x1, x2, y1, y2] = result\n            const session = getSession(self)\n\n            const d1 = Dotplot1DView.create(getSnapshot(self.hview))\n            const d2 = Dotplot1DView.create(getSnapshot(self.vview))\n            d1.setVolatileWidth(self.hview.width)\n            d2.setVolatileWidth(self.vview.width)\n            d1.moveTo(x1, x2)\n            d2.moveTo(y2, y1)\n            d1.zoomTo(d1.bpPerPx / (self.width / self.hview.width), 0)\n            d2.zoomTo(d2.bpPerPx / (self.width / self.vview.width), 0)\n\n            // add the specific evidence tracks to the LGVs in the split view\n            // note: scales the bpPerPx by scaling proportional of the dotplot\n            // width to the eventual lgv width\n            const tracks: {\n              type: string\n              configuration: AnyConfigurationModel\n              displays: {\n                type: string\n                configuration: AnyConfigurationModel\n              }[]\n            }[] = []\n            self.tracks.forEach(track => {\n              const trackConf = track.configuration\n              const displayConf = trackConf.displays.find(\n                (display: AnyConfigurationModel) =>\n                  display.type === 'LinearSyntenyDisplay',\n              )\n              if (displayConf) {\n                tracks.push({\n                  type: trackConf.type,\n                  configuration: trackConf,\n                  displays: [\n                    { type: displayConf.type, configuration: displayConf },\n                  ],\n                })\n              }\n            })\n            const viewSnapshot = {\n              type: 'LinearSyntenyView',\n              views: [\n                {\n                  type: 'LinearGenomeView',\n                  ...getSnapshot(d1),\n                  tracks: [],\n                  hideHeader: true,\n                },\n                {\n                  type: 'LinearGenomeView',\n                  ...getSnapshot(d2),\n                  tracks: [],\n                  hideHeader: true,\n                },\n              ],\n              tracks,\n            }\n\n            session.addView('LinearSyntenyView', viewSnapshot)\n          }\n        },\n      }))\n      .views(self => ({\n        get menuItems() {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            return [\n              {\n                label: 'Open track selector',\n                onClick: self.activateTrackSelector,\n              },\n            ]\n          }\n          return []\n        },\n      })),\n  )\n}\n\nexport type DotplotViewStateModel = ReturnType<typeof stateModelFactory>\nexport type DotplotViewModel = Instance<DotplotViewStateModel>\n","import React from 'react'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport {\n  createCanvas,\n  createImageBitmap,\n} from '@jbrowse/core/util/offscreenCanvasPonyfill'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { Instance } from 'mobx-state-tree'\nimport ComparativeServerSideRendererType from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\nimport { Dotplot1DView } from '../DotplotView/model'\nimport MyConfig from './configSchema'\n\ntype Dim = Instance<typeof Dotplot1DView>\n\nconst { parseCigar } = MismatchParser\n\nexport interface DotplotRenderProps {\n  dataAdapter: BaseFeatureDataAdapter\n  signal?: AbortSignal\n  config: Instance<typeof MyConfig>\n  height: number\n  width: number\n  fontSize: number\n  highResolutionScaling: number\n  pluginManager: PluginManager\n  view: { hview: Dim; vview: Dim }\n}\n\nexport default class DotplotRenderer extends ComparativeServerSideRendererType {\n  async makeImageData(props: DotplotRenderProps & { views: Dim[] }) {\n    const {\n      highResolutionScaling: scale = 1,\n      width,\n      height,\n      config,\n      views,\n    } = props\n\n    const canvas = createCanvas(Math.ceil(width * scale), height * scale)\n    const ctx = canvas.getContext('2d')\n    const lineWidth = readConfObject(config, 'lineWidth')\n    ctx.lineWidth = lineWidth\n    ctx.scale(scale, scale)\n    ctx.fillStyle = readConfObject(config, 'color')\n    const [hview, vview] = views\n    const db1 = hview.dynamicBlocks.contentBlocks[0].offsetPx\n    const db2 = vview.dynamicBlocks.contentBlocks[0].offsetPx\n    ;(hview.features || []).forEach(feature => {\n      const start = feature.get('start')\n      const end = feature.get('end')\n      const refName = feature.get('refName')\n      const mate = feature.get('mate')\n      const mateRef = mate.refName\n      // const identity = feature.get('numMatches') / feature.get('blockLen')\n      // ctx.fillStyle = `hsl(${identity * 150},50%,50%)`\n      const color = readConfObject(config, 'color', [feature])\n      ctx.fillStyle = color\n      ctx.strokeStyle = color\n      const b10 = hview.bpToPx({ refName, coord: start })\n      const b20 = hview.bpToPx({ refName, coord: end })\n      const e10 = vview.bpToPx({ refName: mateRef, coord: mate.start })\n      const e20 = vview.bpToPx({ refName: mateRef, coord: mate.end })\n      if (\n        b10 !== undefined &&\n        b20 !== undefined &&\n        e10 !== undefined &&\n        e20 !== undefined\n      ) {\n        const b1 = b10 - db1\n        const b2 = b20 - db1\n        const e1 = e10 - db2\n        const e2 = e20 - db2\n        if (Math.abs(b1 - b2) < 3 && Math.abs(e1 - e2) < 3) {\n          ctx.fillRect(\n            b1 - lineWidth / 2,\n            height - e1 - lineWidth / 2,\n            lineWidth,\n            lineWidth,\n          )\n        } else {\n          let currX = b1\n          let currY = e1\n          const cigar = feature.get('cg') || feature.get('CIGAR')\n          if (cigar) {\n            const cigarOps = parseCigar(cigar)\n            ctx.beginPath()\n            for (let i = 0; i < cigarOps.length; i += 2) {\n              const val = +cigarOps[i]\n              const op = cigarOps[i + 1]\n\n              const prevX = currX\n              const prevY = currY\n\n              if (op === 'M') {\n                currX += val / hview.bpPerPx\n                currY += val / vview.bpPerPx\n              } else if (op === 'D' || op === 'N') {\n                currX += val / hview.bpPerPx\n              } else if (op === 'I') {\n                currY += val / vview.bpPerPx\n              }\n              ctx.moveTo(prevX, height - prevY)\n              ctx.lineTo(currX, height - currY)\n            }\n            ctx.stroke()\n          } else {\n            ctx.beginPath()\n            ctx.moveTo(b1, height - e1)\n            ctx.lineTo(b2, height - e2)\n            ctx.stroke()\n          }\n        }\n      } else {\n        console.warn(\n          `feature at ${refName}:${start}-${end} ${mateRef}:${mate.start}-${mate.end} not plotted, fell outside of range ${b10} ${b20} ${e10} ${e20}`,\n        )\n      }\n    })\n    return createImageBitmap(canvas)\n  }\n\n  async render(renderProps: DotplotRenderProps) {\n    const {\n      width,\n      height,\n      view: { hview, vview },\n    } = renderProps\n    const dimensions = [width, height]\n    const realizedViews = [hview, vview].map((snap, idx) => {\n      const view = Dotplot1DView.create(snap)\n      view.setVolatileWidth(dimensions[idx])\n      return view\n    })\n    await Promise.all(\n      realizedViews.map(async view => {\n        view.setFeatures(\n          await this.getFeatures({\n            ...renderProps,\n            regions: view.dynamicBlocks.contentBlocks,\n          }),\n        )\n      }),\n    )\n    const imageData = await this.makeImageData({\n      ...renderProps,\n      views: realizedViews,\n    })\n\n    const element = React.createElement(\n      this.ReactComponent,\n      { ...renderProps, height, width, imageData },\n      null,\n    )\n\n    return {\n      element,\n      imageData,\n      height,\n      width,\n      offsetX: realizedViews[0].dynamicBlocks.blocks[0].offsetPx,\n      offsetY: realizedViews[1].dynamicBlocks.blocks[0].offsetPx,\n    }\n  }\n}\n","/* eslint-disable no-underscore-dangle */\n/**\n * Heavily based on [quick-lru](https://www.npmjs.com/package/quick-lru)\n * (quick-lru didn't work for us because the export wouldn't compile in Webpack\n * properly)\n */\nclass QuickLRU {\n  constructor(options = {}) {\n    if (!(options.maxSize && options.maxSize > 0)) {\n      throw new TypeError('`maxSize` must be a number greater than 0')\n    }\n\n    this.maxSize = options.maxSize\n    this.cache = new Map()\n    this.oldCache = new Map()\n    this._size = 0\n  }\n\n  _set(key, value) {\n    this.cache.set(key, value)\n    this._size += 1\n\n    if (this._size >= this.maxSize) {\n      this._size = 0\n      this.oldCache = this.cache\n      this.cache = new Map()\n    }\n  }\n\n  get(key) {\n    if (this.cache.has(key)) {\n      return this.cache.get(key)\n    }\n\n    if (this.oldCache.has(key)) {\n      const value = this.oldCache.get(key)\n      this.oldCache.delete(key)\n      this._set(key, value)\n      return value\n    }\n\n    return undefined\n  }\n\n  set(key, value) {\n    if (this.cache.has(key)) {\n      this.cache.set(key, value)\n    } else {\n      this._set(key, value)\n    }\n\n    return this\n  }\n\n  has(key) {\n    return this.cache.has(key) || this.oldCache.has(key)\n  }\n\n  peek(key) {\n    if (this.cache.has(key)) {\n      return this.cache.get(key)\n    }\n\n    if (this.oldCache.has(key)) {\n      return this.oldCache.get(key)\n    }\n\n    return undefined\n  }\n\n  delete(key) {\n    const deleted = this.cache.delete(key)\n    if (deleted) {\n      this._size -= 1\n    }\n\n    return this.oldCache.delete(key) || deleted\n  }\n\n  clear() {\n    this.cache.clear()\n    this.oldCache.clear()\n    this._size = 0\n  }\n\n  *keys() {\n    for (const [key] of this) {\n      yield key\n    }\n  }\n\n  *values() {\n    for (const [, value] of this) {\n      yield value\n    }\n  }\n\n  *[Symbol.iterator]() {\n    for (const item of this.cache) {\n      yield item\n    }\n\n    for (const item of this.oldCache) {\n      const [key] = item\n      if (!this.cache.has(key)) {\n        yield item\n      }\n    }\n  }\n\n  get size() {\n    let oldCacheSize = 0\n    for (const key of this.oldCache.keys()) {\n      if (!this.cache.has(key)) {\n        oldCacheSize += 1\n      }\n    }\n\n    return this._size + oldCacheSize\n  }\n}\n\nexport default QuickLRU\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport {\n  FileLocation,\n  NoAssemblyRegion,\n  Region,\n} from '@jbrowse/core/util/types'\nimport { doesIntersect2 } from '@jbrowse/core/util/range'\nimport { GenericFilehandle } from 'generic-filehandle'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport AbortablePromiseCache from 'abortable-promise-cache'\nimport QuickLRU from '@jbrowse/core/util/QuickLRU'\nimport { Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport MyConfigSchema from './configSchema'\n\ninterface PafRecord {\n  records: NoAssemblyRegion[]\n  extra: {\n    blockLen: number\n    mappingQual: number\n    numMatches: number\n    strand: string\n  }\n}\n\nexport default class PAFAdapter extends BaseFeatureDataAdapter {\n  private cache = new AbortablePromiseCache({\n    cache: new QuickLRU({ maxSize: 1 }),\n    fill: (data: BaseOptions, signal?: AbortSignal) => {\n      return this.setup({ ...data, signal })\n    },\n  })\n\n  private assemblyNames: string[]\n\n  private pafLocation: GenericFilehandle\n\n  public static capabilities = ['getFeatures', 'getRefNames']\n\n  public constructor(config: Instance<typeof MyConfigSchema>) {\n    super(config)\n    const pafLocation = readConfObject(config, 'pafLocation') as FileLocation\n    const assemblyNames = readConfObject(config, 'assemblyNames') as string[]\n    this.pafLocation = openLocation(pafLocation)\n    this.assemblyNames = assemblyNames\n  }\n\n  async setup(opts?: BaseOptions) {\n    const text = (await this.pafLocation.readFile({\n      encoding: 'utf8',\n      ...opts,\n    })) as string\n    const pafRecords: PafRecord[] = []\n    text.split('\\n').forEach((line: string, index: number) => {\n      if (line.length) {\n        const [\n          chr1,\n          // @ts-ignore\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n          queryRefSeqLen,\n          start1,\n          end1,\n          strand,\n          chr2,\n          // @ts-ignore\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n          targetRefSeqLen,\n          start2,\n          end2,\n          numMatches,\n          blockLen,\n          mappingQual,\n          ...fields\n        ] = line.split('\\t')\n\n        const rest = Object.fromEntries(\n          fields.map(field => {\n            const r = field.indexOf(':')\n            const fieldName = field.slice(0, r)\n            const fieldValue = field.slice(r + 3)\n            return [fieldName, fieldValue]\n          }),\n        )\n\n        pafRecords[index] = {\n          records: [\n            { refName: chr1, start: +start1, end: +end1 },\n            { refName: chr2, start: +start2, end: +end2 },\n          ],\n          extra: {\n            numMatches: +numMatches,\n            blockLen: +blockLen,\n            strand,\n            mappingQual: +mappingQual,\n            ...rest,\n          },\n        }\n      }\n    })\n    return pafRecords\n  }\n\n  async hasDataForRefName() {\n    // determining this properly is basically a call to getFeatures\n    // so is not really that important, and has to be true or else\n    // getFeatures is never called (BaseAdapter filters it out)\n    return true\n  }\n\n  async getRefNames() {\n    // we cannot determine this accurately\n    return []\n  }\n\n  getFeatures(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const pafRecords = await this.cache.get('initialize', opts, opts.signal)\n\n      // The index of the assembly name in the region list corresponds to\n      // the adapter in the subadapters list\n      const index = this.assemblyNames.indexOf(region.assemblyName)\n      if (index !== -1) {\n        for (let i = 0; i < pafRecords.length; i++) {\n          const { extra, records } = pafRecords[i]\n          const { start, end, refName } = records[index]\n          if (records[index].refName === region.refName) {\n            if (doesIntersect2(region.start, region.end, start, end)) {\n              observer.next(\n                new SimpleFeature({\n                  uniqueId: `row_${i}`,\n                  start,\n                  end,\n                  refName,\n                  syntenyId: i,\n                  mate: {\n                    start: records[+!index].start,\n                    end: records[+!index].end,\n                    refName: records[+!index].refName,\n                  },\n                  ...extra,\n                }),\n              )\n            }\n          }\n        }\n      }\n\n      observer.complete()\n    })\n  }\n\n  freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'PAFAdapter',\n  {\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n    },\n    pafLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/file.paf' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { checkAbortSignal, renameRegionsIfNeeded } from '@jbrowse/core/util'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\nimport RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport ComparativeServerSideRendererType, {\n  RenderArgs,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\n\ninterface ComparativeRenderArgs {\n  sessionId: string\n  adapterConfig: {}\n  rendererType: string\n  renderProps: RenderArgs\n  signal?: RemoteAbortSignal\n}\n\n/**\n * call a synteny renderer with the given args\n * param views: a set of views that each contain a set of regions\n * used instead of passing regions directly as in render()\n */\nexport default class ComparativeRender extends RpcMethodType {\n  name = 'ComparativeRender'\n\n  async serializeArguments(\n    args: ComparativeRenderArgs & { signal?: AbortSignal },\n  ) {\n    const assemblyManager = this.pluginManager.rootModel?.session\n      ?.assemblyManager\n    if (!assemblyManager) {\n      return args\n    }\n\n    return renameRegionsIfNeeded(assemblyManager, args)\n  }\n\n  async execute(args: ComparativeRenderArgs) {\n    const {\n      sessionId,\n      adapterConfig,\n      rendererType,\n      renderProps,\n      signal,\n    } = await this.deserializeArguments(args)\n    if (!sessionId) throw new Error('must pass a unique session id')\n\n    checkAbortSignal(signal)\n\n    const { dataAdapter } = getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    if (!(dataAdapter instanceof BaseFeatureDataAdapter))\n      throw new Error(\n        `ComparativeRender cannot handle this type of data adapter ${dataAdapter}`,\n      )\n\n    const RendererType = this.pluginManager.getRendererType(rendererType)\n\n    if (!RendererType) {\n      throw new Error(`renderer \"${rendererType}\" not found`)\n    }\n    if (!RendererType.ReactComponent) {\n      throw new Error(\n        `renderer ${rendererType} has no ReactComponent, it may not be completely implemented yet`,\n      )\n    }\n\n    if (!(RendererType instanceof ComparativeServerSideRendererType))\n      throw new Error(\n        'CoreRender requires a renderer that is a subclass of ServerSideRendererType',\n      )\n\n    const result = await RendererType.renderInWorker({\n      ...renderProps,\n      sessionId,\n      dataAdapter,\n      signal,\n    })\n    checkAbortSignal(signal)\n    return result\n  }\n}\n","import React, { useState } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Typography from '@material-ui/core/Typography'\nimport { FileSelector } from '@jbrowse/core/ui'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport { observer } from 'mobx-react'\nimport { getSession } from '@jbrowse/core/util'\nimport Button from '@material-ui/core/Button'\nimport Container from '@material-ui/core/Container'\nimport Grid from '@material-ui/core/Grid'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport TextField from '@material-ui/core/TextField'\nimport { DotplotViewModel } from '../model'\n\nexport default () => {\n  const useStyles = makeStyles(theme => ({\n    importFormContainer: {\n      padding: theme.spacing(4),\n    },\n    importFormEntry: {\n      minWidth: 180,\n    },\n    errorMessage: {\n      textAlign: 'center',\n      paddingTop: theme.spacing(1),\n      paddingBottom: theme.spacing(1),\n    },\n  }))\n  const FormRow = observer(\n    ({\n      model,\n      selected,\n      onChange,\n      error,\n    }: {\n      model: DotplotViewModel\n      selected: number\n      onChange: (arg0: number) => void\n      error?: string\n    }) => {\n      const classes = useStyles()\n      const { assemblyNames } = getSession(model) as { assemblyNames: string[] }\n      return (\n        <Grid container item justify=\"center\" spacing={2} alignItems=\"center\">\n          <TextField\n            select\n            variant=\"outlined\"\n            value={assemblyNames[selected] ? selected : ''}\n            onChange={event => {\n              onChange(Number(event.target.value))\n            }}\n            error={Boolean(error)}\n            disabled={Boolean(error)}\n            className={classes.importFormEntry}\n          >\n            {assemblyNames.map((name, idx) => (\n              <MenuItem key={name} value={idx}>\n                {name}\n              </MenuItem>\n            ))}\n          </TextField>\n        </Grid>\n      )\n    },\n  )\n  const ImportForm = observer(({ model }: { model: DotplotViewModel }) => {\n    const classes = useStyles()\n    const [numRows] = useState(2)\n    const [selected, setSelected] = useState([0, 0])\n    const [error, setError] = useState('')\n    const [trackData, setTrackData] = useState<FileLocation>({ uri: '' })\n    const { assemblyNames } = getSession(model) as { assemblyNames: string[] }\n    if (!assemblyNames.length) {\n      setError('No configured assemblies')\n    }\n\n    function onOpenClick() {\n      model.setViews([\n        { bpPerPx: 0.1, offsetPx: 0 },\n        { bpPerPx: 0.1, offsetPx: 0 },\n      ])\n      model.setAssemblyNames([\n        assemblyNames[selected[0]],\n        assemblyNames[selected[1]],\n      ])\n\n      if ('uri' in trackData) {\n        const fileName = trackData.uri\n          ? trackData.uri.slice(trackData.uri.lastIndexOf('/') + 1)\n          : null\n\n        // @ts-ignore\n        const configuration = getSession(model).addTrackConf({\n          trackId: `fileName-${Date.now()}`,\n          name: fileName,\n          assemblyNames: selected.map(selection => assemblyNames[selection]),\n          type: 'DotplotTrack',\n          adapter: {\n            type: 'PAFAdapter',\n            pafLocation: trackData,\n            assemblyNames: selected.map(selection => assemblyNames[selection]),\n          },\n          renderer: {\n            type: 'DotplotRenderer',\n          },\n        })\n        model.toggleTrack(configuration.trackId)\n      }\n    }\n\n    return (\n      <Container className={classes.importFormContainer}>\n        <Grid container spacing={1} justify=\"center\" alignItems=\"center\">\n          <Grid item>\n            <p style={{ textAlign: 'center' }}>\n              Select assemblies for dotplot view\n            </p>\n            {[...new Array(numRows)].map((_, index) => (\n              <FormRow\n                key={`row_${index}_${selected[index]}`}\n                error={error}\n                selected={selected[index]}\n                onChange={val => {\n                  const copy = selected.slice(0)\n                  copy[index] = val\n                  setSelected(copy)\n                }}\n                model={model}\n              />\n            ))}\n          </Grid>\n\n          <Grid item>\n            <Typography>Add a PAF file for the dotplot view</Typography>\n            <FileSelector\n              name=\"URL\"\n              description=\"\"\n              location={trackData}\n              setLocation={loc => setTrackData(loc)}\n            />\n          </Grid>\n          <Grid item>\n            <Button onClick={onOpenClick} variant=\"contained\" color=\"primary\">\n              Open\n            </Button>\n          </Grid>\n        </Grid>\n      </Container>\n    )\n  })\n  return ImportForm\n}\n","import React from 'react'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport ZoomOut from '@material-ui/icons/ZoomOut'\nimport ZoomIn from '@material-ui/icons/ZoomIn'\nimport ArrowUp from '@material-ui/icons/KeyboardArrowUp'\nimport ArrowDown from '@material-ui/icons/KeyboardArrowDown'\nimport ArrowLeft from '@material-ui/icons/KeyboardArrowLeft'\nimport ArrowRight from '@material-ui/icons/KeyboardArrowRight'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport IconButton from '@material-ui/core/IconButton'\n\nimport { observer } from 'mobx-react'\nimport { DotplotViewModel } from '../model'\n\nexport default () => {\n  const useStyles = makeStyles({\n    iconButton: {\n      padding: '4px',\n      margin: '0 2px 0 2px',\n    },\n    controls: {\n      overflow: 'hidden',\n      background: 'white',\n      whiteSpace: 'nowrap',\n      position: 'absolute',\n      boxSizing: 'border-box',\n      border: '1px solid #a2a2a2',\n      right: 0,\n      top: 0,\n      zIndex: 1001, // needs to be above overlay but below things that might naturally go on top of it like a context menu from jbrowse-core/ui\n    },\n  })\n\n  const Controls = observer(({ model }: { model: DotplotViewModel }) => {\n    const classes = useStyles()\n    return (\n      <div className={classes.controls}>\n        <IconButton\n          onClick={() => {\n            model.hview.scroll(-100)\n          }}\n          className={classes.iconButton}\n          title=\"left\"\n          color=\"secondary\"\n        >\n          <ArrowLeft />\n        </IconButton>\n\n        <IconButton\n          onClick={() => {\n            model.hview.scroll(100)\n          }}\n          className={classes.iconButton}\n          title=\"left\"\n          color=\"secondary\"\n        >\n          <ArrowRight />\n        </IconButton>\n        <IconButton\n          onClick={() => {\n            model.vview.scroll(100)\n          }}\n          className={classes.iconButton}\n          title=\"left\"\n          color=\"secondary\"\n        >\n          <ArrowDown />\n        </IconButton>\n        <IconButton\n          onClick={() => {\n            model.vview.scroll(-100)\n          }}\n          className={classes.iconButton}\n          title=\"left\"\n          color=\"secondary\"\n        >\n          <ArrowUp />\n        </IconButton>\n        <IconButton\n          onClick={model.zoomOutButton}\n          className={classes.iconButton}\n          color=\"secondary\"\n        >\n          <ZoomOut />\n        </IconButton>\n\n        <IconButton\n          onClick={model.zoomInButton}\n          className={classes.iconButton}\n          title=\"zoom in\"\n          color=\"secondary\"\n        >\n          <ZoomIn />\n        </IconButton>\n\n        <IconButton\n          onClick={model.activateTrackSelector}\n          title=\"Open track selector\"\n          value=\"track_select\"\n          data-testid=\"circular_track_select\"\n          color=\"secondary\"\n        >\n          <TrackSelectorIcon />\n        </IconButton>\n      </div>\n    )\n  })\n  return Controls\n}\n","import React, { useState, useEffect, useRef } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport { transaction } from 'mobx'\nimport { LinearProgress } from '@material-ui/core'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { Menu } from '@jbrowse/core/ui'\nimport { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport normalizeWheel from 'normalize-wheel'\nimport { DotplotViewModel, Dotplot1DViewModel } from '../model'\nimport ImportFormFactory from './ImportForm'\nimport ControlsFactory from './Controls'\n\nconst useStyles = makeStyles(theme => {\n  return {\n    root: {\n      position: 'relative',\n      marginBottom: theme.spacing(1),\n      overflow: 'hidden',\n    },\n    viewContainer: {\n      marginTop: '3px',\n    },\n    container: {\n      display: 'grid',\n      padding: 5,\n      position: 'relative',\n    },\n    overlay: {\n      pointerEvents: 'none',\n      overflow: 'hidden',\n      display: 'flex',\n      width: '100%',\n      gridRow: '1/2',\n      gridColumn: '2/2',\n      zIndex: 100, // needs to be below controls\n      '& path': {\n        cursor: 'crosshair',\n        fill: 'none',\n      },\n    },\n    vtext: {\n      gridColumn: '1/2',\n      gridRow: '1/2',\n      pointerEvents: 'none',\n    },\n    content: {\n      gridColumn: '2/2',\n      gridRow: '1/2',\n    },\n    spacer: {\n      gridColumn: '1/2',\n      gridRow: '2/2',\n    },\n    htext: {\n      gridColumn: '2/2',\n      gridRow: '2/2',\n      pointerEvents: 'none',\n    },\n    error: {\n      color: 'red',\n    },\n    popover: {\n      background: '#fff',\n      maxWidth: 400,\n      wordBreak: 'break-all',\n      zIndex: 1000,\n      border: '1px solid black',\n      pointerEvents: 'none',\n      position: 'absolute',\n    },\n    majorTickLabel: {\n      fontSize: '11px',\n    },\n    majorTick: {\n      stroke: '#555',\n    },\n    minorTick: {\n      stroke: '#999',\n    },\n  }\n})\n\ntype Coord = [number, number] | undefined\ntype Timer = ReturnType<typeof setTimeout>\ntype Rect = { left: number; top: number }\n\nfunction locstr(px: number, view: Dotplot1DViewModel) {\n  const { refName, start, offset, oob } = view.pxToBp(px)\n  const coord = Math.floor(start + offset)\n  return oob ? 'out of bounds' : `${refName}:${coord.toLocaleString('en-US')}`\n}\n\nfunction getBlockLabelKeysToHide(\n  blocks: BaseBlock[],\n  length: number,\n  viewOffsetPx: number,\n) {\n  const blockLabelKeysToHide: string[] = []\n  const sortedBlocks = blocks.slice(0).sort((a, b) => {\n    const alen = a.end - a.start\n    const blen = b.end - b.start\n    return blen - alen\n  })\n  const positions = new Array(Math.round(length))\n  sortedBlocks.forEach(({ key, offsetPx }) => {\n    const y = Math.round(length - offsetPx + viewOffsetPx)\n    const labelBounds = [Math.max(y - 12, 0), y]\n    if (y === 0 || positions.slice(...labelBounds).some(Boolean)) {\n      blockLabelKeysToHide.push(key)\n    } else {\n      positions.fill(true, ...labelBounds)\n    }\n  })\n  return blockLabelKeysToHide\n}\n/**\n * Given a scale ( bp/px ) and minimum distances (px) between major and minor\n * gridlines, return an object like `{ majorPitch: bp, minorPitch: bp }` giving\n * the gridline pitches to use.\n */\nexport function chooseGridPitch(\n  scale: number,\n  minMajorPitchPx: number,\n  minMinorPitchPx: number,\n) {\n  scale = Math.abs(scale)\n  const minMajorPitchBp = minMajorPitchPx * scale\n  const majorMagnitude = parseInt(\n    Number(minMajorPitchBp).toExponential().split(/e/i)[1],\n    10,\n  )\n\n  let majorPitch = 10 ** majorMagnitude\n  while (majorPitch < minMajorPitchBp) {\n    majorPitch *= 2\n    if (majorPitch >= minMajorPitchBp) break\n    majorPitch *= 2.5\n  }\n\n  majorPitch = Math.max(majorPitch, 5)\n\n  const majorPitchPx = majorPitch / scale\n\n  let minorPitch = 0\n  if (!(majorPitch % 10) && majorPitchPx / 10 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 10\n  } else if (!(majorPitch % 5) && majorPitchPx / 5 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 5\n  } else if (!(majorPitch % 2) && majorPitchPx / 2 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 2\n  }\n\n  return { majorPitch, minorPitch }\n}\n\nfunction makeTicks(\n  regions: BaseBlock[],\n  bpPerPx: number,\n  emitMajor = true,\n  emitMinor = true,\n) {\n  const ticks = []\n  const gridPitch = chooseGridPitch(bpPerPx, 60, 15)\n  const iterPitch = gridPitch.minorPitch || gridPitch.majorPitch\n  for (let i = 0; i < regions.length; i++) {\n    const region = regions[i]\n    const { start, end, refName } = region\n    let index = 0\n\n    const minBase = start\n    const maxBase = end\n    for (\n      let base = Math.ceil(minBase / iterPitch) * iterPitch;\n      base < maxBase;\n      base += iterPitch\n    ) {\n      if (emitMinor && base % gridPitch.majorPitch) {\n        ticks.push({ type: 'minor', base: base - 1, index, refName })\n        index += 1\n      } else if (\n        emitMajor &&\n        Math.abs(base - region.start) > gridPitch.minorPitch\n      ) {\n        ticks.push({ type: 'major', base: base - 1, index, refName })\n        index += 1\n      }\n    }\n  }\n  return ticks\n}\n\nconst HorizontalAxis = observer(({ model }: { model: DotplotViewModel }) => {\n  const classes = useStyles()\n  const { viewWidth, borderY, hview, htextRotation } = model\n  const hide = getBlockLabelKeysToHide(\n    hview.dynamicBlocks.contentBlocks,\n    viewWidth,\n    hview.offsetPx,\n  )\n  const ticks = makeTicks(hview.staticBlocks.contentBlocks, hview.bpPerPx)\n  return (\n    <svg width={viewWidth} height={borderY} className={classes.htext}>\n      <g>\n        {hview.dynamicBlocks.contentBlocks\n          .filter(region => !hide.includes(region.key))\n          .map(region => {\n            const x = region.offsetPx\n            const y = 0\n            return (\n              <text\n                transform={`rotate(${htextRotation},${\n                  x - hview.offsetPx\n                },${y})`}\n                key={JSON.stringify(region)}\n                x={x - hview.offsetPx}\n                y={y + 1}\n                fill=\"#000000\"\n                dominantBaseline=\"hanging\"\n                textAnchor=\"end\"\n              >\n                {`${region.refName}:${\n                  region.start !== 0\n                    ? Math.floor(region.start).toLocaleString('en-US')\n                    : ''\n                }`}\n              </text>\n            )\n          })}\n        {ticks.map(tick => {\n          const x =\n            (hview.bpToPx({ refName: tick.refName, coord: tick.base }) || 0) -\n            hview.offsetPx\n          return (\n            <line\n              key={`line-${JSON.stringify(tick)}`}\n              x1={x}\n              x2={x}\n              y1={0}\n              y2={tick.type === 'major' ? 6 : 4}\n              strokeWidth={1}\n              stroke={tick.type === 'major' ? '#555' : '#999'}\n              className={\n                tick.type === 'major' ? classes.majorTick : classes.minorTick\n              }\n              data-bp={tick.base}\n            />\n          )\n        })}\n        {ticks\n          .filter(tick => tick.type === 'major')\n          .map(tick => {\n            const x =\n              (hview.bpToPx({ refName: tick.refName, coord: tick.base }) || 0) -\n              hview.offsetPx\n            const y = 0\n            return (\n              <text\n                x={x - 7}\n                y={y}\n                transform={`rotate(${htextRotation},${x},${y})`}\n                key={`text-${JSON.stringify(tick)}`}\n                style={{ fontSize: '11px' }}\n                className={classes.majorTickLabel}\n                dominantBaseline=\"middle\"\n                textAnchor=\"end\"\n              >\n                {(tick.base + 1).toLocaleString('en-US')}\n              </text>\n            )\n          })}\n      </g>\n    </svg>\n  )\n})\nconst VerticalAxis = observer(({ model }: { model: DotplotViewModel }) => {\n  const classes = useStyles()\n  const { borderX, viewHeight, vview, vtextRotation } = model\n  const hide = getBlockLabelKeysToHide(\n    vview.dynamicBlocks.contentBlocks,\n    viewHeight,\n    vview.offsetPx,\n  )\n  const ticks = makeTicks(vview.staticBlocks.contentBlocks, vview.bpPerPx)\n  return (\n    <svg className={classes.vtext} width={borderX} height={viewHeight}>\n      <g>\n        {vview.dynamicBlocks.contentBlocks\n          .filter(region => !hide.includes(region.key))\n          .map(region => {\n            const y = region.offsetPx\n            const x = borderX\n            return (\n              <text\n                transform={`rotate(${vtextRotation},${x},${y})`}\n                key={JSON.stringify(region)}\n                x={borderX}\n                y={viewHeight - y + vview.offsetPx}\n                fill=\"#000000\"\n                textAnchor=\"end\"\n              >\n                {`${region.refName}:${\n                  region.start !== 0 ? Math.floor(region.start) : ''\n                }`}\n              </text>\n            )\n          })}\n        {ticks.map(tick => {\n          const y =\n            (vview.bpToPx({ refName: tick.refName, coord: tick.base }) || 0) -\n            vview.offsetPx\n          return (\n            <line\n              key={`line-${JSON.stringify(tick)}`}\n              y1={viewHeight - y}\n              y2={viewHeight - y}\n              x1={borderX}\n              x2={borderX - (tick.type === 'major' ? 6 : 4)}\n              strokeWidth={1}\n              stroke={tick.type === 'major' ? '#555' : '#999'}\n              className={\n                tick.type === 'major' ? classes.majorTick : classes.minorTick\n              }\n              data-bp={tick.base}\n            />\n          )\n        })}\n        {ticks\n          .filter(tick => tick.type === 'major')\n          .map(tick => {\n            const y =\n              (vview.bpToPx({ refName: tick.refName, coord: tick.base }) || 0) -\n              vview.offsetPx\n            return (\n              <text\n                y={viewHeight - y - 3}\n                x={borderX - 7}\n                key={`text-${JSON.stringify(tick)}`}\n                textAnchor=\"end\"\n                dominantBaseline=\"hanging\"\n                style={{ fontSize: '11px' }}\n                className={classes.majorTickLabel}\n              >\n                {(tick.base + 1).toLocaleString('en-US')}\n              </text>\n            )\n          })}\n      </g>\n    </svg>\n  )\n})\n\nconst Grid = observer(\n  ({\n    model,\n    children,\n    stroke = '#000a',\n  }: {\n    model: DotplotViewModel\n    children: React.ReactNode\n    stroke?: string\n  }) => {\n    const { viewWidth, viewHeight, hview, vview } = model\n    const hblocks = hview.dynamicBlocks.contentBlocks\n    const vblocks = vview.dynamicBlocks.contentBlocks\n    const htop = hview.displayedRegionsTotalPx - hview.offsetPx\n    const hbottom = hblocks[0].offsetPx - hview.offsetPx\n    const vtop = vview.displayedRegionsTotalPx - vview.offsetPx\n    const vbottom = vblocks[0].offsetPx - vview.offsetPx\n    return (\n      <svg\n        style={{ background: 'rgba(0,0,0,0.12)' }}\n        width={viewWidth}\n        height={viewHeight}\n      >\n        {' '}\n        <rect\n          x={hbottom}\n          y={viewHeight - vtop}\n          width={htop - hbottom}\n          height={vtop - vbottom}\n          fill=\"#fff\"\n        />\n        <g>\n          {hblocks.map(region => {\n            const x = region.offsetPx - hview.offsetPx\n            return (\n              <line\n                key={JSON.stringify(region)}\n                x1={x}\n                y1={0}\n                x2={x}\n                y2={viewHeight}\n                stroke={stroke}\n              />\n            )\n          })}\n          {vblocks.map(region => {\n            const y = viewHeight - (region.offsetPx - vview.offsetPx)\n            return (\n              <line\n                key={JSON.stringify(region)}\n                x1={0}\n                y1={y}\n                x2={viewWidth}\n                y2={y}\n                stroke={stroke}\n              />\n            )\n          })}\n          <line x1={htop} y1={0} x2={htop} y2={viewHeight} stroke={stroke} />\n          <line\n            x1={0}\n            y1={viewHeight - vtop}\n            x2={viewWidth}\n            y2={viewHeight - vtop}\n            stroke={stroke}\n          />\n        </g>\n        {children}\n      </svg>\n    )\n  },\n)\n\nexport default (pluginManager: PluginManager) => {\n  const { jbrequire } = pluginManager\n  const ImportForm = jbrequire(ImportFormFactory)\n  const Controls = jbrequire(ControlsFactory)\n\n  // produces offsetX/offsetY coordinates from a clientX and an element's getBoundingClientRect\n  function getOffset(coord: Coord, rect: Rect) {\n    return coord && ([coord[0] - rect.left, coord[1] - rect.top] as Coord)\n  }\n  const DotplotViewInternal = observer(\n    ({ model }: { model: DotplotViewModel }) => {\n      const { hview, vview, viewHeight } = model\n      const classes = useStyles()\n      const [mousecurrClient, setMouseCurrClient] = useState<Coord>()\n      const [mousedownClient, setMouseDownClient] = useState<Coord>()\n      const [mouseupClient, setMouseUpClient] = useState<Coord>()\n      const ref = useRef<HTMLDivElement>(null)\n      const root = useRef<HTMLDivElement>(null)\n      const distanceX = useRef(0)\n      const distanceY = useRef(0)\n      const lref = useRef<HTMLDivElement>(null)\n      const rref = useRef<HTMLDivElement>(null)\n      const timeout = useRef<Timer>()\n      const delta = useRef(0)\n      const scheduled = useRef(false)\n      const blank = { left: 0, top: 0, width: 0, height: 0 }\n      const svg = ref.current?.getBoundingClientRect() || blank\n      const rrect = rref.current?.getBoundingClientRect() || blank\n      const lrect = lref.current?.getBoundingClientRect() || blank\n      const mousedown = getOffset(mousedownClient, svg)\n      const mousecurr = getOffset(mousecurrClient, svg)\n      const mouseup = getOffset(mouseupClient, svg)\n      const mouserect = mouseup || mousecurr\n\n      // use non-React wheel handler to properly prevent body scrolling\n      useEffect(() => {\n        function onWheel(origEvent: WheelEvent) {\n          const event = normalizeWheel(origEvent)\n          origEvent.preventDefault()\n          if (origEvent.ctrlKey === true) {\n            delta.current += event.pixelY / 500\n            model.vview.setScaleFactor(\n              delta.current < 0 ? 1 - delta.current : 1 / (1 + delta.current),\n            )\n            model.hview.setScaleFactor(\n              delta.current < 0 ? 1 - delta.current : 1 / (1 + delta.current),\n            )\n            if (timeout.current) {\n              clearTimeout(timeout.current)\n            }\n            timeout.current = setTimeout(() => {\n              transaction(() => {\n                model.hview.setScaleFactor(1)\n                model.vview.setScaleFactor(1)\n                model.hview.zoomTo(\n                  delta.current > 0\n                    ? model.hview.bpPerPx * (1 + delta.current)\n                    : model.hview.bpPerPx / (1 - delta.current),\n                )\n                model.vview.zoomTo(\n                  delta.current > 0\n                    ? model.vview.bpPerPx * (1 + delta.current)\n                    : model.vview.bpPerPx / (1 - delta.current),\n                )\n              })\n              delta.current = 0\n            }, 300)\n          } else {\n            distanceX.current += event.pixelX\n            distanceY.current -= event.pixelY\n            if (!scheduled.current) {\n              scheduled.current = true\n\n              window.requestAnimationFrame(() => {\n                transaction(() => {\n                  model.hview.scroll(distanceX.current)\n                  model.vview.scroll(distanceY.current)\n                })\n                scheduled.current = false\n                distanceX.current = 0\n                distanceY.current = 0\n              })\n            }\n          }\n        }\n        if (ref.current) {\n          const curr = ref.current\n          curr.addEventListener('wheel', onWheel)\n          return () => {\n            curr.removeEventListener('wheel', onWheel)\n          }\n        }\n        return () => {}\n      }, [model.hview, model.vview])\n\n      useEffect(() => {\n        function globalMouseMove(event: MouseEvent) {\n          setMouseCurrClient([event.clientX, event.clientY])\n        }\n        window.addEventListener('mousemove', globalMouseMove)\n        return () => {\n          window.removeEventListener('mousemove', globalMouseMove)\n        }\n      }, [])\n\n      // detect a mouseup after a mousedown was submitted, autoremoves mouseup\n      // once that single mouseup is set\n      useEffect(() => {\n        let cleanup = () => {}\n\n        function globalMouseUp(event: MouseEvent) {\n          if (\n            mousedown &&\n            mousecurr &&\n            Math.abs(mousedown[0] - mousecurr[0]) > 3 &&\n            Math.abs(mousedown[1] - mousecurr[1]) > 3\n          ) {\n            setMouseUpClient([event.clientX, event.clientY])\n          } else {\n            setMouseDownClient(undefined)\n          }\n        }\n\n        if (mousedown && !mouseup) {\n          window.addEventListener('mouseup', globalMouseUp, true)\n          cleanup = () => {\n            window.removeEventListener('mouseup', globalMouseUp, true)\n          }\n        }\n        return cleanup\n      }, [mousedown, mousecurr, mouseup])\n\n      return (\n        <div ref={root} className={classes.root}>\n          <Controls model={model} />\n\n          <div className={classes.container}>\n            <div\n              style={{\n                display: 'grid',\n                transform: `scaleX(${model.hview.scaleFactor}) scaleY(${model.vview.scaleFactor})`,\n              }}\n            >\n              <VerticalAxis model={model} />\n              <HorizontalAxis model={model} />\n              <div\n                ref={ref}\n                style={{ position: 'relative' }}\n                className={classes.content}\n              >\n                {mouserect ? (\n                  <div\n                    ref={lref}\n                    className={classes.popover}\n                    style={{\n                      left:\n                        mouserect[0] -\n                        (mousedown && mouserect[0] - mousedown[0] < 0\n                          ? lrect.width\n                          : 0),\n                      top:\n                        mouserect[1] -\n                        (mousedown && mouserect[1] - mousedown[1] < 0\n                          ? lrect.height\n                          : 0),\n                    }}\n                  >\n                    {`x-${locstr(mouserect[0], hview)}`}\n                    <br />\n                    {`y-${locstr(viewHeight - mouserect[1], vview)}`}\n                  </div>\n                ) : null}\n                {mousedown &&\n                mouserect &&\n                Math.abs(mousedown[0] - mouserect[0]) > 3 &&\n                Math.abs(mousedown[1] - mouserect[1]) > 3 ? (\n                  <div\n                    ref={rref}\n                    className={classes.popover}\n                    style={{\n                      left:\n                        mousedown[0] -\n                        (mouserect[0] - mousedown[0] < 0 ? 0 : rrect.width),\n                      top:\n                        mousedown[1] -\n                        (mouserect[1] - mousedown[1] < 0 ? 0 : rrect.height),\n                    }}\n                  >\n                    {`x-${locstr(mousedown[0], hview)}`}\n                    <br />\n                    {`y-${locstr(viewHeight - mousedown[1], vview)}`}\n                  </div>\n                ) : null}\n\n                <div\n                  role=\"presentation\"\n                  style={{ cursor: 'crosshair' }}\n                  onMouseDown={event => {\n                    if (event.button === 0) {\n                      setMouseDownClient([event.clientX, event.clientY])\n                      setMouseCurrClient([event.clientX, event.clientY])\n                    }\n                  }}\n                >\n                  <Grid model={model}>\n                    {mousedown && mouserect ? (\n                      <rect\n                        fill=\"rgba(255,0,0,0.3)\"\n                        x={Math.min(mouserect[0], mousedown[0])}\n                        y={Math.min(mouserect[1], mousedown[1])}\n                        width={Math.abs(mouserect[0] - mousedown[0])}\n                        height={Math.abs(mouserect[1] - mousedown[1])}\n                      />\n                    ) : null}\n                  </Grid>\n                </div>\n                <div className={classes.spacer} />\n              </div>\n              <div className={classes.overlay}>\n                {model.tracks.map(track => {\n                  const [display] = track.displays\n                  const { RenderingComponent } = display\n\n                  return RenderingComponent ? (\n                    <RenderingComponent\n                      key={getConf(track, 'trackId')}\n                      model={display}\n                    />\n                  ) : null\n                })}\n              </div>\n              <Menu\n                open={Boolean(mouseup)}\n                onMenuItemClick={(_, callback) => {\n                  callback()\n                  setMouseUpClient(undefined)\n                  setMouseDownClient(undefined)\n                }}\n                onClose={() => {\n                  setMouseUpClient(undefined)\n                  setMouseDownClient(undefined)\n                }}\n                anchorReference=\"anchorPosition\"\n                anchorPosition={\n                  mouseupClient\n                    ? {\n                        top: mouseupClient[1] + 30,\n                        left: mouseupClient[0] + 30,\n                      }\n                    : undefined\n                }\n                style={{ zIndex: 1000 }}\n                menuItems={[\n                  {\n                    label: 'Zoom in',\n                    onClick: () => {\n                      if (mousedown && mouseup) {\n                        model.zoomIn(mousedown, mouseup)\n                      }\n                    },\n                  },\n                  {\n                    label: 'Open linear synteny view',\n                    onClick: () => {\n                      if (mousedown && mouseup) {\n                        model.onDotplotView(mousedown, mouseup)\n                      }\n                    },\n                  },\n                ]}\n              />\n            </div>\n          </div>\n        </div>\n      )\n    },\n  )\n  const DotplotView = observer(({ model }: { model: DotplotViewModel }) => {\n    const { initialized, loading, error } = model\n    const classes = useStyles()\n\n    if (!initialized && !loading) {\n      return <ImportForm model={model} />\n    }\n\n    if (error) {\n      return <p className={classes.error}>{String(error)}</p>\n    }\n    if (loading) {\n      return (\n        <div>\n          <p>Loading...</p>\n          <LinearProgress />\n        </div>\n      )\n    }\n\n    return <DotplotViewInternal model={model} />\n  })\n\n  return DotplotView\n}\n","import modelFactory from './model'\nimport ReactComponentFactory from './components/DotplotView'\n\nexport default ({ jbrequire }: { jbrequire: Function }) => {\n  const ViewType = jbrequire('@jbrowse/core/pluggableElementTypes/ViewType')\n  return new ViewType({\n    name: 'DotplotView',\n    stateModel: jbrequire(modelFactory),\n    ReactComponent: jbrequire(ReactComponentFactory),\n  })\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport AddIcon from '@material-ui/icons/Add'\nimport { autorun } from 'mobx'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AbstractSessionModel,\n  isAbstractMenuManager,\n  getSession,\n} from '@jbrowse/core/util'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport TimelineIcon from '@material-ui/icons/Timeline'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport {\n  configSchemaFactory as dotplotDisplayConfigSchemaFactory,\n  stateModelFactory as dotplotDisplayStateModelFactory,\n  ReactComponent as DotplotDisplayReactComponent,\n} from './DotplotDisplay'\nimport DotplotRenderer, {\n  configSchema as dotplotRendererConfigSchema,\n  ReactComponent as DotplotRendererReactComponent,\n} from './DotplotRenderer'\n\nimport {\n  configSchema as PAFAdapterConfigSchema,\n  AdapterClass as PAFAdapter,\n} from './PAFAdapter'\nimport ComparativeRender from './DotplotRenderer/ComparativeRenderRpc'\nimport DotplotViewFactory from './DotplotView'\n\nconst { parseCigar } = MismatchParser\n\ninterface Track {\n  id: string\n  type: string\n  displays: {\n    addAdditionalContextMenuItemCallback: Function\n    additionalContextMenuItemCallbacks: Function[]\n    id: string\n    type: string\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    PileupDisplay: any\n  }[]\n}\ninterface View {\n  tracks: Track[]\n  views?: View[]\n  type: string\n}\ninterface Session {\n  views: View[]\n}\nfunction getLengthOnRef(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let lengthOnRef = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'I') {\n      lengthOnRef += len\n    }\n  }\n  return lengthOnRef\n}\n\nfunction getLength(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nfunction getLengthSansClipping(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nfunction getClip(cigar: string, strand: number) {\n  return strand === -1\n    ? +(cigar.match(/(\\d+)[SH]$/) || [])[1] || 0\n    : +(cigar.match(/^(\\d+)([SH])/) || [])[1] || 0\n}\n\ninterface ReducedFeature {\n  refName: string\n  start: number\n  clipPos: number\n  end: number\n  seqLength: number\n}\n\nexport default class DotplotPlugin extends Plugin {\n  name = 'DotplotPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() => pluginManager.jbrequire(DotplotViewFactory))\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = dotplotDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'DotplotDisplay',\n        configSchema,\n        stateModel: dotplotDisplayStateModelFactory(configSchema),\n        trackType: 'SyntenyTrack',\n        viewType: 'DotplotView',\n        ReactComponent: DotplotDisplayReactComponent,\n      })\n    })\n\n    pluginManager.addRendererType(\n      () =>\n        new DotplotRenderer({\n          name: 'DotplotRenderer',\n          configSchema: dotplotRendererConfigSchema,\n          ReactComponent: DotplotRendererReactComponent,\n        }),\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'PAFAdapter',\n          configSchema: PAFAdapterConfigSchema,\n          AdapterClass: PAFAdapter,\n        }),\n    )\n\n    // install our comparative rendering rpc callback\n    pluginManager.addRpcMethod(() => new ComparativeRender(pluginManager))\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['File', 'Add'], {\n        label: 'Dotplot view',\n        icon: TimelineIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('DotplotView', {})\n        },\n      })\n    }\n\n    const cb = (feature: Feature, display: IAnyStateTreeNode) => {\n      return feature\n        ? [\n            {\n              label: 'Dotplot of read vs ref',\n              icon: AddIcon,\n              onClick: () => {\n                const session = getSession(display)\n                const clipPos = feature.get('clipPos')\n                const cigar = feature.get('CIGAR')\n                const flags = feature.get('flags')\n                const SA: string =\n                  (feature.get('tags')\n                    ? feature.get('tags').SA\n                    : feature.get('SA')) || ''\n                const readName = feature.get('name')\n                const readAssembly = `${readName}_assembly`\n                const trackAssembly = getConf(\n                  // @ts-ignore\n                  display.parentTrack,\n                  'assemblyNames',\n                )[0]\n                const assemblyNames = [trackAssembly, readAssembly]\n                const trackId = `track-${Date.now()}`\n                const trackName = `${readName}_vs_${trackAssembly}`\n                const supplementaryAlignments = SA.split(';')\n                  .filter(aln => !!aln)\n                  .map((aln, index) => {\n                    const [saRef, saStart, saStrand, saCigar] = aln.split(',')\n                    const saLengthOnRef = getLengthOnRef(saCigar)\n                    const saLength = getLength(saCigar)\n                    const saLengthSansClipping = getLengthSansClipping(saCigar)\n                    const saStrandNormalized = saStrand === '-' ? -1 : 1\n                    const saClipPos = getClip(saCigar, saStrandNormalized)\n                    const saRealStart = +saStart - 1 + saClipPos\n                    return {\n                      refName: saRef,\n                      start: saRealStart,\n                      end: saRealStart + saLengthOnRef,\n                      seqLength: saLength,\n                      clipPos: saClipPos,\n                      CIGAR: saCigar,\n                      assemblyName: trackAssembly,\n                      strand: saStrandNormalized,\n                      uniqueId: `${feature.id()}_SA${index}`,\n                      mate: {\n                        start: saClipPos,\n                        end: saClipPos + saLengthSansClipping,\n                        refName: readName,\n                      },\n                    }\n                  })\n\n                const feat = feature.toJSON()\n                feat.mate = {\n                  refName: readName,\n                  start: clipPos,\n                  end: clipPos + getLengthSansClipping(cigar),\n                }\n\n                // if secondary alignment or supplementary, calculate length from SA[0]'s CIGAR\n                // which is the primary alignments. otherwise it is the primary alignment just use\n                // seq.length if primary alignment\n                const totalLength =\n                  // eslint-disable-next-line no-bitwise\n                  flags & 2048\n                    ? getLength(supplementaryAlignments[0].CIGAR)\n                    : getLength(cigar)\n\n                const features = [\n                  feat,\n                  ...supplementaryAlignments,\n                ] as ReducedFeature[]\n\n                features.sort((a, b) => a.clipPos - b.clipPos)\n\n                const refLength = features.reduce(\n                  (a, f) => a + f.end - f.start,\n                  0,\n                )\n\n                session.addView('DotplotView', {\n                  type: 'DotplotView',\n                  hview: {\n                    offsetPx: 0,\n                    bpPerPx: refLength / 800,\n                    displayedRegions: features.map(f => {\n                      return {\n                        start: f.start,\n                        end: f.end,\n                        refName: f.refName,\n                        assemblyName: trackAssembly,\n                      }\n                    }),\n                  },\n                  vview: {\n                    offsetPx: 0,\n                    bpPerPx: totalLength / 400,\n                    displayedRegions: [\n                      {\n                        assemblyName: readAssembly,\n                        start: 0,\n                        end: totalLength,\n                        refName: readName,\n                      },\n                    ],\n                  },\n                  viewTrackConfigs: [\n                    {\n                      type: 'SyntenyTrack',\n                      assemblyNames,\n                      adapter: {\n                        type: 'FromConfigAdapter',\n                        features,\n                      },\n                      trackId,\n                      name: trackName,\n                    },\n                  ],\n                  viewAssemblyConfigs: [\n                    {\n                      name: readAssembly,\n                      sequence: {\n                        type: 'ReferenceSequenceTrack',\n                        trackId: `${readName}_${Date.now()}`,\n                        adapter: {\n                          type: 'FromConfigSequenceAdapter',\n                          features: [feature.toJSON()],\n                        },\n                      },\n                    },\n                  ],\n                  assemblyNames,\n                  tracks: [\n                    {\n                      configuration: trackId,\n                      type: 'SyntenyTrack',\n                      displays: [\n                        {\n                          type: 'DotplotDisplay',\n                          configuration: `${trackId}-DotplotDisplay`,\n                        },\n                      ],\n                    },\n                  ],\n                  displayName: `${readName} vs ${trackAssembly}`,\n                })\n              },\n            },\n          ]\n        : []\n    }\n    function addContextMenu(view: View) {\n      if (view.type === 'LinearGenomeView') {\n        view.tracks.forEach(track => {\n          if (track.type === 'AlignmentsTrack') {\n            track.displays.forEach(display => {\n              if (\n                display.type === 'LinearPileupDisplay' &&\n                !display.additionalContextMenuItemCallbacks.includes(cb)\n              ) {\n                display.addAdditionalContextMenuItemCallback(cb)\n              } else if (\n                display.type === 'LinearAlignmentsDisplay' &&\n                display.PileupDisplay &&\n                !display.PileupDisplay.additionalContextMenuItemCallbacks.includes(\n                  cb,\n                )\n              ) {\n                display.PileupDisplay.addAdditionalContextMenuItemCallback(cb)\n              }\n            })\n          }\n        })\n      }\n    }\n    autorun(() => {\n      const session = pluginManager.rootModel?.session as Session | undefined\n      if (session) {\n        session.views.forEach(view => {\n          if (view.views) {\n            view.views.forEach(v => addContextMenu(v))\n          } else {\n            addContextMenu(view)\n          }\n        })\n      }\n    })\n  }\n}\n","import { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\nfunction makeFilters(displayModel) {\n  const filters = []\n  const { filterOut } = displayModel\n  for (const attrName of filterOut.keys()) {\n    for (const value of filterOut.get(attrName).keys()) {\n      if (filterOut.get(attrName).get(value)) {\n        filters.push(\n          `function(f) { return String(f.get('${attrName}')) !== '${value}'}`,\n        )\n      }\n    }\n  }\n  return filters\n}\n\nexport default configSchema => {\n  return types.compose(\n    'LinearFilteringDisplay',\n    BaseLinearDisplay,\n    types\n      .model({\n        type: types.literal('LinearFilteringDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        hideExpressions: types.optional(types.array(types.string), () => []),\n        height: 193,\n        filterControlsHeight: 70,\n        dragHandleHeight: 3,\n        filterOut: types.map(types.map(types.boolean)), // model[attrName][value] = true if filtering out\n      })\n      .views(self => ({\n        get renderProps() {\n          const filters = makeFilters(self)\n          return {\n            ...getParentRenderProps(self),\n            ...this.composedRenderProps,\n            displayModel: self,\n            config: self.configuration.renderer,\n            filters,\n          }\n        },\n        get innerDisplayHeight() {\n          return self.height - self.dragHandleHeight - self.filterControlsHeight\n        },\n        get filterControlsMinHeight() {\n          return Math.min(self.filterControlsMaxHeight, 40)\n        },\n        get filterControlsMaxHeight() {\n          return Math.max(self.height - 20, 0)\n        },\n        get rendererTypeName() {\n          return self.configuration.renderer.type\n        },\n      }))\n      .actions(self => ({\n        setFilterControlsHeight(newHeight) {\n          if (newHeight > self.filterControlsMinHeight) {\n            if (newHeight < self.filterControlsMaxHeight)\n              self.filterControlsHeight = newHeight\n            else self.filterControlsHeight = self.filterControlsMaxHeight\n          } else self.filterControlsHeight = self.filterControlsMinHeight\n          return self.filterControlsHeight\n        },\n        resizeFilterControls(distance) {\n          const oldHeight = self.filterControlsHeight\n          const newHeight = self.setFilterControlsHeight(\n            self.filterControlsHeight - distance,\n          )\n          return oldHeight - newHeight\n        },\n        toggleFilter(attrName, value, checked) {\n          if (!self.filterOut.has(attrName)) self.filterOut.set(attrName, {})\n          const values = self.filterOut.get(attrName)\n          values.set(String(value), !checked)\n        },\n      })),\n  )\n}\n","import { getConf } from '@jbrowse/core/configuration'\nimport Checkbox from '@material-ui/core/Checkbox'\nimport FormControl from '@material-ui/core/FormControl'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\nimport FormGroup from '@material-ui/core/FormGroup'\nimport FormHelperText from '@material-ui/core/FormHelperText'\nimport FormLabel from '@material-ui/core/FormLabel'\nimport { withStyles } from '@material-ui/core/styles'\nimport Typography from '@material-ui/core/Typography'\nimport { reaction } from 'mobx'\nimport { observer, PropTypes as MxPropTypes } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React, { Component } from 'react'\n\nconst styles = theme => ({\n  root: {\n    background: theme.palette.background.default,\n    overflow: 'auto',\n    paddingTop: 0,\n    paddingBottom: theme.spacing(1),\n    paddingLeft: theme.spacing(1),\n    paddingRight: theme.spacing(1),\n    display: 'flex',\n    flexWrap: 'wrap',\n  },\n  header: {\n    width: '100%',\n  },\n  title: {\n    // fontSize: '80%',\n  },\n})\n\nfunction visibleValues(model, attrName) {\n  const { features, filterOut } = model\n  const values = new Set()\n  for (const feature of features.values()) {\n    values.add(feature.get(attrName))\n  }\n  if (filterOut.has(attrName)) {\n    for (const value of filterOut.get(attrName).keys()) {\n      values.add(value)\n    }\n  }\n  return Array.from(values.values()).sort()\n}\n\nconst AttributeFilter = withStyles(styles)(\n  observer(({ attrName, model, classes, values }) => (\n    <FormControl component=\"fieldset\" className={classes.formControl}>\n      <FormLabel component=\"legend\">{attrName}</FormLabel>\n      <FormGroup row>\n        {!values.length ? (\n          <FormHelperText style={{ marginRight: '1em' }}>\n            no values seen yet\n          </FormHelperText>\n        ) : (\n          values.map(value => (\n            <FormControlLabel\n              key={`${attrName}-${value}`}\n              control={\n                <Checkbox\n                  checked={\n                    !(\n                      model.filterOut.has(attrName) &&\n                      model.filterOut.get(attrName).get(String(value))\n                    )\n                  }\n                  onChange={evt =>\n                    model.toggleFilter(attrName, value, evt.target.checked)\n                  }\n                />\n              }\n              label={value}\n            />\n          ))\n        )}\n      </FormGroup>\n    </FormControl>\n  )),\n)\n\nAttributeFilter.propTypes = {\n  attrName: ReactPropTypes.string.isRequired,\n  model: MxPropTypes.objectOrObservableObject.isRequired,\n  values: ReactPropTypes.arrayOf(ReactPropTypes.string).isRequired,\n}\n\nclass FilterControls extends Component {\n  constructor(props) {\n    super(props)\n    this.state = { seenAttributes: {} }\n    const { model } = props\n    this.autorunDisposer = reaction(\n      () => {\n        const newSeenAttributes = {}\n        getConf(model, 'filterAttributes').forEach(attrName => {\n          if (!newSeenAttributes[attrName]) newSeenAttributes[attrName] = {}\n          visibleValues(model, attrName).forEach(value => {\n            newSeenAttributes[attrName][value] = true\n          })\n        })\n        return newSeenAttributes\n      },\n      newSeenAttributes => {\n        this.setState(state => {\n          const seenAttributes = {}\n          Object.keys(newSeenAttributes).forEach(attrName => {\n            seenAttributes[attrName] = {\n              ...(state.seenAttributes[attrName] || {}),\n              ...newSeenAttributes[attrName],\n            }\n          })\n          return { seenAttributes }\n        })\n      },\n      { delay: 400 },\n    )\n  }\n\n  componentWillUnmount() {\n    this.autorunDisposer()\n  }\n\n  render() {\n    const { classes, style, model } = this.props\n    const { seenAttributes } = this.state\n    return (\n      <div style={style} className={classes.root}>\n        <div className={classes.header}>\n          <Typography\n            className={classes.title}\n            variant=\"subtitle2\"\n            gutterBottom\n          >\n            Filters\n          </Typography>\n        </div>\n        {Object.keys(seenAttributes)\n          .sort()\n          .map(attrName => (\n            <AttributeFilter\n              key={attrName}\n              attrName={attrName}\n              model={model}\n              values={Object.keys(seenAttributes[attrName]).sort()}\n            />\n          ))}\n      </div>\n    )\n  }\n}\nFilterControls.propTypes = {\n  classes: ReactPropTypes.shape({\n    root: ReactPropTypes.string,\n    header: ReactPropTypes.string,\n    title: ReactPropTypes.string,\n  }).isRequired,\n  style: ReactPropTypes.shape({ height: ReactPropTypes.any }),\n  model: MxPropTypes.objectOrObservableObject.isRequired,\n}\n\nFilterControls.defaultProps = { style: {} }\n\nexport default withStyles(styles)(observer(FilterControls))\n","import { ResizeHandle } from '@jbrowse/core/ui'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer, PropTypes } from 'mobx-react'\nimport React from 'react'\nimport FilterControls from './FilterControls'\n\nconst useStyles = makeStyles(theme => ({\n  display: {\n    background: 'white',\n    height: '100%',\n    overflow: 'hidden',\n  },\n  innerDisplay: {\n    overflowY: 'auto',\n    overflowX: 'hidden',\n  },\n  filterControls: {\n    background: theme.palette.background.default,\n  },\n}))\n\nfunction LinearFilteringDisplay(props) {\n  const { model } = props\n  const classes = useStyles()\n  const { innerDisplayHeight, filterControlsHeight, dragHandleHeight } = model\n  return (\n    <div className={classes.display}>\n      <div\n        className={classes.innerDisplay}\n        style={{ height: innerDisplayHeight }}\n      >\n        <BaseLinearDisplayComponent {...props} />\n      </div>\n      <ResizeHandle\n        onDrag={model.resizeFilterControls}\n        style={{\n          height: dragHandleHeight,\n          background: '#ccc',\n          boxSizing: 'border-box',\n          borderTop: '1px solid #fafafa',\n        }}\n      />\n      <FilterControls style={{ height: filterControlsHeight }} {...props} />\n    </div>\n  )\n}\n\nLinearFilteringDisplay.propTypes = {\n  model: PropTypes.observableObject.isRequired,\n}\n\nexport default observer(LinearFilteringDisplay)\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  configSchemaFactory as linearFilteringDisplayConfigSchemaFactory,\n  modelFactory as linearFilteringDisplayModelFactory,\n  ReactComponent as LinearFilteringDisplayReactComponent,\n} from './LinearFilteringDisplay'\n\nexport default class extends Plugin {\n  name = 'FilteringTrackPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearFilteringDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearFilteringDisplay',\n        configSchema,\n        stateModel: linearFilteringDisplayModelFactory(configSchema),\n        trackType: 'FeatureTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: LinearFilteringDisplayReactComponent,\n      })\n    })\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\n\nexport { default as modelFactory } from './model'\nexport { default as ReactComponent } from './components/LinearFilteringDisplay'\n\nexport function configSchemaFactory(pluginManager) {\n  return ConfigurationSchema(\n    'LinearFilteringDisplay',\n    {\n      filterAttributes: {\n        type: 'stringArray',\n        defaultValue: ['type'],\n        description: 'list of feature attributes to use for filtering',\n      },\n    },\n    {\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n","/* eslint-disable no-underscore-dangle */\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { doesIntersect2 } from '@jbrowse/core/util/range'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { TabixIndexedFile } from '@gmod/tabix'\nimport gff from '@gmod/gff'\nimport { Observer } from 'rxjs'\n\nimport { Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport MyConfigSchema from './configSchema'\n\ntype Strand = '+' | '-' | '.' | '?'\ninterface FeatureLoc {\n  [key: string]: unknown\n  start: number\n  end: number\n  strand: Strand\n  seq_id: string\n  child_features: FeatureLoc[][]\n  data: unknown\n  derived_features: unknown\n  attributes: { [key: string]: unknown[] }\n}\n\ninterface LineFeature {\n  start: number\n  end: number\n  lineHash: number\n  fields: string[]\n}\n\nexport default class extends BaseFeatureDataAdapter {\n  protected gff: TabixIndexedFile\n\n  protected dontRedispatch: string[]\n\n  public constructor(config: Instance<typeof MyConfigSchema>) {\n    super(config)\n    const gffGzLocation = readConfObject(config, 'gffGzLocation')\n    const indexType = readConfObject(config, ['index', 'indexType'])\n    const location = readConfObject(config, ['index', 'location'])\n    const dontRedispatch = readConfObject(config, 'dontRedispatch')\n\n    this.dontRedispatch = dontRedispatch || ['chromosome', 'contig', 'region']\n    this.gff = new TabixIndexedFile({\n      filehandle: openLocation(gffGzLocation),\n      csiFilehandle: indexType === 'CSI' ? openLocation(location) : undefined,\n      tbiFilehandle: indexType !== 'CSI' ? openLocation(location) : undefined,\n      chunkCacheSize: 50 * 2 ** 20,\n      renameRefSeqs: (n: string) => n,\n    })\n  }\n\n  public async getRefNames(opts: BaseOptions = {}) {\n    return this.gff.getReferenceSequenceNames(opts)\n  }\n\n  public getFeatures(query: NoAssemblyRegion, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const metadata = await this.gff.getMetadata()\n      this.getFeaturesHelper(query, opts, metadata, observer, true)\n    }, opts.signal)\n  }\n\n  private async getFeaturesHelper(\n    query: NoAssemblyRegion,\n    opts: BaseOptions = {},\n    metadata: { columnNumbers: { start: number; end: number } },\n    observer: Observer<Feature>,\n    allowRedispatch: boolean,\n    originalQuery = query,\n  ) {\n    try {\n      const lines: LineFeature[] = []\n\n      await this.gff.getLines(\n        query.refName,\n        query.start,\n        query.end,\n        (line: string, fileOffset: number) => {\n          lines.push(this.parseLine(metadata.columnNumbers, line, fileOffset))\n        },\n      )\n      if (allowRedispatch && lines.length) {\n        let minStart = Infinity\n        let maxEnd = -Infinity\n        lines.forEach(line => {\n          const featureType = line.fields[2]\n          // only expand redispatch range if feature is not a \"dontRedispatch\" type\n          // skips large regions like chromosome,region\n          if (!this.dontRedispatch.includes(featureType)) {\n            const start = line.start - 1 // gff is 1-based\n            if (start < minStart) {\n              minStart = start\n            }\n            if (line.end > maxEnd) {\n              maxEnd = line.end\n            }\n          }\n        })\n        if (maxEnd > query.end || minStart < query.start) {\n          // console.log(\n          //   `redispatching ${query.start}-${query.end} => ${minStart}-${maxEnd}`,\n          // )\n          // make a new feature callback to only return top-level features\n          // in the original query range\n\n          this.getFeaturesHelper(\n            { ...query, start: minStart, end: maxEnd },\n            opts,\n            metadata,\n            observer,\n            false,\n            query,\n          )\n          return\n        }\n      }\n\n      const gff3 = lines\n        .map((lineRecord: LineFeature) => {\n          if (lineRecord.fields[8] && lineRecord.fields[8] !== '.') {\n            if (!lineRecord.fields[8].includes('_lineHash'))\n              lineRecord.fields[8] += `;_lineHash=${lineRecord.lineHash}`\n          } else {\n            lineRecord.fields[8] = `_lineHash=${lineRecord.lineHash}`\n          }\n          return lineRecord.fields.join('\\t')\n        })\n        .join('\\n')\n\n      const features = gff.parseStringSync(gff3, {\n        parseFeatures: true,\n        parseComments: false,\n        parseDirectives: false,\n        parseSequences: false,\n      }) as FeatureLoc[][]\n\n      features.forEach(featureLocs =>\n        this.formatFeatures(featureLocs).forEach(f => {\n          if (\n            doesIntersect2(\n              f.get('start'),\n              f.get('end'),\n              originalQuery.start,\n              originalQuery.end,\n            )\n          ) {\n            observer.next(f)\n          }\n        }),\n      )\n      observer.complete()\n    } catch (e) {\n      observer.error(e)\n    }\n  }\n\n  private parseLine(\n    columnNumbers: { start: number; end: number },\n    line: string,\n    fileOffset: number,\n  ) {\n    const fields = line.split('\\t')\n\n    // note: index column numbers are 1-based\n    return {\n      start: +fields[columnNumbers.start - 1],\n      end: +fields[columnNumbers.end - 1],\n      lineHash: fileOffset,\n      fields,\n    }\n  }\n\n  private formatFeatures(featureLocs: FeatureLoc[]) {\n    return featureLocs.map(\n      featureLoc =>\n        new SimpleFeature({\n          data: this.featureData(featureLoc),\n          id: `${this.id}-offset-${featureLoc.attributes._lineHash[0]}`,\n        }),\n    )\n  }\n\n  private featureData(data: FeatureLoc) {\n    const f: Record<string, unknown> = { ...data }\n\n    ;(f.start as number) -= 1 // convert to interbase\n    f.strand = { '+': 1, '-': -1, '.': 0, '?': undefined }[data.strand] // convert strand\n    f.phase = Number(data.phase)\n    f.refName = data.seq_id\n    if (data.score === null) {\n      delete f.score\n    }\n    if (data.phase === null) {\n      delete f.score\n    }\n    const defaultFields = [\n      'start',\n      'end',\n      'seq_id',\n      'score',\n      'type',\n      'source',\n      'phase',\n      'strand',\n    ]\n    Object.keys(data.attributes).forEach(a => {\n      let b = a.toLowerCase()\n      if (defaultFields.includes(b)) {\n        // add \"suffix\" to tag name if it already exists\n        // reproduces behavior of NCList\n        b += '2'\n      }\n      if (data.attributes[a] !== null) {\n        let attr = data.attributes[a]\n        if (Array.isArray(attr) && attr.length === 1) {\n          ;[attr] = attr\n        }\n        f[b] = attr\n      }\n    })\n    f.refName = f.seq_id\n\n    // the SimpleFeature constructor takes care of recursively inflating subfeatures\n    if (data.child_features && data.child_features.length) {\n      f.subfeatures = data.child_features\n        .map(childLocs => childLocs.map(childLoc => this.featureData(childLoc)))\n        .flat()\n    }\n\n    delete f.child_features\n    delete f.data\n    delete f.derived_features\n    delete f._linehash\n    delete f.attributes\n    delete f.seq_id\n    return f\n  }\n\n  public freeResources(/* { region } */) {}\n}\n","import { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'Gff3TabixAdapter',\n  {\n    gffGzLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.gff.gz' },\n    },\n    index: ConfigurationSchema('Gff3TabixIndex', {\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      location: {\n        type: 'fileLocation',\n        defaultValue: { uri: '/path/to/my.gff.gz.tbi' },\n      },\n    }),\n    dontRedispatch: {\n      type: 'stringArray',\n      defaultValue: ['chromosome', 'region'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport {\n  AdapterClass as Gff3TabixAdapterClass,\n  configSchema as gff3TabixAdapterConfigSchema,\n} from './Gff3TabixAdapter'\n\nexport default class extends Plugin {\n  name = 'GFF3TabixPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'Gff3TabixAdapter',\n          configSchema: gff3TabixAdapterConfigSchema,\n          AdapterClass: Gff3TabixAdapterClass,\n        }),\n    )\n  }\n}\n","import {\n  Feature,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util/simpleFeature'\n\nconst jb2ToJb1 = { refName: 'seq_id' }\n\nconst jb1ToJb2 = { seq_id: 'refName' }\n\n/**\n * wrapper to adapt nclist features to act like jbrowse 2 features\n */\nexport default class NCListFeature implements Feature {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private ncFeature: any\n\n  private parentHandle?: Feature\n\n  private uniqueId: string\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(ncFeature: any, parent?: Feature, id?: string) {\n    this.ncFeature = ncFeature\n    this.uniqueId = id || ncFeature.id()\n    this.parentHandle = parent\n  }\n\n  set(): void {\n    throw new Error('not implemented')\n  }\n\n  jb2TagToJb1Tag(tag: string): string {\n    // @ts-ignore\n    const mapped = jb2ToJb1[tag] || tag\n    return mapped.toLowerCase()\n  }\n\n  jb1TagToJb2Tag(tag: string): string {\n    const t = tag.toLowerCase()\n    // @ts-ignore\n    const mapped = jb1ToJb2[t] || t\n    return mapped\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get(attrName: string): any {\n    const attr = this.ncFeature.get(this.jb2TagToJb1Tag(attrName))\n    if (attr && attrName === 'subfeatures')\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return attr.map((subfeature: any) => new NCListFeature(subfeature, this))\n    return attr\n  }\n\n  /**\n   * Get an array listing which data keys are present in this feature.\n   */\n  tags(): string[] {\n    return this.ncFeature.tags().map((t: string) => this.jb1TagToJb2Tag(t))\n  }\n\n  /**\n   * Get the unique ID of this feature.\n   */\n  id(): string {\n    return this.uniqueId\n  }\n\n  /**\n   * Get this feature's parent feature, or undefined if none.\n   */\n  parent(): Feature | undefined {\n    return this.parentHandle\n  }\n\n  /**\n   * Get an array of child features, or undefined if none.\n   */\n  children(): Feature[] | undefined {\n    return this.get('subfeatures')\n  }\n\n  toJSON(): SimpleFeatureSerialized {\n    const data: SimpleFeatureSerialized = { uniqueId: this.id() }\n    this.ncFeature.tags().forEach((tag: string) => {\n      const mappedTag = this.jb1TagToJb2Tag(tag)\n      const value = this.ncFeature.get(tag)\n      if (mappedTag === 'subfeatures') {\n        data.subfeatures = (value || []).map((f: Feature) => {\n          // note: was new NCListFeature(f, `${this.id()}-${i}`, this).toJSON()\n          return new NCListFeature(f, this).toJSON()\n        })\n      } else {\n        data[mappedTag] = value\n      }\n    })\n    return data\n  }\n}\n","import NCListStore from '@gmod/nclist'\nimport { openUrl } from '@jbrowse/core/util/io'\nimport { Region } from '@jbrowse/core/util/types'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { checkAbortSignal } from '@jbrowse/core/util'\n\nimport { Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport NCListFeature from './NCListFeature'\nimport MyConfigSchema from './configSchema'\n\nexport default class NCListAdapter extends BaseFeatureDataAdapter {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private nclist: any\n\n  private configRefNames?: string[]\n\n  constructor(config: Instance<typeof MyConfigSchema>) {\n    super(config)\n    const refNames = readConfObject(config, 'refNames')\n    const rootUrlTemplate = readConfObject(config, 'rootUrlTemplate')\n    this.configRefNames = refNames\n\n    this.nclist = new NCListStore({\n      baseUrl: '',\n      urlTemplate: rootUrlTemplate.uri,\n      readFile: (url: string) =>\n        openUrl(\n          rootUrlTemplate.baseUri\n            ? new URL(url, rootUrlTemplate.baseUri).toString()\n            : url,\n        ).readFile(),\n    })\n  }\n\n  /**\n   * Fetch features for a certain region. Use getFeaturesInRegion() if you also\n   * want to verify that the store has features for the given reference sequence\n   * before fetching.\n   * @param region -\n   * @param opts - [signal] optional signalling object for aborting the fetch\n   * @returns Observable of Feature objects in the region\n   */\n  getFeatures(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const { signal } = opts\n      for await (const feature of this.nclist.getFeatures(region, opts)) {\n        checkAbortSignal(signal)\n        observer.next(this.wrapFeature(feature))\n      }\n      observer.complete()\n    })\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  wrapFeature(ncFeature: any): NCListFeature {\n    return new NCListFeature(\n      ncFeature,\n      undefined,\n      `${this.id}-${ncFeature.id()}`,\n    )\n  }\n\n  async hasDataForRefName(refName: string) {\n    const root = await this.nclist.getDataRoot(refName)\n    return !!(root && root.stats && root.stats.featureCount)\n  }\n\n  /*\n   * NCList is unable to get list of ref names so returns empty\n   * @return Promise<string[]> of empty list\n   */\n  getRefNames() {\n    return Promise.resolve(this.configRefNames || [])\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the forseeable future and can be purged\n   * from caches, etc\n   */\n  freeResources() {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'NCListAdapter',\n  {\n    rootUrlTemplate: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my/{refseq}/trackData.json' },\n    },\n    refNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of refNames used by the NCList used for aliasing',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'JBrowse1Connection',\n  {\n    dataDirLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: 'http://mysite.com/jbrowse/data/' },\n      description:\n        'the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/',\n    },\n  },\n  { baseConfiguration: baseConnectionConfig },\n)\n","/* eslint no-cond-assign: [\"error\", \"except-parens\"] */\nimport getValue from 'get-value'\nimport setValue from 'set-value'\nimport { isSource, isTrack, objectFingerprint } from './util'\nimport { Config, Track, Source, Store, Names } from './types'\n\nexport function parseJB1Json(config: Config | string, url: string): Config {\n  if (typeof config === 'string') {\n    let parsedConf\n    try {\n      parsedConf = JSON.parse(config)\n    } catch (error) {\n      throw new Error(`${error} when parsing configuration.`)\n    }\n    return regularizeConf(parsedConf, url)\n  }\n  return regularizeConf(config, url)\n}\n\nexport function parseJB1Conf(config: string, url: string): Config {\n  let parsedConf\n  try {\n    parsedConf = parse(config, url)\n  } catch (error) {\n    throw new Error(`${error} when parsing configuration.`)\n  }\n  return regularizeConf(parsedConf, url)\n}\n\nfunction isAlwaysArray(varName: string): boolean {\n  if (varName === 'include') return true\n  return false\n}\n\nfunction parse(text: string, url: string): Config {\n  let section: string[] = []\n  let keyPath: string[] | undefined\n  let operation: string\n  let value: string | undefined\n  const data: Config = { tracks: {} }\n  let lineNumber: number\n\n  function recordVal(): void {\n    if (value !== undefined) {\n      let parsedValue:\n        | string\n        | number\n        | boolean\n        | string[]\n        | number[]\n        | boolean[]\n      try {\n        // parse json\n        const match = value.match(/^json:(.+)/i)\n        if (match) parsedValue = JSON.parse(match[1])\n        // parse numbers if it looks numeric\n        else if (/^[+-]?[\\d.,]+([eE][-+]?\\d+)?$/.test(value))\n          parsedValue = parseFloat(value.replace(/,/g, ''))\n        else parsedValue = value\n\n        if (!keyPath)\n          throw new Error(`Error parsing in section ${section.join(' - ')}`)\n        const path = section.concat(keyPath).join('.')\n        if (operation === '+=') {\n          let existing = getValue(data, path)\n          if (existing) {\n            if (!Array.isArray(existing)) existing = [existing]\n          } else existing = []\n\n          existing.push(parsedValue)\n          parsedValue = existing\n        }\n        if (parsedValue === 'true') parsedValue = true\n        if (parsedValue === 'false') parsedValue = false\n        setValue(data, path, parsedValue)\n      } catch (e) {\n        throw new Error(\n          `syntax error${url ? ` in ${url}` : ''}${\n            lineNumber ? ` at line ${lineNumber - 1}` : ''\n          }`,\n        )\n      }\n    }\n  }\n\n  text.split('\\n').forEach((textLine, i): void => {\n    lineNumber = i + 1\n    const line = textLine.replace(/^\\s*#.+/, '')\n\n    // new section\n    let match: RegExpMatchArray | null\n    if ((match = line.match(/^\\s*\\[([^\\]]+)/))) {\n      // new section\n      recordVal()\n      keyPath = undefined\n      value = undefined\n      section = match[1].trim().split(/\\s*\\.\\s*/)\n      if (section.length === 1 && section[0].toLowerCase() === 'general')\n        section = []\n    }\n    // new value\n    else if (\n      (match = line.match(\n        value === undefined ? /^([^+=]+)(\\+?=)(.*)/ : /^(\\S[^+=]+)(\\+?=)(.*)/,\n      ))\n    ) {\n      recordVal()\n      keyPath = match[1].trim().split(/\\s*\\.\\s*/)\n      ;[, , operation] = match\n      if (isAlwaysArray(section.concat(keyPath).join('.'))) {\n        operation = '+='\n      }\n      value = match[3].trim()\n    }\n    // add to existing array value\n    else if (\n      keyPath !== undefined &&\n      (match = line.match(/^\\s{0,4}\\+\\s*(.+)/))\n    ) {\n      recordVal()\n      operation = '+='\n      value = match[1].trim()\n    }\n    // add to existing value\n    else if (value !== undefined && (match = line.match(/^\\s+(\\S.*)/))) {\n      value += value.length ? ` ${match[1].trim()}` : match[1].trim()\n    }\n    // done with last value\n    else {\n      recordVal()\n      keyPath = undefined\n      value = undefined\n    }\n  })\n\n  recordVal()\n\n  return data\n}\n\n/**\n * Applies defaults and any other necessary tweaks to the loaded configuration.\n * @param conf - the object containing the configuration, which it modifies\n * in-place\n * @param url - URL of the config file\n * @returns the same object it was passed\n */\nexport function regularizeConf(conf: Config, url: string): Config {\n  // if tracks is not an array, convert it to one\n  if (conf.tracks && !Array.isArray(conf.tracks)) {\n    // if it's a single track config, wrap it in an arrayref\n    if (isTrack(conf.tracks)) conf.tracks = [conf.tracks]\n    // otherwise, coerce it to an array\n    else {\n      const tracks: Track[] = []\n      for (const label of Object.keys(conf.tracks)) {\n        const track = conf.tracks[label]\n        if (isTrack(track)) tracks.push(track)\n        else tracks.push({ label, ...track })\n      }\n      conf.tracks = tracks\n    }\n  }\n\n  // regularize trackMetadata.sources\n  const meta = conf.trackMetadata\n  if (meta && meta.sources) {\n    // if it's a single source config, wrap it in an arrayref\n    if (typeof meta.sources === 'string') meta.sources = [meta.sources]\n    if (isSource(meta.sources)) meta.sources = [meta.sources]\n\n    if (!Array.isArray(meta.sources)) {\n      const sources: Source[] = []\n      for (const name of Object.keys(meta.sources)) {\n        const source = meta.sources[name]\n        if (!('name' in source)) source.name = name\n        sources.push(source)\n      }\n      meta.sources = sources\n    }\n\n    // coerce any string source defs to be URLs, and try to detect their types\n    meta.sources = meta.sources.map(\n      (sourceDef: string | Source): Source => {\n        if (typeof sourceDef === 'string') {\n          const newSourceDef: Source = { url: sourceDef }\n          const typeMatch = sourceDef.match(/\\.(\\w+)$/)\n          if (typeMatch) newSourceDef.type = typeMatch[1].toLowerCase()\n          return newSourceDef\n        }\n        return sourceDef\n      },\n    )\n  }\n\n  conf.sourceUrl = conf.sourceUrl || url\n  if (conf.sourceUrl.startsWith('/'))\n    conf.sourceUrl = new URL(conf.sourceUrl, window.location.href).href\n  conf.baseUrl = conf.baseUrl || new URL('.', conf.sourceUrl).href\n  if (conf.baseUrl.length && !conf.baseUrl.endsWith('/')) conf.baseUrl += '/'\n\n  if (conf.sourceUrl) {\n    // set a default baseUrl in each of the track and store confs, and the names\n    // conf, if needed\n    const addBase: (Track | Store | Names)[] = []\n    if (conf.tracks) addBase.push(...conf.tracks)\n    if (conf.stores) addBase.push(...Object.values(conf.stores))\n    if (conf.names) addBase.push(conf.names)\n\n    addBase.forEach((t): void => {\n      if (!t.baseUrl) t.baseUrl = conf.baseUrl || '/'\n    })\n\n    // resolve the refSeqs and nameUrl if present\n    if (conf.refSeqs && typeof conf.refSeqs === 'string')\n      conf.refSeqs = new URL(conf.refSeqs, conf.sourceUrl).href\n    if (conf.nameUrl) conf.nameUrl = new URL(conf.nameUrl, conf.sourceUrl).href\n  }\n\n  conf.stores = conf.stores || {}\n  ;(conf.tracks || []).forEach((trackConfig: Track): void => {\n    // if there is a `config` subpart, just copy its keys in to the top-level\n    // config\n    if (trackConfig.config) {\n      const c = trackConfig.config\n      delete trackConfig.config\n      trackConfig = { ...c, ...trackConfig }\n    }\n\n    // skip if it's a new-style track def\n    if (trackConfig.store) return\n\n    let trackClassName: string\n    if (trackConfig.type === 'FeatureTrack')\n      trackClassName = 'JBrowse/View/Track/HTMLFeatures'\n    else if (trackConfig.type === 'ImageTrack')\n      trackClassName = 'JBrowse/View/Track/FixedImage'\n    else if (trackConfig.type === 'ImageTrack.Wiggle')\n      trackClassName = 'JBrowse/View/Track/FixedImage/Wiggle'\n    else if (trackConfig.type === 'SequenceTrack')\n      trackClassName = 'JBrowse/View/Track/Sequence'\n    else\n      trackClassName = regularizeClass('JBrowse/View/Track', trackConfig.type)\n\n    trackConfig.type = trackClassName\n\n    synthesizeTrackStoreConfig(conf, trackConfig)\n\n    if (trackConfig.histograms) {\n      if (!trackConfig.histograms.baseUrl)\n        trackConfig.histograms.baseUrl = trackConfig.baseUrl\n      synthesizeTrackStoreConfig(conf, trackConfig.histograms)\n    }\n  })\n\n  return conf\n}\n\n/**\n * prefix class name with `root` if it contains no slashes\n * @param root - Prefix root\n * @param className - class name\n */\nfunction regularizeClass(root: string, className: string | undefined): string {\n  if (!className) return ''\n  if (!className.includes('/')) className = `${root}/${className}`\n  className = className.replace(/^\\//, '')\n  return className\n}\n\nfunction guessStoreClass(\n  trackConfig: Track | undefined,\n  urlTemplate: string,\n): string {\n  if (!trackConfig) return ''\n  if (trackConfig.type && trackConfig.type.includes('/FixedImage'))\n    return `JBrowse/Store/TiledImage/Fixed${\n      trackConfig.backendVersion === 0 ? '_v0' : ''\n    }`\n  if (/\\.jsonz?$/i.test(urlTemplate))\n    return `JBrowse/Store/SeqFeature/NCList${\n      trackConfig.backendVersion === 0 ? '_v0' : ''\n    }`\n  if (/\\.bam$/i.test(urlTemplate)) return 'JBrowse/Store/SeqFeature/BAM'\n  if (/\\.cram$/i.test(urlTemplate)) return 'JBrowse/Store/SeqFeature/CRAM'\n  if (/\\.gff3?$/i.test(urlTemplate)) return 'JBrowse/Store/SeqFeature/GFF3'\n  if (/\\.bed$/i.test(urlTemplate)) return 'JBrowse/Store/SeqFeature/BED'\n  if (/\\.vcf.b?gz$/i.test(urlTemplate))\n    return 'JBrowse/Store/SeqFeature/VCFTabix'\n  if (/\\.gff3?.b?gz$/i.test(urlTemplate))\n    return 'JBrowse/Store/SeqFeature/GFF3Tabix'\n  if (/\\.bed.b?gz$/i.test(urlTemplate))\n    return 'JBrowse/Store/SeqFeature/BEDTabix'\n  if (/\\.(bw|bigwig)$/i.test(urlTemplate))\n    return 'JBrowse/Store/SeqFeature/BigWig'\n  if (/\\.(bb|bigbed)$/i.test(urlTemplate))\n    return 'JBrowse/Store/SeqFeature/BigBed'\n  if (/\\.(fa|fasta)$/i.test(urlTemplate))\n    return 'JBrowse/Store/SeqFeature/IndexedFasta'\n  if (/\\.(fa|fasta)\\.b?gz$/i.test(urlTemplate))\n    return 'JBrowse/Store/SeqFeature/BgzipIndexedFasta'\n  if (/\\.2bit$/i.test(urlTemplate)) return 'JBrowse/Store/SeqFeature/TwoBit'\n  if (trackConfig.type && trackConfig.type.endsWith('/Sequence'))\n    return 'JBrowse/Store/Sequence/StaticChunked'\n  return ''\n}\n\nfunction synthesizeTrackStoreConfig(\n  mainConf: Config,\n  trackConfig: Track,\n): void {\n  // figure out what data store class to use with the track, applying some\n  // defaults if it is not explicit in the configuration\n  const { urlTemplate = '' } = trackConfig\n\n  let storeClass: string\n  if (trackConfig.storeClass)\n    storeClass = regularizeClass('JBrowse/Store', trackConfig.storeClass)\n  else storeClass = guessStoreClass(trackConfig, urlTemplate)\n\n  if (!storeClass) {\n    console.warn(\n      `Unable to determine an appropriate data store to use with track '${trackConfig.label}', please explicitly specify a storeClass in the configuration.`,\n    )\n    return\n  }\n\n  // synthesize a separate store conf\n  const storeConf: Store = { ...trackConfig, type: storeClass }\n\n  // if this is the first sequence store we see, and we have no refseqs store\n  // defined explicitly, make this the refseqs store.\n  if (\n    (storeClass === 'JBrowse/Store/Sequence/StaticChunked' ||\n      storeClass === 'JBrowse/Store/Sequence/IndexedFasta' ||\n      storeClass === 'JBrowse/Store/SeqFeature/IndexedFasta' ||\n      storeClass === 'JBrowse/Store/SeqFeature/BgzipIndexedFasta' ||\n      storeClass === 'JBrowse/Store/SeqFeature/TwoBit' ||\n      storeClass === 'JBrowse/Store/Sequence/TwoBit' ||\n      trackConfig.useAsRefSeqStore) &&\n    !(mainConf.stores && mainConf.stores.refseqs)\n  ) {\n    storeConf.name = 'refseqs'\n  } else {\n    storeConf.name = `store${objectFingerprint(storeConf)}`\n  }\n  // record it\n  if (!mainConf.stores) mainConf.stores = {}\n  mainConf.stores[storeConf.name] = storeConf\n\n  // connect it to the track conf\n  trackConfig.store = storeConf.name\n}\n","import { openLocation } from '@jbrowse/core/util/io'\nimport { parseJB1Json, parseJB1Conf, regularizeConf } from './jb1ConfigParse'\nimport { clone, deepUpdate, evalHooks, fillTemplate } from './util'\nimport {\n  JBLocation,\n  UriLocation,\n  LocalPathLocation,\n  Config,\n  Track,\n  Include,\n} from './types'\n\nfunction isUriLocation(location: JBLocation): location is UriLocation {\n  return (location as UriLocation).uri !== undefined\n}\n\nfunction isLocalPathLocation(\n  location: JBLocation,\n): location is LocalPathLocation {\n  return (location as LocalPathLocation).localPath !== undefined\n}\n\nexport async function fetchJb1(\n  dataRoot: JBLocation = { uri: '' },\n  baseConfig: Config = {\n    include: ['{dataRoot}/trackList.json', '{dataRoot}/tracks.conf'],\n  },\n  baseConfigRoot: JBLocation = { uri: '' },\n): Promise<Config> {\n  const protocol = 'uri' in dataRoot ? 'uri' : 'localPath'\n  const dataRootReg = JSON.parse(JSON.stringify(dataRoot))\n  let dataRootLocation = ''\n  if (isUriLocation(dataRoot)) dataRootLocation = dataRoot.uri\n  if (isLocalPathLocation(dataRoot)) dataRootLocation = dataRoot.localPath\n  if (dataRootLocation.endsWith('/'))\n    dataRootReg[protocol] = dataRootLocation.slice(\n      0,\n      dataRootLocation.length - 1,\n    )\n  if (\n    (isUriLocation(baseConfigRoot) && baseConfigRoot.uri) ||\n    (isLocalPathLocation(baseConfigRoot) && baseConfigRoot.localPath)\n  ) {\n    const baseProtocol = 'uri' in baseConfigRoot ? 'uri' : 'localPath'\n    let baseConfigLocation = ''\n    if (isUriLocation(baseConfigRoot)) baseConfigLocation = baseConfigRoot.uri\n    if (isLocalPathLocation(baseConfigRoot))\n      baseConfigLocation = baseConfigRoot.localPath\n    if (baseConfigLocation.endsWith('/'))\n      baseConfigLocation = baseConfigLocation.slice(\n        0,\n        baseConfigLocation.length - 1,\n      )\n    let newConfig: Config = {}\n    for (const conf of ['jbrowse.conf', 'jbrowse_conf.json']) {\n      let fetchedConfig = null\n      try {\n        // @ts-ignore\n        // eslint-disable-next-line no-await-in-loop\n        fetchedConfig = await fetchConfigFile({\n          [baseProtocol]: `${baseConfigLocation}/${conf}`,\n        })\n      } catch (error) {\n        console.error(\n          `tried to access ${baseConfigLocation}/${conf}, but failed`,\n        )\n      }\n      newConfig = mergeConfigs(newConfig, fetchedConfig) || {}\n    }\n    if (dataRootReg[protocol]) newConfig.dataRoot = dataRootReg[protocol]\n    return createFinalConfig(newConfig)\n  }\n  const newConfig = regularizeConf(baseConfig, window.location.href)\n  if (dataRootReg[protocol]) newConfig.dataRoot = dataRootReg[protocol]\n  return createFinalConfig(newConfig)\n}\n\nexport async function createFinalConfig(\n  baseConfig: Config,\n  defaults = configDefaults,\n): Promise<Config> {\n  const configWithDefaults = deepUpdate(clone(defaults), baseConfig)\n  let finalConfig = await loadIncludes(configWithDefaults)\n  finalConfig = mergeConfigs(finalConfig, baseConfig) || finalConfig\n  fillTemplates(finalConfig, finalConfig)\n  finalConfig = evalHooks(finalConfig)\n  validateConfig(finalConfig)\n  return finalConfig\n}\n\nexport async function fetchConfigFile(location: JBLocation): Promise<Config> {\n  const result = await openLocation(location).readFile('utf8')\n  if (typeof result !== 'string')\n    throw new Error(`Error opening location: ${location}`)\n  if (isUriLocation(location)) return parseJb1(result, location.uri)\n  if (isLocalPathLocation(location)) return parseJb1(result, location.localPath)\n  return parseJb1(result)\n}\n\nexport function parseJb1(config: string, url = ''): Config {\n  if (config.trim().startsWith('{')) return parseJB1Json(config, url)\n  return parseJB1Conf(config, url)\n}\n\n/**\n * Merges config object b into a. Properties in b override those in a.\n */\nfunction mergeConfigs(a: Config | null, b: Config | null): Config | null {\n  if (b === null) return null\n\n  if (a === null) a = {}\n\n  for (const prop of Object.keys(b)) {\n    if (prop === 'tracks' && prop in a) {\n      const aTracks = a[prop] || []\n      const bTracks = b[prop] || []\n      if (Array.isArray(aTracks) && Array.isArray(bTracks))\n        a[prop] = mergeTrackConfigs(aTracks || [], bTracks || [])\n      else\n        throw new Error(\n          `Track config has not been properly regularized: ${aTracks} ${bTracks}`,\n        )\n    } else if (\n      !noRecursiveMerge(prop) &&\n      prop in a &&\n      // @ts-ignore\n      typeof b[prop] === 'object' &&\n      // @ts-ignore\n      typeof a[prop] === 'object'\n    ) {\n      // @ts-ignore\n      a[prop] = deepUpdate(a[prop], b[prop])\n    } else if (prop === 'dataRoot') {\n      if (\n        a[prop] === undefined ||\n        (a[prop] === 'data' && b[prop] !== undefined)\n      ) {\n        a[prop] = b[prop]\n      }\n      // @ts-ignore\n    } else if (a[prop] === undefined || b[prop] !== undefined) {\n      // @ts-ignore\n      a[prop] = b[prop]\n    }\n  }\n  return a\n}\n\n/**\n * Special-case merging of two `tracks` configuration arrays.\n */\nfunction mergeTrackConfigs(a: Track[], b: Track[]): Track[] {\n  if (!b.length) return a\n\n  // index the tracks in `a` by track label\n  const aTracks: Record<string, Track> = {}\n  a.forEach((t, i): void => {\n    t.index = i\n    aTracks[t.label] = t\n  })\n\n  b.forEach((bT): void => {\n    const aT = aTracks[bT.label]\n    if (aT) {\n      mergeConfigs(aT, bT)\n    } else {\n      a.push(bT)\n    }\n  })\n\n  return a\n}\n\n/**\n * Recursively fetch, parse, and merge all the includes in the given config\n * object.  Calls the callback with the resulting configuration when finished.\n * @param inputConfig - Config to load includes into\n */\nasync function loadIncludes(inputConfig: Config): Promise<Config> {\n  inputConfig = clone(inputConfig)\n\n  async function loadRecur(\n    config: Config,\n    upstreamConf: Config,\n  ): Promise<Config> {\n    const sourceUrl = config.sourceUrl || config.baseUrl\n    if (!sourceUrl)\n      throw new Error(\n        `Could not determine source URL: ${JSON.stringify(config)}`,\n      )\n    const newUpstreamConf = mergeConfigs(clone(upstreamConf), config)\n    if (!newUpstreamConf) throw new Error('Problem merging configs')\n    const includes = fillTemplates(\n      regularizeIncludes(config.include || []),\n      newUpstreamConf,\n    )\n    delete config.include\n\n    const loads = includes.map(\n      async (include): Promise<Config> => {\n        include.cacheBuster = inputConfig.cacheBuster\n        const includedData = await fetchConfigFile({\n          uri: new URL(include.url, sourceUrl).href,\n        })\n        return loadRecur(includedData, newUpstreamConf)\n      },\n    )\n    const includedDataObjects = await Promise.all(loads)\n    includedDataObjects.forEach((includedData): void => {\n      config = mergeConfigs(config, includedData) || config\n    })\n    return config\n  }\n\n  return loadRecur(inputConfig, {})\n}\n\nfunction regularizeIncludes(\n  includes: Include | string | (Include | string)[] | null,\n): Include[] {\n  if (!includes) return []\n\n  // coerce include to an array\n  if (!Array.isArray(includes)) includes = [includes]\n\n  return includes.map(\n    (include): Include => {\n      // coerce bare strings in the includes to URLs\n      if (typeof include === 'string') include = { url: include }\n\n      // set defaults for format and version\n      if (!('format' in include)) {\n        include.format = include.url.endsWith('.conf') ? 'conf' : 'JB_json'\n      }\n      if (include.format === 'JB_json' && !('version' in include)) {\n        include.version = 1\n      }\n      return include\n    },\n  )\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction fillTemplates<T extends any>(subconfig: T, config: Config): T {\n  if (!subconfig) {\n    return subconfig\n  }\n  if (Array.isArray(subconfig)) {\n    for (let i = 0; i < subconfig.length; i += 1) {\n      subconfig[i] = fillTemplates(subconfig[i], config)\n    }\n  } else if (typeof subconfig === 'object') {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const sub = subconfig as Record<string, any>\n    for (const name of Object.keys(sub)) {\n      sub[name] = fillTemplates(sub[name], config)\n    }\n  } else if (typeof subconfig === 'string') {\n    // @ts-ignore\n    return fillTemplate(subconfig, config)\n  }\n\n  return subconfig\n}\n\n/**\n * list of config properties that should not be recursively merged\n * @param propName - name of config property\n */\nfunction noRecursiveMerge(propName: string): boolean {\n  return propName === 'datasets'\n}\n\nconst configDefaults = {\n  tracks: [],\n\n  containerID: 'GenomeBrowser',\n  dataRoot: 'data',\n  show_tracklist: true,\n  show_nav: true,\n  show_menu: true,\n  show_overview: true,\n  show_fullviewlink: true,\n  update_browser_title: true,\n  updateBrowserURL: true,\n\n  refSeqs: '{dataRoot}/seq/refSeqs.json',\n  include: ['jbrowse.conf', 'jbrowse_conf.json'],\n  nameUrl: '{dataRoot}/names/root.json',\n\n  datasets: {\n    _DEFAULT_EXAMPLES: true,\n    volvox: { url: '?data=sample_data/json/volvox', name: 'Volvox Example' },\n    modencode: {\n      url: '?data=sample_data/json/modencode',\n      name: 'MODEncode Example',\n    },\n    yeast: { url: '?data=sample_data/json/yeast', name: 'Yeast Example' },\n  },\n\n  highlightSearchedRegions: false,\n  highResolutionMode: 'auto',\n}\n\n/**\n * Examine the loaded and merged configuration for errors.  Throws\n * exceptions if it finds anything amiss.\n * @returns nothing meaningful\n */\nfunction validateConfig(config: Config): void {\n  if (!config.tracks) config.tracks = []\n  if (!config.baseUrl) {\n    throw new Error('Must provide a `baseUrl` in configuration')\n  }\n}\n","import { openLocation } from '@jbrowse/core/util/io'\nimport objectHash from 'object-hash'\nimport {\n  generateUnknownTrackConf,\n  generateUnsupportedTrackConf,\n  guessAdapter,\n  guessTrackType,\n  UNKNOWN,\n  UNSUPPORTED,\n} from '@jbrowse/core/util/tracks'\nimport { JBLocation, Track, RefSeqs, RefSeq } from './types'\n\ninterface Jb2Track {\n  trackId: string\n  name: string\n  description?: string\n  category?: string[]\n  adapter?: Jb2Adapter\n  type?: string\n  defaultRendering?: string\n}\n\ninterface Jb2Adapter {\n  type: string\n  features?: Jb2Feature[]\n  bamLocation?: Jb2Location\n  cramLocation?: JBLocation\n  craiLocation?: JBLocation\n  fastaLocation?: Jb2Location\n  faiLocation?: Jb2Location\n  gziLocation?: Jb2Location\n  twoBitLocation?: Jb2Location\n  bigWigLocation?: Jb2Location\n  bigBedLocation?: Jb2Location\n  vcfGzLocation?: Jb2Location\n  index?: { location: Jb2Location; indexType?: string }\n  rootUrlTemplate?: Jb2Location\n  sequenceAdapter?: Jb2Adapter\n}\n\ninterface Jb2Feature {\n  refName: string\n  uniqueId: string\n  start: number\n  end: number\n}\n\ninterface Jb2Location {\n  uri?: string\n  localPath?: string\n  blob?: Blob\n}\n\nexport function convertTrackConfig(\n  jb1TrackConfig: Track,\n  dataRoot: string,\n  sequenceAdapter: Jb2Adapter,\n): Jb2Track {\n  const jb2TrackConfig: Jb2Track = {\n    trackId: objectHash(jb1TrackConfig),\n    name: jb1TrackConfig.key || jb1TrackConfig.label,\n  }\n\n  const description =\n    jb1TrackConfig.metadata &&\n    (jb1TrackConfig.metadata.description || jb1TrackConfig.metadata.Description)\n  if (description) jb2TrackConfig.description = description\n\n  const category =\n    jb1TrackConfig.category ||\n    (jb1TrackConfig.metadata && jb1TrackConfig.metadata.category)\n  jb2TrackConfig.category = category ? category.split(/\\s*\\/\\s*/) : []\n\n  const { storeClass } = jb1TrackConfig\n  if (!jb1TrackConfig.urlTemplate) {\n    if (!(storeClass && storeClass.endsWith('FromConfig'))) {\n      const trackIdentifier = jb1TrackConfig.key || jb1TrackConfig.label\n      console.warn(\n        `Could not import JBrowse1 track \"${trackIdentifier}\" because it does not have a \"urlTemplate\" or is not a \"FromConfig\" track`,\n      )\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        trackIdentifier,\n        jb2TrackConfig.category,\n      )\n    }\n    return generateFromConfigTrackConfig(jb1TrackConfig, jb2TrackConfig)\n  }\n\n  const resolveUrlTemplate = (urlTemplate: string) => {\n    return new URL(urlTemplate, `${dataRoot}/`).href\n      .replace(/%7B/gi, '{')\n      .replace(/%7D/gi, '}')\n  }\n  const urlTemplate = resolveUrlTemplate(jb1TrackConfig.urlTemplate)\n\n  if (storeClass) {\n    if (storeClass === 'JBrowse/Store/SeqFeature/BAM') {\n      const adapter: Jb2Adapter = {\n        type: 'BamAdapter',\n        bamLocation: { uri: urlTemplate },\n      }\n      if (jb1TrackConfig.baiUrlTemplate)\n        adapter.index = {\n          location: { uri: resolveUrlTemplate(jb1TrackConfig.baiUrlTemplate) },\n        }\n      else if (jb1TrackConfig.csiUrlTemplate)\n        adapter.index = {\n          location: { uri: resolveUrlTemplate(jb1TrackConfig.csiUrlTemplate) },\n          indexType: 'CSI',\n        }\n      else adapter.index = { location: { uri: `${urlTemplate}.bai` } }\n      return {\n        ...jb2TrackConfig,\n        type: 'AlignmentsTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/CRAM') {\n      const adapter: Jb2Adapter = {\n        type: 'CramAdapter',\n        cramLocation: { uri: urlTemplate },\n        sequenceAdapter,\n      }\n      if (jb1TrackConfig.craiUrlTemplate)\n        adapter.craiLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.craiUrlTemplate),\n        }\n      else adapter.craiLocation = { uri: `${urlTemplate}.crai` }\n      return {\n        ...jb2TrackConfig,\n        type: 'AlignmentsTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/NCList') {\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter: {\n          type: 'NCListAdapter',\n          rootUrlTemplate: { uri: urlTemplate },\n        },\n      }\n    }\n    if (\n      storeClass === 'JBrowse/Store/SeqFeature/BigWig' ||\n      storeClass === 'JBrowse/Store/BigWig'\n    ) {\n      if (jb1TrackConfig.type && jb1TrackConfig.type.endsWith('XYPlot')) {\n        jb2TrackConfig.defaultRendering = 'xyplot'\n      } else if (\n        jb1TrackConfig.type &&\n        jb1TrackConfig.type.endsWith('Density')\n      ) {\n        jb2TrackConfig.defaultRendering = 'density'\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'QuantitativeTrack',\n        adapter: {\n          type: 'BigWigAdapter',\n          bigWigLocation: { uri: urlTemplate },\n        },\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/VCFTabix') {\n      const adapter: Jb2Adapter = {\n        type: 'VcfTabixAdapter',\n        vcfGzLocation: { uri: urlTemplate },\n      }\n      if (jb1TrackConfig.tbiUrlTemplate)\n        adapter.index = {\n          location: { uri: resolveUrlTemplate(jb1TrackConfig.tbiUrlTemplate) },\n        }\n      else if (jb1TrackConfig.csiUrlTemplate)\n        adapter.index = {\n          location: { uri: resolveUrlTemplate(jb1TrackConfig.csiUrlTemplate) },\n          indexType: 'CSI',\n        }\n      else adapter.index = { location: { uri: `${urlTemplate}.tbi` } }\n      return {\n        ...jb2TrackConfig,\n        type: 'VariantTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/VCFTribble') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `VCFTribble (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/GFF3') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `GFF3 (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BigBed') {\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: { uri: urlTemplate },\n        },\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/GFF3Tabix') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `GFF3Tabix (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BED') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `BED (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BEDTabix') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `BEDTabix (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/GTF') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `GTF (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (\n      storeClass === 'JBrowse/Store/SeqFeature/StaticChunked' ||\n      storeClass === 'JBrowse/Store/Sequence/StaticChunked'\n    ) {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `StaticChunked (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/UnindexedFasta') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `UnindexedFasta (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/IndexedFasta') {\n      const adapter: Jb2Adapter = {\n        type: 'IndexedFastaAdapter',\n        fastaLocation: { uri: urlTemplate },\n      }\n      if (jb1TrackConfig.faiUrlTemplate)\n        adapter.faiLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.faiUrlTemplate),\n        }\n      else adapter.faiLocation = { uri: `${urlTemplate}.fai` }\n      return {\n        ...jb2TrackConfig,\n        type: 'SequenceTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BgzipIndexedFasta') {\n      const adapter: Jb2Adapter = {\n        type: 'BgzipFastaAdapter',\n        fastaLocation: { uri: urlTemplate },\n      }\n      if (jb1TrackConfig.faiUrlTemplate)\n        adapter.faiLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.faiUrlTemplate),\n        }\n      else adapter.faiLocation = { uri: `${urlTemplate}.fai` }\n      if (jb1TrackConfig.gziUrlTemplate)\n        adapter.gziLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.gziUrlTemplate),\n        }\n      else adapter.gziLocation = { uri: `${urlTemplate}.gzi` }\n      return {\n        ...jb2TrackConfig,\n        type: 'ReferenceSequenceTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/TwoBit') {\n      return {\n        ...jb2TrackConfig,\n        type: 'ReferenceSequenceTrack',\n        adapter: {\n          type: 'TwoBitAdapter',\n          twoBitLocation: { uri: urlTemplate },\n        },\n      }\n    }\n  }\n\n  // If we don't recogize the store class, make a best effort to guess by file type\n  jb2TrackConfig.adapter = guessAdapter(urlTemplate, 'uri')\n  if (!jb2TrackConfig.adapter) {\n    throw new Error('Could not determine adapter')\n  }\n\n  if (jb2TrackConfig.adapter.type === UNSUPPORTED) {\n    return generateUnsupportedTrackConf(\n      jb2TrackConfig.name,\n      urlTemplate,\n      jb2TrackConfig.category,\n    )\n  }\n  if (jb2TrackConfig.adapter.type === UNKNOWN) {\n    return generateUnknownTrackConf(\n      jb2TrackConfig.name,\n      urlTemplate,\n      jb2TrackConfig.category,\n    )\n  }\n\n  jb2TrackConfig.type = guessTrackType(jb2TrackConfig.adapter.type)\n\n  if (jb2TrackConfig.type === 'QuantitativeTrack') {\n    if (jb1TrackConfig.type && jb1TrackConfig.type.endsWith('XYPlot')) {\n      jb2TrackConfig.defaultRendering = 'xyplot'\n    } else if (jb1TrackConfig.type && jb1TrackConfig.type.endsWith('Density')) {\n      jb2TrackConfig.defaultRendering = 'density'\n    }\n  }\n\n  return jb2TrackConfig\n}\n\nfunction generateFromConfigTrackConfig(\n  jb1TrackConfig: Track,\n  jb2TrackConfig: Jb2Track,\n): Jb2Track {\n  const jb1Features = jb1TrackConfig.features || []\n  const jb2Features = jb1Features.map(\n    (feature): Jb2Feature => {\n      const jb2Feature: Jb2Feature = JSON.parse(JSON.stringify(feature))\n      jb2Feature.refName = feature.seq_id\n      jb2Feature.uniqueId = `${feature.seq_id}:${feature.start}-${\n        feature.end\n      }:${feature.name || ''}`\n      return jb2Feature\n    },\n  )\n  jb2TrackConfig.adapter = {\n    type: 'FromConfigAdapter',\n    features: jb2Features,\n  }\n  jb2TrackConfig.type = 'FeatureTrack'\n  return jb2TrackConfig\n}\n\nexport async function createRefSeqsAdapter(\n  refSeqs: string | RefSeqs,\n): Promise<Jb2Adapter> {\n  if (typeof refSeqs === 'string') {\n    // assume refSeqs is a url if it is string\n    refSeqs = {\n      url: refSeqs,\n    }\n  }\n\n  // check refseq urls\n  if (refSeqs.url) {\n    if (refSeqs.url.match(/.fai$/)) {\n      return {\n        type: 'IndexedFastaAdapter',\n        fastaLocation: {\n          uri: refSeqs.url.slice(0, -4),\n        },\n        faiLocation: {\n          uri: refSeqs.url,\n        },\n      }\n    }\n    if (refSeqs.url.match(/.2bit$/)) {\n      return {\n        type: 'TwoBitAdapter',\n        twoBitLocation: { uri: refSeqs.url },\n      }\n    }\n    if (refSeqs.url.match(/.fa$/)) {\n      throw new Error('Unindexed FASTA adapter not available')\n    }\n    if (refSeqs.url.match(/.sizes/)) {\n      throw new Error('chromosome SIZES adapter not available')\n    }\n    const refSeqsJson = await openLocation({ uri: refSeqs.url }).readFile(\n      'utf8',\n    )\n    const refSeqsData: RefSeq[] = JSON.parse(refSeqsJson as string)\n    return refSeqAdapterFromConfig(refSeqsData)\n  }\n  if ('data' in refSeqs) {\n    return refSeqAdapterFromConfig(refSeqs.data || [])\n  }\n  throw new Error(\n    `Could not determine adapter for JBrowse1 refSeqs: ${\n      refSeqs.url || JSON.stringify(refSeqs)\n    }`,\n  )\n}\n\nfunction refSeqAdapterFromConfig(refSeqsData: RefSeq[]): Jb2Adapter {\n  const features = refSeqsData.map(\n    (refSeq): Jb2Feature => ({\n      refName: refSeq.name,\n      uniqueId: refSeq.name,\n      start: refSeq.start,\n      end: refSeq.end,\n    }),\n  )\n  return {\n    type: 'FromConfigAdapter',\n    features,\n  }\n}\n","import {\n  ConfigurationReference,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport { types } from 'mobx-state-tree'\nimport configSchema from './configSchema'\n\nimport { fetchJb1 } from './jb1ConfigLoad'\nimport { convertTrackConfig } from './jb1ToJb2'\n\nexport default function (pluginManager) {\n  return types.compose(\n    'JBrowse1Connection',\n    BaseConnectionModelFactory(pluginManager),\n    types\n      .model({\n        configuration: ConfigurationReference(configSchema),\n        type: types.literal('JBrowse1Connection'),\n      })\n      .actions(self => ({\n        connect() {\n          const dataDirLocation = readConfObject(\n            self.configuration,\n            'dataDirLocation',\n          )\n          const session = getSession(self)\n          fetchJb1(dataDirLocation)\n            .then(config => {\n              const assemblyName = readConfObject(\n                self.configuration,\n                'assemblyName',\n              )\n              const assemblyConf = session.assemblies.find(\n                assembly => readConfObject(assembly, 'name') === assemblyName,\n              )\n              const sequenceAdapter = readConfObject(assemblyConf, [\n                'sequence',\n                'adapter',\n              ])\n              const jb2Tracks = config.tracks.map(jb1Track => {\n                const jb2Track = convertTrackConfig(\n                  jb1Track,\n                  config.dataRoot,\n                  sequenceAdapter,\n                )\n                jb2Track.assemblyNames = [assemblyName]\n                return jb2Track\n              })\n              self.setTrackConfs(jb2Tracks)\n            })\n            .catch(error => {\n              console.error(error)\n              session.notify(\n                `There was a problem connecting to the JBrowse 1 data directory \"${self.name}. Please make sure you have entered a valid location. The error that was thrown is: \"${error}\"`,\n                'error',\n              )\n              session.breakConnection(self.configuration)\n            })\n        },\n      })),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport ConnectionType from '@jbrowse/core/pluggableElementTypes/ConnectionType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AdapterClass as NCListAdapterClass,\n  configSchema as ncListAdapterConfigSchema,\n} from './NCListAdapter'\nimport {\n  configSchema as jbrowse1ConfigSchema,\n  modelFactory as jbrowse1ModelFactory,\n} from './JBrowse1Connection'\n\nexport default class LegacyJBrowsePlugin extends Plugin {\n  name = 'LegacyJBrowsePlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'NCListAdapter',\n          configSchema: ncListAdapterConfigSchema,\n          AdapterClass: NCListAdapterClass,\n        }),\n    )\n\n    pluginManager.addConnectionType(\n      () =>\n        new ConnectionType({\n          name: 'JBrowse1Connection',\n          configSchema: jbrowse1ConfigSchema,\n          stateModel: jbrowse1ModelFactory(pluginManager),\n          displayName: 'JBrowse 1 Data',\n          description: 'A JBrowse 1 data directory',\n          url: '//jbrowse.org/',\n        }),\n    )\n  }\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\n\nexport default observer(function ServerSideRenderedContent(props) {\n  const { model } = props\n  const { data, renderProps, renderingComponent: RenderingComponent } = model\n\n  return model.filled ? (\n    <RenderingComponent {...data} {...renderProps} />\n  ) : (\n    <p>Loading</p>\n  )\n})\n","import { makeStyles } from '@material-ui/core/styles'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport { observer } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React, { useEffect, useState } from 'react'\nimport ServerSideRenderedContent from './ServerSideRenderedContent'\n\nconst useStyles = makeStyles({\n  loading: {\n    paddingLeft: '0.6em',\n    backgroundColor: '#f1f1f1',\n    backgroundImage:\n      'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n    height: '100%',\n    width: '100%',\n    textAlign: 'center',\n  },\n  error: {\n    display: 'block',\n    color: 'red',\n    width: '30em',\n    wordWrap: 'normal',\n    whiteSpace: 'normal',\n  },\n  blockMessage: {\n    background: '#f1f1f1',\n    padding: '10px',\n  },\n  blockError: {\n    background: '#f1f1f1',\n    padding: '10px',\n    color: 'red',\n  },\n})\n\nfunction LoadingMessage() {\n  // only show the loading message after 300ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  const classes = useStyles()\n  useEffect(() => {\n    const timeout = setTimeout(() => setShown(true), 300)\n    return () => clearTimeout(timeout)\n  })\n\n  return shown ? (\n    <div data-testid=\"loading-synteny\" className={classes.loading}>\n      Loading &hellip;\n      <LinearProgress />\n    </div>\n  ) : null\n}\n\nfunction BlockMessage({ messageText }: { messageText: string }) {\n  const classes = useStyles()\n  return <div className={classes.blockMessage}>{messageText}</div>\n}\nBlockMessage.propTypes = {\n  messageText: PropTypes.string.isRequired,\n}\n\nfunction BlockError({ error }: { error: Error }) {\n  const classes = useStyles()\n  return <div className={classes.blockError}>{error.message}</div>\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst ServerSideRenderedBlockContent = observer(({ model }: { model: any }) => {\n  if (model.error) {\n    return <BlockError error={model.error} />\n  }\n  if (model.message) {\n    return <BlockMessage messageText={model.message} />\n  }\n  if (!model.filled) {\n    return <LoadingMessage />\n  }\n\n  return <ServerSideRenderedContent model={model} />\n})\n\nexport default ServerSideRenderedBlockContent\n","import { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport { LinearComparativeDisplay as LCD } from '..'\n\nconst LinearComparativeDisplay: React.FC<{\n  model: LCD\n  children?: React.ReactNode\n}> = props => {\n  const { model, children } = props\n  return (\n    <div>\n      <model.ReactComponent2 {...props} />\n      {children}\n    </div>\n  )\n}\nLinearComparativeDisplay.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n  children: PropTypes.element,\n}\n\nLinearComparativeDisplay.defaultProps = {\n  children: null,\n}\nexport default observer(LinearComparativeDisplay)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  getConf,\n  readConfObject,\n  ConfigurationReference,\n  ConfigurationSchema,\n} from '@jbrowse/core/configuration'\nimport { types, getSnapshot, Instance } from 'mobx-state-tree'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport {\n  getContainingView,\n  getSession,\n  makeAbortableReaction,\n} from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport { LinearComparativeViewModel } from '../LinearComparativeView/model'\nimport ServerSideRenderedBlockContent from '../ServerSideRenderedBlockContent'\n\nexport { default as ReactComponent } from './components/LinearComparativeDisplay'\n\nexport function configSchemaFactory(pluginManager: any) {\n  return ConfigurationSchema(\n    'LinearComparativeDisplay',\n    { renderer: pluginManager.pluggableConfigSchemaType('renderer') },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n\nexport function stateModelFactory(configSchema: any) {\n  return types\n    .compose(\n      'LinearComparativeDisplay',\n      BaseDisplay,\n      types.model({\n        type: types.literal('LinearComparativeDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        height: 100,\n      }),\n    )\n    .volatile((/* self */) => ({\n      renderInProgress: undefined as AbortController | undefined,\n      filled: false,\n      data: undefined as any,\n      html: '',\n      message: undefined as string | undefined,\n      renderingComponent: undefined as any,\n      ReactComponent2: (ServerSideRenderedBlockContent as unknown) as React.FC,\n    }))\n    .views(self => ({\n      get rendererTypeName() {\n        return getConf(self, 'renderer').type\n      },\n      get renderProps() {\n        return {\n          displayModel: self,\n        }\n      },\n    }))\n    .actions(self => {\n      let renderInProgress: undefined | AbortController\n\n      return {\n        afterAttach() {\n          makeAbortableReaction(\n            self as any,\n            renderBlockData as any,\n            renderBlockEffect as any,\n            {\n              name: `${self.type} ${self.id} rendering`,\n              delay: 1000,\n              fireImmediately: true,\n            },\n            this.setLoading,\n            this.setRendered,\n            this.setError,\n          )\n        },\n\n        setLoading(abortController: AbortController) {\n          self.filled = false\n          self.message = undefined\n          self.html = ''\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = abortController\n        },\n        setMessage(messageText: string) {\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          self.filled = false\n          self.message = messageText\n          self.html = ''\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n        setRendered(args: {\n          data: any\n          html: any\n          renderingComponent: React.Component\n        }) {\n          const { data, html, renderingComponent } = args\n          self.filled = true\n          self.message = undefined\n          self.html = html\n          self.data = data\n          self.error = undefined\n          self.renderingComponent = renderingComponent\n          renderInProgress = undefined\n        },\n        setError(error: Error) {\n          console.error(error)\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          // the rendering failed for some reason\n          self.filled = false\n          self.message = undefined\n          self.html = ''\n          self.data = undefined\n          self.error = error\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n      }\n    })\n}\nfunction renderBlockData(self: LinearComparativeDisplay) {\n  const { rpcManager } = getSession(self) as any\n  const display = self\n\n  const {\n    renderProps,\n    rendererType,\n  }: { renderProps: any; rendererType: any } = display\n\n  // Alternative to readConfObject(config) is below\n  // used because renderProps is something under our control.\n  // Compare to serverSideRenderedBlock\n  readConfObject(self.configuration)\n\n  const { adapterConfig } = self\n  const parent = getContainingView(self) as LinearComparativeViewModel\n  const sessionId = getRpcSessionId(self)\n  getSnapshot(parent)\n\n  return {\n    rendererType,\n    rpcManager,\n    renderProps,\n    renderArgs: {\n      adapterConfig,\n      rendererType: rendererType.name,\n      renderProps: {\n        ...renderProps,\n        view: getSnapshot(parent),\n      },\n      sessionId,\n      timeout: 1000000,\n    },\n  }\n}\n\nasync function renderBlockEffect(props: ReturnType<typeof renderBlockData>) {\n  if (!props) {\n    throw new Error('cannot render with no props')\n  }\n\n  const { rendererType, rpcManager, renderArgs } = props\n\n  const { html, ...data } = await rendererType.renderInClient(\n    rpcManager,\n    renderArgs,\n  )\n\n  return { html, data, renderingComponent: rendererType.ReactComponent }\n}\n\nexport type LinearComparativeDisplayModel = ReturnType<typeof stateModelFactory>\nexport type LinearComparativeDisplay = Instance<LinearComparativeDisplayModel>\n","import React from 'react'\nimport LeakAddIcon from '@material-ui/icons/LeakAdd'\nimport LeakRemoveIcon from '@material-ui/icons/LeakRemove'\nimport LinkIcon from '@material-ui/icons/Link'\nimport LinkOffIcon from '@material-ui/icons/LinkOff'\nimport LocationSearchingIcon from '@material-ui/icons/LocationSearching'\nimport LocationDisabledIcon from '@material-ui/icons/LocationDisabled'\nimport IconButton from '@material-ui/core/IconButton'\nimport { withSize } from 'react-sizeme'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport { LinearComparativeViewModel } from '../model'\n\nconst useStyles = makeStyles(theme => ({\n  headerBar: {\n    gridArea: '1/1/auto/span 2',\n    display: 'flex',\n  },\n  spacer: {\n    flexGrow: 1,\n  },\n  emphasis: {\n    background: theme.palette.secondary.main,\n    padding: theme.spacing(1),\n  },\n  hovered: {\n    background: theme.palette.secondary.light,\n  },\n  displayName: {\n    background: theme.palette.secondary.main,\n    paddingTop: 3,\n    paddingLeft: theme.spacing(1),\n    paddingRight: theme.spacing(1),\n  },\n  inputBase: {\n    color: theme.palette.secondary.contrastText,\n  },\n  inputRoot: {\n    '&:hover': {\n      backgroundColor: theme.palette.secondary.light,\n    },\n  },\n  inputFocused: {\n    borderColor: theme.palette.primary.main,\n    backgroundColor: theme.palette.secondary.light,\n  },\n}))\n\nconst InteractWithSquiggles = observer(\n  ({ model }: { model: LinearComparativeViewModel }) => {\n    return (\n      <IconButton\n        onClick={model.toggleInteract}\n        title=\"Toggle interacting with the overlay\"\n      >\n        {model.interactToggled ? (\n          <LocationSearchingIcon />\n        ) : (\n          <LocationDisabledIcon />\n        )}\n      </IconButton>\n    )\n  },\n)\n\nconst LinkViews = observer(\n  ({ model }: { model: LinearComparativeViewModel }) => {\n    return (\n      <IconButton\n        onClick={model.toggleLinkViews}\n        title=\"Toggle linked scrolls and behavior across views\"\n      >\n        {model.linkViews ? (\n          <LinkIcon color=\"secondary\" />\n        ) : (\n          <LinkOffIcon color=\"secondary\" />\n        )}\n      </IconButton>\n    )\n  },\n)\n\nconst Sync = observer(({ model }: { model: LinearComparativeViewModel }) => {\n  return (\n    <IconButton\n      onClick={model.toggleIntraviewLinks}\n      title=\"Toggle rendering intraview links\"\n    >\n      {model.showIntraviewLinks ? (\n        <LeakAddIcon color=\"secondary\" />\n      ) : (\n        <LeakRemoveIcon color=\"secondary\" />\n      )}\n    </IconButton>\n  )\n})\n\nconst Header = observer(\n  ({\n    model,\n    size,\n  }: {\n    model: LinearComparativeViewModel\n    size: { height: number }\n  }) => {\n    const classes = useStyles()\n\n    model.setHeaderHeight(size.height)\n    return (\n      <div className={classes.headerBar}>\n        <LinkViews model={model} />\n        <InteractWithSquiggles model={model} />\n        <Sync model={model} />\n\n        <div className={classes.spacer} />\n      </div>\n    )\n  },\n)\n\nexport default withSize({ monitorHeight: true })(Header)\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { getSession } from '@jbrowse/core/util'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { LinearComparativeViewModel } from '../model'\nimport Header from './Header'\n\nconst useStyles = makeStyles(theme => {\n  return {\n    root: {\n      position: 'relative',\n      marginBottom: theme.spacing(1),\n      overflow: 'hidden',\n    },\n    breakpointMarker: {\n      position: 'absolute',\n      top: 0,\n      height: '100%',\n      width: '3px',\n      background: 'magenta',\n    },\n    viewContainer: {\n      marginTop: '3px',\n    },\n    container: {\n      display: 'grid',\n    },\n    overlay: {\n      zIndex: 100,\n      gridArea: '1/1',\n    },\n    content: {\n      gridArea: '1/1',\n    },\n  }\n})\n\ninterface Props {\n  model: LinearComparativeViewModel\n}\nconst Overlays = observer(({ model }: Props) => {\n  const classes = useStyles()\n  return (\n    <>\n      {model.tracks.map(track => {\n        const [display] = track.displays\n        const { RenderingComponent } = display\n        return RenderingComponent ? (\n          <div\n            className={classes.overlay}\n            key={getConf(track, 'trackId')}\n            style={{ height: display.height }}\n          >\n            <RenderingComponent model={display} />\n          </div>\n        ) : null\n      })}\n    </>\n  )\n})\n\n// The comparative is in the middle of the views\nconst MiddleComparativeView = observer(({ model }: Props) => {\n  const classes = useStyles()\n  const { views } = model\n  const { pluginManager } = getSession(model)\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const viewType = pluginManager.getViewType(views[0].type) as any\n  const { ReactComponent } = viewType\n\n  return (\n    <div>\n      <Header model={model} />\n      <div className={classes.container}>\n        <ReactComponent model={views[0]} />\n        <div style={{ display: 'grid' }}>\n          <Overlays model={model} />\n        </div>\n        <ReactComponent model={views[1]} />\n      </div>\n    </div>\n  )\n})\nconst OverlayComparativeView = observer(({ model }: Props) => {\n  const classes = useStyles()\n  const { views } = model\n  const { pluginManager } = getSession(model)\n  return (\n    <div>\n      <Header model={model} />\n      <div className={classes.container}>\n        <div className={classes.content}>\n          <div style={{ position: 'relative' }}>\n            {views.map(view => {\n              // eslint-disable-next-line @typescript-eslint/no-explicit-any\n              const viewType = pluginManager.getViewType(view.type) as any\n              const { ReactComponent } = viewType\n              return <ReactComponent key={view.id} model={view} />\n            })}\n          </div>\n          <Overlays model={model} />\n        </div>\n      </div>\n    </div>\n  )\n})\n\nconst LinearComparativeView = observer(({ model }: Props) => {\n  const middle = model.tracks.some(t =>\n    t.displays.some((d: AnyConfigurationModel) => getConf(d, 'middle')),\n  )\n  return middle ? (\n    <MiddleComparativeView model={model} />\n  ) : (\n    <OverlayComparativeView model={model} />\n  )\n})\n\nexport default LinearComparativeView\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport BaseViewModel from '@jbrowse/core/pluggableElementTypes/models/BaseViewModel'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { getSession, isSessionModelWithWidgets } from '@jbrowse/core/util'\nimport {\n  LinearGenomeViewModel,\n  LinearGenomeViewStateModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { transaction } from 'mobx'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport {\n  types,\n  getParent,\n  onAction,\n  addDisposer,\n  Instance,\n  resolveIdentifier,\n  getPath,\n  SnapshotIn,\n  cast,\n  ISerializedActionCall,\n  getRoot,\n} from 'mobx-state-tree'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  const { jbrequire } = pluginManager\n  const { ElementId } = jbrequire('@jbrowse/core/util/types/mst')\n\n  const defaultHeight = 400\n  return types\n    .compose(\n      'LinearComparativeView',\n      BaseViewModel,\n      types.model({\n        id: ElementId,\n        type: types.literal('LinearComparativeView'),\n        height: defaultHeight,\n        displayName: 'synteny detail',\n        trackSelectorType: 'hierarchical',\n        showIntraviewLinks: true,\n        linkViews: false,\n        interactToggled: false,\n        tracks: types.array(\n          pluginManager.pluggableMstType('track', 'stateModel'),\n        ),\n        views: types.array(\n          pluginManager.getViewType('LinearGenomeView')\n            .stateModel as LinearGenomeViewStateModel,\n        ),\n\n        // this represents tracks specific to this view\n        // specifically used for read vs ref dotplots where\n        // this track would not really apply elsewhere\n        viewTrackConfigs: types.array(\n          pluginManager.pluggableConfigSchemaType('track'),\n        ),\n\n        // this represents assemblies in the specialized\n        // read vs ref dotplot view\n        viewAssemblyConfigs: types.array(types.frozen()),\n      }),\n    )\n    .volatile(() => ({\n      headerHeight: 0,\n      width: 800,\n    }))\n    .views(self => ({\n      get initialized() {\n        return self.views.length > 0\n      },\n\n      get refNames() {\n        return (self.views || []).map(v => [\n          ...new Set(v.staticBlocks.map(m => m.refName)),\n        ])\n      },\n\n      get assemblyNames() {\n        return [...new Set(self.views.map(v => v.assemblyNames).flat())]\n      },\n\n      // // Get a composite map of featureId->feature map for a track\n      // // across multiple views\n      // getTrackFeatures(trackIds: string[]) {\n      //   // @ts-ignore\n      //   const tracks = trackIds.map(t => resolveIdentifier(getSession(self), t))\n      //   return new CompositeMap<string, Feature>(tracks.map(t => t.features))\n      // },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          onAction(self, (param: ISerializedActionCall) => {\n            if (self.linkViews) {\n              const { name, path, args } = param\n              const actions = [\n                'horizontalScroll',\n                'zoomTo',\n                'setScaleFactor',\n                'showTrack',\n                'hideTrack',\n                'toggleTrack',\n              ]\n              if (actions.includes(name) && path) {\n                this.onSubviewAction(name, path, args)\n              }\n            }\n          }),\n        )\n      },\n\n      onSubviewAction(actionName: string, path: string, args: any[] = []) {\n        self.views.forEach(view => {\n          const ret = getPath(view)\n          if (ret.lastIndexOf(path) !== ret.length - path.length) {\n            // @ts-ignore\n            view[actionName](args[0])\n          }\n        })\n      },\n\n      setWidth(newWidth: number) {\n        self.width = newWidth\n        self.views.forEach(v => v.setWidth(newWidth))\n      },\n      setHeight(newHeight: number) {\n        self.height = newHeight\n      },\n\n      setViews(views: SnapshotIn<LinearGenomeViewModel>[]) {\n        self.views = cast(views)\n      },\n\n      removeView(view: LinearGenomeViewModel) {\n        self.views.remove(view)\n      },\n\n      closeView() {\n        getParent(self, 2).removeView(self)\n      },\n\n      setHeaderHeight(height: number) {\n        self.headerHeight = height\n      },\n\n      toggleInteract() {\n        self.interactToggled = !self.interactToggled\n      },\n      toggleIntraviewLinks() {\n        self.showIntraviewLinks = !self.showIntraviewLinks\n      },\n      toggleLinkViews() {\n        self.linkViews = !self.linkViews\n      },\n\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n          return undefined\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      toggleTrack(trackId: string) {\n        // if we have any tracks with that configuration, turn them off\n        const hiddenCount = this.hideTrack(trackId)\n        // if none had that configuration, turn one on\n        if (!hiddenCount) {\n          this.showTrack(trackId)\n        }\n      },\n\n      showTrack(trackId: string, initialSnapshot = {}) {\n        const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'track',\n        )\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        const trackType = pluginManager.getTrackType(configuration.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${configuration.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const supportedDisplays = viewType.displayTypes.map(\n          displayType => displayType.name,\n        )\n        const displayConf = configuration.displays.find(\n          (d: AnyConfigurationModel) => supportedDisplays.includes(d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `could not find a compatible display for view type ${self.type}`,\n          )\n        }\n        const track = trackType.stateModel.create({\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n          displays: [{ type: displayConf.type, configuration: displayConf }],\n        })\n        self.tracks.push(track)\n      },\n\n      hideTrack(trackId: string) {\n        const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'track',\n        )\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        // if we have any tracks with that configuration, turn them off\n        const shownTracks = self.tracks.filter(\n          t => t.configuration === configuration,\n        )\n        transaction(() => shownTracks.forEach(t => self.tracks.remove(t)))\n        return shownTracks.length\n      },\n    }))\n    .views(self => ({\n      get menuItems(): MenuItem[] {\n        const menuItems: MenuItem[] = []\n        self.views.forEach((view, idx) => {\n          if (view.menuItems) {\n            menuItems.push({\n              label: `View ${idx + 1} Menu`,\n              subMenu: view.menuItems,\n            })\n          }\n        })\n        menuItems.push({\n          label: 'Open track selector',\n          onClick: self.activateTrackSelector,\n          icon: TrackSelectorIcon,\n        })\n        return menuItems\n      },\n    }))\n}\n\nexport type LinearComparativeViewStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearComparativeViewModel = Instance<\n  LinearComparativeViewStateModel\n>\n","import ReactComponent from './components/LinearComparativeView'\nimport modelFactory from './model'\n\nexport default ({ jbrequire }: { jbrequire: Function }) => {\n  const ViewType = jbrequire('@jbrowse/core/pluggableElementTypes/ViewType')\n  return new ViewType({\n    name: 'LinearComparativeView',\n    stateModel: jbrequire(modelFactory),\n    ReactComponent,\n  })\n}\n","import { types, Instance } from 'mobx-state-tree'\nimport {\n  getConf,\n  ConfigurationReference,\n  ConfigurationSchema,\n} from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getContainingView } from '@jbrowse/core/util'\nimport {\n  configSchemaFactory as baseConfigFactory,\n  stateModelFactory as baseModelFactory,\n} from '../LinearComparativeDisplay'\nimport { LinearSyntenyViewModel } from '../LinearSyntenyView/model'\n\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearSyntenyDisplay',\n    {\n      trackIds: {\n        type: 'stringArray',\n        defaultValue: [],\n      },\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'LinearSyntenyRenderer' },\n      ),\n      middle: { type: 'boolean', defaultValue: true },\n    },\n    {\n      baseConfiguration: baseConfigFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport function stateModelFactory(\n  configSchema: ReturnType<typeof configSchemaFactory>,\n) {\n  return types\n    .compose(\n      'LinearSyntenyDisplay',\n      baseModelFactory(configSchema),\n      types.model({\n        type: types.literal('LinearSyntenyDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => ({\n      get highResolutionScaling() {\n        return 1\n      },\n      get renderProps() {\n        const parentView = getContainingView(self) as LinearSyntenyViewModel\n        return {\n          displayModel: self,\n          config: getConf(self, 'renderer'),\n          width: parentView.width,\n          height: 100,\n        }\n      },\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n      get adapterConfig() {\n        // TODO possibly enriches with the adapters from associated trackIds\n        return {\n          name: self.parentTrack.configuration.adapter.type,\n          assemblyNames: getConf(self, 'assemblyNames'),\n          ...getConf(self.parentTrack, 'adapter'),\n        }\n      },\n\n      get trackIds() {\n        return getConf(self, 'trackIds') as string[]\n      },\n    }))\n}\n\nexport type LinearSyntenyDisplayStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearSyntenyDisplayModel = Instance<LinearSyntenyDisplayStateModel>\n","import { clamp } from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\n\nexport type LayoutRecord = [number, number, number, number]\n\nexport interface ReducedLinearGenomeView {\n  bpPerPx: number\n  offsetPx: number\n  staticBlocks: Region[]\n  dynamicBlocks: Region[]\n  displayedRegions: Region[]\n  headerHeight: number\n  scaleBarHeight: number\n  height: number\n  features: Feature[]\n  tracks: {\n    scrollTop: number\n    height: number\n    configuration: string\n    layoutFeatures: [string, LayoutRecord][]\n    skip: number\n  }[]\n}\n\nconst [, TOP, , BOTTOM] = [0, 1, 2, 3]\n\nexport function cheight(chunk: LayoutRecord) {\n  return chunk[BOTTOM] - chunk[TOP]\n}\nfunction heightFromSpecificLevel(\n  views: ReducedLinearGenomeView[],\n  trackConfigId: string,\n  level: number,\n) {\n  const heightUpUntilThisPoint = views\n    .slice(0, level)\n    .map(v => v.height + 7)\n    .reduce((a, b) => a + b, 0)\n\n  return (\n    heightUpUntilThisPoint +\n    views[level].headerHeight +\n    views[level].scaleBarHeight +\n    getTrackPos(views[level], trackConfigId) +\n    1\n  )\n}\n\nexport function getTrackPos(\n  view: ReducedLinearGenomeView,\n  trackConfigId: string,\n) {\n  const idx = view.tracks.findIndex(t => t.configuration === trackConfigId)\n  let accum = 0\n  for (let i = 0; i < idx; i += 1) {\n    accum += view.tracks[i].height + 3 // +1px for trackresizehandle\n  }\n  return accum\n}\n\n// Uses bpToPx to get the screen pixel coordinates but ignores some conditions\n// where bpToPx could return undefined\nexport function getPxFromCoordinate(\n  view: ReducedLinearGenomeView,\n  refName: string,\n  coord: number,\n) {\n  return (\n    ((bpToPx(view, { refName, coord }) || {}).offsetPx || 0) - view.offsetPx\n  )\n}\n\n// Retrieves the y-position of a layout record in a track\n// If track not found returns 0\nexport function overlayYPos(\n  trackConfigId: string,\n  level: number,\n  views: ReducedLinearGenomeView[],\n  c: LayoutRecord,\n  cond: boolean,\n) {\n  const track = views[level].tracks.find(t => t.configuration === trackConfigId)\n  const ypos = track\n    ? clamp(c[TOP] - (track.scrollTop || 0), 0, track.height) +\n      heightFromSpecificLevel(views, trackConfigId, level) +\n      track.skip\n    : 0\n\n  return ypos + (cond ? cheight(c) : 0)\n}\n\n// Returns the pixel screen position of a refName:coord input, or undefined if\n// the input could not be located. Uses view.displayedRegions as a representation\n// of what is on the screen\n//\n// Note: does not consider that this refName:coord input could multi-match\nfunction bpToPx(\n  view: ReducedLinearGenomeView,\n  { refName, coord }: { refName: string; coord: number },\n) {\n  let offsetBp = 0\n\n  const index = view.displayedRegions.findIndex(r => {\n    if (refName === r.refName && coord >= r.start && coord <= r.end) {\n      offsetBp += coord - r.start\n      return true\n    }\n    offsetBp += r.end - r.start\n    return false\n  })\n  const foundRegion = view.displayedRegions[index]\n  if (foundRegion) {\n    return {\n      index,\n      offsetPx: Math.round(offsetBp / view.bpPerPx),\n    }\n  }\n  return undefined\n}\n\n// Returns either 0 or height depending on condition\nexport function interstitialYPos(cond: boolean, height: number) {\n  return cond ? 5 : height - 5\n}\n\nexport function* generateMatches(\n  l1: Feature[] = [],\n  l2: Feature[] = [],\n  cb: (arg0: Feature) => number,\n) {\n  let i = 0\n  let j = 0\n  while (i < l1.length && j < l2.length) {\n    const a = cb(l1[i])\n    const b = cb(l2[j])\n    if (a < b) {\n      i++\n    } else if (b < a) {\n      j++\n    } else {\n      yield [l1[i], l2[j]]\n      i++\n      j++\n    }\n  }\n}\n","/* eslint-disable no-continue */\nimport React, { useRef, useMemo, useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport SimpleFeature, {\n  SimpleFeatureSerialized,\n  Feature,\n} from '@jbrowse/core/util/simpleFeature'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\nimport { interstitialYPos, overlayYPos, generateMatches } from '../../util'\nimport { LinearSyntenyViewModel } from '../../LinearSyntenyView/model'\nimport { LinearComparativeDisplay } from '../../LinearComparativeDisplay'\n\nconst [LEFT, , RIGHT] = [0, 1, 2, 3]\n\ntype RectTuple = [number, number, number, number]\n\nconst { parseCigar } = MismatchParser\n\nfunction px(\n  view: LinearGenomeViewModel,\n  arg: { refName: string; coord: number },\n) {\n  return (view.bpToPx(arg) || {}).offsetPx || 0\n}\n\nfunction layoutMatches(features: Feature[][]) {\n  const matches = []\n  for (let i = 0; i < features.length; i++) {\n    for (let j = i; j < features.length; j++) {\n      if (i !== j) {\n        for (const [f1, f2] of generateMatches(features[i], features[j], feat =>\n          feat.get('syntenyId'),\n        )) {\n          matches.push([\n            {\n              feature: f1,\n              level: i,\n              refName: f1.get('refName'),\n              layout: [f1.get('start'), 0, f1.get('end'), 10] as RectTuple,\n            },\n            {\n              feature: f2,\n              level: j,\n              refName: f2.get('refName'),\n              layout: [f2.get('start'), 0, f2.get('end'), 10] as RectTuple,\n            },\n          ])\n        }\n      }\n    }\n  }\n  return matches\n}\n\n/**\n * A block whose content is rendered outside of the main thread and hydrated by\n * this component.\n */\nfunction LinearSyntenyRendering(props: {\n  width: number\n  height: number\n  displayModel: LinearComparativeDisplay\n  highResolutionScaling: number\n  features: SimpleFeatureSerialized[][]\n  trackIds: string[]\n}) {\n  const ref = useRef<HTMLCanvasElement>(null)\n  const {\n    height,\n    width,\n    displayModel = {},\n    highResolutionScaling = 1,\n    features,\n    trackIds,\n  } = props\n\n  const deserializedFeatures = useMemo(\n    () =>\n      features.map(level => {\n        return level\n          .map(f => new SimpleFeature(f))\n          .sort((a, b) => a.get('syntenyId') - b.get('syntenyId'))\n      }),\n    [features],\n  )\n\n  const parentView = getContainingView(displayModel) as LinearSyntenyViewModel\n  const { views } = parentView\n  const matches = layoutMatches(deserializedFeatures)\n  const offsets = views.map(view => view.offsetPx)\n\n  useEffect(() => {\n    if (!ref.current) {\n      return\n    }\n    const ctx = ref.current.getContext('2d')\n    if (!ctx) {\n      return\n    }\n    ctx.clearRect(0, 0, width, height)\n    ctx.scale(highResolutionScaling, highResolutionScaling)\n    ctx.fillStyle = getConf(displayModel, ['renderer', 'color'])\n    ctx.strokeStyle = getConf(displayModel, ['renderer', 'color'])\n    const showIntraviewLinks = false\n    const middle = true\n    const hideTiny = false\n    matches.forEach(m => {\n      // we follow a path in the list of chunks, not from top to bottom, just\n      // in series following x1,y1 -> x2,y2\n      for (let i = 0; i < m.length - 1; i += 1) {\n        const { layout: c1, feature: f1, level: l1, refName: ref1 } = m[i]\n        const { layout: c2, feature: f2, level: l2, refName: ref2 } = m[i + 1]\n        const v1 = views[l1]\n        const v2 = views[l2]\n\n        if (!c1 || !c2) {\n          console.warn('received null layout for a overlay feature')\n          return\n        }\n\n        // disable rendering connections in a single level\n        if (!showIntraviewLinks && l1 === l2) {\n          continue\n        }\n        const length1 = f1.get('end') - f1.get('start')\n        const length2 = f2.get('end') - f2.get('start')\n\n        if ((length1 < v1.bpPerPx || length2 < v2.bpPerPx) && hideTiny) {\n          continue\n        }\n\n        const x11 = px(v1, { refName: ref1, coord: c1[LEFT] }) - offsets[l1]\n        const x12 = px(v1, { refName: ref1, coord: c1[RIGHT] }) - offsets[l1]\n        const x21 = px(v2, { refName: ref2, coord: c2[LEFT] }) - offsets[l2]\n        const x22 = px(v2, { refName: ref2, coord: c2[RIGHT] }) - offsets[l2]\n\n        const y1 = middle\n          ? interstitialYPos(l1 < l2, height)\n          : // prettier-ignore\n            // @ts-ignore\n            overlayYPos(trackIds[0], l1, views, c1, l1 < l2)\n        const y2 = middle\n          ? interstitialYPos(l2 < l1, height)\n          : // prettier-ignore\n            // @ts-ignore\n            overlayYPos(trackIds[1], l2, views, c2, l2 < l1)\n\n        // drawing a line if the results are thin results in much less\n        // pixellation than filling in a thin polygon\n        if (length1 < v1.bpPerPx || length2 < v2.bpPerPx) {\n          ctx.beginPath()\n          ctx.moveTo(x11, y1)\n          ctx.lineTo(x21, y2)\n          ctx.stroke()\n        } else {\n          let currX1 = x11\n          let currX2 = x21\n\n          // flip the direction of the CIGAR drawing in horizontally flipped\n          // modes\n          const rev1 = x11 < x12 ? 1 : -1\n          const rev2 = x21 < x22 ? 1 : -1\n\n          const cigar = f1.get('cg') || f1.get('CIGAR')\n          if (cigar) {\n            const cigarOps = parseCigar(cigar)\n            for (let j = 0; j < cigarOps.length; j += 2) {\n              const val = +cigarOps[j]\n              const op = cigarOps[j + 1]\n\n              const prevX1 = currX1\n              const prevX2 = currX2\n\n              if (op === 'M') {\n                ctx.fillStyle = '#f003'\n                currX1 += (val / views[0].bpPerPx) * rev1\n                currX2 += (val / views[1].bpPerPx) * rev2\n              } else if (op === 'D') {\n                ctx.fillStyle = '#00f3'\n                currX1 += (val / views[0].bpPerPx) * rev1\n              } else if (op === 'N') {\n                ctx.fillStyle = '#0a03'\n                currX1 += (val / views[0].bpPerPx) * rev1\n              } else if (op === 'I') {\n                ctx.fillStyle = '#ff03'\n                currX2 += (val / views[1].bpPerPx) * rev2\n              }\n              ctx.beginPath()\n              ctx.moveTo(prevX1, y1)\n              ctx.lineTo(currX1, y1)\n              ctx.lineTo(currX2, y2)\n              ctx.lineTo(prevX2, y2)\n              ctx.closePath()\n              ctx.fill()\n            }\n          } else {\n            ctx.beginPath()\n            ctx.moveTo(x11, y1)\n            ctx.lineTo(x12, y1)\n            ctx.lineTo(x22, y2)\n            ctx.lineTo(x21, y2)\n            ctx.closePath()\n            ctx.fill()\n          }\n        }\n      }\n    })\n  })\n\n  return (\n    <canvas\n      ref={ref}\n      data-testid=\"synteny_canvas\"\n      width={width}\n      height={height}\n    />\n  )\n}\n\nexport default observer(LinearSyntenyRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'LinearSyntenyRenderer',\n  {\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a synteny',\n      defaultValue: 'rgb(255,100,100,0.3)',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import ComparativeServerSideRendererType from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport Base1DView, { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\n\nexport default class LinearSyntenyRenderer extends ComparativeServerSideRendererType {\n  async render(renderProps: {\n    height: number\n    width: number\n    view: { views: Base1DViewModel[] }\n  }) {\n    const {\n      width,\n      view: { views },\n    } = renderProps\n    const realizedViews = views.map(snap => {\n      const view = Base1DView.create(snap)\n      view.setVolatileWidth(width)\n      return view\n    })\n    const features = await Promise.all(\n      realizedViews.map(view =>\n        this.getFeatures({\n          ...renderProps,\n          regions: view.staticBlocks.contentBlocks,\n        }),\n      ),\n    )\n\n    const serializedFeatures = JSON.parse(JSON.stringify(features))\n    for (let i = 0; i < serializedFeatures.length; i++) {\n      for (let j = 0; j < serializedFeatures[i].length; j++) {\n        // eslint-disable-next-line no-underscore-dangle\n        serializedFeatures[i][j]._level = i\n      }\n    }\n\n    return {\n      features: serializedFeatures,\n    }\n  }\n\n  // render method called on the worker\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  async renderInWorker(args: any) {\n    this.deserializeArgsInWorker(args)\n\n    const results = await this.render(args)\n\n    // serialize the results for passing back to the main thread.\n    // these will be transmitted to the main process, and will come out\n    // as the result of renderRegionWithWorker.\n    this.serializeResultsInWorker(/* results, args */)\n    return results\n  }\n}\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { getSnapshot } from 'mobx-state-tree'\nimport { getSession } from '@jbrowse/core/util'\nimport Button from '@material-ui/core/Button'\nimport Typography from '@material-ui/core/Typography'\nimport Container from '@material-ui/core/Container'\nimport Grid from '@material-ui/core/Grid'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport TextField from '@material-ui/core/TextField'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { FileSelector } from '@jbrowse/core/ui'\nimport { LinearSyntenyViewModel } from '../model'\n\n// the below importsused for multi-way synteny, not implemented yet\n// import AddIcon from '@material-ui/icons/Add'\n// import IconButton from '@material-ui/core/IconButton'\n//\n\nconst useStyles = makeStyles(theme => ({\n  importFormContainer: {\n    padding: theme.spacing(4),\n  },\n  importFormEntry: {\n    minWidth: 180,\n  },\n  errorMessage: {\n    textAlign: 'center',\n    paddingTop: theme.spacing(1),\n    paddingBottom: theme.spacing(1),\n  },\n}))\nconst FormRow = observer(\n  ({\n    model,\n    selected,\n    onChange,\n    error,\n  }: {\n    model: LinearSyntenyViewModel\n    selected: number\n    onChange: (arg0: number) => void\n    error?: string\n  }) => {\n    const classes = useStyles()\n    const { assemblyNames } = getSession(model) as { assemblyNames: string[] }\n    return (\n      <Grid container item justify=\"center\" spacing={2} alignItems=\"center\">\n        <TextField\n          select\n          variant=\"outlined\"\n          value={assemblyNames[selected] ? selected : ''}\n          onChange={event => {\n            onChange(Number(event.target.value))\n          }}\n          error={Boolean(error)}\n          disabled={Boolean(error)}\n          className={classes.importFormEntry}\n        >\n          {assemblyNames.map((name, idx) => (\n            <MenuItem key={name} value={idx}>\n              {name}\n            </MenuItem>\n          ))}\n        </TextField>\n      </Grid>\n    )\n  },\n)\nconst ImportForm = observer(({ model }: { model: LinearSyntenyViewModel }) => {\n  const classes = useStyles()\n  const [selected, setSelected] = useState([0, 0])\n  const [error, setError] = useState('')\n  const [numRows] = useState(2)\n  const [trackData, setTrackData] = useState<FileLocation>({ uri: '' })\n  const { assemblyNames } = getSession(model) as { assemblyNames: string[] }\n  if (!assemblyNames.length) {\n    setError('No configured assemblies')\n  }\n\n  async function onOpenClick() {\n    const { assemblyManager } = getSession(model)\n\n    model.setViews(\n      // @ts-ignore\n      await Promise.all(\n        selected\n          .map(async selection => {\n            const assembly = await assemblyManager.waitForAssembly(\n              assemblyNames[selection],\n            )\n            if (assembly) {\n              return {\n                type: 'LinearGenomeView',\n                bpPerPx: 1,\n                offsetPx: 0,\n                hideHeader: true,\n                // @ts-ignore\n                displayedRegions: getSnapshot(assembly.regions),\n              }\n            }\n            return null\n          })\n          .filter(f => !!f),\n      ),\n    )\n\n    model.views.forEach(view => view.setWidth(model.width))\n\n    if ('uri' in trackData) {\n      const fileName = trackData.uri\n        ? trackData.uri.slice(trackData.uri.lastIndexOf('/') + 1)\n        : null\n\n      // @ts-ignore\n      const configuration = getSession(model).addTrackConf({\n        trackId: `fileName-${Date.now()}`,\n        name: fileName,\n        assemblyNames: selected.map(selection => assemblyNames[selection]),\n        type: 'SyntenyTrack',\n        adapter: {\n          type: 'PAFAdapter',\n          pafLocation: trackData,\n          assemblyNames: selected.map(selection => assemblyNames[selection]),\n        },\n        renderer: {\n          type: 'LinearSyntenyRenderer',\n        },\n      })\n      model.toggleTrack(configuration.trackId)\n    }\n  }\n\n  return (\n    <Container className={classes.importFormContainer}>\n      <Grid container item justify=\"center\" spacing={4} alignItems=\"center\">\n        <Grid item>\n          <p style={{ textAlign: 'center' }}>\n            Select assemblies for synteny view\n          </p>\n          {[...new Array(numRows)].map((_, index) => (\n            <FormRow\n              key={`row_${index}_${selected[index]}`}\n              error={error}\n              selected={selected[index]}\n              onChange={val => {\n                const copy = selected.slice(0)\n                copy[index] = val\n                setSelected(copy)\n              }}\n              model={model}\n            />\n          ))}\n        </Grid>\n\n        <Grid item>\n          <Typography>Add a PAF file for the synteny view</Typography>\n          <FileSelector\n            name=\"URL\"\n            description=\"\"\n            location={trackData}\n            setLocation={loc => setTrackData(loc)}\n          />\n        </Grid>\n\n        <Grid item>\n          <Button onClick={onOpenClick} variant=\"contained\" color=\"primary\">\n            Open\n          </Button>\n        </Grid>\n      </Grid>\n    </Container>\n  )\n})\n\nexport default ImportForm\n\n/* ability to add another assembly commented out for now\n    Add another assembly...\n        <IconButton\n          onClick={() => setNumRows(rows => rows + 1)}\n          color=\"primary\"\n        >\n          <AddIcon />\n      </IconButton>\n            */\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport LinearComparativeViewComponent from '../../LinearComparativeView/components/LinearComparativeView'\nimport { LinearSyntenyViewModel } from '../model'\nimport ImportForm from './ImportForm'\n\nconst LinearSyntenyView = observer(\n  ({ model }: { model: LinearSyntenyViewModel }) => {\n    const { initialized } = model\n    if (!initialized) {\n      return <ImportForm model={model} />\n    }\n    return <LinearComparativeViewComponent model={model} />\n  },\n)\n\nexport default LinearSyntenyView\n","import { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport baseModel from '../LinearComparativeView/model'\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types.compose(\n    baseModel(pluginManager),\n    types.model('LinearSyntenyView', {\n      type: types.literal('LinearSyntenyView'),\n    }),\n  )\n}\nexport type LinearSyntenyViewStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearSyntenyViewModel = Instance<LinearSyntenyViewStateModel>\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport ReactComponent from './components/LinearSyntenyView'\nimport modelFactory from './model'\n\nexport default (pluginManager: PluginManager) => {\n  const { jbrequire } = pluginManager\n  const ViewType = jbrequire('@jbrowse/core/pluggableElementTypes/ViewType')\n  return new ViewType({\n    name: 'LinearSyntenyView',\n    stateModel: jbrequire(modelFactory),\n    ReactComponent,\n  })\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { Instance } from 'mobx-state-tree'\nimport { Region, FileLocation } from '@jbrowse/core/util/types'\nimport { GenericFilehandle } from 'generic-filehandle'\nimport { tap } from 'rxjs/operators'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport AbortablePromiseCache from 'abortable-promise-cache'\nimport QuickLRU from '@jbrowse/core/util/QuickLRU'\nimport MyConfigSchema from './configSchema'\n\ntype RowToGeneNames = {\n  name1: string\n  name2: string\n  score: number\n}[]\n\ninterface GeneNameToRows {\n  [key: string]: number[]\n}\n\nexport default class MCScanAnchorsAdapter extends BaseFeatureDataAdapter {\n  private cache = new AbortablePromiseCache({\n    cache: new QuickLRU({ maxSize: 1 }),\n    fill: () => this.setup(),\n  })\n\n  private initialized = false\n\n  private geneNameToRows: GeneNameToRows = {}\n\n  private rowToGeneName: RowToGeneNames = []\n\n  private subadapters: BaseFeatureDataAdapter[]\n\n  private assemblyNames: string[]\n\n  private mcscanAnchorsLocation: GenericFilehandle\n\n  public static capabilities = ['getFeatures', 'getRefNames']\n\n  public constructor(\n    config: Instance<typeof MyConfigSchema>,\n    getSubAdapter?: getSubAdapterType,\n  ) {\n    super(config)\n    const subadapters = readConfObject(config, 'subadapters')\n    const assemblyNames = readConfObject(config, 'assemblyNames')\n    this.mcscanAnchorsLocation = openLocation(\n      readConfObject(config, 'mcscanAnchorsLocation') as FileLocation,\n    )\n\n    this.subadapters = subadapters.map((subadapter: any) => {\n      const dataAdapter = getSubAdapter?.(subadapter).dataAdapter\n      if (dataAdapter instanceof BaseFeatureDataAdapter) {\n        return dataAdapter\n      }\n      throw new Error(`invalid subadapter type '${config.subadapter.type}'`)\n    })\n\n    this.assemblyNames = assemblyNames\n  }\n\n  async setup() {\n    if (!this.initialized) {\n      const text = (await this.mcscanAnchorsLocation.readFile('utf8')) as string\n      text.split('\\n').forEach((line: string, index: number) => {\n        if (line.length && line !== '###') {\n          const [name1, name2, score] = line.split('\\t')\n          if (this.geneNameToRows[name1] === undefined) {\n            this.geneNameToRows[name1] = []\n          }\n          if (this.geneNameToRows[name2] === undefined) {\n            this.geneNameToRows[name2] = []\n          }\n          this.geneNameToRows[name1].push(index)\n          this.geneNameToRows[name2].push(index)\n          this.rowToGeneName[index] = { name1, name2, score: +score }\n        }\n      })\n      this.initialized = true\n    }\n  }\n\n  async hasDataForRefName() {\n    // determining this properly is basically a call to getFeatures\n    // so is not really that important, and has to be true or else\n    // getFeatures is never called (BaseFeatureDataAdapter filters it out)\n    return true\n  }\n\n  async getRefNames() {\n    // we cannot determine this accurately\n    return []\n  }\n\n  getFeatures(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      await this.cache.get('initialize', opts, opts.signal)\n\n      // The index of the assembly name in the region list corresponds to\n      // the adapter in the subadapters list\n      const index = this.assemblyNames.indexOf(region.assemblyName)\n      if (index !== -1) {\n        const features = this.subadapters[index].getFeatures(region)\n        await features\n          .pipe(\n            tap(feature => {\n              // We first fetch from the NCList and connect each result\n              // with the anchor file via geneNameToRows. Note that each\n              // gene name can correspond to multiple rows\n              const rows = this.geneNameToRows[feature.get('name')] || []\n              rows.forEach(row => {\n                observer.next(\n                  new SimpleFeature({\n                    ...feature.toJSON(),\n                    syntenyId: row,\n                  }),\n                )\n              })\n            }),\n          )\n          .toPromise()\n      }\n\n      observer.complete()\n    })\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the forseeable future and can be purged\n   * from caches, etc\n   */\n  freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'MCScanAnchorsAdapter',\n  {\n    mcscanAnchorsLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/mcscan.anchors' },\n    },\n    subadapters: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema, getConf } from '@jbrowse/core/configuration'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AbstractSessionModel,\n  getSession,\n  isAbstractMenuManager,\n} from '@jbrowse/core/util'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\nimport AddIcon from '@material-ui/icons/Add'\nimport CalendarIcon from '@material-ui/icons/CalendarViewDay'\nimport { autorun } from 'mobx'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport {\n  configSchemaFactory as linearComparativeDisplayConfigSchemaFactory,\n  ReactComponent as LinearComparativeDisplayReactComponent,\n  stateModelFactory as linearComparativeDisplayStateModelFactory,\n} from './LinearComparativeDisplay'\nimport LinearComparativeViewFactory from './LinearComparativeView'\nimport {\n  configSchemaFactory as linearSyntenyDisplayConfigSchemaFactory,\n  stateModelFactory as linearSyntenyDisplayStateModelFactory,\n} from './LinearSyntenyDisplay'\nimport LinearSyntenyRenderer, {\n  configSchema as linearSyntenyRendererConfigSchema,\n  ReactComponent as LinearSyntenyRendererReactComponent,\n} from './LinearSyntenyRenderer'\nimport LinearSyntenyViewFactory from './LinearSyntenyView'\nimport {\n  AdapterClass as MCScanAnchorsAdapter,\n  configSchema as MCScanAnchorsConfigSchema,\n} from './MCScanAnchorsAdapter'\n\nconst { parseCigar } = MismatchParser\n\ninterface Track {\n  id: string\n  type: string\n  displays: {\n    addAdditionalContextMenuItemCallback: Function\n    additionalContextMenuItemCallbacks: Function[]\n    id: string\n    type: string\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    PileupDisplay: any\n  }[]\n}\ninterface View {\n  tracks: Track[]\n  views?: View[]\n  type: string\n}\ninterface Session {\n  views: View[]\n}\nfunction getLengthOnRef(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let lengthOnRef = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'I') {\n      lengthOnRef += len\n    }\n  }\n  return lengthOnRef\n}\n\nfunction getLength(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nfunction getLengthSansClipping(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\nfunction getClip(cigar: string, strand: number) {\n  return strand === -1\n    ? +(cigar.match(/(\\d+)[SH]$/) || [])[1] || 0\n    : +(cigar.match(/^(\\d+)([SH])/) || [])[1] || 0\n}\n\ninterface ReducedFeature {\n  refName: string\n  start: number\n  clipPos: number\n  end: number\n  seqLength: number\n  syntenyId?: number\n  uniqueId: string\n  mate: {\n    refName: string\n    start: number\n    end: number\n    syntenyId?: number\n    uniqueId?: string\n  }\n}\n\nexport default class extends Plugin {\n  name = 'LinearComparativeViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() =>\n      pluginManager.jbrequire(LinearComparativeViewFactory),\n    )\n    pluginManager.addViewType(() =>\n      pluginManager.jbrequire(LinearSyntenyViewFactory),\n    )\n\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'SyntenyTrack',\n        {},\n        { baseConfiguration: createBaseTrackConfig(pluginManager) },\n      )\n      return new TrackType({\n        name: 'SyntenyTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'SyntenyTrack',\n          configSchema,\n        ),\n      })\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearComparativeDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearComparativeDisplay',\n        configSchema,\n        stateModel: linearComparativeDisplayStateModelFactory(configSchema),\n        trackType: 'SyntenyTrack',\n        viewType: 'LinearComparativeView',\n        ReactComponent: LinearComparativeDisplayReactComponent,\n      })\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearSyntenyDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearSyntenyDisplay',\n        configSchema,\n        stateModel: linearSyntenyDisplayStateModelFactory(configSchema),\n        trackType: 'SyntenyTrack',\n        viewType: 'LinearSyntenyView',\n        ReactComponent: LinearComparativeDisplayReactComponent,\n      })\n    })\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'MCScanAnchorsAdapter',\n          configSchema: MCScanAnchorsConfigSchema,\n          AdapterClass: MCScanAnchorsAdapter,\n        }),\n    )\n    pluginManager.addRendererType(\n      () =>\n        new LinearSyntenyRenderer({\n          name: 'LinearSyntenyRenderer',\n          configSchema: linearSyntenyRendererConfigSchema,\n          ReactComponent: LinearSyntenyRendererReactComponent,\n        }),\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['File', 'Add'], {\n        label: 'Linear synteny view',\n        icon: CalendarIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('LinearSyntenyView', {})\n        },\n      })\n    }\n\n    const cb = (feature: Feature, track: IAnyStateTreeNode) => {\n      return feature\n        ? [\n            {\n              label: 'Linear read vs ref',\n              icon: AddIcon,\n              onClick: () => {\n                const session = getSession(track)\n                const clipPos = feature.get('clipPos')\n                const cigar = feature.get('CIGAR')\n                const flags = feature.get('flags')\n                const SA: string =\n                  (feature.get('tags')\n                    ? feature.get('tags').SA\n                    : feature.get('SA')) || ''\n                const readName = feature.get('name')\n                const readAssembly = `${readName}_assembly`\n                const trackAssembly = getConf(\n                  // @ts-ignore\n                  track.parentTrack,\n                  'assemblyNames',\n                )[0]\n                const assemblyNames = [trackAssembly, readAssembly]\n                const trackId = `track-${Date.now()}`\n                const trackName = `${readName}_vs_${trackAssembly}`\n                const supplementaryAlignments = SA.split(';')\n                  .filter(aln => !!aln)\n                  .map((aln, index) => {\n                    const [saRef, saStart, saStrand, saCigar] = aln.split(',')\n                    const saLengthOnRef = getLengthOnRef(saCigar)\n                    const saLength = getLength(saCigar)\n                    const saLengthSansClipping = getLengthSansClipping(saCigar)\n                    const saStrandNormalized = saStrand === '-' ? -1 : 1\n                    const saClipPos = getClip(saCigar, saStrandNormalized)\n                    const saRealStart = +saStart - 1 + saClipPos\n                    return {\n                      refName: saRef,\n                      start: saRealStart,\n                      end: saRealStart + saLengthOnRef,\n                      seqLength: saLength,\n                      clipPos: saClipPos,\n                      CIGAR: saCigar,\n                      assemblyName: trackAssembly,\n                      strand: saStrandNormalized,\n                      uniqueId: `${feature.id()}_SA${index}`,\n                      mate: {\n                        start: saClipPos,\n                        end: saClipPos + saLengthSansClipping,\n                        refName: readName,\n                      },\n                    }\n                  })\n\n                const feat = feature.toJSON()\n\n                feat.mate = {\n                  refName: readName,\n                  start: clipPos,\n                  end: clipPos + getLengthSansClipping(cigar),\n                }\n\n                // if secondary alignment or supplementary, calculate length from SA[0]'s CIGAR\n                // which is the primary alignments. otherwise it is the primary alignment just use\n                // seq.length if primary alignment\n                const totalLength =\n                  // eslint-disable-next-line no-bitwise\n                  flags & 2048\n                    ? getLength(supplementaryAlignments[0].CIGAR)\n                    : getLength(cigar)\n\n                const features = [\n                  feat,\n                  ...supplementaryAlignments,\n                ] as ReducedFeature[]\n\n                features.forEach((f, index) => {\n                  f.syntenyId = index\n                  f.mate.syntenyId = index\n                  f.mate.uniqueId = `${f.uniqueId}_mate`\n                })\n                features.sort((a, b) => a.clipPos - b.clipPos)\n\n                // the config feature store includes synthetic mate features\n                // mapped to the read assembly\n                const configFeatureStore = features.concat(\n                  // @ts-ignore\n                  features.map(f => f.mate),\n                )\n\n                const refLength = features.reduce(\n                  (a, f) => a + f.end - f.start,\n                  0,\n                )\n\n                session.addView('LinearSyntenyView', {\n                  type: 'LinearSyntenyView',\n                  views: [\n                    {\n                      type: 'LinearGenomeView',\n                      hideHeader: true,\n                      offsetPx: 0,\n                      bpPerPx: refLength / 800,\n                      displayedRegions: features.map(f => {\n                        return {\n                          start: f.start,\n                          end: f.end,\n                          refName: f.refName,\n                          assemblyName: trackAssembly,\n                        }\n                      }),\n                    },\n                    {\n                      type: 'LinearGenomeView',\n                      hideHeader: true,\n                      offsetPx: 0,\n                      bpPerPx: totalLength / 800,\n                      displayedRegions: [\n                        {\n                          assemblyName: readAssembly,\n                          start: 0,\n                          end: totalLength,\n                          refName: readName,\n                        },\n                      ],\n                    },\n                  ],\n                  viewTrackConfigs: [\n                    {\n                      type: 'SyntenyTrack',\n                      assemblyNames,\n                      adapter: {\n                        type: 'FromConfigAdapter',\n                        features: configFeatureStore,\n                      },\n                      renderer: {\n                        type: 'LinearSyntenyRenderer',\n                      },\n                      trackId,\n                      name: trackName,\n                    },\n                  ],\n                  tracks: [\n                    {\n                      configuration: trackId,\n                      type: 'SyntenyTrack',\n                      displays: [\n                        {\n                          type: 'LinearSyntenyDisplay',\n                          configuration: `${trackId}-LinearSyntenyDisplay`,\n                        },\n                      ],\n                    },\n                  ],\n                  displayName: `${readName} vs ${trackAssembly}`,\n                })\n              },\n            },\n          ]\n        : []\n    }\n    function addContextMenu(view: View) {\n      if (view.type === 'LinearGenomeView') {\n        view.tracks.forEach(track => {\n          if (track.type === 'AlignmentsTrack') {\n            track.displays.forEach(display => {\n              if (\n                display.type === 'LinearPileupDisplay' &&\n                !display.additionalContextMenuItemCallbacks.includes(cb)\n              ) {\n                display.addAdditionalContextMenuItemCallback(cb)\n              } else if (\n                display.type === 'LinearAlignmentsDisplay' &&\n                display.PileupDisplay &&\n                !display.PileupDisplay.additionalContextMenuItemCallbacks.includes(\n                  cb,\n                )\n              ) {\n                display.PileupDisplay.addAdditionalContextMenuItemCallback(cb)\n              }\n            })\n          }\n        })\n      }\n    }\n    autorun(() => {\n      const session = pluginManager.rootModel?.session as Session | undefined\n      if (session) {\n        session.views.forEach(view => {\n          if (view.views) {\n            view.views.forEach(v => addContextMenu(v))\n          } else {\n            addContextMenu(view)\n          }\n        })\n      }\n    })\n  }\n}\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration/configurationSchema'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { types } from 'mobx-state-tree'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\n\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearLollipopDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearLollipopDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => ({\n      get blockType() {\n        return 'dynamicBlocks'\n      },\n      get renderDelay() {\n        return 500\n      },\n      get renderProps() {\n        return {\n          ...self.composedRenderProps,\n          ...getParentRenderProps(self),\n          config: self.configuration.renderer,\n        }\n      },\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n    }))\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { contrastingTextColor } from '@jbrowse/core/util/color'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\n\nfunction ScoreText({\n  feature,\n  config,\n  layoutRecord: {\n    y,\n    data: { anchorX, radiusPx, score },\n  },\n}) {\n  const innerColor = readConfObject(config, 'innerColor', [feature])\n\n  const scoreString = String(score)\n  const fontWidth = (radiusPx * 2) / scoreString.length\n  const fontHeight = fontWidth * 1.1\n  if (fontHeight < 12) return null\n  return (\n    <text\n      style={{ fontSize: fontHeight, fill: contrastingTextColor(innerColor) }}\n      x={anchorX}\n      y={y + radiusPx - fontHeight / 2.4}\n      textAnchor=\"middle\"\n      dominantBaseline=\"hanging\"\n    >\n      {scoreString}\n    </text>\n  )\n}\n\nScoreText.propTypes = {\n  feature: ReactPropTypes.shape({ get: ReactPropTypes.func.isRequired })\n    .isRequired,\n  layoutRecord: ReactPropTypes.shape({\n    x: ReactPropTypes.number.isRequired,\n    y: ReactPropTypes.number.isRequired,\n    width: ReactPropTypes.number.isRequired,\n    height: ReactPropTypes.number.isRequired,\n    data: ReactPropTypes.shape({\n      anchorX: ReactPropTypes.number.isRequired,\n      radiusPx: ReactPropTypes.number.isRequired,\n      score: ReactPropTypes.number.isRequired,\n    }).isRequired,\n  }).isRequired,\n  config: CommonPropTypes.ConfigSchema.isRequired,\n}\n\nfunction Lollipop(props) {\n  const onFeatureMouseDown = event => {\n    const { onFeatureMouseDown: handler, feature } = props\n    if (!handler) return undefined\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseEnter = event => {\n    const { onFeatureMouseEnter: handler, feature } = props\n    if (!handler) return undefined\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseOut = event => {\n    const { onFeatureMouseOut: handler, feature } = props\n    if (!handler) return undefined\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseOver = event => {\n    const { onFeatureMouseOver: handler, feature } = props\n    if (!handler) return undefined\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseUp = event => {\n    const { onFeatureMouseUp: handler, feature } = props\n    if (!handler) return undefined\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseLeave = event => {\n    const { onFeatureMouseLeave: handler, feature } = props\n    if (!handler) return undefined\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseMove = event => {\n    const { onFeatureMouseMove: handler, feature } = props\n    if (!handler) return undefined\n    return handler(event, feature.id())\n  }\n\n  const onFeatureClick = event => {\n    const { onFeatureClick: handler, feature } = props\n    if (!handler) return undefined\n    event.stopPropagation()\n    return handler(event, feature.id())\n  }\n\n  const {\n    feature,\n    config,\n    layoutRecord: {\n      anchorLocation,\n      y,\n      data: { radiusPx, score },\n    },\n    selectedFeatureId,\n  } = props\n\n  const styleOuter = {\n    fill: readConfObject(config, 'strokeColor', [feature]),\n  }\n  if (String(selectedFeatureId) === String(feature.id())) {\n    styleOuter.fill = 'red'\n  }\n\n  const styleInner = {\n    fill: readConfObject(config, 'innerColor', [feature]),\n  }\n\n  const strokeWidth = readConfObject(config, 'strokeWidth', [feature])\n\n  return (\n    <g data-testid={feature.id()}>\n      <title>{readConfObject(config, 'caption', [feature])}</title>\n      <circle\n        cx={anchorLocation}\n        cy={y + radiusPx}\n        r={radiusPx}\n        style={styleOuter}\n        onMouseDown={onFeatureMouseDown}\n        onMouseEnter={onFeatureMouseEnter}\n        onMouseOut={onFeatureMouseOut}\n        onMouseOver={onFeatureMouseOver}\n        onMouseUp={onFeatureMouseUp}\n        onMouseLeave={onFeatureMouseLeave}\n        onMouseMove={onFeatureMouseMove}\n        onClick={onFeatureClick}\n        onFocus={onFeatureMouseOver}\n        onBlur={onFeatureMouseOut}\n      />\n      {radiusPx - strokeWidth <= 2 ? null : (\n        <circle\n          cx={anchorLocation}\n          cy={y + radiusPx}\n          r={radiusPx - strokeWidth}\n          style={styleInner}\n          onMouseDown={onFeatureMouseDown}\n          onMouseEnter={onFeatureMouseEnter}\n          onMouseOut={onFeatureMouseOut}\n          onMouseOver={onFeatureMouseOver}\n          onMouseUp={onFeatureMouseUp}\n          onMouseLeave={onFeatureMouseLeave}\n          onMouseMove={onFeatureMouseMove}\n          onClick={onFeatureClick}\n          onFocus={onFeatureMouseOver}\n          onBlur={onFeatureMouseOut}\n        />\n      )}\n      <ScoreText {...props} score={score} />\n    </g>\n  )\n}\nLollipop.propTypes = {\n  feature: ReactPropTypes.shape({\n    id: ReactPropTypes.func.isRequired,\n    get: ReactPropTypes.func.isRequired,\n  }).isRequired,\n  // bpPerPx: ReactPropTypes.number.isRequired,\n  // region: CommonPropTypes.Region.isRequired,\n  // config: CommonPropTypes.ConfigSchema.isRequired,\n  layoutRecord: ReactPropTypes.shape({\n    x: ReactPropTypes.number.isRequired,\n    y: ReactPropTypes.number.isRequired,\n    anchorLocation: ReactPropTypes.number.isRequired,\n    data: ReactPropTypes.shape({\n      anchorX: ReactPropTypes.number.isRequired,\n      radiusPx: ReactPropTypes.number.isRequired,\n      score: ReactPropTypes.number.isRequired,\n    }),\n    width: ReactPropTypes.number.isRequired,\n    height: ReactPropTypes.number.isRequired,\n  }).isRequired,\n\n  selectedFeatureId: ReactPropTypes.string,\n\n  config: CommonPropTypes.ConfigSchema.isRequired,\n\n  onFeatureMouseDown: ReactPropTypes.func,\n  onFeatureMouseEnter: ReactPropTypes.func,\n  onFeatureMouseOut: ReactPropTypes.func,\n  onFeatureMouseOver: ReactPropTypes.func,\n  onFeatureMouseUp: ReactPropTypes.func,\n  onFeatureMouseLeave: ReactPropTypes.func,\n  onFeatureMouseMove: ReactPropTypes.func,\n\n  // synthesized from mouseup and mousedown\n  onFeatureClick: ReactPropTypes.func,\n}\n\nLollipop.defaultProps = {\n  selectedFeatureId: undefined,\n\n  onFeatureMouseDown: undefined,\n  onFeatureMouseEnter: undefined,\n  onFeatureMouseOut: undefined,\n  onFeatureMouseOver: undefined,\n  onFeatureMouseUp: undefined,\n  onFeatureMouseLeave: undefined,\n  onFeatureMouseMove: undefined,\n\n  onFeatureClick: undefined,\n}\nexport default observer(Lollipop)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\n\nfunction Stick(props) {\n  const {\n    feature,\n    config,\n    layoutRecord: {\n      anchorLocation,\n      y,\n      data: { radiusPx },\n    },\n    selectedFeatureId,\n  } = props\n\n  const style = { fill: readConfObject(config, 'bodyColor', [feature]) }\n  if (String(selectedFeatureId) === String(feature.id())) {\n    style.fill = 'red'\n  }\n  return (\n    <line\n      x1={anchorLocation}\n      y1={0}\n      x2={anchorLocation}\n      y2={y + 2 * radiusPx}\n      stroke={readConfObject(config, 'stickColor', [feature])}\n      strokeWidth={readConfObject(config, 'stickWidth', ['feature'])}\n    />\n  )\n}\nStick.propTypes = {\n  feature: ReactPropTypes.shape({\n    id: ReactPropTypes.func.isRequired,\n    get: ReactPropTypes.func.isRequired,\n  }).isRequired,\n  // bpPerPx: ReactPropTypes.number.isRequired,\n  // region: CommonPropTypes.Region.isRequired,\n  // config: CommonPropTypes.ConfigSchema.isRequired,\n  layoutRecord: ReactPropTypes.shape({\n    x: ReactPropTypes.number.isRequired,\n    y: ReactPropTypes.number.isRequired,\n    width: ReactPropTypes.number.isRequired,\n    height: ReactPropTypes.number.isRequired,\n    anchorLocation: ReactPropTypes.number.isRequired,\n    data: ReactPropTypes.shape({ radiusPx: ReactPropTypes.number.isRequired })\n      .isRequired,\n  }).isRequired,\n\n  selectedFeatureId: ReactPropTypes.string,\n\n  config: CommonPropTypes.ConfigSchema.isRequired,\n}\nStick.defaultProps = {\n  selectedFeatureId: undefined,\n}\n\nexport default observer(Stick)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { bpToPx } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\nimport Lollipop from './Lollipop'\nimport Stick from './Stick'\n\nfunction LollipopRendering(props) {\n  const onMouseDown = event => {\n    const { onMouseDown: handler } = props\n    if (!handler) return undefined\n    return handler(event)\n  }\n\n  const onMouseUp = event => {\n    const { onMouseUp: handler } = props\n    if (!handler) return undefined\n    return handler(event)\n  }\n\n  const onMouseEnter = event => {\n    const { onMouseEnter: handler } = props\n    if (!handler) return undefined\n    return handler(event)\n  }\n\n  const onMouseLeave = event => {\n    const { onMouseLeave: handler } = props\n    if (!handler) return undefined\n    return handler(event)\n  }\n\n  const onMouseOver = event => {\n    const { onMouseOver: handler } = props\n    if (!handler) return undefined\n    return handler(event)\n  }\n\n  const onMouseOut = event => {\n    const { onMouseOut: handler } = props\n    if (!handler) return undefined\n    return handler(event)\n  }\n\n  const onClick = event => {\n    const { onClick: handler } = props\n    if (!handler) return undefined\n    return handler(event)\n  }\n\n  function layoutFeat(args) {\n    const { feature, bpPerPx, region, layout } = args\n\n    const centerBp = Math.abs(feature.get('end') + feature.get('start')) / 2\n    const centerPx = bpToPx(centerBp, region, bpPerPx)\n    const radiusPx = readConfObject(args.config, 'radius', [feature])\n\n    if (!radiusPx)\n      console.error(\n        new Error(\n          `lollipop radius ${radiusPx} configured for feature ${feature.id()}`,\n        ),\n      )\n    layout.add(feature.id(), centerPx, radiusPx * 2, radiusPx * 2, {\n      featureId: feature.id(),\n      anchorX: centerPx,\n      radiusPx,\n      score: readConfObject(args.config, 'score', [feature]),\n    })\n  }\n\n  const {\n    regions,\n    bpPerPx,\n    layout,\n    config,\n    features,\n    displayModel: { selectedFeatureId },\n  } = props\n\n  const [region] = regions\n  const sticksRendered = []\n  const lollipopsRendered = []\n  for (const feature of features.values()) {\n    layoutFeat({\n      feature,\n      bpPerPx,\n      region,\n      config,\n      layout,\n    })\n  }\n\n  for (const layoutRecord of layout.getLayout(config).values()) {\n    const feature = features.get(layoutRecord.data.featureId)\n    lollipopsRendered.push(\n      <Stick\n        {...props}\n        layoutRecord={layoutRecord}\n        feature={feature}\n        key={`stick-${feature.id()}`}\n        selectedFeatureId={selectedFeatureId}\n      />,\n    )\n  }\n\n  for (const layoutRecord of layout.getLayout(config).values()) {\n    const feature = features.get(layoutRecord.data.featureId)\n    lollipopsRendered.push(\n      <Lollipop\n        {...props}\n        layoutRecord={layoutRecord}\n        feature={feature}\n        key={`body-${feature.id()}`}\n        selectedFeatureId={selectedFeatureId}\n      />,\n    )\n  }\n\n  const width = (region.end - region.start) / bpPerPx\n  const height = layout.getTotalHeight()\n\n  return (\n    <svg\n      className=\"LollipopRendering\"\n      width={width}\n      height={height}\n      style={{\n        position: 'relative',\n      }}\n      onMouseDown={onMouseDown}\n      onMouseUp={onMouseUp}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      onMouseOver={onMouseOver}\n      onMouseOut={onMouseOut}\n      onFocus={onMouseEnter}\n      onBlur={onMouseLeave}\n      onClick={onClick}\n    >\n      {sticksRendered}\n      {lollipopsRendered}\n    </svg>\n  )\n}\n\nLollipopRendering.propTypes = {\n  layout: ReactPropTypes.shape({\n    getLayout: ReactPropTypes.func.isRequired,\n    add: ReactPropTypes.func.isRequired,\n    getTotalHeight: ReactPropTypes.func.isRequired,\n  }).isRequired,\n\n  regions: ReactPropTypes.arrayOf(CommonPropTypes.Region).isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  features: ReactPropTypes.instanceOf(Map),\n  config: CommonPropTypes.ConfigSchema.isRequired,\n  displayModel: ReactPropTypes.shape({\n    /** id of the currently selected feature, if any */\n    selectedFeatureId: ReactPropTypes.string,\n  }),\n\n  onMouseDown: ReactPropTypes.func,\n  onMouseUp: ReactPropTypes.func,\n  onMouseEnter: ReactPropTypes.func,\n  onMouseLeave: ReactPropTypes.func,\n  onMouseOver: ReactPropTypes.func,\n  onMouseOut: ReactPropTypes.func,\n  onClick: ReactPropTypes.func,\n}\n\nLollipopRendering.defaultProps = {\n  displayModel: {},\n\n  features: new Map(),\n\n  onMouseDown: undefined,\n  onMouseUp: undefined,\n  onMouseEnter: undefined,\n  onMouseLeave: undefined,\n  onMouseOver: undefined,\n  onMouseOut: undefined,\n  onClick: undefined,\n}\n\nexport default observer(LollipopRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'LollipopRenderer',\n  {\n    strokeColor: {\n      type: 'color',\n      description: 'the outer color of each lollipop',\n      defaultValue: 'green',\n      functionSignature: ['feature'],\n    },\n    innerColor: {\n      type: 'color',\n      description: 'the inner color of each lollipop',\n      defaultValue: '#7fc75f',\n      functionSignature: ['feature'],\n    },\n    strokeWidth: {\n      type: 'number',\n      description: 'width of the stroked border',\n      defaultValue: 4,\n      functionSignature: ['feature'],\n    },\n    radius: {\n      type: 'number',\n      description: 'radius in pixels of each lollipop body',\n      defaultValue: `\nfunction(feature) {\n  // this default function makes the\n  // area of each head be 10 times\n  // the feature score\n  const area = feature.get('score')*10\n  const radius = Math.sqrt(area/3.14)\n  return Math.max(3,radius)\n}\n`,\n      functionSignature: ['feature'],\n    },\n    caption: {\n      type: 'string',\n      description:\n        'the tooltip caption displayed when the mouse hovers over a lollipop',\n      defaultValue: `\nfunction(feature) {\n  return feature.get('name')\n}\n      `,\n      functionSignature: ['feature'],\n    },\n    minStickLength: {\n      type: 'number',\n      description: 'minimum lollipop \"stick\" length, in pixels',\n      defaultValue: 5,\n    },\n    stickColor: {\n      type: 'color',\n      description: 'color of the lollipop stick',\n      defaultValue: 'black',\n      functionSignature: ['feature'],\n    },\n    stickWidth: {\n      type: 'number',\n      description: 'width in pixels of the lollipop stick',\n      defaultValue: 2,\n      functionSignature: ['feature'],\n    },\n    score: {\n      type: 'number',\n      description:\n        'the \"score\" of each lollipop, displayed as a number in the center of the circle',\n      defaultValue: `\nfunction(feature) {\n  return feature.get('score')\n}\n      `,\n      functionSignature: ['feature'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { doesIntersect2 } from '@jbrowse/core/util/range'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\ninterface LayoutItem {\n  uniqueId: string\n  anchorLocation: number\n  width: number\n  height: number\n  data: { score: number }\n}\n\ntype LayoutEntry = LayoutItem & { x: number; y: number }\n\ntype LayoutMap = Map<string, LayoutEntry>\n\nexport class FloatingLayout {\n  width: number\n\n  totalHeight = 0\n\n  constructor({ width }: { width: number }) {\n    if (!width) throw new Error('width required to make a new FloatingLayout')\n    this.width = width\n  }\n\n  items: LayoutItem[] = []\n\n  layout: LayoutMap = new Map()\n\n  layoutDirty = false\n\n  add(\n    uniqueId: string,\n    anchorLocation: number,\n    width: number,\n    height: number,\n    data: { score: number },\n  ) {\n    this.items.push({ uniqueId, anchorLocation, width, height, data })\n    this.layoutDirty = true\n  }\n\n  /**\n   * @returns Map of `uniqueId => {x,y,anchorLocation,width,height,data}`\n   */\n  getLayout(configuration?: AnyConfigurationModel) {\n    if (!this.layoutDirty) return this.layout\n    if (!configuration) throw new Error('configuration object required')\n\n    const minY = readConfObject(configuration, 'minStickLength')\n\n    // sort them by score ascending, so higher scores will always end up\n    // stacked last (toward the bottom)\n    const sorted = this.items.sort((a, b) => a.data.score - b.data.score)\n\n    // bump them\n    let maxBottom = 0\n    const layoutEntries: [string, LayoutEntry][] = Array(sorted.length)\n    for (let i = 0; i < sorted.length; i += 1) {\n      const currentItem = sorted[i]\n      const { anchorLocation, width, height } = currentItem\n      const start = anchorLocation - width / 2\n      const end = start + width\n      let top = minY\n      let bottom = top + height\n\n      // figure out how far down to put it\n      for (let j = 0; j < i; j += 1) {\n        const [, previouslyLayedOutItem] = layoutEntries[j]\n        const {\n          x: prevStart,\n          y: prevTop,\n          width: prevWidth,\n          height: prevHeight,\n        } = previouslyLayedOutItem\n        const prevEnd = prevStart + prevWidth\n        const prevBottom = prevTop + prevHeight\n        if (\n          doesIntersect2(prevStart, prevEnd, start, end) &&\n          doesIntersect2(prevTop, prevBottom, top, bottom)\n        ) {\n          // bump this one to the bottom of the previous one\n          top = prevBottom\n          bottom = top + height\n          j = -1 // we need to check all of them again after bumping\n        }\n      }\n\n      // record the entry and update the maxBottom\n      layoutEntries[i] = [\n        currentItem.uniqueId,\n        { ...currentItem, x: start, y: top },\n      ]\n      if (bottom > maxBottom) maxBottom = bottom\n    }\n\n    // try to tile them left to right all at the same level\n    // if they don't fit, try to alternate them on 2 levels, then 3\n    this.totalHeight = maxBottom\n    this.layout = new Map(layoutEntries)\n    this.layoutDirty = false\n    return this.layout\n  }\n\n  getTotalHeight() {\n    if (this.layoutDirty)\n      throw new Error('getTotalHeight does not work when the layout is dirty.')\n    return this.totalHeight\n  }\n\n  serializeRegion() {\n    return this.toJSON()\n  }\n\n  toJSON() {\n    if (this.layoutDirty)\n      throw new Error('toJSON does not work when the layout is dirty.')\n    return { pairs: [...this.getLayout()], totalHeight: this.getTotalHeight() }\n  }\n\n  static fromJSON() {\n    throw new Error('not supported')\n  }\n}\n\nexport class PrecomputedFloatingLayout {\n  layout: LayoutMap\n\n  totalHeight: number\n\n  constructor({\n    pairs,\n    totalHeight,\n  }: {\n    pairs: [string, LayoutEntry][]\n    totalHeight: number\n  }) {\n    this.layout = new Map(pairs)\n    this.totalHeight = totalHeight\n  }\n\n  add(uniqueId: string) {\n    if (!this.layout.has(uniqueId))\n      throw new Error(`layout error, precomputed layout is missing ${uniqueId}`)\n  }\n\n  getLayout() {\n    return this.layout\n  }\n\n  getTotalHeight() {\n    return this.totalHeight\n  }\n\n  static fromJSON(\n    json: ConstructorParameters<typeof PrecomputedFloatingLayout>[0],\n  ) {\n    return new PrecomputedFloatingLayout(json)\n  }\n}\n","import BoxRendererType, {\n  LayoutSession,\n} from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport MultiLayout from '@jbrowse/core/util/layouts/MultiLayout'\nimport { FloatingLayout, PrecomputedFloatingLayout } from './Layout'\n\nclass FloatingLayoutSession extends LayoutSession {\n  makeLayout() {\n    'sequenceAdapter'\n\n    const { end, start } = this.regions[0]\n    const widthPx = (end - start) / this.bpPerPx\n    return new MultiLayout(FloatingLayout, { width: widthPx })\n  }\n\n  layoutIsValid(/* layout */) {\n    return false // layout.left layout.width === this.width\n  }\n}\n\nexport default class extends BoxRendererType {\n  createSession(args) {\n    return new FloatingLayoutSession(args)\n  }\n\n  deserializeLayoutInClient(json) {\n    return new PrecomputedFloatingLayout(json)\n  }\n}\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport {\n  configSchemaFactory as linearLollipopDisplayConfigSchemaFactory,\n  stateModelFactory as LinearLollipopDisplayStateModelFactory,\n} from './LinearLollipopDisplay'\nimport LollipopRenderer, {\n  configSchema as lollipopRendererConfigSchema,\n  ReactComponent as LollipopRendererReactComponent,\n} from './LollipopRenderer'\n\nexport default class extends Plugin {\n  name = 'LollipopPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addRendererType(\n      () =>\n        // @ts-ignore error \"expected 0 arguments, but got 1\"?\n        new LollipopRenderer({\n          name: 'LollipopRenderer',\n          ReactComponent: LollipopRendererReactComponent,\n          configSchema: lollipopRendererConfigSchema,\n        }),\n    )\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearLollipopDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearLollipopDisplay',\n        configSchema,\n        stateModel: LinearLollipopDisplayStateModelFactory(configSchema),\n        trackType: 'FeatureTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\n\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearLollipopDisplay',\n    { renderer: pluginManager.pluggableConfigSchemaType('renderer') },\n    {\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import Typography from '@material-ui/core/Typography'\nimport { observer } from 'mobx-react'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport { getSession } from '@jbrowse/core/util'\nimport React from 'react'\nimport { makeStyles } from '@material-ui/core'\nimport Link from '@material-ui/core/Link'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    margin: theme.spacing(2),\n  },\n  subtitle: {\n    margin: theme.spacing(),\n  },\n}))\n\nfunction About({ model }: { model: IAnyStateTreeNode }) {\n  const classes = useStyles()\n  const root = model ? getSession(model) : { version: '' }\n  return (\n    <div className={classes.root}>\n      <Typography variant=\"h4\" align=\"center\" color=\"primary\">\n        JBrowse 2\n      </Typography>\n      <Typography variant=\"h6\" align=\"center\" className={classes.subtitle}>\n        {root.version}\n      </Typography>\n      <Typography align=\"center\" variant=\"body2\">\n        JBrowse is a{' '}\n        <Link href=\"http://gmod.org/\" target=\"_blank\" rel=\"noopener noreferrer\">\n          GMOD\n        </Link>{' '}\n        project\n      </Typography>\n      <br />\n      <Typography align=\"center\">\n         2019 The Evolutionary Software Foundation\n      </Typography>\n      {/* <br />\n      <Typography align=\"center\">\n        JBrowse is funded by the{' '}\n        <Link\n          href=\"https://genome.gov/\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          NHGRI\n        </Link>\n      </Typography> */}\n    </div>\n  )\n}\n\nexport default observer(About)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('AboutWidget', {})\n\nexport const stateModel = types.model('AboutWidget', {\n  id: ElementId,\n  type: types.literal('AboutWidget'),\n})\n\nexport { default as ReactComponent } from './components/AboutWidget'\n","import Typography from '@material-ui/core/Typography'\nimport { observer } from 'mobx-react'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport { getSession } from '@jbrowse/core/util'\nimport React from 'react'\nimport { makeStyles } from '@material-ui/core'\nimport Link from '@material-ui/core/Link'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    margin: theme.spacing(2),\n    fontSize: '1.2em',\n  },\n  subtitle: {\n    margin: theme.spacing(),\n  },\n}))\n\nfunction Help({ model }: { model?: IAnyStateTreeNode }) {\n  const classes = useStyles()\n  const root = model ? getSession(model) : { version: '' }\n  return (\n    <div className={classes.root}>\n      <Typography variant=\"h4\" align=\"center\" color=\"primary\">\n        JBrowse 2\n      </Typography>\n      <Typography variant=\"h6\" align=\"center\" className={classes.subtitle}>\n        {root.version}\n      </Typography>\n\n      <p>\n        Here are some resources to get help. Please report the version number\n        above when asking questions. Thanks!\n      </p>\n      <ul>\n        <li>\n          <Link\n            href=\"https://github.com/GMOD/jbrowse-components/discussions\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            Question & answer forum\n          </Link>\n        </li>\n        <li>\n          <Link\n            href=\"https://github.com/GMOD/jbrowse-components/issues/new/choose\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            Report a bug\n          </Link>\n        </li>\n        <li>\n          <Link\n            href=\"https://jbrowse.org/jb2/docs/user_guide\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            User guide\n          </Link>\n        </li>\n        <li>\n          <Link\n            href=\"https://jbrowse.org/jb2/docs/\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            Documentation\n          </Link>\n        </li>\n      </ul>\n    </div>\n  )\n}\n\nexport default observer(Help)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('HelpWidget', {})\n\nexport const stateModel = types.model('HelpWidget', {\n  id: ElementId,\n  type: types.literal('HelpWidget'),\n})\n\nexport { default as ReactComponent } from './components/HelpWidget'\n","import { getSession } from '@jbrowse/core/util'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport Button from '@material-ui/core/Button'\nimport Accordion from '@material-ui/core/Accordion'\nimport AccordionDetails from '@material-ui/core/AccordionDetails'\nimport AccordionSummary from '@material-ui/core/AccordionSummary'\nimport IconButton from '@material-ui/core/IconButton'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction'\nimport ListSubheader from '@material-ui/core/ListSubheader'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport TextField from '@material-ui/core/TextField'\nimport Typography from '@material-ui/core/Typography'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React, { useEffect, useState } from 'react'\nimport { useDropzone } from 'react-dropzone'\nimport CloudUploadIcon from '@material-ui/icons/CloudUpload'\nimport ErrorIcon from '@material-ui/icons/Error'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport CheckCircleIcon from '@material-ui/icons/CheckCircle'\nimport DeleteIcon from '@material-ui/icons/Delete'\n\nfunction styledBy(property, mapping) {\n  return props => mapping[props[property]]\n}\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    margin: theme.spacing(1),\n  },\n  paper: {\n    display: 'flex',\n    flexDirection: 'column',\n  },\n  dropZone: {\n    textAlign: 'center',\n    margin: theme.spacing(2),\n    padding: theme.spacing(2),\n    borderWidth: 2,\n    borderRadius: 2,\n    borderColor: styledBy('isDragActive', {\n      true: theme.palette.secondary.light,\n      false: theme.palette.divider,\n    }),\n    borderStyle: 'dashed',\n    backgroundColor: styledBy('isDragActive', {\n      true: fade(theme.palette.text.primary, theme.palette.action.hoverOpacity),\n      false: theme.palette.background.default,\n    }),\n    outline: 'none',\n    transition: 'border .24s ease-in-out',\n    '&:focus': {\n      borderColor: theme.palette.secondary.light,\n    },\n  },\n  uploadIcon: {\n    color: theme.palette.text.secondary,\n  },\n  rejectedFiles: {\n    marginTop: theme.spacing(4),\n  },\n  errorMessage: {\n    marginTop: theme.spacing(4),\n    textAlign: 'center',\n  },\n  listItem: {\n    padding: theme.spacing(0, 4),\n  },\n  expandIcon: {\n    color: '#FFFFFF',\n  },\n}))\n\nfunction ImportConfiguration(props) {\n  const [errorMessage, setErrorMessage] = useState('')\n  const [acceptedFilesParsed, setAcceptedFilesParsed] = useState([])\n  const {\n    acceptedFiles,\n    getRootProps,\n    getInputProps,\n    isDragActive,\n  } = useDropzone({\n    onDrop: () => setErrorMessage(''),\n  })\n  useEffect(() => {\n    async function getConfigs() {\n      const newConfigs = []\n      for (const file of acceptedFiles) {\n        let config\n        if (\n          !['application/json' /* , 'application/x-yaml' */].includes(file.type)\n        )\n          config = { error: `File is not in JSON format: ${file.path}` }\n        else if (file.size > 512 * 1024 ** 2)\n          config = {\n            error: `File is too large (${file.size} bytes, max of 512 MiB): ${file.path}`,\n          }\n        else {\n          const fileHandle = openLocation({ blob: file })\n          let configContents\n          try {\n            // eslint-disable-next-line no-await-in-loop\n            configContents = await fileHandle.readFile('utf8')\n          } catch (error) {\n            console.error(error)\n            config = { error: `Problem opening file ${file.path}: ${error}` }\n          }\n          if (configContents)\n            try {\n              config = JSON.parse(configContents)\n            } catch (error) {\n              console.error(error)\n              config = { error: `Error parsing ${file.path}: ${error}` }\n            }\n          if (!config.error) {\n            if (!config.defaultSession) config.defaultSession = {}\n            if (!config.defaultSession.name)\n              config.defaultSession.name = `Imported Config ${file.path}`\n          }\n        }\n        newConfigs.push(config)\n      }\n\n      setAcceptedFilesParsed(\n        acceptedFiles.map((file, idx) => {\n          file.config = newConfigs[idx]\n          return file\n        }),\n      )\n    }\n\n    getConfigs()\n  }, [acceptedFiles])\n  const classes = useStyles({ isDragActive })\n\n  const { addSessions, setActiveSession, model } = props\n  const session = getSession(model)\n\n  async function importConfigs() {\n    try {\n      await addSessions(acceptedFilesParsed.map(file => file.config))\n      setActiveSession(acceptedFilesParsed[0].config.defaultSession.name)\n      session.hideWidget(model)\n    } catch (error) {\n      setErrorMessage(`${error}`)\n    }\n  }\n\n  function updateConfigName(newName, idx) {\n    setAcceptedFilesParsed(\n      acceptedFilesParsed.map((file, fileIdx) => {\n        if (idx === fileIdx) file.config.defaultSession.name = newName\n        return file\n      }),\n    )\n  }\n\n  return (\n    <div className={classes.root}>\n      <Paper className={classes.paper}>\n        <div {...getRootProps({ className: classes.dropZone })}>\n          <input {...getInputProps()} />\n          <CloudUploadIcon className={classes.uploadIcon} fontSize=\"large\" />\n          <Typography color=\"textSecondary\" align=\"center\" variant=\"body1\">\n            Drag and drop files here\n          </Typography>\n          <Typography color=\"textSecondary\" align=\"center\" variant=\"body2\">\n            or\n          </Typography>\n          <Button color=\"primary\" variant=\"contained\">\n            Browse Files\n          </Button>\n        </div>\n      </Paper>\n      {acceptedFilesParsed.length ? (\n        <>\n          <List subheader={<ListSubheader>Files</ListSubheader>}>\n            {acceptedFilesParsed.map((file, idx) => (\n              <ListItem key={file.path}>\n                <ListItemIcon>\n                  {file.config.error ? <ErrorIcon /> : <CheckCircleIcon />}\n                </ListItemIcon>\n                {file.config.error ? (\n                  <Typography color=\"error\" className={classes.listItem}>\n                    {file.config.error}\n                  </Typography>\n                ) : (\n                  <TextField\n                    value={file.config.defaultSession.name}\n                    fullWidth\n                    helperText={file.path}\n                    onChange={event => {\n                      updateConfigName(event.target.value, idx)\n                    }}\n                    className={classes.listItem}\n                  />\n                )}\n                <ListItemSecondaryAction>\n                  <IconButton\n                    onClick={() => {\n                      acceptedFilesParsed.splice(idx, 1)\n                      if (acceptedFilesParsed.length === 0) setErrorMessage('')\n                      setAcceptedFilesParsed(acceptedFilesParsed.map(e => e))\n                    }}\n                    color=\"secondary\"\n                  >\n                    <DeleteIcon />\n                  </IconButton>\n                </ListItemSecondaryAction>\n              </ListItem>\n            ))}\n          </List>\n          <Button\n            color=\"primary\"\n            variant=\"contained\"\n            disabled={Boolean(\n              errorMessage ||\n                acceptedFilesParsed.some(file => file.config.error),\n            )}\n            onClick={importConfigs}\n          >\n            Import\n          </Button>\n        </>\n      ) : null}\n      {errorMessage ? (\n        <>\n          <div className={classes.errorMessage}>\n            <ErrorIcon color=\"error\" fontSize=\"large\" />\n          </div>\n          <div>\n            <Accordion style={{ marginTop: 4 }}>\n              <AccordionSummary\n                expandIcon={<ExpandMoreIcon className={classes.expandIcon} />}\n              >\n                <Typography color=\"error\" align=\"center\">\n                  {acceptedFilesParsed.length === 1\n                    ? 'Import error: File does not appear to be a valid configuration'\n                    : 'Import error: One of the files is likely an invalid configuration. Try importing them one at a time.'}\n                </Typography>\n              </AccordionSummary>\n              <AccordionDetails>\n                <div style={{ overflowX: 'auto' }}>\n                  <Typography color=\"error\" align=\"center\">\n                    {errorMessage}\n                  </Typography>\n                </div>\n              </AccordionDetails>\n            </Accordion>\n          </div>\n        </>\n      ) : null}\n    </div>\n  )\n}\n\nImportConfiguration.propTypes = {\n  addSessions: PropTypes.func.isRequired,\n  setActiveSession: PropTypes.func.isRequired,\n  model: MobxPropTypes.observableObject.isRequired,\n}\n\nexport default observer(ImportConfiguration)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('ImportConfigurationWidget', {})\n\nexport const stateModel = types.model('ImportConfigurationWidget', {\n  id: ElementId,\n  type: types.literal('ImportConfigurationWidget'),\n})\n\nexport { default as ReactComponent } from './components/ImportConfigurationWidget'\n","import Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport IconButton from '@material-ui/core/IconButton'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport ListSubheader from '@material-ui/core/ListSubheader'\nimport Paper from '@material-ui/core/Paper'\nimport Typography from '@material-ui/core/Typography'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport ViewListIcon from '@material-ui/icons/ViewList'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport pluralize from 'pluralize'\n\nimport React, { useState } from 'react'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    margin: theme.spacing(1),\n  },\n  message: {\n    padding: theme.spacing(3),\n  },\n}))\n\nconst AutosaveEntry = observer(({ session }) => {\n  const classes = useStyles()\n  const autosavedSession = JSON.parse(\n    localStorage.getItem(session.previousAutosaveId) || '{}',\n  ).session\n\n  const { views = [] } = autosavedSession || {}\n  const totalTracks = views\n    .map(view => view.tracks.length)\n    .reduce((a, b) => a + b, 0)\n\n  return autosavedSession ? (\n    <Paper className={classes.root}>\n      <List subheader={<ListSubheader>Previous autosaved entry</ListSubheader>}>\n        <ListItem button onClick={() => session.loadAutosaveSession()}>\n          <ListItemIcon>\n            <ViewListIcon />\n          </ListItemIcon>\n          <ListItemText\n            primary={autosavedSession.name}\n            secondary={\n              session.name === autosavedSession.name\n                ? 'Currently open'\n                : `${views.length} ${pluralize(\n                    'view',\n                    views.length,\n                  )}; ${totalTracks}\n                           open ${pluralize('track', totalTracks)}`\n            }\n          />\n        </ListItem>\n      </List>\n    </Paper>\n  ) : null\n})\n\nexport default observer(({ session }) => {\n  const classes = useStyles()\n  const [sessionIndexToDelete, setSessionIndexToDelete] = useState(null)\n  const [open, setOpen] = useState(false)\n\n  function handleDialogOpen(idx) {\n    setSessionIndexToDelete(idx)\n    setOpen(true)\n  }\n\n  function handleDialogClose(deleteSession = false) {\n    if (deleteSession) {\n      session.removeSavedSession(session.savedSessions[sessionIndexToDelete])\n    }\n    setSessionIndexToDelete(null)\n    setOpen(false)\n  }\n\n  const sessionNameToDelete =\n    sessionIndexToDelete !== null\n      ? session.savedSessions[sessionIndexToDelete].name\n      : ''\n\n  return (\n    <>\n      <AutosaveEntry session={session} />\n      <Paper className={classes.root}>\n        <List subheader={<ListSubheader>Saved sessions</ListSubheader>}>\n          {session.savedSessions.length ? (\n            session.savedSessions.map((sessionSnapshot, idx) => {\n              const { views = [] } = sessionSnapshot\n              const totalTracks = views\n                .map(view => view.tracks.length)\n                .reduce((a, b) => a + b, 0)\n              return (\n                <ListItem\n                  button\n                  disabled={session.name === sessionSnapshot.name}\n                  onClick={() => session.activateSession(sessionSnapshot.name)}\n                  key={sessionSnapshot.name}\n                >\n                  <ListItemIcon>\n                    <ViewListIcon />\n                  </ListItemIcon>\n                  <ListItemText\n                    primary={sessionSnapshot.name}\n                    secondary={\n                      session.name === sessionSnapshot.name\n                        ? 'Currently open'\n                        : `${views.length} ${pluralize(\n                            'view',\n                            views.length,\n                          )}; ${totalTracks}\n                           open ${pluralize('track', totalTracks)}`\n                    }\n                  />\n                  <ListItemSecondaryAction>\n                    <IconButton\n                      edge=\"end\"\n                      disabled={session.name === sessionSnapshot.name}\n                      aria-label=\"Delete\"\n                      onClick={() => handleDialogOpen(idx)}\n                    >\n                      <DeleteIcon />\n                    </IconButton>\n                  </ListItemSecondaryAction>\n                </ListItem>\n              )\n            })\n          ) : (\n            <Typography className={classes.message}>\n              No saved sessions found\n            </Typography>\n          )}\n        </List>\n      </Paper>\n      <Dialog\n        open={open}\n        aria-labelledby=\"alert-dialog-title\"\n        aria-describedby=\"alert-dialog-description\"\n      >\n        <DialogTitle id=\"alert-dialog-title\">\n          {`Delete session \"${sessionNameToDelete}\"?`}\n        </DialogTitle>\n        <DialogContent>\n          <DialogContentText id=\"alert-dialog-description\">\n            This action cannot be undone\n          </DialogContentText>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => handleDialogClose()} color=\"primary\">\n            Cancel\n          </Button>\n          <Button\n            onClick={() => handleDialogClose(true)}\n            color=\"primary\"\n            autoFocus\n          >\n            Delete\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  )\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('SessionManager', {})\n\nexport const stateModel = types.model('SessionManager', {\n  id: ElementId,\n  type: types.literal('SessionManager'),\n})\n\nexport { default as ReactComponent } from './components/SessionManager'\n","import WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AbstractSessionModel,\n  SessionWithWidgets,\n  isAbstractMenuManager,\n} from '@jbrowse/core/util'\nimport FileCopyIcon from '@material-ui/icons/FileCopy'\nimport FolderOpenIcon from '@material-ui/icons/FolderOpen'\nimport HelpIcon from '@material-ui/icons/Help'\nimport InfoIcon from '@material-ui/icons/Info'\nimport SaveIcon from '@material-ui/icons/Save'\nimport {\n  configSchema as aboutConfigSchema,\n  ReactComponent as AboutReactComponent,\n  stateModel as aboutStateModel,\n} from './AboutWidget'\nimport {\n  configSchema as helpConfigSchema,\n  ReactComponent as HelpReactComponent,\n  stateModel as helpStateModel,\n} from './HelpWidget'\nimport {\n  configSchema as importConfigurationConfigSchema,\n  ReactComponent as ImportConfigurationReactComponent,\n  stateModel as importConfigurationStateModel,\n} from './ImportConfigurationWidget'\nimport {\n  configSchema as sessionManagerConfigSchema,\n  ReactComponent as SessionManagerReactComponent,\n  stateModel as sessionManagerStateModel,\n} from './SessionManager'\n\nexport default class extends Plugin {\n  name = 'MenusPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'AboutWidget',\n        heading: 'About',\n        configSchema: aboutConfigSchema,\n        stateModel: aboutStateModel,\n        ReactComponent: AboutReactComponent,\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'HelpWidget',\n        heading: 'Help',\n        configSchema: helpConfigSchema,\n        stateModel: helpStateModel,\n        ReactComponent: HelpReactComponent,\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'ImportConfigurationWidget',\n        heading: 'Import Configuration',\n        configSchema: importConfigurationConfigSchema,\n        stateModel: importConfigurationStateModel,\n        ReactComponent: ImportConfigurationReactComponent,\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'SessionManager',\n        heading: 'Sessions',\n        configSchema: sessionManagerConfigSchema,\n        stateModel: sessionManagerStateModel,\n        ReactComponent: SessionManagerReactComponent,\n      })\n    })\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToMenu('Help', {\n        label: 'About',\n        icon: InfoIcon,\n        onClick: (session: SessionWithWidgets) => {\n          const widget = session.addWidget('AboutWidget', 'aboutWidget')\n          session.showWidget(widget)\n        },\n      })\n      pluginManager.rootModel.appendToMenu('Help', {\n        label: 'Help',\n        icon: HelpIcon,\n        onClick: (session: SessionWithWidgets) => {\n          const widget = session.addWidget('HelpWidget', 'helpWidget')\n          session.showWidget(widget)\n        },\n      })\n      pluginManager.rootModel.insertInMenu(\n        'File',\n        {\n          label: 'Open session',\n          icon: FolderOpenIcon,\n          onClick: (session: SessionWithWidgets) => {\n            const widget = session.addWidget('SessionManager', 'sessionManager')\n            session.showWidget(widget)\n          },\n        },\n        1,\n      )\n      pluginManager.rootModel.insertInMenu(\n        'File',\n        {\n          label: 'Save session',\n          icon: SaveIcon,\n          onClick: (session: SessionWithWidgets) => {\n            // @ts-ignore\n            if (session.saveSessionToLocalStorage) {\n              // @ts-ignore\n              session.saveSessionToLocalStorage()\n              // @ts-ignore\n              session.notify(`Saved session \"${session.name}\"`, 'success')\n            }\n          },\n        },\n        1,\n      )\n      pluginManager.rootModel.insertInMenu(\n        'File',\n        {\n          label: 'Duplicate session',\n          icon: FileCopyIcon,\n          onClick: (session: AbstractSessionModel) => {\n            session.duplicateCurrentSession?.()\n          },\n        },\n        1,\n      )\n    }\n  }\n}\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport format from 'string-template'\n\nimport { Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport MyConfigSchema from './configSchema'\n\ninterface SPARQLEntry {\n  type: string\n  value: string\n  dataTypes?: string\n}\n\ninterface SPARQLBinding {\n  [key: string]: SPARQLEntry\n}\n\ninterface SPARQLResponseHead {\n  vars: string[]\n}\n\ninterface SPARQLResponseResults {\n  bindings: SPARQLBinding[]\n}\n\ninterface SPARQLResponse {\n  head: SPARQLResponseHead\n  results: SPARQLResponseResults\n}\n\ninterface SPARQLFeatureData {\n  start: number\n  end: number\n  strand: number\n  subfeatures?: SPARQLFeatureData[]\n  uniqueId: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [propName: string]: any\n}\n\ninterface SPARQLFeature {\n  data: SPARQLFeatureData\n}\n\nexport default class SPARQLAdapter extends BaseFeatureDataAdapter {\n  private endpoint: string\n\n  private queryTemplate: string\n\n  private refNamesQueryTemplate: string\n\n  private additionalQueryParams: string[]\n\n  private configRefNames: string[]\n\n  private refNames: string[] | undefined\n\n  public constructor(config: Instance<typeof MyConfigSchema>) {\n    super(config)\n    this.endpoint = readConfObject(config, 'endpoint').uri\n    this.queryTemplate = readConfObject(config, 'queryTemplate')\n    this.additionalQueryParams = readConfObject(config, 'additionalQueryParams')\n    this.refNamesQueryTemplate = readConfObject(config, 'refNamesQueryTemplate')\n    this.configRefNames = readConfObject(config, 'refNames')\n  }\n\n  public async getRefNames(opts: BaseOptions = {}): Promise<string[]> {\n    if (this.refNames) return this.refNames\n    let refNames = [] as string[]\n    if (this.refNamesQueryTemplate) {\n      const queryTemplate = encodeURIComponent(this.refNamesQueryTemplate)\n      const results = await this.querySparql(queryTemplate, opts)\n      refNames = this.resultsToRefNames(results)\n    } else if (this.configRefNames) {\n      refNames = this.configRefNames\n    }\n    this.refNames = refNames\n    return refNames\n  }\n\n  public getFeatures(query: NoAssemblyRegion, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const filledTemplate = encodeURIComponent(\n        format(this.queryTemplate, query),\n      )\n      const { refName } = query\n      const results = await this.querySparql(filledTemplate, opts)\n      this.resultsToFeatures(results, refName).forEach(feature => {\n        observer.next(feature)\n      })\n      observer.complete()\n    }, opts.signal)\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private async querySparql(query: string, opts?: BaseOptions): Promise<any> {\n    let additionalQueryParams = ''\n    if (this.additionalQueryParams.length)\n      additionalQueryParams = `&${this.additionalQueryParams.join('&')}`\n    const signal = opts && opts.signal\n    const response = await fetch(\n      `${this.endpoint}?query=${query}${additionalQueryParams}`,\n      {\n        headers: { accept: 'application/json,application/sparql-results+json' },\n        signal,\n      },\n    )\n    return response.json()\n  }\n\n  private resultsToRefNames(response: SPARQLResponse): string[] {\n    const rows = ((response || {}).results || {}).bindings || []\n    if (!rows.length) return []\n    const fields = response.head.vars\n    if (!fields.includes('refName'))\n      throw new Error('\"refName\" not found in refNamesQueryTemplate response')\n    return rows.map(row => row.refName.value)\n  }\n\n  private resultsToFeatures(\n    results: SPARQLResponse,\n    refName: string,\n  ): SimpleFeature[] {\n    const rows = ((results || {}).results || {}).bindings || []\n    if (!rows.length) return []\n    const fields = results.head.vars\n    const requiredFields = ['start', 'end', 'uniqueId']\n    requiredFields.forEach(requiredField => {\n      if (!fields.includes(requiredField))\n        console.error(\n          `Required field ${requiredField} missing from feature data`,\n        )\n    })\n    const seenFeatures: Record<string, SPARQLFeature> = {}\n    rows.forEach(row => {\n      const rawData: Record<string, string>[] = [{}]\n      fields.forEach(field => {\n        if (field in row) {\n          const { value } = row[field]\n          let idx = 0\n          while (field.startsWith('sub_')) {\n            field = field.slice(4)\n            idx += 1\n          }\n          while (idx > rawData.length - 1) rawData.push({})\n          rawData[idx][field] = value\n        }\n      })\n\n      rawData.forEach((rd, idx) => {\n        const { uniqueId } = rd\n        if (idx < rawData.length - 1) rawData[idx + 1].parentUniqueId = uniqueId\n        seenFeatures[uniqueId] = {\n          data: {\n            ...rd,\n            uniqueId,\n            refName,\n            start: parseInt(rd.start, 10),\n            end: parseInt(rd.end, 10),\n            strand: parseInt(rd.strand, 10) || 0,\n          },\n        }\n      })\n    })\n\n    // resolve subfeatures, keeping only top-level features in seenFeatures\n    for (const [uniqueId, f] of Object.entries(seenFeatures)) {\n      const pid = f.data.parentUniqueId\n      delete f.data.parentUniqueId\n      if (pid) {\n        const p = seenFeatures[pid]\n        if (p) {\n          if (!p.data.subfeatures) p.data.subfeatures = []\n          p.data.subfeatures.push({\n            ...f.data,\n            uniqueId,\n          })\n          delete seenFeatures[uniqueId]\n        } else {\n          const subfeatures = Object.values(seenFeatures)\n            .map(sf => sf.data.subfeatures)\n            .filter(sf => !!sf)\n            .flat()\n          let found = false\n          for (const subfeature of subfeatures) {\n            if (subfeature && subfeature.uniqueId === pid) {\n              if (!subfeature.subfeatures) subfeature.subfeatures = []\n              subfeature.subfeatures.push({\n                ...f.data,\n                uniqueId,\n              })\n              delete seenFeatures[uniqueId]\n              found = true\n              break\n            } else if (subfeature && subfeature.subfeatures) {\n              subfeatures.push(...subfeature.subfeatures)\n            }\n          }\n          if (!found) console.error(`Could not find parentID ${pid}`)\n        }\n      }\n    }\n\n    return Object.keys(seenFeatures).map(\n      seenFeature =>\n        new SimpleFeature({\n          ...seenFeatures[seenFeature].data,\n          uniqueId: seenFeature,\n          subfeatures: seenFeatures[seenFeature].data.subfeatures,\n        }),\n    )\n  }\n\n  public async hasDataForRefName(\n    refName: string,\n    opts: BaseOptions = {},\n  ): Promise<boolean> {\n    const refNames = await this.getRefNames(opts)\n    if (refNames.length && !refNames.includes(refName)) return false\n    return true\n  }\n\n  public freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'SPARQLAdapter',\n  {\n    endpoint: {\n      type: 'fileLocation',\n      defaultValue: { uri: 'https://somesite.com/sparql' },\n      description: 'URL of the SPARQL endpoint',\n    },\n    queryTemplate: {\n      type: 'text',\n      defaultValue: '',\n      description:\n        'SPARQL query where {start} {end} and {refName} will get replaced for each call',\n    },\n    refNamesQueryTemplate: {\n      type: 'text',\n      defaultValue: '',\n      description:\n        'SPARQL query that returns the possible refNames in a ?refName column',\n    },\n    refNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Possible refNames used by the SPARQL endpoint (ignored if \"refNamesQueryTemplate\" is provided)',\n    },\n    additionalQueryParams: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Additional parameters to add to the query, e.g. \"format=JSON\"',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AdapterClass as SPARQLAdapterClass,\n  configSchema as sparqlAdapterConfigSchema,\n} from './SPARQLAdapter'\n\nexport default class RdfPlugin extends Plugin {\n  name = 'RdfPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'SPARQLAdapter',\n          configSchema: sparqlAdapterConfigSchema,\n          AdapterClass: SPARQLAdapterClass,\n        }),\n    )\n  }\n}\n","import { IndexedFasta } from '@gmod/indexedfasta'\nimport {\n  BaseFeatureDataAdapter,\n  RegionsAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { FileLocation, NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport AbortablePromiseCache from 'abortable-promise-cache'\nimport LRU from '@jbrowse/core/util/QuickLRU'\n\nexport default class extends BaseFeatureDataAdapter implements RegionsAdapter {\n  protected fasta: typeof IndexedFasta\n\n  private seqCache = new AbortablePromiseCache({\n    cache: new LRU({ maxSize: 200 }),\n    fill: async (\n      args: { refName: string; start: number; end: number },\n      // abortSignal?: AbortSignal,\n    ) => {\n      const { refName, start, end } = args\n      return this.fasta.getSequence(refName, start, end)\n    },\n  })\n\n  public constructor(config: AnyConfigurationModel) {\n    super(config)\n    const fastaLocation = readConfObject(config, 'fastaLocation')\n    const faiLocation = readConfObject(config, 'faiLocation')\n    if (!fastaLocation) {\n      throw new Error('must provide fastaLocation')\n    }\n    if (!faiLocation) {\n      throw new Error('must provide faiLocation')\n    }\n    const fastaOpts = {\n      fasta: openLocation(fastaLocation as FileLocation),\n      fai: openLocation(faiLocation as FileLocation),\n    }\n\n    this.fasta = new IndexedFasta(fastaOpts)\n  }\n\n  public getRefNames() {\n    return this.fasta.getSequenceList()\n  }\n\n  public async getRegions(): Promise<NoAssemblyRegion[]> {\n    const seqSizes = await this.fasta.getSequenceSizes()\n    return Object.keys(seqSizes).map(\n      (refName: string): NoAssemblyRegion => ({\n        refName,\n        start: 0,\n        end: seqSizes[refName],\n      }),\n    )\n  }\n\n  /**\n   * Fetch features for a certain region\n   * @param param -\n   * @returns Observable of Feature objects in the region\n   */\n  public getFeatures({ refName, start, end }: NoAssemblyRegion) {\n    return ObservableCreate<Feature>(async observer => {\n      const size = await this.fasta.getSequenceSize(refName)\n      const regionEnd = size !== undefined ? Math.min(size, end) : end\n      const chunks = []\n      const chunkSize = 128000\n\n      const s = start - (start % chunkSize)\n      const e = end + (chunkSize - (end % chunkSize))\n      for (let chunkStart = s; chunkStart < e; chunkStart += chunkSize) {\n        const r = {\n          refName,\n          start: chunkStart,\n          end: chunkStart + chunkSize,\n        }\n        chunks.push(this.seqCache.get(JSON.stringify(r), r))\n      }\n      const seq = (await Promise.all(chunks))\n        .join('')\n        .slice(start - s)\n        .slice(0, end - start)\n      if (seq) {\n        observer.next(\n          new SimpleFeature({\n            id: `${refName} ${start}-${regionEnd}`,\n            data: { refName, start, end: regionEnd, seq },\n          }),\n        )\n      }\n      observer.complete()\n    })\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the forseeable future and can be purged\n   * from caches, etc\n   */\n  public freeResources(/* { region } */): void {}\n}\n","import { BgzipIndexedFasta } from '@gmod/indexedfasta'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport IndexedFasta from '../IndexedFastaAdapter/IndexedFastaAdapter'\nimport MyConfigSchema from './configSchema'\n\nexport default class extends IndexedFasta {\n  public constructor(config: Instance<typeof MyConfigSchema>) {\n    super(config)\n    const fastaLocation = readConfObject(config, 'fastaLocation')\n    const faiLocation = readConfObject(config, 'faiLocation')\n    const gziLocation = readConfObject(config, 'gziLocation')\n    if (!fastaLocation) {\n      throw new Error('must provide fastaLocation')\n    }\n    if (!faiLocation) {\n      throw new Error('must provide faiLocation')\n    }\n    if (!gziLocation) {\n      throw new Error('must provide gziLocation')\n    }\n    const fastaOpts = {\n      fasta: openLocation(fastaLocation as FileLocation),\n      fai: openLocation(faiLocation as FileLocation),\n      gzi: openLocation(gziLocation as FileLocation),\n    }\n\n    this.fasta = new BgzipIndexedFasta(fastaOpts)\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'BgzipFastaAdapter',\n  {\n    fastaLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.gz' },\n    },\n    faiLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.gz.fai' },\n    },\n    gziLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.gz.gzi' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import {\n  BaseFeatureDataAdapter,\n  RegionsAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { GenericFilehandle } from 'generic-filehandle'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport MyConfigSchema from './configSchema'\n\nexport default class extends BaseFeatureDataAdapter implements RegionsAdapter {\n  // the map of refSeq to length\n  protected refSeqs: Promise<Record<string, number>>\n\n  protected source: string\n\n  public constructor(config: Instance<typeof MyConfigSchema>) {\n    super(config)\n    const chromSizesLocation = readConfObject(config, 'chromSizesLocation')\n    if (!chromSizesLocation) {\n      throw new Error('must provide chromSizesLocation')\n    }\n    const file = openLocation(chromSizesLocation as FileLocation)\n    this.source = file.toString()\n    this.refSeqs = this.init(file)\n  }\n\n  private async init(file: GenericFilehandle) {\n    const data = (await file.readFile('utf8')) as string\n    const refSeqs: { [key: string]: number } = {}\n    if (!data.length) {\n      throw new Error(`Could not read file ${file.toString()}`)\n    }\n    data.split('\\n').forEach((line: string) => {\n      if (line.length) {\n        const [name, length] = line.split('\\t')\n        refSeqs[name] = +length\n      }\n    })\n    return refSeqs\n  }\n\n  public async getRefNames() {\n    return Object.keys(await this.refSeqs)\n  }\n\n  public async getRegions() {\n    const refSeqs = await this.refSeqs\n    return Object.keys(refSeqs).map(refName => ({\n      refName,\n      start: 0,\n      end: refSeqs[refName],\n    }))\n  }\n\n  public getFeatures() {\n    return ObservableCreate<Feature>(observer => {\n      // provides no sequence\n      observer.complete()\n    })\n  }\n\n  public freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'ChromSizesAdapter',\n  {\n    chromSizesLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/species.chrom.sizes' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","/* eslint-disable no-nested-ternary,@typescript-eslint/no-explicit-any,no-return-assign */\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { contrastingTextColor } from '@jbrowse/core/util/color'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { Region } from '@jbrowse/core/util/types'\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport React from 'react'\nimport { bpSpanPx } from '@jbrowse/core/util'\n\ninterface MyProps {\n  features: Map<string, Feature>\n  regions: Region[]\n  bpPerPx: number\n  config: AnyConfigurationModel\n  highResolutionScaling: number\n  theme: any\n  showForward: boolean\n  showReverse: boolean\n  showTranslation: boolean\n}\n\nfunction revcom(seqString: string) {\n  return complement(seqString).split('').reverse().join('')\n}\n\nconst complement = (() => {\n  const complementRegex = /[ACGT]/gi\n\n  // from bioperl: tr/acgtrymkswhbvdnxACGTRYMKSWHBVDNX/tgcayrkmswdvbhnxTGCAYRKMSWDVBHNX/\n  // generated with:\n  // perl -MJSON -E '@l = split \"\",\"acgtrymkswhbvdnxACGTRYMKSWHBVDNX\"; print to_json({ map { my $in = $_; tr/acgtrymkswhbvdnxACGTRYMKSWHBVDNX/tgcayrkmswdvbhnxTGCAYRKMSWDVBHNX/; $in => $_ } @l})'\n  const complementTable = {\n    S: 'S',\n    w: 'w',\n    T: 'A',\n    r: 'y',\n    a: 't',\n    N: 'N',\n    K: 'M',\n    x: 'x',\n    d: 'h',\n    Y: 'R',\n    V: 'B',\n    y: 'r',\n    M: 'K',\n    h: 'd',\n    k: 'm',\n    C: 'G',\n    g: 'c',\n    t: 'a',\n    A: 'T',\n    n: 'n',\n    W: 'W',\n    X: 'X',\n    m: 'k',\n    v: 'b',\n    B: 'V',\n    s: 's',\n    H: 'D',\n    c: 'g',\n    D: 'H',\n    b: 'v',\n    R: 'Y',\n    G: 'C',\n  } as { [key: string]: string }\n\n  return (seqString: string) => {\n    return seqString.replace(complementRegex, m => complementTable[m] || '')\n  }\n})()\n\nconst defaultStarts = ['ATG']\nconst defaultStops = ['TAA', 'TAG', 'TGA']\nconst defaultCodonTable = {\n  TCA: 'S',\n  TCC: 'S',\n  TCG: 'S',\n  TCT: 'S',\n  TTC: 'F',\n  TTT: 'F',\n  TTA: 'L',\n  TTG: 'L',\n  TAC: 'Y',\n  TAT: 'Y',\n  TAA: '*',\n  TAG: '*',\n  TGC: 'C',\n  TGT: 'C',\n  TGA: '*',\n  TGG: 'W',\n  CTA: 'L',\n  CTC: 'L',\n  CTG: 'L',\n  CTT: 'L',\n  CCA: 'P',\n  CCC: 'P',\n  CCG: 'P',\n  CCT: 'P',\n  CAC: 'H',\n  CAT: 'H',\n  CAA: 'Q',\n  CAG: 'Q',\n  CGA: 'R',\n  CGC: 'R',\n  CGG: 'R',\n  CGT: 'R',\n  ATA: 'I',\n  ATC: 'I',\n  ATT: 'I',\n  ATG: 'M',\n  ACA: 'T',\n  ACC: 'T',\n  ACG: 'T',\n  ACT: 'T',\n  AAC: 'N',\n  AAT: 'N',\n  AAA: 'K',\n  AAG: 'K',\n  AGC: 'S',\n  AGT: 'S',\n  AGA: 'R',\n  AGG: 'R',\n  GTA: 'V',\n  GTC: 'V',\n  GTG: 'V',\n  GTT: 'V',\n  GCA: 'A',\n  GCC: 'A',\n  GCG: 'A',\n  GCT: 'A',\n  GAC: 'D',\n  GAT: 'D',\n  GAA: 'E',\n  GAG: 'E',\n  GGA: 'G',\n  GGC: 'G',\n  GGG: 'G',\n  GGT: 'G',\n}\n\n/**\n *  take CodonTable above and generate larger codon table that includes\n *  all permutations of upper and lower case nucleotides\n */\nfunction generateCodonTable(table: any) {\n  const tempCodonTable: { [key: string]: string } = {}\n  Object.keys(table).forEach(codon => {\n    const aa = table[codon]\n    const nucs: string[][] = []\n    for (let i = 0; i < 3; i++) {\n      const nuc = codon.charAt(i)\n      nucs[i] = []\n      nucs[i][0] = nuc.toUpperCase()\n      nucs[i][1] = nuc.toLowerCase()\n    }\n    for (let i = 0; i < 2; i++) {\n      const n0 = nucs[0][i]\n      for (let j = 0; j < 2; j++) {\n        const n1 = nucs[1][j]\n        for (let k = 0; k < 2; k++) {\n          const n2 = nucs[2][k]\n          const triplet = n0 + n1 + n2\n          tempCodonTable[triplet] = aa\n        }\n      }\n    }\n  })\n  return tempCodonTable\n}\n\nfunction Translation(props: {\n  codonTable: any\n  seq: string\n  frame: number\n  bpPerPx: number\n  region: Region\n  reverse?: boolean\n  height: number\n  y: number\n  theme?: any\n}) {\n  const {\n    codonTable,\n    seq,\n    frame,\n    bpPerPx,\n    region,\n    height,\n    y,\n    reverse = false,\n    theme,\n  } = props\n  const scale = bpPerPx\n\n  // the tilt variable normalizes the frame to where we are starting from,\n  // which increases consistency across blocks\n  const tilt = 3 - (region.start % 3)\n\n  // the effectiveFrame incorporates tilt and the frame to say what the\n  // effective frame that is plotted. The +3 is for when frame is -2 and this\n  // can otherwise result in effectiveFrame -1\n  const effectiveFrame = (frame + tilt + 3) % 3\n\n  const seqSliced = seq.slice(effectiveFrame)\n\n  const translated: { letter: string; codon: string }[] = []\n  for (let i = 0; i < seqSliced.length; i += 3) {\n    const codon = seqSliced.slice(i, i + 3)\n    const normalizedCodon = reverse ? revcom(codon) : codon\n    const aminoAcid = codonTable[normalizedCodon] || ''\n    translated.push({ letter: aminoAcid, codon: normalizedCodon.toUpperCase() })\n  }\n\n  const w = (1 / scale) * 3\n  const drop = region.start === 0 ? 0 : w\n  const render = 1 / bpPerPx >= 12\n  const width = (region.end - region.start) / bpPerPx\n\n  const map = ['#d8d8d8', '#adadad', '#8f8f8f'].reverse()\n  return (\n    <>\n      {translated.map((element, index) => {\n        const x = region.reversed\n          ? width - (w * (index + 1) + effectiveFrame / scale - drop)\n          : w * index + effectiveFrame / scale - drop\n        const { letter, codon } = element\n        return (\n          <React.Fragment key={`${index}-${letter}`}>\n            <rect\n              x={x}\n              y={y}\n              width={\n                render ? w : w + 0.7 /* small fudge factor when zoomed out*/\n              }\n              height={height}\n              stroke={render ? '#555' : 'none'}\n              fill={\n                defaultStarts.includes(codon)\n                  ? theme.palette.startCodon\n                  : defaultStops.includes(codon)\n                  ? theme.palette.stopCodon\n                  : map[Math.abs(frame)]\n              }\n            />\n            {render ? (\n              <text\n                x={x + w / 2}\n                y={y + height / 2}\n                dominantBaseline=\"middle\"\n                textAnchor=\"middle\"\n              >\n                {letter}\n              </text>\n            ) : null}\n          </React.Fragment>\n        )\n      })}\n    </>\n  )\n}\n\nfunction DNA(props: {\n  seq: string\n  theme: any\n  bpPerPx: number\n  height: number\n  region: Region\n  feature: Feature\n  y: number\n}) {\n  const { bpPerPx, region, feature, theme, height, seq, y } = props\n  const render = 1 / bpPerPx >= 12\n\n  const [leftPx, rightPx] = bpSpanPx(\n    feature.get('start'),\n    feature.get('end'),\n    region,\n    bpPerPx,\n  )\n  const reverse = region.reversed\n  const len = feature.get('end') - feature.get('start')\n  const w = Math.max((rightPx - leftPx) / len, 0.8)\n\n  return (\n    <>\n      {seq.split('').map((letter, index) => {\n        // @ts-ignore\n        const color = theme.palette.bases[letter.toUpperCase()]\n        const x = reverse ? rightPx - (index + 1) * w : leftPx + index * w\n        return (\n          <React.Fragment key={index}>\n            <rect\n              x={x}\n              y={y}\n              width={w}\n              height={height}\n              fill={color ? color.main : '#aaa'}\n              stroke={render ? '#555' : 'none'}\n            />\n            {render ? (\n              <text\n                x={x + w / 2}\n                y={y + height / 2}\n                dominantBaseline=\"middle\"\n                textAnchor=\"middle\"\n                fill={color ? contrastingTextColor(color.main) : 'black'}\n              >\n                {letter}\n              </text>\n            ) : null}\n          </React.Fragment>\n        )\n      })}\n    </>\n  )\n}\n\nfunction Sequence(props: MyProps) {\n  const {\n    features = new Map(),\n    regions,\n    bpPerPx,\n    theme: configTheme,\n    showForward = true,\n    showReverse = true,\n    showTranslation = true,\n  } = props\n  const theme = createJBrowseTheme(configTheme)\n  const [region] = regions\n  const width = (region.end - region.start) / bpPerPx\n  const totalHeight = 200\n  const codonTable = generateCodonTable(defaultCodonTable)\n  const height = 20\n\n  const [feature] = [...features.values()]\n  if (!feature) {\n    return null\n  }\n  const seq: string = feature.get('seq')\n  if (!seq) {\n    return null\n  }\n\n  // incrementer for the y-position of the current sequence being rendered\n  // (applies to both translation rows and dna rows)\n  let currY = -20\n\n  return (\n    <svg\n      width={width}\n      height={totalHeight}\n      style={{ width, height: totalHeight }}\n    >\n      {/* the upper translation row. if the view is reversed, the reverse\n        translation is on the top */}\n      {showTranslation && (region.reversed ? showReverse : showForward)\n        ? [2, 1, 0].map(index => (\n            <Translation\n              key={`translation-${index}`}\n              seq={seq}\n              y={(currY += 20)}\n              codonTable={codonTable}\n              frame={index}\n              bpPerPx={bpPerPx}\n              region={region}\n              theme={theme}\n              height={height}\n              reverse={region.reversed}\n            />\n          ))\n        : null}\n\n      {showForward ? (\n        <DNA\n          height={height}\n          y={(currY += 20)}\n          feature={feature}\n          region={region}\n          seq={region.reversed ? complement(seq) : seq}\n          bpPerPx={bpPerPx}\n          theme={theme}\n        />\n      ) : null}\n\n      {showReverse ? (\n        <DNA\n          height={height}\n          y={(currY += 20)}\n          feature={feature}\n          region={region}\n          seq={region.reversed ? seq : complement(seq)}\n          bpPerPx={bpPerPx}\n          theme={theme}\n        />\n      ) : null}\n\n      {/* the lower translation row. if the view is reversed, the forward\n        translation is on the bottom */}\n      {showTranslation && (region.reversed ? showForward : showReverse)\n        ? [0, -1, -2].map(index => (\n            <Translation\n              key={`rev-translation-${index}`}\n              seq={seq}\n              y={(currY += 20)}\n              codonTable={codonTable}\n              frame={index}\n              bpPerPx={bpPerPx}\n              region={region}\n              theme={theme}\n              height={height}\n              reverse={!region.reversed}\n            />\n          ))\n        : null}\n    </svg>\n  )\n}\n\nexport default observer(Sequence)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'DivSequenceRenderer',\n  {\n    height: {\n      type: 'number',\n      description: 'height in pixels of each line of sequence',\n      defaultValue: 16,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'IndexedFastaAdapter',\n  {\n    fastaLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa' },\n    },\n    faiLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.fai' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { configSchema as divSequenceRendererConfigSchema } from '../DivSequenceRenderer'\n\nexport const configSchema = ConfigurationSchema(\n  'LinearReferenceSequenceDisplay',\n  { renderer: divSequenceRendererConfigSchema },\n  { explicitIdentifier: 'displayId', explicitlyTyped: true },\n)\n","import {\n  BaseFeatureDataAdapter,\n  RegionsAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { TwoBitFile } from '@gmod/twobit'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\n\nimport configSchema from './configSchema'\n\nexport default class TwoBitAdapter\n  extends BaseFeatureDataAdapter\n  implements RegionsAdapter {\n  private twobit: typeof TwoBitFile\n\n  constructor(config: Instance<typeof configSchema>) {\n    super(config)\n    const twoBitOpts = {\n      filehandle: openLocation(readConfObject(config, 'twoBitLocation')),\n    }\n\n    this.twobit = new TwoBitFile(twoBitOpts)\n  }\n\n  public getRefNames() {\n    return this.twobit.getSequenceNames()\n  }\n\n  public async getRegions(): Promise<NoAssemblyRegion[]> {\n    const refSizes = await this.twobit.getSequenceSizes()\n    return Object.keys(refSizes).map(\n      (refName: string): NoAssemblyRegion => ({\n        refName,\n        start: 0,\n        end: refSizes[refName],\n      }),\n    )\n  }\n\n  /**\n   * Fetch features for a certain region\n   * @param param -\n   * @returns Observable of Feature objects in the region\n   */\n  public getFeatures({ refName, start, end }: NoAssemblyRegion) {\n    return ObservableCreate<Feature>(async observer => {\n      const size = await this.twobit.getSequenceSize(refName)\n      const regionEnd = size !== undefined ? Math.min(size, end) : end\n      const seq: string = await this.twobit.getSequence(\n        refName,\n        start,\n        regionEnd,\n      )\n      if (seq) {\n        observer.next(\n          new SimpleFeature({\n            id: `${refName} ${start}-${regionEnd}`,\n            data: { refName, start, end: regionEnd, seq },\n          }),\n        )\n      }\n      observer.complete()\n    })\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the forseeable future and can be purged\n   * from caches, etc\n   */\n  public freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'TwoBitAdapter',\n  {\n    twoBitLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.2bit' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport { Region } from '@jbrowse/core/util/types'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport ServerSideRendererType from '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport {\n  AdapterClass as BgzipFastaAdapterClass,\n  configSchema as bgzipFastaAdapterConfigSchema,\n} from './BgzipFastaAdapter'\nimport {\n  AdapterClass as ChromSizesAdapterClass,\n  configSchema as chromSizesAdapterConfigSchema,\n} from './ChromSizesAdapter'\nimport {\n  configSchema as divSequenceRendererConfigSchema,\n  ReactComponent as DivSequenceRendererReactComponent,\n} from './DivSequenceRenderer'\nimport {\n  AdapterClass as IndexedFastaAdapterClass,\n  configSchema as indexedFastaAdapterConfigSchema,\n} from './IndexedFastaAdapter'\nimport {\n  configSchema as linearReferenceSequenceDisplayConfigSchema,\n  modelFactory as linearReferenceSequenceDisplayModelFactory,\n} from './LinearReferenceSequenceDisplay'\nimport {\n  AdapterClass as TwoBitAdapterClass,\n  configSchema as twoBitAdapterConfigSchema,\n} from './TwoBitAdapter'\nimport { createReferenceSeqTrackConfig } from './referenceSeqTrackConfig'\n\n/* adjust in both directions */\nclass DivSequenceRenderer extends ServerSideRendererType {\n  getExpandedRegion(region: Region) {\n    return {\n      ...region,\n      start: Math.max(region.start - 3, 0),\n      end: region.end + 3,\n    }\n  }\n}\n\nexport default class SequencePlugin extends Plugin {\n  name = 'SequencePlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'TwoBitAdapter',\n          configSchema: twoBitAdapterConfigSchema,\n          AdapterClass: TwoBitAdapterClass,\n        }),\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'ChromSizesAdapter',\n          configSchema: chromSizesAdapterConfigSchema,\n          AdapterClass: ChromSizesAdapterClass,\n        }),\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'IndexedFastaAdapter',\n          configSchema: indexedFastaAdapterConfigSchema,\n          AdapterClass: IndexedFastaAdapterClass,\n        }),\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BgzipFastaAdapter',\n          configSchema: bgzipFastaAdapterConfigSchema,\n          AdapterClass: BgzipFastaAdapterClass,\n        }),\n    )\n\n    pluginManager.addTrackType(() => {\n      const configSchema = createReferenceSeqTrackConfig(pluginManager)\n\n      return new TrackType({\n        name: 'ReferenceSequenceTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'ReferenceSequenceTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addDisplayType(() => {\n      const stateModel = linearReferenceSequenceDisplayModelFactory(\n        linearReferenceSequenceDisplayConfigSchema,\n      )\n      return {\n        name: 'LinearReferenceSequenceDisplay',\n        configSchema: linearReferenceSequenceDisplayConfigSchema,\n        stateModel,\n        trackType: 'ReferenceSequenceTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      }\n    })\n\n    pluginManager.addRendererType(\n      () =>\n        new DivSequenceRenderer({\n          name: 'DivSequenceRenderer',\n          ReactComponent: DivSequenceRendererReactComponent,\n          configSchema: divSequenceRendererConfigSchema,\n        }),\n    )\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/*\nNote: this is primarily a copy of createBaseTrackConfig, except with a subset\nof the config slots, to avoid including fields that don't make sense for the\nReferenceSequenceTrack\n*/\nexport function createReferenceSeqTrackConfig(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'ReferenceSequenceTrack',\n    {\n      adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      displays: types.array(pluginManager.pluggableConfigSchemaType('display')),\n      metadata: {\n        type: 'frozen',\n        description: 'anything to add about this track',\n        defaultValue: {},\n      },\n    },\n    {\n      preProcessSnapshot: s => {\n        const snap = JSON.parse(JSON.stringify(s))\n        const displayTypes = new Set()\n        const { displays = [] } = snap\n        if (snap.trackId !== 'placeholderId') {\n          // Gets the displays on the track snapshot and the possible displays\n          // from the track type and adds any missing possible displays to the\n          // snapshot\n          displays.forEach((d: any) => d && displayTypes.add(d.type))\n          const trackType = pluginManager.getTrackType(snap.type)\n          trackType.displayTypes.forEach(displayType => {\n            if (!displayTypes.has(displayType.name)) {\n              displays.push({\n                displayId: `${snap.trackId}-${displayType.name}`,\n                type: displayType.name,\n              })\n            }\n          })\n        }\n        return { ...snap, displays }\n      },\n      explicitIdentifier: 'trackId',\n      explicitlyTyped: true,\n      actions: (self: any) => ({\n        addDisplayConf(displayConf: { type: string; displayId: string }) {\n          const { type } = displayConf\n          if (!type) throw new Error(`unknown display type ${type}`)\n          const display = self.displays.find(\n            (d: any) => d && d.displayId === displayConf.displayId,\n          )\n          if (display) {\n            return display\n          }\n          const length = self.displays.push(displayConf)\n          return self.displays[length - 1]\n        },\n      }),\n    },\n  )\n}\n","import { types } from 'mobx-state-tree'\nimport {\n  BaseLinearDisplay,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { AnyConfigurationSchemaType } from '@jbrowse/core/configuration/configurationSchema'\nimport { getContainingView } from '@jbrowse/core/util'\n\nexport function modelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearReferenceSequenceDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearReferenceSequenceDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        showForward: types.optional(types.boolean, true),\n        showReverse: types.optional(types.boolean, true),\n        showTranslation: types.optional(types.boolean, true),\n        height: 180,\n      }),\n    )\n    .views(self => ({\n      get renderProps() {\n        const { showForward, showReverse, showTranslation } = self\n        return {\n          ...self.composedRenderProps,\n          ...getParentRenderProps(self),\n          config: self.configuration.renderer,\n          showForward,\n          showReverse,\n          showTranslation,\n        }\n      },\n      regionCannotBeRendered(/* region */) {\n        const view = getContainingView(self) as LinearGenomeViewModel\n        if (view && view.bpPerPx >= 1) {\n          return 'Zoom in to see sequence'\n        }\n        return undefined\n      },\n\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n    }))\n    .actions(self => ({\n      toggleShowForward() {\n        self.showForward = !self.showForward\n      },\n      toggleShowReverse() {\n        self.showReverse = !self.showReverse\n      },\n      toggleShowTranslation() {\n        self.showTranslation = !self.showTranslation\n      },\n    }))\n    .views(self => ({\n      get trackMenuItems() {\n        return [\n          {\n            label: 'Show forward',\n            type: 'checkbox',\n            checked: self.showForward,\n            onClick: () => {\n              self.toggleShowForward()\n            },\n          },\n          {\n            label: 'Show reverse',\n            type: 'checkbox',\n            checked: self.showReverse,\n            onClick: () => {\n              self.toggleShowReverse()\n            },\n          },\n          {\n            label: 'Show translation',\n            type: 'checkbox',\n            checked: self.showTranslation,\n            onClick: () => {\n              self.toggleShowTranslation()\n            },\n          },\n        ]\n      },\n    }))\n}\n","import { inDevelopment } from '..'\n\ninterface AbsoluteCache {\n  dirty: boolean\n  left?: number\n  right?: number\n  top?: number\n  bottom?: number\n  width?: number\n  height?: number\n}\n\nexport default class SceneGraph {\n  private name: string\n\n  public left: number\n\n  public top: number\n\n  public width: number\n\n  public height: number\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public data?: Record<string, any>\n\n  private children: Map<string, SceneGraph>\n\n  private absoluteCache: AbsoluteCache\n\n  public parent?: SceneGraph\n\n  /**\n   * note: all coordinates are inter-base or inter-pixel coordinates\n   */\n  constructor(\n    name: string,\n    left: number,\n    top: number,\n    width: number,\n    height: number,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    data?: Record<string, any>,\n  ) {\n    if (\n      inDevelopment &&\n      (typeof name !== 'string' ||\n        typeof left !== 'number' ||\n        Number.isNaN(left) ||\n        typeof top !== 'number' ||\n        Number.isNaN(top) ||\n        typeof width !== 'number' ||\n        Number.isNaN(width) ||\n        typeof height !== 'number' ||\n        Number.isNaN(height))\n    ) {\n      throw new TypeError('invalid SceneGraph arguments')\n    }\n\n    this.name = name\n    this.left = left\n    this.top = top\n    this.width = width\n    this.height = height\n    this.data = data\n    this.children = new Map()\n    this.absoluteCache = { dirty: true }\n  }\n\n  addChild(\n    nameOrSceneGraph: string | SceneGraph,\n    left: number,\n    top: number,\n    width: number,\n    height: number,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    data?: Record<string, any>,\n  ): SceneGraph {\n    let child: SceneGraph\n    if (nameOrSceneGraph instanceof SceneGraph) child = nameOrSceneGraph\n    else\n      child = new SceneGraph(nameOrSceneGraph, left, top, width, height, data)\n\n    if (!(child instanceof SceneGraph)) {\n      throw new TypeError(\n        'argument to addChild must be an array or a SceneGraph',\n      )\n    }\n\n    if (this.children.has(child.name))\n      throw new Error(`child named \"${child.name}\" already exists`)\n\n    // update the bounds to match the child\n    child.parent = this\n    const {\n      left: childLeft,\n      right: childRight,\n      top: childTop,\n      bottom: childBottom,\n    } = child.absolute\n    if (\n      childLeft !== undefined &&\n      childRight !== undefined &&\n      childTop !== undefined &&\n      childBottom !== undefined\n    ) {\n      this.expand(childLeft, childRight, childTop, childBottom)\n      this.children.set(child.name, child)\n    }\n    return child\n  }\n\n  getSubRecord(name: string): SceneGraph | undefined {\n    return this.children.get(name)\n  }\n\n  /**\n   * if the record does not already cover the given\n   * absolute extents, extend it to cover them\n   *\n   * @param left -\n   * @param right -\n   * @param top -\n   * @param bottom -\n   */\n  expand(\n    newLeft: number,\n    newRight: number,\n    newTop: number,\n    newBottom: number,\n  ): void {\n    const { left, right, top, bottom } = this.absolute\n    if (left !== undefined && newLeft < left) {\n      const diff = left - newLeft\n      this.width += diff\n      this.left -= diff\n    }\n    if (right !== undefined && newRight > right) {\n      this.width += newRight - right\n    }\n    if (top !== undefined && newTop < top) {\n      const diff = top - newTop\n      this.height += diff\n      this.top -= diff\n    }\n    if (bottom !== undefined && newBottom > bottom) {\n      this.height += newBottom - bottom\n    }\n    if (this.parent) this.parent.expand(newLeft, newRight, newTop, newBottom)\n    this.absoluteCache.dirty = true\n  }\n\n  get bottom(): number {\n    return this.top + this.height\n  }\n\n  get right(): number {\n    return this.left + this.width\n  }\n\n  walkParents(callback: Function): void {\n    if (this.parent) {\n      callback(this.parent)\n      this.parent.walkParents(callback)\n    }\n  }\n\n  walkChildren(callback: Function): void {\n    for (const sub of this.children.values()) {\n      callback(sub)\n      sub.walkChildren(callback)\n    }\n  }\n\n  get absolute(): AbsoluteCache {\n    if (this.absoluteCache.dirty) {\n      let xOffset = 0\n      let yOffset = 0\n      this.walkParents((node: SceneGraph) => {\n        xOffset += node.left\n        yOffset += node.top\n      })\n      this.absoluteCache = {\n        dirty: false,\n        left: this.left + xOffset,\n        right: this.right + xOffset,\n        top: this.top + yOffset,\n        bottom: this.bottom + yOffset,\n        width: this.width,\n        height: this.height,\n      }\n    }\n    return this.absoluteCache\n  }\n\n  move(x: number, y: number): void {\n    this.left += x\n    this.top += y\n\n    this.absoluteCache.dirty = true\n    this.walkChildren((c: SceneGraph) => {\n      c.absoluteCache.dirty = true\n    })\n    const { left, right, top, bottom } = this.absolute\n    if (\n      left !== undefined &&\n      right !== undefined &&\n      top !== undefined &&\n      bottom !== undefined\n    ) {\n      this.expand(left, right, top, bottom)\n    }\n  }\n}\n","import React from 'react'\n\nexport default function Label(props: {\n  text: string\n  x: number\n  y: number\n  color?: string\n  fontHeight?: number\n  featureWidth?: number\n  allowedWidthExpansion?: number\n  reversed?: boolean\n  fontWidthScaleFactor?: number\n}) {\n  const {\n    text,\n    x,\n    y,\n    color = 'black',\n    fontHeight = 13,\n    featureWidth,\n    reversed,\n    allowedWidthExpansion,\n    fontWidthScaleFactor = 0.6,\n  } = props\n\n  const fontWidth = fontHeight * fontWidthScaleFactor\n  const totalWidth =\n    featureWidth && allowedWidthExpansion\n      ? featureWidth + allowedWidthExpansion\n      : Infinity\n\n  return (\n    <text\n      x={reversed ? x + (featureWidth || 0) - fontWidth * text.length : x}\n      y={y}\n      style={{ fontSize: fontHeight, fill: color, cursor: 'default' }}\n      dominantBaseline=\"hanging\"\n    >\n      {fontWidth * text.length > totalWidth\n        ? `${text.slice(0, totalWidth / fontWidth)}...`\n        : text}\n    </text>\n  )\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { observer } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport FeatureLabel from './FeatureLabel'\n\nfunction FeatureGlyph(props) {\n  const {\n    feature,\n    rootLayout,\n    selected,\n    config,\n    name,\n    shouldShowName,\n    description,\n    shouldShowDescription,\n    fontHeight,\n    allowedWidthExpansion,\n    reversed,\n  } = props\n\n  const featureLayout = rootLayout.getSubRecord(String(feature.id()))\n  const { GlyphComponent } = featureLayout.data\n\n  const glyphComponents = [\n    <GlyphComponent\n      key={`glyph-${feature.id()}`}\n      {...props}\n      feature={feature}\n      featureLayout={featureLayout}\n      selected={selected}\n    />,\n  ]\n\n  if (shouldShowName) {\n    glyphComponents.push(\n      <FeatureLabel\n        key={`glyph-name-${feature.id()}`}\n        text={name}\n        x={rootLayout.getSubRecord('nameLabel').absolute.left}\n        y={rootLayout.getSubRecord('nameLabel').absolute.top}\n        color={readConfObject(config, ['labels', 'nameColor'], [feature])}\n        fontHeight={fontHeight}\n        reversed={reversed}\n        featureWidth={featureLayout.width}\n        allowedWidthExpansion={allowedWidthExpansion}\n      />,\n    )\n  }\n\n  if (shouldShowDescription) {\n    glyphComponents.push(\n      <FeatureLabel\n        key={`glyph-description-${feature.id()}`}\n        text={description}\n        x={rootLayout.getSubRecord('descriptionLabel').absolute.left}\n        y={rootLayout.getSubRecord('descriptionLabel').absolute.top}\n        color={readConfObject(\n          config,\n          ['labels', 'descriptionColor'],\n          [feature],\n        )}\n        fontHeight={fontHeight}\n        featureWidth={featureLayout.width}\n        reversed={reversed}\n        allowedWidthExpansion={allowedWidthExpansion}\n      />,\n    )\n  }\n\n  return <g>{glyphComponents}</g>\n}\n\nFeatureGlyph.propTypes = {\n  feature: PropTypes.shape({\n    id: PropTypes.func.isRequired,\n    get: PropTypes.func.isRequired,\n  }).isRequired,\n  layout: PropTypes.shape({\n    addRect: PropTypes.func.isRequired,\n    getTotalHeight: PropTypes.func.isRequired,\n  }).isRequired,\n  rootLayout: PropTypes.shape({\n    addChild: PropTypes.func.isRequired,\n    getSubRecord: PropTypes.func.isRequired,\n  }).isRequired,\n  region: CommonPropTypes.Region.isRequired,\n  bpPerPx: PropTypes.number.isRequired,\n  reversed: PropTypes.bool,\n  selected: PropTypes.bool,\n  config: CommonPropTypes.ConfigSchema.isRequired,\n  name: PropTypes.string,\n  shouldShowName: PropTypes.bool,\n  description: PropTypes.string,\n  shouldShowDescription: PropTypes.bool,\n  fontHeight: PropTypes.number,\n  allowedWidthExpansion: PropTypes.number,\n  movedDuringLastMouseDown: PropTypes.bool.isRequired,\n}\n\nFeatureGlyph.defaultProps = {\n  reversed: false,\n  selected: false,\n  name: '',\n  shouldShowName: false,\n  description: '',\n  shouldShowDescription: false,\n  fontHeight: undefined,\n  allowedWidthExpansion: undefined,\n}\n\nexport default observer(FeatureGlyph)\n","import { bpSpanPx } from '@jbrowse/core/util'\nimport SimpleFeature from '@jbrowse/core/util/simpleFeature'\nimport { Region } from '@jbrowse/core/util/types'\nimport { observer } from 'mobx-react'\nimport React from 'react'\n\ntype LayoutRecord = [number, number, number, number]\ninterface SvgOverlayProps {\n  region: Region\n  displayModel: {\n    blockLayoutFeatures: Map<string, Map<string, LayoutRecord>>\n    selectedFeatureId?: string\n    featureIdUnderMouse?: string\n    contextMenuFeature?: SimpleFeature\n  }\n  bpPerPx: number\n  blockKey: string\n  movedDuringLastMouseDown: boolean\n  onFeatureMouseDown?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseEnter?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseOut?(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n    featureId: string,\n  ): {}\n  onFeatureMouseOver?(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n    featureId: string,\n  ): {}\n  onFeatureMouseUp?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseLeave?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseMove?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  // synthesized from mouseup and mousedown\n  onFeatureClick?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureContextMenu?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n}\n\ninterface OverlayRectProps extends React.SVGProps<SVGRectElement> {\n  rect?: LayoutRecord\n  region: Region\n  bpPerPx: number\n}\n\nfunction OverlayRect({\n  rect,\n  region,\n  bpPerPx,\n  ...rectProps\n}: OverlayRectProps) {\n  if (!rect) {\n    return null\n  }\n  const [leftBp, topPx, rightBp, bottomPx] = rect\n  const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n  const rectTop = Math.round(topPx)\n  const screenWidth = (region.end - region.start) / bpPerPx\n  const rectHeight = Math.round(bottomPx - topPx)\n  const width = rightPx - leftPx\n\n  if (leftPx + width < 0) {\n    return null\n  }\n  const leftWithinBlock = Math.max(leftPx, 0)\n  const diff = leftWithinBlock - leftPx\n  const widthWithinBlock = Math.max(1, Math.min(width - diff, screenWidth))\n\n  return (\n    <rect\n      x={leftWithinBlock - 2}\n      y={rectTop - 2}\n      width={widthWithinBlock + 4}\n      height={rectHeight + 4}\n      {...rectProps}\n    />\n  )\n}\n\nfunction SvgOverlay({\n  displayModel: {\n    blockLayoutFeatures,\n    selectedFeatureId,\n    featureIdUnderMouse,\n    contextMenuFeature,\n  },\n  blockKey,\n  region,\n  bpPerPx,\n  movedDuringLastMouseDown,\n  ...handlers\n}: SvgOverlayProps) {\n  const blockLayout = blockLayoutFeatures?.get(blockKey)\n  if (!blockLayout) {\n    return null\n  }\n  const mouseoverFeatureId = featureIdUnderMouse || contextMenuFeature?.id()\n\n  function onFeatureMouseDown(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseDown: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseEnter(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseEnter: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseOut(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n  ) {\n    const { onFeatureMouseOut: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseOver(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n  ) {\n    const { onFeatureMouseOver: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseUp(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseUp: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseLeave(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseLeave: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseMove(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseMove: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureClick(event: React.MouseEvent<SVGRectElement, MouseEvent>) {\n    if (movedDuringLastMouseDown) return undefined\n    const { onFeatureClick: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    event.stopPropagation()\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureContextMenu(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureContextMenu: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    event.stopPropagation()\n    return handler(event, mouseoverFeatureId)\n  }\n\n  return (\n    <>\n      {mouseoverFeatureId ? (\n        <OverlayRect\n          rect={blockLayout.get(mouseoverFeatureId)}\n          region={region}\n          bpPerPx={bpPerPx}\n          fill=\"#000\"\n          fillOpacity=\"0.2\"\n          onMouseDown={onFeatureMouseDown}\n          onMouseEnter={onFeatureMouseEnter}\n          onMouseOut={onFeatureMouseOut}\n          onMouseOver={onFeatureMouseOver}\n          onMouseUp={onFeatureMouseUp}\n          onMouseLeave={onFeatureMouseLeave}\n          onMouseMove={onFeatureMouseMove}\n          onClick={onFeatureClick}\n          onContextMenu={onFeatureContextMenu}\n          onFocus={onFeatureMouseOver}\n          onBlur={onFeatureMouseOut}\n          data-testid={mouseoverFeatureId}\n        />\n      ) : null}\n      {selectedFeatureId ? (\n        <OverlayRect\n          rect={blockLayout.get(selectedFeatureId)}\n          region={region}\n          bpPerPx={bpPerPx}\n          stroke=\"#00b8ff\"\n          fill=\"none\"\n        />\n      ) : null}\n    </>\n  )\n}\n\nexport default observer(SvgOverlay)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { emphasize } from '@jbrowse/core/util/color'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\n\nfunction Box(props) {\n  const { feature, region, config, featureLayout, selected, bpPerPx } = props\n  const screenWidth = (region.end - region.start) / bpPerPx\n\n  const color1 = readConfObject(config, 'color1', [feature])\n  let emphasizedColor1\n  try {\n    emphasizedColor1 = emphasize(color1, 0.3)\n  } catch (error) {\n    emphasizedColor1 = color1\n  }\n  const color2 = readConfObject(config, 'color2', [feature])\n\n  const { left, top, width, height } = featureLayout.absolute\n\n  if (left + width < 0) {\n    return null\n  }\n  const leftWithinBlock = Math.max(left, 0)\n  const diff = leftWithinBlock - left\n  const widthWithinBlock = Math.max(1, Math.min(width - diff, screenWidth))\n\n  return (\n    <rect\n      data-testid={`box-${feature.id()}`}\n      x={leftWithinBlock}\n      y={top}\n      width={widthWithinBlock}\n      height={height}\n      fill={selected ? emphasizedColor1 : color1}\n      stroke={selected ? color2 : undefined}\n    />\n  )\n}\n\nBox.propTypes = {\n  feature: ReactPropTypes.shape({\n    get: ReactPropTypes.func.isRequired,\n    id: ReactPropTypes.func.isRequired,\n  }).isRequired,\n  region: CommonPropTypes.Region.isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  featureLayout: ReactPropTypes.shape({\n    absolute: ReactPropTypes.shape({\n      top: ReactPropTypes.number.isRequired,\n      left: ReactPropTypes.number.isRequired,\n      width: ReactPropTypes.number.isRequired,\n      height: ReactPropTypes.number.isRequired,\n    }),\n  }).isRequired,\n  selected: ReactPropTypes.bool,\n  config: CommonPropTypes.ConfigSchema.isRequired,\n}\n\nBox.defaultProps = {\n  selected: false,\n}\n\nexport default observer(Box)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { emphasize } from '@jbrowse/core/util/color'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\nimport { isUTR } from './util'\n\nconst utrHeightFraction = 0.65\n\nfunction Chevron(props) {\n  const {\n    feature,\n    bpPerPx,\n    region,\n    config,\n    featureLayout,\n    selected,\n    reversed,\n  } = props\n\n  const screenWidth = (region.end - region.start) / bpPerPx\n  const width = Math.max(featureLayout.absolute.width, 1)\n  const { left } = featureLayout.absolute\n  let { top, height } = featureLayout.absolute\n  if (isUTR(feature)) {\n    top += ((1 - utrHeightFraction) / 2) * height\n    height *= utrHeightFraction\n  }\n\n  const strand = feature.get('strand')\n  const direction = strand * (reversed ? -1 : 1)\n  const color = isUTR(feature)\n    ? readConfObject(config, 'color3', [feature])\n    : readConfObject(config, 'color1', [feature])\n  let emphasizedColor\n  try {\n    emphasizedColor = emphasize(color, 0.3)\n  } catch (error) {\n    emphasizedColor = color\n  }\n  const color2 = readConfObject(config, 'color2', [feature])\n\n  if (left + width < 0) {\n    return null\n  }\n  const leftWithinBlock = Math.max(left, 0)\n  const diff = leftWithinBlock - left\n  const widthWithinBlock = Math.max(1, Math.min(width - diff, screenWidth))\n\n  return (\n    <>\n      <rect\n        data-testid={feature.id()}\n        stroke={selected ? color2 : undefined}\n        fill={selected ? emphasizedColor : color}\n        x={leftWithinBlock}\n        y={top}\n        width={widthWithinBlock}\n        height={height}\n      />\n      {direction < 0 && diff === 0 ? (\n        <polygon\n          stroke={selected ? color2 : undefined}\n          fill={selected ? emphasizedColor : color}\n          points={[\n            [left, top],\n            [left - height / 2, top + height / 2],\n            [left, top + height],\n          ]}\n        />\n      ) : null}\n      {direction > 0 && leftWithinBlock + widthWithinBlock < screenWidth ? (\n        <polygon\n          stroke={selected ? color2 : undefined}\n          fill={selected ? emphasizedColor : color}\n          points={[\n            [leftWithinBlock + widthWithinBlock, top],\n            [leftWithinBlock + widthWithinBlock + height / 2, top + height / 2],\n            [leftWithinBlock + widthWithinBlock, top + height],\n          ]}\n        />\n      ) : null}\n    </>\n  )\n}\n\nChevron.propTypes = {\n  feature: ReactPropTypes.shape({\n    id: ReactPropTypes.func.isRequired,\n    get: ReactPropTypes.func.isRequired,\n  }).isRequired,\n  region: CommonPropTypes.Region.isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  featureLayout: ReactPropTypes.shape({\n    absolute: ReactPropTypes.shape({\n      top: ReactPropTypes.number.isRequired,\n      left: ReactPropTypes.number.isRequired,\n      width: ReactPropTypes.number.isRequired,\n      height: ReactPropTypes.number.isRequired,\n    }),\n  }).isRequired,\n  selected: ReactPropTypes.bool,\n  config: CommonPropTypes.ConfigSchema.isRequired,\n  reversed: ReactPropTypes.bool,\n}\n\nChevron.defaultProps = {\n  selected: false,\n  reversed: false,\n}\n\nexport default observer(Chevron)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { emphasize } from '@jbrowse/core/util/color'\nimport { observer } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React from 'react'\n\nfunction Segments(props) {\n  const { feature, featureLayout, selected, config, reversed } = props\n\n  const color2 = readConfObject(config, 'color2', [feature])\n  let emphasizedColor2\n  try {\n    emphasizedColor2 = emphasize(color2, 0.3)\n  } catch (error) {\n    emphasizedColor2 = color2\n  }\n  const { left, top, width, height } = featureLayout.absolute\n  const points = [\n    [left, top + height / 2],\n    [left + width, top + height / 2],\n  ]\n  const strand = feature.get('strand')\n  if (strand)\n    points.push(\n      [left + width - height / 4, top + height / 4],\n      [left + width - height / 4, top + 3 * (height / 4)],\n      [left + width, top + height / 2],\n    )\n\n  return (\n    <>\n      <polyline\n        data-testid={feature.id()}\n        transform={\n          strand && ((!reversed && strand < 0) || (reversed && strand > 0))\n            ? `rotate(180,${left + width / 2},${top + height / 2})`\n            : undefined\n        }\n        points={points}\n        stroke={selected ? emphasizedColor2 : color2}\n      />\n      {feature.get('subfeatures').map(subfeature => {\n        const subfeatureId = String(subfeature.id())\n        const subfeatureLayout = featureLayout.getSubRecord(subfeatureId)\n        // This subfeature got filtered out\n        if (!subfeatureLayout) return null\n        const { GlyphComponent } = subfeatureLayout.data\n        return (\n          <GlyphComponent\n            key={`glyph-${subfeatureId}`}\n            {...props}\n            feature={subfeature}\n            featureLayout={subfeatureLayout}\n            selected={selected}\n          />\n        )\n      })}\n    </>\n  )\n}\n\nSegments.propTypes = {\n  feature: PropTypes.shape({\n    id: PropTypes.func.isRequired,\n    get: PropTypes.func.isRequired,\n  }).isRequired,\n  featureLayout: PropTypes.shape({\n    absolute: PropTypes.shape({\n      top: PropTypes.number.isRequired,\n      left: PropTypes.number.isRequired,\n      width: PropTypes.number.isRequired,\n      height: PropTypes.number.isRequired,\n    }),\n    getSubRecord: PropTypes.func.isRequired,\n  }).isRequired,\n  selected: PropTypes.bool,\n  config: CommonPropTypes.ConfigSchema.isRequired,\n  reversed: PropTypes.bool,\n}\n\nSegments.defaultProps = {\n  selected: false,\n  reversed: false,\n}\n\nexport default observer(Segments)\n","import { observer } from 'mobx-react'\nimport React from 'react'\nimport Segments from './Segments'\nimport { layOutFeature, layOutSubfeatures } from './util'\n\nfunction ProcessedTranscript(props) {\n  return <Segments {...props} />\n}\n\nProcessedTranscript.layOut = ({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n}) => {\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n  })\n  const subfeatures = (feature.get('subfeatures') || []).filter(subfeature =>\n    ['CDS', 'UTR', 'five_prime_UTR', 'three_prime_UTR'].includes(\n      subfeature.get('type'),\n    ),\n  )\n  layOutSubfeatures({\n    layout: subLayout,\n    subfeatures,\n    bpPerPx,\n    reversed,\n    config,\n  })\n  return subLayout\n}\n\nexport default observer(ProcessedTranscript)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { observer } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport { chooseGlyphComponent, layOut, layOutFeature } from './util'\n\nfunction Subfeatures(props) {\n  const { feature, featureLayout, selected } = props\n\n  return (\n    <>\n      {feature.get('subfeatures').map(subfeature => {\n        const subfeatureId = String(subfeature.id())\n        const subfeatureLayout = featureLayout.getSubRecord(subfeatureId)\n        const { GlyphComponent } = subfeatureLayout.data\n        return (\n          <GlyphComponent\n            key={`glyph-${subfeatureId}`}\n            {...props}\n            feature={subfeature}\n            featureLayout={subfeatureLayout}\n            selected={selected}\n          />\n        )\n      })}\n    </>\n  )\n}\n\nSubfeatures.propTypes = {\n  feature: PropTypes.shape({ get: PropTypes.func.isRequired }).isRequired,\n  featureLayout: PropTypes.shape({\n    getSubRecord: PropTypes.func.isRequired,\n  }).isRequired,\n  selected: PropTypes.bool,\n  reversed: PropTypes.bool,\n}\n\nSubfeatures.defaultProps = {\n  selected: false,\n  reversed: false,\n}\n\nSubfeatures.layOut = ({ layout, feature, bpPerPx, reversed, config }) => {\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n  })\n  const displayMode = readConfObject(config, 'displayMode')\n  if (displayMode !== 'reducedRepresentation') {\n    const subfeatures = feature.get('subfeatures') || []\n    let topOffset = 0\n    subfeatures.forEach(subfeature => {\n      const SubfeatureGlyphComponent = chooseGlyphComponent(subfeature)\n      const subfeatureHeight = readConfObject(config, 'height', [subfeature])\n\n      const subSubLayout = (SubfeatureGlyphComponent.layOut || layOut)({\n        layout: subLayout,\n        feature: subfeature,\n        bpPerPx,\n        reversed,\n        config,\n      })\n      subSubLayout.move(0, topOffset)\n      topOffset +=\n        (displayMode === 'compact' ? subfeatureHeight / 3 : subfeatureHeight) +\n        2\n    })\n  }\n  return subLayout\n}\n\nexport default observer(Subfeatures)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport SceneGraph from '@jbrowse/core/util/layouts/SceneGraph'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport Box from './Box'\nimport Chevron from './Chevron'\nimport ProcessedTranscript from './ProcessedTranscript'\nimport Segments from './Segments'\nimport Subfeatures from './Subfeatures'\n\ninterface Glyph extends React.FunctionComponent {\n  layOut?: Function\n}\n\nexport function chooseGlyphComponent(feature: Feature): Glyph {\n  const subfeatures = feature.get('subfeatures')\n  let hasSubSub = false\n  if (subfeatures) {\n    subfeatures.forEach((subfeature: Feature) => {\n      if (subfeature.get('subfeatures')) hasSubSub = true\n    })\n    if (hasSubSub) return Subfeatures\n    const type = feature.get('type')\n    if (\n      ['mRNA', 'transcript'].includes(type) &&\n      subfeatures.find((f: Feature) => f.get('type') === 'CDS')\n    )\n      return ProcessedTranscript\n    return Segments\n  }\n  const strand = feature.get('strand')\n  if ([1, -1].includes(strand)) return Chevron\n  return Box\n}\n\ninterface BaseLayOutArgs {\n  layout: SceneGraph\n  bpPerPx: number\n  reversed: boolean\n  config: AnyConfigurationModel\n}\n\ninterface FeatureLayOutArgs extends BaseLayOutArgs {\n  feature: Feature\n}\n\ninterface SubfeatureLayOutArgs extends BaseLayOutArgs {\n  subfeatures: Feature[]\n}\n\nexport function layOut({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n}: FeatureLayOutArgs): SceneGraph {\n  const displayMode = readConfObject(config, 'displayMode')\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n  })\n  if (displayMode !== 'reducedRepresentation') {\n    layOutSubfeatures({\n      layout: subLayout,\n      subfeatures: feature.get('subfeatures') || [],\n      bpPerPx,\n      reversed,\n      config,\n    })\n  }\n  return subLayout\n}\n\nexport function layOutFeature(args: FeatureLayOutArgs): SceneGraph {\n  const { layout, feature, bpPerPx, reversed, config } = args\n  const displayMode = readConfObject(config, 'displayMode')\n  const GlyphComponent =\n    displayMode === 'reducedRepresentation'\n      ? Chevron\n      : chooseGlyphComponent(feature)\n  const parentFeature = feature.parent()\n  let x = 0\n  if (parentFeature)\n    x = reversed\n      ? (parentFeature.get('end') - feature.get('end')) / bpPerPx\n      : (feature.get('start') - parentFeature.get('start')) / bpPerPx\n  const height = readConfObject(config, 'height', [feature])\n  const width = (feature.get('end') - feature.get('start')) / bpPerPx\n  const layoutParent = layout.parent\n  const top = layoutParent ? layoutParent.top : 0\n  const subLayout = layout.addChild(\n    String(feature.id()),\n    x,\n    displayMode === 'collapse' ? 0 : top,\n    width,\n    displayMode === 'compact' ? height / 3 : height,\n    { GlyphComponent },\n  )\n  return subLayout\n}\n\nexport function layOutSubfeatures(args: SubfeatureLayOutArgs): void {\n  const { layout: subLayout, subfeatures, bpPerPx, reversed, config } = args\n  subfeatures.forEach((subfeature: Feature) => {\n    const SubfeatureGlyphComponent = chooseGlyphComponent(subfeature)\n    ;(SubfeatureGlyphComponent.layOut || layOut)({\n      layout: subLayout,\n      feature: subfeature,\n      bpPerPx,\n      reversed,\n      config,\n    })\n  })\n}\n\nexport function isUTR(feature: Feature): boolean {\n  return /(\\bUTR|_UTR|untranslated[_\\s]region)\\b/.test(\n    feature.get('type') || '',\n  )\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { bpToPx } from '@jbrowse/core/util'\nimport SceneGraph from '@jbrowse/core/util/layouts/SceneGraph'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React, { useEffect, useRef, useState, useCallback } from 'react'\nimport FeatureGlyph from './FeatureGlyph'\nimport SvgOverlay from './SvgOverlay'\nimport { chooseGlyphComponent, layOut } from './util'\n\nconst fontWidthScaleFactor = 0.6\nconst renderingStyle = {\n  position: 'relative',\n}\n\nfunction RenderedFeatureGlyph(props) {\n  const { feature, bpPerPx, region, config, displayMode, layout } = props\n  const { reversed } = region\n  const start = feature.get(reversed ? 'end' : 'start')\n  const startPx = bpToPx(start, region, bpPerPx)\n  const labelsAllowed = displayMode !== 'compact' && displayMode !== 'collapsed'\n\n  const rootLayout = new SceneGraph('root', 0, 0, 0, 0)\n  const GlyphComponent = chooseGlyphComponent(feature)\n  const featureLayout = (GlyphComponent.layOut || layOut)({\n    layout: rootLayout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n  })\n  let shouldShowName\n  let shouldShowDescription\n  let name\n  let description\n  let fontHeight\n  let expansion\n  if (labelsAllowed) {\n    fontHeight = readConfObject(config, ['labels', 'fontSize'], ['feature'])\n    expansion = readConfObject(config, 'maxFeatureGlyphExpansion') || 0\n    name = readConfObject(config, ['labels', 'name'], [feature]) || ''\n    shouldShowName = /\\S/.test(name)\n\n    description =\n      readConfObject(config, ['labels', 'description'], [feature]) || ''\n    shouldShowDescription = /\\S/.test(description)\n    const fontWidth = fontHeight * fontWidthScaleFactor\n    const textVerticalPadding = 2\n\n    let nameWidth = 0\n    if (shouldShowName) {\n      nameWidth = Math.round(\n        Math.min(name.length * fontWidth, rootLayout.width + expansion),\n      )\n      rootLayout.addChild(\n        'nameLabel',\n        0,\n        featureLayout.bottom + textVerticalPadding,\n        nameWidth,\n        fontHeight,\n      )\n    }\n\n    let descriptionWidth = 0\n    if (shouldShowDescription) {\n      const aboveLayout = shouldShowName\n        ? rootLayout.getSubRecord('nameLabel')\n        : featureLayout\n      descriptionWidth = Math.round(\n        Math.min(description.length * fontWidth, rootLayout.width + expansion),\n      )\n      rootLayout.addChild(\n        'descriptionLabel',\n        0,\n        aboveLayout.bottom + textVerticalPadding,\n        descriptionWidth,\n        fontHeight,\n      )\n    }\n  }\n\n  const topPx = layout.addRect(\n    feature.id(),\n    feature.get('start'),\n    feature.get('start') + rootLayout.width * bpPerPx,\n    rootLayout.height,\n  )\n  if (topPx === null) {\n    return null\n  }\n  rootLayout.move(startPx, topPx)\n\n  return (\n    <FeatureGlyph\n      key={`svg-feature-${feature.id()}`}\n      feature={feature}\n      layout={layout}\n      rootLayout={rootLayout}\n      bpPerPx={bpPerPx}\n      config={config}\n      name={name}\n      shouldShowName={shouldShowName}\n      description={description}\n      shouldShowDescription={shouldShowDescription}\n      fontHeight={fontHeight}\n      allowedWidthExpansion={expansion}\n      reversed={region.reversed}\n      {...props}\n    />\n  )\n}\n\nRenderedFeatureGlyph.propTypes = {\n  layout: ReactPropTypes.shape({\n    addRect: ReactPropTypes.func.isRequired,\n    getTotalHeight: ReactPropTypes.func.isRequired,\n  }).isRequired,\n\n  displayMode: ReactPropTypes.string.isRequired,\n  region: CommonPropTypes.Region.isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  feature: ReactPropTypes.shape({\n    id: ReactPropTypes.func.isRequired,\n    get: ReactPropTypes.func.isRequired,\n  }).isRequired,\n  config: CommonPropTypes.ConfigSchema.isRequired,\n}\n\nconst RenderedFeatures = observer(props => {\n  const { features } = props\n  const featuresRendered = []\n  for (const feature of features.values()) {\n    featuresRendered.push(\n      <RenderedFeatureGlyph key={feature.id()} feature={feature} {...props} />,\n    )\n  }\n  return <>{featuresRendered}</>\n})\nRenderedFeatures.propTypes = {\n  features: ReactPropTypes.oneOfType([\n    ReactPropTypes.instanceOf(Map),\n    ReactPropTypes.arrayOf(ReactPropTypes.shape()),\n  ]),\n  layout: ReactPropTypes.shape({\n    addRect: ReactPropTypes.func.isRequired,\n    getTotalHeight: ReactPropTypes.func.isRequired,\n  }).isRequired,\n}\n\nRenderedFeatures.defaultProps = {\n  features: [],\n}\n\nfunction SvgFeatureRendering(props) {\n  const {\n    layout,\n    blockKey,\n    regions,\n    bpPerPx,\n    features,\n    config,\n    displayModel,\n  } = props\n  const [region] = regions || []\n  const width = (region.end - region.start) / bpPerPx\n  const displayMode = readConfObject(config, 'displayMode')\n\n  const ref = useRef()\n  const [mouseIsDown, setMouseIsDown] = useState(false)\n  const [movedDuringLastMouseDown, setMovedDuringLastMouseDown] = useState(\n    false,\n  )\n  const [height, setHeight] = useState(0)\n  const {\n    onMouseOut,\n    onMouseDown,\n    onMouseLeave,\n    onMouseEnter,\n    onMouseOver,\n    onMouseMove,\n    onMouseUp,\n    onClick,\n    onContextMenu,\n  } = props\n\n  const mouseDown = useCallback(\n    event => {\n      setMouseIsDown(true)\n      setMovedDuringLastMouseDown(false)\n      const handler = onMouseDown\n      if (!handler) return undefined\n      return handler(event)\n    },\n    [onMouseDown],\n  )\n\n  const mouseUp = useCallback(\n    event => {\n      setMouseIsDown(false)\n      const handler = onMouseUp\n      if (!handler) return undefined\n      return handler(event)\n    },\n    [onMouseUp],\n  )\n\n  const mouseEnter = useCallback(\n    event => {\n      const handler = onMouseEnter\n      if (!handler) return undefined\n      return handler(event)\n    },\n    [onMouseEnter],\n  )\n\n  const mouseLeave = useCallback(\n    event => {\n      const handler = onMouseLeave\n      if (!handler) return undefined\n      return handler(event)\n    },\n    [onMouseLeave],\n  )\n\n  const mouseOver = useCallback(\n    event => {\n      const handler = onMouseOver\n      if (!handler) return undefined\n      return handler(event)\n    },\n    [onMouseOver],\n  )\n\n  const mouseOut = useCallback(\n    event => {\n      const handler = onMouseOut\n      if (!handler) return undefined\n      return handler(event)\n    },\n    [onMouseOut],\n  )\n\n  const mouseMove = useCallback(\n    event => {\n      if (mouseIsDown) {\n        setMovedDuringLastMouseDown(true)\n      }\n      let offsetX = 0\n      let offsetY = 0\n      if (ref.current) {\n        offsetX = ref.current.getBoundingClientRect().left\n        offsetY = ref.current.getBoundingClientRect().top\n      }\n      offsetX = event.clientX - offsetX\n      offsetY = event.clientY - offsetY\n      const px = region.reversed ? width - offsetX : offsetX\n      const clientBp = region.start + bpPerPx * px\n\n      const feats = displayModel.getFeatureOverlapping(\n        blockKey,\n        clientBp,\n        offsetY,\n      )\n      const featureIdCurrentlyUnderMouse = feats.length\n        ? feats[0].name\n        : undefined\n\n      if (onMouseMove) {\n        onMouseMove(event, featureIdCurrentlyUnderMouse)\n      }\n    },\n    [\n      blockKey,\n      bpPerPx,\n      mouseIsDown,\n      onMouseMove,\n      region.reversed,\n      region.start,\n      displayModel,\n      width,\n    ],\n  )\n\n  const click = useCallback(\n    event => {\n      // don't select a feature if we are clicking and dragging\n      if (movedDuringLastMouseDown) {\n        return\n      }\n      if (onClick) {\n        onClick(event)\n      }\n    },\n    [movedDuringLastMouseDown, onClick],\n  )\n\n  const contextMenu = useCallback(\n    event => {\n      if (movedDuringLastMouseDown) {\n        return\n      }\n      if (onContextMenu) {\n        onContextMenu(event)\n      }\n    },\n    [movedDuringLastMouseDown, onContextMenu],\n  )\n\n  useEffect(() => {\n    setHeight(layout.getTotalHeight())\n  }, [layout])\n\n  return (\n    <div style={renderingStyle}>\n      <svg\n        ref={ref}\n        className=\"SvgFeatureRendering\"\n        width={`${width}px`}\n        height={`${height}px`}\n        onMouseDown={mouseDown}\n        onMouseUp={mouseUp}\n        onMouseEnter={mouseEnter}\n        onMouseLeave={mouseLeave}\n        onMouseOver={mouseOver}\n        onMouseOut={mouseOut}\n        onMouseMove={mouseMove}\n        onFocus={mouseEnter}\n        onBlur={mouseLeave}\n        onClick={click}\n        onContextMenu={contextMenu}\n        style={{ display: 'block' }}\n      >\n        <RenderedFeatures\n          features={features}\n          displayMode={displayMode}\n          {...props}\n          region={region}\n          movedDuringLastMouseDown={movedDuringLastMouseDown}\n        />\n        <SvgOverlay {...props} region={region} />\n      </svg>\n    </div>\n  )\n}\n\nSvgFeatureRendering.propTypes = {\n  layout: ReactPropTypes.shape({\n    addRect: ReactPropTypes.func.isRequired,\n    getTotalHeight: ReactPropTypes.func.isRequired,\n  }).isRequired,\n\n  regions: ReactPropTypes.arrayOf(CommonPropTypes.Region).isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  features: ReactPropTypes.oneOfType([\n    ReactPropTypes.instanceOf(Map),\n    ReactPropTypes.arrayOf(ReactPropTypes.shape()),\n  ]),\n  config: CommonPropTypes.ConfigSchema.isRequired,\n  displayModel: ReactPropTypes.shape({\n    configuration: ReactPropTypes.shape({}),\n    getFeatureOverlapping: ReactPropTypes.func,\n    selectedFeatureId: ReactPropTypes.string,\n    featureIdUnderMouse: ReactPropTypes.string,\n  }),\n\n  onMouseDown: ReactPropTypes.func,\n  onMouseUp: ReactPropTypes.func,\n  onMouseEnter: ReactPropTypes.func,\n  onMouseLeave: ReactPropTypes.func,\n  onMouseOver: ReactPropTypes.func,\n  onMouseOut: ReactPropTypes.func,\n  onMouseMove: ReactPropTypes.func,\n  onClick: ReactPropTypes.func,\n  onContextMenu: ReactPropTypes.func,\n  onFeatureClick: ReactPropTypes.func,\n  onFeatureContextMenu: ReactPropTypes.func,\n  blockKey: ReactPropTypes.string,\n}\n\nSvgFeatureRendering.defaultProps = {\n  displayModel: {},\n\n  features: new Map(),\n  blockKey: undefined,\n\n  onMouseDown: undefined,\n  onMouseUp: undefined,\n  onMouseEnter: undefined,\n  onMouseLeave: undefined,\n  onMouseOver: undefined,\n  onMouseOut: undefined,\n  onMouseMove: undefined,\n  onClick: undefined,\n  onContextMenu: undefined,\n  onFeatureClick: undefined,\n  onFeatureContextMenu: undefined,\n}\n\nexport default observer(SvgFeatureRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'SvgFeatureRenderer',\n  {\n    color1: {\n      type: 'color',\n      description: 'the main color of each feature',\n      defaultValue: 'goldenrod',\n      functionSignature: ['feature'],\n    },\n    color2: {\n      type: 'color',\n      description:\n        'the secondary color of each feature, used for connecting lines, etc',\n      defaultValue: 'black',\n      functionSignature: ['feature'],\n    },\n    color3: {\n      type: 'color',\n      description:\n        'the tertiary color of each feature, often used for contrasting fills, like on UTRs',\n      defaultValue: '#357089',\n      functionSignature: ['feature'],\n    },\n    height: {\n      type: 'number',\n      description: 'height in pixels of the main body of each feature',\n      defaultValue: 10,\n      functionSignature: ['feature'],\n    },\n\n    labels: ConfigurationSchema('SvgFeatureLabels', {\n      name: {\n        type: 'string',\n        description:\n          'the primary name of the feature to show, if space is available',\n        defaultValue:\n          \"function(feature) { return feature.get('name') || feature.get('id') }\",\n        functionSignature: ['feature'],\n      },\n      nameColor: {\n        type: 'color',\n        description: 'the color of the name label, if shown',\n        defaultValue: 'black',\n        functionSignature: ['feature'],\n      },\n      description: {\n        type: 'string',\n        description: 'the text description to show, if space is available',\n        defaultValue:\n          \"function(feature) { return feature.get('note') || feature.get('description') }\",\n        functionSignature: ['feature'],\n      },\n      descriptionColor: {\n        type: 'color',\n        description: 'the color of the description, if shown',\n        defaultValue: 'blue',\n        functionSignature: ['feature'],\n      },\n      fontSize: {\n        type: 'number',\n        description:\n          'height in pixels of the text to use for names and descriptions',\n        defaultValue: 13,\n        functionSignature: ['feature'],\n      },\n    }),\n    displayMode: {\n      type: 'stringEnum',\n      model: types.enumeration('displayMode', [\n        'normal',\n        'compact',\n        'reducedRepresentation',\n        'collapse',\n      ]),\n      description: 'Alternative display modes',\n      defaultValue: 'normal',\n    },\n    maxFeatureGlyphExpansion: {\n      type: 'number',\n      description:\n        \"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use\",\n      defaultValue: 500,\n    },\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a svg rendering',\n      defaultValue: 600,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import BoxRendererType from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  configSchema as svgFeatureRendererConfigSchema,\n  ReactComponent as SvgFeatureRendererReactComponent,\n} from './SvgFeatureRenderer'\n\nexport default class SVGPlugin extends Plugin {\n  name = 'SVGPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addRendererType(\n      () =>\n        new BoxRendererType({\n          name: 'SvgFeatureRenderer',\n          ReactComponent: SvgFeatureRendererReactComponent,\n          configSchema: svgFeatureRendererConfigSchema,\n        }),\n    )\n  }\n}\n\nexport { svgFeatureRendererConfigSchema, SvgFeatureRendererReactComponent }\n","import { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'TheTrackHubRegistryConnection',\n  {\n    trackDbId: {\n      type: 'string',\n      defaultValue: '',\n      description: 'id of the trackDb in The Track Hub Registry',\n    },\n  },\n  { baseConfiguration: baseConnectionConfig },\n)\n","import objectHash from 'object-hash'\nimport { generateUnsupportedTrackConf } from '@jbrowse/core/util/tracks'\n\nexport function generateTracks(trackDb, assemblyName, sequenceAdapter) {\n  // eslint-disable-next-line no-underscore-dangle\n  const { configuration } = trackDb._source\n  const subTracks = getSubtracks({ members: configuration })\n  return subTracks.map(subTrack => {\n    const ret = makeTrackConfig(\n      subTrack,\n      // eslint-disable-next-line no-underscore-dangle\n      trackDb._source.hub.url,\n      sequenceAdapter,\n    )\n    ret.trackId = `trackhub-registry-${objectHash(ret)}`\n    ret.assemblyNames = [assemblyName]\n    return ret\n  })\n\n  function getSubtracks(track, trackPath = []) {\n    if (track.members)\n      return Object.values(track.members)\n        .map(subTrack =>\n          getSubtracks(\n            subTrack,\n            track.shortLabel ? trackPath.concat([track.shortLabel]) : trackPath,\n          ),\n        )\n        .flat()\n    track.categories = trackPath\n    return [track]\n  }\n}\n\nfunction makeTrackConfig(track, trackDbUrl, sequenceAdapter) {\n  const trackType = track.type\n  let baseTrackType = trackType.split(' ')[0].toLowerCase()\n  if (\n    baseTrackType === 'bam' &&\n    track.bigDataUrl.toLowerCase().endsWith('cram')\n  )\n    baseTrackType = 'cram'\n  const { bigDataUrl } = track\n  const bigDataLocation = {\n    uri: new URL(bigDataUrl, trackDbUrl).href,\n  }\n  const { categories } = track\n  let bigDataIndexLocation\n  switch (baseTrackType) {\n    case 'bam':\n      if (trackDbUrl)\n        bigDataIndexLocation = track.bigDataIndex\n          ? {\n              uri: new URL(track.bigDataIndex, trackDbUrl).href,\n            }\n          : {\n              uri: new URL(`${track.bigDataUrl}.bai`, trackDbUrl).href,\n            }\n      else\n        bigDataIndexLocation = track.bigDataIndex\n          ? { localPath: track.bigDataIndex }\n          : { localPath: `${track.bigDataUrl}.bai` }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'BamAdapter',\n          bamLocation: bigDataLocation,\n          index: {\n            location: bigDataIndexLocation,\n          },\n        },\n      }\n    case 'bed':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bed5floatscore':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bedgraph':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bedrnaelements':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigbarchart':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigbed':\n      return {\n        type: 'FeatureTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'bigchain':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'biginteract':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigmaf':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigpsl':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigwig':\n      return {\n        type: 'QuantitativeTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'BigWigAdapter',\n          bigWigLocation: bigDataLocation,\n        },\n      }\n    case 'broadpeak':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'coloredexon':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'cram':\n      if (trackDbUrl)\n        bigDataIndexLocation = track.bigDataIndex\n          ? {\n              uri: new URL(track.bigDataIndex, trackDbUrl).href,\n            }\n          : {\n              uri: new URL(`${track.bigDataUrl}.bai`, trackDbUrl).href,\n            }\n      else\n        bigDataIndexLocation = track.bigDataIndex\n          ? { localPath: track.bigDataIndex }\n          : { localPath: `${track.bigDataUrl}.bai` }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'CramAdapter',\n          bamLocation: bigDataLocation,\n          index: { location: bigDataIndexLocation },\n          sequenceAdapter,\n        },\n      }\n    case 'gvf':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'ld2':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'narrowpeak':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'peptidemapping':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'vcftabix':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'wig':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'wigmaf':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    default:\n      throw new Error(`Unsupported track type: ${baseTrackType}`)\n  }\n}\n","import {\n  ConfigurationReference,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getSession } from '@jbrowse/core/util'\nimport { types } from 'mobx-state-tree'\nimport configSchema from './configSchema'\nimport { generateTracks } from './tracks'\n\nexport default function (pluginManager) {\n  return types.compose(\n    'TheTrackHubRegistryConnection',\n    BaseConnectionModelFactory(pluginManager),\n    types\n      .model({\n        type: types.literal('TheTrackHubRegistryConnection'),\n        configuration: ConfigurationReference(configSchema),\n      })\n      .actions(self => ({\n        connect(connectionConf) {\n          self.clear()\n          const trackDbId = readConfObject(connectionConf, 'trackDbId')\n          fetch(\n            `https://www.trackhubregistry.org/api/search/trackdb/${trackDbId}`,\n          )\n            .then(rawResponse => rawResponse.json())\n            .then(trackDb => {\n              const assemblyName = readConfObject(\n                self.configuration,\n                'assemblyName',\n              )\n              const session = getSession(self)\n              const assemblyConf = session.assemblies.find(\n                assembly => readConfObject(assembly, 'name') === assemblyName,\n              )\n              const sequenceAdapter = readConfObject(assemblyConf, [\n                'sequence',\n                'adapter',\n              ])\n              self.setTrackConfs(\n                generateTracks(trackDb, assemblyName, sequenceAdapter),\n              )\n            })\n            .catch(error => {\n              console.error(error)\n            })\n        },\n      })),\n  )\n}\n","import { openLocation } from '@jbrowse/core/util/io'\nimport { HubFile } from '@gmod/ucsc-hub'\nimport Card from '@material-ui/core/Card'\nimport CardActions from '@material-ui/core/CardActions'\nimport CardContent from '@material-ui/core/CardContent'\nimport CardHeader from '@material-ui/core/CardHeader'\nimport IconButton from '@material-ui/core/IconButton'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport Typography from '@material-ui/core/Typography'\nimport EmailIcon from '@material-ui/icons/Email'\nimport OpenInNewIcon from '@material-ui/icons/OpenInNew'\nimport PropTypes from 'prop-types'\nimport DOMPurify from 'dompurify'\nimport React, { useEffect, useState } from 'react'\n\nfunction HubDetails(props) {\n  const [hubFile, setHubFile] = useState(null)\n  const [errorMessage, setErrorMessage] = useState(null)\n\n  const { hub } = props\n\n  const { url: hubUrl, longLabel, shortLabel } = hub\n\n  useEffect(() => {\n    async function getHubTxt() {\n      let hubTxt\n      try {\n        const hubHandle = openLocation({ uri: hubUrl })\n        hubTxt = await hubHandle.readFile('utf8')\n      } catch (error) {\n        setErrorMessage(\n          <span>\n            <strong>Error retrieving hub</strong> {error.message} <br />\n            {hubUrl}\n          </span>,\n        )\n        return\n      }\n      try {\n        const newHubFile = new HubFile(hubTxt)\n        setHubFile(newHubFile)\n      } catch (error) {\n        setErrorMessage(\n          <span>\n            <strong>Could not parse genomes file:</strong> <br />\n            {error.message} <br />\n            {hubUrl}\n          </span>,\n        )\n      }\n    }\n\n    getHubTxt()\n  }, [hubUrl])\n  if (errorMessage)\n    return (\n      <Card>\n        <CardContent>\n          <Typography color=\"error\">{errorMessage}</Typography>\n        </CardContent>\n      </Card>\n    )\n  if (hubFile)\n    return (\n      <Card>\n        <CardHeader title={shortLabel} />\n        <CardContent>\n          <div __dangerouslySetInnerHTML={DOMPurify.sanitize(longLabel)} />\n        </CardContent>\n        <CardActions>\n          <IconButton\n            href={`mailto:${hubFile.get('email')}`}\n            rel=\"noopener noreferrer\"\n            target=\"_blank\"\n            color=\"secondary\"\n          >\n            <EmailIcon />\n          </IconButton>\n          {hubFile.get('descriptionUrl') ? (\n            <IconButton\n              href={\n                new URL(hubFile.get('descriptionUrl'), new URL(hubUrl)).href\n              }\n              rel=\"noopener noreferrer\"\n              target=\"_blank\"\n            >\n              <OpenInNewIcon color=\"secondary\" />\n            </IconButton>\n          ) : null}\n        </CardActions>\n      </Card>\n    )\n  return <LinearProgress variant=\"query\" />\n}\n\nHubDetails.propTypes = {\n  hub: PropTypes.shape().isRequired,\n}\n\nexport default HubDetails\n","import FormControl from '@material-ui/core/FormControl'\nimport FormHelperText from '@material-ui/core/FormHelperText'\nimport InputLabel from '@material-ui/core/InputLabel'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport Select from '@material-ui/core/Select'\nimport { makeStyles } from '@material-ui/core/styles'\nimport PropTypes from 'prop-types'\nimport React from 'react'\n\nconst useStyles = makeStyles(theme => ({\n  formControl: {\n    minWidth: 192,\n    marginLeft: theme.spacing(2),\n    marginRight: theme.spacing(2),\n  },\n}))\n\nfunction SelectBox({\n  selectList,\n  selectedItem,\n  handleSelect,\n  label,\n  helpText,\n}) {\n  const classes = useStyles()\n  return (\n    <FormControl className={classes.formControl}>\n      <InputLabel>{label}</InputLabel>\n      <Select value={selectedItem} onChange={handleSelect}>\n        {selectList.map(item => {\n          let value\n          let description\n          if (item.name) {\n            value = item.name\n            description = `${item.name} (${item.synonyms.join(' ')})`\n          }\n          return (\n            <MenuItem key={description || item} value={value || item}>\n              {description || item}\n            </MenuItem>\n          )\n        })}\n      </Select>\n      <FormHelperText>{selectedItem ? '' : helpText}</FormHelperText>\n    </FormControl>\n  )\n}\n\nSelectBox.propTypes = {\n  selectList: PropTypes.arrayOf(\n    PropTypes.oneOfType([PropTypes.string, PropTypes.shape()]),\n  ).isRequired,\n  selectedItem: PropTypes.string.isRequired,\n  handleSelect: PropTypes.func.isRequired,\n  label: PropTypes.string.isRequired,\n  helpText: PropTypes.string.isRequired,\n}\n\nexport default SelectBox\n","import { openLocation } from '@jbrowse/core/util/io'\nimport FormControl from '@material-ui/core/FormControl'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\nimport FormLabel from '@material-ui/core/FormLabel'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport Radio from '@material-ui/core/Radio'\nimport RadioGroup from '@material-ui/core/RadioGroup'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport Typography from '@material-ui/core/Typography'\nimport { PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React, { useEffect, useState } from 'react'\nimport DOMPurify from 'dompurify'\nimport HubDetails from './HubDetails'\nimport SelectBox from './SelectBox'\n\nfunction QueryStatus(props) {\n  const { status } = props\n  return (\n    <>\n      <LinearProgress variant=\"query\" />\n      <Typography>{status}</Typography>\n    </>\n  )\n}\n\nQueryStatus.propTypes = {\n  status: PropTypes.string.isRequired,\n}\n\n// Need this for FormControlLabel to work with Tooltip\n// https://github.com/mui-org/material-ui/issues/2225#issuecomment-460041878\nfunction Wire({ children, ...props }) {\n  return children(props)\n}\n\nconst useStyles = makeStyles(theme => ({\n  hubList: {\n    maxHeight: 400,\n    overflowY: 'auto',\n  },\n  genomeSelector: {\n    marginTop: theme.spacing(1),\n  },\n}))\n\nfunction TrackHubRegistrySelect({ model, setModelReady }) {\n  const [errorMessage, setErrorMessage] = useState(null)\n  const [assemblies, setAssemblies] = useState(null)\n  const [selectedSpecies, setSelectedSpecies] = useState('')\n  const [selectedAssembly, setSelectedAssembly] = useState('')\n  const [hubs, setHubs] = useState(new Map())\n  const [allHubsRetrieved, setAllHubsRetrieved] = useState(false)\n  const [selectedHub, setSelectedHub] = useState('')\n  const classes = useStyles()\n\n  useEffect(() => {\n    if (selectedHub) setModelReady(true)\n    else setModelReady(false)\n  }, [selectedHub, setModelReady])\n\n  useEffect(() => {\n    async function getAssemblies() {\n      const pingResponse = await doGet(\n        'https://www.trackhubregistry.org/api/info/ping',\n      )\n      if (!pingResponse) {\n        return\n      }\n      if (pingResponse.ping !== 1) {\n        setErrorMessage('Registry is not available')\n        return\n      }\n      const assembliesResponse = await doGet(\n        'https://www.trackhubregistry.org/api/info/assemblies',\n      )\n      if (assembliesResponse) {\n        setAssemblies(assembliesResponse)\n      }\n    }\n\n    getAssemblies()\n  }, [])\n\n  useEffect(() => {\n    if (errorMessage) return\n    if (selectedAssembly && !hubs.size) getHubs(true)\n    else if (hubs.size && !allHubsRetrieved) getHubs()\n  })\n\n  async function getHubs(reset) {\n    const entriesPerPage = 10\n    const newHubs = reset ? new Map() : new Map(hubs)\n    const page = Math.floor(hubs.size / entriesPerPage) + 1\n    const response = await doPost(\n      'https://www.trackhubregistry.org/api/search',\n      { assembly: selectedAssembly },\n      { page, entries_per_page: entriesPerPage },\n    )\n    if (response) {\n      for (const item of response.items) {\n        if (item.hub.url.startsWith('ftp://'))\n          item.error = 'JBrowse cannot add connections from FTP sources'\n        else {\n          const hub = openLocation({ uri: item.hub.url })\n          try {\n            // eslint-disable-next-line no-await-in-loop\n            await hub.stat()\n          } catch (error) {\n            item.error = error.message\n          }\n        }\n        newHubs.set(item.id, item)\n      }\n      setHubs(newHubs)\n      if (newHubs.size === response.total_entries) setAllHubsRetrieved(true)\n    }\n  }\n\n  function handleSelectSpecies(event) {\n    setSelectedSpecies(event.target.value)\n    setSelectedAssembly('')\n    setHubs(new Map())\n    setSelectedHub('')\n    setAllHubsRetrieved(false)\n  }\n\n  function handleSelectAssembly(event) {\n    setSelectedAssembly(event.target.value)\n    setHubs(new Map())\n    setSelectedHub('')\n    setAllHubsRetrieved(false)\n  }\n\n  function handleSelectHub(event) {\n    const newHub = event.target.value\n    setSelectedHub(newHub)\n    model.target.name.set(hubs.get(newHub).hub.shortLabel)\n    model.target.trackDbId.set(newHub)\n  }\n\n  async function doGet(url, params = {}) {\n    let rawResponse\n    const urlParams = Object.keys(params)\n      .map(param => `${param}=${params[param]}`)\n      .join(';')\n    try {\n      rawResponse = await fetch(`${url}${urlParams ? `?${urlParams}` : ''}`)\n    } catch (error) {\n      setErrorMessage(\n        <span>\n          <strong>Network connection error.</strong> <br />\n          {error.message} <br />\n          {url}\n        </span>,\n      )\n      return null\n    }\n    if (!rawResponse.ok) {\n      setErrorMessage(\n        <span>\n          <strong>Error connecting to the URL.</strong> <br />\n          {rawResponse.status}: {rawResponse.statusText} <br />\n          {url}\n        </span>,\n      )\n      return null\n    }\n    return rawResponse.json()\n  }\n\n  async function doPost(url, data = {}, params = {}) {\n    let rawResponse\n    const urlParams = Object.keys(params)\n      .map(param => `${param}=${params[param]}`)\n      .join(';')\n    try {\n      rawResponse = await fetch(`${url}${urlParams ? `?${urlParams}` : ''}`, {\n        method: 'POST',\n        body: JSON.stringify(data),\n      })\n    } catch (error) {\n      setErrorMessage(\n        <span>\n          <strong>Network connection error.</strong> <br />\n          {error.message} <br />\n          {url}\n        </span>,\n      )\n      return null\n    }\n    if (!rawResponse.ok) {\n      setErrorMessage(\n        <span>\n          <strong>Error connecting to the URL.</strong> <br />\n          {rawResponse.status}: {rawResponse.statusText} <br />\n          {url}\n        </span>,\n      )\n      return null\n    }\n    return rawResponse.json()\n  }\n\n  const renderItems = [\n    <Typography key=\"heading\" variant=\"h6\">\n      The Track Hub Registry\n    </Typography>,\n  ]\n\n  if (errorMessage) {\n    renderItems.push(\n      <Typography key=\"errorMessage\" color=\"error\">\n        {errorMessage}\n      </Typography>,\n    )\n    return <div>{renderItems}</div>\n  }\n\n  if (!assemblies) {\n    renderItems.push(\n      <QueryStatus key=\"queryStatus\" status=\"Connecting to registry...\" />,\n    )\n    return <div>{renderItems}</div>\n  }\n\n  const speciesList = Object.keys(assemblies)\n    .sort()\n    .filter(item => item.toLowerCase().includes('sapiens'))\n\n  renderItems.push(\n    <SelectBox\n      key=\"speciesSelect\"\n      selectList={speciesList}\n      selectedItem={selectedSpecies}\n      handleSelect={handleSelectSpecies}\n      label=\"Species\"\n      helpText=\"Select a species\"\n    />,\n  )\n\n  if (selectedSpecies) {\n    const ret = assemblies[selectedSpecies].filter(\n      s => !(s.name === 'GRCh37' && s.synonyms[0] === 'hg38'),\n    )\n    renderItems.push(\n      <SelectBox\n        key=\"assemblySelect\"\n        selectList={ret}\n        selectedItem={selectedAssembly}\n        handleSelect={handleSelectAssembly}\n        label=\"Assembly\"\n        helpText=\"Select an assembly\"\n      />,\n    )\n  }\n\n  if (selectedAssembly) {\n    renderItems.push(\n      <div key=\"hubSelect\">\n        <FormControl>\n          <FormLabel>Hubs:</FormLabel>\n          <div className={classes.hubList}>\n            <RadioGroup value={selectedHub} onChange={handleSelectHub}>\n              {Array.from(hubs.values())\n                .filter(\n                  hub =>\n                    hub.assembly.name === selectedAssembly ||\n                    hub.assembly.synonyms.includes(selectedAssembly),\n                )\n                .map(hub => {\n                  const disabled = Boolean(hub.error)\n                  const cleanShortLabel = (\n                    <div\n                      __dangerouslySetInnerHTML={{\n                        __html: DOMPurify.sanitize(hub.hub.shortLabel),\n                      }}\n                    />\n                  )\n                  const cleanLongLabel = (\n                    <div\n                      __dangerouslySetInnerHTML={{\n                        __html: DOMPurify.sanitize(hub.hub.longLabel),\n                      }}\n                    />\n                  )\n                  return (\n                    <Wire key={hub.id} value={hub.id}>\n                      {formControlProps => (\n                        <Tooltip\n                          title={disabled ? hub.error : cleanLongLabel}\n                          placement=\"left\"\n                          interactive\n                        >\n                          <FormControlLabel\n                            key={hub.id}\n                            value={hub.id}\n                            label={cleanShortLabel}\n                            disabled={disabled}\n                            control={<Radio />}\n                            {...formControlProps}\n                          />\n                        </Tooltip>\n                      )}\n                    </Wire>\n                  )\n                })}\n            </RadioGroup>\n          </div>\n        </FormControl>\n      </div>,\n    )\n    if (!allHubsRetrieved)\n      renderItems.push(<QueryStatus key=\"hubStatus\" status=\"Retrieving hubs\" />)\n  }\n\n  if (selectedHub)\n    renderItems.push(\n      <HubDetails key=\"hubDetails\" hub={hubs.get(selectedHub).hub} />,\n    )\n\n  return <>{renderItems}</>\n}\n\nTrackHubRegistrySelect.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n  setModelReady: PropTypes.func.isRequired,\n}\n\nexport default TrackHubRegistrySelect\n","import ConnectionType from '@jbrowse/core/pluggableElementTypes/ConnectionType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { configSchema, modelFactory } from './trackhub-registry'\nimport TrackHubRegistrySelect from './trackhub-registry/TrackHubRegistrySelect'\n\nexport default class TrackHubRegistryPlugin extends Plugin {\n  name = 'TrackHubRegistryPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addConnectionType(\n      () =>\n        new ConnectionType({\n          name: 'TheTrackHubRegistryConnection',\n          configSchema,\n          configEditorComponent: TrackHubRegistrySelect,\n          stateModel: modelFactory(pluginManager),\n          displayName: 'The Track Hub Registry',\n          description: 'A hub from The Track Hub Registry',\n          url: '//trackhubregistry.org/',\n        }),\n    )\n  }\n}\n","import {\n  baseChordDisplayConfig,\n  BaseChordDisplayModel,\n} from '@jbrowse/plugin-circular-view'\n\nexport default pluginManager => {\n  const { jbrequire } = pluginManager\n\n  const { types } = jbrequire('mobx-state-tree')\n  const { ConfigurationSchema, ConfigurationReference } = jbrequire(\n    '@jbrowse/core/configuration',\n  )\n  const { getContainingView } = jbrequire('@jbrowse/core/util')\n  const { getParentRenderProps } = jbrequire('@jbrowse/core/util/tracks')\n  const configSchema = ConfigurationSchema(\n    'ChordVariantDisplay',\n    {\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'StructuralVariantChordRenderer' },\n      ),\n    },\n    { baseConfiguration: baseChordDisplayConfig, explicitlyTyped: true },\n  )\n\n  const stateModel = types\n    .compose(\n      'ChordVariantDisplay',\n      BaseChordDisplayModel,\n      types.model({\n        type: types.literal('ChordVariantDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(self => ({\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n      get renderProps() {\n        const view = getContainingView(self)\n        return {\n          ...getParentRenderProps(self),\n          displayModel: self,\n          bezierRadius: view.radiusPx * self.bezierRadiusRatio,\n          radius: view.radiusPx,\n          blockDefinitions: this.blockDefinitions,\n          config: self.configuration.renderer,\n          onChordClick: self.onChordClick,\n        }\n      },\n    }))\n\n  return { stateModel, configSchema }\n}\n\n// http://localhost:3000/test_data/hs37d5.HG002-SequelII-CCS.sv.vcf.gz.tbi\n\n// render request is for 1.5x the current viewing window\n\n// tracks all have a height\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseChordDisplayComponentFactory } from '@jbrowse/plugin-circular-view'\nimport ChordVariantDisplay from './models/ChordVariantDisplay'\n\nexport default (pluginManager: PluginManager) => {\n  const { lib, load } = pluginManager\n  const DisplayType = lib['@jbrowse/core/pluggableElementTypes/DisplayType']\n\n  const { stateModel, configSchema } = load(ChordVariantDisplay)\n\n  return new DisplayType({\n    name: 'ChordVariantDisplay',\n    configSchema,\n    stateModel,\n    trackType: 'VariantTrack',\n    viewType: 'CircularView',\n    ReactComponent: BaseChordDisplayComponentFactory(pluginManager),\n  })\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { getSession, isSessionModelWithWidgets } from '@jbrowse/core/util'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport { LinearVariantDisplayConfigModel } from './configSchema'\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['pileup', 'PileupRenderer'],\n  ['svg', 'SvgFeatureRenderer'],\n])\n\nexport default (configSchema: LinearVariantDisplayConfigModel) =>\n  types\n    .compose(\n      'LinearVariantDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearVariantDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .actions(self => ({\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const featureWidget = session.addWidget(\n            'VariantFeatureWidget',\n            'variantFeature',\n            { featureData: feature.toJSON() },\n          )\n          session.showWidget(featureWidget)\n        }\n\n        session.setSelection(feature)\n      },\n    }))\n    .views(self => ({\n      /**\n       * the renderer type name is based on the \"view\"\n       * selected in the UI: pileup, coverage, etc\n       */\n      get rendererTypeName() {\n        const viewName = getConf(self, 'defaultRendering')\n        const rendererType = rendererTypes.get(viewName)\n        if (!rendererType)\n          throw new Error(`unknown alignments view name ${viewName}`)\n        return rendererType\n      },\n\n      /**\n       * the react props that are passed to the Renderer when data\n       * is rendered in this display\n       */\n      get renderProps() {\n        // view -> track -> [displays] -> [blocks]\n        const config = self.rendererType.configSchema.create(\n          getConf(self, ['renderers', self.rendererTypeName]) || {},\n        )\n        return {\n          ...self.composedRenderProps,\n          ...getParentRenderProps(self),\n          config,\n          displayModel: self,\n        }\n      },\n    }))\n","export default ({ jbrequire }) => {\n  const React = jbrequire('react')\n  const { useMemo } = jbrequire('react')\n  const { observer, PropTypes: MobxPropTypes } = jbrequire('mobx-react')\n  const { polarToCartesian } = jbrequire('@jbrowse/core/util')\n  const { readConfObject } = jbrequire('@jbrowse/core/configuration')\n\n  const { PropTypes: CommonPropTypes } = jbrequire(\n    '@jbrowse/core/util/types/mst',\n  )\n  const PropTypes = jbrequire('prop-types')\n\n  function bpToRadians(block, pos) {\n    const blockStart = block.region.elided ? 0 : block.region.start\n    const blockEnd = block.region.elided ? 0 : block.region.end\n    const bpOffset = block.flipped ? blockEnd - pos : pos - blockStart\n    const radians = bpOffset / block.bpPerRadian + block.startRadians\n    return radians\n  }\n\n  const Chord = observer(function Chord({\n    feature,\n    blocksForRefs,\n    radius,\n    config,\n    bezierRadius,\n    selected,\n    onClick,\n  }) {\n    // find the blocks that our start and end points belong to\n    const startBlock = blocksForRefs[feature.get('refName')]\n    if (!startBlock) {\n      return null\n    }\n    let svType\n    if (feature.get('INFO')) {\n      ;[svType] = feature.get('INFO').SVTYPE || []\n    } else if (feature.get('mate')) {\n      svType = 'mate'\n    }\n    let endPosition\n    let endBlock\n    if (svType === 'BND') {\n      // VCF BND\n      const breakendSpecification = (feature.get('ALT') || [])[0]\n      const matePosition = breakendSpecification.MatePosition.split(':')\n      endPosition = parseInt(matePosition[1], 10)\n      endBlock = blocksForRefs[matePosition[0]]\n    } else if (svType === 'TRA') {\n      // VCF TRA\n      const chr2 = ((feature.get('INFO') || {}).CHR2 || [])[0]\n      const end = ((feature.get('INFO') || {}).END || [])[0]\n      endPosition = parseInt(end, 10)\n      endBlock = blocksForRefs[chr2]\n    } else if (svType === 'mate') {\n      // generic simplefeatures arcs\n      const mate = feature.get('mate')\n      const chr2 = mate.refName\n      endPosition = mate.start\n      endBlock = blocksForRefs[chr2]\n    }\n    if (endBlock) {\n      const startPos = feature.get('start')\n      const startRadians = bpToRadians(startBlock, startPos)\n      const endRadians = bpToRadians(endBlock, endPosition)\n      const startXY = polarToCartesian(radius, startRadians)\n      const endXY = polarToCartesian(radius, endRadians)\n      const controlXY = polarToCartesian(\n        bezierRadius,\n        (endRadians + startRadians) / 2,\n      )\n\n      let strokeColor\n      if (selected) {\n        strokeColor = readConfObject(config, 'strokeColorSelected', [feature])\n      } else {\n        strokeColor = readConfObject(config, 'strokeColor', [feature])\n      }\n      const hoverStrokeColor = readConfObject(config, 'strokeColorHover', [\n        feature,\n      ])\n      return (\n        <path\n          data-testid={`chord-${feature.id()}`}\n          d={['M', ...startXY, 'Q', ...controlXY, ...endXY].join(' ')}\n          style={{ stroke: strokeColor }}\n          onClick={evt =>\n            onClick(feature, startBlock.region, endBlock.region, evt)\n          }\n          onMouseOver={evt => {\n            if (!selected) evt.target.style.stroke = hoverStrokeColor\n          }}\n          onMouseOut={evt => {\n            if (!selected) evt.target.style.stroke = strokeColor\n          }}\n        />\n      )\n    }\n\n    return null\n  })\n\n  function StructuralVariantChords(props) {\n    const {\n      features,\n      config,\n      displayModel,\n      blockDefinitions,\n      radius,\n      bezierRadius,\n      displayModel: { selectedFeatureId },\n\n      onChordClick,\n    } = props\n    // make a map of refName -> blockDefinition\n    const blocksForRefsMemo = useMemo(() => {\n      const blocksForRefs = {}\n      blockDefinitions.forEach(block => {\n        const regions = block.region.elided\n          ? block.region.regions\n          : [block.region]\n        regions.forEach(region => {\n          blocksForRefs[region.refName] = block\n        })\n      })\n      return blocksForRefs\n    }, [blockDefinitions])\n    // console.log(blocksForRefs)\n    const chords = []\n    for (const [id, feature] of features) {\n      const selected = String(selectedFeatureId) === String(feature.id())\n      chords.push(\n        <Chord\n          key={id}\n          feature={feature}\n          config={config}\n          displayModel={displayModel}\n          radius={radius}\n          bezierRadius={bezierRadius}\n          blocksForRefs={blocksForRefsMemo}\n          selected={selected}\n          onClick={onChordClick}\n        />,\n      )\n    }\n    const trackStyleId = `chords-${displayModel.id}`\n    return (\n      <g id={trackStyleId} data-testid=\"structuralVariantChordRenderer\">\n        <style\n          // eslint-disable-next-line react/no-danger\n          dangerouslySetInnerHTML={{\n            __html: `\n          #${trackStyleId} > path {\n            cursor: crosshair;\n            fill: none;\n          }\n`,\n          }}\n        />\n        {chords}\n      </g>\n    )\n  }\n\n  StructuralVariantChords.propTypes = {\n    features: PropTypes.instanceOf(Map).isRequired,\n    config: CommonPropTypes.ConfigSchema.isRequired,\n    displayModel: MobxPropTypes.objectOrObservableObject,\n    blockDefinitions: PropTypes.arrayOf(MobxPropTypes.objectOrObservableObject)\n      .isRequired,\n    radius: PropTypes.number.isRequired,\n    bezierRadius: PropTypes.number.isRequired,\n    selectedFeatureId: PropTypes.string,\n    onChordClick: PropTypes.func,\n  }\n\n  StructuralVariantChords.defaultProps = {\n    displayModel: undefined,\n    selectedFeatureId: '',\n    onChordClick: undefined,\n  }\n\n  return observer(StructuralVariantChords)\n}\n","import ReactComponentFactory from './ReactComponent'\n\nexport default ({ jbrequire }) => {\n  const ChordRendererType = jbrequire(\n    '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType',\n  )\n  const { ConfigurationSchema } = jbrequire('@jbrowse/core/configuration')\n\n  const ReactComponent = jbrequire(ReactComponentFactory)\n  const configSchema = ConfigurationSchema(\n    'StructuralVariantChordRenderer',\n    {\n      strokeColor: {\n        type: 'color',\n        description: 'the line color of each arc',\n        defaultValue: 'rgba(255,133,0,0.32)',\n        functionSignature: ['feature'],\n      },\n      strokeColorSelected: {\n        type: 'color',\n        description: 'the line color of an arc that has been selected',\n        defaultValue: 'black',\n        functionSignature: ['feature'],\n      },\n      strokeColorHover: {\n        type: 'color',\n        description:\n          'the line color of an arc that is being hovered over with the mouse',\n        defaultValue: '#555',\n        functionSignature: ['feature'],\n      },\n    },\n    { explicitlyTyped: true },\n  )\n  return new ChordRendererType({\n    name: 'StructuralVariantChordRenderer',\n    ReactComponent,\n    configSchema,\n  })\n}\n","import Divider from '@material-ui/core/Divider'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Table from '@material-ui/core/Table'\nimport TableBody from '@material-ui/core/TableBody'\nimport TableCell from '@material-ui/core/TableCell'\nimport TableHead from '@material-ui/core/TableHead'\nimport TableRow from '@material-ui/core/TableRow'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport {\n  BaseFeatureDetails,\n  BaseCard,\n} from '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail'\n\nconst useStyles = makeStyles(theme => ({\n  table: {\n    padding: 0,\n  },\n  valueCell: {\n    wordWrap: 'break-word',\n    padding: theme.spacing(1),\n  },\n  fieldName: {\n    display: 'inline-block',\n    minWidth: '90px',\n    fontSize: '0.9em',\n    borderBottom: '1px solid #0003',\n    backgroundColor: '#ddd',\n    marginRight: theme.spacing(1),\n    padding: theme.spacing(0.5),\n  },\n  fieldValue: {\n    display: 'inline-block',\n    fontSize: '0.8em',\n  },\n  header: {\n    padding: theme.spacing(0.5),\n    backgroundColor: '#ddd',\n  },\n  title: {\n    fontSize: '1em',\n  },\n\n  valbox: {\n    border: '1px solid #bbb',\n  },\n}))\n\nfunction VariantSamples(props) {\n  const classes = useStyles()\n  const { feature } = props\n  if (!feature.samples) {\n    return null\n  }\n  const ret = Object.keys(feature.samples)\n  if (!ret.length) {\n    return null\n  }\n  const infoFields = Object.keys(feature.samples[ret[0]])\n\n  return (\n    <BaseCard {...props} title=\"Samples\">\n      <div style={{ width: '100%', maxHeight: 600, overflow: 'auto' }}>\n        <Table className={classes.table}>\n          <TableHead>\n            <TableRow>\n              <TableCell>Sample</TableCell>\n              {infoFields.map(f => (\n                <TableCell key={f}>{f}</TableCell>\n              ))}\n            </TableRow>\n          </TableHead>\n          <TableBody>\n            {Object.entries(feature.samples).map(\n              ([key, value]) =>\n                value && (\n                  <TableRow key={key}>\n                    <TableCell component=\"th\" scope=\"row\">\n                      {key}\n                    </TableCell>\n                    {infoFields.map(f => (\n                      <TableCell className={classes.valueCell} key={f}>\n                        {value === null ? '.' : String(value[f])}\n                      </TableCell>\n                    ))}\n                  </TableRow>\n                ),\n            )}\n          </TableBody>\n        </Table>\n      </div>\n    </BaseCard>\n  )\n}\n\nVariantSamples.propTypes = {\n  feature: PropTypes.shape().isRequired,\n}\n\nfunction VariantFeatureDetails(props) {\n  const classes = useStyles()\n  const { model } = props\n  const feat = JSON.parse(JSON.stringify(model.featureData))\n  const { samples, ...rest } = feat\n  const descriptions = {\n    CHROM: 'chromosome: An identifier from the reference genome',\n    POS:\n      'position: The reference position, with the 1st base having position 1',\n    ID:\n      'identifier: Semi-colon separated list of unique identifiers where available',\n    REF:\n      'reference base(s): Each base must be one of A,C,G,T,N (case insensitive).',\n    ALT:\n      ' alternate base(s): Comma-separated list of alternate non-reference alleles',\n    QUAL: 'quality: Phred-scaled quality score for the assertion made in ALT',\n    FILTER:\n      'filter status: PASS if this position has passed all filters, otherwise a semicolon-separated list of codes for filters that fail',\n  }\n\n  return (\n    <Paper className={classes.root} data-testid=\"variant-side-drawer\">\n      <BaseFeatureDetails\n        feature={rest}\n        descriptions={descriptions}\n        {...props}\n      />\n      <Divider />\n      <VariantSamples feature={feat} {...props} />\n    </Paper>\n  )\n}\n\nVariantFeatureDetails.propTypes = {\n  model: MobxPropTypes.observableObject.isRequired,\n}\n\nexport default observer(VariantFeatureDetails)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('VariantFeatureWidget', {})\nexport const stateModel = types\n  .model('VariantFeatureWidget', {\n    id: ElementId,\n    type: types.literal('VariantFeatureWidget'),\n    featureData: types.frozen({}),\n  })\n  .actions(self => ({\n    setFeatureData(data) {\n      self.featureData = data\n    },\n    clearFeatureData() {\n      self.featureData = {}\n    },\n  }))\n\nexport { default as ReactComponent } from './VariantFeatureWidget'\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\n\n/* eslint-disable no-underscore-dangle, @typescript-eslint/camelcase */\n\n/**\n * VCF Feature creation with lazy genotpye evaluation.\n */\ninterface Samples {\n  [key: string]: {\n    [key: string]: { values: string[] | number[] | null }\n  }\n}\ninterface Breakend {\n  MateDirection: string\n  Replacement: string\n  MatePosition: string\n  Join: string\n}\ninterface FeatureData {\n  [key: string]: unknown\n  refName: string\n  start: number\n  end: number\n  description?: string\n  type?: string\n  name?: string\n  aliases?: string[]\n  samples?: Samples\n}\n\nexport default class VCFFeature implements Feature {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private variant: any\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private parser: any\n\n  private data: FeatureData\n\n  private _id: string\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(args: { variant: any; parser: any; id: string }) {\n    this.variant = args.variant\n    this.parser = args.parser\n    this.data = this.dataFromVariant(this.variant)\n    this._id = args.id\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get(field: string): any {\n    if (field === 'samples') return this.variant.SAMPLES\n    return this.variant[field] || this.data[field]\n  }\n\n  set(): void {}\n\n  parent(): undefined {\n    return undefined\n  }\n\n  children(): undefined {\n    return undefined\n  }\n\n  tags(): string[] {\n    const t = [\n      ...Object.keys(this.data),\n      ...Object.keys(this.variant),\n      'samples',\n    ]\n    return t\n  }\n\n  id(): string {\n    return this._id\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  dataFromVariant(variant: any): FeatureData {\n    const start = variant.POS - 1\n    const [SO_term, description] = this._getSOTermAndDescription(\n      variant.REF,\n      variant.ALT,\n    )\n    const isTRA =\n      variant.ALT && variant.ALT.some((f: string | Breakend) => f === '<TRA>')\n    const isSymbolic =\n      variant.ALT &&\n      variant.ALT.some(\n        (f: string | Breakend) =>\n          typeof f === 'string' && f.indexOf('<') !== -1,\n      )\n    const featureData: FeatureData = {\n      refName: variant.CHROM,\n      start,\n      end:\n        isSymbolic && variant.INFO.END && !isTRA\n          ? Number(variant.INFO.END[0])\n          : start + variant.REF.length,\n      description,\n      type: SO_term,\n      name: variant.ID ? variant.ID[0] : undefined,\n      aliases:\n        variant.ID && variant.ID.length > 1 ? variant.ID.slice(1) : undefined,\n    }\n\n    return featureData\n  }\n\n  /**\n   * Get a sequence ontology (SO) term that describes the variant type\n   */\n  _getSOTermAndDescription(\n    ref: string,\n    alt: string[],\n  ): [string, string] | [undefined, undefined] {\n    // it's just a remark if there are no alternate alleles\n    if (!alt || alt === []) {\n      return ['remark', 'no alternative alleles']\n    }\n\n    const soTerms: Set<string> = new Set()\n    let descriptions: Set<string> = new Set()\n    alt.forEach(a => {\n      let [soTerm, description] = this._getSOAndDescFromAltDefs(ref, a)\n      if (!soTerm) {\n        ;[soTerm, description] = this._getSOAndDescByExamination(ref, a)\n      }\n      if (soTerm && description) {\n        soTerms.add(soTerm)\n        descriptions.add(description)\n      }\n    })\n    // Combine descriptions like [\"SNV G -> A\", \"SNV G -> T\"] to [\"SNV G -> A,T\"]\n    if (descriptions.size > 1) {\n      const prefixes: Set<string> = new Set()\n      descriptions.forEach(desc => {\n        const prefix = /(\\w+? \\w+? -> )(?:<)\\w+(?:>)/.exec(desc)\n        if (prefix && prefix[1]) prefixes.add(prefix[1])\n        else prefixes.add(desc)\n      })\n      const new_descs: string[] = []\n      ;[...prefixes].forEach((prefix: string) => {\n        const suffixes: string[] = []\n        ;[...descriptions].forEach((desc: string) => {\n          if (desc.startsWith(prefix)) {\n            suffixes.push(desc.slice(prefix.length))\n          }\n        })\n        new_descs.push(prefix + suffixes.join(','))\n      })\n      descriptions = new Set(new_descs)\n    }\n    if (soTerms.size) {\n      return [[...soTerms].join(','), [...descriptions].join(',')]\n    }\n    return [undefined, undefined]\n  }\n\n  static _altTypeToSO: { [key: string]: string | undefined } = {\n    DEL: 'deletion',\n    INS: 'insertion',\n    DUP: 'duplication',\n    INV: 'inversion',\n    INVDUP: 'inverted duplication',\n    CNV: 'copy_number_variation',\n    TRA: 'translocation',\n    'DUP:TANDEM': 'tandem_duplication',\n    NON_REF: 'sequence_variant',\n    '*': 'sequence_variant',\n  }\n\n  _getSOAndDescFromAltDefs(\n    ref: string,\n    alt: string | Breakend,\n  ): [string, string] | [undefined, undefined] {\n    // not a symbolic ALT if doesn't begin with '<', so we'll have no definition\n    if (typeof alt === 'object') {\n      return [\n        'breakend',\n        'A VCF breakend defines one end of a point of structural variation',\n      ]\n    }\n\n    if (typeof alt === 'string' && !alt.startsWith('<')) {\n      return [undefined, undefined]\n    }\n\n    alt = alt.replace(/^<|>$/g, '') // trim off < and >\n\n    // look for a definition with an SO type for this\n    let soTerm = VCFFeature._altTypeToSO[alt]\n    // if no SO term but ALT is in metadata, assume sequence_variant\n    if (!soTerm && this.parser.getMetadata('ALT', alt))\n      soTerm = 'sequence_variant'\n    if (soTerm) {\n      const description = this.parser.getMetadata('ALT', alt, 'Description')\n        ? `${alt} - ${this.parser.getMetadata('ALT', alt, 'Description')}`\n        : this._makeDescriptionString(soTerm, ref, alt)\n      return [soTerm, description]\n    }\n\n    // try to look for a definition for a parent term if we can\n    const modAlt = alt.split(':')\n    if (modAlt.length > 1) {\n      return this._getSOAndDescFromAltDefs(\n        ref,\n        `<${modAlt.slice(0, modAlt.length - 1).join(':')}>`,\n      )\n    }\n    // no parent\n    return [undefined, undefined]\n  }\n\n  _getSOAndDescByExamination(\n    ref: string,\n    alt: string | Breakend,\n  ): [string, string] {\n    if (typeof alt === 'object') {\n      return ['breakend', this._makeDescriptionString('breakend', ref, alt)]\n    }\n    if (ref.length === 1 && alt.length === 1) {\n      // use SNV because SO definition of SNP says abundance must be at\n      // least 1% in population, and can't be sure we meet that\n      return ['SNV', this._makeDescriptionString('SNV', ref, alt)]\n    }\n    if (ref.length === alt.length)\n      if (ref.split('').reverse().join('') === alt)\n        return ['inversion', this._makeDescriptionString('inversion', ref, alt)]\n      else\n        return [\n          'substitution',\n          this._makeDescriptionString('substitution', ref, alt),\n        ]\n\n    if (ref.length <= alt.length)\n      return ['insertion', this._makeDescriptionString('insertion', ref, alt)]\n\n    if (ref.length > alt.length)\n      return ['deletion', this._makeDescriptionString('deletion', ref, alt)]\n\n    return ['indel', this._makeDescriptionString('indel', ref, alt)]\n  }\n\n  _makeDescriptionString(\n    soTerm: string,\n    ref: string,\n    alt: string | Breakend,\n  ): string {\n    return `${soTerm} ${ref} -> ${alt}`\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  toJSON(): any {\n    return {\n      uniqueId: this._id,\n      ...this.data,\n      ...this.variant,\n      samples: this.variant.SAMPLES,\n    }\n  }\n}\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport {\n  FileLocation,\n  NoAssemblyRegion,\n  Region,\n} from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { TabixIndexedFile } from '@gmod/tabix'\nimport { GenericFilehandle } from 'generic-filehandle'\nimport VcfParser from '@gmod/vcf'\nimport { Observer } from 'rxjs'\nimport { Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport VcfFeature from './VcfFeature'\nimport MyConfigSchema from './configSchema'\n\nexport default class extends BaseFeatureDataAdapter {\n  protected vcf: TabixIndexedFile\n\n  protected filehandle: GenericFilehandle\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  protected parser: any\n\n  public constructor(config: Instance<typeof MyConfigSchema>) {\n    super(config)\n    const vcfGzLocation = readConfObject(config, 'vcfGzLocation')\n    const location = readConfObject(config, ['index', 'location'])\n    const indexType = readConfObject(config, ['index', 'indexType'])\n\n    this.filehandle = openLocation(vcfGzLocation as FileLocation)\n    this.vcf = new TabixIndexedFile({\n      filehandle: this.filehandle,\n      csiFilehandle:\n        indexType === 'CSI'\n          ? openLocation(location as FileLocation)\n          : undefined,\n      tbiFilehandle:\n        indexType !== 'CSI'\n          ? openLocation(location as FileLocation)\n          : undefined,\n      chunkCacheSize: 50 * 2 ** 20,\n    })\n\n    this.parser = this.vcf\n      .getHeader()\n      .then((header: string) => new VcfParser({ header }))\n  }\n\n  public async getRefNames(opts: BaseOptions = {}) {\n    return this.vcf.getReferenceSequenceNames(opts)\n  }\n\n  async getHeader() {\n    const header = await this.vcf.getHeader()\n    return header\n      .split('\\n')\n      .filter(line => line.startsWith('##'))\n      .map(line => {\n        const str = line.slice(2)\n        const index = str.indexOf('=')\n        const [tag, data] = [str.slice(0, index), str.slice(index + 1)]\n        return { tag, data }\n      })\n  }\n\n  async getMetadata() {\n    const parser = await this.parser\n    return parser.getMetadata()\n  }\n\n  public getFeatures(query: NoAssemblyRegion, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const parser = await this.parser\n      await this.vcf.getLines(query.refName, query.start, query.end, {\n        lineCallback: (line: string, fileOffset: number) => {\n          const variant = parser.parseLine(line)\n\n          const feature = new VcfFeature({\n            variant,\n            parser,\n            id: `${this.id}-vcf-${fileOffset}`,\n          }) as Feature\n          observer.next(feature)\n        },\n        signal: opts.signal,\n      })\n      observer.complete()\n    }, opts.signal)\n  }\n\n  /**\n   * Checks if the data source has data for the given reference sequence,\n   * and then gets the features in the region if it does\n   *\n   * Currently this just calls getFeatureInRegion for each region. Adapters that\n   * are frequently called on multiple regions simultaneously may want to\n   * implement a more efficient custom version of this method.\n   *\n   * Also includes a bit of extra logging to warn when fetching a large portion\n   * of a VCF\n   * @param regions - Regions\n   * @param opts - Feature adapter options\n   * @returns Observable of Feature objects in the regions\n   */\n  public getFeaturesInMultipleRegions(\n    regions: Region[],\n    opts: BaseOptions = {},\n  ) {\n    // TODO: restore commented version below once TSDX supports Rollup v2\n    // xref: https://github.com/rollup/rollup/blob/master/CHANGELOG.md#bug-fixes-45\n    const superGetFeaturesInMultipleRegions = super.getFeaturesInMultipleRegions\n    return ObservableCreate<Feature>(async (observer: Observer<Feature>) => {\n      const bytes = await this.bytesForRegions(regions)\n      const stat = await this.filehandle.stat()\n      let pct = Math.round((bytes / stat.size) * 100)\n      if (pct > 100) {\n        // this is just a bad estimate, make 100% if it goes over\n        pct = 100\n      }\n      if (pct > 60) {\n        console.warn(\n          `getFeaturesInMultipleRegions fetching ${pct}% of VCF file, but whole-file streaming not yet implemented`,\n        )\n      }\n      superGetFeaturesInMultipleRegions\n        .call(this, regions, opts)\n        .subscribe(observer)\n      // super.getFeaturesInMultipleRegions(regions, opts).subscribe(observer)\n    })\n  }\n\n  /**\n   * get the approximate number of bytes queried from the file for the given\n   * query regions\n   * @param regions - list of query regions\n   */\n  private async bytesForRegions(regions: Region[]) {\n    const blockResults = await Promise.all(\n      regions.map(region =>\n        // @ts-ignore\n        this.vcf.index.blocksForRange(region.refName, region.start, region.end),\n      ),\n    )\n    interface ByteRange {\n      start: number\n      end: number\n    }\n    interface VirtualOffset {\n      blockPosition: number\n    }\n    interface Block {\n      minv: VirtualOffset\n      maxv: VirtualOffset\n    }\n    const byteRanges: ByteRange[] = []\n    blockResults.forEach((blocks: Block[]) => {\n      blocks.forEach(block => {\n        const start = block.minv.blockPosition\n        const end = block.maxv.blockPosition + 64000\n        if (\n          !byteRanges.find(range => {\n            if (range.start <= end && range.end >= start) {\n              range.start = Math.min(range.start, start)\n              range.end = Math.max(range.end, end)\n              return true\n            }\n            return false\n          })\n        ) {\n          byteRanges.push({ start, end })\n        }\n      })\n    })\n\n    return byteRanges.reduce((a, b) => a + b.end - b.start + 1, 0)\n  }\n\n  public freeResources(/* { region } */): void {}\n}\n","import { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'VcfTabixAdapter',\n  {\n    vcfGzLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.vcf.gz' },\n    },\n    index: ConfigurationSchema('VcfIndex', {\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      location: {\n        type: 'fileLocation',\n        defaultValue: { uri: '/path/to/my.vcf.gz.tbi' },\n      },\n    }),\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport ChordVariantDisplay from './ChordVariantDisplay'\nimport {\n  configSchemaFactory as linearVariantDisplayConfigSchemaFactory,\n  modelFactory as linearVariantDisplayModelFactory,\n} from './LinearVariantDisplay'\nimport StructuralVariantChordRendererFactory from './StructuralVariantChordRenderer'\nimport {\n  configSchema as variantFeatureWidgetConfigSchema,\n  ReactComponent as VariantFeatureWidgetReactComponent,\n  stateModel as variantFeatureWidgetStateModel,\n} from './VariantFeatureWidget'\nimport {\n  AdapterClass as VcfTabixAdapterClass,\n  configSchema as vcfTabixAdapterConfigSchema,\n} from './VcfTabixAdapter'\n\nexport default class VariantsPlugin extends Plugin {\n  name = 'VariantsPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'VcfTabixAdapter',\n          configSchema: vcfTabixAdapterConfigSchema,\n          AdapterClass: VcfTabixAdapterClass,\n        }),\n    )\n\n    pluginManager.addRendererType(() =>\n      pluginManager.jbrequire(StructuralVariantChordRendererFactory),\n    )\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'VariantTrack',\n        {},\n        { baseConfiguration: createBaseTrackConfig(pluginManager) },\n      )\n      return new TrackType({\n        name: 'VariantTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'VariantTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addDisplayType(() =>\n      pluginManager.jbrequire(ChordVariantDisplay),\n    )\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearVariantDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearVariantDisplay',\n        configSchema,\n        stateModel: linearVariantDisplayModelFactory(configSchema),\n        trackType: 'VariantTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n\n    pluginManager.addWidgetType(\n      () =>\n        new WidgetType({\n          name: 'VariantFeatureWidget',\n          heading: 'Feature Details',\n          configSchema: variantFeatureWidgetConfigSchema,\n          stateModel: variantFeatureWidgetStateModel,\n          ReactComponent: VariantFeatureWidgetReactComponent,\n        }),\n    )\n  }\n}\n\nexport { default as VcfFeature } from './VcfTabixAdapter/VcfFeature'\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\n\nexport function LinearVariantDisplayConfigFactory(\n  pluginManager: PluginManager,\n) {\n  const PileupRendererConfigSchema = pluginManager.getRendererType(\n    'PileupRenderer',\n  ).configSchema\n  const SvgFeatureRendererConfigSchema = pluginManager.getRendererType(\n    'SvgFeatureRenderer',\n  ).configSchema\n\n  return ConfigurationSchema(\n    'LinearVariantDisplay',\n    {\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['pileup', 'svg']),\n        defaultValue: 'svg',\n      },\n\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        PileupRenderer: PileupRendererConfigSchema,\n        SvgFeatureRenderer: SvgFeatureRendererConfigSchema,\n      }),\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n\nexport type LinearVariantDisplayConfigModel = ReturnType<\n  typeof LinearVariantDisplayConfigFactory\n>\nexport type LinearVariantDisplayConfig = Instance<\n  LinearVariantDisplayConfigModel\n>\n","export default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { observer } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n  const { useState, useEffect } = React\n  const { FileSelector } = jbrequire('@jbrowse/core/ui')\n  const { readConfObject } = jbrequire('@jbrowse/core/configuration')\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const Card = jbrequire('@material-ui/core/Card')\n  const CardContent = jbrequire('@material-ui/core/CardContent')\n  const FormControl = jbrequire('@material-ui/core/FormControl')\n  const FormGroup = jbrequire('@material-ui/core/FormGroup')\n  const FormLabel = jbrequire('@material-ui/core/FormLabel')\n  const FormControlLabel = jbrequire('@material-ui/core/FormControlLabel')\n  const Checkbox = jbrequire('@material-ui/core/Checkbox')\n  const RadioGroup = jbrequire('@material-ui/core/RadioGroup')\n  const Radio = jbrequire('@material-ui/core/Radio')\n  const Container = jbrequire('@material-ui/core/Container')\n  const Button = jbrequire('@material-ui/core/Button')\n  const Grid = jbrequire('@material-ui/core/Grid')\n  const Typography = jbrequire('@material-ui/core/Typography')\n  const TextField = jbrequire('@material-ui/core/TextField')\n  const MenuItem = jbrequire('@material-ui/core/MenuItem')\n  const Select = jbrequire('@material-ui/core/Select')\n\n  const useStyles = makeStyles(theme => {\n    return {\n      root: {\n        position: 'relative',\n        padding: theme.spacing(1),\n        background: 'white',\n      },\n      errorCard: {\n        width: '50%',\n        margin: [[theme.spacing(2), 'auto']],\n        border: [['2px', 'solid', theme.palette.error.main]],\n      },\n      buttonContainer: { marginTop: theme.spacing(1) },\n    }\n  })\n\n  const NumberEditor = observer(\n    ({ model, disabled, modelPropName, modelSetterName }) => {\n      const [val, setVal] = useState(model[modelPropName])\n      useEffect(() => {\n        const num = parseInt(val, 10)\n        if (!Number.isNaN(num)) {\n          if (num > 0) model[modelSetterName](num)\n          else setVal(1)\n        }\n      }, [model, modelSetterName, val])\n      return (\n        <TextField\n          value={val}\n          disabled={disabled}\n          type=\"number\"\n          onChange={evt => setVal(evt.target.value)}\n          style={{ width: '2rem', verticalAlign: 'baseline' }}\n        />\n      )\n    },\n  )\n  const ImportForm = observer(({ model }) => {\n    const classes = useStyles()\n    const showColumnNameRowControls =\n      model.fileType === 'CSV' || model.fileType === 'TSV'\n\n    const {\n      selectedAssemblyIdx,\n      setSelectedAssemblyIdx,\n      fileType,\n      fileTypes,\n      setFileType,\n      hasColumnNameLine,\n      toggleHasColumnNameLine,\n      assemblyChoices,\n    } = model\n\n    return (\n      <Container>\n        <Grid\n          style={{ width: '25rem', margin: '0 auto' }}\n          container\n          spacing={1}\n          direction=\"column\"\n          alignItems=\"flex-start\"\n        >\n          <Grid item>\n            <FormControl component=\"fieldset\">\n              <FormLabel component=\"legend\">Tabular file</FormLabel>\n              <FormGroup>\n                <FileSelector\n                  location={model.fileSource}\n                  setLocation={model.setFileSource}\n                  localFileAllowed\n                />\n              </FormGroup>\n            </FormControl>\n          </Grid>\n          <Grid item>\n            <FormControl component=\"fieldset\" className={classes.formControl}>\n              <FormLabel component=\"legend\">File Type</FormLabel>\n              <RadioGroup aria-label=\"file type\" name=\"type\" value={fileType}>\n                <Grid container spacing={1} direction=\"row\">\n                  {fileTypes.map(fileTypeName => {\n                    return (\n                      <Grid item key={fileTypeName}>\n                        <FormControlLabel\n                          checked={fileType === fileTypeName}\n                          value={fileTypeName}\n                          onClick={() => setFileType(fileTypeName)}\n                          control={<Radio />}\n                          label={fileTypeName}\n                        />\n                      </Grid>\n                    )\n                  })}\n                </Grid>\n              </RadioGroup>\n            </FormControl>\n          </Grid>\n          {showColumnNameRowControls ? (\n            <Grid item>\n              <FormControl component=\"fieldset\" className={classes.formControl}>\n                <FormLabel component=\"legend\">Column Names</FormLabel>\n                <div>\n                  <FormControlLabel\n                    disabled={!showColumnNameRowControls}\n                    label=\"has column names on line\"\n                    labelPlacement=\"end\"\n                    control={\n                      <Checkbox\n                        checked={hasColumnNameLine}\n                        onClick={toggleHasColumnNameLine}\n                      />\n                    }\n                  />\n                  <NumberEditor\n                    model={model}\n                    disabled={!showColumnNameRowControls || !hasColumnNameLine}\n                    modelPropName=\"columnNameLineNumber\"\n                    modelSetterName=\"setColumnNameLineNumber\"\n                  />\n                </div>\n              </FormControl>\n            </Grid>\n          ) : null}\n          <Grid item>\n            <FormControl fullWidth>\n              <FormLabel component=\"legend\">Associated with assembly</FormLabel>\n              <Select\n                value={selectedAssemblyIdx}\n                onChange={evt => setSelectedAssemblyIdx(evt.target.value)}\n              >\n                {assemblyChoices.map((assembly, idx) => {\n                  const name = readConfObject(assembly, 'name')\n                  return (\n                    <MenuItem key={name} value={idx}>\n                      {name}\n                    </MenuItem>\n                  )\n                })}\n              </Select>\n            </FormControl>\n          </Grid>\n          <Grid item className={classes.buttonContainer}>\n            {model.canCancel ? (\n              <Button\n                variant=\"contained\"\n                color=\"default\"\n                onClick={model.cancelButton}\n                disabled={!model.canCancel}\n              >\n                Cancel\n              </Button>\n            ) : null}{' '}\n            <Button\n              disabled={!model.isReadyToOpen}\n              variant=\"contained\"\n              color=\"primary\"\n              onClick={model.import}\n            >\n              Open\n            </Button>\n          </Grid>\n        </Grid>\n      </Container>\n    )\n  })\n\n  const ErrorDisplay = observer(({ errorMessage }) => {\n    const classes = useStyles()\n    return (\n      <Card className={classes.errorCard}>\n        <CardContent>\n          <Typography variant=\"h6\" color=\"error\">\n            {String(errorMessage)}\n          </Typography>\n        </CardContent>\n      </Card>\n    )\n  })\n\n  const ImportWizard = observer(({ model }) => {\n    const classes = useStyles()\n    return (\n      <>\n        {model.error ? (\n          <Container className={classes.errorContainer}>\n            <ErrorDisplay errorMessage={`${model.error}`} />\n          </Container>\n        ) : null}\n        <ImportForm model={model} />\n      </>\n    )\n  })\n\n  return ImportWizard\n}\n","import CheckIcon from '@material-ui/icons/Check'\nimport FilterListIcon from '@material-ui/icons/FilterList'\nimport PermDataSettingIcon from '@material-ui/icons/PermDataSetting'\nimport SortIcon from '@material-ui/icons/Sort'\n\nexport default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { observer } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n\n  const { iterMap } = jbrequire('@jbrowse/core/util')\n  const { Menu } = jbrequire('@jbrowse/core/ui')\n\n  const ColumnMenu = observer(\n    ({ viewModel, spreadsheetModel, currentColumnMenu, setColumnMenu }) => {\n      const columnMenuClose = () => {\n        setColumnMenu(null)\n      }\n\n      function handleMenuItemClick(event, callback) {\n        callback()\n        columnMenuClose(null)\n      }\n\n      const columnNumber = currentColumnMenu && currentColumnMenu.colNumber\n\n      const sortMenuClick = descending => {\n        spreadsheetModel.setSortColumns([\n          {\n            columnNumber,\n            descending,\n          },\n        ])\n      }\n\n      const filterMenuClick = () => {\n        viewModel.filterControls.addBlankColumnFilter(columnNumber)\n      }\n\n      const { dataTypeChoices } = spreadsheetModel\n\n      // make a Map of categoryName => [entry...]\n      const dataTypeTopLevelMenu = new Map()\n      dataTypeChoices.forEach(dataTypeRecord => {\n        const { displayName, categoryName } = dataTypeRecord\n        if (categoryName) {\n          if (!dataTypeTopLevelMenu.has(categoryName)) {\n            dataTypeTopLevelMenu.set(categoryName, {\n              isCategory: true,\n              subMenuItems: [],\n            })\n          }\n          dataTypeTopLevelMenu\n            .get(categoryName)\n            .subMenuItems.push(dataTypeRecord)\n        } else {\n          dataTypeTopLevelMenu.set(displayName, dataTypeRecord)\n        }\n      })\n\n      const dataType =\n        currentColumnMenu && spreadsheetModel.columns[columnNumber].dataType\n      const dataTypeName = (dataType && dataType.type) || ''\n      const dataTypeDisplayName =\n        (currentColumnMenu &&\n          spreadsheetModel.columns[columnNumber].dataType.displayName) ||\n        ''\n\n      const isSortingAscending = Boolean(\n        spreadsheetModel.sortColumns.length &&\n          currentColumnMenu &&\n          spreadsheetModel.sortColumns.find(\n            col =>\n              col.columnNumber === currentColumnMenu.colNumber &&\n              !col.descending,\n          ),\n      )\n      const isSortingDescending = Boolean(\n        spreadsheetModel.sortColumns.length &&\n          currentColumnMenu &&\n          spreadsheetModel.sortColumns.find(\n            col =>\n              col.columnNumber === currentColumnMenu.colNumber &&\n              col.descending,\n          ),\n      )\n      function stopSortingClick() {\n        columnMenuClose()\n        spreadsheetModel.setSortColumns([])\n      }\n\n      const menuItems = [\n        // top-level column menu\n        {\n          label: 'Sort ascending',\n          icon: SortIcon,\n          type: 'radio',\n          checked: isSortingAscending,\n          onClick: isSortingAscending\n            ? stopSortingClick\n            : sortMenuClick.bind(null, false),\n        },\n        {\n          label: 'Sort descending',\n          icon: SortIcon,\n          type: 'radio',\n          checked: isSortingDescending,\n          onClick: isSortingDescending\n            ? stopSortingClick\n            : sortMenuClick.bind(null, true),\n        },\n        // data type menu\n        {\n          label: `Type: ${dataTypeDisplayName}`,\n          icon: PermDataSettingIcon,\n          subMenu: iterMap(\n            dataTypeTopLevelMenu.entries(),\n            ([displayName, record]) => {\n              const { subMenuItems, typeName } = record\n              if (typeName) {\n                const menuEntry = {\n                  label: displayName || typeName,\n                  onClick: () => {\n                    spreadsheetModel.setColumnType(columnNumber, typeName)\n                  },\n                }\n                if (dataTypeName === typeName) {\n                  menuEntry.icon = CheckIcon\n                }\n                return menuEntry\n              }\n              if (subMenuItems) {\n                return {\n                  label: displayName,\n                  icon: subMenuItems.find(i => i.typeName === dataTypeName)\n                    ? CheckIcon\n                    : undefined,\n                  subMenu: subMenuItems.map(\n                    ({\n                      typeName: subTypeName,\n                      displayName: subDisplayName,\n                    }) => ({\n                      label: subDisplayName,\n                      icon:\n                        subTypeName === dataTypeName ? CheckIcon : undefined,\n                      onClick: () => {\n                        spreadsheetModel.setColumnType(\n                          columnNumber,\n                          subTypeName,\n                        )\n                      },\n                    }),\n                  ),\n                }\n              }\n              return null\n            },\n          ).filter(Boolean),\n        },\n      ]\n\n      // don't display the filter item if this data type doesn't have filtering\n      // implemented\n      if (dataType && dataType.hasFilter) {\n        menuItems.push({\n          label: 'Create filter',\n          icon: FilterListIcon,\n          onClick: filterMenuClick.bind(null, true),\n        })\n      }\n\n      return (\n        <Menu\n          anchorEl={currentColumnMenu && currentColumnMenu.anchorEl}\n          open={Boolean(currentColumnMenu)}\n          onMenuItemClick={handleMenuItemClick}\n          onClose={columnMenuClose}\n          menuItems={menuItems}\n          anchorOrigin={{\n            vertical: 'bottom',\n            horizontal: 'right',\n          }}\n        />\n      )\n    },\n  )\n  return ColumnMenu\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { Menu, MenuItem } from '@jbrowse/core/ui'\nimport { InstanceOfModelReturnedBy } from '@jbrowse/core/util'\n\nimport SpreadsheetModelF from '../models/Spreadsheet'\nimport ViewModelF from '../models/SpreadsheetView'\n\nexport interface Props {\n  viewModel: InstanceOfModelReturnedBy<typeof ViewModelF>\n  spreadsheetModel: InstanceOfModelReturnedBy<typeof SpreadsheetModelF>\n}\n\nexport default (pluginManager: PluginManager) => {\n  const { lib } = pluginManager\n  const { observer } = lib['mobx-react']\n  const React = lib.react\n\n  const RowMenu = observer(({ viewModel, spreadsheetModel }: Props) => {\n    const currentRowMenu = spreadsheetModel.rowMenuPosition\n    const { setRowMenuPosition } = spreadsheetModel\n\n    const rowMenuClose = () => {\n      setRowMenuPosition(null)\n    }\n\n    const rowNumber = spreadsheetModel.rowMenuPosition?.rowNumber\n    if (rowNumber === undefined) return null\n\n    const row = spreadsheetModel.rowSet.rows[rowNumber - 1]\n\n    function handleMenuItemClick(_event: unknown, callback: Function) {\n      callback(viewModel, spreadsheetModel, rowNumber, row)\n      rowMenuClose()\n    }\n\n    // got through and evaluate all the `disabled` callbacks of the menu items\n    const menuItems: MenuItem[] = viewModel.rowMenuItems.map(item => {\n      if (typeof item.disabled === 'function') {\n        const disabled = item.disabled(\n          viewModel,\n          spreadsheetModel,\n          rowNumber,\n          row,\n        )\n        return { ...item, disabled }\n      }\n      return item\n    })\n\n    return (\n      <Menu\n        anchorEl={currentRowMenu && currentRowMenu.anchorEl}\n        open={Boolean(currentRowMenu)}\n        onMenuItemClick={handleMenuItemClick}\n        onClose={rowMenuClose}\n        menuItems={menuItems}\n        anchorOrigin={{\n          vertical: 'bottom',\n          horizontal: 'right',\n        }}\n      />\n    )\n  })\n  return RowMenu\n}\n","import KeyboardArrowUpIcon from '@material-ui/icons/KeyboardArrowUp'\nimport KeyboardArrowDownIcon from '@material-ui/icons/KeyboardArrowDown'\nimport CropFreeIcon from '@material-ui/icons/CropFree'\nimport ArrowDropDown from '@material-ui/icons/ArrowDropDown'\nimport ColumnMenuFactory from './ColumnMenu'\nimport RowMenuFactory from './RowMenu'\n\n/* eslint-disable react/prop-types */\nexport function numToColName(num) {\n  function letterFor(n) {\n    return String.fromCharCode(n + 65)\n  }\n  if (num >= 0) {\n    if (num < 26) {\n      return letterFor(num)\n    }\n    if (num < 27 * 26) {\n      return letterFor(Math.floor(num / 26 - 1)) + letterFor(num % 26)\n    }\n  }\n\n  throw new RangeError('column number out of range')\n}\n\nexport default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { observer, PropTypes: MobxPropTypes } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n  const { useState } = React\n  const ReactPropTypes = jbrequire('prop-types')\n  const { getParent } = jbrequire('mobx-state-tree')\n\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const { grey, indigo } = jbrequire('@material-ui/core/colors')\n  const Checkbox = jbrequire('@material-ui/core/Checkbox')\n  const IconButton = jbrequire('@material-ui/core/IconButton')\n  const Tooltip = jbrequire('@material-ui/core/Tooltip')\n  const FormControlLabel = jbrequire('@material-ui/core/FormControlLabel')\n\n  const ColumnMenu = jbrequire(ColumnMenuFactory)\n  const RowMenu = jbrequire(RowMenuFactory)\n\n  const useStyles = makeStyles(theme => {\n    return {\n      root: {\n        position: 'relative',\n        marginBottom: theme.spacing(1),\n        background: grey[500],\n        overflow: 'auto',\n      },\n      dataTable: {\n        borderCollapse: 'collapse',\n        borderSpacing: 0,\n        boxSizing: 'border-box',\n        '& td': {\n          border: `1px solid ${grey[300]}`,\n          padding: '0.2rem',\n          maxWidth: '50em',\n          overflow: 'hidden',\n          textOverflow: 'ellipsis',\n        },\n      },\n      dataTableBody: {\n        background: 'white',\n      },\n      rowNumCell: {\n        background: grey[200],\n        textAlign: 'left',\n        border: `1px solid ${grey[300]}`,\n        position: 'relative',\n        padding: '0 2px 0 0',\n        whiteSpace: 'nowrap',\n        userSelect: 'none',\n      },\n      rowNumber: {\n        fontWeight: 'normal',\n        display: 'inline-block',\n        flex: 'none',\n        paddingRight: '20px',\n        margin: 0,\n        whiteSpace: 'nowrap',\n      },\n      rowMenuButton: {\n        padding: 0,\n        margin: 0,\n        position: 'absolute',\n        right: 0,\n        display: 'inline-block',\n        whiteSpace: 'nowrap',\n        flex: 'none',\n      },\n      rowMenuButtonIcon: {},\n      rowSelector: {\n        position: 'relative',\n        top: '-2px',\n        margin: 0,\n        padding: '0 0.2rem',\n      },\n      columnHead: {\n        fontWeight: 'normal',\n        background: grey[200],\n        border: `1px solid ${grey[300]}`,\n        position: 'sticky',\n        top: '-1px',\n        zIndex: 2,\n        whiteSpace: 'nowrap',\n        padding: [[0, theme.spacing(1)]],\n      },\n      sortIndicator: {\n        position: 'relative',\n        top: '0.2rem',\n        fontSize: '1rem',\n      },\n      columnButtonContainer: {\n        display: 'none',\n        position: 'absolute',\n        right: 0,\n        top: 0,\n        background: grey[100],\n        height: '100%',\n        boxSizing: 'border-box',\n        borderLeft: `1px solid ${grey[300]}`,\n      },\n      columnButton: {\n        padding: 0,\n      },\n      topLeftCorner: {\n        background: grey[300],\n        position: 'sticky',\n        top: '-1px',\n        zIndex: 2,\n        minWidth: theme.spacing(2),\n        textAlign: 'left',\n      },\n      dataRowSelected: {\n        background: indigo[100],\n        '& th': {\n          background: indigo[100],\n        },\n      },\n      emptyMessage: { captionSide: 'bottom' },\n    }\n  })\n\n  const CellData = observer(({ cell, spreadsheetModel, columnNumber }) => {\n    const { dataType } = spreadsheetModel.columns.get(columnNumber)\n    if (dataType.DataCellReactComponent) {\n      return (\n        <dataType.DataCellReactComponent\n          cell={cell}\n          dataType={dataType}\n          columnNumber={columnNumber}\n          spreadsheet={spreadsheetModel}\n        />\n      )\n    }\n\n    return cell.text\n  })\n\n  const DataRow = observer(({ rowModel, rowNumber, spreadsheetModel }) => {\n    const classes = useStyles()\n    const { hideRowSelection, columnDisplayOrder } = spreadsheetModel\n    let rowClass = classes.dataRow\n    if (rowModel.isSelected) rowClass += ` ${classes.dataRowSelected}`\n\n    function labelClick(evt) {\n      rowModel.toggleSelect()\n      evt.stopPropagation()\n      evt.preventDefault()\n    }\n\n    function rowButtonClick(event) {\n      spreadsheetModel.setRowMenuPosition({\n        anchorEl: event.currentTarget,\n        rowNumber,\n      })\n      event.preventDefault()\n      event.stopPropagation()\n    }\n\n    return (\n      <tr className={rowClass}>\n        <th className={classes.rowNumCell} onClick={labelClick}>\n          <FormControlLabel\n            className={classes.rowNumber}\n            control={\n              hideRowSelection ? null : (\n                <Checkbox\n                  className={classes.rowSelector}\n                  checked={rowModel.isSelected}\n                  onClick={labelClick}\n                />\n              )\n            }\n            label={rowModel.id}\n          />\n          <IconButton\n            className={classes.rowMenuButton}\n            onClick={rowButtonClick}\n            color=\"secondary\"\n          >\n            <ArrowDropDown className={classes.rowMenuButtonIcon} />\n          </IconButton>\n        </th>\n        {columnDisplayOrder.map(colNumber => (\n          <td key={colNumber}>\n            {rowModel.cellsWithDerived.length > colNumber ? (\n              <CellData\n                cell={rowModel.cellsWithDerived[colNumber]}\n                spreadsheetModel={spreadsheetModel}\n                columnNumber={colNumber}\n              />\n            ) : null}\n          </td>\n        ))}\n      </tr>\n    )\n  })\n\n  function SortIndicator({ model, columnNumber }) {\n    const classes = useStyles()\n    const sortSpec = model.sortColumns.find(\n      c => c.columnNumber === columnNumber,\n    )\n\n    if (sortSpec) {\n      const { descending } = sortSpec\n      return descending ? (\n        <KeyboardArrowUpIcon className={classes.sortIndicator} />\n      ) : (\n        <KeyboardArrowDownIcon className={classes.sortIndicator} />\n      )\n    }\n    return null\n  }\n\n  const DataTableBody = observer(\n    ({ rows, spreadsheetModel, page, rowsPerPage }) => {\n      const classes = useStyles()\n      return (\n        <tbody className={classes.dataTableBody}>\n          {rows.slice(rowsPerPage * page, rowsPerPage * (page + 1)).map(row => (\n            <DataRow\n              key={row.id}\n              rowNumber={row.id}\n              spreadsheetModel={spreadsheetModel}\n              rowModel={row}\n            />\n          ))}\n        </tbody>\n      )\n    },\n  )\n\n  const DataTable = observer(({ model, page, rowsPerPage }) => {\n    const { columnDisplayOrder, columns, hasColumnNames, rowSet } = model\n    const classes = useStyles()\n\n    // column menu active state\n    const [currentColumnMenu, setColumnMenu] = useState(null)\n    function columnButtonClick(colNumber, evt) {\n      setColumnMenu({\n        colNumber,\n        anchorEl: evt.currentTarget,\n      })\n    }\n\n    // column header hover state\n    const [currentHoveredColumn, setHoveredColumn] = useState(null)\n    function columnHeaderMouseOver(colNumber /* , evt */) {\n      setHoveredColumn(colNumber)\n    }\n    function columnHeaderMouseOut(/* colNumber, evt */) {\n      setHoveredColumn(null)\n    }\n\n    const totalRows = rowSet.count\n    const rows = rowSet.sortedFilteredRows\n\n    return (\n      <>\n        <ColumnMenu\n          viewModel={getParent(model)}\n          spreadsheetModel={model}\n          currentColumnMenu={currentColumnMenu}\n          setColumnMenu={setColumnMenu}\n        />\n        <RowMenu viewModel={getParent(model)} spreadsheetModel={model} />\n        <table className={classes.dataTable}>\n          <thead>\n            <tr>\n              <th className={classes.topLeftCorner}>\n                <Tooltip title=\"Unselect all\" placement=\"right\">\n                  <span>\n                    <IconButton\n                      className={classes.unselectAllButton}\n                      onClick={model.unselectAll}\n                      disabled={!model.rowSet.selectedCount}\n                      color=\"secondary\"\n                    >\n                      <CropFreeIcon className={classes.columnButtonIcon} />\n                    </IconButton>\n                  </span>\n                </Tooltip>\n              </th>\n              {columnDisplayOrder.map(colNumber => (\n                <th\n                  className={classes.columnHead}\n                  key={colNumber}\n                  onMouseOver={columnHeaderMouseOver.bind(null, colNumber)}\n                  onMouseOut={columnHeaderMouseOut.bind(null, colNumber)}\n                >\n                  <SortIndicator model={model} columnNumber={colNumber} />\n                  {(hasColumnNames && columns.get(colNumber).name) ||\n                    numToColName(colNumber)}\n                  <div\n                    className={classes.columnButtonContainer}\n                    style={{\n                      display:\n                        currentHoveredColumn === colNumber ||\n                        (currentColumnMenu &&\n                          currentColumnMenu.colNumber === colNumber)\n                          ? 'block'\n                          : 'none',\n                    }}\n                  >\n                    <IconButton\n                      className={classes.columnButton}\n                      onClick={columnButtonClick.bind(null, colNumber)}\n                      color=\"secondary\"\n                    >\n                      <ArrowDropDown className={classes.columnButtonIcon} />\n                    </IconButton>\n                  </div>\n                </th>\n              ))}\n            </tr>\n          </thead>\n          <DataTableBody\n            rows={rows}\n            spreadsheetModel={model}\n            page={page}\n            rowsPerPage={rowsPerPage}\n          />\n          {!rows.length ? (\n            <caption className={classes.emptyMessage}>\n              {totalRows ? 'no rows match criteria' : 'no rows present'}\n            </caption>\n          ) : null}\n        </table>\n      </>\n    )\n  })\n\n  function Spreadsheet({ model, height, page, rowsPerPage }) {\n    const classes = useStyles()\n\n    return (\n      <div className={classes.root} style={{ height }}>\n        {model && model.rowSet && model.rowSet.isLoaded && model.initialized ? (\n          <DataTable model={model} page={page} rowsPerPage={rowsPerPage} />\n        ) : (\n          <div>Loading...</div>\n        )}\n      </div>\n    )\n  }\n  Spreadsheet.propTypes = {\n    model: MobxPropTypes.objectOrObservableObject,\n    height: ReactPropTypes.number.isRequired,\n  }\n  Spreadsheet.defaultProps = {\n    model: undefined,\n  }\n  return observer(Spreadsheet)\n}\n","import ClearIcon from '@material-ui/icons/Clear'\nimport FilterIcon from '@material-ui/icons/FilterList'\n\nexport default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { observer } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n  const { useEffect, useState } = React\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const IconButton = jbrequire('@material-ui/core/IconButton')\n  const InputAdornment = jbrequire('@material-ui/core/InputAdornment')\n  const { useDebounce } = jbrequire('@jbrowse/core/util')\n  const TextField = jbrequire('@material-ui/core/TextField')\n\n  const useStyles = makeStyles((/* theme */) => {\n    return {\n      textFilterControlEndAdornment: { marginRight: '-18px' },\n    }\n  })\n\n  const TextFilter = observer(({ textFilter }) => {\n    const classes = useStyles()\n    // this paragraph is silliness to debounce the text filter input\n    const [textFilterValue, setTextFilterValue] = useState(\n      textFilter.stringToFind,\n    )\n    const debouncedTextFilter = useDebounce(textFilterValue, 500)\n    useEffect(() => {\n      textFilter.setString(debouncedTextFilter)\n    }, [debouncedTextFilter, textFilter])\n\n    return (\n      <div className={classes.filterControls}>\n        <TextField\n          label=\"text filter\"\n          value={textFilterValue}\n          onChange={evt => setTextFilterValue(evt.target.value)}\n          className={classes.textFilterControl}\n          variant=\"outlined\"\n          InputProps={{\n            startAdornment: (\n              <InputAdornment\n                className={classes.textFilterControlStartAdornment}\n                position=\"start\"\n              >\n                <FilterIcon />\n              </InputAdornment>\n            ),\n            endAdornment: (\n              <InputAdornment\n                className={classes.textFilterControlEndAdornment}\n                position=\"end\"\n              >\n                <IconButton\n                  aria-label=\"clear filter\"\n                  onClick={() => setTextFilterValue('')}\n                  color=\"secondary\"\n                >\n                  <ClearIcon />\n                </IconButton>\n              </InputAdornment>\n            ),\n          }}\n        />\n      </div>\n    )\n  })\n\n  const FilterControls = observer(({ model }) => {\n    // const classes = useStyles()\n    const textFilter = model.filterControls.rowFullText\n    return <TextFilter textFilter={textFilter} />\n  })\n\n  return FilterControls\n}\n","import FilterIcon from '@material-ui/icons/FilterList'\nimport CloseIcon from '@material-ui/icons/Close'\n\nexport default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { observer, PropTypes: MobxPropTypes } = jbrequire('mobx-react')\n  const { getParent } = jbrequire('mobx-state-tree')\n  const React = jbrequire('react')\n\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n\n  const Grid = jbrequire('@material-ui/core/Grid')\n  const IconButton = jbrequire('@material-ui/core/IconButton')\n  const Typography = jbrequire('@material-ui/core/Typography')\n\n  const useStyles = makeStyles(theme => {\n    return {\n      columnName: { verticalAlign: 'middle', paddingRight: '0.3em' },\n      columnFilter: {\n        overflow: 'hidden',\n        whiteSpace: 'nowrap',\n        boxSizing: 'border-box',\n        width: '100%',\n        position: 'relative',\n      },\n      filterIcon: { position: 'relative', top: '12px' },\n      filterIconBg: {\n        background: theme.palette.tertiary.main,\n        color: 'white',\n        padding: [[0, theme.spacing(1.5)]],\n      },\n    }\n  })\n\n  function FilterOperations({ filterModel }) {\n    if (filterModel) {\n      return <filterModel.ReactComponent filterModel={filterModel} />\n    }\n    return null\n  }\n  FilterOperations.propTypes = {\n    filterModel: MobxPropTypes.observableObject.isRequired,\n  }\n\n  const ColumnFilterControls = observer(\n    ({ viewModel, filterModel, columnNumber, height }) => {\n      const classes = useStyles()\n\n      const removeFilter = () => {\n        const filterControls = getParent(filterModel, 2)\n        filterControls.removeColumnFilter(filterModel)\n      }\n\n      const columnDefinition = viewModel.spreadsheet.columns[columnNumber]\n      if (!columnDefinition)\n        throw new Error(\n          'no column definition! filters are probably out of date',\n        )\n      return (\n        <Grid\n          container\n          direction=\"row\"\n          className={classes.columnFilter}\n          style={{ height }}\n        >\n          <Grid item className={classes.filterIconBg}>\n            <FilterIcon className={classes.filterIcon} />\n          </Grid>\n          <Grid item>\n            <IconButton\n              onClick={removeFilter}\n              title=\"remove filter\"\n              color=\"secondary\"\n            >\n              <CloseIcon />\n            </IconButton>\n            <Typography className={classes.columnName} component=\"span\">\n              {columnDefinition.name}\n            </Typography>{' '}\n            <FilterOperations filterModel={filterModel} />\n          </Grid>\n        </Grid>\n      )\n    },\n  )\n\n  return ColumnFilterControls\n}\n","import FolderOpenIcon from '@material-ui/icons/FolderOpen'\nimport ImportWizardFactory from './ImportWizard'\nimport SpreadsheetFactory from './Spreadsheet'\nimport GlobalFilterControlsFactory from './GlobalFilterControls'\nimport ColumnFilterControlsFactory from './ColumnFilterControls'\n\nexport default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { observer, PropTypes } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n  const IconButton = jbrequire('@material-ui/core/IconButton')\n  const { FormGroup, TablePagination } = jbrequire('@material-ui/core')\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const Grid = jbrequire('@material-ui/core/Grid')\n  const { ResizeHandle } = jbrequire('@jbrowse/core/ui')\n\n  const ImportWizard = jbrequire(ImportWizardFactory)\n  const Spreadsheet = jbrequire(SpreadsheetFactory)\n  const GlobalFilterControls = jbrequire(GlobalFilterControlsFactory)\n  const ColumnFilterControls = jbrequire(ColumnFilterControlsFactory)\n\n  const headerHeight = 52\n  const colFilterHeight = 46\n  const statusBarHeight = 40\n\n  const useStyles = makeStyles(theme => ({\n    root: {\n      position: 'relative',\n      marginBottom: theme.spacing(1),\n      background: 'white',\n      overflow: 'hidden',\n    },\n    header: {\n      overflow: 'hidden',\n      whiteSpace: 'nowrap',\n      boxSizing: 'border-box',\n      height: headerHeight,\n      paddingLeft: theme.spacing(1),\n    },\n    contentArea: { overflow: 'auto' },\n    columnFilter: {\n      overflow: 'hidden',\n      whiteSpace: 'nowrap',\n      boxSizing: 'border-box',\n      height: headerHeight,\n      paddingLeft: theme.spacing(1),\n    },\n    viewControls: {\n      margin: 0,\n    },\n    rowCount: {\n      marginLeft: theme.spacing(1),\n    },\n    statusBar: {\n      position: 'absolute',\n      background: theme.palette.background.light,\n      left: 0,\n      bottom: 0,\n      height: statusBarHeight,\n      width: '100%',\n      boxSizing: 'border-box',\n      borderTop: '1px outset #b1b1b1',\n      paddingLeft: theme.spacing(1),\n    },\n    verticallyCenter: {\n      display: 'flex',\n      justifyContent: 'center',\n      flexDirection: 'column',\n    },\n    spacer: {\n      flexGrow: 1,\n    },\n    textFilterControlAdornment: { marginRight: '-18px' },\n  }))\n\n  const ViewControls = observer(({ model }) => {\n    const classes = useStyles()\n    return (\n      <Grid\n        className={classes.viewControls}\n        container\n        spacing={1}\n        direction=\"row\"\n        alignItems=\"center\"\n      >\n        <Grid item>\n          <IconButton\n            onClick={() => model.setImportMode()}\n            className={classes.iconButton}\n            title=\"open a tabular file\"\n            data-testid=\"spreadsheet_view_open\"\n            color=\"secondary\"\n          >\n            <FolderOpenIcon />\n          </IconButton>\n        </Grid>\n      </Grid>\n    )\n  })\n\n  const RowCountMessage = observer(({ spreadsheet }) => {\n    if (spreadsheet && spreadsheet.rowSet.isLoaded) {\n      const {\n        passingFiltersCount,\n        count,\n        selectedCount,\n        selectedAndPassingFiltersCount,\n      } = spreadsheet.rowSet\n\n      let rowMessage\n      if (passingFiltersCount !== count) {\n        rowMessage = `${spreadsheet.rowSet.passingFiltersCount} rows of ${spreadsheet.rowSet.count} total`\n        if (selectedCount) {\n          rowMessage += `, ${selectedAndPassingFiltersCount} selected`\n          const selectedAndNotPassingFiltersCount =\n            selectedCount - selectedAndPassingFiltersCount\n          if (selectedAndNotPassingFiltersCount) {\n            rowMessage += ` (${selectedAndNotPassingFiltersCount} selected rows do not pass filters)`\n          }\n        }\n      } else {\n        rowMessage = `${spreadsheet.rowSet.count} rows`\n        if (selectedCount) {\n          rowMessage += `, ${selectedCount} selected`\n        }\n      }\n      return rowMessage\n    }\n    return null\n  })\n\n  function SpreadsheetView({ model }) {\n    const classes = useStyles()\n\n    const { spreadsheet, filterControls } = model\n\n    const colFilterCount = filterControls.columnFilters.length\n    const [page, setPage] = React.useState(0)\n    const [rowsPerPage, setRowsPerPage] = React.useState(100)\n\n    const handleChangePage = (event, newPage) => {\n      setPage(newPage)\n    }\n\n    const handleChangeRowsPerPage = event => {\n      setRowsPerPage(+event.target.value)\n      setPage(0)\n    }\n\n    return (\n      <div\n        className={classes.root}\n        style={{ height: model.height, width: model.width }}\n        data-testid={model.id}\n      >\n        <Grid container direction=\"row\" className={classes.header}>\n          {model.hideViewControls ? null : (\n            <Grid item>\n              <ViewControls model={model} />\n            </Grid>\n          )}\n          {model.mode !== 'display' || model.hideFilterControls ? null : (\n            <Grid item>\n              <GlobalFilterControls model={model} />\n            </Grid>\n          )}\n        </Grid>\n\n        {model.mode !== 'display' || model.hideFilterControls\n          ? null\n          : model.filterControls.columnFilters.map((filter, filterNumber) => {\n              return (\n                <ColumnFilterControls\n                  key={`${filter.columnNumber}-${filterNumber}`}\n                  viewModel={model}\n                  filterModel={filter}\n                  columnNumber={filter.columnNumber}\n                  height={colFilterHeight}\n                />\n              )\n            })}\n\n        <div\n          className={classes.contentArea}\n          style={{ height: model.height - headerHeight }}\n        >\n          {model.mode !== 'import' ? null : (\n            <ImportWizard model={model.importWizard} />\n          )}\n          <div\n            style={{\n              position: 'relative',\n              display: model.mode === 'display' ? undefined : 'none',\n            }}\n          >\n            <Spreadsheet\n              page={page}\n              rowsPerPage={rowsPerPage}\n              model={spreadsheet}\n              height={\n                model.height -\n                headerHeight -\n                colFilterCount * colFilterHeight -\n                statusBarHeight\n              }\n            />\n          </div>\n        </div>\n\n        <div\n          className={classes.statusBar}\n          style={{ display: model.mode === 'display' ? undefined : 'none' }}\n        >\n          {spreadsheet ? (\n            <FormGroup row>\n              <div className={classes.verticallyCenter}>\n                <RowCountMessage spreadsheet={spreadsheet} />\n              </div>\n              <div className={classes.spacer} />\n              <TablePagination\n                rowsPerPageOptions={[10, 25, 100, 1000]}\n                count={spreadsheet.rowSet.count}\n                component=\"div\"\n                rowsPerPage={rowsPerPage}\n                page={page}\n                onChangePage={handleChangePage}\n                onChangeRowsPerPage={handleChangeRowsPerPage}\n              />\n              <div className={classes.spacer} />\n            </FormGroup>\n          ) : null}\n        </div>\n        {model.hideVerticalResizeHandle ? null : (\n          <ResizeHandle\n            onDrag={model.resizeHeight}\n            style={{\n              height: model.dragHandleHeight,\n              position: 'absolute',\n              bottom: 0,\n              left: 0,\n              background: '#ccc',\n              boxSizing: 'border-box',\n              borderTop: '1px solid #fafafa',\n            }}\n          />\n        )}\n      </div>\n    )\n  }\n  SpreadsheetView.propTypes = {\n    model: PropTypes.objectOrObservableObject.isRequired,\n  }\n  return observer(SpreadsheetView)\n}\n","export default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { types } = jbrequire('mobx-state-tree')\n\n  /** utility function for assembling the MST model of a column data type */\n  function MakeSpreadsheetColumnType(\n    name,\n    {\n      DataCellReactComponent = null,\n      FilterModelType = null,\n      compare,\n      displayName = undefined,\n      categoryName = undefined,\n    },\n  ) {\n    return types\n      .model(`ColumnDataType${name}`, {\n        type: types.literal(name),\n      })\n      .volatile(() => ({\n        DataCellReactComponent,\n        FilterModelType,\n        displayName: displayName || name,\n        categoryName,\n      }))\n      .views(() => ({\n        compare,\n        get hasFilter() {\n          return !!FilterModelType\n        },\n      }))\n  }\n\n  return MakeSpreadsheetColumnType\n}\n","import { doesIntersect2, isContainedWithin } from '@jbrowse/core/util/range'\nimport ClearIcon from '@material-ui/icons/Clear'\nimport { when } from '@jbrowse/core/util'\nimport MakeSpreadsheetColumnTypeFactory from './MakeSpreadsheetColumnType'\n\nexport default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { types, getType, getParent } = jbrequire('mobx-state-tree')\n  const { observer } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n\n  const { getPropertyType, getEnumerationValues, getSubType } = jbrequire(\n    '@jbrowse/core/util/mst-reflection',\n  )\n\n  const { compareLocs, getSession, parseLocString } = jbrequire(\n    '@jbrowse/core/util',\n  )\n\n  const MakeSpreadsheetColumnType = jbrequire(MakeSpreadsheetColumnTypeFactory)\n\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const IconButton = jbrequire('@material-ui/core/IconButton')\n  const TextField = jbrequire('@material-ui/core/TextField')\n  const MenuItem = jbrequire('@material-ui/core/MenuItem')\n  const InputAdornment = jbrequire('@material-ui/core/InputAdornment')\n  const Select = jbrequire('@material-ui/core/Select')\n\n  const useStyles = makeStyles((/* theme */) => {\n    return {\n      textFilterControlAdornment: { marginRight: '-18px' },\n      textFilterControl: {\n        margin: [[0, 0, 0, '0.4rem']],\n        '& .MuiInput-formControl': {\n          marginTop: 8,\n        },\n        '& .MuiInputLabel-formControl': {\n          top: '-7px',\n          '&.MuiInputLabel-shrink': {\n            top: '-3px',\n          },\n        },\n      },\n    }\n  })\n\n  // React component for the column filter control\n  const FilterReactComponent = observer(({ filterModel }) => {\n    const classes = useStyles()\n    const operationChoices = getEnumerationValues(\n      getSubType(getPropertyType(getType(filterModel), 'operation')),\n    )\n    return (\n      <>\n        <Select\n          value={filterModel.operation}\n          onChange={event => {\n            filterModel.setOperation(String(event.target.value))\n          }}\n        >\n          {operationChoices.map(name => (\n            <MenuItem key={name} value={name}>\n              {name}\n            </MenuItem>\n          ))}\n        </Select>{' '}\n        <TextField\n          label=\"range\"\n          placeholder=\"chr1:100-200\"\n          error={filterModel.locStringIsInvalid}\n          value={filterModel.locString}\n          onChange={evt => filterModel.setLocString(evt.target.value)}\n          className={classes.textFilterControl}\n          InputProps={{\n            endAdornment: (\n              <InputAdornment\n                className={classes.textFilterControlAdornment}\n                position=\"end\"\n              >\n                <IconButton\n                  aria-label=\"clear filter\"\n                  onClick={() => filterModel.setLocString('')}\n                  color=\"secondary\"\n                >\n                  <ClearIcon />\n                </IconButton>\n              </InputAdornment>\n            ),\n          }}\n        />\n      </>\n    )\n  })\n\n  const OPERATIONS = [\n    'overlaps with',\n    'contained within',\n    'fully contains',\n    'does not overlap',\n    'not contained within',\n    'does not contain',\n  ]\n\n  // NOTE: assembly names, if present, are ignored in all of these predicates\n  const OPERATION_PREDICATES = {\n    'overlaps with': (cellLocation, specifiedLocation) => {\n      return (\n        cellLocation.refName === specifiedLocation.refName &&\n        doesIntersect2(\n          cellLocation.start,\n          cellLocation.end,\n          specifiedLocation.start,\n          specifiedLocation.end,\n        )\n      )\n    },\n    'contained within': (cellLocation, specifiedLocation) => {\n      return (\n        cellLocation.refName === specifiedLocation.refName &&\n        isContainedWithin(\n          cellLocation.start,\n          cellLocation.end,\n          specifiedLocation.start,\n          specifiedLocation.end,\n        )\n      )\n    },\n    'fully contains': (cellLocation, specifiedLocation) => {\n      return (\n        cellLocation.refName === specifiedLocation.refName &&\n        isContainedWithin(\n          specifiedLocation.start,\n          specifiedLocation.end,\n          cellLocation.start,\n          cellLocation.end,\n        )\n      )\n    },\n  }\n  OPERATION_PREDICATES['does not overlap'] = (\n    cellLocation,\n    specifiedLocation,\n  ) => {\n    return !OPERATION_PREDICATES['overlaps with'](\n      cellLocation,\n      specifiedLocation,\n    )\n  }\n  OPERATION_PREDICATES['not contained within'] = (\n    cellLocation,\n    specifiedLocation,\n  ) => {\n    return !OPERATION_PREDICATES['contained within'](\n      cellLocation,\n      specifiedLocation,\n    )\n  }\n  OPERATION_PREDICATES['does not contain'] = (\n    cellLocation,\n    specifiedLocation,\n  ) => {\n    return !OPERATION_PREDICATES['fully contains'](\n      cellLocation,\n      specifiedLocation,\n    )\n  }\n\n  // MST model for the column filter control\n  const FilterModelType = types\n    .model('ColumnLocStringFilter', {\n      type: types.literal('LocString'),\n      columnNumber: types.integer,\n      locString: '',\n      operation: types.optional(types.enumeration(OPERATIONS), OPERATIONS[0]),\n    })\n    .views(self => ({\n      get locStringIsInvalid() {\n        if (self.locString) {\n          const parsed = self.parsedLocString\n          return (\n            !parsed ||\n            parsed.refName === '' ||\n            typeof parsed.start !== 'number' ||\n            typeof parsed.end !== 'number' ||\n            parsed.start > parsed.end\n          )\n        }\n        return false\n      },\n      get parsedLocString() {\n        const session = getSession(self)\n        const model = getParent(self, 3).spreadsheet\n        const { assemblyName } = model\n        try {\n          return parseLocString(self.locString, refName =>\n            session.assemblyManager.isValidRefName(refName, assemblyName),\n          )\n        } catch (e) {\n          return undefined\n        }\n      },\n      // returns a function that tests the given row\n      get predicate() {\n        if (!self.locString || self.locStringIsInvalid) {\n          return function alwaysTrue() {\n            return true\n          }\n        }\n\n        const { parsedLocString, operation, columnNumber } = self // avoid closing over self\n        return function stringPredicate(sheet, row) {\n          const { cellsWithDerived: cells } = row\n          const cell = cells[columnNumber]\n\n          if (!cell || !cell.text || !cell.extendedData) {\n            return false\n          }\n          const parsedCellText = cell.extendedData\n          if (!parsedCellText.refName) {\n            return false\n          }\n\n          const predicate = OPERATION_PREDICATES[operation]\n          if (!predicate) {\n            throw new Error(`\"${operation}\" not implemented in location filter`)\n          }\n\n          return predicate(parsedCellText, parsedLocString)\n        }\n      },\n    }))\n    .actions(self => ({\n      setLocString(s) {\n        self.locString = s\n      },\n      setOperation(op) {\n        self.operation = op\n      },\n    }))\n    .volatile(() => ({ ReactComponent: FilterReactComponent }))\n\n  // opens a new LGV at the location described in the locString in the cell text\n  async function locationLinkClick(spreadsheet, columnNumber, cell) {\n    const session = getSession(spreadsheet)\n    const { assemblyManager } = session\n    const { assemblyName } = spreadsheet\n    const { id } = getParent(spreadsheet)\n    const assembly = await assemblyManager.waitForAssembly(assemblyName)\n    try {\n      const loc = parseLocString(cell.text, name =>\n        assemblyManager.isValidRefName(name, spreadsheet.assemblyName),\n      )\n      const { refName } = loc\n      const canonicalRefName = assembly.getCanonicalRefName(refName)\n      const newDisplayedRegion = assembly.regions.find(\n        region => region.refName === canonicalRefName,\n      )\n\n      const newViewId = `${id}_${assemblyName}`\n      let view = session.views.find(v => v.id === newViewId)\n      if (!view) {\n        view = session.addView('LinearGenomeView', {\n          displayName: assemblyName,\n          id: newViewId,\n        })\n\n        // note that we have to clone this because otherwise it adds \"same object\n        // twice to the mst tree\"\n        view.setDisplayedRegions([\n          JSON.parse(JSON.stringify(newDisplayedRegion)),\n        ])\n        await when(() => view.initialized)\n      }\n      view.navToLocString(cell.text)\n    } catch (e) {\n      session.notify(`${e}`, 'error')\n    }\n  }\n\n  const DataCellReactComponent = observer(\n    ({ cell, columnNumber, spreadsheet }) => {\n      function click(evt) {\n        evt.preventDefault()\n        locationLinkClick(spreadsheet, columnNumber, cell)\n      }\n      return (\n        <a\n          onClick={click}\n          title=\"open a new linear genome view here\"\n          href=\"#link\"\n        >\n          {cell.text}\n        </a>\n      )\n    },\n  )\n\n  const LocStringColumnType = MakeSpreadsheetColumnType('LocString', {\n    categoryName: 'Location',\n    displayName: 'Full location',\n    compare(cellA, cellB) {\n      return compareLocs(cellA.extendedData, cellB.extendedData)\n    },\n    FilterModelType,\n    DataCellReactComponent,\n  })\n\n  return LocStringColumnType\n}\n","import ClearIcon from '@material-ui/icons/Clear'\nimport MakeSpreadsheetColumnTypeFactory from './MakeSpreadsheetColumnType'\n\nexport default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { types, getType } = jbrequire('mobx-state-tree')\n  const { observer } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n\n  const { getPropertyType, getEnumerationValues, getSubType } = jbrequire(\n    '@jbrowse/core/util/mst-reflection',\n  )\n\n  const MakeSpreadsheetColumnType = jbrequire(MakeSpreadsheetColumnTypeFactory)\n\n  const OPERATIONS = [\n    'equals',\n    'contains',\n    'does not contain',\n    'does not equal',\n    'starts with',\n    'ends with',\n  ]\n\n  // NOTE: assembly names, if present, are ignored in all of these predicates\n  const OPERATION_PREDICATES = {\n    contains: (textInCell, stringToFind) => {\n      return textInCell.toLowerCase().indexOf(stringToFind) !== -1\n    },\n    equals: (textInCell, stringToFind) => {\n      return textInCell.toLowerCase() === stringToFind\n    },\n    'starts with': (textInCell, stringToFind) => {\n      return textInCell.toLowerCase().indexOf(stringToFind) === 0\n    },\n    'ends with': (textInCell, stringToFind) => {\n      const index = textInCell.toLowerCase().indexOf(stringToFind)\n      if (index === -1) return false\n      return index === textInCell.length - stringToFind.length\n    },\n  }\n  OPERATION_PREDICATES['does not contain'] = (textInCell, stringToFind) => {\n    return !OPERATION_PREDICATES.contains(textInCell, stringToFind)\n  }\n  OPERATION_PREDICATES['does not equal'] = (textInCell, stringToFind) => {\n    return !OPERATION_PREDICATES.equals(textInCell, stringToFind)\n  }\n\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const IconButton = jbrequire('@material-ui/core/IconButton')\n  const TextField = jbrequire('@material-ui/core/TextField')\n  const MenuItem = jbrequire('@material-ui/core/MenuItem')\n  const InputAdornment = jbrequire('@material-ui/core/InputAdornment')\n  const Select = jbrequire('@material-ui/core/Select')\n\n  const useStyles = makeStyles((/* theme */) => {\n    return {\n      textFilterControlAdornment: { marginRight: '-18px' },\n      textFilterControl: {\n        margin: 0,\n        '& .MuiInput-formControl': {\n          marginTop: 8,\n        },\n        '& .MuiInputLabel-formControl': {\n          top: '-7px',\n          '&.MuiInputLabel-shrink': {\n            top: '-3px',\n          },\n        },\n      },\n    }\n  })\n\n  // React component for the column filter control\n  const FilterReactComponent = observer(({ filterModel }) => {\n    const classes = useStyles()\n    const operationChoices = getEnumerationValues(\n      getSubType(getPropertyType(getType(filterModel), 'operation')),\n    )\n    return (\n      <>\n        <Select\n          value={filterModel.operation}\n          onChange={event => {\n            filterModel.setOperation(String(event.target.value))\n          }}\n        >\n          {operationChoices.map(name => (\n            <MenuItem key={name} value={name}>\n              {name}\n            </MenuItem>\n          ))}\n        </Select>{' '}\n        <TextField\n          label=\"text\"\n          value={filterModel.stringToFind}\n          onChange={evt => filterModel.setString(evt.target.value)}\n          className={classes.textFilterControl}\n          InputProps={{\n            endAdornment: (\n              <InputAdornment\n                className={classes.textFilterControlAdornment}\n                position=\"end\"\n              >\n                <IconButton\n                  aria-label=\"clear filter\"\n                  onClick={() => filterModel.setString('')}\n                  color=\"secondary\"\n                >\n                  <ClearIcon />\n                </IconButton>\n              </InputAdornment>\n            ),\n          }}\n        />\n      </>\n    )\n  })\n\n  // MST model for the column filter control\n  const ColumnTextFilter = types\n    .model('ColumnTextFilter', {\n      type: types.literal('Text'),\n      columnNumber: types.integer,\n      stringToFind: '',\n      operation: types.optional(types.enumeration(OPERATIONS), OPERATIONS[0]),\n    })\n    .views(self => ({\n      // returns a function that tests the given row\n      get predicate() {\n        const { stringToFind, columnNumber, operation } = self // avoid closing over self\n        if (!stringToFind) {\n          return function alwaysTrue() {\n            return true\n          }\n        }\n        const s = stringToFind.toLowerCase() // case insensitive match\n        return function stringPredicate(sheet, row) {\n          const { cells } = row\n          const cell = cells[columnNumber]\n          // TODO: add support for derived cells\n          if (!cell || !cell.text) return false\n          const predicate = OPERATION_PREDICATES[operation]\n          if (!predicate)\n            throw new Error(`\"${operation}\" not implemented in location filter`)\n          return predicate(cell.text, s)\n        }\n      },\n    }))\n    .actions(self => ({\n      setString(s) {\n        self.stringToFind = s\n      },\n      setOperation(op) {\n        self.operation = op\n      },\n    }))\n    .volatile(() => ({ ReactComponent: FilterReactComponent }))\n\n  const TextColumnType = MakeSpreadsheetColumnType('Text', {\n    compare(cellA, cellB) {\n      return cellA.text.localeCompare(cellB.text)\n    },\n    FilterModelType: ColumnTextFilter,\n  })\n\n  return { TextColumn: TextColumnType, FilterModelType: ColumnTextFilter }\n}\n","import MakeSpreadsheetColumnTypeFactory from './MakeSpreadsheetColumnType'\nimport TextFactory from './Text'\n\nexport default ({ jbrequire }) => {\n  const { types } = jbrequire('mobx-state-tree')\n  const MakeSpreadsheetColumnType = jbrequire(MakeSpreadsheetColumnTypeFactory)\n\n  const { FilterModelType: NumberFilterModel } = jbrequire(TextFactory)\n\n  const FilterModelType = types.compose(\n    NumberFilterModel,\n    types.model({\n      type: types.literal('LocRef'),\n    }),\n  )\n\n  const LocRef = MakeSpreadsheetColumnType('LocRef', {\n    categoryName: 'Location',\n    displayName: 'Reference seq',\n    compare(cellA, cellB) {\n      return cellA.text.localeCompare(cellB.text)\n    },\n    FilterModelType,\n  })\n\n  return LocRef\n}\n","import MakeSpreadsheetColumnTypeFactory from './MakeSpreadsheetColumnType'\n\nexport default ({ jbrequire }) => {\n  const { types } = jbrequire('mobx-state-tree')\n  const { observer } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n\n  const MakeSpreadsheetColumnType = jbrequire(MakeSpreadsheetColumnTypeFactory)\n\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const TextField = jbrequire('@material-ui/core/TextField')\n  const MenuItem = jbrequire('@material-ui/core/MenuItem')\n  const Select = jbrequire('@material-ui/core/Select')\n\n  const OPERATIONS = [\n    'equals',\n    'greater than',\n    'less than',\n    'between',\n    'not between',\n  ]\n\n  // NOTE: assembly names, if present, are ignored in all of these predicates\n  const OPERATION_PREDICATES = {\n    equals: (numberInCell, firstNumber) => {\n      return numberInCell === firstNumber\n    },\n    'greater than': (numberInCell, firstNumber) => {\n      return numberInCell > firstNumber\n    },\n    'less than': (numberInCell, firstNumber) => {\n      return numberInCell < firstNumber\n    },\n    between: (numberInCell, firstNumber, secondNumber) => {\n      return numberInCell > firstNumber && numberInCell < secondNumber\n    },\n  }\n  OPERATION_PREDICATES['not between'] = (\n    numberInCell,\n    firstNumber,\n    secondNumber,\n  ) => {\n    return !OPERATION_PREDICATES.between(\n      numberInCell,\n      firstNumber,\n      secondNumber,\n    )\n  }\n\n  const useStyles = makeStyles((/* theme */) => {\n    return {\n      textFilterControlAdornment: { marginRight: '-18px' },\n      textFilterControl: {\n        margin: [[0, 0, 0, '0.4rem']],\n        '& .MuiInput-formControl': {\n          marginTop: 8,\n        },\n        '& .MuiInputLabel-formControl': {\n          top: '-7px',\n          '&.MuiInputLabel-shrink': {\n            top: '-3px',\n          },\n        },\n      },\n    }\n  })\n\n  // React component for the column filter control\n  const FilterReactComponent = observer(({ filterModel }) => {\n    const classes = useStyles()\n\n    const operationChoices = OPERATIONS\n\n    return (\n      <>\n        <Select\n          value={filterModel.operation}\n          onChange={event => {\n            filterModel.setOperation(String(event.target.value))\n          }}\n        >\n          {operationChoices.map(name => (\n            <MenuItem key={name} value={name}>\n              {name}\n            </MenuItem>\n          ))}\n        </Select>{' '}\n        <TextField\n          label=\"number\"\n          placeholder=\"123\"\n          type=\"number\"\n          error={filterModel.firstNumberIsInvalid}\n          defaultValue={filterModel.firstNumber}\n          onChange={evt => {\n            filterModel.setFirstNumber(parseFloat(evt.target.value))\n          }}\n          className={classes.textFilterControl}\n        />\n        {filterModel.operation !== 'between' &&\n        filterModel.operation !== 'not between' ? null : (\n          <>\n            {' and '}\n            <TextField\n              label=\"number\"\n              placeholder=\"456\"\n              type=\"number\"\n              error={filterModel.secondNumberIsInvalid}\n              defaultValue={filterModel.secondNumber}\n              onChange={evt =>\n                filterModel.setSecondNumber(parseFloat(evt.target.value))\n              }\n              className={classes.textFilterControl}\n            />\n          </>\n        )}\n      </>\n    )\n  })\n\n  // MST model for the column filter control\n  const FilterModelType = types\n    .model('ColumnNumberFilter', {\n      type: types.literal('Number'),\n      columnNumber: types.integer,\n      firstNumber: types.maybe(types.number),\n      secondNumber: types.maybe(types.number),\n      operation: types.optional(types.enumeration(OPERATIONS), OPERATIONS[0]),\n    })\n    .views(self => ({\n      // returns a function that tests the given row\n      get predicate() {\n        if (typeof self.firstNumber !== 'number')\n          return function alwaysTrue() {\n            return true\n          }\n\n        const { firstNumber, secondNumber, operation, columnNumber } = self // avoid closing over self\n        return function stringPredicate(sheet, row) {\n          const { cells } = row\n          const cell = cells[columnNumber]\n\n          if (!cell || !cell.text) return false\n\n          const parsedCellText = parseFloat(cell.text)\n          if (typeof parsedCellText !== 'number') return false\n\n          const predicate = OPERATION_PREDICATES[operation]\n          if (!predicate)\n            throw new Error(`\"${operation}\" not implemented in location filter`)\n\n          return predicate(parsedCellText, firstNumber, secondNumber)\n        }\n      },\n    }))\n    .actions(self => ({\n      setFirstNumber(n) {\n        if (Number.isNaN(n) || typeof n !== 'number')\n          self.firstNumber = undefined\n        else self.firstNumber = n\n      },\n      setSecondNumber(n) {\n        if (Number.isNaN(n) || typeof n !== 'number')\n          self.secondNumber = undefined\n        else self.secondNumber = n\n      },\n      setOperation(op) {\n        self.operation = op\n      },\n    }))\n    .volatile(() => ({ ReactComponent: FilterReactComponent }))\n\n  const NumberColumn = MakeSpreadsheetColumnType('Number', {\n    compare(cellA, cellB) {\n      return parseFloat(cellA.text) - parseFloat(cellB.text)\n    },\n    FilterModelType,\n  })\n\n  return { NumberColumn, FilterModelType }\n}\n","import MakeSpreadsheetColumnTypeFactory from './MakeSpreadsheetColumnType'\nimport NumberFactory from './Number'\n\nexport default ({ jbrequire }) => {\n  const { types } = jbrequire('mobx-state-tree')\n  const MakeSpreadsheetColumnType = jbrequire(MakeSpreadsheetColumnTypeFactory)\n\n  const { FilterModelType: NumberFilterModel } = jbrequire(NumberFactory)\n\n  const FilterModelType = types.compose(\n    NumberFilterModel,\n    types.model({\n      type: types.literal('LocStart'),\n    }),\n  )\n\n  const LocStart = MakeSpreadsheetColumnType('LocStart', {\n    categoryName: 'Location',\n    displayName: 'Start',\n    compare(cellA, cellB) {\n      return parseFloat(cellA.text) - parseFloat(cellB.text)\n    },\n    FilterModelType,\n  })\n\n  return LocStart\n}\n","import MakeSpreadsheetColumnTypeFactory from './MakeSpreadsheetColumnType'\nimport NumberFactory from './Number'\n\nexport default ({ jbrequire }) => {\n  const { types } = jbrequire('mobx-state-tree')\n  const MakeSpreadsheetColumnType = jbrequire(MakeSpreadsheetColumnTypeFactory)\n\n  const { FilterModelType: NumberFilterModel } = jbrequire(NumberFactory)\n\n  const FilterModelType = types.compose(\n    NumberFilterModel,\n    types.model({\n      type: types.literal('LocEnd'),\n    }),\n  )\n\n  const LocEnd = MakeSpreadsheetColumnType('LocEnd', {\n    categoryName: 'Location',\n    displayName: 'End',\n    compare(cellA, cellB) {\n      return parseFloat(cellA.text) - parseFloat(cellB.text)\n    },\n    FilterModelType,\n  })\n\n  return LocEnd\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport LocStringFactory from './LocString'\nimport LocRefFactory from './LocRef'\nimport LocStartFactory from './LocStart'\nimport LocEndFactory from './LocEnd'\nimport NumberFactory from './Number'\nimport TextFactory from './Text'\n\nexport default (pluginManager: PluginManager) => {\n  const { jbrequire } = pluginManager\n  const { types } = jbrequire('mobx-state-tree')\n\n  const { NumberColumn: Number } = jbrequire(NumberFactory)\n  const { TextColumn: Text } = jbrequire(TextFactory)\n\n  const ColumnTypes = {\n    Number,\n    Text,\n    LocString: jbrequire(LocStringFactory),\n    LocRef: jbrequire(LocRefFactory),\n    LocStart: jbrequire(LocStartFactory),\n    LocEnd: jbrequire(LocEndFactory),\n  }\n\n  const allColumnTypes = Object.values(ColumnTypes)\n  const AnyColumnType = types.union(...allColumnTypes)\n\n  return Object.freeze({\n    ColumnTypes,\n    AnyColumnType,\n    // make a type union of all the different filter model types\n    AnyFilterModelType: types.union(\n      ...allColumnTypes\n        .map(columnType => {\n          // just instantiate the blank types to get their filter model types\n          const { FilterModelType } = columnType.create({\n            type: columnType.properties.type.value,\n          })\n          return FilterModelType\n        })\n        // some column types might not have filter machinery, filter those out\n        .filter(t => !!t),\n    ),\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nexport default (pluginManager: PluginManager) => {\n  const { lib } = pluginManager\n  const { types, getParent } = lib['mobx-state-tree']\n\n  const CellModel = types.model('SpreadsheetCell', {\n    text: types.string,\n    extendedData: types.maybe(types.frozen()),\n  })\n\n  const RowModel = types\n    .model('SpreadsheetRow', {\n      id: types.identifier,\n      cells: types.array(CellModel),\n      extendedData: types.maybe(types.frozen()),\n      isSelected: false,\n    })\n    .actions(self => ({\n      toggleSelect() {\n        self.isSelected = !self.isSelected\n      },\n      unSelect() {\n        self.isSelected = false\n      },\n      select() {\n        self.isSelected = true\n      },\n      setExtendedData(data: unknown) {\n        self.extendedData = data\n      },\n    }))\n    .views(self => ({\n      get cellsWithDerived() {\n        const { columns } = getParent(self, 3)\n        let i = 0\n        return columns.map((column: { isDerived: boolean; func: Function }) => {\n          if (column.isDerived) {\n            return column.func(self, column)\n          }\n          return self.cells[i++]\n        })\n      },\n    }))\n\n  return RowModel\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport Row from './Row'\n\nexport default (pluginManager: PluginManager) => {\n  const { lib, load } = pluginManager\n  const { types, getParent } = lib['mobx-state-tree']\n  const RowModel = load(Row)\n\n  return types\n    .model('StaticRowSet', {\n      isLoaded: types.literal(true),\n      rows: types.array(RowModel),\n    })\n    .views(self => ({\n      get count() {\n        return self.rows.length\n      },\n\n      get passingFiltersCount() {\n        return this.sortedFilteredRows.length\n      },\n\n      get selectedCount() {\n        return this.selectedRows.length\n      },\n\n      get selectedAndPassingFiltersCount() {\n        return this.selectedFilteredRows.length\n      },\n\n      get sortedRows() {\n        const parent = getParent(self)\n        return self.rows.slice().sort(parent.rowSortingComparisonFunction)\n      },\n\n      get selectedRows() {\n        return self.rows.filter(r => r.isSelected)\n      },\n\n      get selectedFilteredRows() {\n        const sheet = getParent(self)\n        const view = getParent(sheet)\n        const { filterControls } = view\n        return this.selectedRows.filter(row =>\n          filterControls.rowPassesFilters(sheet, row),\n        )\n      },\n\n      // the set of all rows that pass the filters, sorted\n      get sortedFilteredRows() {\n        const sheet = getParent(self)\n        const view = getParent(sheet)\n        const { filterControls } = view\n        return self.rows\n          .filter(row => filterControls.rowPassesFilters(sheet, row))\n          .sort(sheet.rowSortingComparisonFunction)\n      },\n    }))\n    .actions(self => ({\n      unselectAll() {\n        self.rows.forEach(row => row.unSelect())\n      },\n    }))\n}\n","import { stringToFunction } from '@jbrowse/core/util/functionStrings'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSession } from '@jbrowse/core/util'\nimport { SnapshotIn, Instance, addDisposer } from 'mobx-state-tree'\nimport { autorun } from 'mobx'\nimport ColumnDataTypes from './ColumnDataTypes'\nimport StaticRowSetF from './StaticRowSet'\nimport RowF from './Row'\n\nexport default (pluginManager: PluginManager) => {\n  const { lib, load } = pluginManager\n  const { types, getParent } = lib['mobx-state-tree']\n\n  const { ColumnTypes, AnyColumnType } = load(ColumnDataTypes)\n\n  const StaticRowSetModel = load(StaticRowSetF)\n  type Row = Instance<ReturnType<typeof RowF>>\n\n  const ColumnDefinition = types\n    .model('ColumnDefinition', {\n      name: types.maybe(types.string),\n      dataType: types.optional(AnyColumnType, () => ({\n        type: 'Text',\n      })),\n      // set to true if column is derived from other columns\n      // if the column is derived, each cell will have a\n      // `derivationFunction` that is called to get its value\n      isDerived: false,\n      // if this cell is derived from other cells, execute this function to get the value\n      derivationFunctionText: types.maybe(types.string),\n    })\n    .views(self => ({\n      get func() {\n        if (self.isDerived) {\n          // compile this as a function\n          return stringToFunction(String(self.derivationFunctionText))\n        }\n        return undefined\n      },\n    }))\n\n  type RowMenuPosition = { anchorEl: Element; rowNumber: number } | null\n  const stateModel = types\n    .model('Spreadsheet', {\n      rowSet: types.optional(StaticRowSetModel, () =>\n        StaticRowSetModel.create(),\n      ),\n      columns: types.array(ColumnDefinition),\n      columnDisplayOrder: types.array(types.number),\n      hasColumnNames: false,\n\n      sortColumns: types.array(\n        types\n          .model('SortColumns', {\n            columnNumber: types.number,\n            descending: false,\n          })\n          .actions(self => ({\n            switchDirection() {\n              self.descending = !self.descending\n            },\n          })),\n      ),\n\n      assemblyName: types.maybe(types.string),\n    })\n    .volatile(() => ({\n      defaultDataType: ColumnTypes.Text,\n      rowMenuPosition: null as RowMenuPosition,\n      isLoaded: false,\n    }))\n    .views(self => ({\n      get initialized() {\n        const session = getSession(self)\n        const name = self.assemblyName\n        if (name) {\n          const asm = session.assemblyManager.get(name)\n          return asm && asm.initialized\n        }\n        return true\n      },\n      get hideRowSelection() {\n        // just delegates to parent\n        return getParent(self).hideRowSelection\n      },\n\n      // list of data type names to be made available in the column\n      // dropdown menu\n      get dataTypeChoices() {\n        const typeNames = Object.keys(\n          ColumnTypes,\n        ) as (keyof typeof ColumnTypes)[]\n        return typeNames.map(typeName => {\n          const dataType = ColumnTypes[typeName].create({ type: typeName })\n          const { displayName, categoryName } = dataType\n          return { typeName, displayName, categoryName }\n        })\n      },\n\n      rowSortingComparisonFunction(rowA: Row, rowB: Row) {\n        for (let i = 0; i < self.sortColumns.length; i += 1) {\n          const { columnNumber, descending } = self.sortColumns[i]\n          const { dataType } = self.columns[columnNumber]\n          const result = dataType.compare(\n            rowA.cellsWithDerived[columnNumber],\n            rowB.cellsWithDerived[columnNumber],\n          )\n          if (result) return descending ? -result : result\n        }\n        return 0\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(async () => {\n            const session = getSession(self)\n            const { assemblyManager } = session\n            try {\n              if (self.assemblyName) {\n                await assemblyManager.waitForAssembly(self.assemblyName)\n                this.setLoaded(true)\n              }\n            } catch (error) {\n              session.notify(\n                `failed to load assembly ${self.assemblyName} ${error}`,\n                'error',\n              )\n            }\n          }),\n        )\n      },\n\n      setLoaded(flag: boolean) {\n        self.isLoaded = flag\n      },\n\n      setRowMenuPosition(newPosition: RowMenuPosition) {\n        self.rowMenuPosition = newPosition\n      },\n\n      setSortColumns(\n        newSort: NonNullable<SnapshotIn<typeof self.sortColumns>>,\n      ) {\n        // @ts-ignore\n        if (newSort) self.sortColumns = newSort\n      },\n      setColumnType(columnNumber: number, newTypeName: string) {\n        self.columns[columnNumber].dataType = { type: newTypeName }\n      },\n      unselectAll() {\n        return self.rowSet.unselectAll()\n      },\n    }))\n\n  return stateModel\n}\n","import csv from 'csvtojson'\n\nimport { parseLocString } from '@jbrowse/core/util'\n\nexport function bufferToString(buffer: Buffer) {\n  return new TextDecoder('utf-8', { fatal: true }).decode(buffer)\n}\n\nfunction parseWith(buffer: Buffer, options = {}) {\n  return csv({ noheader: true, output: 'csv', ...options }).fromString(\n    bufferToString(buffer),\n  )\n}\n\nexport interface Row {\n  id: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  extendedData?: any\n  cells: {\n    text: string\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    extendedData?: any\n  }[]\n}\n\nexport interface RowSet {\n  isLoaded: boolean\n  rows: Row[]\n}\n\nexport interface ParseOptions {\n  hasColumnNameLine?: boolean\n  columnNameLineNumber?: number\n  selectedAssemblyName?: string\n  isValidRefName: (refName: string, assemblyName?: string) => boolean\n}\n\nexport interface Column {\n  name: string\n  dataType: { type: string }\n  isDerived?: boolean\n  derivationFunctionText?: string\n}\n\nfunction guessColumnType(\n  rowSet: RowSet,\n  columnNumber: number,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n) {\n  const text = rowSet.rows[0].cells[columnNumber].text || ''\n\n  let guessedType = 'Text'\n\n  let parsedLoc\n  try {\n    parsedLoc = parseLocString(text, isValidRefName)\n  } catch (error) {\n    //\n  }\n  if (parsedLoc && parsedLoc.refName && typeof parsedLoc.start === 'number') {\n    guessedType = 'LocString'\n  } else if (/^\\d+(\\.\\d+)?$/.test(text)) {\n    guessedType = 'Number'\n  }\n\n  // MAYBE TODO: iterate over the rest of the rows to confirm\n  // the type for all the rows\n\n  return guessedType\n}\n\nfunction dataToSpreadsheetSnapshot(\n  rows: string[][],\n  options: ParseOptions = {\n    hasColumnNameLine: false,\n    columnNameLineNumber: 1,\n    isValidRefName: () => false,\n  },\n) {\n  // rows is an array of row objects and columnNames\n  // is an array of column names (in import order)\n  let maxCols = 0\n  const rowSet: RowSet = {\n    isLoaded: true,\n    rows: rows.map((row, rowNumber) => {\n      const id = rowNumber + (options.hasColumnNameLine ? 0 : 1)\n      if (row.length > maxCols) maxCols = row.length\n      return {\n        id: String(id),\n        cells: row.map((text, columnNumber) => {\n          return { columnNumber, text }\n        }),\n      }\n    }),\n  }\n\n  // process the column names row if present\n  const columnNames: Record<string, string> = {}\n  if (options.hasColumnNameLine && options.columnNameLineNumber !== undefined) {\n    const [colNamesRow] = rowSet.rows.splice(\n      options.columnNameLineNumber - 1,\n      1,\n    )\n\n    if (colNamesRow) {\n      colNamesRow.cells.forEach((cell, columnNumber) => {\n        columnNames[columnNumber] = cell.text || ''\n      })\n    }\n  }\n\n  // make our column definitions\n  const columns: Column[] = []\n  const columnDisplayOrder = []\n  for (let columnNumber = 0; columnNumber < maxCols; columnNumber += 1) {\n    columnDisplayOrder.push(columnNumber)\n    const guessedType = guessColumnType(\n      rowSet,\n      columnNumber,\n      options.isValidRefName,\n    )\n\n    // store extendeddata for LocString column\n    if (guessedType === 'LocString') {\n      rowSet.rows.forEach(row => {\n        const cell = row.cells[columnNumber]\n        cell.extendedData = parseLocString(cell.text, options.isValidRefName)\n      })\n    }\n\n    columns[columnNumber] = {\n      name: columnNames[columnNumber],\n      dataType: {\n        type: guessedType,\n      },\n    }\n  }\n\n  return {\n    rowSet,\n    columnDisplayOrder,\n    hasColumnNames: !!options.hasColumnNameLine,\n    columns,\n    assemblyName: options.selectedAssemblyName,\n  }\n}\n\nexport async function parseCsvBuffer(\n  buffer: Buffer,\n  options: ParseOptions = {\n    hasColumnNameLine: false,\n    columnNameLineNumber: 1,\n    isValidRefName: () => false,\n  },\n) {\n  const rows = await parseWith(buffer)\n  return dataToSpreadsheetSnapshot(rows, options)\n}\n\nexport async function parseTsvBuffer(\n  buffer: Buffer,\n  options: ParseOptions = {\n    hasColumnNameLine: false,\n    columnNameLineNumber: 1,\n    isValidRefName: () => false,\n  },\n) {\n  const rows = await parseWith(buffer, { delimiter: '\\t' })\n  return dataToSpreadsheetSnapshot(rows, options)\n}\n","import VCF from '@gmod/vcf'\nimport { VcfFeature } from '@jbrowse/plugin-variants'\nimport {\n  bufferToString,\n  Row,\n  RowSet,\n  Column,\n  ParseOptions,\n} from './ImportUtils'\n\nconst vcfCoreColumns: { name: string; type: string }[] = [\n  { name: 'CHROM', type: 'Text' }, // 0\n  { name: 'POS', type: 'Number' }, // 1\n  { name: 'ID', type: 'Text' }, // 2\n  { name: 'REF', type: 'Text' }, // 3\n  { name: 'ALT', type: 'Text' }, // 4\n  { name: 'QUAL', type: 'Number' }, // 5\n  { name: 'FILTER', type: 'Text' }, // 6\n  { name: 'INFO', type: 'Text' }, // 7\n  { name: 'FORMAT', type: 'Text' }, // 8\n]\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction vcfRecordToRow(vcfParser: any, line: string, lineNumber: number): Row {\n  const vcfVariant = vcfParser.parseLine(line)\n  const vcfFeature = new VcfFeature({\n    variant: vcfVariant,\n    parser: vcfParser,\n    id: `vcf-${lineNumber}`,\n  })\n\n  const data = line.split('\\t').map(d => (d === '.' ? '' : d))\n  // no format column, add blank\n  if (data.length === 8) {\n    data.push('')\n  }\n  const row: Row = {\n    id: String(lineNumber + 1),\n    extendedData: { vcfFeature: vcfFeature.toJSON() },\n    cells: data.map((text, columnNumber) => {\n      return {\n        columnNumber,\n        text,\n      }\n    }),\n  }\n  return row\n}\n\nexport function parseVcfBuffer(\n  buffer: Buffer,\n  options: ParseOptions = {\n    hasColumnNameLine: false,\n    columnNameLineNumber: 0,\n    isValidRefName: () => false,\n  },\n) {\n  let { header, body } = splitVcfFileHeaderAndBody(bufferToString(buffer))\n  const rows: Row[] = []\n  const vcfParser = new VCF({ header })\n  header = '' // garbage collect\n  body.split('\\n').forEach((line: string, lineNumber) => {\n    if (/\\S/.test(line)) {\n      rows.push(vcfRecordToRow(vcfParser, line, lineNumber))\n    }\n  })\n  body = '' // garbage collect\n\n  const rowSet: RowSet = {\n    isLoaded: true,\n    rows,\n  }\n\n  const columnDisplayOrder: number[] = []\n  const columns: Column[] = []\n  for (let i = 0; i < vcfCoreColumns.length; i += 1) {\n    columnDisplayOrder.push(i)\n    columns[i] = {\n      name: vcfCoreColumns[i].name,\n      dataType: { type: vcfCoreColumns[i].type },\n    }\n  }\n  for (let i = 0; i < vcfParser.samples.length; i += 1) {\n    const oi = vcfCoreColumns.length + i\n    columnDisplayOrder.push(oi)\n    columns[oi] = { name: vcfParser.samples[i], dataType: { type: 'Text' } }\n  }\n\n  columnDisplayOrder.push(columnDisplayOrder.length)\n  columns.unshift({\n    name: 'Location',\n    dataType: { type: 'LocString' },\n    isDerived: true,\n    derivationFunctionText: `function deriveLocationColumn(row, column) {\n      const feat = row.extendedData.vcfFeature\n      const refName = feat.refName\n      const start = feat.start\n      const end = feat.end\n      return {text:refName+':'+start+'..'+end, extendedData: {refName:refName,start:start,end:end} }\n    }`,\n  })\n\n  return {\n    rowSet,\n    columnDisplayOrder,\n    hasColumnNames: true,\n    columns,\n    assemblyName: options.selectedAssemblyName,\n  }\n}\n\nexport function splitVcfFileHeaderAndBody(wholeFile: string) {\n  // split into header and the rest of the file\n  let headerEndIndex = 0\n  let prevChar\n  for (; headerEndIndex < wholeFile.length; headerEndIndex += 1) {\n    const c = wholeFile[headerEndIndex]\n    if (prevChar === '\\n' && c !== '#') break\n    prevChar = c\n  }\n\n  return {\n    header: wholeFile.substr(0, headerEndIndex),\n    body: wholeFile.substr(headerEndIndex),\n  }\n}\n","import { ParseOptions, parseTsvBuffer } from './ImportUtils'\n\nconst browserBytes = 'browser '.split('').map(c => c.charCodeAt(0))\nconst trackBytes = 'track '.split('').map(c => c.charCodeAt(0))\n\nfunction bytesAreFoundAt(position: number, buffer: Buffer, bytes: number[]) {\n  let i = 0\n  for (; i < bytes.length; i += 1) {\n    if (buffer[position + i] !== bytes[i]) return false\n  }\n  return true\n}\nexport function removeBedHeaders(buffer: Buffer) {\n  // slice off the first lines of the buffer if it starts with one or more header lines\n  let i = 0\n  for (; i < buffer.length; i += 1) {\n    if (\n      bytesAreFoundAt(i, buffer, browserBytes) ||\n      bytesAreFoundAt(i, buffer, trackBytes)\n    ) {\n      // consume up to the next newline\n      do {\n        i += 1\n      } while (buffer[i] !== 10)\n    } else {\n      // end of headers, return\n      break\n    }\n  }\n  if (i) {\n    return buffer.slice(i)\n  }\n  return buffer\n}\n\nexport async function parseBedBuffer(buffer: Buffer, options: ParseOptions) {\n  const b = removeBedHeaders(buffer)\n  const data = await parseTsvBuffer(b)\n  const bedColumns = [\n    { name: 'chrom', dataType: { type: 'LocRef' } },\n    { name: 'chromStart', dataType: { type: 'LocStart' } },\n    { name: 'chromEnd', dataType: { type: 'LocEnd' } },\n    { name: 'name', dataType: { type: 'Text' } },\n    { name: 'score', dataType: { type: 'Number' } },\n    { name: 'strand', dataType: { type: 'Text' } },\n  ]\n  data.columns.forEach((col, colNumber) => {\n    const bedColumn = bedColumns[colNumber]\n    if (bedColumn) {\n      col.name = bedColumn.name\n      col.dataType = bedColumn.dataType\n    }\n  })\n  data.hasColumnNames = true\n  data.assemblyName = options.selectedAssemblyName\n\n  data.columnDisplayOrder.push(data.columnDisplayOrder.length)\n  data.columns.unshift({\n    name: 'Location',\n    dataType: { type: 'LocString' },\n    isDerived: true,\n    derivationFunctionText: `function deriveLocationColumn(row, column) {\n      var [ref, start, end] = row.cells\n      return {text:ref.text+':'+start.text+'..'+end.text, extendedData: {refName: ref.text, start: +start.text, end: +end.text} }\n    }`,\n  })\n  return data\n}\n\nexport async function parseBedPEBuffer(buffer: Buffer, options: ParseOptions) {\n  const data = await parseTsvBuffer(buffer)\n  interface BedColumn {\n    name: string\n    dataType: {\n      type: string\n    }\n    featureField: string[]\n  }\n  const bedColumns: BedColumn[] = [\n    { name: 'chrom1', dataType: { type: 'Text' }, featureField: ['refName'] },\n    { name: 'start1', dataType: { type: 'Number' }, featureField: ['start'] },\n    { name: 'end1', dataType: { type: 'Number' }, featureField: ['end'] },\n    {\n      name: 'chrom2',\n      dataType: { type: 'Text' },\n      featureField: ['mate', 'refName'],\n    },\n    {\n      name: 'start2',\n      dataType: { type: 'Number' },\n      featureField: ['mate', 'start'],\n    },\n    {\n      name: 'end2',\n      dataType: { type: 'Number' },\n      featureField: ['mate', 'end'],\n    },\n    { name: 'name', dataType: { type: 'Text' }, featureField: ['name'] },\n    { name: 'score', dataType: { type: 'Number' }, featureField: ['score'] },\n    { name: 'strand1', dataType: { type: 'Text' }, featureField: ['strand'] },\n    {\n      name: 'strand2',\n      dataType: { type: 'Text' },\n      featureField: ['mate', 'strand'],\n    },\n  ]\n  data.columns.forEach((col, colNumber) => {\n    const bedColumn = bedColumns[colNumber]\n    if (bedColumn) {\n      col.name = bedColumn.name\n      col.dataType = bedColumn.dataType\n    }\n  })\n  data.hasColumnNames = true\n\n  // decorate each row with a feature object in its extendedData\n  data.rowSet.rows.forEach((row, rowNumber) => {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const featureData: Record<string, any> = {}\n    row.cells.forEach(({ text }, columnNumber) => {\n      const bedColumn = bedColumns[columnNumber]\n      const val =\n        bedColumn && bedColumn.dataType.type === 'Number' && text\n          ? parseFloat(text)\n          : text\n      if (bedColumn) {\n        // a predefined column\n        if (bedColumn.featureField.length === 2) {\n          if (!featureData[bedColumn.featureField[0]])\n            featureData[bedColumn.featureField[0]] = {}\n          featureData[bedColumn.featureField[0]][\n            bedColumn.featureField[1]\n          ] = val\n        } else {\n          featureData[bedColumn.featureField[0]] = val\n        }\n      } else {\n        // some other column\n        featureData[`column${columnNumber + 1}`] = val\n      }\n    })\n    featureData.uniqueId = `bedpe-${rowNumber}`\n    row.extendedData = {\n      feature: featureData,\n    }\n  })\n\n  data.assemblyName = options.selectedAssemblyName\n\n  return data\n}\n","import { parseTsvBuffer, ParseOptions } from './ImportUtils'\n\nfunction parseSTARFusionBreakpointString(str: string) {\n  const fields = str.split(':')\n  const refName = fields[0]\n  const pos = parseInt(fields[1], 10)\n  const strand = fields[2] === '-' ? -1 : 1\n  return { refName, pos, strand }\n}\n\nconst numericColumns: Record<string, boolean> = {\n  SpanningFragCount: true,\n  FFPM: true,\n  LeftBreakEntropy: true,\n  RightBreakEntropy: true,\n  JunctionReadCount: true,\n}\n\nexport async function parseSTARFusionBuffer(\n  buffer: Buffer,\n  options: ParseOptions,\n) {\n  const data = await parseTsvBuffer(buffer, {\n    hasColumnNameLine: true,\n    columnNameLineNumber: 1,\n    selectedAssemblyName: options.selectedAssemblyName,\n    isValidRefName: () => false,\n  })\n  // remove the # in #FusionName\n  data.columns[0].name = data.columns[0].name.replace('#', '')\n  // set some columns to be numeric\n  data.columns.forEach(col => {\n    if (numericColumns[col.name]) col.dataType = { type: 'Number' }\n  })\n\n  // decorate each row with a feature object in its extendedData\n  data.rowSet.rows.forEach((row, rowNumber) => {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const featureData: Record<string, any> = {}\n    row.cells.forEach(({ text }, columnNumber) => {\n      const column = data.columns[columnNumber]\n      if (column.name === 'LeftBreakpoint' && text) {\n        const { refName, pos, strand } = parseSTARFusionBreakpointString(text)\n        featureData.refName = refName\n        featureData.start = pos\n        featureData.end = pos\n        featureData.strand = strand\n      } else if (column.name === 'RightBreakpoint' && text) {\n        const { refName, pos, strand } = parseSTARFusionBreakpointString(text)\n        featureData.mate = {\n          refName,\n          start: pos,\n          end: pos,\n          strand,\n        }\n      } else if (text && numericColumns[column.name]) {\n        // some other column, numeric\n        featureData[column.name] = parseFloat(text)\n      } else {\n        // some other column, text\n        featureData[column.name] = text\n      }\n    })\n    featureData.uniqueId = `sf-${rowNumber + 1}`\n    row.extendedData = {\n      feature: featureData,\n    }\n  })\n\n  return data\n}\n","import { getSession } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { unzip } from '@gmod/bgzf-filehandle'\nimport { parseCsvBuffer, parseTsvBuffer } from '../importAdapters/ImportUtils'\nimport { parseVcfBuffer } from '../importAdapters/VcfImport'\nimport { parseBedBuffer, parseBedPEBuffer } from '../importAdapters/BedImport'\nimport { parseSTARFusionBuffer } from '../importAdapters/STARFusionImport'\n\n// 30MB\nconst IMPORT_SIZE_LIMIT = 30_000_000\n\nexport default (pluginManager: PluginManager) => {\n  const { lib } = pluginManager\n  const { types, getParent, getRoot } = lib['mobx-state-tree']\n  const { openLocation } = lib['@jbrowse/core/util/io']\n  const { readConfObject } = lib['@jbrowse/core/configuration']\n\n  const fileTypes = ['CSV', 'TSV', 'VCF', 'BED', 'BEDPE', 'STAR-Fusion']\n  const fileTypeParsers = {\n    CSV: parseCsvBuffer,\n    TSV: parseTsvBuffer,\n    VCF: parseVcfBuffer,\n    BED: parseBedBuffer,\n    BEDPE: parseBedPEBuffer,\n    'STAR-Fusion': parseSTARFusionBuffer,\n  }\n  // regexp used to guess the type of a file or URL from its file extension\n  const fileTypesRegexp = new RegExp(\n    `\\\\.(${fileTypes.join('|')})(\\\\.gz)?$`,\n    'i',\n  )\n\n  return types\n    .model('SpreadsheetImportWizard', {\n      fileType: types.optional(types.enumeration(fileTypes), 'CSV'),\n      loading: false,\n      hasColumnNameLine: true,\n      columnNameLineNumber: 1,\n      selectedAssemblyIdx: 0,\n    })\n    .volatile(() => ({\n      fileTypes,\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      fileSource: undefined as any,\n      error: undefined as Error | undefined,\n    }))\n    .views(self => ({\n      get isReadyToOpen() {\n        return (\n          !self.error &&\n          self.fileSource &&\n          (self.fileSource.blob ||\n            self.fileSource.localPath ||\n            self.fileSource.uri)\n        )\n      },\n      get canCancel() {\n        return getParent(self).readyToDisplay\n      },\n      get assemblyChoices() {\n        return getRoot(self).jbrowse.assemblies\n      },\n      get selectedAssemblyName() {\n        const asm = getRoot(self).jbrowse.assemblies[self.selectedAssemblyIdx]\n        if (asm) {\n          return readConfObject(asm, 'name')\n        }\n        return undefined\n      },\n\n      get fileName() {\n        return (\n          self.fileSource.uri ||\n          self.fileSource.localPath ||\n          (self.fileSource.blob && self.fileSource.blob.name)\n        )\n      },\n\n      get requiresUnzip() {\n        return this.fileName.endsWith('gz')\n      },\n\n      isValidRefName(refName: string, assemblyName?: string) {\n        return getSession(self).assemblyManager.isValidRefName(\n          refName,\n          assemblyName,\n        )\n      },\n    }))\n    .actions(self => ({\n      setFileSource(newSource: unknown) {\n        self.fileSource = newSource\n        self.error = undefined\n\n        if (self.fileSource) {\n          // try to autodetect the file type, ignore errors\n          const name = self.fileName\n\n          if (name) {\n            const match = fileTypesRegexp.exec(name)\n            if (match && match[1]) {\n              if (match[1] === 'tsv' && name.includes('star-fusion')) {\n                self.fileType = 'STAR-Fusion'\n              } else {\n                self.fileType = match[1].toUpperCase()\n              }\n            }\n          }\n        }\n      },\n\n      setSelectedAssemblyIdx(idx: number) {\n        self.selectedAssemblyIdx = idx\n      },\n\n      toggleHasColumnNameLine() {\n        self.hasColumnNameLine = !self.hasColumnNameLine\n      },\n\n      setColumnNameLineNumber(newnumber: number) {\n        if (newnumber > 0) self.columnNameLineNumber = newnumber\n      },\n\n      setFileType(typeName: string) {\n        self.fileType = typeName\n      },\n\n      setError(error: Error) {\n        console.error(error)\n        self.loading = false\n        self.error = error\n      },\n\n      setLoaded() {\n        self.loading = false\n        self.error = undefined\n      },\n\n      cancelButton() {\n        self.error = undefined\n        getParent(self).setDisplayMode()\n      },\n\n      // fetch and parse the file, make a new Spreadsheet model for it,\n      // then set the parent to display it\n      import() {\n        try {\n          if (!self.fileSource) return\n          const typeParser =\n            fileTypeParsers[self.fileType as keyof typeof fileTypeParsers]\n          if (!typeParser)\n            throw new Error(`cannot open files of type '${self.fileType}'`)\n          if (self.loading)\n            throw new Error('cannot import, load already in progress')\n          self.loading = true\n\n          const filehandle = openLocation(self.fileSource)\n          filehandle\n            .stat()\n            .then(stat => {\n              if (stat.size > IMPORT_SIZE_LIMIT)\n                throw new Error(\n                  `File is too big. Tabular files are limited to at most ${(\n                    IMPORT_SIZE_LIMIT / 1000\n                  ).toLocaleString()}kb.`,\n                )\n            })\n            .then(() => filehandle.readFile())\n            .then(buffer => {\n              return self.requiresUnzip ? unzip(buffer) : buffer\n            })\n            .then(buffer => typeParser(buffer as Buffer, self))\n            .then(spreadsheet => {\n              this.setLoaded()\n              getParent(self).displaySpreadsheet(spreadsheet)\n            })\n            .catch(this.setError)\n        } catch (error) {\n          this.setError(error)\n        }\n      },\n    }))\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { SnapshotIn } from 'mobx-state-tree'\nimport ColumnDataTypes from './ColumnDataTypes'\n\nexport default (pluginManager: PluginManager) => {\n  const { lib, load } = pluginManager\n  const { types, getParent } = lib['mobx-state-tree']\n\n  const { AnyFilterModelType: AnyColumnFilter } = load(ColumnDataTypes)\n\n  // filter that finds a simple string in any of the cells of a row\n  const RowFullTextFilter = types\n    .model('RowFullTextFilter', {\n      type: types.literal('RowFullText'),\n      stringToFind: '',\n    })\n    .views(self => ({\n      // returns a function that tests the given row\n      get predicate() {\n        let s = self.stringToFind // avoid closing over self\n        if (!s)\n          return function alwaysTrue() {\n            return true\n          }\n        s = s.toLowerCase()\n        return function stringPredicate(\n          _sheet: unknown,\n          row: { cells: { text: string }[] },\n        ) {\n          const { cells } = row\n          for (\n            let columnNumber = 0;\n            columnNumber < cells.length;\n            columnNumber += 1\n          ) {\n            const cell = cells[columnNumber]\n            // TODO: add support for derived cells\n            // note: case insensitive\n            if (cell.text && cell.text.toLowerCase().includes(s)) return true\n          }\n          return false\n        }\n      },\n    }))\n    .actions(self => ({\n      setString(s: string) {\n        self.stringToFind = s\n      },\n      clear() {\n        self.stringToFind = ''\n      },\n    }))\n\n  return types\n    .model('SpreadsheetFilterControls', {\n      rowFullText: types.optional(\n        RowFullTextFilter,\n        () =>\n          ({\n            type: 'RowFullText',\n            stringToFind: '',\n          } as SnapshotIn<typeof RowFullTextFilter>),\n      ),\n      columnFilters: types.array(AnyColumnFilter),\n    })\n    .views(self => ({\n      get filters() {\n        return [self.rowFullText, ...self.columnFilters].filter(f => !!f)\n      },\n      setRowFullTextFilter(stringToFind: string) {\n        // @ts-ignore\n        self.rowFullText = {\n          type: 'RowFullText',\n          stringToFind,\n        }\n      },\n      rowPassesFilters(sheet: unknown, row: unknown) {\n        for (let i = 0; i < this.filters.length; i += 1) {\n          if (!this.filters[i].predicate(sheet, row)) return false\n        }\n        return true\n      },\n    }))\n    .actions(self => ({\n      addBlankColumnFilter(columnNumber: number) {\n        const { dataType } = getParent(self).spreadsheet.columns[columnNumber]\n        self.columnFilters.push({\n          type: dataType.type,\n          columnNumber,\n        })\n      },\n      removeColumnFilter(filter: typeof AnyColumnFilter) {\n        return self.columnFilters.remove(filter)\n      },\n      clearAllFilters() {\n        self.columnFilters.clear()\n        self.rowFullText.clear()\n      },\n    }))\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { SnapshotIn, Instance } from 'mobx-state-tree'\nimport { getSession, InstanceOfModelReturnedBy } from '@jbrowse/core/util'\nimport DoneIcon from '@material-ui/icons/Done'\nimport Spreadsheet from './Spreadsheet'\nimport ImportWizard from './ImportWizard'\nimport FilterControls from './FilterControls'\n\nexport type MenuItemWithDisabledCallback = MenuItem & {\n  disabled?:\n    | boolean\n    | ((\n        viewModel: unknown,\n        spreadsheetModel: InstanceOfModelReturnedBy<typeof Spreadsheet>,\n        rowNumber: number,\n        row: Instance<ReturnType<typeof Spreadsheet>>['rowSet']['rows'][0],\n      ) => boolean)\n}\n\nconst defaultRowMenuItems: MenuItemWithDisabledCallback[] = [\n  {\n    label: 'Toggle select',\n    icon: DoneIcon,\n    onClick(\n      _view: unknown,\n      spreadsheet: Instance<ReturnType<typeof Spreadsheet>>,\n    ) {\n      const rowNumber = spreadsheet.rowMenuPosition?.rowNumber\n      if (rowNumber !== undefined) {\n        spreadsheet.rowSet.rows[rowNumber - 1].toggleSelect()\n      }\n    },\n  },\n]\n\nexport default (pluginManager: PluginManager) => {\n  const { lib, load } = pluginManager\n  const { mobx } = lib\n  const { types, getParent, getEnv } = lib['mobx-state-tree']\n  const { BaseViewModel } = lib['@jbrowse/core/pluggableElementTypes/models']\n\n  const SpreadsheetModel = load(Spreadsheet)\n  const ImportWizardModel = load(ImportWizard)\n  const FilterControlsModel = load(FilterControls)\n\n  const minHeight = 40\n  const defaultHeight = 440\n  const model = types\n    .model('SpreadsheetView', {\n      type: types.literal('SpreadsheetView'),\n      offsetPx: 0,\n      height: types.optional(\n        types.refinement(\n          'SpreadsheetViewHeight',\n          types.number,\n          n => n >= minHeight,\n        ),\n        defaultHeight,\n      ),\n\n      hideViewControls: false,\n      hideVerticalResizeHandle: false,\n      hideFilterControls: false,\n\n      filterControls: types.optional(FilterControlsModel, () =>\n        FilterControlsModel.create({}),\n      ),\n\n      // switch specifying whether we are showing the import wizard or the spreadsheet in our viewing area\n      mode: types.optional(\n        types.enumeration('SpreadsheetViewMode', ['import', 'display']),\n        'import',\n      ),\n      importWizard: types.optional(ImportWizardModel, () =>\n        ImportWizardModel.create(),\n      ),\n      spreadsheet: types.maybe(SpreadsheetModel),\n    })\n    .volatile(() => ({\n      width: 400,\n      rowMenuItems: mobx.observable(defaultRowMenuItems),\n    }))\n    .views(self => ({\n      get readyToDisplay() {\n        return !!self.spreadsheet && self.spreadsheet.isLoaded\n      },\n\n      get hideRowSelection() {\n        return !!getEnv(self).hideRowSelection\n      },\n\n      get outputRows() {\n        if (self.spreadsheet && self.spreadsheet.rowSet.isLoaded) {\n          const selected = self.spreadsheet.rowSet.selectedFilteredRows\n          if (selected.length) return selected\n          return self.spreadsheet.rowSet.sortedFilteredRows\n        }\n        return undefined\n      },\n\n      get assembly() {\n        if (self.spreadsheet && self.spreadsheet.assemblyName) {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          const assemblies = getSession(self).assemblies as any[]\n          const assembly = (assemblies || []).find(\n            asm =>\n              readConfObject(asm, 'name') === self.spreadsheet?.assemblyName,\n          )\n          if (assembly) {\n            return assembly\n          }\n        }\n        return undefined\n      },\n    }))\n    .actions(self => ({\n      setRowMenuItems(newItems: MenuItem[]) {\n        self.rowMenuItems.replace(newItems)\n      },\n      setWidth(newWidth: number) {\n        self.width = newWidth\n        return self.width\n      },\n      setHeight(newHeight: number) {\n        if (newHeight > minHeight) self.height = newHeight\n        else self.height = minHeight\n        return self.height\n      },\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = this.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n      resizeWidth(distance: number) {\n        const oldWidth = self.width\n        const newWidth = this.setWidth(self.width + distance)\n        return newWidth - oldWidth\n      },\n\n      /** load a new spreadsheet and set our mode to display it */\n      displaySpreadsheet(spreadsheet: SnapshotIn<typeof SpreadsheetModel>) {\n        self.filterControls.clearAllFilters()\n        // @ts-ignore\n        self.spreadsheet = spreadsheet\n        self.mode = 'display'\n      },\n\n      setImportMode() {\n        self.mode = 'import'\n      },\n\n      setDisplayMode() {\n        if (self.readyToDisplay) self.mode = 'display'\n      },\n\n      closeView() {\n        getParent(self, 2).removeView(self)\n      },\n    }))\n\n  const stateModel = types.compose(BaseViewModel, model)\n\n  return stateModel\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport ReactComponentFactory from './components/SpreadsheetView'\nimport stateModelFactory from './models/SpreadsheetView'\n\nexport default ({ jbrequire }: PluginManager) => {\n  const ViewType = jbrequire('@jbrowse/core/pluggableElementTypes/ViewType')\n\n  const ReactComponent = jbrequire(ReactComponentFactory)\n  const stateModel = jbrequire(stateModelFactory)\n\n  return new ViewType({ name: 'SpreadsheetView', stateModel, ReactComponent })\n}\n","import { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport ViewComfyIcon from '@material-ui/icons/ViewComfy'\nimport SpreadsheetViewTypeFactory from './SpreadsheetView/SpreadsheetViewType'\n\nexport default class SpreadsheetViewPlugin extends Plugin {\n  name = 'SpreadsheetViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() =>\n      pluginManager.jbrequire(SpreadsheetViewTypeFactory),\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['File', 'Add'], {\n        label: 'Spreadsheet view',\n        icon: ViewComfyIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('SpreadsheetView', {})\n        },\n      })\n    }\n  }\n}\n","import FolderOpenIcon from '@material-ui/icons/FolderOpen'\n\nexport default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { observer, PropTypes } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n  const IconButton = jbrequire('@material-ui/core/IconButton')\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const Grid = jbrequire('@material-ui/core/Grid')\n  const FormControlLabel = jbrequire('@material-ui/core/FormControlLabel')\n  const Checkbox = jbrequire('@material-ui/core/Checkbox')\n  const { ResizeHandle } = jbrequire('@jbrowse/core/ui')\n  const { grey } = jbrequire('@material-ui/core/colors')\n\n  const headerHeight = 52\n\n  const style = {\n    width: 4,\n    background: '#ccc',\n    boxSizing: 'border-box',\n    borderTop: '1px solid #fafafa',\n  }\n  const useStyles = makeStyles(theme => {\n    return {\n      root: {\n        marginBottom: theme.spacing(1),\n        background: 'white',\n        overflow: 'hidden',\n      },\n      header: {\n        overflow: 'hidden',\n        whiteSpace: 'nowrap',\n        boxSizing: 'border-box',\n        height: headerHeight,\n        background: grey[200],\n        // borderBottom: '1px solid #a2a2a2',\n      },\n      viewControls: {\n        margin: 0,\n      },\n      viewsContainer: {\n        display: 'flex',\n      },\n      spreadsheetViewContainer: {\n        borderRight: [['1px', 'solid', grey[400]]],\n        overflow: 'hidden',\n      },\n      circularViewOptions: {\n        padding: theme.spacing(1),\n        background: grey[200],\n      },\n    }\n  })\n\n  const ViewControls = observer(({ model }) => {\n    const classes = useStyles()\n    return (\n      <Grid\n        className={classes.viewControls}\n        container\n        spacing={1}\n        direction=\"row\"\n        alignItems=\"center\"\n      >\n        <Grid item>\n          <IconButton\n            onClick={() => model.setImportMode()}\n            className={classes.iconButton}\n            title=\"open a tabular file\"\n            data-testid=\"sv_inspector_view_open\"\n            color=\"secondary\"\n          >\n            <FolderOpenIcon />\n          </IconButton>\n        </Grid>\n      </Grid>\n    )\n  })\n\n  const CircularViewOptions = observer(({ svInspector }) => {\n    const classes = useStyles()\n\n    return (\n      <Grid\n        container\n        className={classes.circularViewOptions}\n        style={{ height: svInspector.circularViewOptionsBarHeight }}\n      >\n        <Grid item>\n          <FormControlLabel\n            control={\n              <Checkbox\n                className={classes.rowSelector}\n                checked={svInspector.onlyDisplayRelevantRegionsInCircularView}\n                onClick={evt =>\n                  svInspector.setOnlyDisplayRelevantRegionsInCircularView(\n                    evt.target.checked,\n                  )\n                }\n              />\n            }\n            label=\"show only regions with data\"\n          />\n        </Grid>\n      </Grid>\n    )\n  })\n\n  function SvInspectorView({ model }) {\n    const classes = useStyles()\n\n    const {\n      resizeHeight,\n      dragHandleHeight,\n      SpreadsheetViewReactComponent,\n      CircularViewReactComponent,\n      showCircularView,\n    } = model\n\n    return (\n      <div className={classes.root} data-testid={model.id}>\n        <Grid container direction=\"row\" className={classes.header}>\n          <Grid item>\n            <ViewControls model={model} />\n          </Grid>\n        </Grid>\n        <div className={classes.viewsContainer}>\n          <div className={classes.spreadsheetViewContainer}>\n            <SpreadsheetViewReactComponent model={model.spreadsheetView} />\n          </div>\n\n          {showCircularView ? (\n            <>\n              <ResizeHandle\n                onDrag={distance => {\n                  const ret1 = model.circularView.resizeWidth(-distance)\n                  const ret2 = model.spreadsheetView.resizeWidth(-ret1)\n                  return ret2\n                }}\n                vertical\n                flexbox\n                style={style}\n              />\n              <div\n                className={classes.circularViewContainer}\n                style={{ width: model.circularView.width }}\n              >\n                <CircularViewOptions svInspector={model} />\n                <CircularViewReactComponent model={model.circularView} />\n              </div>\n            </>\n          ) : null}\n        </div>\n        <ResizeHandle\n          onDrag={resizeHeight}\n          style={{\n            height: dragHandleHeight,\n            background: '#ccc',\n            boxSizing: 'border-box',\n            borderTop: '1px solid #fafafa',\n          }}\n        />\n      </div>\n    )\n  }\n  SvInspectorView.propTypes = {\n    model: PropTypes.objectOrObservableObject.isRequired,\n  }\n  return observer(SvInspectorView)\n}\n","// this file contains the rather verbose functions for\n// creating features from CSV/TSV lines\nexport default ({ jbrequire }) => {\n  const { parseLocString } = jbrequire('@jbrowse/core/util')\n\n  function makeAdHocFeature(\n    columns,\n    columnsAlreadyUsedInLocations,\n    row,\n    loc1,\n    loc2,\n    rowNumber,\n  ) {\n    // load all the other data in the row into an `otherData` object\n    const otherData = {}\n    columns.forEach((column, columnNumber) => {\n      if (columnsAlreadyUsedInLocations.includes(columnNumber)) return\n      let { text } = row.cells[columnNumber]\n      if (column.dataType.type === 'Number') text = parseFloat(text)\n      otherData[column.name] = text\n    })\n\n    // make the final feature data out of otherData + the parsed locations\n    return {\n      ...otherData,\n      uniqueId: `sv-inspector-adhoc-${rowNumber}`,\n      refName: loc1.refName,\n      start: loc1.start,\n      end: loc1.end,\n      mate: {\n        refName: loc2.refName,\n        start: loc2.start,\n        end: loc2.end,\n      },\n    }\n  }\n\n  function makeAdHocSvFeatureFromTwoLocations(\n    columns,\n    locationColumnNumbers,\n    row,\n    rowNumber,\n    isValidRefName,\n  ) {\n    // use the first two locations we found (first according to *displayed* order)\n    const loc1 = parseLocString(\n      row.cells[locationColumnNumbers[0]].text,\n      isValidRefName,\n    )\n    const loc2 = parseLocString(\n      row.cells[locationColumnNumbers[1]].text,\n      isValidRefName,\n    )\n\n    const columnsAlreadyUsedInLocations = [\n      locationColumnNumbers[0],\n      locationColumnNumbers[1],\n    ]\n\n    return makeAdHocFeature(\n      columns,\n      columnsAlreadyUsedInLocations,\n      row,\n      loc1,\n      loc2,\n      rowNumber,\n    )\n  }\n\n  function makeAdHocSvFeatureFromTwoRefStartEndSets(\n    columns,\n    locRefColumnNumbers,\n    locStartColumnNumbers,\n    locEndColumnNumbers,\n    row,\n    rowNumber,\n  ) {\n    const textOf = colno => row.cells[colno].text\n    const loc1 = {\n      refName: textOf(locRefColumnNumbers[0]),\n      start: parseInt(textOf(locStartColumnNumbers[0]), 10) - 1,\n      end: parseInt(textOf(locEndColumnNumbers[0]), 10),\n    }\n    const loc2 = {\n      refName: textOf(locRefColumnNumbers[1]),\n      start: parseInt(textOf(locStartColumnNumbers[1]), 10) - 1,\n      end: parseInt(textOf(locEndColumnNumbers[1]), 10),\n    }\n    const columnsAlreadyUsedInLocations = [\n      locRefColumnNumbers[0],\n      locStartColumnNumbers[0],\n      locEndColumnNumbers[0],\n      locRefColumnNumbers[1],\n      locStartColumnNumbers[1],\n      locEndColumnNumbers[1],\n    ]\n    return makeAdHocFeature(\n      columns,\n      columnsAlreadyUsedInLocations,\n      row,\n      loc1,\n      loc2,\n      rowNumber,\n    )\n  }\n\n  // makes a feature data object (passed as `data` to a SimpleFeature constructor)\n  // out of table row if the row has 2 location columns. undefined if not\n  function makeAdHocSvFeature(sheet, rowNumber, row, isValidRefName) {\n    const { columns, columnDisplayOrder } = sheet\n    const columnTypes = {}\n    columnDisplayOrder.forEach(columnNumber => {\n      const columnDefinition = columns[columnNumber]\n      if (!columnTypes[columnDefinition.dataType.type])\n        columnTypes[columnDefinition.dataType.type] = []\n      columnTypes[columnDefinition.dataType.type].push(columnNumber)\n    })\n    const locationColumnNumbers = columnTypes.LocString || []\n    const locStartColumnNumbers = columnTypes.LocStart || []\n    const locEndColumnNumbers = columnTypes.LocEnd || []\n    const locRefColumnNumbers = columnTypes.LocRef || []\n\n    // if we have 2 or more columns of type location, make a feature from them\n    if (locationColumnNumbers.length >= 2) {\n      return makeAdHocSvFeatureFromTwoLocations(\n        columns,\n        locationColumnNumbers,\n        row,\n        rowNumber,\n        isValidRefName,\n      )\n    }\n    if (\n      locRefColumnNumbers.length >= 2 &&\n      locStartColumnNumbers.length >= 2 &&\n      locEndColumnNumbers.length >= 2\n    ) {\n      return makeAdHocSvFeatureFromTwoRefStartEndSets(\n        columns,\n        locRefColumnNumbers,\n        locStartColumnNumbers,\n        locEndColumnNumbers,\n        row,\n        rowNumber,\n      )\n    }\n    return undefined\n  }\n\n  return {\n    makeAdHocSvFeature,\n    makeAdHocSvFeatureFromTwoLocations,\n    makeAdHocSvFeatureFromTwoRefStartEndSets,\n  }\n}\n","import SimpleFeature from '@jbrowse/core/util/simpleFeature'\nimport adhocFeatureUtilsFactory from './adhocFeatureUtils'\n\nexport default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { getSession } = jbrequire('@jbrowse/core/util')\n\n  const { makeAdHocSvFeature } = jbrequire(adhocFeatureUtilsFactory)\n\n  function getSerializedFeatureForRow(\n    session,\n    spreadsheetView,\n    row,\n    rowNumber,\n  ) {\n    if (row.extendedData) {\n      if (row.extendedData.vcfFeature) return row.extendedData.vcfFeature\n      if (row.extendedData.feature) return row.extendedData.feature\n    }\n    const adhocFeature = makeAdHocSvFeature(\n      spreadsheetView.spreadsheet,\n      rowNumber,\n      row,\n      session.assemblyManager.isValidRefName,\n    )\n    if (adhocFeature) return adhocFeature\n    return undefined\n  }\n\n  function breakpointSplitViewSnapshotFromTableRow(\n    svInspectorView,\n    spreadsheetView,\n    spreadsheet,\n    row,\n    rowNumber,\n  ) {\n    const session = getSession(spreadsheetView)\n    const featureData = getSerializedFeatureForRow(\n      session,\n      spreadsheet,\n      row,\n      rowNumber,\n    )\n    if (featureData) {\n      const feature = new SimpleFeature(featureData)\n      session.setSelection(feature)\n      const viewType = pluginManager.getViewType('BreakpointSplitView')\n      const { circularView } = svInspectorView\n      const viewSnapshot = viewType.snapshotFromBreakendFeature(\n        feature,\n        circularView,\n      )\n      return viewSnapshot\n    }\n    return undefined\n  }\n\n  function openBreakpointSplitViewFromTableRow(\n    svInspectorView,\n    spreadsheetView,\n    spreadsheet,\n    row,\n    rowNumber,\n  ) {\n    const viewSnapshot = breakpointSplitViewSnapshotFromTableRow(\n      svInspectorView,\n      spreadsheetView,\n      spreadsheet,\n      row,\n      rowNumber,\n    )\n    if (viewSnapshot) {\n      // try to center the offsetPx\n      const { circularView } = svInspectorView\n      viewSnapshot.views[0].offsetPx -= circularView.width / 2 + 100\n      viewSnapshot.views[1].offsetPx -= circularView.width / 2 + 100\n\n      const session = getSession(spreadsheetView)\n      session.addView('BreakpointSplitView', viewSnapshot)\n    }\n  }\n\n  function canOpenBreakpointSplitViewFromTableRow(\n    svInspectorView,\n    spreadsheetView,\n    spreadsheet,\n    row,\n    rowNumber,\n  ) {\n    try {\n      const viewSnapshot = breakpointSplitViewSnapshotFromTableRow(\n        svInspectorView,\n        spreadsheetView,\n        spreadsheet,\n        row,\n        rowNumber,\n      )\n      return Boolean(viewSnapshot)\n    } catch (e) {\n      return false\n    }\n  }\n\n  return {\n    getSerializedFeatureForRow,\n    breakpointSplitViewSnapshotFromTableRow,\n    canOpenBreakpointSplitViewFromTableRow,\n    openBreakpointSplitViewFromTableRow,\n  }\n}\n","import OpenInNewIcon from '@material-ui/icons/OpenInNew'\nimport breakpointSplitViewFromTableRowFactory from './breakpointSplitViewFromTableRow'\n\nfunction defaultOnChordClick(feature, chordTrack, pluginManager) {\n  const { jbrequire } = pluginManager\n  // const { getConf } = jbrequire('@jbrowse/core/configuration')\n  const { getContainingView, getSession } = jbrequire('@jbrowse/core/util')\n  // const { resolveIdentifier } = jbrequire('mobx-state-tree')\n\n  const session = getSession(chordTrack)\n  session.setSelection(feature)\n  const view = getContainingView(chordTrack)\n  const viewType = pluginManager.getViewType('BreakpointSplitView')\n  const viewSnapshot = viewType.snapshotFromBreakendFeature(feature, view)\n\n  // disabling this for now since there isn't a way to set configRelationships\n  // on the generated chord display from the SV inspector\n\n  // // open any evidence tracks defined in configRelationships for this track\n  // const tracks = getConf(chordTrack, 'configRelationships')\n  //   .map(entry => {\n  //     const type = pluginManager.pluggableConfigSchemaType('track')\n  //     const trackConfig = resolveIdentifier(type, session, entry.target)\n  //     return trackConfig\n  //       ? {\n  //           type: trackConfig.type,\n  //           height: 100,\n  //           configuration: trackConfig.trackId,\n  //           selectedRendering: '',\n  //         }\n  //       : null\n  //   })\n  //   .filter(f => !!f)\n  // viewSnapshot.views[0].tracks = tracks\n  // viewSnapshot.views[1].tracks = tracks\n\n  // try to center the offsetPx\n  viewSnapshot.views[0].offsetPx -= view.width / 2 + 100\n  viewSnapshot.views[1].offsetPx -= view.width / 2 + 100\n  viewSnapshot.featureData = feature.data\n\n  session.addView('BreakpointSplitView', viewSnapshot)\n}\n\nexport default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { autorun, reaction } = jbrequire('mobx')\n  const { types, getParent, addDisposer, getSnapshot } = jbrequire(\n    'mobx-state-tree',\n  )\n  const { BaseViewModel } = jbrequire(\n    '@jbrowse/core/pluggableElementTypes/models',\n  )\n  const { getSession } = jbrequire('@jbrowse/core/util')\n  const { readConfObject } = jbrequire('@jbrowse/core/configuration')\n\n  const SpreadsheetViewType = pluginManager.getViewType('SpreadsheetView')\n  const CircularViewType = pluginManager.getViewType('CircularView')\n\n  const minHeight = 400\n  const defaultHeight = 500\n  const headerHeight = 52\n  const circularViewOptionsBarHeight = 52\n\n  const {\n    canOpenBreakpointSplitViewFromTableRow,\n    openBreakpointSplitViewFromTableRow,\n    getSerializedFeatureForRow,\n  } = jbrequire(breakpointSplitViewFromTableRowFactory)\n\n  const model = types\n    .model('SvInspectorView', {\n      type: types.literal('SvInspectorView'),\n      dragHandleHeight: 4,\n      height: types.optional(\n        types.refinement(\n          'SvInspectorViewHeight',\n          types.number,\n          n => n >= minHeight,\n        ),\n        defaultHeight,\n      ),\n\n      onlyDisplayRelevantRegionsInCircularView: false,\n\n      // switch specifying whether we are showing the import wizard or the spreadsheet in our viewing area\n      mode: types.optional(\n        types.enumeration('SvInspectorViewMode', ['import', 'display']),\n        'import',\n      ),\n\n      spreadsheetView: types.optional(SpreadsheetViewType.stateModel, () =>\n        SpreadsheetViewType.stateModel.create({\n          type: 'SpreadsheetView',\n          hideViewControls: true,\n          hideVerticalResizeHandle: true,\n        }),\n      ),\n\n      circularView: types.optional(CircularViewType.stateModel, () =>\n        CircularViewType.stateModel.create({\n          type: 'CircularView',\n          hideVerticalResizeHandle: true,\n          hideTrackSelectorButton: true,\n          disableImportForm: true,\n        }),\n      ),\n    })\n    .volatile(() => ({\n      width: 800,\n    }))\n    .views(self => ({\n      get selectedRows() {\n        return self.spreadsheetView.rowSet.selectedRows\n      },\n\n      get assemblyName() {\n        const { assembly } = self.spreadsheetView\n        if (assembly) return readConfObject(assembly, 'name')\n        return undefined\n      },\n\n      get showCircularView() {\n        return self.spreadsheetView.mode === 'display'\n      },\n\n      get featuresAdapterConfigSnapshot() {\n        const session = getSession(self)\n        return {\n          type: 'FromConfigAdapter',\n          features: (self.spreadsheetView.outputRows || [])\n            .map((row, rowNumber) =>\n              getSerializedFeatureForRow(\n                session,\n                self.spreadsheetView,\n                row,\n                rowNumber,\n              ),\n            )\n            .filter(f => Boolean(f)),\n        }\n      },\n\n      // Promise<string[]> of refnames\n      get featuresRefNamesP() {\n        const {\n          AdapterClass: FromConfigAdapter,\n        } = pluginManager.getAdapterType('FromConfigAdapter')\n        const adapter = new FromConfigAdapter(\n          self.featuresAdapterConfigSnapshot,\n        )\n        return adapter.getRefNames()\n      },\n\n      get featuresCircularTrackConfiguration() {\n        const configuration = {\n          type: 'VariantTrack',\n          trackId: `sv-inspector-variant-track-${self.id}`,\n          name: 'features from tabular data',\n          adapter: self.featuresAdapterConfigSnapshot,\n          assemblyNames: [self.assemblyName],\n          displays: [\n            {\n              type: 'ChordVariantDisplay',\n              displayId: `sv-inspector-variant-track-chord-display-${self.id}`,\n              onChordClick: defaultOnChordClick.toString(),\n              renderer: { type: 'StructuralVariantChordRenderer' },\n            },\n          ],\n        }\n        return configuration\n      },\n    }))\n    .volatile(() => ({\n      SpreadsheetViewReactComponent: SpreadsheetViewType.ReactComponent,\n      CircularViewReactComponent: CircularViewType.ReactComponent,\n      circularViewOptionsBarHeight,\n    }))\n    .actions(self => ({\n      afterAttach() {\n        // synchronize subview widths\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              const borderWidth = 1\n              if (self.showCircularView) {\n                const spreadsheetWidth = Math.round(self.width * 0.66)\n                const circularViewWidth = self.width - spreadsheetWidth\n                self.spreadsheetView.setWidth(spreadsheetWidth - borderWidth)\n                self.circularView.setWidth(circularViewWidth)\n              } else {\n                self.spreadsheetView.setWidth(self.width)\n              }\n            },\n            { name: 'SvInspectorView width binding' },\n          ),\n        )\n        // synchronize subview heights\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              self.spreadsheetView.setHeight(self.height - headerHeight)\n              self.circularView.setHeight(\n                self.height - headerHeight - circularViewOptionsBarHeight,\n              )\n            },\n            { name: 'SvInspectorView height binding' },\n          ),\n        )\n        // bind circularview displayedRegions to spreadsheet assembly, mediated by\n        // the onlyRelevantRegions toggle\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              const {\n                assemblyName,\n                onlyDisplayRelevantRegionsInCircularView,\n                circularView,\n                featuresRefNamesP,\n              } = self\n              const { tracks } = circularView\n              const session = getSession(self)\n              if (assemblyName) {\n                const assembly = session.assemblyManager.get(assemblyName)\n                if (assembly) {\n                  let { regions: assemblyRegions } = assembly\n                  if (!assemblyRegions) {\n                    assemblyRegions = []\n                  } else {\n                    assemblyRegions = getSnapshot(assemblyRegions)\n                  }\n                  if (onlyDisplayRelevantRegionsInCircularView) {\n                    if (tracks.length === 1) {\n                      const {\n                        getCanonicalRefName,\n                      } = session.assemblyManager.get(assemblyName)\n\n                      featuresRefNamesP\n                        .then(featureRefNames => {\n                          // canonicalize the store's ref names if necessary\n                          const canonicalFeatureRefNames = new Set(\n                            featureRefNames.map(\n                              refName =>\n                                getCanonicalRefName(refName) || refName,\n                            ),\n                          )\n                          const displayedRegions = assemblyRegions.filter(r =>\n                            canonicalFeatureRefNames.has(r.refName),\n                          )\n                          circularView.setDisplayedRegions(\n                            JSON.parse(JSON.stringify(displayedRegions)),\n                          )\n                        })\n                        .catch(e => circularView.setError(e))\n                    }\n                  } else {\n                    circularView.setDisplayedRegions(assemblyRegions)\n                  }\n                } else {\n                  circularView.setDisplayedRegions([])\n                }\n              }\n            },\n            { name: 'SvInspectorView displayed regions bind' },\n          ),\n        )\n\n        // bind circularview tracks to our track snapshot view\n        addDisposer(\n          self,\n          reaction(\n            () => ({\n              generatedTrackConf:\n                self && self.featuresCircularTrackConfiguration,\n              assemblyName: self && self.assemblyName,\n            }),\n            data => {\n              if (!data) return\n              const { assemblyName, generatedTrackConf } = data\n              // hide any visible tracks\n              if (self.circularView.tracks.length) {\n                self.circularView.tracks.forEach(track => {\n                  self.circularView.hideTrack(track.configuration.trackId)\n                })\n              }\n\n              // put our track in as the only track\n              if (assemblyName && generatedTrackConf) {\n                self.circularView.addTrackConf(generatedTrackConf, {\n                  assemblyName,\n                })\n              }\n            },\n            {\n              name: 'SvInspectorView track configuration binding',\n              fireImmediately: true,\n            },\n          ),\n        )\n\n        // bind spreadsheetView row menu actions to us\n        addDisposer(\n          self,\n          autorun(() => {\n            self.spreadsheetView.setRowMenuItems(\n              // these are the MenuItem entries for the row menu actions in the spreadsheet view.\n              // these are installed into the child SpreadsheetView using an autorun below\n              [\n                {\n                  label: 'Open split detail view',\n                  icon: OpenInNewIcon,\n                  disabled(spreadsheetView, spreadsheet, rowNumber, row) {\n                    return !canOpenBreakpointSplitViewFromTableRow(\n                      self,\n                      spreadsheetView,\n                      spreadsheet,\n                      row,\n                      rowNumber,\n                    )\n                  },\n                  onClick(spreadsheetView, spreadsheet, rowNumber, row) {\n                    openBreakpointSplitViewFromTableRow(\n                      self,\n                      spreadsheetView,\n                      spreadsheet,\n                      row,\n                      rowNumber,\n                    )\n                  },\n                },\n              ],\n            )\n          }),\n        )\n      },\n      setWidth(newWidth) {\n        self.width = newWidth\n      },\n      setHeight(newHeight) {\n        if (newHeight > minHeight) self.height = newHeight\n        else self.height = minHeight\n        return self.height\n      },\n      resizeHeight(distance) {\n        const oldHeight = self.height\n        const newHeight = self.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n\n      setImportMode() {\n        self.spreadsheetView.setImportMode()\n      },\n\n      setDisplayMode() {\n        self.spreadsheetView.setDisplayMode()\n      },\n\n      closeView() {\n        getParent(self, 2).removeView(self)\n      },\n\n      setDisplayedRegions(regions) {\n        self.circularView.setDisplayedRegions(regions)\n      },\n\n      setOnlyDisplayRelevantRegionsInCircularView(val) {\n        self.onlyDisplayRelevantRegionsInCircularView = Boolean(val)\n      },\n    }))\n\n  const stateModel = types.compose(BaseViewModel, model)\n\n  return { stateModel }\n}\n","import ReactComponentFactory from './components/SvInspectorView'\nimport StateModelFactory from './models/SvInspectorView'\n\nexport default ({ jbrequire }) => {\n  const ViewType = jbrequire('@jbrowse/core/pluggableElementTypes/ViewType')\n\n  const ReactComponent = jbrequire(ReactComponentFactory)\n  const { stateModel } = jbrequire(StateModelFactory)\n\n  return new ViewType({ name: 'SvInspectorView', stateModel, ReactComponent })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport {\n  AbstractSessionModel,\n  isAbstractMenuManager,\n} from '@jbrowse/core/util/types'\nimport TableChartIcon from '@material-ui/icons/TableChart'\nimport SvInspectorViewTypeFactory from './SvInspectorView/SvInspectorViewType'\n\nexport default class SvInspectorViewPlugin extends Plugin {\n  name = 'SvInspectorViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() =>\n      pluginManager.jbrequire(SvInspectorViewTypeFactory),\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['File', 'Add'], {\n        label: 'SV inspector',\n        icon: TableChartIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('SvInspectorView', {})\n        },\n      })\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'HicAdapter',\n  {\n    hicLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.hic' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","// import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchema from './configSchema'\nimport Adapter from './HicAdapter'\n\nexport default (/* pluginManager: PluginManager */) => {\n  return {\n    configSchema,\n    AdapterClass: Adapter,\n  }\n}\n","import { Region } from '@jbrowse/core/util/types'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport React from 'react'\nimport { BaseLinearDisplayModel } from '@jbrowse/plugin-linear-genome-view'\n\nfunction HicRendering(props: {\n  blockKey: string\n  displayModel: BaseLinearDisplayModel\n  width: number\n  height: number\n  regions: Region[]\n  bpPerPx: number\n}) {\n  const { width, height } = props\n  const canvasWidth = Math.ceil(width)\n  // need to call this in render so we get the right observer behavior\n  return (\n    <div\n      className=\"PileupRendering\"\n      style={{ position: 'relative', width: canvasWidth, height }}\n    >\n      <PrerenderedCanvas\n        {...props}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n      />\n    </div>\n  )\n}\n\nexport default observer(HicRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'HicRenderer',\n  {\n    baseColor: {\n      type: 'color',\n      description: 'base color to be used in the hic alignment',\n      defaultValue: '#f00',\n    },\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a hic alignment',\n      defaultValue: `function(counts, maxScore, baseColor) {\n      return baseColor.alpha(Math.min(1,counts/(maxScore/20))).hsl().string()\n}`,\n      functionSignature: ['count', 'maxScore', 'baseColor'],\n    },\n\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a hic rendering',\n      defaultValue: 600,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport Color from 'color'\nimport ServerSideRendererType, {\n  RenderArgsDeserialized,\n  RenderArgs,\n  ResultsDeserialized,\n  ResultsSerialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType'\nimport SimpleFeature from '@jbrowse/core/util/simpleFeature'\nimport { Region } from '@jbrowse/core/util/types'\nimport {\n  createCanvas,\n  createImageBitmap,\n} from '@jbrowse/core/util/offscreenCanvasPonyfill'\nimport React from 'react'\nimport { toArray } from 'rxjs/operators'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\n\ninterface HicFeature {\n  bin1: number\n  bin2: number\n  counts: number\n}\n\ninterface HicDataAdapter extends BaseFeatureDataAdapter {\n  getResolution: (bp: number) => number\n}\n\nexport interface PileupRenderProps {\n  features: HicFeature[]\n  dataAdapter: HicDataAdapter\n  config: AnyConfigurationModel\n  regions: Region[]\n  bpPerPx: number\n  height: number\n  width: number\n  highResolutionScaling: number\n  sortObject: {\n    position: number\n    by: string\n  }\n}\n\nexport default class HicRenderer extends ServerSideRendererType {\n  async makeImageData(props: PileupRenderProps) {\n    const {\n      features,\n      config,\n      regions,\n      bpPerPx,\n      highResolutionScaling = 1,\n      dataAdapter,\n    } = props\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n    const height = readConfObject(config, 'maxHeight')\n    const res = await dataAdapter.getResolution(bpPerPx)\n\n    if (!(width > 0) || !(height > 0)) {\n      return { height: 0, width: 0, maxHeightReached: false }\n    }\n\n    const canvas = createCanvas(\n      Math.ceil(width * highResolutionScaling),\n      height * highResolutionScaling,\n    )\n    const w = res / (bpPerPx * Math.sqrt(2))\n    const ctx = canvas.getContext('2d')\n    ctx.scale(highResolutionScaling, highResolutionScaling)\n    const baseColor = Color(readConfObject(config, 'baseColor'))\n    if (features.length) {\n      const offset = features[0].bin1\n      let maxScore = 0\n      let minBin = 0\n      let maxBin = 0\n      for (let i = 0; i < features.length; i++) {\n        const { bin1, bin2, counts } = features[i]\n        maxScore = Math.max(counts, maxScore)\n        minBin = Math.min(Math.min(bin1, bin2), minBin)\n        maxBin = Math.max(Math.max(bin1, bin2), maxBin)\n      }\n      ctx.rotate(-Math.PI / 4)\n      for (let i = 0; i < features.length; i++) {\n        const { bin1, bin2, counts } = features[i]\n        ctx.fillStyle = readConfObject(config, 'color', [\n          counts,\n          maxScore,\n          baseColor,\n        ])\n        ctx.fillRect((bin1 - offset) * w, (bin2 - offset) * w, w, w)\n      }\n    }\n\n    const imageData = await createImageBitmap(canvas)\n    return {\n      imageData,\n      height,\n      width,\n    }\n  }\n\n  async render(renderProps: PileupRenderProps) {\n    const {\n      height,\n      width,\n      imageData,\n      maxHeightReached,\n    } = await this.makeImageData(renderProps)\n    const element = React.createElement(\n      this.ReactComponent,\n      {\n        ...renderProps,\n        region: renderProps.regions[0],\n        height,\n        width,\n        imageData,\n      },\n      null,\n    )\n\n    return {\n      element,\n      imageData,\n      height,\n      width,\n      maxHeightReached,\n    }\n  }\n\n  async getFeatures({\n    dataAdapter,\n    signal,\n    bpPerPx,\n    regions,\n  }: RenderArgsDeserialized) {\n    const features = await dataAdapter\n      .getFeatures(regions[0], { signal, bpPerPx })\n      .pipe(toArray())\n      .toPromise()\n    // cast to any to avoid return-type conflict, because the\n    // types of features returned by our getFeatures are quite\n    // different from the base interface\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return features as any\n  }\n\n  serializeResultsInWorker(result: { html: string }): ResultsSerialized {\n    const serialized = ({ ...result } as unknown) as ResultsSerialized\n    return serialized\n  }\n\n  deserializeResultsInClient(\n    result: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    // deserialize some of the results that came back from the worker\n    const deserialized = ({ ...result } as unknown) as ResultsDeserialized\n    const featuresMap = new Map<string, SimpleFeature>()\n\n    deserialized.features = featuresMap\n    deserialized.blockKey = args.blockKey\n    return deserialized\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nconst HicTrackConfigFactory = (pluginManager: PluginManager) => {\n  const HicRendererConfigSchema = pluginManager.getRendererType('HicRenderer')\n    .configSchema\n\n  return ConfigurationSchema(\n    'LinearHicDisplay',\n    { renderer: HicRendererConfigSchema },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n\nexport type HicTrackConfigModel = ReturnType<typeof HicTrackConfigFactory>\nexport type HicTrackConfig = Instance<HicTrackConfigModel>\nexport default HicTrackConfigFactory\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport { AnyConfigurationSchemaType } from '@jbrowse/core/configuration/configurationSchema'\n\nexport default (configSchema: AnyConfigurationSchemaType) =>\n  types\n    .compose(\n      'LinearHicDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearHicDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(self => ({\n      get blockType() {\n        return 'dynamicBlocks'\n      },\n      get rendererTypeName() {\n        return 'HicRenderer'\n      },\n\n      /**\n       * the react props that are passed to the Renderer when data\n       * is rendered in this track\n       */\n      get renderProps() {\n        const config = self.rendererType.configSchema.create(\n          getConf(self, 'renderer') || {},\n        )\n\n        return {\n          ...self.composedRenderProps,\n          ...getParentRenderProps(self),\n          config,\n          displayModel: self,\n        }\n      },\n    }))\n","import Alignments from '@jbrowse/plugin-alignments'\nimport Bed from '@jbrowse/plugin-bed'\nimport BreakpointSplitView from '@jbrowse/plugin-breakpoint-split-view'\nimport CircularView from '@jbrowse/plugin-circular-view'\nimport Config from '@jbrowse/plugin-config'\nimport DataManagement from '@jbrowse/plugin-data-management'\nimport DotplotView from '@jbrowse/plugin-dotplot-view'\nimport Filtering from '@jbrowse/plugin-filtering'\nimport Gff3Tabix from '@jbrowse/plugin-gff3'\nimport LegacyJBrowse from '@jbrowse/plugin-legacy-jbrowse'\nimport LinearGenomeView from '@jbrowse/plugin-linear-genome-view'\nimport LinearComparativeView from '@jbrowse/plugin-linear-comparative-view'\nimport Lollipop from '@jbrowse/plugin-lollipop'\nimport Menus from '@jbrowse/plugin-menus'\nimport RDF from '@jbrowse/plugin-rdf'\nimport Sequence from '@jbrowse/plugin-sequence'\nimport SVG from '@jbrowse/plugin-svg'\nimport TrackHubRegistry from '@jbrowse/plugin-trackhub-registry'\nimport Variants from '@jbrowse/plugin-variants'\nimport Wiggle from '@jbrowse/plugin-wiggle'\nimport SpreadsheetViewPlugin from '@jbrowse/plugin-spreadsheet-view'\nimport SvInspectorPlugin from '@jbrowse/plugin-sv-inspector'\nimport HicPlugin from '@jbrowse/plugin-hic'\n\nexport default [\n  SVG,\n  LinearGenomeView,\n  Alignments,\n  Bed,\n  CircularView,\n  Config,\n  DataManagement,\n  DotplotView,\n  Filtering,\n  Gff3Tabix,\n  LegacyJBrowse,\n  LinearComparativeView,\n  Lollipop,\n  Menus,\n  RDF,\n  Sequence,\n  TrackHubRegistry,\n  Variants,\n  Wiggle,\n  SpreadsheetViewPlugin,\n  SvInspectorPlugin,\n  BreakpointSplitView,\n  HicPlugin,\n]\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport HicAdapterFactory from './HicAdapter'\nimport HicRenderer, {\n  configSchema as hicRendererConfigSchema,\n  ReactComponent as HicRendererReactComponent,\n} from './HicRenderer'\nimport {\n  configSchemaFactory as linearHicdisplayConfigSchemaFactory,\n  modelFactory as linearHicdisplayModelFactory,\n} from './LinearHicDisplay'\n\nexport default class HicPlugin extends Plugin {\n  name = 'HicPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'HicAdapter',\n          ...pluginManager.jbrequire(HicAdapterFactory),\n        }),\n    )\n    pluginManager.addRendererType(\n      () =>\n        new HicRenderer({\n          name: 'HicRenderer',\n          ReactComponent: HicRendererReactComponent,\n          configSchema: hicRendererConfigSchema,\n        }),\n    )\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'HicTrack',\n        {},\n        {\n          baseConfiguration: createBaseTrackConfig(pluginManager),\n          explicitIdentifier: 'trackId',\n        },\n      )\n      return new TrackType({\n        name: 'HicTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'HicTrack',\n          configSchema,\n        ),\n      })\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearHicdisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearHicDisplay',\n        configSchema,\n        stateModel: linearHicdisplayModelFactory(configSchema),\n        trackType: 'HicTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n  }\n}\n","/* eslint-disable no-nested-ternary */\nimport React, { useState, useEffect } from 'react'\nimport Button from '@material-ui/core/Button'\nimport ShareIcon from '@material-ui/icons/Share'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Divider from '@material-ui/core/Divider'\nimport IconButton from '@material-ui/core/IconButton'\nimport FormControl from '@material-ui/core/FormControl'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\nimport Radio from '@material-ui/core/Radio'\nimport RadioGroup from '@material-ui/core/RadioGroup'\nimport TextField from '@material-ui/core/TextField'\nimport Typography from '@material-ui/core/Typography'\nimport HelpOutlineIcon from '@material-ui/icons/HelpOutline'\nimport SettingsIcon from '@material-ui/icons/Settings'\nimport CloseIcon from '@material-ui/icons/Close'\nimport copy from 'copy-to-clipboard'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\nimport { getSnapshot } from 'mobx-state-tree'\nimport { toUrlSafeB64 } from '@jbrowse/core/util'\nimport { shareSessionToDynamo } from './sessionSharing'\nimport { SessionModel } from './sessionModelFactory'\n\nconst useStyles = makeStyles(theme => ({\n  shareDiv: {\n    textAlign: 'center',\n    paddingLeft: '2px',\n  },\n  shareButton: {\n    '&:hover': {\n      backgroundColor: fade(\n        theme.palette.primary.contrastText,\n        theme.palette.action.hoverOpacity,\n      ),\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n  loadingMessage: {\n    padding: theme.spacing(5),\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nconst SHARE_URL_LOCALSTORAGE_KEY = 'jbrowse-shareURL'\n\nfunction SettingsDialog(props: {\n  open: boolean\n  onClose: Function\n  currentSetting: string\n}) {\n  const classes = useStyles()\n  const { onClose, open, currentSetting } = props\n  const [setting, setSetting] = useState(currentSetting)\n  const [infoDialogOpen, setInfoDialogOpen] = useState(false)\n\n  const handleClose = () => {\n    localStorage.setItem(SHARE_URL_LOCALSTORAGE_KEY, setting)\n    onClose(setting)\n  }\n\n  return (\n    <>\n      <Dialog\n        onClose={handleClose}\n        aria-labelledby=\"simple-dialog-title\"\n        open={open}\n      >\n        <DialogTitle id=\"simple-dialog-title\">\n          Configure session sharing\n          {handleClose ? (\n            <IconButton className={classes.closeButton} onClick={handleClose}>\n              <CloseIcon />\n            </IconButton>\n          ) : null}\n        </DialogTitle>\n        <DialogContent>\n          <DialogContentText>\n            Select between generating long or short URLs for the session sharing\n            <IconButton onClick={() => setInfoDialogOpen(true)}>\n              <HelpOutlineIcon />\n            </IconButton>\n          </DialogContentText>\n          <FormControl component=\"fieldset\">\n            <RadioGroup\n              aria-label=\"gender\"\n              name=\"gender1\"\n              value={setting}\n              onChange={event => {\n                const val = event.target.value\n                setSetting(val)\n              }}\n            >\n              <FormControlLabel\n                value=\"short\"\n                control={<Radio />}\n                label=\"Short URL\"\n              />\n              <FormControlLabel\n                value=\"long\"\n                control={<Radio />}\n                label=\"Long URL\"\n              />\n            </RadioGroup>\n          </FormControl>\n        </DialogContent>\n      </Dialog>\n      <InfoDialog\n        open={infoDialogOpen}\n        onClose={() => {\n          setInfoDialogOpen(false)\n        }}\n      />\n    </>\n  )\n}\nfunction InfoDialog(props: { open: boolean; onClose: Function }) {\n  const classes = useStyles()\n  const { onClose, open } = props\n\n  const handleClose = () => {\n    onClose()\n  }\n\n  return (\n    <Dialog\n      onClose={handleClose}\n      aria-labelledby=\"simple-dialog-title\"\n      open={open}\n    >\n      <DialogTitle id=\"simple-dialog-title\">\n        Info about session URLs\n        {onClose ? (\n          <IconButton className={classes.closeButton} onClick={handleClose}>\n            <CloseIcon />\n          </IconButton>\n        ) : null}\n      </DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          Because everything about the JBrowse session is encoded in the URL\n          (e.g. state of the tracks, views, features selected, etc.) the\n          sessions can get very long. Therefore, we created a URL shortener,\n          both as a convenience and because long URLs can break some programs.\n          Note that both the long and short URLs encode the same data, but due\n          to long URLs causing problems with some programs, we recommend sharing\n          short URLs.\n        </DialogContentText>\n        <DialogContentText>\n          We generate the short URLs in a secure manner which involves\n          encrypting the session on the client side with a random password\n          string and uploading them to a central database. Then the random\n          password is added to the URL but is not uploaded to the central\n          database, making these short URLs effectively &quot;end-to-end\n          encrypted&quot;\n        </DialogContentText>\n        <DialogContentText>\n          Only users with a share link can read the session.\n        </DialogContentText>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst ShareDialog = observer(\n  ({\n    handleClose,\n    session,\n  }: {\n    handleClose: () => void\n    session: SessionModel\n  }) => {\n    const classes = useStyles()\n    const [shortUrl, setShortUrl] = useState('')\n    const [loading, setLoading] = useState(true)\n    const [error, setError] = useState<Error>()\n    const [settingsDialogOpen, setSettingsDialogOpen] = useState(false)\n\n    const url = session.shareURL\n    const currentSetting =\n      localStorage.getItem(SHARE_URL_LOCALSTORAGE_KEY) || 'short'\n    const snap = getSnapshot(session)\n\n    useEffect(() => {\n      let cancelled = false\n      ;(async () => {\n        if (currentSetting === 'short') {\n          try {\n            setLoading(true)\n            const locationUrl = new URL(window.location.href)\n            const result = await shareSessionToDynamo(\n              snap,\n              url,\n              locationUrl.href,\n            )\n            if (!cancelled) {\n              setLoading(false)\n              const params = new URLSearchParams(locationUrl.search)\n              params.set('session', `share-${result.json.sessionId}`)\n              params.set('password', result.password)\n              locationUrl.search = params.toString()\n              setShortUrl(locationUrl.href)\n            }\n          } catch (e) {\n            setLoading(false)\n            setError(e)\n          }\n        }\n      })()\n\n      return () => {\n        cancelled = true\n      }\n    }, [currentSetting, url, snap])\n\n    // generate long URL\n    const sess = `${toUrlSafeB64(JSON.stringify(getSnapshot(session)))}`\n    const longUrl = new URL(window.location.href)\n    const longParams = new URLSearchParams(longUrl.search)\n    longParams.set('session', `encoded-${sess}`)\n    longUrl.search = longParams.toString()\n    return (\n      <>\n        <Dialog\n          maxWidth=\"xl\"\n          open\n          onClose={handleClose}\n          aria-labelledby=\"alert-dialog-title\"\n          aria-describedby=\"alert-dialog-description\"\n        >\n          <DialogTitle id=\"alert-dialog-title\">\n            JBrowse Shareable Link\n            {handleClose ? (\n              <IconButton className={classes.closeButton} onClick={handleClose}>\n                <CloseIcon />\n              </IconButton>\n            ) : null}\n          </DialogTitle>\n          <Divider />\n\n          <>\n            <DialogContent>\n              <DialogContentText id=\"alert-dialog-description\">\n                Copy the URL below to share your current JBrowse session.\n                <IconButton onClick={() => setSettingsDialogOpen(true)}>\n                  <SettingsIcon />\n                </IconButton>\n              </DialogContentText>\n            </DialogContent>\n\n            <DialogContent>\n              {currentSetting === 'short' ? (\n                error ? (\n                  <Typography color=\"error\">\n                    Failed to generate short URL: {`${error}`}\n                  </Typography>\n                ) : loading ? (\n                  <Typography>Generating short URL...</Typography>\n                ) : (\n                  <TextField\n                    label=\"URL\"\n                    value={shortUrl}\n                    InputProps={{\n                      readOnly: true,\n                    }}\n                    variant=\"filled\"\n                    style={{ width: '100%' }}\n                    onClick={event => {\n                      const target = event.target as HTMLTextAreaElement\n                      target.select()\n                    }}\n                  />\n                )\n              ) : (\n                <TextField\n                  label=\"URL\"\n                  value={longUrl.toString()}\n                  InputProps={{\n                    readOnly: true,\n                  }}\n                  variant=\"filled\"\n                  style={{ width: '100%' }}\n                  onClick={event => {\n                    const target = event.target as HTMLTextAreaElement\n                    target.select()\n                  }}\n                />\n              )}\n            </DialogContent>\n          </>\n          <DialogActions>\n            <Button\n              onClick={() => {\n                copy(shortUrl || longUrl.toString())\n                session.notify('Copied to clipboard', 'success')\n              }}\n              color=\"primary\"\n              startIcon={<ContentCopyIcon />}\n            >\n              Copy URL to Clipboard\n            </Button>\n\n            <Button onClick={handleClose} color=\"primary\" autoFocus>\n              Close\n            </Button>\n          </DialogActions>\n        </Dialog>\n\n        <SettingsDialog\n          open={settingsDialogOpen}\n          onClose={() => {\n            setSettingsDialogOpen(false)\n          }}\n          currentSetting={currentSetting}\n        />\n      </>\n    )\n  },\n)\n\nconst ShareButton = observer((props: { session: SessionModel }) => {\n  const [open, setOpen] = useState(false)\n\n  const { session } = props\n  const classes = useStyles()\n\n  const handleClose = () => {\n    setOpen(false)\n  }\n\n  return (\n    <div className={classes.shareDiv}>\n      <Button\n        data-testid=\"share_button\"\n        onClick={async () => {\n          setOpen(true)\n        }}\n        size=\"small\"\n        color=\"inherit\"\n        startIcon={<ShareIcon />}\n        classes={{ root: classes.shareButton }}\n      >\n        Share\n      </Button>\n      {open ? (\n        <ShareDialog handleClose={handleClose} session={session} />\n      ) : null}\n    </div>\n  )\n})\n\nexport default ShareButton\n","import React, { useEffect } from 'react'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { useQueryParam, StringParam } from 'use-query-params'\nimport { App, createJBrowseTheme } from '@jbrowse/core/ui'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport { ThemeProvider } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport { onSnapshot } from 'mobx-state-tree'\nimport ShareButton from './ShareButton'\n\nfunction deleteBaseUris(config) {\n  if (typeof config === 'object') {\n    for (const key of Object.keys(config)) {\n      if (typeof config[key] === 'object') {\n        deleteBaseUris(config[key])\n      } else if (key === 'uri') {\n        delete config.baseUri\n      }\n    }\n  }\n}\n\nconst JBrowse = observer(({ pluginManager }) => {\n  const [adminKey] = useQueryParam('adminKey', StringParam)\n  const [adminServer] = useQueryParam('adminServer', StringParam)\n  const [, setSessionId] = useQueryParam('session', StringParam)\n  const { rootModel } = pluginManager\n  const { error, jbrowse, session } = rootModel || {}\n  const { id: currentSessionId } = session\n\n  useEffect(() => {\n    setSessionId(`local-${currentSessionId}`)\n    // @ts-ignore\n    window.JBrowseRootModel = rootModel\n    // @ts-ignore\n    window.JBrowseSession = session\n  }, [currentSessionId, rootModel, session, setSessionId])\n\n  useEffect(() => {\n    onSnapshot(jbrowse, async snapshot => {\n      if (adminKey) {\n        const config = JSON.parse(JSON.stringify(snapshot))\n        deleteBaseUris(config)\n        const payload = { adminKey, config }\n\n        const response = await fetch(adminServer || `/updateConfig`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(payload),\n        })\n        if (!response.ok) {\n          const message = await response.text()\n          session.notify(\n            `Admin server error: ${response.status} (${response.statusText}) ${\n              message || ''\n            }`,\n          )\n        }\n      }\n    })\n  }, [jbrowse, session, adminKey, adminServer])\n\n  if (error) {\n    throw error\n  }\n\n  const theme = getConf(rootModel.jbrowse, 'theme')\n  const { AssemblyManager, SetDefaultSession } = pluginManager.getPlugin(\n    'DataManagementPlugin',\n  ).exports\n  return (\n    <ThemeProvider theme={createJBrowseTheme(theme)}>\n      <CssBaseline />\n      <App\n        session={session}\n        HeaderButtons={<ShareButton session={session} />}\n      />\n      {adminKey ? (\n        <>\n          <AssemblyManager\n            rootModel={rootModel}\n            open={rootModel.isAssemblyEditing}\n            onClose={() => {\n              rootModel.setAssemblyEditing(false)\n            }}\n          />\n          <SetDefaultSession\n            rootModel={rootModel}\n            open={rootModel.isDefaultSessionEditing}\n            onClose={() => {\n              rootModel.setDefaultSessionEditing(false)\n            }}\n            currentDefault={rootModel.jbrowse.defaultSession.name}\n          />\n        </>\n      ) : null}\n    </ThemeProvider>\n  )\n})\n\nexport default JBrowse\n","import jsonStableStringify from 'json-stable-stringify'\nimport { cast, getParent, IAnyType, types, Instance } from 'mobx-state-tree'\nimport AbortablePromiseCache from 'abortable-promise-cache'\nimport { readConfObject } from '../configuration'\nimport {\n  BaseRefNameAliasAdapter,\n  RegionsAdapter,\n} from '../data_adapters/BaseAdapter'\nimport PluginManager from '../PluginManager'\nimport { Region } from '../util/types'\nimport { Region as MSTRegion } from '../util/types/mst'\nimport { makeAbortableReaction, when } from '../util'\nimport QuickLRU from '../util/QuickLRU'\n\n// Based on the UCSC Genome Browser chromosome color palette:\n// https://github.com/ucscGenomeBrowser/kent/blob/a50ed53aff81d6fb3e34e6913ce18578292bc24e/src/hg/inc/chromColors.h\n// Some colors darkened to have at least a 3:1 contrast ratio on a white\n// background\nconst refNameColors = [\n  'rgb(153, 102, 0)',\n  'rgb(102, 102, 0)',\n  'rgb(153, 153, 30)',\n  'rgb(204, 0, 0)',\n  'rgb(255, 0, 0)',\n  'rgb(255, 0, 204)',\n  'rgb(165, 132, 132)', // originally 'rgb(255, 204, 204)'\n  'rgb(204, 122, 0)', // originally rgb(255, 153, 0)'\n  'rgb(178, 142, 0)', // originally 'rgb(255, 204, 0)'\n  'rgb(153, 153, 0)', // originally 'rgb(255, 255, 0)'\n  'rgb(122, 153, 0)', // originally 'rgb(204, 255, 0)'\n  'rgb(0, 165, 0)', // originally 'rgb(0, 255, 0)'\n  'rgb(53, 128, 0)',\n  'rgb(0, 0, 204)',\n  'rgb(96, 145, 242)', // originally 'rgb(102, 153, 255)'\n  'rgb(107, 142, 178)', // originally 'rgb(153, 204, 255)'\n  'rgb(0, 165, 165)', // originally 'rgb(0, 255, 255)'\n  'rgb(122, 153, 153)', // originally 'rgb(204, 255, 255)'\n  'rgb(153, 0, 204)',\n  'rgb(204, 51, 255)',\n  'rgb(173, 130, 216)', // originally 'rgb(204, 153, 255)'\n  'rgb(102, 102, 102)',\n  'rgb(145, 145, 145)', // originally 'rgb(153, 153, 153)'\n  'rgb(142, 142, 142)', // originally 'rgb(204, 204, 204)'\n  'rgb(142, 142, 107)', // originally 'rgb(204, 204, 153)'\n  'rgb(96, 163, 48)', // originally 'rgb(121, 204, 61)'\n]\n\nasync function loadRefNameMap(\n  assembly: Assembly,\n  adapterConf: unknown,\n  options: BaseOptions,\n  signal?: AbortSignal,\n) {\n  const { sessionId } = options\n  await when(() => Boolean(assembly.regions && assembly.refNameAliases), {\n    signal,\n    name: 'when assembly ready',\n  })\n\n  const refNames = await assembly.rpcManager.call(\n    sessionId,\n    'CoreGetRefNames',\n    {\n      adapterConfig: adapterConf,\n      signal,\n      ...options,\n    },\n    { timeout: 1000000 },\n  )\n  const refNameMap: Record<string, string> = {}\n  const { refNameAliases } = assembly\n  if (!refNameAliases) {\n    throw new Error(`error loading assembly ${assembly.name}'s refNameAliases`)\n  }\n\n  refNames.forEach((refName: string) => {\n    checkRefName(refName)\n    const canon = assembly.getCanonicalRefName(refName)\n    if (canon) {\n      refNameMap[canon] = refName\n    }\n  })\n\n  // make the reversed map too\n  const reversed: Record<string, string> = {}\n  for (const [canonicalName, adapterName] of Object.entries(refNameMap)) {\n    reversed[adapterName] = canonicalName\n  }\n\n  return {\n    forwardMap: refNameMap,\n    reverseMap: reversed,\n  }\n}\n\nfunction checkRefName(refName: string) {\n  // Valid refName pattern from https://samtools.github.io/hts-specs/SAMv1.pdf\n  if (\n    !refName.match(\n      /[0-9A-Za-z!#$%&+./:;?@^_|~-][0-9A-Za-z!#$%&*+./:;=?@^_|~-]*/,\n    )\n  ) {\n    throw new Error(`Encountered invalid refName: \"${refName}\"`)\n  }\n}\n\nfunction getAdapterId(adapterConf: unknown) {\n  return jsonStableStringify(adapterConf)\n}\n\ntype RefNameAliases = Record<string, string>\n\nexport interface BaseOptions {\n  signal?: AbortSignal\n  sessionId: string\n  statusCallback?: Function\n}\ninterface CacheData {\n  adapterConf: unknown\n  self: Assembly\n  sessionId: string\n  options: BaseOptions\n}\nexport default function assemblyFactory(\n  assemblyConfigType: IAnyType,\n  pluginManager: PluginManager,\n) {\n  const adapterLoads = new AbortablePromiseCache({\n    cache: new QuickLRU({ maxSize: 1000 }),\n    async fill(\n      args: CacheData,\n      abortSignal?: AbortSignal,\n      statusCallback?: Function,\n    ) {\n      const { adapterConf, self, options } = args\n      return loadRefNameMap(\n        self,\n        adapterConf,\n        { ...options, statusCallback },\n        abortSignal,\n      )\n    },\n  })\n\n  return types\n    .model({\n      configuration: types.safeReference(assemblyConfigType),\n      regions: types.maybe(types.array(MSTRegion)),\n      refNameAliases: types.maybe(types.map(types.string)),\n    })\n    .views(self => ({\n      get initialized() {\n        return Boolean(self.refNameAliases)\n      },\n      get name(): string {\n        return readConfObject(self.configuration, 'name')\n      },\n      get aliases(): string[] {\n        return readConfObject(self.configuration, 'aliases')\n      },\n      get refNames() {\n        return self.regions && self.regions.map(region => region.refName)\n      },\n      get allRefNames() {\n        if (!self.refNameAliases) {\n          return undefined\n        }\n        return Array.from(self.refNameAliases.keys())\n      },\n      get rpcManager() {\n        return getParent(self, 2).rpcManager\n      },\n      get refNameColors() {\n        const colors = readConfObject(\n          self.configuration,\n          'refNameColors',\n        ) as string[]\n        if (colors.length === 0) {\n          return refNameColors\n        }\n        return colors\n      },\n    }))\n    .views(self => ({\n      getCanonicalRefName(refName: string) {\n        if (!self.refNameAliases) {\n          throw new Error(\n            'aliases not loaded, we expect them to be loaded before getCanonicalRefName can be called',\n          )\n        }\n        return self.refNameAliases.get(refName)\n      },\n      getRefNameColor(refName: string) {\n        const idx = self.refNames?.findIndex(r => r === refName)\n        if (idx === undefined || idx === -1) {\n          return undefined\n        }\n        return self.refNameColors[idx % self.refNameColors.length]\n      },\n      isValidRefName(refName: string) {\n        if (!self.refNameAliases)\n          throw new Error(\n            'isValidRefName cannot be called yet, the assembly has not finished loading',\n          )\n        return !!this.getCanonicalRefName(refName)\n      },\n    }))\n    .actions(self => ({\n      setLoading() {},\n      setLoaded({\n        adapterRegionsWithAssembly,\n        refNameAliases,\n      }: {\n        adapterRegionsWithAssembly: Region[]\n        refNameAliases: RefNameAliases\n      }) {\n        this.setRegions(adapterRegionsWithAssembly)\n        this.setRefNameAliases(refNameAliases)\n      },\n      setError(error: Error) {\n        if (!getParent(self, 3).isAssemblyEditing) {\n          getParent(self, 3).setError(error)\n        }\n      },\n      setRegions(regions: Region[]) {\n        self.regions = cast(regions)\n      },\n      setRefNameAliases(refNameAliases: RefNameAliases) {\n        self.refNameAliases = cast(refNameAliases)\n      },\n      afterAttach() {\n        makeAbortableReaction(\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          self as any,\n          // @ts-ignore\n          makeLoadAssemblyData(pluginManager),\n          loadAssemblyReaction,\n          { name: `${self.name} assembly loading`, fireImmediately: true },\n          this.setLoading,\n          this.setLoaded,\n          this.setError,\n        )\n      },\n    }))\n    .views(self => ({\n      getAdapterMapEntry(adapterConf: unknown, options: BaseOptions) {\n        const { signal, statusCallback, ...rest } = options\n        if (!options.sessionId) {\n          throw new Error('sessionId is required')\n        }\n        const adapterId = getAdapterId(adapterConf)\n        return adapterLoads.get(\n          adapterId,\n          {\n            adapterConf,\n            self: self as Assembly,\n            options: rest,\n          } as CacheData,\n          signal,\n          statusCallback,\n        )\n      },\n\n      /**\n       * get Map of `canonical-name -> adapter-specific-name`\n       */\n      async getRefNameMapForAdapter(adapterConf: unknown, opts: BaseOptions) {\n        if (!opts || !opts.sessionId) {\n          throw new Error('sessionId is required')\n        }\n        const map = await this.getAdapterMapEntry(adapterConf, opts)\n        return map.forwardMap\n      },\n\n      /**\n       * get Map of `adapter-specific-name -> canonical-name`\n       */\n      async getReverseRefNameMapForAdapter(\n        adapterConf: unknown,\n        opts: BaseOptions,\n      ) {\n        const map = await this.getAdapterMapEntry(adapterConf, opts)\n        return map.reverseMap\n      },\n    }))\n}\nfunction makeLoadAssemblyData(pluginManager: PluginManager) {\n  return (self: Assembly) => {\n    if (self.configuration) {\n      const sequenceAdapterConfig = readConfObject(self.configuration, [\n        'sequence',\n        'adapter',\n      ])\n      const refNameAliasesAdapterConfig =\n        self.configuration.refNameAliases &&\n        readConfObject(self.configuration, ['refNameAliases', 'adapter'])\n      return {\n        sequenceAdapterConfig,\n        assemblyName: self.name,\n        refNameAliasesAdapterConfig,\n        pluginManager,\n      }\n    }\n    return undefined\n  }\n}\nasync function loadAssemblyReaction(\n  props: ReturnType<ReturnType<typeof makeLoadAssemblyData>> | undefined,\n  signal: AbortSignal,\n) {\n  if (!props) {\n    return\n  }\n\n  const {\n    sequenceAdapterConfig,\n    assemblyName,\n    refNameAliasesAdapterConfig,\n    pluginManager,\n  } = props\n\n  const dataAdapterType = pluginManager.getAdapterType(\n    sequenceAdapterConfig.type,\n  )\n  const adapter = new dataAdapterType.AdapterClass(\n    sequenceAdapterConfig,\n  ) as RegionsAdapter\n  const adapterRegions = (await adapter.getRegions({ signal })) as Region[]\n\n  const adapterRegionsWithAssembly = adapterRegions.map(adapterRegion => {\n    const { refName } = adapterRegion\n    checkRefName(refName)\n    return { ...adapterRegion, assemblyName }\n  })\n  const refNameAliases: RefNameAliases = {}\n  if (refNameAliasesAdapterConfig) {\n    const refAliasAdapterType = pluginManager.getAdapterType(\n      refNameAliasesAdapterConfig.type,\n    )\n    const refNameAliasAdapter = new refAliasAdapterType.AdapterClass(\n      refNameAliasesAdapterConfig,\n    ) as BaseRefNameAliasAdapter\n    const refNameAliasesList = (await refNameAliasAdapter.getRefNameAliases({\n      signal,\n    })) as {\n      refName: string\n      aliases: string[]\n    }[]\n\n    refNameAliasesList.forEach(({ refName, aliases }) => {\n      aliases.forEach(alias => {\n        checkRefName(alias)\n        refNameAliases[alias] = refName\n      })\n    })\n  }\n\n  // add identity to the refNameAliases list\n  adapterRegionsWithAssembly.forEach(region => {\n    refNameAliases[region.refName] = region.refName\n  })\n  // eslint-disable-next-line consistent-return\n  return { adapterRegionsWithAssembly, refNameAliases }\n}\nexport type Assembly = Instance<ReturnType<typeof assemblyFactory>>\n","import { reaction } from 'mobx'\nimport {\n  addDisposer,\n  cast,\n  getParent,\n  IAnyType,\n  SnapshotOrInstance,\n  types,\n  Instance,\n} from 'mobx-state-tree'\nimport { when } from '../util'\nimport { readConfObject } from '../configuration'\nimport { AnyConfigurationModel } from '../configuration/configurationSchema'\n\nimport assemblyFactory from './assembly'\nimport PluginManager from '../PluginManager'\n\nexport default function assemblyManagerFactory(\n  assemblyConfigType: IAnyType,\n  pluginManager: PluginManager,\n) {\n  const Assembly = assemblyFactory(assemblyConfigType, pluginManager)\n  return types\n    .model({\n      assemblies: types.array(Assembly),\n    })\n    .views(self => ({\n      get(assemblyName: string) {\n        const canonicalName = this.aliasMap.get(assemblyName)\n        return self.assemblies.find(\n          assembly => assembly.name === (canonicalName || assemblyName),\n        )\n      },\n\n      get assemblyList() {\n        return getParent(self).jbrowse.assemblies.slice()\n      },\n\n      get aliasMap() {\n        const aliases: Map<string, string> = new Map()\n        self.assemblies.forEach(assembly => {\n          if (assembly.aliases.length) {\n            assembly.aliases.forEach(assemblyAlias => {\n              aliases.set(assemblyAlias, assembly.name)\n            })\n          }\n        })\n        return aliases\n      },\n      get rpcManager() {\n        return getParent(self).rpcManager\n      },\n      get pluginManager() {\n        return getParent(self).pluginManager\n      },\n      get allPossibleRefNames() {\n        let refNames: string[] = []\n        for (const assembly of self.assemblies) {\n          if (!assembly.allRefNames) {\n            return undefined\n          }\n          refNames = refNames.concat(assembly.allRefNames)\n        }\n        return refNames\n      },\n    }))\n    .views(self => ({\n      // use this method instead of assemblyManager.get(assemblyName)\n      // get an assembly with regions loaded\n      async waitForAssembly(assemblyName: string) {\n        if (!assemblyName) {\n          throw new Error('no assembly name supplied to waitForAssembly')\n        }\n        const canonicalName = self.aliasMap.get(assemblyName)\n        const assembly = self.assemblies.find(\n          asm => asm.name === (canonicalName || assemblyName),\n        )\n        if (assembly) {\n          await when(() => Boolean(assembly.regions && assembly.refNameAliases))\n          return assembly\n        }\n        return undefined\n      },\n\n      async getRefNameMapForAdapter(\n        adapterConf: unknown,\n        assemblyName: string,\n        opts: { signal?: AbortSignal; sessionId: string },\n      ) {\n        await when(() => Boolean(self.get(assemblyName)), {\n          signal: opts.signal,\n          name: 'when assembly ready',\n        })\n\n        const assembly = self.get(assemblyName)\n        if (assembly) {\n          return assembly.getRefNameMapForAdapter(adapterConf, opts)\n        }\n        return undefined\n      },\n      async getReverseRefNameMapForAdapter(\n        adapterConf: unknown,\n        assemblyName: string,\n        opts: { signal?: AbortSignal; sessionId: string },\n      ) {\n        await when(() => Boolean(self.get(assemblyName)), {\n          signal: opts.signal,\n          name: 'when assembly ready',\n        })\n        const assembly = self.get(assemblyName)\n        if (assembly) {\n          return assembly.getReverseRefNameMapForAdapter(adapterConf, opts)\n        }\n        return undefined\n      },\n      isValidRefName(refName: string, assemblyName?: string) {\n        if (assemblyName) {\n          const assembly = self.get(assemblyName)\n          if (assembly) {\n            return assembly.isValidRefName(refName)\n          }\n          throw new Error(\n            `isValidRefName for ${assemblyName} failed, assembly does not exist`,\n          )\n        }\n        if (!self.allPossibleRefNames) {\n          throw new Error(\n            `isValidRefName not available, assemblyManager has not yet finished loading. If you are looking for a refname in a specific assembly, pass assembly argument`,\n          )\n        }\n        return self.allPossibleRefNames.includes(refName)\n      },\n    }))\n    .actions(self => ({\n      removeAssembly(asm: Instance<typeof Assembly>) {\n        self.assemblies.remove(asm)\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          reaction(\n            // have to slice it to be properly reacted to\n            () => self.assemblyList,\n            (\n              assemblyConfigs: Instance<typeof Assembly> &\n                AnyConfigurationModel[],\n            ) => {\n              self.assemblies.forEach(asm => {\n                if (!asm.configuration) {\n                  this.removeAssembly(asm)\n                }\n              })\n              assemblyConfigs.forEach(assemblyConfig => {\n                const existingAssemblyIdx = self.assemblies.findIndex(\n                  assembly =>\n                    assembly.name === readConfObject(assemblyConfig, 'name'),\n                )\n                if (existingAssemblyIdx === -1) {\n                  this.addAssembly(assemblyConfig)\n                }\n              })\n            },\n            { fireImmediately: true, name: 'assemblyManagerAfterAttach' },\n          ),\n        )\n      },\n      addAssembly(\n        assemblyConfig: SnapshotOrInstance<typeof assemblyConfigType> | string,\n      ) {\n        self.assemblies.push({ configuration: assemblyConfig })\n      },\n      replaceAssembly(\n        idx: number,\n        assemblyConfig: SnapshotOrInstance<typeof assemblyConfigType> | string,\n      ) {\n        self.assemblies[idx] = cast({\n          configuration: assemblyConfig,\n        })\n      },\n    }))\n}\n","import { SnapshotIn } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '../configuration'\nimport PluginManager from '../PluginManager'\n\nexport default (pluginManager: PluginManager) => {\n  const BaseAssemblyConfigSchema = ConfigurationSchema(\n    'BaseAssembly',\n    {\n      aliases: {\n        type: 'stringArray',\n        defaultValue: [],\n        description: 'Other possible names for the assembly',\n      },\n      sequence: pluginManager.getTrackType('ReferenceSequenceTrack')\n        .configSchema,\n      refNameColors: {\n        type: 'stringArray',\n        defaultValue: [],\n        description:\n          'Define custom colors for each reference sequence. Will cycle through this list if there are not enough colors for every sequence.',\n      },\n    },\n    { explicitIdentifier: 'name' },\n  )\n\n  const AssemblyConfigSchema = ConfigurationSchema(\n    'Assembly',\n    {\n      refNameAliases: ConfigurationSchema('RefNameAliases', {\n        adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      }),\n    },\n    { baseConfiguration: BaseAssemblyConfigSchema },\n  )\n\n  function dispatcher(\n    snapshot:\n      | SnapshotIn<typeof BaseAssemblyConfigSchema>\n      | SnapshotIn<typeof AssemblyConfigSchema>,\n  ) {\n    if (!snapshot) return BaseAssemblyConfigSchema\n    const { refNameAliases } = snapshot\n    if (refNameAliases) return AssemblyConfigSchema\n    return BaseAssemblyConfigSchema\n  }\n\n  return {\n    assemblyConfigSchemas: [AssemblyConfigSchema, BaseAssemblyConfigSchema],\n    dispatcher,\n  }\n}\n","import { ConfigurationSchema } from '../configuration'\n\nexport default ConfigurationSchema('RpcOptions', {\n  defaultDriver: {\n    type: 'string',\n    description:\n      'the RPC backend to use for tracks and tasks that are not configured to use a specific RPC backend',\n    defaultValue: 'WebWorkerRpcDriver',\n  },\n})\n","import { isAlive, isStateTreeNode } from 'mobx-state-tree'\nimport { objectFromEntries } from '../util'\nimport { serializeAbortSignal } from './remoteAbortSignals'\nimport PluginManager from '../PluginManager'\n\ninterface WorkerHandle {\n  status?: string\n  on?: (channel: string, callback: (message: string) => void) => void\n  off?: (channel: string, callback: (message: string) => void) => void\n  destroy(): void\n  call(functionName: string, args?: unknown, options?: {}): Promise<unknown>\n}\n\nfunction isClonable(thing: unknown): boolean {\n  if (typeof thing === 'function') {\n    return false\n  }\n  if (thing instanceof Error) {\n    return false\n  }\n  return true\n}\n\n// watches the given worker object, returns a promise that will be rejected if\n// the worker times out\nexport async function watchWorker(worker: WorkerHandle, pingTime: number) {\n  // first ping call has no timeout, wait for worker download\n  await worker.call('ping', [], { timeout: 100000000 })\n\n  // after first ping succeeds, apply wait for timeout\n  return new Promise((_resolve, reject) => {\n    function delay() {\n      setTimeout(async () => {\n        try {\n          await worker.call('ping', [], { timeout: pingTime * 2 })\n          delay()\n        } catch (e) {\n          reject(e)\n        }\n      }, pingTime)\n    }\n    delay()\n  })\n}\n\nfunction detectHardwareConcurrency() {\n  const mainThread = typeof window !== 'undefined'\n  const canDetect = 'hardwareConcurrency' in window.navigator\n  if (mainThread && canDetect) {\n    return window.navigator.hardwareConcurrency\n  }\n  return 1\n}\nclass LazyWorker {\n  worker?: WorkerHandle\n\n  driver: BaseRpcDriver\n\n  constructor(driver: BaseRpcDriver) {\n    this.driver = driver\n  }\n\n  getWorker(pluginManager: PluginManager) {\n    if (!this.worker) {\n      const worker = this.driver.makeWorker(pluginManager)\n      watchWorker(worker, this.driver.maxPingTime).catch(() => {\n        if (this.worker) {\n          console.warn('worker did not respond, killing and generating new one')\n          this.worker.destroy()\n          this.worker.status = 'killed'\n          this.worker = undefined\n        }\n      })\n      this.worker = worker\n    }\n    return this.worker\n  }\n}\n\nexport default abstract class BaseRpcDriver {\n  private lastWorkerAssignment = -1\n\n  private workerAssignments = new Map<string, number>() // sessionId -> worker number\n\n  private workerCount = 0\n\n  abstract makeWorker(pluginManager: PluginManager): WorkerHandle\n\n  private workerPool?: LazyWorker[]\n\n  maxPingTime = 30000\n\n  workerCheckFrequency = 5000\n\n  // filter the given object and just remove any non-clonable things from it\n  filterArgs<THING_TYPE>(\n    thing: THING_TYPE,\n    pluginManager: PluginManager,\n    sessionId: string,\n  ): THING_TYPE {\n    if (Array.isArray(thing)) {\n      return (thing\n        .filter(isClonable)\n        .map(t =>\n          this.filterArgs(t, pluginManager, sessionId),\n        ) as unknown) as THING_TYPE\n    }\n    if (typeof thing === 'object' && thing !== null) {\n      // AbortSignals are specially handled\n      if (thing instanceof AbortSignal) {\n        return (serializeAbortSignal(\n          thing,\n          this.remoteAbort.bind(this, pluginManager, sessionId),\n        ) as unknown) as THING_TYPE\n      }\n\n      if (isStateTreeNode(thing) && !isAlive(thing)) {\n        throw new Error('dead state tree node passed to RPC call')\n      }\n\n      return objectFromEntries(\n        Object.entries(thing)\n          .filter(e => isClonable(e[1]))\n          .map(([k, v]) => [k, this.filterArgs(v, pluginManager, sessionId)]),\n      ) as THING_TYPE\n    }\n    return thing\n  }\n\n  remoteAbort(\n    pluginManager: PluginManager,\n    sessionId: string,\n    functionName: string,\n    signalId: number,\n  ) {\n    const worker = this.getWorker(sessionId, pluginManager)\n    worker.call(functionName, signalId, { timeout: 1000000 })\n  }\n\n  createWorkerPool(): LazyWorker[] {\n    const hardwareConcurrency = detectHardwareConcurrency()\n\n    const workerCount =\n      this.workerCount || Math.max(1, Math.ceil((hardwareConcurrency - 2) / 3))\n\n    return [...new Array(workerCount)].map(() => new LazyWorker(this))\n  }\n\n  getWorkerPool() {\n    if (!this.workerPool) {\n      const res = this.createWorkerPool()\n      this.workerPool = res\n      return res // making this several steps makes TS happy\n    }\n    return this.workerPool\n  }\n\n  getWorker(sessionId: string, pluginManager: PluginManager): WorkerHandle {\n    const workers = this.getWorkerPool()\n    let workerNumber = this.workerAssignments.get(sessionId)\n    if (workerNumber === undefined) {\n      const workerAssignment = (this.lastWorkerAssignment + 1) % workers.length\n      this.workerAssignments.set(sessionId, workerAssignment)\n      this.lastWorkerAssignment = workerAssignment\n      workerNumber = workerAssignment\n    }\n\n    // console.log(`${sessionId} -> worker ${workerNumber}`)\n    const worker = workers[workerNumber].getWorker(pluginManager)\n    if (!worker) {\n      throw new Error('no web workers registered for RPC')\n    }\n    return worker\n  }\n\n  async call(\n    pluginManager: PluginManager,\n    sessionId: string,\n    functionName: string,\n    args: { statusCallback?: Function },\n    options = {},\n  ) {\n    if (!sessionId) {\n      throw new TypeError('sessionId is required')\n    }\n    const worker = this.getWorker(sessionId, pluginManager)\n    const rpcMethod = pluginManager.getRpcMethodType(functionName)\n    const serializedArgs = await rpcMethod.serializeArguments(args)\n    const filteredAndSerializedArgs = this.filterArgs(\n      serializedArgs,\n      pluginManager,\n      sessionId,\n    )\n\n    // now actually call the worker\n    const callP = worker.call(functionName, filteredAndSerializedArgs, {\n      timeout: 5 * 60 * 1000, // 5 minutes\n      statusCallback: args.statusCallback,\n      ...options,\n    })\n\n    // check every 5 seconds to see if the worker has been killed, and\n    // reject the killedP promise if it has\n    let killedCheckInterval: ReturnType<typeof setInterval>\n    const killedP = new Promise((_resolve, reject) => {\n      killedCheckInterval = setInterval(() => {\n        // must've been killed\n        if (worker.status === 'killed') {\n          reject(\n            new Error('operation timed out, worker process stopped responding'),\n          )\n        }\n      }, this.workerCheckFrequency)\n    }).finally(() => {\n      clearInterval(killedCheckInterval)\n    })\n\n    // the result is a race between the actual result promise, and the \"killed\"\n    // promise. the killed promise will only actually win if the worker was\n    // killed before the call could return\n    const resultP = Promise.race([callP, killedP])\n\n    return rpcMethod.deserializeReturn(await resultP)\n  }\n}\n","import Rpc from '@librpc/web'\nimport shortid from 'shortid'\nimport BaseRpcDriver from './BaseRpcDriver'\nimport { PluginDefinition } from '../PluginLoader'\n\ninterface WebpackWorker {\n  new (): Worker\n  prototype: Worker\n}\n\nclass WebWorkerHandle extends Rpc.Client {\n  destroy(): void {\n    this.workers[0].terminate()\n  }\n\n  async call(\n    functionName: string,\n    args: Record<string, unknown>,\n    opts: { statusCallback?: (arg0: string) => void },\n  ) {\n    const channel = `message-${shortid.generate()}`\n    const listener = (message: string) => {\n      if (opts.statusCallback) {\n        opts.statusCallback(message)\n      }\n    }\n    // @ts-ignore\n    this.on(channel, listener)\n    const result = await super.call(functionName, { ...args, channel }, opts)\n    // @ts-ignore\n    this.off(channel, listener)\n    return result\n  }\n}\n\nexport default class WebWorkerRpcDriver extends BaseRpcDriver {\n  WorkerClass: WebpackWorker\n\n  workerBootConfiguration: { plugins: PluginDefinition[] }\n\n  constructor(\n    { WorkerClass }: { WorkerClass: WebpackWorker },\n    workerBootConfiguration: { plugins: PluginDefinition[] },\n  ) {\n    super()\n    this.WorkerClass = WorkerClass\n    this.workerBootConfiguration = workerBootConfiguration\n  }\n\n  makeWorker() {\n    // note that we are making a Rpc.Client connection with a worker pool of one for each worker,\n    // because we want to do our own state-group-aware load balancing rather than using librpc's\n    // builtin round-robin\n    const worker = new WebWorkerHandle({ workers: [new this.WorkerClass()] })\n    // send the worker its boot configuration using info from the pluginManager\n    worker.workers[0].postMessage(this.workerBootConfiguration)\n    return worker\n  }\n}\n","import { getSnapshot, isStateTreeNode } from 'mobx-state-tree'\nimport { iterMap, objectFromEntries } from '../util'\nimport BaseRpcDriver from './BaseRpcDriver'\nimport PluginManager from '../PluginManager'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function isPlainObject(thing: any): boolean {\n  // prototype is object, contains no functions\n  if (typeof thing !== 'object') return false\n  if (Object.getPrototypeOf(Object.getPrototypeOf(thing)) !== null) return false\n  return true\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function cloneArgs(args: any): any {\n  if (Array.isArray(args)) {\n    return args.map(cloneArgs)\n  }\n\n  if (typeof args === 'object') {\n    if (isStateTreeNode(args)) {\n      return getSnapshot(args)\n    }\n    if (args instanceof Map) {\n      return new Map(\n        iterMap(args.entries(), ([k, v]) => [k, cloneArgs(v)], args.size),\n      )\n    }\n    if (args instanceof Set) {\n      return new Set(\n        iterMap(args.entries(), ([, v]) => cloneArgs(v), args.size),\n      )\n    }\n    if (args instanceof AbortSignal) {\n      // pass AbortSignals unmodified\n      return args\n    }\n    if (typeof args.toJSON === 'function') {\n      return args.toJSON()\n    }\n    if (isPlainObject(args)) {\n      return objectFromEntries(\n        Object.entries(args).map(([k, v]) => [k, cloneArgs(v)]),\n      )\n    }\n\n    throw new TypeError(`cannot clone args, unsupported object type ${args}`)\n  }\n\n  if (typeof args === 'function') {\n    return undefined\n  }\n\n  return args\n}\n\nclass DummyHandle {\n  destroy(): void {}\n\n  async call(\n    _functionName: string,\n    _filteredArgs?: {},\n    _options = {},\n  ): Promise<unknown> {\n    return undefined\n  }\n}\n\n/**\n * Stub RPC driver class that runs RPC functions in-band in the main thread.\n *\n * @param rpcFuncs - object containing runnable rpc functions\n */\nexport default class MainThreadRpcDriver extends BaseRpcDriver {\n  makeWorker: () => DummyHandle\n\n  constructor(_args: {}) {\n    super()\n    this.makeWorker = (): DummyHandle => new DummyHandle()\n  }\n\n  async call(\n    pluginManager: PluginManager,\n    sessionId: string,\n    functionName: string,\n    args: {},\n  ): Promise<unknown> {\n    if (!sessionId) {\n      throw new TypeError('sessionId is required')\n    }\n    const rpcMethod = pluginManager.getRpcMethodType(functionName)\n    const serializedArgs = await rpcMethod.serializeArguments(args)\n    const filteredAndSerializedArgs = this.filterArgs(\n      serializedArgs,\n      pluginManager,\n      sessionId,\n    )\n    const result = await rpcMethod.execute(filteredAndSerializedArgs)\n    return rpcMethod.deserializeReturn(result)\n  }\n}\n","/* eslint-disable no-await-in-loop */\nimport shortid from 'shortid'\nimport BaseRpcDriver from './BaseRpcDriver'\nimport PluginManager from '../PluginManager'\nimport { PluginDefinition } from '../PluginLoader'\n\ndeclare global {\n  interface Window {\n    electronBetterIpc: {\n      ipcRenderer?: import('electron-better-ipc-extra').RendererProcessIpc\n    }\n    electron?: import('electron').AllElectron\n  }\n}\nconst { electronBetterIpc = {}, electron } = window\n\nasync function wait(ms: number) {\n  return new Promise(resolve => {\n    setTimeout(resolve, ms)\n  })\n}\n\ntype BackendConfig = { workerCreationChannel: string }\ntype WorkerBootConfig = { plugins: PluginDefinition[] }\n\nclass WindowWorkerHandle {\n  private ipcRenderer: import('electron-better-ipc-extra').RendererProcessIpc\n\n  private window: import('electron').BrowserWindow\n\n  private config: WorkerBootConfig\n\n  private ready = false\n\n  constructor(\n    ipcRenderer: import('electron-better-ipc-extra').RendererProcessIpc,\n    window: import('electron').BrowserWindow,\n    config: WorkerBootConfig,\n  ) {\n    this.ipcRenderer = ipcRenderer\n    this.window = window\n    this.config = config\n  }\n\n  destroy(): void {\n    this.window.destroy()\n  }\n\n  // waits for a new worker to start, and then sends it its bootstrap configuration\n  async setup() {\n    if (!this.ready) {\n      let readyForConfig = false\n      while (!readyForConfig) {\n        await wait(1000)\n        readyForConfig = !!(await this.ipcRenderer.callRenderer(\n          this.window,\n          'ready_for_configuration',\n        ))\n      }\n\n      const result = await this.ipcRenderer.callRenderer(\n        this.window,\n        'configure',\n        this.config,\n      )\n      if (!result) {\n        throw new Error('failed to configure worker')\n      }\n      this.ready = true\n    }\n  }\n\n  async call(\n    functionName: string,\n    filteredArgs?: Record<string, unknown>,\n    opts: { statusCallback?: (arg0: string) => void } = {},\n  ): Promise<unknown> {\n    await this.setup()\n\n    const { statusCallback, ...rest } = opts\n    const channel = `message-${shortid.generate()}`\n    const listener = (_event: unknown, message: string) => {\n      if (opts.statusCallback) {\n        opts.statusCallback(message)\n      }\n    }\n    this.ipcRenderer.on(channel, listener)\n    const result = await this.ipcRenderer.callRenderer(\n      this.window,\n      'call',\n      functionName,\n      { ...filteredArgs, channel },\n      rest,\n    )\n    this.ipcRenderer.removeListener(channel, listener)\n    return result\n  }\n}\n\nexport default class ElectronRpcDriver extends BaseRpcDriver {\n  config: WorkerBootConfig\n\n  channel: string\n\n  constructor(\n    { workerCreationChannel }: BackendConfig,\n    config: WorkerBootConfig,\n  ) {\n    super()\n\n    this.config = config\n    this.channel = workerCreationChannel\n  }\n\n  makeWorker(): WindowWorkerHandle {\n    const { ipcRenderer } = electronBetterIpc\n    if (!ipcRenderer) {\n      throw new Error(\n        'Cannot use ElectronRpcDriver without ipcRenderer from electron-better-ipc-extra',\n      )\n    }\n    if (!electron) {\n      throw new Error(\n        'Cannot use ElectronRpcDriver without electron available globally',\n      )\n    }\n    const electronRemote = electron.remote\n    const workerId = ipcRenderer.sendSync(this.channel)\n    const window = electronRemote.BrowserWindow.fromId(workerId)\n    const worker = new WindowWorkerHandle(ipcRenderer, window, this.config)\n    return worker\n  }\n\n  async call(\n    pluginManager: PluginManager,\n    sessionId: string,\n    functionName: string,\n    args: {},\n    options = {},\n  ): Promise<unknown> {\n    const r = await super.call(\n      pluginManager,\n      sessionId,\n      functionName,\n      args,\n      options,\n    )\n\n    if (typeof r === 'object' && r !== null && 'imageData' in r) {\n      const img = new Image()\n      // @ts-ignore\n      img.src = r.imageData.dataURL\n      // @ts-ignore\n      r.imageData = img\n    }\n    return r\n  }\n}\n","import PluginManager from '../PluginManager'\nimport { readConfObject } from '../configuration'\n\nimport rpcConfigSchema from './configSchema'\nimport WebWorkerRpcDriver from './WebWorkerRpcDriver'\nimport MainThreadRpcDriver from './MainThreadRpcDriver'\nimport ElectronRpcDriver from './ElectronRpcDriver'\nimport { AnyConfigurationModel } from '../configuration/configurationSchema'\nimport { PluginDefinition } from '../PluginLoader'\n\ntype DriverClass = WebWorkerRpcDriver | MainThreadRpcDriver | ElectronRpcDriver\ntype BackendConfigurations = {\n  WebWorkerRpcDriver?: ConstructorParameters<typeof WebWorkerRpcDriver>[0]\n  MainThreadRpcDriver?: ConstructorParameters<typeof MainThreadRpcDriver>[0]\n  ElectronRpcDriver?: ConstructorParameters<typeof ElectronRpcDriver>[0]\n}\nconst DriverClasses = {\n  WebWorkerRpcDriver,\n  MainThreadRpcDriver,\n  ElectronRpcDriver,\n}\n\nexport default class RpcManager {\n  static configSchema = rpcConfigSchema\n\n  driverObjects: Map<string, DriverClass>\n\n  pluginManager: PluginManager\n\n  mainConfiguration: AnyConfigurationModel\n\n  backendConfigurations: BackendConfigurations\n\n  runtimePluginDefinitions: PluginDefinition[]\n\n  constructor(\n    pluginManager: PluginManager,\n    runtimePluginDefinitions: PluginDefinition[] = [],\n    mainConfiguration: AnyConfigurationModel,\n    backendConfigurations: BackendConfigurations,\n  ) {\n    if (!mainConfiguration) {\n      throw new Error('RpcManager requires at least a main configuration')\n    }\n    this.pluginManager = pluginManager\n    this.runtimePluginDefinitions = runtimePluginDefinitions\n    this.mainConfiguration = mainConfiguration\n    this.backendConfigurations = backendConfigurations\n    this.driverObjects = new Map()\n  }\n\n  getDriver(backendName: keyof typeof DriverClasses): DriverClass {\n    const driver = this.driverObjects.get(backendName)\n    if (driver) return driver\n\n    const backendConfiguration = this.backendConfigurations[backendName]\n    const DriverClassImpl = DriverClasses[backendName]\n\n    if (!DriverClassImpl) {\n      throw new Error(`requested RPC driver \"${backendName}\" is not installed`)\n    } else if (!backendConfiguration) {\n      throw new Error(`requested RPC driver \"${backendName}\" is missing config`)\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const newDriver = new DriverClassImpl(backendConfiguration as any, {\n      plugins: this.runtimePluginDefinitions,\n    })\n    this.driverObjects.set(backendName, newDriver)\n    return newDriver\n  }\n\n  getDriverForCall(_sessionId: string, _functionName: string, _args: unknown) {\n    // TODO: add logic here so different sessions can have\n    // different RPC backends configured\n\n    // otherwise, if there is no specific backend for that session, use the default one\n    const backendName = readConfObject(this.mainConfiguration, 'defaultDriver')\n\n    return this.getDriver(backendName)\n  }\n\n  async call(sessionId: string, functionName: string, args: {}, opts = {}) {\n    // console.log(sessionId, functionName)\n    if (!sessionId) {\n      throw new Error('sessionId is required')\n    }\n    return this.getDriverForCall(sessionId, functionName, args).call(\n      this.pluginManager,\n      sessionId,\n      functionName,\n      args,\n      opts,\n    )\n  }\n}\n","import {\n  ConfigurationSchema,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\nimport {\n  getParent,\n  getSnapshot,\n  resolveIdentifier,\n  types,\n} from 'mobx-state-tree'\nimport { toJS } from 'mobx'\n\n// poke some things for testing (this stuff will eventually be removed)\nwindow.getSnapshot = getSnapshot\nwindow.resolveIdentifier = resolveIdentifier\n\nexport default function JBrowseWeb(\n  pluginManager,\n  Session,\n  assemblyConfigSchemasType,\n) {\n  const JBrowseModel = types\n    .model('JBrowseWeb', {\n      configuration: ConfigurationSchema('Root', {\n        rpc: RpcManager.configSchema,\n        // possibly consider this for global config editor\n        highResolutionScaling: {\n          type: 'number',\n          defaultValue: 2,\n        },\n        shareURL: {\n          type: 'string',\n          defaultValue:\n            'https://g5um1mrb0i.execute-api.us-east-1.amazonaws.com/api/v1/',\n        },\n        disableAnalytics: {\n          type: 'boolean',\n          defaultValue: false,\n        },\n        theme: { type: 'frozen', defaultValue: {} },\n      }),\n      plugins: types.frozen(),\n      assemblies: types.array(assemblyConfigSchemasType),\n      // track configuration is an array of track config schemas. multiple\n      // instances of a track can exist that use the same configuration\n      tracks: types.array(pluginManager.pluggableConfigSchemaType('track')),\n      connections: types.array(\n        pluginManager.pluggableConfigSchemaType('connection'),\n      ),\n      defaultSession: types.optional(types.frozen(Session), {\n        name: `New session`,\n      }),\n    })\n    .actions(self => ({\n      afterCreate() {\n        const seen = []\n        self.assemblyNames.forEach(assemblyName => {\n          if (!assemblyName) {\n            throw new Error('Encountered an assembly with no \"name\" defined')\n          }\n          if (seen.includes(assemblyName)) {\n            throw new Error(\n              `Found two assemblies with the same name: ${assemblyName}`,\n            )\n          } else {\n            seen.push(assemblyName)\n          }\n        })\n      },\n      addAssemblyConf(assemblyConf) {\n        const { name } = assemblyConf\n        if (!name) {\n          throw new Error('Can\\'t add assembly with no \"name\"')\n        }\n        const assembly = self.assemblies.find(asm => asm.name === name)\n        if (assembly) {\n          return assembly\n        }\n        const length = self.assemblies.push({\n          ...assemblyConf,\n          sequence: {\n            type: 'ReferenceSequenceTrack',\n            trackId: `${name}-${Date.now()}`,\n            ...(assemblyConf.sequence || {}),\n          },\n        })\n        return self.assemblies[length - 1]\n      },\n      removeAssemblyConf(assemblyName) {\n        const toRemove = self.assemblies.find(\n          assembly => assembly.name === assemblyName,\n        )\n        if (toRemove) {\n          self.assemblies.remove(toRemove)\n        }\n      },\n      addTrackConf(trackConf) {\n        const { type } = trackConf\n        if (!type) throw new Error(`unknown track type ${type}`)\n        const track = self.tracks.find(t => t.trackId === trackConf.trackId)\n        if (track) {\n          return track\n        }\n        const length = self.tracks.push(trackConf)\n        return self.tracks[length - 1]\n      },\n      addDisplayConf(trackId, displayConf) {\n        const { type } = displayConf\n        if (!type) {\n          throw new Error(`unknown display type ${type}`)\n        }\n        const track = self.tracks.find(t => t.trackId === trackId)\n        if (!track) {\n          throw new Error(`could not find track with id ${trackId}`)\n        }\n        return track.addDisplayConf(displayConf)\n      },\n      addConnectionConf(connectionConf) {\n        const { type } = connectionConf\n        if (!type) throw new Error(`unknown connection type ${type}`)\n        const length = self.connections.push(connectionConf)\n        return self.connections[length - 1]\n      },\n\n      deleteConnectionConf(configuration) {\n        const idx = self.connections.findIndex(\n          conn => conn.id === configuration.id,\n        )\n        if (idx === -1) {\n          return undefined\n        }\n        return self.connections.splice(idx, 1)\n      },\n\n      deleteTrackConf(trackConf) {\n        const { trackId } = trackConf\n        const idx = self.tracks.findIndex(t => t.trackId === trackId)\n        if (idx === -1) {\n          return undefined\n        }\n\n        return self.tracks.splice(idx, 1)\n      },\n      setDefaultSessionConf(sessionConf) {\n        let newDefault\n        if (getParent(self).session.name === sessionConf.name) {\n          newDefault = getSnapshot(sessionConf)\n        } else {\n          newDefault = toJS(sessionConf)\n        }\n        const { name } = newDefault\n        if (!name) {\n          throw new Error(`unable to set default session to ${name}`)\n        }\n        self.defaultSession = newDefault\n      },\n    }))\n    .views(self => ({\n      get assemblyNames() {\n        return self.assemblies.map(assembly => readConfObject(assembly, 'name'))\n      },\n      get rpcManager() {\n        return getParent(self).rpcManager\n      },\n    }))\n\n  return types.snapshotProcessor(JBrowseModel, {\n    postProcessor(snapshot) {\n      function removeAttr(obj, attr) {\n        for (const prop in obj) {\n          if (prop === attr) delete obj[prop]\n          else if (typeof obj[prop] === 'object') removeAttr(obj[prop])\n        }\n      }\n      removeAttr(snapshot, 'baseUri')\n      return snapshot\n    },\n  })\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport {\n  readConfObject,\n  getConf,\n  isConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport {\n  Region,\n  NotificationLevel,\n  AbstractSessionModel,\n  TrackViewModel,\n} from '@jbrowse/core/util/types'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { observable } from 'mobx'\nimport {\n  getMembers,\n  getParent,\n  getSnapshot,\n  getType,\n  IAnyStateTreeNode,\n  isAlive,\n  isModelType,\n  isReferenceType,\n  SnapshotIn,\n  types,\n  walk,\n  Instance,\n} from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\nimport SettingsIcon from '@material-ui/icons/Settings'\nimport CopyIcon from '@material-ui/icons/FileCopy'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport shortid from 'shortid'\n\ndeclare interface ReferringNode {\n  node: IAnyStateTreeNode\n  key: string\n}\n\nexport default function sessionModelFactory(pluginManager: PluginManager) {\n  const minDrawerWidth = 128\n  return types\n    .model('JBrowseWebSessionModel', {\n      id: types.optional(types.identifier, shortid()),\n      name: types.string,\n      margin: 0,\n      drawerWidth: types.optional(\n        types.refinement(types.integer, width => width >= minDrawerWidth),\n        384,\n      ),\n      views: types.array(pluginManager.pluggableMstType('view', 'stateModel')),\n      widgets: types.map(\n        pluginManager.pluggableMstType('widget', 'stateModel'),\n      ),\n      activeWidgets: types.map(\n        types.safeReference(\n          pluginManager.pluggableMstType('widget', 'stateModel'),\n        ),\n      ),\n      connectionInstances: types.map(\n        types.array(pluginManager.pluggableMstType('connection', 'stateModel')),\n      ),\n      sessionTracks: types.array(\n        pluginManager.pluggableConfigSchemaType('track'),\n      ),\n      sessionConnections: types.array(\n        pluginManager.pluggableConfigSchemaType('connection'),\n      ),\n    })\n    .volatile((/* self */) => ({\n      pluginManager,\n      /**\n       * this is the globally \"selected\" object. can be anything.\n       * code that wants to deal with this should examine it to see what\n       * kind of thing it is.\n       */\n      selection: undefined,\n      /**\n       * this is the current \"task\" that is being performed in the UI.\n       * this is usually an object of the form\n       * `{ taskName: \"configure\", target: thing_being_configured }`\n       */\n      task: undefined,\n    }))\n    .views(self => ({\n      get shareURL() {\n        return getConf(getParent(self).jbrowse, 'shareURL')\n      },\n      get rpcManager() {\n        return getParent(self).jbrowse.rpcManager as RpcManager\n      },\n      get configuration() {\n        return getParent(self).jbrowse.configuration\n      },\n      get assemblies() {\n        return getParent(self).jbrowse.assemblies\n      },\n      get assemblyNames() {\n        return getParent(self).jbrowse.assemblyNames\n      },\n      get tracks() {\n        return [...self.sessionTracks, ...getParent(self).jbrowse.tracks]\n      },\n      get connections() {\n        return [\n          ...self.sessionConnections,\n          ...getParent(self).jbrowse.connections,\n        ]\n      },\n      get adminMode() {\n        return getParent(self).adminMode\n      },\n      get savedSessions() {\n        return getParent(self).savedSessions\n      },\n      get previousAutosaveId() {\n        return getParent(self).previousAutosaveId\n      },\n      get savedSessionNames() {\n        return getParent(self).savedSessionNames\n      },\n      get history() {\n        return getParent(self).history\n      },\n      get menus() {\n        return getParent(self).menus\n      },\n      get assemblyManager() {\n        return getParent(self).assemblyManager\n      },\n      get version() {\n        return getParent(self).version\n      },\n      get renderProps() {\n        return { theme: readConfObject(this.configuration, 'theme') }\n      },\n      get visibleWidget() {\n        if (isAlive(self))\n          // returns most recently added item in active widgets\n          return Array.from(self.activeWidgets.values())[\n            self.activeWidgets.size - 1\n          ]\n        return undefined\n      },\n      /**\n       * See if any MST nodes currently have a types.reference to this object.\n       * @param object - object\n       * @returns An array where the first element is the node referring\n       * to the object and the second element is they property name the node is\n       * using to refer to the object\n       */\n      getReferring(object: IAnyStateTreeNode) {\n        const refs: ReferringNode[] = []\n        walk(getParent(self), node => {\n          if (isModelType(getType(node))) {\n            const members = getMembers(node)\n            Object.entries(members.properties).forEach(([key, value]) => {\n              // @ts-ignore\n              if (isReferenceType(value) && node[key] === object) {\n                refs.push({ node, key })\n              }\n            })\n          }\n        })\n        return refs\n      },\n    }))\n    .actions(self => ({\n      setName(str: string) {\n        self.name = str\n      },\n\n      makeConnection(\n        configuration: AnyConfigurationModel,\n        initialSnapshot = {},\n      ) {\n        const { type } = configuration\n        if (!type) throw new Error('track configuration has no `type` listed')\n        const name = readConfObject(configuration, 'name')\n        const connectionType = pluginManager.getConnectionType(type)\n        if (!connectionType) throw new Error(`unknown connection type ${type}`)\n        const assemblyName = readConfObject(configuration, 'assemblyName')\n        const connectionData = {\n          ...initialSnapshot,\n          name,\n          type,\n          configuration,\n        }\n        if (!self.connectionInstances.has(assemblyName))\n          self.connectionInstances.set(assemblyName, [])\n        const assemblyConnections = self.connectionInstances.get(assemblyName)\n        if (!assemblyConnections)\n          throw new Error(`assembly ${assemblyName} not found`)\n        const length = assemblyConnections.push(connectionData)\n        return assemblyConnections[length - 1]\n      },\n\n      removeReferring(\n        referring: any,\n        track: any,\n        callbacks: Function[],\n        dereferenceTypeCount: Record<string, number>,\n      ) {\n        referring.forEach(({ node }: ReferringNode) => {\n          let dereferenced = false\n          try {\n            // If a view is referring to the track config, remove the track\n            // from the view\n            const type = 'open track(s)'\n            const view = getContainingView(node) as TrackViewModel\n            callbacks.push(() => view.hideTrack(track.trackId))\n            dereferenced = true\n            if (!dereferenceTypeCount[type]) {\n              dereferenceTypeCount[type] = 0\n            }\n            dereferenceTypeCount[type] += 1\n          } catch (err1) {\n            // ignore\n          }\n\n          // @ts-ignore\n          if (self.widgets.has(node.id)) {\n            // If a configuration editor widget has the track config\n            // open, close the widget\n            const type = 'configuration editor widget(s)'\n            callbacks.push(() => this.hideWidget(node))\n            dereferenced = true\n            if (!dereferenceTypeCount[type]) dereferenceTypeCount[type] = 0\n            dereferenceTypeCount[type] += 1\n          }\n          if (!dereferenced)\n            throw new Error(\n              `Error when closing this connection, the following node is still referring to a track configuration: ${JSON.stringify(\n                getSnapshot(node),\n              )}`,\n            )\n        })\n      },\n\n      prepareToBreakConnection(configuration: AnyConfigurationModel) {\n        const callbacksToDereferenceTrack: Function[] = []\n        const dereferenceTypeCount: Record<string, number> = {}\n        const name = readConfObject(configuration, 'name')\n        const assemblyName = readConfObject(configuration, 'assemblyName')\n        const assemblyConnections =\n          self.connectionInstances.get(assemblyName) || []\n        const connection = assemblyConnections.find(c => c.name === name)\n        if (connection) {\n          connection.tracks.forEach((track: any) => {\n            const referring = self.getReferring(track)\n            this.removeReferring(\n              referring,\n              track,\n              callbacksToDereferenceTrack,\n              dereferenceTypeCount,\n            )\n          })\n          const safelyBreakConnection = () => {\n            callbacksToDereferenceTrack.forEach(cb => cb())\n            this.breakConnection(configuration)\n          }\n          return [safelyBreakConnection, dereferenceTypeCount]\n        }\n        return undefined\n      },\n\n      breakConnection(configuration: AnyConfigurationModel) {\n        const name = readConfObject(configuration, 'name')\n        const assemblyName = readConfObject(configuration, 'assemblyName')\n        const connectionInstances = self.connectionInstances.get(assemblyName)\n        if (!connectionInstances)\n          throw new Error(`connections for ${assemblyName} not found`)\n        const connection = connectionInstances.find(c => c.name === name)\n        connectionInstances.remove(connection)\n      },\n\n      deleteConnection(configuration: AnyConfigurationModel) {\n        let deletedConn\n        if (self.adminMode) {\n          deletedConn = getParent(self).jbrowse.deleteConnectionConf(\n            configuration,\n          )\n        }\n        if (!deletedConn) {\n          const { connectionId } = configuration\n          const idx = self.sessionConnections.findIndex(\n            c => c.connectionId === connectionId,\n          )\n          if (idx === -1) {\n            return undefined\n          }\n          return self.sessionConnections.splice(idx, 1)\n        }\n        return deletedConn\n      },\n\n      updateDrawerWidth(drawerWidth: number) {\n        if (drawerWidth === self.drawerWidth) return self.drawerWidth\n        let newDrawerWidth = drawerWidth\n        if (newDrawerWidth < minDrawerWidth) newDrawerWidth = minDrawerWidth\n        self.drawerWidth = newDrawerWidth\n        return newDrawerWidth\n      },\n\n      resizeDrawer(distance: number) {\n        const oldDrawerWidth = self.drawerWidth\n        const newDrawerWidth = this.updateDrawerWidth(oldDrawerWidth - distance)\n        const actualDistance = oldDrawerWidth - newDrawerWidth\n        return actualDistance\n      },\n\n      addView(typeName: string, initialState = {}) {\n        const typeDefinition = pluginManager.getElementType('view', typeName)\n        if (!typeDefinition) throw new Error(`unknown view type ${typeName}`)\n\n        const length = self.views.push({\n          ...initialState,\n          type: typeName,\n        })\n        return self.views[length - 1]\n      },\n\n      removeView(view: any) {\n        for (const [, widget] of self.activeWidgets) {\n          if (widget.view && widget.view.id === view.id) {\n            this.hideWidget(widget)\n          }\n        }\n        self.views.remove(view)\n      },\n\n      addAssemblyConf(assemblyConf: AnyConfigurationModel) {\n        return getParent(self).jbrowse.addAssemblyConf(assemblyConf)\n      },\n\n      addTrackConf(trackConf: AnyConfigurationModel) {\n        if (self.adminMode) {\n          return getParent(self).jbrowse.addTrackConf(trackConf)\n        }\n        const { trackId, type } = trackConf\n        if (!type) {\n          throw new Error(`unknown track type ${type}`)\n        }\n        const track = self.sessionTracks.find((t: any) => t.trackId === trackId)\n        if (track) {\n          return track\n        }\n        const length = self.sessionTracks.push(trackConf)\n        return self.sessionTracks[length - 1]\n      },\n\n      deleteTrackConf(trackConf: AnyConfigurationModel) {\n        const callbacksToDereferenceTrack: Function[] = []\n        const dereferenceTypeCount: Record<string, number> = {}\n        const referring = self.getReferring(trackConf)\n        this.removeReferring(\n          referring,\n          trackConf,\n          callbacksToDereferenceTrack,\n          dereferenceTypeCount,\n        )\n        callbacksToDereferenceTrack.forEach(cb => cb())\n        if (self.adminMode) {\n          return getParent(self).jbrowse.deleteTrackConf(trackConf)\n        }\n        const { trackId } = trackConf\n        const idx = self.sessionTracks.findIndex(t => t.trackId === trackId)\n        if (idx === -1) {\n          return undefined\n        }\n        return self.sessionTracks.splice(idx, 1)\n      },\n\n      addConnectionConf(connectionConf: any) {\n        if (self.adminMode) {\n          return getParent(self).jbrowse.addConnectionConf(connectionConf)\n        }\n        const { connectionId, type } = connectionConf\n        if (!type) {\n          throw new Error(`unknown connection type ${type}`)\n        }\n        const connection = self.sessionTracks.find(\n          (c: any) => c.connectionId === connectionId,\n        )\n        if (connection) {\n          return connection\n        }\n        const length = self.sessionConnections.push(connectionConf)\n        return self.sessionConnections[length - 1]\n      },\n\n      addLinearGenomeViewOfAssembly(assemblyName: string, initialState = {}) {\n        return this.addViewOfAssembly(\n          'LinearGenomeView',\n          assemblyName,\n          initialState,\n        )\n      },\n\n      addViewOfAssembly(\n        viewType: any,\n        assemblyName: string,\n        initialState: any = {},\n      ) {\n        const assembly = self.assemblies.find(\n          (s: AnyConfigurationModel) =>\n            readConfObject(s, 'name') === assemblyName,\n        )\n        if (!assembly)\n          throw new Error(\n            `Could not add view of assembly \"${assemblyName}\", assembly name not found`,\n          )\n        initialState.displayRegionsFromAssemblyName = readConfObject(\n          assembly,\n          'name',\n        )\n        return this.addView(viewType, initialState)\n      },\n\n      addViewFromAnotherView(\n        viewType: string,\n        otherView: any,\n        initialState: { displayedRegions?: Region[] } = {},\n      ) {\n        const state = { ...initialState }\n        state.displayedRegions = getSnapshot(otherView.displayedRegions)\n        return this.addView(viewType, state)\n      },\n\n      addWidget(\n        typeName: string,\n        id: string,\n        initialState = {},\n        configuration = { type: typeName },\n      ) {\n        const typeDefinition = pluginManager.getElementType('widget', typeName)\n        if (!typeDefinition) throw new Error(`unknown widget type ${typeName}`)\n        const data = {\n          ...initialState,\n          id,\n          type: typeName,\n          configuration,\n        }\n        self.widgets.set(id, data)\n        return self.widgets.get(id)\n      },\n\n      showWidget(widget: any) {\n        if (self.activeWidgets.has(widget.id))\n          self.activeWidgets.delete(widget.id)\n        self.activeWidgets.set(widget.id, widget)\n      },\n\n      hasWidget(widget: any) {\n        return self.activeWidgets.has(widget.id)\n      },\n\n      hideWidget(widget: any) {\n        self.activeWidgets.delete(widget.id)\n      },\n\n      hideAllWidgets() {\n        self.activeWidgets.clear()\n      },\n\n      /**\n       * set the global selection, i.e. the globally-selected object.\n       * can be a feature, a view, just about anything\n       * @param thing -\n       */\n      setSelection(thing: any) {\n        self.selection = thing\n      },\n\n      /**\n       * clears the global selection\n       */\n      clearSelection() {\n        self.selection = undefined\n      },\n\n      clearConnections() {\n        self.connectionInstances.clear()\n        self.sessionConnections.clear()\n      },\n\n      addSavedSession(sessionSnapshot: SnapshotIn<typeof self>) {\n        return getParent(self).addSavedSession(sessionSnapshot)\n      },\n\n      removeSavedSession(sessionSnapshot: any) {\n        return getParent(self).removeSavedSession(sessionSnapshot)\n      },\n\n      renameCurrentSession(sessionName: string) {\n        return getParent(self).renameCurrentSession(sessionName)\n      },\n\n      duplicateCurrentSession() {\n        return getParent(self).duplicateCurrentSession()\n      },\n      activateSession(sessionName: any) {\n        return getParent(self).activateSession(sessionName)\n      },\n      setDefaultSession() {\n        return getParent(self).setDefaultSession()\n      },\n      saveSessionToLocalStorage() {\n        return getParent(self).saveSessionToLocalStorage()\n      },\n      loadAutosaveSession() {\n        return getParent(self).loadAutosaveSession()\n      },\n    }))\n    .extend(() => {\n      const snackbarMessages = observable.array()\n\n      return {\n        views: {\n          get snackbarMessages() {\n            return snackbarMessages\n          },\n        },\n        actions: {\n          notify(message: string, level?: NotificationLevel) {\n            return this.pushSnackbarMessage(message, level)\n          },\n\n          pushSnackbarMessage(message: string, level?: NotificationLevel) {\n            return snackbarMessages.push([message, level])\n          },\n\n          popSnackbarMessage() {\n            return snackbarMessages.pop()\n          },\n        },\n      }\n    })\n    .actions(self => ({\n      /**\n       * opens a configuration editor to configure the given thing,\n       * and sets the current task to be configuring it\n       * @param configuration -\n       */\n      editConfiguration(configuration: AnyConfigurationModel) {\n        if (!isConfigurationModel(configuration)) {\n          throw new Error(\n            'must pass a configuration model to editConfiguration',\n          )\n        }\n        const editableConfigSession = self\n        const editor = editableConfigSession.addWidget(\n          'ConfigurationEditorWidget',\n          'configEditor',\n          { target: configuration },\n        )\n        editableConfigSession.showWidget(editor)\n      },\n      editTrackConfiguration(configuration: AnyConfigurationModel) {\n        if (\n          !self.adminMode &&\n          self.sessionTracks.indexOf(configuration) === -1\n        ) {\n          throw new Error(\"Can't edit the configuration of a non-session track\")\n        }\n        this.editConfiguration(configuration)\n      },\n    }))\n    .views(self => ({\n      getTrackActionMenuItems(config: any) {\n        const session = self\n        const canEdit =\n          session.adminMode ||\n          session.sessionTracks.find((track: AnyConfigurationModel) => {\n            return track.trackId === config.trackId\n          })\n\n        return [\n          {\n            label: 'Settings',\n            disabled: !canEdit,\n            onClick: () => {\n              session.editTrackConfiguration(config)\n            },\n            icon: SettingsIcon,\n          },\n          {\n            label: 'Delete track',\n            disabled: !canEdit,\n            onClick: () => {\n              session.deleteTrackConf(config)\n            },\n            icon: DeleteIcon,\n          },\n          {\n            label: 'Copy track',\n            onClick: () => {\n              const trackSnapshot = JSON.parse(\n                JSON.stringify(getSnapshot(config)),\n              )\n              const now = Date.now()\n              trackSnapshot.trackId += `-${now}`\n              trackSnapshot.displays.forEach(\n                (display: { displayId: string }) => {\n                  display.displayId += `-${now}`\n                },\n              )\n              // the -sessionTrack suffix to trackId is used as metadata for\n              // the track selector to store the track in a special category,\n              // and default category is also cleared\n              if (!session.adminMode) {\n                trackSnapshot.trackId += '-sessionTrack'\n                trackSnapshot.category = undefined\n              }\n              trackSnapshot.name += ' (copy)'\n              session.addTrackConf(trackSnapshot)\n            },\n            icon: CopyIcon,\n          },\n        ]\n      },\n    }))\n}\n\nexport type SessionStateModel = ReturnType<typeof sessionModelFactory>\nexport type SessionModel = Instance<SessionStateModel>\n\n// @ts-ignore\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction z(x: Instance<SessionStateModel>): AbstractSessionModel {\n  // this function's sole purpose is to get typescript to check\n  // that the session model implements all of AbstractSessionModel\n  return x\n}\n","/* eslint curly:error*/\nimport assemblyManagerFactory, {\n  assemblyConfigSchemas as AssemblyConfigSchemasFactory,\n} from '@jbrowse/core/assemblyManager'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { AbstractSessionModel } from '@jbrowse/core/util'\nimport AddIcon from '@material-ui/icons/Add'\nimport SettingsIcon from '@material-ui/icons/Settings'\nimport AppsIcon from '@material-ui/icons/Apps'\nimport {\n  addDisposer,\n  cast,\n  getSnapshot,\n  getParent,\n  SnapshotIn,\n  types,\n} from 'mobx-state-tree'\nimport { observable, autorun } from 'mobx'\nimport { UndoManager } from 'mst-middlewares'\nimport corePlugins from './corePlugins'\nimport jbrowseWebFactory from './jbrowseModel'\n// @ts-ignore\nimport RenderWorker from './rpc.worker'\nimport sessionModelFactory from './sessionModelFactory'\n\ninterface Menu {\n  label: string\n  menuItems: MenuItem[]\n}\n\nexport default function RootModel(\n  pluginManager: PluginManager,\n  adminMode = false,\n) {\n  const Session = sessionModelFactory(pluginManager)\n  const { assemblyConfigSchemas, dispatcher } = AssemblyConfigSchemasFactory(\n    pluginManager,\n  )\n  const assemblyConfigSchemasType = types.union(\n    { dispatcher },\n    ...assemblyConfigSchemas,\n  )\n  const assemblyManagerType = assemblyManagerFactory(\n    assemblyConfigSchemasType,\n    pluginManager,\n  )\n  return types\n    .model('Root', {\n      jbrowse: jbrowseWebFactory(\n        pluginManager,\n        Session,\n        assemblyConfigSchemasType,\n      ),\n      configPath: types.maybe(types.string),\n      session: types.maybe(Session),\n      assemblyManager: assemblyManagerType,\n      version: types.maybe(types.string),\n      isAssemblyEditing: false,\n      isDefaultSessionEditing: false,\n    })\n    .volatile(() => ({\n      savedSessionsVolatile: observable.map({}),\n      pluginManager,\n      error: undefined as undefined | Error,\n    }))\n    .views(self => ({\n      get savedSessions() {\n        return Array.from(self.savedSessionsVolatile.values())\n      },\n      localStorageId(name: string) {\n        return `localSaved-${name}-${self.configPath}`\n      },\n      get autosaveId() {\n        return `autosave-${self.configPath}`\n      },\n      get previousAutosaveId() {\n        return `previousAutosave-${self.configPath}`\n      },\n    }))\n    .views(self => ({\n      get savedSessionNames() {\n        return self.savedSessions.map(session => session.name)\n      },\n      get currentSessionId() {\n        const locationUrl = new URL(window.location.href)\n        const params = new URLSearchParams(locationUrl.search)\n        return params?.get('session')?.split('local-')[1]\n      },\n    }))\n    .actions(self => ({\n      afterCreate() {\n        Object.entries(localStorage)\n          .filter(([key, _val]) => key.startsWith('localSaved-'))\n          .filter(\n            ([key, _val]) => key.indexOf(self.configPath || 'undefined') !== -1,\n          )\n          .forEach(([key, val]) => {\n            try {\n              const { session } = JSON.parse(val)\n              self.savedSessionsVolatile.set(key, session)\n            } catch (e) {\n              console.error('bad session encountered', key, val)\n            }\n          })\n        addDisposer(\n          self,\n          autorun(() => {\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\n            for (const [_, val] of self.savedSessionsVolatile.entries()) {\n              try {\n                const key = self.localStorageId(val.name)\n                localStorage.setItem(key, JSON.stringify({ session: val }))\n              } catch (e) {\n                if (e.code === '22' || e.code === '1024') {\n                  // eslint-disable-next-line no-alert\n                  alert(\n                    'Local storage is full! Please use the \"Open sessions\" panel to remove old sessions',\n                  )\n                }\n              }\n            }\n          }),\n        )\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              if (self.session) {\n                const noSession = { name: 'empty' }\n                const snapshot = getSnapshot(self.session) || noSession\n                sessionStorage.setItem(\n                  'current',\n                  JSON.stringify({ session: snapshot }),\n                )\n\n                localStorage.setItem(\n                  `autosave-${self.configPath}`,\n                  JSON.stringify({\n                    session: {\n                      ...snapshot,\n                      name: `${snapshot.name}-autosaved`,\n                    },\n                  }),\n                )\n              }\n            },\n            { delay: 400 },\n          ),\n        )\n      },\n      setSession(sessionSnapshot?: SnapshotIn<typeof Session>) {\n        self.session = cast(sessionSnapshot)\n      },\n      setAssemblyEditing(flag: boolean) {\n        self.isAssemblyEditing = flag\n      },\n      setDefaultSessionEditing(flag: boolean) {\n        self.isDefaultSessionEditing = flag\n      },\n      setDefaultSession() {\n        const { defaultSession } = self.jbrowse\n        const newSession = {\n          ...defaultSession,\n          name: `${defaultSession.name} ${new Date().toLocaleString()}`,\n        }\n\n        this.setSession(newSession)\n      },\n      renameCurrentSession(sessionName: string) {\n        if (self.session) {\n          const snapshot = JSON.parse(JSON.stringify(getSnapshot(self.session)))\n          snapshot.name = sessionName\n          this.setSession(snapshot)\n        }\n      },\n\n      addSavedSession(session: { name: string }) {\n        const key = self.localStorageId(session.name)\n        self.savedSessionsVolatile.set(key, session)\n      },\n\n      removeSavedSession(session: { name: string }) {\n        const key = self.localStorageId(session.name)\n        localStorage.removeItem(key)\n        self.savedSessionsVolatile.delete(key)\n      },\n\n      duplicateCurrentSession() {\n        if (self.session) {\n          const snapshot = JSON.parse(JSON.stringify(getSnapshot(self.session)))\n          let newSnapshotName = `${self.session.name} (copy)`\n          if (self.savedSessionNames.includes(newSnapshotName)) {\n            let newSnapshotCopyNumber = 2\n            do {\n              newSnapshotName = `${self.session.name} (copy ${newSnapshotCopyNumber})`\n              newSnapshotCopyNumber += 1\n            } while (self.savedSessionNames.includes(newSnapshotName))\n          }\n          snapshot.name = newSnapshotName\n          this.setSession(snapshot)\n        }\n      },\n      activateSession(name: string) {\n        const localId = self.localStorageId(name)\n        const newSessionSnapshot = localStorage.getItem(localId)\n        if (!newSessionSnapshot) {\n          throw new Error(\n            `Can't activate session ${name}, it is not in the savedSessions`,\n          )\n        }\n\n        this.setSession(JSON.parse(newSessionSnapshot).session)\n      },\n      saveSessionToLocalStorage() {\n        if (self.session) {\n          const key = self.localStorageId(self.session.name)\n          self.savedSessionsVolatile.set(key, getSnapshot(self.session))\n        }\n      },\n      loadAutosaveSession() {\n        const previousAutosave = localStorage.getItem(self.previousAutosaveId)\n        const autosavedSession = previousAutosave\n          ? JSON.parse(previousAutosave).session\n          : {}\n        const { name } = autosavedSession\n        autosavedSession.name = `${name.replace('-autosaved', '')}-restored`\n        this.setSession(autosavedSession)\n      },\n\n      setError(error: Error) {\n        self.error = error\n      },\n    }))\n    .volatile(self => ({\n      history: {},\n      menus: [\n        {\n          label: 'File',\n          menuItems: [\n            {\n              label: 'New session',\n              icon: AddIcon,\n              // eslint-disable-next-line @typescript-eslint/no-explicit-any\n              onClick: (session: any) => {\n                const lastAutosave = localStorage.getItem(self.autosaveId)\n                if (lastAutosave) {\n                  localStorage.setItem(self.previousAutosaveId, lastAutosave)\n                }\n                session.setDefaultSession()\n              },\n            },\n            {\n              label: 'Return to splash screen',\n              icon: AppsIcon,\n              onClick: () => {\n                self.setSession(undefined)\n              },\n            },\n          ],\n        },\n        ...(adminMode\n          ? [\n              {\n                label: 'Admin',\n                menuItems: [\n                  {\n                    label: 'Open assembly manager',\n                    icon: SettingsIcon,\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    onClick: (session: any) => {\n                      const rootModel = getParent(session)\n                      rootModel.setAssemblyEditing(true)\n                    },\n                  },\n                  {\n                    label: 'Set default session',\n                    icon: SettingsIcon,\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    onClick: (session: any) => {\n                      const rootModel = getParent(session)\n                      rootModel.setDefaultSessionEditing(true)\n                    },\n                  },\n                ],\n              },\n            ]\n          : []),\n      ] as Menu[],\n      rpcManager: new RpcManager(\n        pluginManager,\n        self.jbrowse.plugins,\n        self.jbrowse.configuration.rpc,\n        {\n          WebWorkerRpcDriver: { WorkerClass: RenderWorker },\n          MainThreadRpcDriver: {},\n        },\n      ),\n      adminMode,\n    }))\n    .actions(self => ({\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      setHistory(history: any) {\n        self.history = history\n      },\n      setMenus(newMenus: Menu[]) {\n        self.menus = newMenus\n      },\n      /**\n       * Add a top-level menu\n       * @param menuName - Name of the menu to insert.\n       * @returns The new length of the top-level menus array\n       */\n      appendMenu(menuName: string) {\n        return self.menus.push({ label: menuName, menuItems: [] })\n      },\n      /**\n       * Insert a top-level menu\n       * @param menuName - Name of the menu to insert.\n       * @param position - Position to insert menu. If negative, counts from th\n       * end, e.g. `insertMenu('My Menu', -1)` will insert the menu as the\n       * second-to-last one.\n       * @returns The new length of the top-level menus array\n       */\n      insertMenu(menuName: string, position: number) {\n        const insertPosition =\n          position < 0 ? self.menus.length + position : position\n        self.menus.splice(insertPosition, 0, { label: menuName, menuItems: [] })\n        return self.menus.length\n      },\n      /**\n       * Add a menu item to a top-level menu\n       * @param menuName - Name of the top-level menu to append to.\n       * @param menuItem - Menu item to append.\n       * @returns The new length of the menu\n       */\n      appendToMenu(menuName: string, menuItem: MenuItem) {\n        const menu = self.menus.find(m => m.label === menuName)\n        if (!menu) {\n          self.menus.push({ label: menuName, menuItems: [menuItem] })\n          return 1\n        }\n        return menu.menuItems.push(menuItem)\n      },\n      /**\n       * Insert a menu item into a top-level menu\n       * @param menuName - Name of the top-level menu to insert into\n       * @param menuItem - Menu item to insert\n       * @param position - Position to insert menu item. If negative, counts\n       * from the end, e.g. `insertMenu('My Menu', -1)` will insert the menu as\n       * the second-to-last one.\n       * @returns The new length of the menu\n       */\n      insertInMenu(menuName: string, menuItem: MenuItem, position: number) {\n        const menu = self.menus.find(m => m.label === menuName)\n        if (!menu) {\n          self.menus.push({ label: menuName, menuItems: [menuItem] })\n          return 1\n        }\n        const insertPosition =\n          position < 0 ? menu.menuItems.length + position : position\n        menu.menuItems.splice(insertPosition, 0, menuItem)\n        return menu.menuItems.length\n      },\n      /**\n       * Add a menu item to a sub-menu\n       * @param menuPath - Path to the sub-menu to add to, starting with the\n       * top-level menu (e.g. `['File', 'Insert']`).\n       * @param menuItem - Menu item to append.\n       * @returns The new length of the sub-menu\n       */\n      appendToSubMenu(menuPath: string[], menuItem: MenuItem) {\n        let topMenu = self.menus.find(m => m.label === menuPath[0])\n        if (!topMenu) {\n          const idx = this.appendMenu(menuPath[0])\n          topMenu = self.menus[idx - 1]\n        }\n        let { menuItems: subMenu } = topMenu\n        const pathSoFar = [menuPath[0]]\n        menuPath.slice(1).forEach(menuName => {\n          pathSoFar.push(menuName)\n          let sm = subMenu.find(mi => 'label' in mi && mi.label === menuName)\n          if (!sm) {\n            const idx = subMenu.push({ label: menuName, subMenu: [] })\n            sm = subMenu[idx - 1]\n          }\n          if (!('subMenu' in sm)) {\n            throw new Error(\n              `\"${menuName}\" in path \"${pathSoFar}\" is not a subMenu`,\n            )\n          }\n          subMenu = sm.subMenu\n        })\n        return subMenu.push(menuItem)\n      },\n      /**\n       * Insert a menu item into a sub-menu\n       * @param menuPath - Path to the sub-menu to add to, starting with the\n       * top-level menu (e.g. `['File', 'Insert']`).\n       * @param menuItem - Menu item to insert.\n       * @param position - Position to insert menu item. If negative, counts\n       * from the end, e.g. `insertMenu('My Menu', -1)` will insert the menu as\n       * the second-to-last one.\n       * @returns The new length of the sub-menu\n       */\n      insertInSubMenu(\n        menuPath: string[],\n        menuItem: MenuItem,\n        position: number,\n      ) {\n        let topMenu = self.menus.find(m => m.label === menuPath[0])\n        if (!topMenu) {\n          const idx = this.appendMenu(menuPath[0])\n          topMenu = self.menus[idx - 1]\n        }\n        let { menuItems: subMenu } = topMenu\n        const pathSoFar = [menuPath[0]]\n        menuPath.slice(1).forEach(menuName => {\n          pathSoFar.push(menuName)\n          let sm = subMenu.find(mi => 'label' in mi && mi.label === menuName)\n          if (!sm) {\n            const idx = subMenu.push({ label: menuName, subMenu: [] })\n            sm = subMenu[idx - 1]\n          }\n          if (!('subMenu' in sm)) {\n            throw new Error(\n              `\"${menuName}\" in path \"${pathSoFar}\" is not a subMenu`,\n            )\n          }\n          subMenu = sm.subMenu\n        })\n        subMenu.splice(position, 0, menuItem)\n        return subMenu.length\n      },\n    }))\n}\n\nexport function createTestSession(snapshot = {}) {\n  const pluginManager = new PluginManager(corePlugins.map(P => new P()))\n  pluginManager.createPluggableElements()\n\n  const JBrowseRootModel = RootModel(pluginManager)\n  const root = JBrowseRootModel.create({\n    jbrowse: {\n      configuration: { rpc: { defaultDriver: 'MainThreadRpcDriver' } },\n    },\n    assemblyManager: {},\n  })\n  root.setSession({\n    name: 'testSession',\n    ...snapshot,\n  })\n  root.setHistory(UndoManager.create({}, { targetStore: root.session }))\n  // @ts-ignore\n  root.session.views.map(view => view.setWidth(800))\n  pluginManager.setRootModel(root)\n\n  pluginManager.configure()\n  return root.session as AbstractSessionModel\n}\n","export default async function factoryReset() {\n  // @ts-ignore\n  window.location = window.location.pathname\n}\n","import IconButton from '@material-ui/core/IconButton'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport Menu from '@material-ui/core/Menu'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport Typography from '@material-ui/core/Typography'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport MoreVertIcon from '@material-ui/icons/MoreVert'\nimport { ListItem } from '@material-ui/core'\n\nimport PropTypes from 'prop-types'\nimport React, { useState } from 'react'\n\nconst useStyles = makeStyles({\n  menu: {\n    left: '65%',\n  },\n})\n\nfunction RecentSessionCard({ sessionName, onClick, onDelete }) {\n  const classes = useStyles()\n  const [hovered, setHovered] = useState(false)\n  const [menuAnchorEl, setMenuAnchorEl] = useState(null)\n\n  function onMenuClick(event) {\n    event.stopPropagation()\n    setMenuAnchorEl(event.currentTarget)\n  }\n\n  const handleMenuClose = action => {\n    setMenuAnchorEl(null)\n    if (action === 'delete') return onDelete(sessionName)\n    return undefined\n  }\n\n  return (\n    <>\n      <ListItem\n        onMouseOver={() => setHovered(true)}\n        onMouseOut={() => setHovered(false)}\n        onClick={() => onClick(sessionName)}\n        raised={Boolean(hovered)}\n        button\n      >\n        <Tooltip title={sessionName} enterDelay={300}>\n          <Typography variant=\"body2\" noWrap style={{ width: 250 }}>\n            {sessionName}\n          </Typography>\n        </Tooltip>\n        <IconButton className={classes.menu} onClick={onMenuClick}>\n          <MoreVertIcon color=\"secondary\" />\n        </IconButton>\n      </ListItem>\n      <Menu\n        id=\"simple-menu\"\n        anchorEl={menuAnchorEl}\n        keepMounted\n        open={Boolean(menuAnchorEl)}\n        onClose={handleMenuClose}\n      >\n        <MenuItem onClick={() => handleMenuClose('delete')}>\n          <ListItemIcon>\n            <DeleteIcon color=\"secondary\" />\n          </ListItemIcon>\n          <Typography variant=\"inherit\">Delete</Typography>\n        </MenuItem>\n      </Menu>\n    </>\n  )\n}\n\nRecentSessionCard.propTypes = {\n  sessionName: PropTypes.string.isRequired,\n  onClick: PropTypes.func.isRequired,\n  onDelete: PropTypes.func.isRequired,\n}\n\nexport default RecentSessionCard\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport Button from '@material-ui/core/Button'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport Container from '@material-ui/core/Container'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Grid from '@material-ui/core/Grid'\nimport List from '@material-ui/core/List'\nimport WarningIcon from '@material-ui/icons/Warning'\nimport SettingsIcon from '@material-ui/icons/Settings'\nimport IconButton from '@material-ui/core/IconButton'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport ListSubheader from '@material-ui/core/ListSubheader'\nimport Menu from '@material-ui/core/Menu'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Typography from '@material-ui/core/Typography'\nimport { PropTypes as MobxPropTypes } from 'mobx-react'\nimport React, { useEffect, useState } from 'react'\nimport { LogoFull, FactoryResetDialog } from '@jbrowse/core/ui'\nimport {\n  ProceedEmptySession,\n  AddLinearGenomeViewToSession,\n  AddSVInspectorToSession,\n} from '@jbrowse/core/ui/NewSessionCards'\nimport RecentSessionCard from './RecentSessionCard'\n\nconst useStyles = makeStyles(theme => ({\n  newSession: {\n    backgroundColor: theme.palette.grey['300'],\n    padding: theme.spacing(2),\n    marginTop: theme.spacing(6),\n  },\n  header: {\n    margin: theme.spacing(2),\n  },\n  settings: {\n    float: 'right',\n  },\n}))\n\nconst DeleteSessionDialog = ({\n  sessionToDelete,\n  onClose,\n  root,\n}: {\n  sessionToDelete?: string\n  onClose: (arg0: boolean) => void\n  root: any\n}) => {\n  const [deleteSession, setDeleteSession] = useState(false)\n  useEffect(() => {\n    ;(async () => {\n      try {\n        if (deleteSession) {\n          setDeleteSession(false)\n          root.removeSavedSession({ name: sessionToDelete })\n          onClose(true)\n        }\n      } catch (e) {\n        setDeleteSession(() => {\n          throw e\n        })\n      }\n    })()\n  }, [deleteSession, onClose, root, sessionToDelete])\n\n  return (\n    <Dialog open={!!sessionToDelete} onClose={() => onClose(false)}>\n      <DialogTitle id=\"alert-dialog-title\">\n        {`Delete session \"${sessionToDelete}\"?`}\n      </DialogTitle>\n      <DialogContent>\n        <DialogContentText id=\"alert-dialog-description\">\n          This action cannot be undone\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => onClose(false)} color=\"primary\">\n          Cancel\n        </Button>\n        <Button\n          onClick={() => {\n            setDeleteSession(true)\n          }}\n          color=\"primary\"\n          variant=\"contained\"\n          autoFocus\n        >\n          Delete\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nexport default function StartScreen({\n  root,\n  onFactoryReset,\n}: {\n  root: any\n  onFactoryReset: Function\n}) {\n  const classes = useStyles()\n\n  const [sessions, setSessions] = useState<Record<string, any> | undefined>()\n  const [sessionToDelete, setSessionToDelete] = useState<string | undefined>()\n  const [sessionToLoad, setSessionToLoad] = useState<string | undefined>()\n  const [updateSessionsList, setUpdateSessionsList] = useState(true)\n  const [menuAnchorEl, setMenuAnchorEl] = useState<null | HTMLElement>(null)\n  const [reset, setReset] = useState(false)\n\n  const sessionNames = sessions !== undefined ? sessions : []\n  useEffect(() => {\n    ;(async () => {\n      try {\n        if (sessionToLoad) {\n          root.activateSession(sessionToLoad)\n        }\n      } catch (e) {\n        setSessions(() => {\n          throw e\n        })\n      }\n    })()\n  }, [root, sessionToLoad])\n\n  useEffect(() => {\n    ;(async () => {\n      try {\n        if (updateSessionsList) {\n          setUpdateSessionsList(false)\n          const savedRootSessions = root.savedSessions.map(\n            (rootSavedSession: any) => {\n              return JSON.parse(JSON.stringify(rootSavedSession))?.name\n            },\n          )\n          setSessions(savedRootSessions)\n        }\n      } catch (e) {\n        setSessions(() => {\n          throw e\n        })\n      }\n    })()\n  }, [root.savedSessions, updateSessionsList])\n\n  if (!sessions)\n    return (\n      <CircularProgress\n        style={{\n          position: 'fixed',\n          top: '50%',\n          left: '50%',\n          marginTop: -25,\n          marginLeft: -25,\n        }}\n        size={50}\n      />\n    )\n\n  return (\n    <>\n      <FactoryResetDialog\n        open={reset}\n        onFactoryReset={onFactoryReset}\n        onClose={() => {\n          setReset(false)\n        }}\n      />\n      <DeleteSessionDialog\n        root={root}\n        sessionToDelete={sessionToDelete}\n        onClose={update => {\n          setSessionToDelete(undefined)\n          setUpdateSessionsList(update)\n        }}\n      />\n      <IconButton\n        className={classes.settings}\n        onClick={event => {\n          event.stopPropagation()\n          setMenuAnchorEl(event.currentTarget)\n        }}\n      >\n        <SettingsIcon />\n      </IconButton>\n      <Container maxWidth=\"md\">\n        <LogoFull />\n        <div className={classes.newSession}>\n          <Typography variant=\"h5\" className={classes.header}>\n            Start a new session\n          </Typography>\n          <Grid container spacing={4}>\n            <Grid item data-testid=\"emptySession\">\n              <ProceedEmptySession root={root} />\n            </Grid>\n            <Grid item data-testid=\"emptyLGVSession\">\n              <AddLinearGenomeViewToSession root={root} />\n            </Grid>\n            <Grid item data-testid=\"emptySVSession\">\n              <AddSVInspectorToSession root={root} />\n            </Grid>\n          </Grid>\n        </div>\n        <div>\n          <Typography variant=\"h5\" className={classes.header}>\n            Recent sessions\n          </Typography>\n          <List\n            style={{\n              overflow: 'auto',\n              maxHeight: 200,\n            }}\n          >\n            {sessionNames\n              ? sessionNames.map((sessionName: string) => (\n                  <RecentSessionCard\n                    key={sessionName}\n                    sessionName={sessionName}\n                    onClick={() => {\n                      setSessionToLoad(sessionName)\n                    }}\n                    onDelete={() => {\n                      setSessionToDelete(sessionName)\n                    }}\n                  />\n                ))\n              : null}\n          </List>\n        </div>\n      </Container>\n\n      <Menu\n        id=\"simple-menu\"\n        anchorEl={menuAnchorEl}\n        keepMounted\n        open={Boolean(menuAnchorEl)}\n        onClose={() => {\n          setMenuAnchorEl(null)\n        }}\n      >\n        <ListSubheader>Advanced Settings</ListSubheader>\n        <MenuItem\n          onClick={() => {\n            setReset(true)\n            setMenuAnchorEl(null)\n          }}\n        >\n          <ListItemIcon>\n            <WarningIcon />\n          </ListItemIcon>\n          <Typography variant=\"inherit\">Reset</Typography>\n        </MenuItem>\n      </Menu>\n    </>\n  )\n}\n\nStartScreen.propTypes = {\n  root: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React, { useEffect, useState } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport PluginLoader, { PluginDefinition } from '@jbrowse/core/PluginLoader'\nimport { observer } from 'mobx-react'\nimport { inDevelopment, fromUrlSafeB64 } from '@jbrowse/core/util'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport ErrorBoundary from 'react-error-boundary'\nimport {\n  StringParam,\n  useQueryParam,\n  QueryParamProvider,\n} from 'use-query-params'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { types, Instance, SnapshotOut } from 'mobx-state-tree'\nimport { PluginConstructor } from '@jbrowse/core/Plugin'\nimport { FatalErrorDialog } from '@jbrowse/core/ui'\nimport { TextDecoder, TextEncoder } from 'fastestsmallesttextencoderdecoder'\nimport 'fontsource-roboto'\nimport 'requestidlecallback-polyfill'\nimport 'core-js/stable'\nimport shortid from 'shortid'\nimport {\n  writeAWSAnalytics,\n  writeGAAnalytics,\n} from '@jbrowse/core/util/analytics'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { readSessionFromDynamo } from './sessionSharing'\nimport Loading from './Loading'\nimport corePlugins from './corePlugins'\nimport JBrowse from './JBrowse'\nimport JBrowseRootModelFactory from './rootModel'\nimport packagedef from '../package.json'\nimport factoryReset from './factoryReset'\nimport StartScreen from './StartScreen'\n\nif (!window.TextEncoder) {\n  window.TextEncoder = TextEncoder\n}\nif (!window.TextDecoder) {\n  window.TextDecoder = TextDecoder\n}\nfunction NoConfigMessage() {\n  const s = window.location.search\n  const links = [\n    ['test_data/volvox/config.json', 'Volvox sample data'],\n    ['test_data/config.json', 'Human basic'],\n    ['test_data/config_demo.json', 'Human sample data'],\n    ['test_data/tomato/config.json', 'Tomato SVs'],\n    ['test_data/breakpoint/config.json', 'Breakpoint'],\n    ['test_data/config_dotplot.json', 'Grape/Peach dotplot'],\n    ['test_data/config_synteny_grape_peach.json', 'Grape/Peach synteny'],\n    ['test_data/yeast_synteny/config.json', 'Yeast synteny'],\n    ['test_data/config_many_contigs.json', 'Many contigs'],\n    ['test_data/config_honeybee.json', 'Honeybee'],\n  ]\n  return (\n    <div>\n      <h4>\n        Configuration not found. You may have arrived here if you requested a\n        config that does not exist or you have not set up your JBrowse yet.\n      </h4>\n\n      <p>\n        If you want to complete your setup, visit our{' '}\n        <a href=\"https://jbrowse.org/jb2/docs/quickstart_web\">\n          Quick start guide\n        </a>\n      </p>\n\n      {inDevelopment ? (\n        <>\n          <div>Sample JBrowse configs:</div>\n          <ul>\n            {links.map(([link, name]) => (\n              <li key={name}>\n                <a href={`${s}${s ? '&' : '?'}config=${link}`}>{name}</a>\n              </li>\n            ))}\n          </ul>\n        </>\n      ) : (\n        <>\n          <div>Sample JBrowse config:</div>\n          <ul>\n            <li>\n              <a href=\"?config=test_data/volvox/config.json\">\n                Volvox sample data\n              </a>\n            </li>\n          </ul>\n        </>\n      )}\n    </div>\n  )\n}\n\ntype Config = SnapshotOut<AnyConfigurationModel>\n\nconst SessionLoader = types\n  .model({\n    configPath: types.maybe(types.string),\n    sessionQuery: types.maybe(types.string),\n    password: types.maybe(types.string),\n    adminKey: types.maybe(types.string),\n  })\n  .volatile(() => ({\n    blankSession: false as any,\n    configSnapshot: undefined as any,\n    sessionSnapshot: undefined as any,\n    plugins: [] as PluginConstructor[],\n    sessionError: undefined as Error | undefined,\n    configError: undefined as Error | undefined,\n    bc1:\n      window.BroadcastChannel &&\n      new window.BroadcastChannel('jb_request_session'),\n    bc2:\n      window.BroadcastChannel &&\n      new window.BroadcastChannel('jb_respond_session'),\n  }))\n  .views(self => ({\n    get sharedSession() {\n      return self.sessionQuery?.startsWith('share-')\n    },\n\n    get encodedSession() {\n      return self.sessionQuery?.startsWith('encoded-')\n    },\n\n    get localSession() {\n      return self.sessionQuery?.startsWith('local-')\n    },\n\n    get ready() {\n      return this.sessionLoaded && !self.configError\n    },\n\n    get error() {\n      return self.configError || self.sessionError\n    },\n\n    get sessionLoaded() {\n      return (\n        !!self.sessionError || !!self.sessionSnapshot || !!self.blankSession\n      )\n    },\n\n    get configLoaded() {\n      return !!self.configError || !!self.configSnapshot\n    },\n  }))\n  .actions(self => ({\n    setSessionQuery(session?: any) {\n      self.sessionQuery = session\n    },\n    setConfigError(error: Error) {\n      self.configError = error\n    },\n\n    setSessionError(error: Error) {\n      self.sessionError = error\n    },\n    setPlugins(plugins: PluginConstructor[]) {\n      self.plugins = plugins\n    },\n    setConfigSnapshot(snap: unknown) {\n      self.configSnapshot = snap\n    },\n    setSessionSnapshot(snap: unknown) {\n      self.sessionSnapshot = snap\n      sessionStorage.setItem('current', JSON.stringify(snap))\n    },\n    setBlankSession(flag: boolean) {\n      self.blankSession = flag\n    },\n  }))\n  .actions(self => ({\n    async fetchPlugins(config: { plugins: PluginDefinition[] }) {\n      try {\n        const pluginLoader = new PluginLoader(config.plugins)\n        pluginLoader.installGlobalReExports(window)\n        const runtimePlugins = await pluginLoader.load()\n        self.setPlugins([...corePlugins, ...runtimePlugins])\n      } catch (error) {\n        self.setConfigError(error)\n      }\n    },\n    async fetchConfig() {\n      try {\n        const configLocation = {\n          uri: self.configPath || 'config.json',\n        }\n        const location = openLocation(configLocation)\n        const configText = (await location.readFile('utf8')) as string\n\n        const config = JSON.parse(configText)\n        const configUri = new URL(configLocation.uri, window.location.href)\n        addRelativeUris(config, configUri)\n        await this.fetchPlugins(config)\n        self.setConfigSnapshot(config)\n      } catch (error) {\n        self.setConfigError(error)\n      }\n    },\n\n    async fetchSessionStorageSession() {\n      const sessionStr = sessionStorage.getItem('current')\n      const query = (self.sessionQuery as string).replace('local-', '')\n\n      // check if\n      if (sessionStr) {\n        const sessionSnap = JSON.parse(sessionStr).session || {}\n        if (query === sessionSnap.id) {\n          self.setSessionSnapshot(sessionSnap)\n          return\n        }\n      }\n      if (self.bc1) {\n        self.bc1.postMessage(query)\n        const resultP = new Promise((resolve, reject) => {\n          if (self.bc2) {\n            self.bc2.onmessage = msg => {\n              resolve(msg.data)\n            }\n          }\n          setTimeout(() => reject(), 1000)\n        })\n\n        try {\n          const result = await resultP\n          // @ts-ignore\n          self.setSessionSnapshot({ ...result, id: shortid() })\n          return\n        } catch (e) {\n          // the broadcast channels did not find the session in another tab\n          // clear session param, so just ignore\n        }\n      }\n      self.setSessionError(new Error('Local storage session not found'))\n    },\n\n    async fetchSharedSession() {\n      // raw readConf alternative for before conf is initialized\n      const readConf = (\n        conf: { configuration?: { [key: string]: string } },\n        attr: string,\n        def: string,\n      ) => {\n        return (conf.configuration || {})[attr] || def\n      }\n\n      const defaultURL =\n        'https://g5um1mrb0i.execute-api.us-east-1.amazonaws.com/api/v1/'\n      const decryptedSession = await readSessionFromDynamo(\n        `${readConf(self.configSnapshot, 'shareURL', defaultURL)}load`,\n        self.sessionQuery || '',\n        self.password || '',\n      )\n\n      const session = JSON.parse(fromUrlSafeB64(decryptedSession))\n      self.setSessionSnapshot({ ...session, id: shortid() })\n    },\n\n    async decodeEncodedUrlSession() {\n      const session = JSON.parse(\n        // @ts-ignore\n        fromUrlSafeB64(self.sessionQuery.replace('encoded-', '')),\n      )\n      self.setSessionSnapshot({ ...session, id: shortid() })\n    },\n    async afterCreate() {\n      const { localSession, encodedSession, sharedSession, configPath } = self\n\n      // rename autosave to previousAutosave\n      const lastAutosave = localStorage.getItem(`autosave-${configPath}`)\n      if (lastAutosave) {\n        localStorage.setItem(`previousAutosave-${configPath}`, lastAutosave)\n      }\n\n      try {\n        // fetch config\n        await this.fetchConfig()\n      } catch (e) {\n        self.setConfigError(e)\n        return\n      }\n\n      try {\n        if (sharedSession) {\n          await this.fetchSharedSession()\n        } else if (encodedSession) {\n          await this.decodeEncodedUrlSession()\n        } else if (localSession) {\n          await this.fetchSessionStorageSession()\n        } else if (self.sessionQuery) {\n          // if there was a sessionQuery and we don't recognize it\n          throw new Error('unrecognized session format')\n        } else {\n          // placeholder for session loaded, but none found\n          self.setBlankSession(true)\n        }\n        if (self.bc1) {\n          self.bc1.onmessage = msg => {\n            const ret =\n              JSON.parse(sessionStorage.getItem('current') || '{}').session ||\n              {}\n            if (ret.id === msg.data) {\n              if (self.bc2) {\n                self.bc2.postMessage(ret)\n              }\n            }\n          }\n        }\n      } catch (e) {\n        self.setSessionError(e)\n      }\n    },\n  }))\n\nexport function Loader({ initialTimestamp }: { initialTimestamp: number }) {\n  // return value if defined, else convert null to undefined for use with\n  // types.maybe\n  const load = (param: string | null | undefined) =>\n    param === null ? undefined : param\n\n  const [config] = useQueryParam('config', StringParam)\n  const [session] = useQueryParam('session', StringParam)\n  const [password] = useQueryParam('password', StringParam)\n  const [adminKey] = useQueryParam('adminKey', StringParam)\n\n  const loader = SessionLoader.create({\n    configPath: load(config),\n    sessionQuery: load(session),\n    password: load(password),\n    adminKey: load(adminKey),\n  })\n\n  return (\n    <Renderer\n      loader={loader}\n      initialTimestamp={initialTimestamp}\n      initialSessionQuery={session}\n    />\n  )\n}\n\nconst Renderer = observer(\n  ({\n    loader,\n    initialTimestamp,\n    initialSessionQuery,\n  }: {\n    loader: Instance<typeof SessionLoader>\n    initialTimestamp: number\n    initialSessionQuery: string | null | undefined\n  }) => {\n    const [, setPassword] = useQueryParam('password', StringParam)\n    const { sessionError, configError, ready } = loader\n    const [pm, setPluginManager] = useState<PluginManager>()\n    // only create the pluginManager/rootModel \"on mount\"\n    useEffect(() => {\n      const {\n        plugins,\n        adminKey,\n        configSnapshot,\n        sessionSnapshot,\n        configPath,\n      } = loader\n\n      if (ready) {\n        // it is ready when a session has loaded and when there is no config error\n        // Assuming that the query changes self.sessionError or self.sessionSnapshot or self.blankSession\n        const pluginManager = new PluginManager(plugins.map(P => new P()))\n\n        pluginManager.createPluggableElements()\n\n        const JBrowseRootModel = JBrowseRootModelFactory(\n          pluginManager,\n          !!adminKey,\n        )\n\n        if (loader.configSnapshot) {\n          const rootModel = JBrowseRootModel.create({\n            jbrowse: configSnapshot,\n            assemblyManager: {},\n            version: packagedef.version,\n            configPath,\n          })\n\n          // in order: saves the previous autosave for recovery, tries to load\n          // the local session if session in query, or loads the default\n          // session\n          if (sessionError) {\n            rootModel.setDefaultSession()\n            // make typescript happy by checking for session after\n            // setDefaultSession, even though we know this exists now\n            if (rootModel.session) {\n              rootModel.session.notify(\n                `Error loading session: ${sessionError.message}. If you\n                received this URL from another user, request that they send you\n                a session generated with the \"Share\" button instead of copying\n                and pasting their URL`,\n              )\n            }\n          } else if (sessionSnapshot) {\n            rootModel.setSession(loader.sessionSnapshot)\n          } else {\n            const defaultJBrowseSession = rootModel.jbrowse.defaultSession\n            if (defaultJBrowseSession?.views) {\n              if (defaultJBrowseSession.views.length > 0) {\n                rootModel.setDefaultSession()\n              }\n            }\n          }\n\n          // send analytics\n          if (\n            rootModel &&\n            !readConfObject(rootModel.jbrowse.configuration, 'disableAnalytics')\n          ) {\n            writeAWSAnalytics(rootModel, initialTimestamp, initialSessionQuery)\n            writeGAAnalytics(rootModel, initialTimestamp)\n          }\n\n          // TODO use UndoManager\n          // rootModel.setHistory(\n          //   UndoManager.create({}, { targetStore: rootModel.session }),\n          // )\n          pluginManager.setRootModel(rootModel)\n          pluginManager.configure()\n          setPluginManager(pluginManager)\n\n          // automatically clear password field once loaded\n          setPassword(undefined)\n        }\n      }\n    }, [\n      loader,\n      ready,\n      sessionError,\n      setPassword,\n      initialTimestamp,\n      initialSessionQuery,\n    ])\n\n    if (configError) {\n      return (\n        <div>\n          <NoConfigMessage />\n          {configError ? (\n            <div\n              style={{\n                border: '1px solid black',\n                padding: 2,\n                margin: 2,\n                backgroundColor: '#ff8888',\n              }}\n            >{`${configError}`}</div>\n          ) : null}\n        </div>\n      )\n    }\n\n    if (pm) {\n      if (!pm.rootModel?.session) {\n        return <StartScreen root={pm.rootModel} onFactoryReset={factoryReset} />\n      }\n      return <JBrowse pluginManager={pm} />\n    }\n    return <Loading />\n  },\n)\n\nfunction addRelativeUris(config: Config, configUri: URL) {\n  if (typeof config === 'object') {\n    for (const key of Object.keys(config)) {\n      if (typeof config[key] === 'object') {\n        addRelativeUris(config[key], configUri)\n      } else if (key === 'uri') {\n        config.baseUri = configUri.href\n      }\n    }\n  }\n}\n\nconst PlatformSpecificFatalErrorDialog = (props: unknown) => {\n  return (\n    <FatalErrorDialog\n      resetButtonText=\"Reset Session\"\n      onFactoryReset={factoryReset}\n      {...props}\n    />\n  )\n}\nexport default ({ initialTimestamp }: { initialTimestamp: number }) => {\n  return (\n    <ErrorBoundary FallbackComponent={PlatformSpecificFatalErrorDialog}>\n      <QueryParamProvider>\n        <Loader initialTimestamp={initialTimestamp} />\n      </QueryParamProvider>\n    </ErrorBoundary>\n  )\n}\n","/* eslint-disable no-underscore-dangle */\nimport {\n  isOptionalType,\n  isUnionType,\n  isArrayType,\n  isMapType,\n  isLateType,\n} from 'mobx-state-tree'\n\n/**\n * get the inner type of an MST optional, array, or late type object\n *\n * @param {IModelType} type\n * @returns {IModelType}\n */\nexport function getSubType(type) {\n  let t\n  if (isOptionalType(type)) {\n    t = type._subtype || type.type\n  } else if (isArrayType(type) || isMapType(type)) {\n    t = type._subtype || type._subType || type.subType\n  } else if (typeof type.getSubType === 'function') {\n    return type.getSubType()\n  } else {\n    throw new TypeError('unsupported mst type')\n  }\n  if (!t) {\n    // debugger\n    throw new Error('failed to get subtype')\n  }\n  return t\n}\n\n/**\n * get the array of\n * @param {MST Union Type obj} unionType\n * @returns {Array<IModelType>}\n */\nexport function getUnionSubTypes(unionType) {\n  if (!isUnionType(unionType)) throw new TypeError('not an MST union type')\n  const t =\n    unionType._types ||\n    unionType.types ||\n    getSubType(unionType)._types ||\n    getSubType(unionType).types\n  if (!t) {\n    // debugger\n    throw new Error('failed to extract subtypes from mst union')\n  }\n  return t\n}\n\n/**\n * get the type of one of the properties of the given MST model type\n *\n * @param {IModelType} type\n * @param {string} propertyName\n * @returns {IModelType}\n */\nexport function getPropertyType(type, propertyName) {\n  const propertyType = type.properties[propertyName]\n  return propertyType\n}\n\n/**\n * get the base type from inside an MST optional type\n * @param {*} type\n */\nexport function getDefaultValue(type) {\n  if (!isOptionalType(type)) {\n    throw new TypeError('type must be an optional type')\n  }\n  return type._defaultValue || type.defaultValue\n}\n\n/** get the string values of an MST enumeration type */\nexport function getEnumerationValues(type) {\n  const subtypes = getUnionSubTypes(type)\n  // the subtypes should all be literals with a value member\n  return subtypes.map(t => t.value)\n}\n\nexport function resolveLateType(maybeLate) {\n  if (\n    !isUnionType(maybeLate) &&\n    !isArrayType(maybeLate) &&\n    isLateType(maybeLate)\n  ) {\n    return maybeLate.getSubType()\n  }\n  return maybeLate\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types, IAnyModelType, IAnyComplexType } from 'mobx-state-tree'\nimport { stringToFunction, functionRegexp } from '../util/functionStrings'\nimport { inDevelopment } from '../util'\nimport { FileLocation } from '../util/types/mst'\n\nfunction isValidColorString(/* str */) {\n  // TODO: check all the crazy cases for whether it's a valid HTML/CSS color string\n  return true\n}\nconst typeModels: { [typeName: string]: any } = {\n  stringArray: types.array(types.string),\n  stringArrayMap: types.map(types.array(types.string)),\n  numberMap: types.map(types.number),\n  boolean: types.boolean,\n  color: types.refinement('Color', types.string, isValidColorString),\n  integer: types.integer,\n  number: types.number,\n  string: types.string,\n  text: types.string,\n  fileLocation: FileLocation,\n  frozen: types.frozen(),\n}\n\n// default values we use if the defaultValue is malformed or does not work\nconst fallbackDefaults: { [typeName: string]: any } = {\n  stringArray: [],\n  stringArrayMap: {},\n  numberMap: {},\n  boolean: true,\n  color: 'black',\n  integer: 1,\n  number: 1,\n  string: '',\n  text: '',\n  fileLocation: { uri: '/path/to/resource.txt' },\n  frozen: {},\n}\n\nconst literalJSON = (self: { value: any }) => ({\n  views: {\n    get valueJSON() {\n      return self.value\n    },\n  },\n})\n\nconst objectJSON = (self: { value: any }) => ({\n  views: {\n    get valueJSON() {\n      return JSON.stringify(self.value)\n    },\n  },\n})\n\n// custom actions for modifying the value models\nconst typeModelExtensions: { [typeName: string]: (self: any) => any } = {\n  fileLocation: objectJSON,\n  number: literalJSON,\n  integer: literalJSON,\n  boolean: literalJSON,\n  frozen: objectJSON,\n  // special actions for working with stringArray slots\n  stringArray: (self: { value: string[] }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(val: string) {\n        self.value.push(val)\n      },\n      removeAtIndex(idx: number) {\n        self.value.splice(idx, 1)\n      },\n      setAtIndex(idx: number, val: string) {\n        self.value[idx] = val\n      },\n    },\n  }),\n  stringArrayMap: (self: { value: Map<string, string[]> }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(key: string, val: any) {\n        self.value.set(key, val)\n      },\n      remove(key: string) {\n        self.value.delete(key)\n      },\n      addToKey(key: string, val: string) {\n        const ar = self.value.get(key)\n        if (!ar) throw new Error(`${key} not found`)\n        ar.push(val)\n      },\n      removeAtKeyIndex(key: string, idx: number) {\n        const ar = self.value.get(key)\n        if (!ar) throw new Error(`${key} not found`)\n        ar.splice(idx, 1)\n      },\n      setAtKeyIndex(key: string, idx: number, val: string) {\n        const ar = self.value.get(key)\n        if (!ar) throw new Error(`${key} not found`)\n        ar[idx] = val\n      },\n    },\n  }),\n  numberMap: (self: { value: Map<string, number> }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(key: string, val: number) {\n        self.value.set(key, val)\n      },\n      remove(key: string) {\n        self.value.delete(key)\n      },\n    },\n  }),\n}\n\nconst FunctionStringType = types.refinement(\n  'FunctionString',\n  types.string,\n  str => functionRegexp.test(str),\n)\n\nexport interface ConfigSlotDefinition {\n  description?: string\n  /** custom base MST model for the slot's value */\n  model?: IAnyModelType | IAnyComplexType\n  /** name of the type of slot, e.g. \"string\", \"number\", \"stringArray\" */\n  type: string\n  /** default value of the slot */\n  defaultValue: any\n  /** parameter names of the function callback */\n  functionSignature?: string[]\n}\n\n/**\n * builds a MST model for a configuration slot\n *\n * @param slotName -\n * @param  definition -\n */\nexport default function ConfigSlot(\n  slotName: string,\n  {\n    description = '',\n    model,\n    type,\n    defaultValue,\n    functionSignature = [],\n  }: ConfigSlotDefinition,\n) {\n  if (!type) throw new Error('type name required')\n  if (!model) model = typeModels[type]\n  if (!model) {\n    throw new Error(\n      `no builtin config slot type \"${type}\", and no 'model' param provided`,\n    )\n  }\n\n  if (defaultValue === undefined) throw new Error(\"no 'defaultValue' provided\")\n\n  // if the `type` is something like `color`, then the model name\n  // here will be `ColorConfigSlot`\n  const configSlotModelName = `${slotName\n    .charAt(0)\n    .toUpperCase()}${slotName.slice(1)}ConfigSlot`\n  let slot = types\n    .model(configSlotModelName, {\n      name: types.literal(slotName),\n      description: types.literal(description),\n      type: types.literal(type),\n      value: types.optional(\n        types.union(FunctionStringType, model),\n        defaultValue,\n      ),\n    })\n    .volatile(() => ({\n      functionSignature,\n    }))\n    .views(self => ({\n      get isCallback() {\n        return functionRegexp.test(String(self.value))\n      },\n    }))\n    .views(self => ({\n      get func() {\n        if (self.isCallback) {\n          // compile this as a function\n          return stringToFunction(String(self.value), {\n            verifyFunctionSignature: inDevelopment\n              ? functionSignature\n              : undefined,\n          })\n        }\n        return () => self.value\n      },\n\n      // JS representation of the value of this slot, suitable\n      // for embedding in either JSON or a JS function string.\n      // many of the data types override this in typeModelExtensions\n      get valueJSON(): any[] | Record<string, any> | string | undefined {\n        if (self.isCallback) return undefined\n        function json(value: { toJSON: Function } | any) {\n          if (value && value.toJSON) {\n            return value.toJSON()\n          }\n          return `'${value}'`\n        }\n        return json(self.value)\n      },\n    }))\n    .preProcessSnapshot(\n      val =>\n        typeof val === 'object' && val.name === slotName\n          ? val\n          : {\n              name: slotName,\n              description,\n              type,\n              value: val,\n            },\n      // ({\n      //   name: slotName,\n      //   description,\n      //   type,\n      //   value: val,\n      // }),\n    )\n    .postProcessSnapshot(snap => {\n      if (typeof snap.value === 'object')\n        return JSON.stringify(snap.value) !== JSON.stringify(defaultValue)\n          ? snap.value\n          : undefined\n      return snap.value !== defaultValue ? snap.value : undefined\n    })\n    .actions(self => ({\n      set(newVal: any) {\n        self.value = newVal\n      },\n      reset() {\n        self.value = defaultValue\n      },\n      convertToCallback() {\n        if (self.isCallback) return\n        self.value = `function(${self.functionSignature.join(', ')}) {\n  return ${self.valueJSON}\n}\n`\n      },\n      convertToValue() {\n        if (!self.isCallback) return\n        // try calling it with no arguments\n        try {\n          const funcResult = self.func()\n          if (funcResult !== undefined) {\n            self.value = funcResult\n            return\n          }\n        } catch (e) {\n          /* ignore */\n        }\n        self.value = defaultValue\n        // if it is still a callback (happens if the defaultValue is a callback),\n        // then use the last-resort fallback default\n        if (self.isCallback) {\n          if (!(type in fallbackDefaults)) {\n            throw new Error(`no fallbackDefault defined for type ${type}`)\n          }\n          self.value = fallbackDefaults[type]\n        }\n      },\n    }))\n\n  // if there are any type-specific extensions (views or actions)\n  //  to the slot, add those in\n  if (typeModelExtensions[type]) {\n    slot = slot.extend(typeModelExtensions[type])\n  }\n\n  const completeModel = types.optional(slot, {\n    name: slotName,\n    type,\n    description,\n    value: defaultValue,\n  })\n  const m = completeModel\n  Object.defineProperty(m, 'isJBrowseConfigurationSlot', { value: true })\n  return m\n}\n","import {\n  types,\n  isStateTreeNode,\n  Instance,\n  IAnyType,\n  isType,\n  isLateType,\n  SnapshotOut,\n  ModelPropertiesDeclaration,\n} from 'mobx-state-tree'\n\nimport { ElementId } from '../util/types/mst'\n\nimport ConfigSlot, { ConfigSlotDefinition } from './configurationSlot'\nimport { isConfigurationSchemaType } from './util'\n\nfunction isEmptyObject(thing: unknown) {\n  return (\n    typeof thing === 'object' &&\n    !Array.isArray(thing) &&\n    thing !== null &&\n    Object.keys(thing).length === 0\n  )\n}\n\nfunction isEmptyArray(thing: unknown) {\n  return Array.isArray(thing) && thing.length === 0\n}\n\nexport interface ConfigurationSchemaDefinition {\n  [n: string]:\n    | ConfigSlotDefinition\n    | ConfigurationSchemaDefinition\n    | string\n    | number\n    | IAnyType\n}\n\ninterface ConfigurationSchemaOptions {\n  explicitlyTyped?: boolean\n  explicitIdentifier?: string\n  implicitIdentifier?: string\n  baseConfiguration?: AnyConfigurationSchemaType\n\n  actions?: (self: unknown) => any // eslint-disable-line @typescript-eslint/no-explicit-any\n  views?: (self: unknown) => any // eslint-disable-line @typescript-eslint/no-explicit-any\n  extend?: (self: unknown) => any // eslint-disable-line @typescript-eslint/no-explicit-any\n  preProcessSnapshot?: (snapshot: {}) => {}\n}\n\nfunction preprocessConfigurationSchemaArguments(\n  modelName: string,\n  inputSchemaDefinition: ConfigurationSchemaDefinition,\n  inputOptions: ConfigurationSchemaOptions = {},\n) {\n  if (typeof modelName !== 'string') {\n    throw new Error(\n      'first arg must be string name of the model that this config schema goes with',\n    )\n  }\n\n  // if we have a base configuration schema that we are\n  // extending, grab the slot definitions from that\n  let schemaDefinition = inputSchemaDefinition\n  let options = inputOptions\n  if (\n    inputOptions.baseConfiguration &&\n    inputOptions.baseConfiguration.jbrowseSchemaDefinition\n  ) {\n    schemaDefinition = {\n      ...inputOptions.baseConfiguration.jbrowseSchemaDefinition,\n      ...schemaDefinition,\n    }\n    options = {\n      ...(inputOptions.baseConfiguration.jbrowseSchemaOptions || {}),\n      ...inputOptions,\n    }\n    delete options.baseConfiguration\n  }\n  return { schemaDefinition, options }\n}\n\nfunction makeConfigurationSchemaModel<\n  DEFINITION extends ConfigurationSchemaDefinition,\n  OPTIONS extends ConfigurationSchemaOptions\n>(modelName: string, schemaDefinition: DEFINITION, options: OPTIONS) {\n  // now assemble the MST model of the configuration schema\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const modelDefinition: Record<string, any> = {}\n  let identifier\n\n  if (options.explicitlyTyped) {\n    modelDefinition.type = types.optional(types.literal(modelName), modelName)\n  }\n\n  if (options.explicitIdentifier && options.implicitIdentifier)\n    throw new Error(\n      `Cannot have both explicit and implicit identifiers in ${modelName}`,\n    )\n  if (options.explicitIdentifier) {\n    if (typeof options.explicitIdentifier === 'string') {\n      modelDefinition[options.explicitIdentifier] = types.identifier\n      identifier = options.explicitIdentifier\n    } else {\n      modelDefinition.id = types.identifier\n      identifier = 'id'\n    }\n  } else if (options.implicitIdentifier) {\n    if (typeof options.implicitIdentifier === 'string') {\n      modelDefinition[options.implicitIdentifier] = ElementId\n      identifier = options.implicitIdentifier\n    } else {\n      modelDefinition.id = ElementId\n      identifier = 'id'\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const volatileConstants: Record<string, any> = {\n    isJBrowseConfigurationSchema: true,\n    jbrowseSchema: {\n      modelName,\n      definition: schemaDefinition,\n      options,\n    },\n  }\n  Object.entries(schemaDefinition).forEach(([slotName, slotDefinition]) => {\n    if (\n      (isType(slotDefinition) && isLateType(slotDefinition)) ||\n      isConfigurationSchemaType(slotDefinition)\n    ) {\n      // this is either an MST late() type (which we assume to be a sub-configuration),\n      // or an actual sub-configuration\n      modelDefinition[slotName] = slotDefinition\n    } else if (\n      typeof slotDefinition === 'string' ||\n      typeof slotDefinition === 'number'\n    ) {\n      volatileConstants[slotName] = slotDefinition\n    } else if (typeof slotDefinition === 'object') {\n      // this is a slot definition\n      if (!slotDefinition.type) {\n        throw new Error(`no type set for config slot ${modelName}.${slotName}`)\n      }\n      try {\n        modelDefinition[slotName] = ConfigSlot(\n          slotName,\n          slotDefinition as ConfigSlotDefinition,\n        )\n      } catch (e) {\n        throw new Error(\n          `invalid config slot definition for ${modelName}.${slotName}: ${e.message}`,\n        )\n      }\n    } else {\n      throw new Error(\n        `invalid configuration schema definition, \"${slotName}\" must be either a valid configuration slot definition, a constant, or a nested configuration schema`,\n      )\n    }\n  })\n\n  let completeModel = types\n    .model(`${modelName}ConfigurationSchema`, modelDefinition)\n    .actions(self => ({\n      setSubschema(\n        slotName: string,\n        data: ModelPropertiesDeclaration | AnyConfigurationSchemaType,\n      ) {\n        if (!isConfigurationSchemaType(modelDefinition[slotName])) {\n          throw new Error(`${slotName} is not a subschema, cannot replace`)\n        }\n        const newSchema = isStateTreeNode(data)\n          ? data\n          : modelDefinition[slotName].create(data)\n        self[slotName] = newSchema\n        return newSchema\n      },\n    }))\n\n  if (Object.keys(volatileConstants).length) {\n    completeModel = completeModel.volatile((/* self */) => volatileConstants)\n  }\n  if (options.actions) {\n    completeModel = completeModel.actions(options.actions)\n  }\n  if (options.views) {\n    completeModel = completeModel.views(options.views)\n  }\n  if (options.extend) {\n    completeModel = completeModel.extend(options.extend)\n  }\n  completeModel = completeModel.postProcessSnapshot(snap => {\n    const newSnap: SnapshotOut<typeof completeModel> = {}\n    // let keyCount = 0\n    Object.entries(snap).forEach(([key, value]) => {\n      if (\n        value !== undefined &&\n        volatileConstants[key] === undefined &&\n        !isEmptyObject(value) &&\n        !isEmptyArray(value)\n      ) {\n        // keyCount += 1\n        newSnap[key] = value\n      }\n    })\n    return newSnap\n  })\n\n  if (options.preProcessSnapshot) {\n    completeModel = completeModel.preProcessSnapshot(options.preProcessSnapshot)\n  }\n\n  const identifierDefault = identifier ? { [identifier]: 'placeholderId' } : {}\n  const schemaType = types.optional(\n    completeModel,\n    options.explicitlyTyped\n      ? { type: modelName, ...identifierDefault }\n      : identifierDefault,\n  )\n  return schemaType\n}\n\nexport interface AnyConfigurationSchemaType\n  extends ReturnType<typeof makeConfigurationSchemaModel> {\n  isJBrowseConfigurationSchema: boolean\n  jbrowseSchemaDefinition: ConfigurationSchemaDefinition\n  jbrowseSchemaOptions: ConfigurationSchemaOptions\n}\n\nexport type AnyConfigurationModel = Instance<AnyConfigurationSchemaType>\n\nexport type ConfigurationModel<\n  SCHEMA extends AnyConfigurationSchemaType\n> = Instance<SCHEMA>\n\nexport function ConfigurationSchema<\n  DEFINITION extends ConfigurationSchemaDefinition,\n  OPTIONS extends ConfigurationSchemaOptions\n>(\n  modelName: string,\n  inputSchemaDefinition: DEFINITION,\n  inputOptions?: OPTIONS,\n): AnyConfigurationSchemaType {\n  const { schemaDefinition, options } = preprocessConfigurationSchemaArguments(\n    modelName,\n    inputSchemaDefinition,\n    inputOptions,\n  )\n  const schemaType = makeConfigurationSchemaModel(\n    modelName,\n    schemaDefinition,\n    options,\n  ) as AnyConfigurationSchemaType\n  // saving a couple of jbrowse-specific things in the type object. hope nobody gets mad.\n  schemaType.isJBrowseConfigurationSchema = true\n  schemaType.jbrowseSchemaDefinition = schemaDefinition\n  schemaType.jbrowseSchemaOptions = options\n  return schemaType\n}\n\nexport function ConfigurationReference(schemaType: IAnyType) {\n  return types.union(types.reference(schemaType), schemaType)\n}\n","import {\n  isStateTreeNode,\n  Instance,\n  SnapshotOut,\n  SnapshotIn,\n  IAnyStateTreeNode,\n} from 'mobx-state-tree'\nimport PluginManager from '../../PluginManager'\nimport { AnyConfigurationModel } from '../../configuration/configurationSchema'\n\nimport assemblyManager from '../../assemblyManager'\nimport { MenuItem } from '../../ui'\nimport {\n  NoAssemblyRegion as MUNoAssemblyRegion,\n  Region as MUIRegion,\n  LocalPathLocation as MULocalPathLocation,\n  UriLocation as MUUriLocation,\n} from './mst'\nimport RpcManager from '../../rpc/RpcManager'\nimport { Feature } from '../simpleFeature'\n\nexport * from './util'\n\n/** abstract type for a model that contains multiple views */\nexport interface AbstractViewContainer {\n  views: AbstractViewModel[]\n  removeView(view: AbstractViewModel): void\n  addView(typeName: string, initialState: Record<string, unknown>): void\n}\nexport function isViewContainer(\n  thing: unknown,\n): thing is AbstractViewContainer {\n  return (\n    isStateTreeNode(thing) &&\n    'removeView' in thing &&\n    'addView' in thing &&\n    'views' in thing\n  )\n}\n\nexport type NotificationLevel = 'error' | 'info' | 'warning' | 'success'\n\nexport type AssemblyManager = Instance<ReturnType<typeof assemblyManager>>\n\n/** minimum interface that all session state models must implement */\nexport interface AbstractSessionModel extends AbstractViewContainer {\n  setSelection(feature: Feature): void\n  clearSelection(): void\n  configuration: AnyConfigurationModel\n  pluginManager: PluginManager\n  rpcManager: RpcManager\n  assemblyNames: string[]\n  assemblies: AnyConfigurationModel[]\n  selection?: unknown\n  duplicateCurrentSession?(): void\n  notify(message: string, level?: NotificationLevel): void\n  assemblyManager: AssemblyManager\n  version: string\n  getTrackActionMenuItems?: Function\n}\nexport function isSessionModel(thing: unknown): thing is AbstractSessionModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'pluginManager' in thing &&\n    'configuration' in thing\n  )\n}\n\n/** abstract interface for a session allows editing configurations */\nexport interface SessionWithConfigEditing extends AbstractSessionModel {\n  editConfiguration(configuration: AnyConfigurationModel): void\n}\nexport function isSessionModelWithConfigEditing(\n  thing: unknown,\n): thing is SessionWithConfigEditing {\n  return isSessionModel(thing) && 'editConfiguration' in thing\n}\n\n/** abstract interface for a session that manages widgets */\nexport interface SessionWithWidgets extends AbstractSessionModel {\n  visibleWidget?: { id: string }\n  widgets?: unknown[]\n  addWidget(\n    typeName: string,\n    id: string,\n    initialState?: Record<string, unknown>,\n    configuration?: { type: string },\n  ): void\n  showWidget(widget: unknown): void\n}\nexport function isSessionModelWithWidgets(\n  thing: unknown,\n): thing is SessionWithWidgets {\n  return isSessionModel(thing) && 'widgets' in thing\n}\n\n/** abstract interface for a session that manages a global selection */\nexport interface SelectionContainer extends AbstractSessionModel {\n  selection?: unknown\n  setSelection(thing: unknown): void\n}\nexport function isSelectionContainer(\n  thing: unknown,\n): thing is SelectionContainer {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'selection' in thing &&\n    'setSelection' in thing\n  )\n}\n\n/** minimum interface that all view state models must implement */\nexport interface AbstractViewModel {\n  id: string\n  type: string\n  width: number\n  setWidth(width: number): void\n}\nexport function isViewModel(thing: unknown): thing is AbstractViewModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'width' in thing &&\n    'setWidth' in thing\n  )\n}\nexport interface TrackViewModel extends AbstractViewModel {\n  showTrack(trackId: string): void\n  hideTrack(trackId: string): void\n}\nexport function isTrackViewModel(thing: unknown): thing is TrackViewModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'showTrack' in thing &&\n    'hideTrack' in thing\n  )\n}\n\n/** minimum interface for the root MST model of a JBrowse app */\nexport interface AbstractRootModel {\n  jbrowse: IAnyStateTreeNode\n  session?: AbstractSessionModel\n  setDefaultSession?(): void\n  adminMode?: boolean\n}\n\n/** a root model that manages global menus */\nexport interface AbstractMenuManager {\n  appendMenu(menuName: string): void\n  insertMenu(menuName: string, position: number): number\n  insertInMenu(menuName: string, menuItem: MenuItem, position: number): number\n  appendToMenu(menuName: string, menuItem: MenuItem): number\n  appendToSubMenu(menuPath: string[], menuItem: MenuItem): number\n  insertInSubMenu(\n    menuPath: string[],\n    menuItem: MenuItem,\n    position: number,\n  ): number\n}\nexport function isAbstractMenuManager(\n  thing: unknown,\n): thing is AbstractMenuManager {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'appendMenu' in thing &&\n    'appendToSubMenu' in thing\n  )\n}\n\n// Empty interfaces required by mobx-state-tree\n// See https://mobx-state-tree.js.org/tips/typescript#using-a-mst-type-at-design-time\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\nexport interface NoAssemblyRegion\n  extends SnapshotIn<typeof MUNoAssemblyRegion> {}\n\nexport interface Region extends SnapshotIn<typeof MUIRegion> {}\n\nexport interface LocalPathLocation\n  extends SnapshotOut<typeof MULocalPathLocation> {}\n\nexport interface UriLocation extends SnapshotIn<typeof MUUriLocation> {}\n\nexport interface BlobLocation {\n  blob: Blob\n}\n\nexport type FileLocation = LocalPathLocation | UriLocation | BlobLocation\n\n/* eslint-enable @typescript-eslint/no-empty-interface */\n","export const functionRegexp = /^\\s*function\\s*\\w*\\s*\\(([^)]*)\\)\\s*{([\\w\\W]*)/\n\nconst compilationCache: Record<string, Function> = {}\n\n/**\n * compile a function to a string\n *\n * @param str - string of code like `function() { ... }`\n * @param options -\n */\nexport function stringToFunction(\n  str: string,\n  options: {\n    /**\n     * if passed, the compiled function will check at runtime that the proper\n     * number of arguments were passed to it\n     */\n    verifyFunctionSignature?: string[]\n    /**\n     * if passed, the compiled function will be bound (by calling bind on it)\n     * with the given context and arguments\n     */\n    bind?: any[] // eslint-disable-line @typescript-eslint/no-explicit-any\n  } = {},\n) {\n  const { verifyFunctionSignature } = options\n\n  const cacheKey = `${\n    verifyFunctionSignature ? verifyFunctionSignature.join(',') : 'nosig'\n  }|${str}`\n  if (!compilationCache[cacheKey]) {\n    const match = functionRegexp.exec(str)\n    if (!match) {\n      throw new Error('string does not appear to be a function declaration')\n    }\n    const paramList = match[1].split(',').map(s => s.trim())\n    let code = match[2].replace(/}\\s*$/, '')\n    if (verifyFunctionSignature) {\n      // check number of arguments passed by calling code at runtime.\n      // NOTE: we don't check the number of arguments in the callback code itself,\n      // callback authors are free to ignore the arguments if they want\n\n      code = `if (arguments.length !== ${\n        verifyFunctionSignature.length\n      }) throw new Error(\"incorrect number of arguments provided to callback.  function signature is (${verifyFunctionSignature.join(\n        ', ',\n      )}) but \"+arguments.length+\" arguments were passed\");\\n${code}`\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-implied-eval, no-new-func\n    const compiled = new Function(...paramList, `\"use strict\"; ${code}`)\n    compilationCache[cacheKey] = compiled\n  }\n\n  let func = compilationCache[cacheKey]\n  if (options.bind) {\n    const [thisArg, ...rest] = options.bind\n    func = func.bind(thisArg, ...rest)\n  }\n  return func\n}\n","import { Observable, fromEvent } from 'rxjs'\n\nclass AbortError extends Error {\n  public code: string | undefined\n}\n\n/**\n * properly check if the given AbortSignal is aborted.\n * per the standard, if the signal reads as aborted,\n * this function throws either a DOMException AbortError, or a regular error\n * with a `code` attribute set to `ERR_ABORTED`.\n *\n * for convenience, passing `undefined` is a no-op\n *\n * @param signal -\n * @returns nothing\n */\nexport function checkAbortSignal(signal?: AbortSignal): void {\n  if (!signal) return\n\n  if (!(signal instanceof AbortSignal)) {\n    throw new TypeError('must pass an AbortSignal')\n  }\n\n  if (signal.aborted) {\n    // eslint-disable-next-line @typescript-eslint/no-throw-literal\n    throw makeAbortError()\n  }\n}\n\nexport function makeAbortError() {\n  if (typeof DOMException !== 'undefined') {\n    return new DOMException('aborted', 'AbortError')\n  }\n  const e = new AbortError('aborted')\n  e.code = 'ERR_ABORTED'\n  return e\n}\n\nexport function observeAbortSignal(signal?: AbortSignal): Observable<Event> {\n  if (!signal) return Observable.create()\n  return fromEvent(signal, 'abort')\n}\n\n/**\n * check if the given exception was caused by an operation being intentionally aborted\n * @param exception -\n */\nexport function isAbortException(exception: Error): boolean {\n  return (\n    // DOMException\n    exception.name === 'AbortError' ||\n    // standard-ish non-DOM abort exception\n    (exception as AbortError).code === 'ERR_ABORTED' ||\n    // message contains aborted for bubbling through RPC\n    // things we have seen that we want to catch here\n    // Error: aborted\n    // AbortError: aborted\n    // AbortError: The user aborted a request.\n    !!exception.message.match(/\\b(aborted|AbortError)\\b/i)\n  )\n}\n","import {\n  isStateTreeNode,\n  getSnapshot,\n  getType,\n  isMapType,\n  isType,\n  isUnionType,\n  isOptionalType,\n  isArrayType,\n  isModelType,\n  isLateType,\n} from 'mobx-state-tree'\n\nimport {\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n} from './configurationSchema'\nimport {\n  getUnionSubTypes,\n  getDefaultValue,\n  getSubType,\n  resolveLateType,\n} from '../util/mst-reflection'\n\n/**\n * given a configuration model (an instance of a ConfigurationSchema),\n * read the configuration variable at the given path\n *\n * @param model - instance of ConfigurationSchema\n * @param slotPaths - array of paths to read\n * @param args - extra arguments e.g. for a feature callback,\n *  will be sent to each of the slotNames\n */\nexport function readConfObject(\n  confObject: AnyConfigurationModel,\n  slotPath: string[] | string | undefined = undefined,\n  args: unknown[] = [],\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n): any {\n  if (!confObject) throw new TypeError('must provide conf object to read')\n  if (!slotPath) return getSnapshot(confObject)\n  if (typeof slotPath === 'string') {\n    let slot = confObject[slotPath]\n    // check for the subconf being a map if we don't find it immediately\n    if (\n      !slot &&\n      isStateTreeNode(confObject) &&\n      isMapType(getType(confObject))\n    ) {\n      slot = confObject.get(slotPath)\n    }\n    if (!slot) {\n      return undefined\n      // if we want to be very strict about config slots, we could uncomment the below\n      // instead of returning undefine\n      //\n      // const modelType = getType(model)\n      // const schemaType = model.configuration && getType(model.configuration)\n      // throw new Error(\n      //   `no slot \"${slotName}\" found in ${modelType.name} configuration (${\n      //     schemaType.name\n      //   })`,\n      // )\n    }\n    if (slot.func) {\n      const appliedFunc = slot.func.apply(null, args)\n      if (isStateTreeNode(appliedFunc)) return getSnapshot(appliedFunc)\n      return appliedFunc\n    }\n    if (isStateTreeNode(slot)) return getSnapshot(slot)\n    return slot\n  }\n\n  const slotName = slotPath[0]\n  if (slotPath.length > 1) {\n    const newPath = slotPath.slice(1)\n    let subConf = confObject[slotName]\n    // check for the subconf being a map if we don't find it immediately\n    if (\n      !subConf &&\n      isStateTreeNode(confObject) &&\n      isMapType(getType(confObject))\n    ) {\n      subConf = confObject.get(slotName)\n    }\n    if (!subConf) {\n      return undefined\n    }\n    return readConfObject(subConf, newPath, args)\n  }\n  return readConfObject(confObject, slotName, args)\n}\n\n/**\n * helper method for readConfObject, reads the config from a mst model\n *\n * @param model - object containing a 'configuration' member\n * @param slotPaths - array of paths to read\n * @param args - extra arguments e.g. for a feature callback,\n *   will be sent to each of the slotNames\n */\nexport function getConf(\n  model: unknown,\n  slotPath: string[] | string | undefined = undefined,\n  args: unknown[] = [],\n) {\n  if (!model) throw new TypeError('must provide a model object')\n  const { configuration } = model as { configuration: unknown }\n  if (isConfigurationModel(configuration)) {\n    return readConfObject(configuration, slotPath, args)\n  }\n  throw new TypeError('cannot getConf on this model, it has no configuration')\n}\n\n/**\n * given a union of explicitly typed configuration schema types,\n * extract an array of the type names contained in the union\n *\n * @param unionType -\n * @returns Array of type names contained in the union\n */\nexport function getTypeNamesFromExplicitlyTypedUnion(maybeUnionType: unknown) {\n  if (isType(maybeUnionType)) {\n    maybeUnionType = resolveLateType(maybeUnionType)\n    // @ts-ignore\n    if (isUnionType(maybeUnionType)) {\n      const typeNames: string[] = []\n      getUnionSubTypes(maybeUnionType).forEach(type => {\n        type = resolveLateType(type)\n        let typeName = getTypeNamesFromExplicitlyTypedUnion(type)\n        if (!typeName.length) {\n          const def = getDefaultValue(type)\n          typeName = [def.type]\n        }\n        if (!typeName[0]) {\n          // debugger\n          throw new Error(`invalid config schema type ${type}`)\n        }\n        typeNames.push(...typeName)\n      })\n      return typeNames\n    }\n  }\n  return []\n}\n\nexport function isBareConfigurationSchemaType(\n  thing: unknown,\n): thing is AnyConfigurationSchemaType {\n  if (isType(thing)) {\n    if (\n      isModelType(thing) &&\n      ('isJBrowseConfigurationSchema' in thing ||\n        thing.name.includes('ConfigurationSchema'))\n    ) {\n      return true\n    }\n    // if it's a late type, assume its a config schema\n    if (isLateType(thing)) return true\n  }\n  return false\n}\n\nexport function isConfigurationSchemaType(thing: unknown): boolean {\n  if (!isType(thing)) return false\n\n  // written as a series of if-statements instead of a big logical OR\n  // because this construction gives much better debugging backtraces.\n\n  // also, note that the order of these statements matters, because\n  // for example some union types are also optional types\n\n  if (isBareConfigurationSchemaType(thing)) return true\n\n  if (isUnionType(thing)) {\n    return getUnionSubTypes(thing).every(\n      t => isConfigurationSchemaType(t) || t.name === 'undefined',\n    )\n  }\n\n  if (isOptionalType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  }\n\n  if (isArrayType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  }\n\n  if (isMapType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  }\n\n  return false\n}\n\nexport function isConfigurationModel(\n  thing: unknown,\n): thing is AnyConfigurationModel {\n  return isStateTreeNode(thing) && isConfigurationSchemaType(getType(thing))\n}\n\nexport function isConfigurationSlotType(thing: unknown) {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'isJBrowseConfigurationSlot' in thing\n  )\n}\n","export {\n  ConfigurationSchema,\n  ConfigurationReference,\n} from './configurationSchema'\n\nexport * from './util'\n","import { toByteArray, fromByteArray } from 'base64-js'\nimport {\n  getParent,\n  isAlive,\n  IAnyStateTreeNode,\n  getSnapshot,\n  hasParent,\n  addDisposer,\n  isStateTreeNode,\n} from 'mobx-state-tree'\nimport { reaction, IReactionPublic, IReactionOptions } from 'mobx'\nimport { inflate, deflate } from 'pako'\nimport fromEntries from 'object.fromentries'\nimport { useEffect, useRef, useState } from 'react'\nimport merge from 'deepmerge'\nimport { Feature } from './simpleFeature'\nimport {\n  TypeTestedByPredicate,\n  isSessionModel,\n  isViewModel,\n  Region,\n  AssemblyManager,\n} from './types'\nimport { isAbortException, checkAbortSignal } from './aborting'\n\nexport * from './types'\nexport * from './aborting'\nexport * from './when'\n\nif (!Object.fromEntries) {\n  // @ts-ignore\n  fromEntries.shim()\n}\n\nexport const inDevelopment =\n  typeof process === 'object' &&\n  process.env &&\n  process.env.NODE_ENV === 'development'\nexport const inProduction = !inDevelopment\n\n/**\n * Compress and encode a string as url-safe base64\n * See {@link https://en.wikipedia.org/wiki/Base64#URL_applications}\n * @param str-  a string to compress and encode\n */\nexport function toUrlSafeB64(str: string): string {\n  const bytes = new TextEncoder().encode(str)\n  const deflated = deflate(bytes)\n  const encoded = fromByteArray(deflated)\n  const pos = encoded.indexOf('=')\n  return pos > 0\n    ? encoded.slice(0, pos).replace(/\\+/g, '-').replace(/\\//g, '_')\n    : encoded.replace(/\\+/g, '-').replace(/\\//g, '_')\n}\n\n/**\n * Decode and inflate a url-safe base64 to a string\n * See {@link https://en.wikipedia.org/wiki/Base64#URL_applications}\n * @param b64 - a base64 string to decode and inflate\n */\nexport function fromUrlSafeB64(b64: string): string {\n  const originalB64 = b64PadSuffix(b64.replace(/-/g, '+').replace(/_/g, '/'))\n  const bytes = toByteArray(originalB64)\n  const inflated = inflate(bytes)\n  return new TextDecoder().decode(inflated)\n}\n\n/**\n * Pad the end of a base64 string with \"=\" to make it valid\n * @param b64 - unpadded b64 string\n */\nfunction b64PadSuffix(b64: string): string {\n  let num = 0\n  const mo = b64.length % 4\n  switch (mo) {\n    case 3:\n      num = 1\n      break\n    case 2:\n      num = 2\n      break\n    case 0:\n      num = 0\n      break\n    default:\n      throw new Error('base64 not a valid length')\n  }\n  return b64 + '='.repeat(num)\n}\n\nexport function useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState(value)\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedValue(value)\n    }, delay)\n    return () => {\n      clearTimeout(handler)\n    }\n  }, [value, delay])\n\n  return debouncedValue\n}\n\n// https://stackoverflow.com/questions/56283920/how-to-debounce-a-callback-in-functional-component-using-hooks\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function useDebouncedCallback<A extends any[]>(\n  callback: (...args: A) => void,\n  wait = 400,\n) {\n  // track args & timeout handle between calls\n  const argsRef = useRef<A>()\n  const timeout = useRef<ReturnType<typeof setTimeout>>()\n\n  function cleanup() {\n    if (timeout.current) {\n      clearTimeout(timeout.current)\n    }\n  }\n\n  // make sure our timeout gets cleared if our consuming component gets unmounted\n  useEffect(() => cleanup, [])\n\n  return function debouncedCallback(...args: A) {\n    // capture latest args\n    argsRef.current = args\n\n    // clear debounce timer\n    cleanup()\n\n    // start waiting again\n    timeout.current = setTimeout(() => {\n      if (argsRef.current) {\n        callback(...argsRef.current)\n      }\n    }, wait)\n  }\n}\n\n/** find the first node in the hierarchy that matches the given predicate */\nexport function findParentThat(\n  node: IAnyStateTreeNode,\n  predicate: (thing: IAnyStateTreeNode) => boolean,\n) {\n  let currentNode: IAnyStateTreeNode | undefined = node\n  while (currentNode && isAlive(currentNode)) {\n    if (predicate(currentNode)) return currentNode\n    if (hasParent(currentNode)) currentNode = getParent(currentNode)\n    else break\n  }\n  throw new Error('no matching node found')\n}\n\ninterface Animation {\n  lastPosition: number\n  lastTime?: number\n  lastVelocity?: number\n}\n\n// based on https://github.com/react-spring/react-spring/blob/cd5548a987383b8023efd620f3726a981f9e18ea/src/animated/FrameLoop.ts\nexport function springAnimate(\n  fromValue: number,\n  toValue: number,\n  setValue: (value: number) => void,\n  onFinish = () => {},\n  precision = 0,\n  tension = 170,\n  friction = 26,\n) {\n  const mass = 1\n  if (!precision) {\n    precision = Math.abs(toValue - fromValue) / 1000\n  }\n\n  let animationFrameId: number\n\n  function update(animation: Animation) {\n    const time = Date.now()\n    let position = animation.lastPosition\n    let lastTime = animation.lastTime || time\n    let velocity = animation.lastVelocity || 0\n    // If we lost a lot of frames just jump to the end.\n    if (time > lastTime + 64) {\n      lastTime = time\n    }\n    // http://gafferongames.com/game-physics/fix-your-timestep/\n    const numSteps = Math.floor(time - lastTime)\n    for (let i = 0; i < numSteps; ++i) {\n      const force = -tension * (position - toValue)\n      const damping = -friction * velocity\n      const acceleration = (force + damping) / mass\n      velocity += (acceleration * 1) / 1000\n      position += (velocity * 1) / 1000\n    }\n    const isVelocity = Math.abs(velocity) <= precision\n    const isDisplacement =\n      tension !== 0 ? Math.abs(toValue - position) <= precision : true\n    const endOfAnimation = isVelocity && isDisplacement\n    if (endOfAnimation) {\n      setValue(toValue)\n      onFinish()\n    } else {\n      setValue(position)\n      animationFrameId = requestAnimationFrame(() =>\n        update({\n          lastPosition: position,\n          lastTime: time,\n          lastVelocity: velocity,\n        }),\n      )\n    }\n  }\n\n  return [\n    () => update({ lastPosition: fromValue }),\n    () => cancelAnimationFrame(animationFrameId),\n  ]\n}\n\n/** find the first node in the hierarchy that matches the given 'is' typescript type guard predicate */\nexport function findParentThatIs<\n  PREDICATE extends (thing: IAnyStateTreeNode) => boolean\n>(\n  node: IAnyStateTreeNode,\n  predicate: PREDICATE,\n): TypeTestedByPredicate<PREDICATE> & IAnyStateTreeNode {\n  return findParentThat(node, predicate) as TypeTestedByPredicate<PREDICATE> &\n    IAnyStateTreeNode\n}\n\n/** get the current JBrowse session model, starting at any node in the state tree */\nexport function getSession(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isSessionModel)\n  } catch (e) {\n    throw new Error('no session model found!')\n  }\n}\n\n/** get the state model of the view in the state tree that contains the given node */\nexport function getContainingView(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isViewModel)\n  } catch (e) {\n    throw new Error('no containing view found')\n  }\n}\n\n/**\n * Assemble a 1-based \"locString\" from an interbase genomic location\n * @param region - Region\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0, end: 100 })\n * //  'chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ assemblyName: 'hg19', refName: 'chr1', start: 0, end: 100 })\n * //  '{hg19}chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1' })\n * //  'chr1'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0 })\n * //  'chr1:1..'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', end: 100 })\n * //  'chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0, end: 1 })\n * //  'chr1:1'\n * ```\n */\nexport function assembleLocString(region: ParsedLocString): string {\n  const { assemblyName, refName, start, end } = region\n  const assemblyNameString = assemblyName ? `{${assemblyName}}` : ''\n  let startString\n  if (start !== undefined) {\n    startString = `:${(start + 1).toLocaleString('en-US')}`\n  } else if (end !== undefined) {\n    startString = ':1'\n  } else {\n    startString = ''\n  }\n  let endString\n  if (end !== undefined) {\n    endString =\n      start !== undefined && start + 1 === end\n        ? ''\n        : `..${end.toLocaleString('en-US')}`\n  } else {\n    endString = start !== undefined ? '..' : ''\n  }\n  return `${assemblyNameString}${refName}${startString}${endString}`\n}\n\nexport interface ParsedLocString {\n  assemblyName?: string\n  refName: string\n  start?: number\n  end?: number\n}\n\nexport function parseLocStringOneBased(\n  locString: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n): ParsedLocString {\n  if (!locString) {\n    throw new Error('no location string provided, could not parse')\n  }\n  // remove any whitespace\n  locString = locString.replace(/\\s/, '')\n  // refNames can have colons :(\n  // https://samtools.github.io/hts-specs/SAMv1.pdf Appendix A\n  const assemblyMatch = locString.match(/(\\{(.+)\\})?(.+)/)\n  if (!assemblyMatch) {\n    throw new Error(`invalid location string: \"${locString}\"`)\n  }\n  const [, , assemblyName, location] = assemblyMatch\n  const lastColonIdx = location.lastIndexOf(':')\n  if (lastColonIdx === -1) {\n    if (isValidRefName(location, assemblyName)) {\n      return { assemblyName, refName: location }\n    }\n    throw new Error(`Unknown reference sequence \"${location}\"`)\n  }\n  const prefix = location.slice(0, lastColonIdx)\n  const suffix = location.slice(lastColonIdx + 1)\n  if (\n    isValidRefName(prefix, assemblyName) &&\n    isValidRefName(location, assemblyName)\n  ) {\n    throw new Error(`ambiguous location string: \"${locString}\"`)\n  } else if (isValidRefName(prefix, assemblyName)) {\n    if (suffix) {\n      // see if it's a range\n      const rangeMatch = suffix.match(\n        /^(-?(\\d+|\\d{1,3}(,\\d{3})*))(\\.\\.|-)(-?(\\d+|\\d{1,3}(,\\d{3})*))$/,\n      )\n      // see if it's a single point\n      const singleMatch = suffix.match(/^(-?(\\d+|\\d{1,3}(,\\d{3})*))(\\.\\.|-)?$/)\n      if (rangeMatch) {\n        const [, start, , , , end] = rangeMatch\n        if (start !== undefined && end !== undefined) {\n          return {\n            assemblyName,\n            refName: prefix,\n            start: +start.replace(/,/g, ''),\n            end: +end.replace(/,/g, ''),\n          }\n        }\n      } else if (singleMatch) {\n        const [, start, , , separator] = singleMatch\n        if (start !== undefined) {\n          if (separator) {\n            // indefinite end\n            return {\n              assemblyName,\n              refName: prefix,\n              start: +start.replace(/,/g, ''),\n            }\n          }\n          return {\n            assemblyName,\n            refName: prefix,\n            start: +start.replace(/,/g, ''),\n            end: +start.replace(/,/g, ''),\n          }\n        }\n      } else {\n        throw new Error(\n          `could not parse range \"${suffix}\" on location \"${locString}\"`,\n        )\n      }\n    } else {\n      return { assemblyName, refName: prefix }\n    }\n  } else if (isValidRefName(location, assemblyName)) {\n    return { assemblyName, refName: location }\n  }\n  throw new Error(`unknown reference sequence name in location \"${locString}\"`)\n}\n\n/**\n * Parse a 1-based location string into an interbase genomic location\n * @param locString - Location string\n * @param isValidRefName - Function that checks if a refName exists in the set\n * of all known refNames, or in the set of refNames for an assembly if\n * assemblyName is given\n * @example\n * ```ts\n * parseLocString('chr1:1..100', isValidRefName)\n * //  { refName: 'chr1', start: 0, end: 100 }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1:1-100', isValidRefName)\n * //  { refName: 'chr1', start: 0, end: 100 }\n * ```\n * @example\n * ```ts\n * parseLocString(`{hg19}chr1:1..100`, isValidRefName)\n * //  { assemblyName: 'hg19', refName: 'chr1', start: 0, end: 100 }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1', isValidRefName)\n * //  { refName: 'chr1' }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1:1', isValidRefName)\n * //  { refName: 'chr1', start: 0, end: 1 }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1:1..', isValidRefName)\n * //  { refName: 'chr1', start: 0}\n * ```\n */\nexport function parseLocString(\n  locString: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n) {\n  const parsed = parseLocStringOneBased(locString, isValidRefName)\n  if (typeof parsed.start === 'number') {\n    parsed.start -= 1\n  }\n  return parsed\n}\n\nexport function compareLocs(locA: ParsedLocString, locB: ParsedLocString) {\n  const assemblyComp =\n    locA.assemblyName || locB.assemblyName\n      ? (locA.assemblyName || '').localeCompare(locB.assemblyName || '')\n      : 0\n  if (assemblyComp) return assemblyComp\n\n  const refComp =\n    locA.refName || locB.refName\n      ? (locA.refName || '').localeCompare(locB.refName || '')\n      : 0\n  if (refComp) return refComp\n\n  if (locA.start !== undefined && locB.start !== undefined) {\n    const startComp = locA.start - locB.start\n    if (startComp) return startComp\n  }\n  if (locA.end !== undefined && locB.end !== undefined) {\n    const endComp = locA.end - locB.end\n    if (endComp) return endComp\n  }\n  return 0\n}\n\nexport function compareLocStrings(\n  a: string,\n  b: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n) {\n  const locA = parseLocString(a, isValidRefName)\n  const locB = parseLocString(b, isValidRefName)\n  return compareLocs(locA, locB)\n}\n\n/**\n * Ensure that a number is at least min and at most max.\n *\n * @param num -\n * @param min -\n * @param  max -\n */\nexport function clamp(num: number, min: number, max: number): number {\n  if (num < min) return min\n  if (num > max) return max\n  return num\n}\n\nfunction roundToNearestPointOne(num: number): number {\n  return Math.round(num * 10) / 10\n}\n\n/**\n * @param bp -\n * @param region -\n * @param bpPerPx -\n */\nexport function bpToPx(\n  bp: number,\n  region: { start: number; end: number; reversed?: boolean },\n  bpPerPx: number,\n): number {\n  if (region.reversed) {\n    return roundToNearestPointOne((region.end - bp) / bpPerPx)\n  }\n  return roundToNearestPointOne((bp - region.start) / bpPerPx)\n}\n\nconst oneEightyOverPi = 180.0 / Math.PI\nconst piOverOneEighty = Math.PI / 180.0\nexport function radToDeg(radians: number): number {\n  return (radians * oneEightyOverPi) % 360\n}\nexport function degToRad(degrees: number): number {\n  return (degrees * piOverOneEighty) % (2 * Math.PI)\n}\n\n/**\n * @returns [x, y]\n */\nexport function polarToCartesian(rho: number, theta: number): [number, number] {\n  return [rho * Math.cos(theta), rho * Math.sin(theta)]\n}\n\n/**\n * @param x - the x\n * @param y - the y\n * @returns [rho, theta]\n */\nexport function cartesianToPolar(x: number, y: number): [number, number] {\n  const rho = Math.sqrt(x * x + y * y)\n  const theta = Math.atan(y / x)\n  return [rho, theta]\n}\n\nexport function featureSpanPx(\n  feature: Feature,\n  region: { start: number; end: number; reversed?: boolean },\n  bpPerPx: number,\n): [number, number] {\n  return bpSpanPx(feature.get('start'), feature.get('end'), region, bpPerPx)\n}\n\nexport function bpSpanPx(\n  leftBp: number,\n  rightBp: number,\n  region: { start: number; end: number; reversed?: boolean },\n  bpPerPx: number,\n): [number, number] {\n  const start = bpToPx(leftBp, region, bpPerPx)\n  const end = bpToPx(rightBp, region, bpPerPx)\n  return region.reversed ? [end, start] : [start, end]\n}\n\nexport const objectFromEntries = Object.fromEntries.bind(Object)\n\n// do an array map of an iterable\nexport function iterMap<T, U>(\n  iterable: Iterable<T>,\n  func: (item: T) => U,\n  sizeHint?: number,\n): U[] {\n  const results = sizeHint ? new Array(sizeHint) : []\n  let counter = 0\n  for (const item of iterable) {\n    results[counter] = func(item)\n    counter += 1\n  }\n  return results\n}\n\ninterface Assembly {\n  name: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any\n}\ninterface Track {\n  trackId: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any\n}\ninterface Config {\n  savedSessions: unknown[]\n  assemblies: Assembly[]\n  tracks: Track[]\n  defaultSession?: {}\n}\n// similar to electron.js\nexport function mergeConfigs(A: Config, B: Config) {\n  const merged = merge(A, B)\n  if (B.defaultSession) merged.defaultSession = B.defaultSession\n  else if (A.defaultSession) merged.defaultSession = A.defaultSession\n  return merged\n}\n\n// https://stackoverflow.com/a/53187807\n/**\n * Returns the index of the last element in the array where predicate is true,\n * and -1 otherwise.\n * @param array - The source array to search in\n * @param predicate - find calls predicate once for each element of the array, in\n * descending order, until it finds one where predicate returns true. If such an\n * element is found, findLastIndex immediately returns that element index.\n * Otherwise, findLastIndex returns -1.\n */\nexport function findLastIndex<T>(\n  array: Array<T>,\n  predicate: (value: T, index: number, obj: T[]) => boolean,\n): number {\n  let l = array.length\n  while (l--) {\n    if (predicate(array[l], l, array)) {\n      return l\n    }\n  }\n  return -1\n}\n\n/**\n * makes a mobx reaction with the given functions, that calls actions on the\n * model for each stage of execution, and to abort the reaction function when\n * the model is destroyed.\n *\n * Will call startedFunction(signal), successFunction(result), and\n * errorFunction(error) when the async reaction function starts, completes, and\n * errors respectively.\n *\n * @param self -\n * @param dataFunction -\n * @param asyncReactionFunction -\n * @param reactionOptions -\n * @param startedFunction -\n * @param successFunction -\n * @param errorFunction -\n */\nexport function makeAbortableReaction<T, U, V>(\n  self: T,\n  dataFunction: (arg: T) => U,\n  asyncReactionFunction: (\n    arg: U | undefined,\n    signal: AbortSignal,\n    model: T,\n    handle: IReactionPublic,\n  ) => Promise<V>,\n  reactionOptions: IReactionOptions,\n  startedFunction: (aborter: AbortController) => void,\n  successFunction: (arg: V) => void,\n  errorFunction: (err: Error) => void,\n) {\n  let inProgress: AbortController | undefined\n\n  function handleError(error: Error) {\n    if (!isAbortException(error)) {\n      if (isAlive(self)) {\n        errorFunction(error)\n      } else {\n        console.error(error)\n      }\n    }\n  }\n\n  const reactionDisposer = reaction(\n    () => {\n      try {\n        return dataFunction(self)\n      } catch (error) {\n        handleError(error)\n        return undefined\n      }\n    },\n    async (data, mobxReactionHandle) => {\n      if (inProgress && !inProgress.signal.aborted) {\n        inProgress.abort()\n      }\n\n      if (!isAlive(self)) {\n        return\n      }\n      inProgress = new AbortController()\n\n      const thisInProgress = inProgress\n      startedFunction(thisInProgress)\n      try {\n        const result = await asyncReactionFunction(\n          data,\n          thisInProgress.signal,\n          self,\n          mobxReactionHandle,\n        )\n        checkAbortSignal(thisInProgress.signal)\n        if (isAlive(self)) {\n          successFunction(result)\n        }\n      } catch (error) {\n        if (thisInProgress && !thisInProgress.signal.aborted)\n          thisInProgress.abort()\n        handleError(error)\n      }\n    },\n    reactionOptions,\n  )\n\n  addDisposer(self, reactionDisposer)\n  addDisposer(self, () => {\n    if (inProgress && !inProgress.signal.aborted) {\n      inProgress.abort()\n    }\n  })\n}\n\nexport function renameRegionIfNeeded(\n  refNameMap: Record<string, string>,\n  region: Region,\n): Region & { originalRefName?: string } {\n  if (isStateTreeNode(region) && !isAlive(region)) {\n    return region\n  }\n  if (region && refNameMap && refNameMap[region.refName]) {\n    // clone the region so we don't modify it\n    if (isStateTreeNode(region)) {\n      region = { ...getSnapshot(region) }\n    } else {\n      region = { ...region }\n    }\n\n    // modify it directly in the container\n    const newRef = refNameMap[region.refName]\n    if (newRef) {\n      return { ...region, refName: newRef, originalRefName: region.refName }\n    }\n  }\n  return region\n}\n\nexport async function renameRegionsIfNeeded<\n  ARGTYPE extends {\n    assemblyName?: string\n    regions?: Region[]\n    signal?: AbortSignal\n    adapterConfig: unknown\n    sessionId: string\n    statusCallback?: Function\n  }\n>(assemblyManager: AssemblyManager, args: ARGTYPE) {\n  const { assemblyName, regions, adapterConfig } = args\n  if (!args.sessionId) {\n    throw new Error('sessionId is required')\n  }\n  const newArgs: ARGTYPE = {\n    ...args,\n    regions: [...(args.regions || [])],\n  }\n  if (assemblyName) {\n    const refNameMap = await assemblyManager.getRefNameMapForAdapter(\n      adapterConfig,\n      assemblyName,\n      newArgs,\n    )\n\n    // console.log(`${JSON.stringify(regions)} ${JSON.stringify(refNameMap)}`)\n    if (refNameMap && regions && newArgs.regions) {\n      for (let i = 0; i < regions.length; i += 1) {\n        newArgs.regions[i] = renameRegionIfNeeded(refNameMap, regions[i])\n      }\n    }\n  }\n  return newArgs\n}\n\nexport function minmax(a: number, b: number) {\n  return [Math.min(a, b), Math.max(a, b)]\n}\n\nexport function stringify(offset: { coord: number; refName: string }) {\n  return `${offset.refName}:${offset.coord.toLocaleString('en-US')}`\n}\n\nexport const isElectron =\n  typeof window !== 'undefined' && Boolean(window.electron)\n","import { when as mobxWhen } from 'mobx'\nimport { makeAbortError } from './aborting'\n\ninterface WhenOpts {\n  timeout?: number\n  signal?: AbortSignal\n  name?: string\n}\n\n/**\n * Wrapper for mobx `when` that adds timeout and aborting support.\n */\nexport function when(\n  getter: () => boolean,\n  { timeout, signal, name }: WhenOpts = {},\n) {\n  return new Promise((resolve, reject) => {\n    let finished = false\n\n    const whenPromise = mobxWhen(getter)\n\n    // set up timeout\n    let timeoutId: ReturnType<typeof setTimeout> | undefined\n    let finishTimeout = () => {}\n    if (timeout) {\n      timeoutId = setTimeout(() => {\n        if (!finished) {\n          finished = true\n          whenPromise.cancel()\n          reject(new Error(`timed out waiting for ${name || 'whenPresent'}`))\n        }\n      }, timeout)\n      finishTimeout = () => timeoutId && clearTimeout(timeoutId)\n    }\n\n    // set up aborting\n    if (signal) {\n      signal.addEventListener('abort', () => {\n        if (!finished) {\n          finished = true\n\n          // mobx when supports a cancel method\n          whenPromise.cancel()\n          finishTimeout()\n\n          reject(makeAbortError())\n        }\n      })\n    }\n\n    whenPromise\n      .then(() => {\n        if (!finished) {\n          finished = true\n          finishTimeout()\n\n          resolve()\n        }\n      })\n      .catch(err => {\n        if (!finished) {\n          finished = true\n          finishTimeout()\n\n          reject(err)\n        }\n      })\n  })\n}\n\n/**\n * Wrapper for mobx `when` that makes a promise for the return value\n * of the given function at the point in time when it becomes not\n * undefined and not null.\n */\nexport async function whenPresent<FUNCTION extends () => unknown>(\n  getter: FUNCTION,\n  opts: WhenOpts = {},\n): Promise<NonNullable<ReturnType<FUNCTION>>> {\n  await when(() => {\n    const val = getter()\n    return val !== undefined && val !== null\n  }, opts)\n\n  return getter() as NonNullable<ReturnType<FUNCTION>>\n}\n","import { GenericFilehandle, FilehandleOptions } from 'generic-filehandle'\n\ndeclare global {\n  interface Window {\n    electron?: import('electron').AllElectron\n  }\n}\nconst { electron } = window\n\ntype PathLike = import('fs').PathLike\ntype Stats = import('fs').Stats\n\nexport default class ElectronLocalFile implements GenericFilehandle {\n  private filename: PathLike\n\n  private fd?: Promise<number>\n\n  private ipcRenderer: import('electron').IpcRenderer\n\n  constructor(source: PathLike) {\n    let ipcRenderer\n    if (electron) ipcRenderer = electron.ipcRenderer\n    if (!ipcRenderer)\n      throw new Error(\n        'Cannot use ElectronLocalFile without ipcRenderer from electron',\n      )\n    this.ipcRenderer = ipcRenderer\n    this.filename = source\n  }\n\n  private async getFd(): Promise<number> {\n    if (!this.filename) throw new Error('no file path specified')\n    if (!this.fd)\n      this.fd = this.ipcRenderer.invoke('open', this.filename, 'r') as Promise<\n        number\n      >\n    return this.fd\n  }\n\n  async read(\n    buffer: Buffer,\n    offset = 0,\n    length: number,\n    position = 0,\n  ): Promise<{ buffer: Buffer; bytesRead: number }> {\n    const fetchLength = Math.min(buffer.length - offset, length)\n    const fd = await this.getFd()\n    const res = (await this.ipcRenderer.invoke(\n      'read',\n      fd,\n      buffer,\n      offset,\n      fetchLength,\n      position,\n    )) as { buffer: Buffer; bytesRead: number }\n    // TODO: This looks like a buffer, but fails Buffer.isBuffer(), so we have\n    // to coerce it. Why?\n    res.buffer = Buffer.from(res.buffer)\n    // Copy into input buffer to match node's fs.promises.read() behavior.\n    res.buffer.copy(buffer)\n    return res\n  }\n\n  async readFile(_: FilehandleOptions = {}): Promise<Buffer | string> {\n    if (!this.filename) throw new Error('no file path specified')\n\n    const result = await this.ipcRenderer.invoke('readFile', this.filename)\n\n    return result.byteLength !== undefined ? Buffer.from(result) : result\n  }\n\n  // todo memoize\n  async stat(): Promise<Stats> {\n    return this.ipcRenderer.invoke('stat', await this.getFd()) as Promise<Stats>\n  }\n}\n"],"sourceRoot":""}